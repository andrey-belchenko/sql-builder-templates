<root>
  <parts>
    <part id="20118(10)-ym-name">
      <params>
        <param name="ym">
        </param>
      </params>
      <call function="to_char">
        <call function="ym begin time">
          <useparam name="ym" />
        </call>
        <const>'MM.YYYY'</const>
      </call>
    </part>
  </parts>
  <queries>
    <query name="20118(10)">
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="20118(10)-1" as="a">
        </query>
      </from>
    </query>
    <query name="20118(10)-1" hint="FIRST_ROWS (1)" materialize="1">
      
      <params>
        <param name="date">
          <const>p_date</const>
        </param>
        <param name="kodp">
          <const>p_kodp</const>
        </param>
      </params>
      <select>
        <!--<column table="a" column="kod_sf"/>
        <column table="a" column="summa"/>
        <column table="a" column="oplf"/>
        <column table="a" column="dat_spis"/>
        <column table="a" column="rym"/>
        <column table="a" column="dat_deb_osn"/>-->
        <column table="a" column="kodp" group="1" />
        <column table="a" column="dolg" group="sum" />
        <call function="case" as="period" type="string">
          <call function="when">
            <call function="=">
              <column table="a" column="ym" group="min" />
              <column table="a" column="ym" group="max" />
            </call>
            <usepart part="20118(10)-ym-name">
              <column table="a" column="ym" group="max" />
            </usepart>
          </call>
          <call function="else">
            <call function="||">
              <usepart part="20118(10)-ym-name">
                <column table="a" column="ym" group="min" />
              </usepart>
              <const>'-'</const>
              <usepart part="20118(10)-ym-name">
                <column table="a" column="ym" group="max" />
              </usepart>
            </call>
          </call>
        </call>
      </select>
      <from>
        <query name="n_facvip" as="a">
          <withparams>
            <useparam name="date">
            </useparam>
            <part>
              <params>
                <param name="table-pname">
                </param>
              </params>
              <call function="=">
                <column table=":table-pname" column="kodp" />
                <call function="nvl">
                  <useparam name="kodp">
                  </useparam>
                  <column table=":table-pname" column="kodp" />
                </call>
              </call>
            </part>
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="ls">
            <column table="a" column="dat_bzad_nvl" />
            <useparam name="date">
            </useparam>
          </call>
          <call function="gt">
            <call function="nvl">
              <column table="a" column="dat_deb_osn" />
              <call function="add_month">
                <call function="ym end time">
                  <column table="a" column="rym" />
                </call>
              </call>
            </call>
            <useparam name="date">
            </useparam>
          </call>
          <call function="gt">
            <call function="nvl">
              <column table="a" column="dat_spis" />
              <call function="doomsday" />
            </call>
            <useparam name="date">
            </useparam>
          </call>
          <call function="gt">
            <call function="nvl">
              <column table="a" column="dat_udal" />
              <call function="doomsday" />
            </call>
            <useparam name="date">
            </useparam>
          </call>
          <call function="gt">
            <column table="a" column="dolg" />
            <const>0</const>
          </call>
        </call>
      </where>
    </query>
  </queries>
</root>