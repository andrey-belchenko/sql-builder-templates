<root>
  <forms>
    <form name="10653(39)">
      <content>
        <field name="ym" controlType="UIComboRange" title="Период">
          <listquery>
            <query name="n_calc_dist">
            </query>
          </listquery>
          <defaultquery>
            <query name="n_calc_max">
            </query>
          </defaultquery>
        </field>
        <field name="dep" controlType="UIList" title="Отделение">
          <!--<properties>
            <property name="MainView.OptionsView.ColumnAutoWidth">true</property>
            <property name="MainView.OptionsView.ShowColumnHeaders">false</property>
          </properties>-->
          <listquery>
            <query name="kr_org_dep%tbl">
            </query>
          </listquery>
          <!--<return>
            <node>
              <call function="in">
                <column table="a" column="dep" />
                <call function="array">
                  <fieldvalue />
                </call>
              </call>
            </node>
          </return>-->
        </field>
        <field name="org" controlType="UIList" title="Организация составившая акт">
          <!--<properties>
            <property name="MainView.OptionsView.ColumnAutoWidth">true</property>
            <property name="MainView.OptionsView.ShowColumnHeaders">false</property>
          </properties>-->
          <listquery>
            <query name="hr_bu_org">
            </query>
          </listquery>
          <!--<return>
            <node>
              <call function="in">
                <column table="a" column="kod_bu_org" />
                <call function="array">
                  <fieldvalue />
                </call>
              </call>
            </node>
          </return>-->
        </field>
      </content>
    </form>
  </forms>
  <reports>
    <report name="10653(39)" title="Приложение № 12. Отчет по непризнанным актам неучтенного потребления электроэнергии" form="10653(39)" folder="bu" kod-menu="12209" visible="0">
      <customers>
        <customer id="" />
      </customers>
      <print-templates>
        <excel>
          <template name="10653(39)-12.xml" title="Приложение № 12" multipage="1" />
        </excel>
      </print-templates>
      <params>
        <param name="ym1">
          <const>2014.01</const>
        </param>
        <param name="ym2">
          <const>2014.07</const>
        </param>
        <param name="dep">
          <undefined />
        </param>
        <param name="org">
          <undefined />
        </param>
      </params>
      <queries>
        <query name="10653(39)-dep-org" as="a0">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="dep" />
            <useparam name="org" />
          </withparams>
          <query name="10653(39)-title" as="a1" union="0">
            <withparams>
              <useparam name="ym1" />
              <useparam name="ym2" />
            </withparams>
            <call function="and">
              <call function="=">
                <column table="a0" column="dep">
                </column>
                <column table="a1" column="dep">
                </column>
              </call>
              <call function="=">
                <column table="a0" column="kod_bu_org">
                </column>
                <column table="a1" column="kod_bu_org">
                </column>
              </call>
            </call>
          </query>
          <query name="10653(39)-god" as="a">
            <withparams>
              <useparam name="ym1" />
              <useparam name="ym2" />
              <useparam name="dep" />
              <useparam name="org" />
            </withparams>
            <call function="and">
              <call function="=">
                <column table="a0" column="dep">
                </column>
                <column table="a" column="dep">
                </column>
              </call>
              <call function="=">
                <column table="a0" column="kod_bu_org">
                </column>
                <column table="a" column="kod_bu_org">
                </column>
              </call>
            </call>
            <query name="10653(39)-god-ar" as="c">
              <withparams>
                <useparam name="ym1" />
                <useparam name="ym2" />
                <useparam name="dep" />
                <useparam name="org" />
              </withparams>
              <call function="and">
                <call function="=">
                  <column table="a" column="akt_bu_god">
                  </column>
                  <column table="c" column="akt_bu_god">
                  </column>
                </call>
                <call function="=">
                  <column table="a" column="dep">
                  </column>
                  <column table="c" column="dep">
                  </column>
                </call>
                <call function="=">
                  <column table="a" column="kod_bu_org">
                  </column>
                  <column table="c" column="kod_bu_org">
                  </column>
                </call>
              </call>
              <query name="10653(39)-akt" as="d" main="1">
                <withparams>
                  <useparam name="ym1" />
                  <useparam name="ym2" />
                  <useparam name="dep" />
                  <useparam name="org" />
                </withparams>
                <call function="and">
                  <call function="=">
                    <column table="c" column="akt_bu_god">
                    </column>
                    <column table="d" column="akt_bu_god">
                    </column>
                  </call>
                  <call function="=nvl">
                    <column table="c" column="obj_kod_m">
                    </column>
                    <column table="d" column="obj_kod_m">
                    </column>
                  </call>
                  <call function="=">
                    <column table="c" column="dep">
                    </column>
                    <column table="d" column="dep">
                    </column>
                  </call>
                  <call function="=">
                    <column table="c" column="kod_bu_org">
                    </column>
                    <column table="d" column="kod_bu_org">
                    </column>
                  </call>
                </call>
              </query>
            </query>
          </query>
          <query name="10653(39)-ar" as="e">
            <withparams>
              <useparam name="ym1" />
              <useparam name="ym2" />
              <useparam name="dep" />
              <useparam name="org" />
            </withparams>
            <call function="and">
              <call function="=">
                <column table="a0" column="dep">
                </column>
                <column table="e" column="dep">
                </column>
              </call>
              <call function="=">
                <column table="a0" column="kod_bu_org">
                </column>
                <column table="e" column="kod_bu_org">
                </column>
              </call>
            </call>
          </query>
        </query>
      </queries>
    </report>
  </reports>
  <queries>
    <query name="10653(39)-title">
      <params>
        <param name="ym1">
          <const>2014.03</const>
        </param>
        <param name="ym2">
          <const>2014.03</const>
        </param>
      </params>
      <select>
        <column table="a" column="puser">
        </column>
        <column table="a" column="fio" as="cu_fio">
        </column>
        <column table="a" column="tel" as="cu_tel">
        </column>
        <call function="date to char" as="dat1">
          <call function="ym begin time">
            <useparam name="ym1">
            </useparam>
          </call>
        </call>
        <call function="date to char" as="dat2">
          <call function="ym end time">
            <useparam name="ym2">
            </useparam>
          </call>
        </call>
        <column table="b" column="kodp" as="dep" key="1">
        </column>
        <column table="b" column="name" as="dep_name">
        </column>
        <column table="b" column="vis1_fio">
        </column>
        <column table="b" column="vis2_fio">
        </column>
        <column table="c" column="kod_bu_org" key="1">
        </column>
      </select>
      <from>
        <query name="ks_user_cur" as="a">
        </query>
        <query name="kr_org_dep" as="b" join="cross">
        </query>
        <query name="hr_bu_org" as="c" join="cross">
        </query>
      </from>
    </query>
    <query name="10653(39)-ar" order="rwn">
      <params>
        <param name="ym1">
          <const>2014.03</const>
        </param>
        <param name="ym2">
          <const>2014.05</const>
        </param>
        <param name="dep">
          <undefined />
        </param>
        <param name="org">
          <undefined />
        </param>
      </params>
      <select>
        <column table="a" column="kod_bu_akt" group="count" as="cnt">
        </column>
        <column table="a" column="kod_bu_org" group="1">
        </column>
        <column table="a" column="org_name" group="max">
        </column>
        <column table="a" column="dep" group="1">
        </column>
        <column table="a" column="dep_name" group="max">
        </column>
        <column table="a" column="obj_kod_m" group="1">
        </column>
        <column table="a" column="obj_adr_m_name" group="max">
        </column>
        <column table="a" column="rwn" group="min">
        </column>
        <column table="a" column="cust" group="sum">
        </column>
        <column table="a" column="nachisl" group="sum">
        </column>
      </select>
      <from>
        <query name="10653(39)" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="dep" />
            <useparam name="org" />
          </withparams>
        </query>
      </from>
    </query>
    <query name="10653(39)-dep-org" order="rwn">
      <params>
        <param name="ym1">
          <const>2014.03</const>
        </param>
        <param name="ym2">
          <const>2014.05</const>
        </param>
        <param name="dep">
          <undefined />
        </param>
        <param name="org">
          <undefined />
        </param>
      </params>
      <select>
        <column table="a" column="kod_bu_akt" group="count" as="cnt">
        </column>
        <column table="a" column="kod_bu_org" group="1">
        </column>
        <column table="a" column="org_name" group="max">
        </column>
        <column table="a" column="dep" group="1">
        </column>
        <column table="a" column="dep_name" group="max">
        </column>
        <column table="a" column="rwn" group="min">
        </column>
        <column table="a" column="cust" group="sum">
        </column>
        <column table="a" column="nachisl" group="sum">
        </column>
      </select>
      <from>
        <query name="10653(39)" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="dep" />
            <useparam name="org" />
          </withparams>
        </query>
      </from>
    </query>
    <query name="10653(39)-god" order="rwn">
      <params>
        <param name="ym1">
          <const>2014.03</const>
        </param>
        <param name="ym2">
          <const>2014.05</const>
        </param>
        <param name="dep">
          <undefined />
        </param>
        <param name="org">
          <undefined />
        </param>
      </params>
      <select>
        <column table="a" column="akt_bu_god" group="1">
        </column>
        <column table="a" column="kod_bu_org" group="1">
        </column>
        <column table="a" column="org_name" group="max">
        </column>
        <column table="a" column="dep" group="1">
        </column>
        <column table="a" column="dep_name" group="max">
        </column>
        <column table="a" column="rwn" group="min">
        </column>
        <column table="a" column="cust" group="sum">
        </column>
        <column table="a" column="nachisl" group="sum">
        </column>
      </select>
      <from>
        <query name="10653(39)" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="dep" />
            <useparam name="org" />
          </withparams>
        </query>
      </from>
    </query>
    <query name="10653(39)-god-ar" order="rwn">
      <params>
        <param name="ym1">
          <const>2014.03</const>
        </param>
        <param name="ym2">
          <const>2014.05</const>
        </param>
        <param name="dep">
          <undefined />
        </param>
        <param name="org">
          <undefined />
        </param>
      </params>
      <select>
        <column table="a" column="kod_bu_akt" group="count" as="cnt">
        </column>
        <column table="a" column="akt_bu_god" group="1">
        </column>
        <column table="a" column="kod_bu_org" group="1">
        </column>
        <column table="a" column="org_name" group="max">
        </column>
        <column table="a" column="dep" group="1">
        </column>
        <column table="a" column="dep_name" group="max">
        </column>
        <column table="a" column="obj_kod_m" group="1">
        </column>
        <column table="a" column="obj_adr_m_name" group="max">
        </column>
        <column table="a" column="rwn" group="min">
        </column>
        <column table="a" column="cust" group="sum">
        </column>
        <column table="a" column="nachisl" group="sum">
        </column>
      </select>
      <from>
        <query name="10653(39)" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="dep" />
            <useparam name="org" />
          </withparams>
        </query>
      </from>
    </query>
    <query name="10653(39)-akt" order="rwn">
      <params>
        <param name="ym1">
          <const>2014.03</const>
        </param>
        <param name="ym2">
          <const>2014.05</const>
        </param>
        <param name="dep">
          <undefined />
        </param>
        <param name="org">
          <undefined />
        </param>
      </params>
      <select>
        <column table="a" column="*">
        </column>
      </select>
      <from>
        <query name="10653(39)" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="dep" />
            <useparam name="org" />
          </withparams>
        </query>
      </from>
    </query>
    <query name="10653(39)">
      <params>
        <param name="ym1">
          <const>2014.04</const>
        </param>
        <param name="ym2">
          <const>2014.05</const>
        </param>
        <param name="dep">
          <undefined />
        </param>
        <param name="org">
          <undefined />
        </param>
      </params>
      <select>
        <column table="a" column="kod_bu_akt">
        </column>
        <column table="a" column="kod_bu_org">
        </column>
        <column table="a" column="bu_akt_org_name" as="org_name">
        </column>
        <column table="a" column="dep">
        </column>
        <column table="a" column="dep_name">
        </column>
      
        <column table="a" column="akt_bu_ym_create" as="akt_bu_ym" fixed="1"/>
        <column table="a" column="akt_bu_god_create" as="akt_bu_god" fixed="1"/>

        <column table="a" column="obj_kod_m">
        </column>
        <column table="a" column="obj_adr_m_name" fixed="1">
        </column>
        <call function="row_number" as="rwn" type="number" title="№ пп">
          <call function="partition by">
            <const>dep,kod_bu_org</const>
          </call>
          <call function="order by 2">
            <const>akt_bu_god_create,obj_adr_m_name</const>
          </call>
        </call>
        <column table="a" column="bu_akt_num" as="num">
        </column>
        <column table="a" column="bu_akt_dat" as="dat">
        </column>
        <column table="a" column="ndog">
        </column>
        <column table="a" column="payer_name">
        </column>
        <column table="a" column="obj_adr">
        </column>
        <column table="a" column="cust_nepr"  as="cust" nvl="0">
        </column>
        <column table="a" column="nachisl_nepr" as="nachisl" nvl="0">
        </column>
      </select>
      <from>
        <query name="10653(52)" as="a">
        </query>
      </from>
      <where>
        <call function="and">
          <call function="is null">
            <column table="a" column="date_isp">
            </column>
          </call>
          <call function="!=">
            <column table="a" column="nachisl_nepr">
            </column>
            <const>0</const>
          </call>
          <call function="between">
            <column table="this" column="akt_bu_ym">
            </column>
            <useparam name="ym1">
            </useparam>
            <useparam name="ym2">
            </useparam>
          </call>
           <call function="in" optional="1">
            <column table="a" column="dep"/>
            <useparam name="dep"/>
          </call>
          <call function="in" optional="1">
            <column table="a" column="kod_bu_org"/>
            <useparam name="org"/>
          </call>
        </call>
      </where>
    </query>

    <query name="10653(39)-test">
      <params>
        <param name="ym1">
          <const>2014.04</const>
        </param>
        <param name="ym2">
          <const>2014.05</const>
        </param>
        <param name="dep">
          <undefined />
        </param>
        <param name="org">
          <undefined />
        </param>
      </params>
      <select>
        <column table="a" column="kod_bu_akt">
        </column>
        
        <column table="a" column="ndog">
        </column>
        
      </select>
      <from>
        <query name="hr_bu_akt" as="a">
        </query>
      </from>
      
    </query>
  </queries>
</root>