<root>

  <reports>
    <report name="10653(45)" title="Приложение № 14. Разбивка  объема безучетного потребления  по месяцам периода безучетного потребления" form="10653(40)" folder="bu" kod-menu="12209" visible="0">
      <customers>
        <customer id="10" />
      </customers>
      <print-templates>
        <excel>
          <template name="10653(45)-14.xml" title="Приложение № 14"  multipage="1"/>
        </excel>
      </print-templates>
      <params>
        <param name="ym1">
        </param>
        <param name="ym2">
        </param>
      </params>
      <queries>
        <query name="10653(45)-all" as="t" title="По отделениям">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
          </withparams>
          <columns>
            <column table="t" name="dep"/>
            <column table="t" name="dep_name" />
            <column table="t" name="dat1" title="С"/>
            <column table="t" name="dat2" title="По"/>
            <band table="bt" column="rym_id">
              <column table="bt" name="cust4" title="кВт.ч."/>
              <column table="bt" name="cust3" title="кВт."/>
            </band>
            <band  title="Итого">
              <column table="t" name="cust4"  title="кВт.ч."/>
              <column table="t" name="cust3"  title="кВт."/>
            </band>
          </columns>
          <query name="10653(45)-all-rym" as="bt">
            <transpose>
              <dimension>
                <column column="rym_id" title="rym_name">
                </column>
              </dimension>
              <values>
                <column column="cust3">
                </column>
                <column column="cust4">
                </column>
              </values>
            </transpose>
            <withparams>
              <useparam name="ym1" />
              <useparam name="ym2" />
            </withparams>
            <call function="and">
              <call function="=">
                <column table="t" column="dep"/>
                <column table="bt" column="dep"/>
              </call>
            </call>
          </query>
          <query name="10653(45)-org" as="a0" title="По организациям">
            <withparams>
              <useparam name="ym1" />
              <useparam name="ym2" />
            </withparams>
            <columns>
              <column table="a0" name="dep"/>
              <column table="a0" name="dep_name" />
              <column table="a0" name="akt_bu_org_name"/>
              <band table="b0" column="rym_id">
                <column table="b0" name="cust4" title="кВт.ч."/>
                <column table="b0" name="cust3" title="кВт."/>
              </band>
              <band  title="Итого">
                <column table="a0" name="cust4"  title="кВт.ч."/>
                <column table="a0" name="cust3"  title="кВт."/>
              </band>
              <column table="a0" name="kod_bu_org"/>
            </columns>
            <query name="10653(45)-org-rym" as="b0">
              <transpose>
                <dimension>
                  <column column="rym_id" title="rym_name">
                  </column>
                </dimension>
                <values>
                  <column column="cust3">
                  </column>
                  <column column="cust4">
                  </column>
                </values>
              </transpose>
              <withparams>
                <useparam name="ym1" />
                <useparam name="ym2" />
              </withparams>
              <call function="and">
                <call function="=">
                  <column table="a0" column="dep"/>
                  <column table="b0" column="dep"/>
                </call>
                <call function="=">
                  <column table="a0" column="kod_bu_org"/>
                  <column table="b0" column="kod_bu_org"/>
                </call>
              </call>
            </query>
            <query name="10653(45)-org-gr" as="a1" title="По группам">
              <withparams>
                <useparam name="ym1" />
                <useparam name="ym2" />
              </withparams>
              <columns>
                <column table="a1" name="dep"/>
                <column table="a1" name="dep_name" />
                <column table="a1" name="akt_bu_org_name"/>
                <column table="a1" name="gr_name"/>
                <band table="b1" column="rym_id">
                  <column table="b1" name="cust4" title="кВт.ч."/>
                  <column table="b1" name="cust3" title="кВт."/>
                </band>
                <band  title="Итого">
                  <column table="a1" name="cust4"  title="кВт.ч."/>
                  <column table="a1" name="cust3"  title="кВт."/>
                </band>
                <column table="a1" name="kod_bu_org"/>
                <column table="a1" name="kod_gr"/>
              </columns>
              <query name="10653(45)-org-gr-rym" as="b1">
                <transpose>
                  <dimension>
                    <column column="rym_id" title="rym_name">
                    </column>
                  </dimension>
                  <values>
                    <column column="cust3">
                    </column>
                    <column column="cust4">
                    </column>
                  </values>
                </transpose>
                <withparams>
                  <useparam name="ym1" />
                  <useparam name="ym2" />
                </withparams>
                <call function="and">
                  <call function="=">
                    <column table="a1" column="dep"/>
                    <column table="b1" column="dep"/>
                  </call>
                  <call function="=">
                    <column table="a1" column="kod_bu_org"/>
                    <column table="b1" column="kod_bu_org"/>
                  </call>
                  <call function="=">
                    <column table="a1" column="kod_gr"/>
                    <column table="b1" column="kod_gr"/>
                  </call>
                </call>
              </query>
              <query name="10653(45)" as="a" title="По актам" main="1">
                <columns>
                  <column table="a" name="dep"/>
                  <column table="a" name="dep_name" />
                  <column table="a" name="akt_bu_org_name"/>
                  <column table="a" name="gr_name"/>
                  <column table="a" name="akt_bu_num" />
                  <band table="b" column="rym_id">
                    <column table="b" name="cust4" title="кВт.ч."/>
                    <column table="b" name="cust3" title="кВт."/>
                  </band>
                  <band  title="Итого">
                    <column table="a" name="cust4"  title="кВт.ч."/>
                    <column table="a" name="cust3"  title="кВт."/>
                  </band>
                  <column table="a" name="kod_bu_org"/>
                  <column table="a" name="kod_bu_akt"/>
                  <column table="a" name="kod_gr"/>
                </columns>
                <withparams>
                  <useparam name="ym1" />
                  <useparam name="ym2" />
                </withparams>
                <query name="10653(45)-rym" as="b">
                  <transpose>
                    <dimension>
                      <column column="rym_id" title="rym_name">
                      </column>
                    </dimension>
                    <values>
                      <column column="cust3">
                      </column>
                      <column column="cust4">
                      </column>
                    </values>
                  </transpose>
                  <withparams>
                    <useparam name="ym1" />
                    <useparam name="ym2" />
                  </withparams>
                  <call function="and">
                    <call function="=">
                      <column table="a" column="dep"/>
                      <column table="b" column="dep"/>
                    </call>
                    <call function="=">
                      <column table="a" column="kod_bu_akt"/>
                      <column table="b" column="kod_bu_akt"/>
                    </call>
                    <call function="=">
                      <column table="a" column="kod_gr"/>
                      <column table="b" column="kod_gr"/>
                    </call>
                  </call>
                </query>
                <call function="and">
                  <call function="=">
                    <column table="a" column="dep"/>
                    <column table="a1" column="dep"/>
                  </call>
                  <call function="=">
                    <column table="a" column="kod_bu_org"/>
                    <column table="a1" column="kod_bu_org"/>
                  </call>
                  <call function="=">
                    <column table="a" column="kod_gr"/>
                    <column table="a1" column="kod_gr"/>
                  </call>
                </call>
              </query>
              <call function="and">
                <call function="=">
                  <column table="a0" column="kod_bu_org"/>
                  <column table="a1" column="kod_bu_org"/>
                </call>
                <call function="=">
                  <column table="a0" column="dep"/>
                  <column table="a1" column="dep"/>
                </call>
              </call>
            </query>
            <call function="and">
              <call function="=">
                <column table="t" column="dep"/>
                <column table="a0" column="dep"/>
              </call>
            </call>
          </query>
          <query name="10653(45)-gr" as="gr" title="По группам">
            <withparams>
              <useparam name="ym1" />
              <useparam name="ym2" />
            </withparams>
            <columns>
              <column table="gr" name="dep"/>
              <column table="gr" name="dep_name" />
              <column table="gr" name="gr_name"/>
              <band table="bgr" column="rym_id">
                <column table="bgr" name="cust4" title="кВт.ч."/>
                <column table="bgr" name="cust3" title="кВт."/>
              </band>
              <band  title="Итого">
                <column table="gr" name="cust4"  title="кВт.ч."/>
                <column table="gr" name="cust3"  title="кВт."/>
              </band>
              <column table="gr" name="kod_gr"/>
            </columns>
            <query name="10653(45)-gr-rym" as="bgr">
              <transpose>
                <dimension>
                  <column column="rym_id" title="rym_name">
                  </column>
                </dimension>
                <values>
                  <column column="cust3">
                  </column>
                  <column column="cust4">
                  </column>
                </values>
              </transpose>
              <withparams>
                <useparam name="ym1" />
                <useparam name="ym2" />
              </withparams>
              <call function="and">
                <call function="=">
                  <column table="gr" column="kod_gr"/>
                  <column table="bgr" column="kod_gr"/>
                </call>
                <call function="=">
                  <column table="gr" column="dep"/>
                  <column table="bgr" column="dep"/>
                </call>
              </call>
            </query>
            <call function="and">
              <call function="=">
                <column table="t" column="dep"/>
                <column table="gr" column="dep"/>
              </call>
            </call>
          </query>
        </query>

       

       
      </queries>
    </report>
  </reports>

  
  <queries>
    <query name="10653(45)" order="rwn">
      <params>
        <param name="ym1">
          <const>2013.03</const>
        </param>
        <param name="ym2">
          <const>2015.03</const>
        </param>
      </params>
      <select>
        <column table="a" column="rwn" group="min"/>
        <column table="a" column="dep" group="1"/>
        <column table="a" column="dep_name" group="max"/>
        <column table="a" column="kod_bu_org" group="1"/>
        <column table="a" column="akt_bu_org_name" group="max"/>
        <column table="a" column="kod_gr" group="1"/>
        <column table="a" column="gr_name" group="max"/>
        <column table="a" column="kod_bu_akt" group="1"/>
        <column table="a" column="akt_bu_num" group="max"/>
        <column table="a" column="cust4" group="sum"/>
        <column table="a" column="cust3"  group="sum"/>
      </select>
      <from>
        <query name="10653(45)-1" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
          </withparams>
        </query>
      </from>
    </query>


    <query name="10653(45)-all" order="rwn">
      <params>
        <param name="ym1">
          <const>2013.03</const>
        </param>
        <param name="ym2">
          <const>2015.02</const>
        </param>
      </params>
      <select>
        <column table="a" column="dep" group="1"/>
        <column table="a" column="dep_name" group="max"/>
        <column table="a" column="rwn" group="min"/>
        <column table="a" column="cust4" group="sum"/>
        <column table="a" column="cust3"  group="sum"/>
        <call function="date to char" as="dat1">
          <call function="ym begin time">
            <useparam name="ym1"/>
          </call>
        </call>
        <call function="date to char" as="dat2">
          <call function="ym end time">
            <useparam name="ym2"/>
          </call>
        </call>
      </select>
      <from>
        <query name="10653(45)-1" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
          </withparams>
        </query>
      </from>
    </query>

    <query name="10653(45)-all-rym" order="rym_id">
      <params>
        <param name="ym1">
          <const>2013.03</const>
        </param>
        <param name="ym2">
          <const>2015.03</const>
        </param>
      </params>
      <select>
        <column table="a" column="dep" group="1"/>
        <column table="a" column="dep_name" group="max"/>
        <column table="a" column="rym_id" group="1"/>
        <column table="a" column="rym_name" group="max"/>
        <column table="a" column="cust4" group="sum"/>
        <column table="a" column="cust3"  group="sum"/>
      </select>
      <from>
        <query name="10653(45)-1" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
          </withparams>
        </query>
      </from>
    </query>


    <query name="10653(45)-gr" order="rwn">
      <params>
        <param name="ym1">
          <const>2013.03</const>
        </param>
        <param name="ym2">
          <const>2015.03</const>
        </param>
      </params>
      <select>
        <column table="a" column="dep" group="1"/>
        <column table="a" column="dep_name" group="max"/>
        <column table="a" column="rwn" group="min"/>
        <column table="a" column="kod_gr" group="1"/>
        <column table="a" column="gr_name" group="max"/>
        <column table="a" column="cust4" group="sum"/>
        <column table="a" column="cust3"  group="sum"/>
      </select>
      <from>
        <query name="10653(45)-1" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
          </withparams>
        </query>
      </from>
    </query>

    <query name="10653(45)-gr-rym" order="rym_id">
      <params>
        <param name="ym1">
          <const>2013.03</const>
        </param>
        <param name="ym2">
          <const>2015.03</const>
        </param>
      </params>
      <select>
        <column table="a" column="dep" group="1"/>
        <column table="a" column="dep_name" group="max"/>
        <column table="a" column="kod_gr" group="1"/>
        <column table="a" column="rym_id" group="1"/>
        <column table="a" column="rym_name" group="max"/>
        <column table="a" column="cust4" group="sum"/>
        <column table="a" column="cust3"  group="sum"/>
      </select>
      <from>
        <query name="10653(45)-1" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
          </withparams>
        </query>
      </from>
    </query>


    <!--<query name="10653(45)-org-test" order="rwn">
      <params>
        <param name="ym1">
          <const>2013.03</const>
        </param>
        <param name="ym2">
          <const>2015.03</const>
        </param>
      </params>
      <select>
        <call function="rownum" as="rn" key="1"/>
        <column table="a" column="*"/>
      </select>
      <from>
        <query name="10653(45)-org" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
          </withparams>
        </query>
      </from>
    </query>-->

    <query name="10653(45)-org" order="rwn">
      <params>
        <param name="ym1">
          <const>2013.03</const>
        </param>
        <param name="ym2">
          <const>2015.03</const>
        </param>
      </params>
      <select>
        <column table="a" column="dep" group="1"/>
        <column table="a" column="dep_name" group="max"/>
        <column table="a" column="rwn" group="min"/>
        <column table="a" column="kod_bu_org" group="1"/>
        <column table="a" column="akt_bu_org_name" group="max"/>
        <column table="a" column="cust4" group="sum"/>
        <column table="a" column="cust3"  group="sum"/>
      </select>
      <from>
        <query name="10653(45)-1" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
          </withparams>
        </query>
      </from>
    </query>

    <query name="10653(45)-org-rym" order="rym_id">
      <params>
        <param name="ym1">
          <const>2013.03</const>
        </param>
        <param name="ym2">
          <const>2015.03</const>
        </param>
      </params>
      <select>
        <column table="a" column="dep" group="1"/>
        <column table="a" column="dep_name" group="max"/>
        <column table="a" column="kod_bu_org" group="1"/>
        <column table="a" column="rym_id" group="1"/>
        <column table="a" column="rym_name" group="max"/>
        <column table="a" column="cust4" group="sum"/>
        <column table="a" column="cust3"  group="sum"/>
      </select>
      <from>
        <query name="10653(45)-1" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
          </withparams>
        </query>
      </from>
    </query>


    <query name="10653(45)-org-gr" order="rwn">
      <params>
        <param name="ym1">
          <const>2013.03</const>
        </param>
        <param name="ym2">
          <const>2015.03</const>
        </param>
      </params>
      <select>
        <column table="a" column="rwn" group="min"/>
        <column table="a" column="dep" group="1"/>
        <column table="a" column="dep_name" group="max"/>
        <column table="a" column="kod_bu_org" group="1"/>
        <column table="a" column="akt_bu_org_name" group="max"/>
        <column table="a" column="kod_gr" group="1"/>
        <column table="a" column="gr_name" group="max"/>
        <column table="a" column="cust4" group="sum"/>
        <column table="a" column="cust3"  group="sum"/>
      </select>
      <from>
        <query name="10653(45)-1" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
          </withparams>
        </query>
      </from>
    </query>

    <query name="10653(45)-org-gr-rym" order="rym_id">
      <params>
        <param name="ym1">
          <const>2013.03</const>
        </param>
        <param name="ym2">
          <const>2015.03</const>
        </param>
      </params>
      <select>
        <column table="a" column="dep" group="1"/>
        <column table="a" column="dep_name" group="max"/>
        <column table="a" column="kod_bu_org" group="1"/>
        <column table="a" column="kod_gr" group="1"/>
        <column table="a" column="rym_id" group="1"/>
        <column table="a" column="rym_name" group="max"/>
        <column table="a" column="cust4" group="sum"/>
        <column table="a" column="cust3"  group="sum"/>
      </select>
      <from>
        <query name="10653(45)-1" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
          </withparams>
        </query>
      </from>
    </query>
    
    <query name="10653(45)-rym" order="rym_id">
      <params>
        <param name="ym1">
          <const>2013.03</const>
        </param>
        <param name="ym2">
          <const>2015.03</const>
        </param>
      </params>
      <select>
        <column table="a" column="dep" group="1"/>
        <column table="a" column="dep_name" group="max"/>
        <column table="a" column="kod_bu_akt" group="1"/>
        <column table="a" column="kod_gr" group="1"/>
        <column table="a" column="rym_id" group="1"/>
        <column table="a" column="rym_name" group="max"/>
        <column table="a" column="cust4" group="sum"/>
        <column table="a" column="cust3"  group="sum"/>
      </select>
      <from>
        <query name="10653(45)-1" as="a">
          <withparams>
            <useparam name="ym1" />
            <useparam name="ym2" />
          </withparams>
        </query>
      </from>
    </query>

    <query name="10653(45)-1" materialize="1">
      <params>
        <param name="ym1">
          <const>2013.03</const>
        </param>
        <param name="ym2">
          <const>2015.04</const>
        </param>
      </params>
      <select>
        <call function="row_number" as="rwn" type="number" title="№ пп" fixed="1">
          <call function="order by 2">
            <column table="a" column="akt_bu_org_name"/>
            <column table="a" column="category"/>
            <column table="a" column="voltage"/>
            <column table="a" column="kodinterval"/>
          </call>
        </call>
        
        <column table="a" column="rym_nvl" as="rym"/>
        <call function="ym to char" as="rym_name">
          <column table="a" column="rym_nvl"/>
        </call>
        <call function="*" as="rym_id">
          <column table="a" column="rym_nvl"/>
          <const>100</const>
        </call>
        <column table="a" column="kod_bu_org"/>
        <column table="a" column="akt_bu_org_name"/>
        <usepart part="10653(40)-group-columns"/>
       
        <call function="*" as="cust4">
          <column table="a" column="cust4"/>
          <column table="b" column="proc_cust"/>
        </call>

        <call function="*" as="cust3">
          <column table="a" column="cust3"/>
          <column table="b" column="proc_cust"/>
        </call>
        
        <column table="a" column="kod_account"/>
        <column table="a" column="dep"/>
        <column table="a" column="dep_name"/>
        
        <column table="a" column="kod_dog"/>
        <column table="a" column="ndog"/>
        <column table="a" column="akt_bu_dat"/>
        <column table="a" column="akt_bu_num"/>
        <column table="a" column="kod_bu_akt"/>        
        <column table="a" column="voltage"/>
        <column table="a" column="category"/>
        <column table="a" column="kodinterval"/>
        <column table="a" column="voltage_abbr"/>
        <column table="a" column="category_name"/>
        <column table="a" column="interval_name"/>
      </select>
      <from>
        <query name="nr_account" as="a">
        </query>
        <query name="10653(52)-ym-nachisl" as="b" join="inner">
          <call function="=">
            <column table="a" column="kod_bu_akt"/>
            <column table="b" column="kod_bu_akt"/>
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="between">
            <column table="b" column="ym"/>
            <useparam name="ym1"></useparam>
            <useparam name="ym2"></useparam>
          </call>
          <call function="is not null">
            <column table="a" column="kod_bu_org"/>
          </call>
        </call>
      </where>
    </query>
    
    
 

  </queries>
</root>