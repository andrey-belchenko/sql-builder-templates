<root>
  <forms>
    <form name="test-1" with-behavior="0">
      <content>
        <field name="ym1" controlType="UICombo" title="Период">
          <listquery>
            <query name="n_calc_dist">
            </query>
          </listquery>
          <defaultquery>
            <query name="kr_calc_max">
            </query>
          </defaultquery>
        </field>
      </content>
    </form>
  </forms>
  <reports>
    <report name="temp-1" title="Тест" form="test-1">
      <params>
        <param name="data">
          <call function="date">
            <const>'01.07.2013'</const>
          </call>
        </param>
      </params>
      <queries>
        <query name="temp-8" as="a">
          <withparams>
            <useparam name="data" />
          </withparams>
          <query name="temp-7" as="b">
            <call function="=">
              <column table="a" column="kod_dog">
              </column>
              <column table="b" column="kod_dog">
              </column>
            </call>
            <query name="temp-9" as="c">
              <withparams>
                <useparam name="data" />
              </withparams>
              <transpose>
                <dimension>
                  <column column="vid_t" title="vid_t_name">
                  </column>
                </dimension>
                <values>
                  <column column="nachisl">
                  </column>
                  <column column="cust">
                  </column>
                </values>
              </transpose>
              <call function="=">
                <column table="b" column="kod_numobj">
                </column>
                <column table="c" column="kod_numobj">
                </column>
              </call>
            </query>
          </query>
        </query>
      </queries>
    </report>
    <report name="temp-2" title="Тест2" form="test-1">
      <params>
        <param name="data">
          <call function="date">
            <const>'01.07.2013'</const>
          </call>
        </param>
      </params>
      <queries>
        <query name="temp-7" as="b">
          <withparams>
            <useparam name="data" />
          </withparams>
          <query name="temp-9" as="c">
            <withparams>
              <useparam name="data" />
            </withparams>
            <transpose>
              <dimension>
                <column column="vid_t" title="vid_t_name">
                </column>
              </dimension>
              <values>
                <column column="nachisl">
                </column>
                <column column="cust">
                </column>
              </values>
            </transpose>
            <call function="=">
              <column table="b" column="kod_numobj">
              </column>
              <column table="c" column="kod_numobj">
              </column>
            </call>
          </query>
        </query>
      </queries>
    </report>
  </reports>
  <queries>
    <query name="temp-7.1">
      <select>
        <column table="b" column="kod_dog" as="kod_parent">
        </column>
        <column table="a" column="kod_numobj">
        </column>
        <column table="a" column="kod_dog">
        </column>
        <column table="a" column="num_obj">
        </column>
      </select>
      <from>
        <query name="temp-7" as="a" />
        <query name="temp-8" as="b" join="inner">
          <call function="=">
            <column table="a" column="kod_dog">
            </column>
            <column table="b" column="kod_dog">
            </column>
          </call>
        </query>
      </from>
    </query>
    <query name="temp-7">
      <params>
        <param name="dat">
        </param>
      </params>
      <select>
        <column table="a" column="kod_numobj">
        </column>
        <column table="a" column="kod_dog">
        </column>
        <column table="a" column="ndog">
        </column>
        <column table="a" column="num_obj">
        </column>
      </select>
      <from>
        <query name="kr_numobj" as="a" />
      </from>
      <where>
        <call function="gt">
          <column table="a" column="dat_dog">
          </column>
          <useparam name="dat">
          </useparam>
        </call>
      </where>
    </query>
    <query name="temp-8">
      <params>
        <param name="dat">
        </param>
      </params>
      <select>
        <column table="a" column="kod_dog">
        </column>
        <column table="a" column="ndog">
        </column>
        <column table="a" column="dat_dog">
        </column>
      </select>
      <from>
        <query name="kr_dogovor" as="a" />
      </from>
      <where>
        <call function="gt">
          <column table="a" column="dat_dog">
          </column>
          <useparam name="dat">
          </useparam>
        </call>
      </where>
    </query>
    <query name="temp-9">
      <params>
        <param name="dat">
        </param>
      </params>
      <select>
        <column table="a" column="kod_numobj" group="1">
        </column>
        <column table="a" column="vid_t" group="1">
        </column>
        <column table="a" column="vid_t_name" group="max">
        </column>
        <column table="a" column="nachisl" group="sum">
        </column>
        <column table="a" column="cust" group="sum">
        </column>
      </select>
      <from>
        <query name="sr_facras" as="a" />
      </from>
      <where>
        <call function="gt">
          <column table="a" column="dat_sf">
          </column>
          <useparam name="dat">
          </useparam>
        </call>
      </where>
    </query>
    <query name="temp-5">
      <select>
        <column table="a" column="dep_name" group="1" />
        <column table="a" column="opl" group="sum" />
        <column table="a" column="sf_ym" group="1" />
      </select>
      <from>
        <query name="sr_facopl" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="ym" />
            <const>2014.01</const>
          </call>
          <call function="!=">
            <column table="a" column="num_t" />
            <const>70</const>
          </call>
        </call>
      </where>
    </query>
    <query name="temp-6">
      <select>
        <column table="a" column="dep_name" group="1" />
        <column table="a" column="opl" group="sum" />
        <column table="a" column="date_ym" group="1" />
        <column table="a" column="type_opl_name" group="1" />
      </select>
      <from>
        <query name="sr_facopl" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="ym" />
            <const>2014.01</const>
          </call>
          <call function="!=">
            <column table="a" column="num_t" />
            <const>70</const>
          </call>
        </call>
      </where>
    </query>
    <query name="temp-4">
      <select>
        <column table="a" column="ym" group="1" />
        <column table="a" column="dep_name" group="1" />
        <column table="a" column="sf_ym" group="1" />
        <column table="a" column="date_ym" group="1" />
        <column table="a" column="type_opl_name" group="1" />
        <column table="a" column="oplf" group="sum" />
      </select>
      <from>
        <query name="sr_opl" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="ym" />
            <const>2014.01</const>
          </call>
        </call>
      </where>
    </query>
    <query name="temp-3" materialize="1">
      <select>
        <column table="b" column="kodp" />
        <column table="b" column="name" />
        <call function="||" as="fullname">
          <column table="b" column="kodp" />
          <column table="b" column="name" />
        </call>
      </select>
      <from>
        <query name="kr_org" as="b" />
      </from>
    </query>
    <query name="temp-2" materialize="1">
      <select>
        <column table="a" column="kod_dog" group="1" />
        <column table="a" column="dat_dog" group="1" />
        <column table="a" column="kodp" group="1" />
        <column table="a" column="ndog" group="1">
        </column>
        <column table="b" column="name" group="1" />
        <column table="b" column="fullname" group="max" />
      </select>
      <from>
        <query name="kr_dogovor" as="a" />
        <query name="temp-3" as="b" join="left outer">
          <call function="=">
            <column table="a" column="kodp" />
            <column table="b" column="kodp" />
          </call>
        </query>
      </from>
    </query>
    <query name="temp-2.1">
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="temp-2" as="a" />
      </from>
    </query>
    <query name="temp-1">
      <select>
        <column table="a" column="dep_name" group="1" />
        <column table="a" column="tep_el" group="1">
        </column>
        <column table="a" column="vid_t" group="1" />
        <column table="a" column="cust" group="sum" />
      </select>
      <from>
        <query name="sr_facras" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="ym">
            </column>
            <const>2014.01</const>
          </call>
          <call function="=">
            <call function="nvl">
              <column table="a" column="rym">
              </column>
              <const>2014.01</const>
            </call>
            <const>2014.01</const>
          </call>
        </call>
      </where>
    </query>
    <query name="21445-opl">
      <params>
        <param name="date1">
          <call function="ym begin time">
            <const>2012.01</const>
          </call>
        </param>
        <param name="date2">
          <call function="ym end time">
            <const>2012.01</const>
          </call>
        </param>
      </params>
      <select>
        <column table="a" column="*">
        </column>
      </select>
      <from>
        <query name="21445-opl-un" as="a">
          <withparams>
            <useparam name="date1" />
            <useparam name="date2" />
          </withparams>
        </query>
      </from>
    </query>
    <query name="21445-opl-un">
      <params>
        <param name="date1">
        </param>
        <param name="date2">
        </param>
      </params>
      <union>
        <query name="21445-opl-fact">
          <withparams>
            <useparam name="date1" />
            <useparam name="date2" />
          </withparams>
        </query>
        <query name="21445-opl-kred">
          <withparams>
            <useparam name="date1" />
            <useparam name="date2" />
          </withparams>
        </query>
      </union>
    </query>
    <query name="21445-opl-fact">
      <params>
        <param name="date1">
          <call function="ym begin time">
            <const>2012.01</const>
          </call>
        </param>
        <param name="date2">
          <call function="ym end time">
            <const>2012.01</const>
          </call>
        </param>
      </params>
      <select>
        <column table="a" column="dep" group="1" />
        <column table="b" column="id" as="vid_t_teplo" group="1" />
        <column table="a" column="kodbpol" group="1" />
        <column table="a" column="dep_name" group="max" />
        <column table="a" column="pfact_prev" group="1">
        </column>
        <call function="case" as="opl_name" type="string">
          <call function="when">
            <call function="=">
              <column table="a" column="pfact_prev" group="1">
              </column>
              <const>1</const>
            </call>
            <const>'Погашение факта переплатой/авансом прошлого периода'</const>
          </call>
          <call function="else">
            <const>'Оплата текущего периода'</const>
          </call>
        </call>
        <column table="b" column="name" as="vid_t_teplo_name" group="max" />
        <column table="a" column="pol_rs_name" group="max" />
        <column table="a" column="opl" group="sum" />
        <column table="a" column="cust" as="opl_cust" group="sum" />
      </select>
      <from>
        <query name="sr_facopl" as="a" />
        <query name="v_vid_t_teplo" as="b" join="left outer">
          <call function="=">
            <column table="a" column="vid_t_teplo">
            </column>
            <column table="b" column="id">
            </column>
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="between">
            <column table="a" column="dat_oper">
            </column>
            <useparam name="date1" />
            <useparam name="date2" />
          </call>
          <call function="is not null">
            <column table="a" column="vid_t_teplo" />
          </call>
        </call>
      </where>
    </query>
    <query name="21445-opl-kred">
      <params>
        <param name="date1">
        </param>
        <param name="date2">
        </param>
      </params>
      <select>
        <column table="a" column="dep_name" group="1" />
        <const as="opl_name">'Переплата/Оплата аванса переходящая на следующий месяц'</const>
        <const as="vid_t_teplo_name">null</const>
        <column table="a" column="pol_rs_name" group="1" />
        <column table="a" column="oplf" group="sum" as="opl" />
        <const as="opl_cust">null</const>
      </select>
      <from>
        <query name="sr_opl" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="between">
            <column table="a" column="dat_opl">
            </column>
            <useparam name="date1" />
            <useparam name="date2" />
          </call>
          <call function="in">
            <column table="a" column="kod_type_opl">
            </column>
            <call function="array">
              <const>1</const>
              <const>2</const>
              <const>5</const>
              <const>6</const>
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="21445">
      <select>
        <column table="a" column="*">
        </column>
      </select>
      <from>
        <query name="21445-un" as="a" />
      </from>
    </query>
    <query name="21445-un">
      <union>
        <query name="21445-dep" />
        <query name="21445-gr" />
        <query name="21445-t" />
      </union>
    </query>
    <query name="21445-dep">
      <select>
        <const as="ord" type="number">1000</const>
        <column table="a" column="dep" group="1">
        </column>
        <const as="npp" type="string">null</const>
        <call function="||" as="name" group="1">
          <const>'Итого: '</const>
          <column table="a" column="dep_name">
          </column>
        </call>
        <usepart part="21445-columns-sum">
        </usepart>
      </select>
      <from>
        <query name="21445-main" as="a" />
      </from>
    </query>
    <query name="21445-gr">
      <select>
        <column table="a" column="gr" as="ord" group="1">
        </column>
        <column table="a" column="dep" group="1">
        </column>
        <column table="a" column="gr" as="npp" group="1">
        </column>
        <column table="a" column="gr_name" as="name" group="max">
        </column>
        <usepart part="21445-columns-sum">
        </usepart>
      </select>
      <from>
        <query name="21445-main" as="a" />
      </from>
    </query>
    <query name="21445-t">
      <select>
        <column table="a" column="vid_t_teplo" as="ord" group="1">
        </column>
        <column table="a" column="dep" group="1">
        </column>
        <const as="npp">null</const>
        <column table="a" column="vid_t_teplo_name" as="name" group="1">
        </column>
        <usepart part="21445-columns-sum">
        </usepart>
      </select>
      <from>
        <query name="21445-main" as="a" />
      </from>
    </query>
    <query name="21445-main">
      <params>
        <param name="ym">
          <const>2013.01</const>
        </param>
      </params>
      <select>
        <column table="a" column="dep">
        </column>
        <column table="a" column="dep_name">
        </column>
        <column table="a" column="vid_t_teplo">
        </column>
        <column table="a" column="vid_t_teplo_name">
        </column>
        <column table="a" column="gr">
        </column>
        <column table="a" column="gr_name">
        </column>
        <usepart part="21445-columns">
        </usepart>
      </select>
      <from>
        <query name="21445-main-1" as="a">
          <withparams>
            <call function="ym begin time">
              <useparam name="ym" />
            </call>
            <call function="ym end time">
              <useparam name="ym" />
            </call>
          </withparams>
        </query>
      </from>
      <where>
        <call function="is not null">
          <column table="a" column="dep_saldo">
          </column>
        </call>
      </where>
    </query>
    <query name="21445-main-1">
      <params>
        <param name="date1">
          <call function="ym begin time">
            <const>2013.12</const>
          </call>
        </param>
        <param name="date2">
          <call function="ym end time">
            <const>2013.12</const>
          </call>
        </param>
        <param name="cols-for-group">
          <group>
            <column column="dep" group="1" />
            <column column="vid_t_teplo" group="1" />
          </group>
        </param>
        <param name="cols-nachisl">
          <group>
          </group>
        </param>
      </params>
      <select>
        <column table="b" column="dep">
        </column>
        <column table="b" column="dep_name">
        </column>
        <column table="b" column="vid_t_teplo">
        </column>
        <column table="b" column="vid_t_teplo_name">
        </column>
        <column table="b" column="gr">
        </column>
        <column table="b" column="gr_name">
        </column>
        <call function="over" as="dep_saldo">
          <call function="sum">
            <column table="a" column="saldo_end">
            </column>
          </call>
          <call function="partition by">
            <column table="b" column="dep">
            </column>
          </call>
        </call>
        <usepart part="21445-columns">
        </usepart>
      </select>
      <from>
        <query as="b">
          <select>
            <column table="a" column="kodp" as="dep">
            </column>
            <column table="a" column="name" as="dep_name">
            </column>
            <column table="b" column="id" as="vid_t_teplo">
            </column>
            <column table="b" column="name" as="vid_t_teplo_name">
            </column>
            <column table="b" column="gr">
            </column>
            <column table="b" column="gr_name">
            </column>
          </select>
          <from>
            <query name="v_vid_t_teplo" as="b">
            </query>
            <query name="kr_org_dep" as="a" join="cross">
            </query>
          </from>
        </query>
        <query name="oborot" as="a" join="left outer">
          <withparams>
            <useparam name="date1" />
            <useparam name="date2" />
            <useparam name="cols-for-group" />
            <useparam name="cols-nachisl" />
          </withparams>
          <call function="and">
            <call function="=">
              <column table="a" column="vid_t_teplo">
              </column>
              <column table="b" column="vid_t_teplo">
              </column>
            </call>
            <call function="=">
              <column table="a" column="dep">
              </column>
              <column table="b" column="dep">
              </column>
            </call>
          </call>
        </query>
      </from>
    </query>
    <query name="21445-1 удалить?">
      <params>
        <param name="date1">
          <call function="ym begin time">
            <const>2013.12</const>
          </call>
        </param>
        <param name="date2">
          <call function="ym end time">
            <const>2013.12</const>
          </call>
        </param>
        <param name="cols-for-group">
          <group>
            <column column="dep" group="1" />
            <column column="ndog" group="1" />
            <column column="vid_t" group="1" />
          </group>
        </param>
        <param name="cols-nachisl">
          <group>
          </group>
        </param>
      </params>
      <select>
        <column table="a" column="*">
        </column>
      </select>
      <from>
        <query name="oborot" as="a">
          <withparams>
            <useparam name="date1" />
            <useparam name="date2" />
            <useparam name="cols-for-group" />
            <useparam name="cols-nachisl" />
          </withparams>
        </query>
      </from>
    </query>
  </queries>
  <parts>
    <part id="21445-columns">
      <column table="a" column="saldo_beg">
      </column>
      <column table="a" column="saldo_beg_cust">
      </column>
      <column table="a" column="nachisl">
      </column>
      <column table="a" column="cust">
      </column>
      <column table="a" column="opl">
      </column>
      <column table="a" column="opl_cust">
      </column>
      <column table="a" column="saldo_end">
      </column>
      <column table="a" column="saldo_end_cust">
      </column>
    </part>
    <part id="21445-columns-sum-1">
      <params>
        <param name="col" multiple="1">
        </param>
      </params>
      <column table=":col.table" column=":col.column" group="sum">
      </column>
    </part>
    <part id="21445-columns-sum">
      <usepart part="21445-columns-sum-1">
        <group>
          <usepart part="21445-columns">
          </usepart>
        </group>
      </usepart>
    </part>
  </parts>
</root>