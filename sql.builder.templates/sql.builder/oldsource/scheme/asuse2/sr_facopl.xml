<root>
  <queries>
    <query name="sr_facopl">
      <params>
        <param name="date">
          <const>null</const>
        </param>
      </params>
      <select>
        <column table="a" column="kod_fopl">
        </column>
        <column table="a" column="kod_ras">
        </column>
        <column table="a" column="kod_opl">
        </column>
        <column table="a" column="opl" type="number" title="Оплачено (руб.)">
        </column>
        <column table="a" column="cust" type="number" title="Оплачено (нат. пок.)">
        </column>

        <call function="case" type="number" as="cust4" title="Оплачено (квтч)">
          <call function="when">
            <call function="=">
              <column table="r" column="edizm">
              </column>
              <const>4</const>
            </call>
            <column table="a" column="cust"/>
          </call>
        </call>
        <column table="b" column="dat_opl">
        </column>
        <column table="b" column="dat_oper">
        </column>
        <column table="b" column="ym">
        </column>
        <column table="r" column="vid_real">
        </column>
        <column table="b" column="kod_dog">
        </column>
        <column table="b" column="dog_dat_fin">
        </column>
        <column table="b" column="prizn_selo_dog">
        </column>
        <column table="b" column="ndog">
        </column>
        <column table="b" column="dog_pr_active">
        </column>
        <column table="b" column="kod_vidopl">
        </column>
        <column table="b" column="dep">
        </column>
        <column table="b" column="dep_name">
        </column>
        <column table="b" column="kodbpol" />
        <column table="b" column="pol_rs">
        </column>
        <column table="b" column="pol_rs_name">
        </column>
        <column table="b" column="sf_ym">
        </column>
        <column table="b" column="date_ym">
        </column>
        <column table="b" column="kod_type_opl">
        </column>
        <column table="b" column="type_opl_name">
        </column>
        <column table="b" column="pfact_prev">
        </column>
        <column table="b" column="pfact_prev_name">
        </column>
        <column table="b" column="into_kniga">
        </column>
        <column table="b" column="into_kniga_name">
        </column>
        <column table="b" column="fk_rym">
        </column>
        <column table="b" column="vid_opl_abbr">
        </column>
        <column table="r" column="vid_t">
        </column>
        <column table="r" column="vid_t_name">
        </column>
        <column table="r" column="num_t">
        </column>
        <column table="r" column="vid_t_teplo">
        </column>
        <column table="r" column="vid_t_teplo_name">
        </column>
        <column table="r" column="vid_t_teplo_gr">
        </column>
        <column table="r" column="vid_t_teplo_gr_name">
        </column>
        <column table="r" column="rym">
        </column>
        <column table="r" column="kod_sf">
        </column>
        <column table="r" column="prizn_selo">
        </column>
        <column table="r" column="nump">
        </column>
        <column table="n" column="nal" title="Оплачено НДС">
        </column>
      </select>
      <from>
        <table name="sr_facopl" as="a">
        </table>
        <query name="sr_facopl.sr_facopl_nal" as="n" join="left outer">
          <call function="=">
            <column table="a" column="kod_fopl">
            </column>
            <column table="n" column="kod_fopl">
            </column>
          </call>
        </query>
        <query name="sr_opl" as="b" join="left outer">
          <call function="=">
            <column table="a" column="kod_opl">
            </column>
            <column table="b" column="kod_opl">
            </column>
          </call>
        </query>
        <query name="sr_facras" as="r" join="left outer">
          <call function="=">
            <column table="a" column="kod_ras">
            </column>
            <column table="r" column="kod_ras">
            </column>
          </call>
        </query>
      </from>
      <where>
        <call function="ls=">
          <column table="b" column="ym">
          </column>
          <call function="nvl">
            <call function="date to ym">
              <useparam name="date" />
            </call>
            <column table="b" column="ym">
            </column>
          </call>
        </call>
      </where>
    </query>
    <query name="sr_facopl.sr_facopl_nal">
      <select>
        <column table="a" column="kod_fopl" group="1">
        </column>
        <column table="a" column="nal" group="sum">
        </column>
      </select>
      <from>
        <table name="sr_facopl_nal" as="a">
        </table>
      </from>
    </query>
    <query name="sr_facras.sr_facopl">
      <params>
        <param name="date" />
      </params>
      <select>
        <column table="a" column="kod_ras" as="kod_ras" group="1">
        </column>
        <column table="a" column="opl" group="sum">
        </column>
        <column table="a" column="cust" group="sum">
        </column>
      </select>
      <from>
        <query name="sr_facopl" as="a">
          <withparams>
            <useparam name="date" />
          </withparams>
        </query>
      </from>
    </query>
    <query name="sr_opl.sr_facopl">
      <select>
        <column table="a" column="kod_opl" group="1">
        </column>
        <column table="a" column="opl" group="sum">
        </column>
        <column table="a" column="cust" group="sum">
        </column>
      </select>
      <from>
        <query name="sr_facopl" as="a">
        </query>
      </from>
    </query>
    <!-- <query  name="sr_facopl(date1,date2)">
      <params>
        <param name="date1">
          <call function="date to char">
            <call function="nativity"/>
          </call>
        </param>
        <param name="date2">
          <call function="date to char">
            <call function="doomsday"/>
          </call>
        </param>
      </params>
      <select>
        <column table="a" column="*"></column>
      </select>
      <from>
        <query name="sr_facopl" as="a"></query>
      </from>
      <where>
        <call function="between">
          <column table="a" column="dat_opl"></column>
          <call function="date">
            <useparam name="date1"/>
          </call>
          <call function="date">
            <useparam name="date2"/>
          </call>
        </call>
      </where>
    </query>

    <query  name="sr_facopl(date)">
      <params>
        <param name="date">
        </param>
      </params>
      <select>
        <column table="a" column="*"></column>
      </select>
      <from>
        <query name="sr_facopl" as="a"></query>
      </from>
      <where>
        <call function="ls">
          <column table="a" column="dat_opl"></column>
          <call function="date">
            <useparam name="date"/>
          </call>
        </call>
      </where>
    </query>-->
  </queries>
</root>