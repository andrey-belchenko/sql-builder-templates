<root>
  <queries>
    <query name="kr_org">
      <select>
        <column table="a" column="kodp" type="number">
        </column>
        <column table="a" column="sname">
        </column>
        <column table="a" column="name" type="string" title="Наименование">
        </column>
        <column table="a" column="kod_ecls">
        </column>
        <column table="a" column="kod_separator">
        </column>
        <column table="a" column="kod_parent">
        </column>
      </select>
      <from>
        <table name="kr_org" as="a">
        </table>
      </from>
    </query>
    <query name="kr_org_dep">
      <select>
        <column table="a" column="*">
        </column>
        <column table="b" column="lvl">
        </column>
        <column table="sfset" column="vis1">
        </column>
        <column table="sfset" column="vis2">
        </column>
        <column table="sfset" column="vis1_fio">
        </column>
        <column table="sfset" column="vis2_fio">
        </column>
        <column table="clc" column="ym">
        </column>
      </select>
      <from>
        <query name="kr_org" as="a">
        </query>
        <query name="q_kr_org_dep" as="b" join="inner">
          <call function="=">
            <column table="a" column="kodp">
            </column>
            <column table="b" column="kodp">
            </column>
          </call>
        </query>
        <query name="q_sf_set" as="sfset" join="left outer">
          <call function="=">
            <column table="a" column="kodp">
            </column>
            <column table="sfset" column="dep">
            </column>
          </call>
        </query>
        <query name="kr_calc_dep_max" as="clc" join="left outer">
          <call function="=">
            <column table="a" column="kodp">
            </column>
            <column table="clc" column="podr">
            </column>
          </call>
        </query>
      </from>
    </query>
    
    
    <query name="kr_org_dep%tbl" order="name">
      <select>
        <column table="a" column="kodp" key="1">
        </column>
        <column table="a" column="name">
        </column>
      </select>
      <from>
        <query name="kr_org_dep" as="a">
        </query>
      </from>
      <where>
        <call function="=">
          <column table="a" column="lvl">
          </column>
          <const>2</const>
        </call>
      </where>
    </query>
    <query name="q_kr_org_dep">
      <select>
        <column table="a" column="kodp">
        </column>
        <column table="a" column="lvl">
        </column>
      </select>
      <from>
        <table name="t_kr_org_dep" as="a" view="1">
        </table>
      </from>
    </query>
    
    
    <query name="q_sf_set">
      <select>
        <column table="a" column="dep" type="number">
        </column>
        <column table="a" column="vis1" type="number">
        </column>
        <column table="a" column="vis2" type="number">
        </column>
        <column table="e1" column="fio" as="vis1_fio" title="Виза 1">
        </column>
        <column table="e2" column="fio" as="vis2_fio" title="Виза 2">
        </column>
      </select>
      <from>
        <table name="t_sf_set" as="a" view="1">
        </table>
        <query name="kr_employee" as="e1" join="left outer">
          <call function="=">
            <column table="a" column="vis1">
            </column>
            <column table="e1" column="kod_emp">
            </column>
          </call>
        </query>
        <query name="kr_employee" as="e2" join="left outer">
          <call function="=">
            <column table="a" column="vis2">
            </column>
            <column table="e2" column="kod_emp">
            </column>
          </call>
        </query>
      </from>
    </query>
  </queries>
  <views>
    <view name="t_kr_org_dep">
      SELECT LEVEL lvl, kodp
      FROM kr_org a
      WHERE     kod_ecls = 4
      AND kod_separator &lt;= 2
      AND kodp IN
      (SELECT a.kodp
      FROM kr_org a, kr_org b
      WHERE     a.kod_ecls = 4
      AND kg_common.org_area (a.kodp, b.kodp) = 1
      AND b.kod_ecls = 4
      AND kg_common.user_podr_rights (1, b.kodp)  &gt; 0)
      CONNECT BY PRIOR kodp = kod_parent
      START WITH kod_parent IS NULL AND kod_ecls = 4 AND kod_separator &lt;= 2
      ORDER SIBLINGS BY kg.cut_num (name), name
    </view>
    <view name="t_sf_set">
      select a.dep,a.zn as vis1,b.zn as vis2 from

      (select v.dep,max(s.zn) zn
      from ks_sf_variant v, ks_dog_sf s
      where    kod_dog is null
      and bankpol is null
      and vid_sf is null
      and day is null
      and v.kod=s.kod
      and kod_rekv=12 group by v.dep) a,

      (select v.dep,max(s.zn) zn
      from ks_sf_variant v, ks_dog_sf s
      where    kod_dog is null
      and bankpol is null
      and vid_sf is null
      and day is null
      and v.kod=s.kod
      and kod_rekv=13 group by v.dep) b

      where a.dep=b.dep
    </view>
  </views>
</root>