<root>
  <queries>
    <query name="sr_facras">
      <params>
        <param name="date">
          <call function="doomsday">
          </call>
        </param>
      </params>
      <select>
        <column table="a" column="kod_ras" type="number">
        </column>
        <column table="a" column="rym" type="number" title="Начисление за период">
        </column>
        <call function="nvl0" as="nal" title="Начислено НДС">
          <column table="n" column="nal">
          </column>
        </call>
        <call function="-nvl" as="nach" title="Начислено без НДС (руб)">
          <column table="a" column="nachisl">
          </column>
          <column table="n" column="nal">
          </column>
        </call>
        <column table="v" column="dep">
        </column>
        <column table="v" column="dep_name">
        </column>
        <column table="v" column="kod_dog">
        </column>
        <column table="v" column="kod_dog_fin" dimension="kod_dog">
        </column>
        <column table="v" column="dat_sf">
        </column>
        <column table="v" column="dog_pr_active">
        </column>
        <column table="v" column="ndog">
        </column>
        <column table="v" column="kod_sf">
        </column>
        <column table="v" column="num_sf">
        </column>
        <column table="v" column="tep_el">
        </column>
        <column table="v" column="vid_real">
        </column>
        <column table="v" column="ym">
        </column>
        <column table="v" column="into_kniga">
        </column>
        <column table="v" column="into_kniga_name">
        </column>
        <column table="v" column="fk_rym">
        </column>
        <column table="v" column="prizn_selo_dog">
        </column>
        <column table="v" column="def_state_fname" />
        <column table="v" column="nump">
        </column>
        <column table="v" column="dog_dat_fin">
        </column>
        <column table="a" column="vid_t" type="number">
        </column>
        <column table="nch" column="name" as="vid_t_name">
        </column>
        <column table="nch" column="num_t" title="Код вида начисления">
        </column>
        <column table="nch" column="edizm">
        </column>
        <column table="nch" column="edizm_name">
        </column>
        <column table="a" column="nachisl" type="number" title="Начислено c НДС (руб)">
        </column>
        <column table="a" column="kod_numobj" type="number">
        </column>
        <column table="a" column="cust" type="number" title="Начислено (нат. пок.)">
        </column>
        <call function="nvl0" as="opl">
          <column table="o" column="opl">
          </column>
        </call>
        <call function="nvl0" as="opl_cust">
          <column table="o" column="cust">
          </column>
        </call>
        <call function="-" as="dolg">
          <column table="a" column="nachisl">
          </column>
          <call function="nvl0" as="opl">
            <column table="o" column="opl">
            </column>
          </call>
        </call>
        <call function="-" as="dolg_cust">
          <column table="a" column="cust">
          </column>
          <call function="nvl0">
            <column table="o" column="cust">
            </column>
          </call>
        </call>
        <call function="case" as="vid_t_teplo" type="number">
          <!--
        в зависимости от vid_t и отделения
        
          Тепловая энергия 1,2

          Горячее водоснабжение:
          2.1) тепловая энергия на подогрев воды 55

          2.2) холодная вода 54 - казань, нижнекамск, заинск
          2.3) теплоноситель 54 - челны , уруссу
             + теплоноситель 58 - заинск
          по коду отделения

          Теплоноситель:
          3.1) вода (ХОЧ) 11,56
          3.2) пар (ХОВ) 3,57

      102276621	Филиал ОАО "ТАТТЕПЛОСБЫТ" - Казанский
      102276623	Филиал ОАО "ТАТТЕПЛОСБЫТ" - Набережночелнинский
      102276626	Уруссинский участок Филиала ОАО "ТАТТЕПЛОСБЫТ" - Камский
      102276624	Елабужский участок Филиала ОАО "ТАТТЕПЛОСБЫТ" - Набережночелнинский
      102276625	Филиал ОАО "ТАТТЕПЛОСБЫТ" - Камский
      2572294  	Заинский участок Филиала ОАО "ТАТТЕПЛОСБЫТ" - Камский
      
      -->
          <call function="when">
            <call function="in">
              <column table="a" column="vid_t">
              </column>
              <call function="array">
                <const>1</const>
                <const>2</const>
              </call>
            </call>
            <const>1.1</const>
          </call>
          <call function="when">
            <call function="=">
              <column table="a" column="vid_t">
              </column>
              <const>55</const>
            </call>
            <const>2.1</const>
          </call>
          <call function="when">
            <call function="=">
              <column table="a" column="vid_t">
              </column>
              <const>54</const>
            </call>
            <call function="case">
              <call function="when">
                <call function="in">
                  <column table="v" column="dep">
                  </column>
                  <call function="array">
                    <const>102276621</const>
                    <const>102276625</const>
                    <const>2572294</const>
                  </call>
                </call>
                <const>2.2</const>
              </call>
              <call function="else">
                <const>2.3</const>
              </call>
            </call>
          </call>
          <call function="when">
            <call function="and">
              <call function="=">
                <column table="v" column="dep">
                </column>
                <const>2572294</const>
              </call>
              <call function="=">
                <column table="a" column="vid_t">
                </column>
                <const>58</const>
              </call>
            </call>
            <const>2.3</const>
          </call>
          <call function="when">
            <call function="in">
              <column table="a" column="vid_t">
              </column>
              <call function="array">
                <const>11</const>
                <const>56</const>
              </call>
            </call>
            <const>3.1</const>
          </call>
          <call function="when">
            <call function="in">
              <column table="a" column="vid_t">
              </column>
              <call function="array">
                <const>3</const>
                <const>57</const>
              </call>
            </call>
            <const>3.2</const>
          </call>
          <call function="else">
            <column table="a" column="vid_t">
            </column>
          </call>
        </call>
        <column table="ao" column="pr_usl">
        </column>
        <usepart part="pr_nasel" as="pr_nasel" />
        <column table="ao" column="pr_2rate">
        </column>
        <usepart part="pr_2rate_name" as="pr_2rate_name" />
        <usepart part="f46_razdel" as="f46_razdel" />
        <column table="r46" column="name" as="f46_razdel_name">
        </column>
        <usepart part="f46_podrazdel" as="f46_podrazdel" />
        <column table="p46" column="name" as="f46_podrazdel_name">
        </column>
        <column table="ao" column="pr_zon">
        </column>
        <column table="ftx" column="voltage">
        </column>
        <column table="ftx" column="voltage_abbr">
        </column>
        <column table="ftx" column="kodinterval">
        </column>
        <column table="ftx" column="interval_abbr">
        </column>
        <column table="ftx" column="interval_name">
        </column>
        <column table="ftx" column="zone">
        </column>
        <column table="ftx" column="kod_f46">
        </column>
        <column table="ftx" column="f46_npp">
        </column>
        <column table="ftx" column="f46_name">
        </column>
        <column table="ftx" column="category"/>
        <column table="ftx" column="category_name"/>
        <column table="t" column="prizn_selo">
        </column>
        <column table="vidtt" column="name" as="vid_t_teplo_name" title="Наименование товара">
        </column>
        <column table="vidtt" column="gr" as="vid_t_teplo_gr">
        </column>
        <column table="vidtt" column="gr_name" as="vid_t_teplo_gr_name" title="Вид товара">
        </column>
        <column table="obj" column="num_obj">
        </column>
        <column table="obj" column="name" as="obj_name">
        </column>
        <column table="obj" column="adr_m_name" as="obj_adr_m_name">
        </column>
        <column table="obj" column="obj_kod_m">
        </column>
        <column table="a" column="tarif">
        </column>
      </select>
      <from>
        <table name="sr_facras" as="a">
        </table>
        <query name="sr_facvip" as="v" join="left outer">
          <call function="=">
            <column table="a" column="kod_sf">
            </column>
            <column table="v" column="kod_sf">
            </column>
          </call>
        </query>
        <query name="sr_facras_text" as="ftx" join="left outer">
          <call function="=">
            <column table="a" column="kod_ras">
            </column>
            <column table="ftx" column="kod_ras">
            </column>
          </call>
        </query>
        <query name="nr_account_obj" as="ao" join="left outer">
          <call function="and">
            <call function="=">
              <column table="a" column="kod_numobj">
              </column>
              <column table="ao" column="kod_numobj">
              </column>
            </call>
            <call function="=">
              <column table="v" column="ym">
              </column>
              <column table="ao" column="ym">
              </column>
            </call>
          </call>
        </query>
        <query name="kr_numobj" as="obj" join="left outer">
          <call function="=">
            <column table="a" column="kod_numobj">
            </column>
            <column table="obj" column="kod_numobj">
            </column>
          </call>
        </query>
        <query name="sk_nachisl" as="nch" join="left outer">
          <call function="=">
            <column table="a" column="vid_t">
            </column>
            <column table="nch" column="vid_t">
            </column>
          </call>
        </query>
        <query name="sr_facras.sr_facras_nal" as="n" join="left outer">
          <call function="=">
            <column table="a" column="kod_ras">
            </column>
            <column table="n" column="kod_ras">
            </column>
          </call>
        </query>
        <query name="sr_facras.sr_facopl" as="o" join="left outer">
          <withparams>
            <useparam name="date" />
          </withparams>
          <call function="=">
            <column table="a" column="kod_ras">
            </column>
            <column table="o" column="kod_ras">
            </column>
          </call>
        </query>
        <query name="f46_podrazdel" as="p46" join="left outer">
          <call function="=">
            <usepart part="f46_podrazdel" as="f46_podrazdel" />
            <column table="p46" column="id">
            </column>
          </call>
        </query>
        <query name="f46_razdel" as="r46" join="left outer">
          <call function="=">
            <usepart part="f46_razdel" as="f46_razdel" />
            <column table="r46" column="id">
            </column>
          </call>
        </query>
        <query name="ks_tarif" as="t" join="left outer">
          <call function="=">
            <column table="a" column="tarif">
            </column>
            <column table="t" column="tarif">
            </column>
          </call>
        </query>
        <query name="v_vid_t_teplo" as="vidtt" join="left outer">
          <call function="=">
            <column table="this" column="vid_t_teplo">
            </column>
            <column table="vidtt" column="id">
            </column>
          </call>
        </query>
      </from>
      <where>
        <call function="is not null">
          <column table="v" column="vid_real">
          </column>
        </call>
      </where>
    </query>
    <query name="sr_facras.sr_facras_nal">
      <select>
        <column table="n" column="kod_ras" as="kod_ras" group="1">
        </column>
        <column table="n" column="nal" group="sum">
        </column>
      </select>
      <from>
        <table name="sr_facras_nal" as="n">
        </table>
        <query name="sr_facras" as="kod_ras" join="left outer">
          <call function="=">
            <column table="n" column="kod_ras">
            </column>
            <column table="kod_ras" column="kod_ras">
            </column>
          </call>
        </query>
      </from>
    </query>
    <!--<query  name="sr_facras.sr_facopl(date)">
      <params>
        <param name="date"/>
      </params>
      <select>
        <column table="a" column="kod_ras" as="kod_ras" group="1"></column>
        <column table="a" column="opl" group="sum"></column>
        <column table="a" column="cust" group="sum"></column>
      </select>
      <from>
        <query name="sr_facopl(date)" as="a">
          <withparams>
            <useparam name="date"/>
          </withparams>
        </query>
      </from>
    </query>-->
    <query name="v_vid_t_teplo">
      <select>
        <column table="b" column="name" as="gr_name">
        </column>
        <column table="a" column="*">
        </column>
      </select>
      <from>
        <query name="v_vid_t_teplo_un" as="a">
        </query>
        <query name="v_vid_t_gr_teplo" as="b" join="inner">
          <call function="=">
            <column table="a" column="gr">
            </column>
            <column table="b" column="id">
            </column>
          </call>
        </query>
      </from>
    </query>
    <query name="v_vid_t_gr_teplo">
      <select>
        <column table="a" column="*">
        </column>
      </select>
      <from>
        <query name="v_vid_t_gr_teplo_un" as="a">
        </query>
      </from>
    </query>
    <query name="v_vid_t_gr_teplo_un">
      <union>
        <query name="v_vid_t_teplo[1]">
        </query>
        <query name="v_vid_t_teplo[2]">
        </query>
        <query name="v_vid_t_teplo[3]">
        </query>
      </union>
    </query>
    <query name="v_vid_t_teplo[1]">
      <select>
        <const as="id" type="number">1</const>
        <const as="name" type="string">'1 Тепловая энергия'</const>
      </select>
      <from>
        <table name="dual" as="a">
        </table>
      </from>
    </query>
    <query name="v_vid_t_teplo[2]">
      <select>
        <const as="id">2</const>
        <const as="name">'2 Горячее водоснабжение'</const>
      </select>
      <from>
        <table name="dual" as="a">
        </table>
      </from>
    </query>
    <query name="v_vid_t_teplo[3]">
      <select>
        <const as="id">3</const>
        <const as="name">'3 Теплоноситель'</const>
      </select>
      <from>
        <table name="dual" as="a">
        </table>
      </from>
    </query>
    <query name="v_vid_t_teplo_un">
      <union>
        <query name="v_vid_t_teplo[1.1]">
        </query>
        <query name="v_vid_t_teplo[2.1]">
        </query>
        <query name="v_vid_t_teplo[2.2]">
        </query>
        <query name="v_vid_t_teplo[2.3]">
        </query>
        <query name="v_vid_t_teplo[3.1]">
        </query>
        <query name="v_vid_t_teplo[3.2]">
        </query>
      </union>
    </query>
    <query name="v_vid_t_teplo[1.1]">
      <select>
        <const as="id" type="number">1.1</const>
        <const as="gr" type="number">1</const>
        <const as="name" type="string">'1.1 тепловая энергия'</const>
      </select>
      <from>
        <table name="dual" as="a">
        </table>
      </from>
    </query>
    <query name="v_vid_t_teplo[2.1]">
      <select>
        <const as="id">2.1</const>
        <const as="gr">2</const>
        <const as="name">'2.1 тепловая энергия на подогрев воды'</const>
      </select>
      <from>
        <table name="dual" as="a">
        </table>
      </from>
    </query>
    <query name="v_vid_t_teplo[2.2]">
      <select>
        <const as="id">2.2</const>
        <const as="gr">2</const>
        <const as="name">'2.2 холодная вода'</const>
      </select>
      <from>
        <table name="dual" as="a">
        </table>
      </from>
    </query>
    <query name="v_vid_t_teplo[2.3]">
      <select>
        <const as="id">2.3</const>
        <const as="gr">2</const>
        <const as="name">'2.3 теплоноситель'</const>
      </select>
      <from>
        <table name="dual" as="a">
        </table>
      </from>
    </query>
    <query name="v_vid_t_teplo[3.1]">
      <select>
        <const as="id">3.1</const>
        <const as="gr">3</const>
        <const as="name">'3.1 вода (ХОЧ)'</const>
      </select>
      <from>
        <table name="dual" as="a">
        </table>
      </from>
    </query>
    <query name="v_vid_t_teplo[3.2]">
      <select>
        <const as="id">3.2</const>
        <const as="gr">3</const>
        <const as="name">'3.2 пар (ХОВ)'</const>
      </select>
      <from>
        <table name="dual" as="a">
        </table>
      </from>
    </query>
    <query name="temp_pr_selo_facras">
      <select>
        <column table="a" column="kod_ras">
        </column>
        <column table="a" column="prizn_selo">
        </column>
      </select>
      <from>
        <query name="sr_facras" as="a">
        </query>
      </from>
      <where>
        <call function="=">
          <column table="a" column="kod_ras">
          </column>
          <const>p_kod_ras</const>
        </call>
      </where>
    </query>
  </queries>
  <parts>
  </parts>
</root>