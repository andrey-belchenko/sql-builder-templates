<root>
  <queries>
    <query name="kr_numobj">
      <params>
        <param name="date">
          <const>sysdate</const>
        </param>
      </params>
      <select>
        <column table="a" column="kod_numobj" type="number">
        </column>
        <column table="a" column="kod_dog" type="number">
        </column>
        <column table="a" column="dat_create" type="date">
        </column>
        <column table="a" column="dat_fin" type="date">
        </column>
        <column table="a" column="num_obj" type="number" title="Номер объекта">
        </column>
        <column table="a" column="name" type="string" title="Наименование объекта">
        </column>
        <call function="nvl" as="tarif_main">
          <column table="p" column="tarif2">
          </column>
          <column table="a" column="tarif">
          </column>
        </call>
        <column table="a" column="tarif" type="number">
        </column>
        <column table="p" column="tarif2">
        </column>
        <column table="p" column="tarif16">
        </column>
        <column table="t" column="prizn_selo">
        </column>
        <column table="dog" column="dat_dog">
        </column>
        <column table="dog" column="ndog">
        </column>
        <column table="dog" column="kodp">
        </column>
        <column table="dog" column="dep">
        </column>
        <column table="dog" column="dep_name">
        </column>
        <column table="dog" column="payer_name">
        </column>
        <column table="obj" column="adr_m_name">
        </column>
        <column table="obj" column="kod_m">
        </column>
        <column table="obj" column="adr">
        </column>
        <column table="t_obj" column="name" as="obj_tar_name"/>
      </select>
      <from>
        <table name="kr_numobj" as="a">
        </table>
        <query as="p" join="left outer">
          <select>
            <column table="pl" column="*">
            </column>
          </select>
          <from>
            <query name="kr_plan" as="pl" />
          </from>
          <where>
            <usepart part="between-nvl">
              <call function="date to ym">
                <useparam name="date" />
              </call>
              <column table="pl" column="ym_s">
              </column>
              <column table="pl" column="ym_po">
              </column>
            </usepart>
          </where>
          <call function="=">
            <column table="a" column="kod_numobj">
            </column>
            <column table="p" column="kod_numobj">
            </column>
          </call>
        </query>
        <!-- тариф на услуги по передаче из плана, если отсутствует от с объекта-->
        <query name="ks_tarif" as="t" join="left outer">
          <call function="=">
            <call function="nvl">
              <column table="p" column="tarif2">
              </column>
              <column table="a" column="tarif">
              </column>
            </call>
            <column table="t" column="tarif">
            </column>
          </call>
        </query>
        <!-- просто тариф с объекта-->
        <query name="ks_tarif" as="t_obj" join="left outer">
          <call function="=">
            <column table="a" column="tarif">
            </column>
            <column table="t_obj" column="tarif">
            </column>
          </call>
        </query>
        <query name="kr_dogovor" as="dog" join="left outer">
          <call function="=">
            <column table="a" column="kod_dog">
            </column>
            <column table="dog" column="kod_dog">
            </column>
          </call>
        </query>
        <query name="kr_object" as="obj" join="left outer">
          <call function="=">
            <column table="a" column="kod_obj">
            </column>
            <column table="obj" column="kod_obj">
            </column>
          </call>
        </query>
      </from>
      <!--<where>
        <usepart part="between-nvl">
          <useparam name="date" />
          <column table="a" column="dat_create">
          </column>
          <column table="a" column="dat_fin">
          </column>
        </usepart>
      </where>-->
    
    </query>
    <query name="kr_dogovor.kr_numobj">
      <params>
        <param name="date">
          <const>sysdate</const>
        </param>
      </params>
      <select>
        <column table="a" column="kod_dog" group="1">
        </column>
        <column table="a" column="prizn_selo" group="max">
        </column>
        <column table="a" column="dat_create" group="max">
        </column>
        <column table="a" column="dat_fin" group="min">
        </column>
      </select>
      <from>
        <query name="kr_numobj" as="a">
          <withparams>
            <useparam name="date" />
          </withparams>
        </query>
      </from>
    </query>
    
    
    <query name="temp_pr_selo_obj">
      <select>
        <column table="a" column="kod_numobj">
        </column>
        <column table="a" column="prizn_selo">
        </column>
      </select>
      <from>
        <query name="kr_numobj" as="a">
          <withparams>
            <call function="ym begin time">
              <const>2012.01</const>
            </call>
          </withparams>
        </query>
      </from>
      <where>
        <call function="=">
          <column table="a" column="kod_numobj">
          </column>
          <const>p_kod_numobj</const>
        </call>
      </where>
    </query>
  </queries>
</root>