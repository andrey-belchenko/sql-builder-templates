<root>
  <queries>
    <query name="ks_tarif">
      <select>
        <column table="a" column="tarif" type="number">
        </column>
        <column table="a" column="tarif_parent">
        </column>
        <column table="a" column="npp" type="number" title="Код тарифа">
        </column>
        <column table="a" column="name" type="string" title="Наименование тарифа(тарифной группы)">
        </column>
        <column table="a" column="prizn_selo" type="number" title="Обл/Гор">
        </column>
        <column table="a" column="voltage">
        </column>
        <column table="tr" column="tarif" as="tarif_root">
        </column>
        <column table="tr" column="npp" as="root_npp">
        </column>
        <column table="tr" column="name" as="root_name">
        </column>
      </select>
      <from>
        <table name="ks_tarif" as="a">
        </table>
        <query name="tarif_root" as="tr" join="left outer">
          <call function="=">
            <column table="a" column="tarif">
            </column>
            <column table="tr" column="tarif_child">
            </column>
          </call>
        </query>
      </from>
    </query>
    
    <query name="tarif_root">
      <select>
        <column table="a" column="tarif" as="tarif_child" type="number">
        </column>
        <column table="t" column="*">
        </column>
      </select>
      <from>
        <query name="tarif_root1" view="1" as="a"/>
        <query name="ks_tarif" as="t" join="left outer">
          <call function="=">
            <column table="a" column="tarif_root">
            </column>
            <column table="t" column="tarif">
            </column>
          </call>
        </query>
      </from>
    </query>
    
    <!--tarif_root сделано для 10653(40), не пригодилось-->
    <query name="tarif_root1" materialize="1">
      <select>
        <column table="a" column="tarif" type="number">
        </column>
        <column table="a" column="tarif_root" type="number">
        </column>
      </select>
      <from>
        <table name="tarif_root" view="1" as="a" type="number">
        </table>
       
      </from>
    </query>
    
  </queries>
  <views>
    <view name="tarif_root">
      select
      tarif,
      (select max(tarif)  keep(dense_rank last order by level) from ks_tarif a   start with a.tarif=b.tarif connect by prior a.tarif_parent=a.tarif) as tarif_root
      from ks_tarif b
    </view>
  </views>
</root>