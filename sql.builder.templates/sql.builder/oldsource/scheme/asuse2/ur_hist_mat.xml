<root>
  <queries>
    <query name="ur_hist_mat">
      <select>
        <column table="a" column="kod_hist_mat" type="number">
        </column>
        <column table="a" column="kod_mat" type="number">
        </column>
        <column table="a" column="dat_post" type="date">
        </column>
        <column table="mat" column="nachisl">
        </column>
        <column table="mat" column="kod_izv">
        </column>
        <column table="mat" column="nump">
        </column>
        <column table="opl" column="opl">
        </column>
      </select>
      <from>
        <table name="ur_hist_mat" as="a">
        </table>
        <query name="ur_mat" as="mat" join="left outer">
          <call function="=">
            <column table="a" column="kod_mat">
            </column>
            <column table="mat" column="kod_mat">
            </column>
          </call>
        </query>
        <query name="ur_hist_mat.tsr_opl" as="opl" join="left outer">
          <call function="=">
            <column table="a" column="kod_mat">
            </column>
            <column table="opl" column="kod_mat">
            </column>
          </call>
        </query>
      </from>
    </query>
    <query name="ur_hist_mat.tsr_opl">
      <!-- оплаты на дату решения-->
      <select>
        <!-- <column table="a" column="nump" group="max"></column>
        <column table="opl" column="dat_opl" group="max"></column> -->
        <column table="a" column="kod_mat" group="1">
        </column>
        <column table="opl" column="opl" group="sum">
        </column>
      </select>
      <from>
        <query name="ur_hist_mat" as="a">
        </query>
        <query name="ur_dogplat" as="dp" join="left outer">
          <call function="=">
            <column table="a" column="kod_mat">
            </column>
            <column table="dp" column="kod_mat">
            </column>
          </call>
        </query>
        <query name="tsr_opl" as="opl" join="left outer">
          <call function="=">
            <column table="dp" column="kod_izv">
            </column>
            <column table="opl" column="kod_izv">
            </column>
          </call>
        </query>
      </from>
      <where>
        <call function="ls=">
          <column table="opl" column="dat_opl">
          </column>
          <column table="a" column="dat_post">
          </column>
        </call>
      </where>
    </query>
  </queries>
</root>