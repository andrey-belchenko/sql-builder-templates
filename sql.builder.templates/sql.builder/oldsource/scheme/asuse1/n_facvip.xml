<root>
  <queries>
    <query name="n_facvip">
      <params>
        <param name="date">
        </param>
        <param name="kodp_cond">
        </param>
      </params>
      <select>
        <column table="a" column="kod_sf" type="number">
        </column>
        <column table="a" column="kod_deb" type="number">
        </column>
        <column table="a" column="vid_real" type="number">
        </column>
        <column table="a" column="kodp" type="string">
        </column>
        <column table="a" column="num_sf" type="string">
        </column>
        <column table="a" column="dat_sf" type="date">
        </column>
        <call function="||" as="name">
          <const>'№ '</const>
          <column table="a" column="num_sf" />
          <const>' от '</const>
          <call function="date to char">
            <column table="a" column="dat_sf" />
          </call>
        </call>
        <column table="a" column="dat_bzad" type="date">
        </column>
        <call function="+" as="ym" type="number">
          <column table="a" column="god" />
          <call function="/">
            <column table="a" column="mes" />
            <const>100</const>
          </call>
        </call>
        <call function="nvl" as="dat_bzad_nvl" type="date">
          <column table="a" column="dat_bzad">
          </column>
          <column table="a" column="dat_sf">
          </column>
        </call>
        <column table="ras" column="codeabon">
        </column>
        <column table="ras" column="summa">
        </column>
        <column table="ras" column="rym">
        </column>
        <column table="opl" column="oplf">
        </column>
        <call function="-nvl" as="dolg" type="number">
          <column table="ras" column="summa">
          </column>
          <column table="opl" column="opl">
          </column>
        </call>
        <call function="nvl" as="deb_dolg" type="number">
          <column table="deb" column="dolg">
          </column>
          <column table="this" column="dolg">
          </column>
        </call>
        <call function="nvl" as="dat_deb_nvl" type="date">
          <column table="deb" column="dat_deb">
          </column>
          <column table="a" column="dat_sf">
          </column>
        </call>
        <column table="deb" column="dat_deb">
        </column>
        <column table="deb" column="dat_spis">
        </column>
        <!-- дата окончания действия аванса для ОСЭ по заявке 20118(10) -->
        <column table="ym_dat_deb" column="dat_deb_nvl" as="dat_deb_osn">
        </column>
        <column table="p" column="dat_udal">
        </column>
      </select>
      <from>
        <table name="n_facvip" as="a">
        </table>
        <query name="n_facvip.n_facras" as="ras" join="left outer">
          <withparams>
            <useparam name="date">
            </useparam>
            <useparam name="kodp_cond">
            </useparam>
          </withparams>
          <call function="=">
            <column table="a" column="kod_sf">
            </column>
            <column table="ras" column="kod_sf">
            </column>
          </call>
        </query>
        <query name="n_facvip.n_opl" as="opl" join="left outer">
          <withparams>
            <useparam name="date">
            </useparam>
            <useparam name="kodp_cond">
            </useparam>
          </withparams>
          <call function="=">
            <column table="a" column="kod_sf">
            </column>
            <column table="opl" column="kod_sf">
            </column>
          </call>
        </query>
        <query name="n_debet" as="deb" join="left outer">
          <withparams>
            <useparam name="date">
            </useparam>
            <useparam name="kodp_cond">
            </useparam>
          </withparams>
          <call function="=">
            <column table="a" column="kod_deb">
            </column>
            <column table="deb" column="kod_deb">
            </column>
          </call>
        </query>
        <query name="n_ym_dat_deb" as="ym_dat_deb" join="left outer">
          <withparams>
            <useparam name="date">
            </useparam>
            <useparam name="kodp_cond">
            </useparam>
          </withparams>
          <call function="and">
            <call function="=">
              <column table="a" column="kodp">
              </column>
              <column table="ym_dat_deb" column="kodp">
              </column>
            </call>
            <call function="=">
              <column table="this" column="rym">
              </column>
              <column table="ym_dat_deb" column="ym">
              </column>
            </call>
          </call>
        </query>
        <query name="n_payer" as="p" join="left outer">
          <call function="=">
            <column table="a" column="kodp">
            </column>
            <column table="p" column="kodp">
            </column>
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <usepart part="ext-cond">
            <const>a</const>
            <useparam name="kodp_cond">
            </useparam>
          </usepart>
        </call>
      </where>
    </query>
    <query name="n_facvip.n_facras">
      <params>
        <param name="date">
        </param>
        <param name="kodp_cond">
        </param>
      </params>
      <select>
        <column table="a" column="kod_sf" group="1">
        </column>
        <column table="a" column="codeabon" group="max">
        </column>
        <column table="a" column="rym" group="max">
        </column>
        <column table="a" column="summa" group="sum" />
      </select>
      <from>
        <query name="n_facras" as="a">
          <withparams>
            <useparam name="date">
            </useparam>
            <useparam name="kodp_cond">
            </useparam>
          </withparams>
        </query>
      </from>
    </query>
    <query name="n_debet.n_facvip">
      <params>
        <param name="date">
        </param>
        <param name="kodp_cond">
        </param>
      </params>
      <param name="date">
        <const>sysdate</const>
      </param>
      <select>
        <column table="a" column="kod_deb" group="1">
        </column>
        <column table="a" column="dolg" group="sum">
        </column>
      </select>
      <from>
        <query name="n_facvip" as="a">
          <withparams>
            <useparam name="date">
            </useparam>
            <useparam name="kodp_cond">
            </useparam>
          </withparams>
        </query>
      </from>
    </query>
    <query name="n_ym_dat_deb">
      <params>
        <param name="date">
        </param>
        <param name="kodp_cond">
        </param>
      </params>
      <select>
        <column table="a" column="ym" group="1">
        </column>
        <column table="a" column="kodp" group="1">
        </column>
        <column table="a" column="dat_deb_nvl" group="max">
        </column>
      </select>
      <from>
        <query name="n_facvip" as="a">
          <withparams>
            <useparam name="date">
            </useparam>
            <useparam name="kodp_cond">
            </useparam>
          </withparams>
        </query>
      </from>
      <where>
        <call function="=">
          <column table="a" column="vid_real">
          </column>
          <const>2</const>
        </call>
      </where>
    </query>
  </queries>
</root>