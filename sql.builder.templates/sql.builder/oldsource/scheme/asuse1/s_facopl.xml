<root>
  <queries>
    <query name="s_facopl">
      <params>
        <param name="date">
        </param>
        <param name="kodp_cond">
        </param>
      </params>
      <select>
        <column table="a" column="kod_fopl" type="number">
        </column>
        <column table="a" column="kod_ras" type="number">
        </column>
        <column table="a" column="opl" type="number" title="Оплачено (руб)">
        </column>
        <column table="a" column="nal" type="number">
        </column>
        <call function="+nvl" as="oplf">
          <column table="a" column="opl">
          </column>
          <column table="a" column="nal">
          </column>
        </call>
        <column table="fr" column="kod_sf" />
        <column table="opl" column="kodp" />
        <column table="fr" column="vid_real">
        </column>
        <column table="fr" column="vid_real_pl">
        </column>
        <column table="opl" column="datao">
        </column>
        <column table="opl" column="kod_type_opl" />
        <column table="opl" column="ym" />
        <column table="opl" column="date_ym" />
        <column table="opl" column="kod_ist">
        </column>
        <column table="opl" column="kod_otrasl">
        </column>
        <column table="opl" column="payer_name">
        </column>
        <column table="opl" column="ist_fin_name">
        </column>
        <column table="opl" column="otrasl_fname">
        </column>
        <column table="opl" column="voda_par">
        </column>
        <column table="opl" column="inn">
        </column>
        <column table="opl" column="voda_par_name">
        </column>
      </select>
      <from>
        <table name="s_facopl" as="a">
        </table>
        <query name="s_facras" as="fr" join="left outer">
          <withparams>
            <useparam name="date">
            </useparam>
            <useparam name="kodp_cond">
            </useparam>
          </withparams>
          <call function="=">
            <column table="a" column="kod_ras">
            </column>
            <column table="fr" column="kod_ras">
            </column>
          </call>
        </query>
        <query name="s_opl" as="opl" join="left outer">
          <withparams>
            <useparam name="date">
            </useparam>
            <useparam name="kodp_cond">
            </useparam>
          </withparams>
          <call function="=">
            <column table="a" column="kod_opl">
            </column>
            <column table="opl" column="kod_opl">
            </column>
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <const>1</const>
            <const>1</const>
          </call>
          <usepart part="ext-cond">
            <const>opl</const>
            <useparam name="kodp_cond">
            </useparam>
          </usepart>
        </call>
      </where>
    </query>
    <query name="s_facras.s_facopl">
      <params>
        <param name="date">
        </param>
        <param name="kodp_cond">
        </param>
      </params>
      <select>
        <column table="a" column="kod_ras" group="1" />
        <column table="a" column="oplf" group="sum" />
        <column table="a" column="datao" group="max" />
        <column table="a" column="ym" group="max" />
      </select>
      <from>
        <query name="s_facopl" as="a">
          <withparams>
            <useparam name="date">
            </useparam>
            <useparam name="kodp_cond">
            </useparam>
          </withparams>
        </query>
      </from>
      <where>
        <call function="ls=">
          <column table="this" column="ym" />
          <call function="date to ym">
            <useparam name="date">
            </useparam>
          </call>
        </call>
      </where>
    </query>
  </queries>
</root>