<?xml version="1.0" encoding="utf-8"?>
<root timestamp="2025-06-29T01:41:11.2178265+03:00">
  <customers child-name="customer" key-name="id" />
  <queries child-name="query" key-name="name">
    <query name="55300-dat_to_ym" timestamp="16.07.2021 18:23:05" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <params>
        <param name="p_dat" type="date" />
      </params>
      <select>
        <call function="ym add month" as="ym">
          <call function="date to ym">
            <useparam name="p_dat" />
          </call>
          <const>-1</const>
        </call>
      </select>
      <from>
        <query name="dual" />
      </from>
    </query>
    <query name="55300-dog_pre" timestamp="16.07.2021 18:23:28" use-repository="1" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <expressions>
        <call function="if" group="sum" title="Оплата на 01.__.20__г." as="opl_per">
          <call function="lt">
            <column table="dat" column="val" />
            <call function="ym begin time">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
          </call>
          <fact column="sr_opl_opl_sf" />
        </call>
        <call function="if" group="sum" title="Оплата на дату отчета" as="opl_dat">
          <call function="lt">
            <column table="dat" column="val" />
            <useparam name="p_dat" />
          </call>
          <fact column="sr_opl_opl_sf" />
        </call>
        <call function="if" group="sum" as="nachisl_ym">
          <call function="and">
            <call function="le">
              <column table="dat" column="val" />
              <call function="ym end time">
                <useparam name="p_ym" />
              </call>
            </call>
            <call function="ge">
              <column table="dat" column="val" />
              <call function="ym begin time">
                <useparam name="p_ym" />
              </call>
            </call>
          </call>
          <fact column="sr_facras_nachisl" />
        </call>
        <call function="if" group="sum" as="opl_ym">
          <call function="and">
            <call function="le">
              <column table="dat" column="val" />
              <call function="ym end time">
                <useparam name="p_ym" />
              </call>
            </call>
            <call function="ge">
              <column table="dat" column="val" />
              <call function="ym begin time">
                <useparam name="p_ym" />
              </call>
            </call>
          </call>
          <fact column="sr_opl_opl_sf" />
        </call>
      </expressions>
      <params>
        <usepart part="55300-params" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" />
        <column table="kod_gr_potr_dog" column="name" as="gr_name" exclude="1" />
        <call function="ym begin time" as="dd" exclude="1">
          <call function="date to ym">
            <useparam name="p_dat" />
          </call>
        </call>
        <column table="kod_group_cust_parent" column="name" as="gr_potr" />
        <!--<column table="kod_sf" column="kod_sf" group="max"/>
        <column table="kod_opl" column="kod_opl" group="max"/>-->
        <!--<column table="kod_sf" column="kod_sf" group="1" />
        <column table="kod_sf" column="vid_real" group="1" />
        <column table="kod_sf" column="name" group="1" />-->
        <fact title="Сверхнормативная задолженность(деб) на дату" as="sverh_dolg_dat" column="fin_ul_sverh_dolg_deb_ng">
          <withparams>
            <useparam name="p_dat" />
            <call function="ym begin time" exclude="1">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
          </withparams>
        </fact>
        <fact title="Сверхнормативная задолженность(деб) на 1 число" as="sverh_dolg_per" column="fin_ul_sverh_dolg_deb_ng">
          <withparams>
            <call function="ym begin time">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
          </withparams>
        </fact>
        <call function="-" as="opl_cur_month" title="Оплата в текущем месяце" exclude="1">
          <call function="nvl0">
            <fact column="opl_dat" />
          </call>
          <call function="nvl0">
            <fact column="opl_per" />
          </call>
        </call>
        <fact column="opl_ym" as="opl_cur_month" exclude="1" />
        <fact column="sr_opl_opl_real" as="opl_cur_month" table="opl">
          <if>
            <call function="between">
              <column table="kod_opl" column="dat_opl" />
              <call function="ym begin time">
                <call function="date to ym">
                  <useparam name="p_dat" />
                </call>
              </call>
              <useparam name="p_dat" />
            </call>
          </if>
        </fact>
        <!--<fact table="opl" column="kod_ur_state" group="1"/>
        <column table="ur_state" column="name" group="1"/>
        <column table="kod_sf" column="kod_sf" group="1"/>-->
      </select>
      <from>
        <qube>
          <!--<link name="ym" />-->
          <link name="kod_dog" all-rows="1">
            <link name="kod_gr_potr_dog" exclude="1" />
            <link name="kod_dog_dop">
              <link name="kod_group_cust">
                <link name="kod_group_cust_parent" />
              </link>
            </link>
          </link>
          <dimset as="opl">
            <link name="kod_opl" />
          </dimset>
          <where>
            <call function="and">
              <call function="true" />
              <call function="=" optional="1">
                <column table="kod_dog" column="kod_dog" />
                <useparam name="p_kod_dog" />
              </call>
            </call>
          </where>
        </qube>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
          <call function="!=">
            <column table="kod_dog" column="pr_active" />
            <const>1</const>
          </call>
          <call function="=" exclude="1">
            <column table="kod_dog" column="kod_dog" />
            <const name="p_dep">50010261</const>
          </call>
          <call function="gt" exclude="1">
            <column table="this" column="sverh_dolg_dat" />
            <const>0</const>
          </call>
          <call function="or" exclude="1">
            <call function="!=">
              <column table="kod_dog" column="pr_active" />
              <const>1</const>
            </call>
            <call function="!=0">
              <fact column="nachisl_ym" />
            </call>
            <call function="!=0">
              <fact column="opl_ym" />
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="55300-data_pre" materialize="1" timestamp="15.05.2024 15:02:41" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <expressions>
        <call function="if" group="sum" as="dolg_deb_per" title="Дебиторская задолженность на 01.__.20__г.">
          <call function="lt">
            <column table="dat" column="val" />
            <call function="ym begin time">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
          </call>
          <fact column="fin_ul_ob_osn" />
        </call>
        <call function="if" group="sum" as="dolg_deb_dat" title="Дебиторская задолженность на дату отчета">
          <call function="lt">
            <column table="dat" column="val" />
            <useparam name="p_dat" />
          </call>
          <fact column="fin_ul_ob_osn" />
        </call>
        <call function="if" as="dolg_graf_per" group="sum" type="number" title="Задолженность включенная в ГПЗ  на 01.__.20__г.">
          <call function="lt">
            <column table="dat" column="val" />
            <call function="ym begin time">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
          </call>
          <fact column="fin_ul_ob" />
        </call>
        <call function="if" group="sum" title="Оплата на 01.__.20__г." as="opl_per">
          <call function="lt">
            <column table="dat" column="val" />
            <call function="ym begin time">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
          </call>
          <fact column="sr_opl_opl_sf" />
        </call>
        <call function="if" group="sum" title="Оплата на дату отчета" as="opl_dat">
          <call function="lt">
            <column table="dat" column="val" />
            <useparam name="p_dat" />
          </call>
          <fact column="sr_opl_opl_sf" />
        </call>
        <call function="if" group="sum" as="dolg_deb_peny_dat" title="Задолженность по пени">
          <call function="lt">
            <column table="dat" column="val" />
            <useparam name="p_dat" />
          </call>
          <fact column="fin_ul_ob_peni" />
        </call>
        <call function="if" group="sum" as="dolg_deb_gp_dat" title="Задолженность по госпошлине">
          <call function="lt">
            <column table="dat" column="val" />
            <useparam name="p_dat" />
          </call>
          <fact column="fin_ul_ob_gp" />
        </call>
        <call function="if" group="sum" as="dolg_deb_astr_dat" title="Задолженность по астренту" exclude="1">
          <call function="lt">
            <column table="dat_ur" column="val" />
            <useparam name="p_dat" />
          </call>
          <fact column="fin_ul_dolg_astr" />
        </call>
        <call function="if" group="sum" as="dolg_deb_dat_all_vr" title="Дебиторская задолженность на дату отчета">
          <call function="lt">
            <column table="dat" column="val" />
            <useparam name="p_dat" />
          </call>
          <fact column="fin_ul_ob" />
        </call>
        <call function="if" group="sum" as="dolg_peni_dat" title="Задолженность на текущую дату проценты">
          <call function="and">
            <call function="lt">
              <column table="dat" column="val" />
              <useparam name="p_dat" />
            </call>
          </call>
          <fact column="fin_ul_ob_fac" condition="is_peni" />
        </call>
        <call function="and" as="is_peni">
          <call function="in">
            <column table="vid_real" column="vid_real" />
            <array>7</array>
          </call>
          <call function="not in">
            <column table="vid_t" column="vid_t" />
            <array>44</array>
          </call>
          <call function="is not null">
            <column table="kod_hist_mat_dec" column="kod_hist_mat_desc" />
            <column table="kod_hist_mat_dec_ba" column="kod_hist_mat_desc" />
          </call>
        </call>
        <call function="if" group="sum" as="dolg_gp_dat" title="Задолженность на текущую дату ГП">
          <call function="and">
            <call function="lt">
              <column table="dat" column="val" />
              <useparam name="p_dat" />
            </call>
            <call function="in">
              <column table="vid_real" column="vid_real" />
              <array>9</array>
            </call>
          </call>
          <fact column="fin_ul_ob" />
        </call>
      </expressions>
      <params>
        <usepart part="55300-params" />
      </params>
      <select>
        <column table="kod_sf" column="kod_sf" />
        <column table="kod_dog" column="kod_dog" />
        <column table="kod_group_cust" column="name" as="podgr_potr" />
        <column table="kod_group_cust" column="num_cust" as="podgr_potr_cust" exclude="1" />
        <call function="decode" as="podgr_potr_cust">
          <column table="kod_group_cust" column="kod_group_cust" />
          <const>100055</const>
          <const type="number">3.3</const>
          <const>100032</const>
          <const type="number">3.4</const>
          <const>100033</const>
          <const type="number">3.5</const>
          <column table="kod_group_cust" column="num_cust" />
        </call>
        <column table="kod_group_cust_parent" column="name" as="gr_potr" />
        <column table="kod_group_cust_parent" column="kod_group_cust" as="gr_potr_kod" />
        <column table="kod_dog" column="ndog" />
        <column table="kodp" column="name" />
        <call function="if" as="udo" title="Банкрот" type="string" exclude="1">
          <call function="is not null">
            <column table="kodp" column="datepublic" />
          </call>
          <const>'Банкрот'</const>
        </call>
        <call function="case" as="udo" title="Банкрот" type="string">
          <call function="when">
            <call function="and">
              <call function="=">
                <column table="udo" column="pr_active" />
                <const type="number">0</const>
              </call>
              <call function="=">
                <column table="kodp" column="ac_egr_status" />
                <column table="udo" column="sulst" />
              </call>
              <call function="=">
                <column table="udo" column="type_sulst" />
                <call function="if">
                  <call function="is null">
                    <column table="kodp" column="kpp" />
                  </call>
                  <const type="string">'ИП'</const>
                  <const type="string">'ЮЛ'</const>
                </call>
              </call>
              <call function="=">
                <call function="case">
                  <call function="when">
                    <call function="=">
                      <const type="string">'A'</const>
                      <useparam name="p_cat_rep" />
                    </call>
                    <column table="udo" column="cat_a" />
                  </call>
                  <call function="when">
                    <call function="=">
                      <const type="string">'B'</const>
                      <useparam name="p_cat_rep" />
                    </call>
                    <column table="udo" column="cat_b" />
                  </call>
                  <call function="when">
                    <call function="=">
                      <const type="string">'C'</const>
                      <useparam name="p_cat_rep" />
                    </call>
                    <column table="udo" column="cat_c" />
                  </call>
                </call>
                <const type="number">1</const>
              </call>
            </call>
            <column table="udo" column="shortname" />
          </call>
          <call function="when">
            <call function="=">
              <useparam table="kodp" column="ac_egr_status" name="p_cat_rep" />
              <const table="udo" column="sulst" type="string">'-'</const>
            </call>
            <column table="kodp" column="ac_egr_status_name" type="string" />
          </call>
          <call function="else" exclude="1">
            <column table="kodp" column="ac_egr_status_name" />
          </call>
        </call>
        <call type="string" function="if" as="ym_char">
          <call function="not in">
            <column table="kod_sf" column="vid_real" />
            <array>7,9</array>
          </call>
          <call function="ym to char">
            <column table="kod_sf" column="ym" />
          </call>
        </call>
        <column table="kod_sf" column="ym" />
        <call function="if" as="is_other_vid_real" type="number">
          <call function="in" as="" type="">
            <column table="kod_sf" column="vid_real" />
            <array>9,7</array>
          </call>
          <const>1</const>
          <const>0</const>
        </call>
        <fact column="dolg_deb_per" />
        <fact column="fin_ul_sverh_dolg_deb_ng" title="Сверхнормативная задолженность  на 01.__.20__г." as="sverh_dolg_per">
          <withparams>
            <call function="ym begin time">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
          </withparams>
        </fact>
        <column table="kod_sf" column="dat_bzad" />
        <call type="number" function="if" as="dolg_graf_per">
          <call function="not in">
            <column table="kod_sf" column="vid_real" />
            <array>7,9</array>
          </call>
          <fact column="dolg_graf_per" table="graf" as="" type="" />
        </call>
        <call type="number" function="if" as="opl_cur_month">
          <call function="not in">
            <column table="kod_sf" column="vid_real" />
            <array>7,9</array>
          </call>
          <call function="-" as="" type="">
            <call function="nvl0">
              <fact column="opl_dat" />
            </call>
            <call function="nvl0">
              <fact column="opl_per" />
            </call>
          </call>
        </call>
        <fact column="dolg_deb_dat" />
        <fact column="fin_ul_sverh_dolg_deb_pre_ng_dat" title="Сверхнормативная задолженность на дату отчета" as="sverh_dolg_dat">
          <withparams>
            <useparam name="p_dat" />
          </withparams>
        </fact>
        <fact table="sud_resh" column="dolg_deb_peny_dat" title="Задолженность по пени с решением суда взыскать" as="peni_dolg_resh" exclude="1" />
        <fact column="dolg_peni_dat" as="peni_dolg_resh" />
        <fact table="sud_resh" column="dolg_deb_gp_dat" title="Задолженность по госпошлине с решением суда взыскать" as="gp_dolg_resh" exclude="1" />
        <fact column="dolg_gp_dat" as="gp_dolg_resh" />
        <call function="if" as="astr_dolg" title="Задолженность по астренту">
          <call function="exists">
            <query>
              <select>
                <column table="b" column="kod_pen" />
              </select>
              <from>
                <query name="sr_penni" as="b">
                  <link name="kod_dog" />
                </query>
              </from>
              <where>
                <call function="and">
                  <call function="is not null">
                    <column table="b" column="kod_delo" />
                  </call>
                  <call function="=">
                    <column table="b" column="kod_sf" />
                    <column table="kod_sf" column="kod_sf" />
                  </call>
                </call>
              </where>
            </query>
          </call>
          <fact column="dolg_deb_dat_all_vr" />
        </call>
        <fact column="ur_pret_dat_send" title="Дата претензии" as="pret_dat" />
        <fact column="ur_mat_dat_doc_max" title="Дата подачи в суд" as="isk_dat" />
        <fact column="ur_mat_num_delo" title="Номер дела" as="isk_num" />
        <fact column="ur_h_m_dec_info" as="isk_dec_resh" title="Решение" />
        <fact column="ur_hist_mat_info" as="isk_resh" title="Результат рассмотрения" />
        <fact column="ur_hist_mat_dec_gp_otv" as="isk_dec_gp" />
        <fact column="ur_hist_mat_dec_peni" as="isk_dec_peni" />
        <fact column="ur_isp_info" as="isp_info" />
        <fact column="ur_ssp_dat_doc_min" as="isp_dat_ssp" title="Дата направления ИЛ в ССП" />
        <fact column="ur_hist_mat_isp_info" as="isp_resh" title="Дата и результат постановления ССП" />
        <fact column="ur_inkasso_bank_name" title="Наименование банка (раздел Инкассо)" as="isp_bank_inkasso" />
        <fact column="ur_inkasso_dat_podachi_min" title="дата передачи в банк ИЛ (раздел Инкассо)" as="isp_dat_inkasso" />
        <fact column="ur_inkasso_dat_otz" title="дата отзыва из банка (раздел Инкассо)" as="isp_dat_otz_inkasso" />
        <fact column="ur_kazn_dat_otv" as="isp_dat_kazn" title="Дата письма в казначейство" />
        <fact column="ur_kazn_num_reg" as="isp_num_kazn" />
        <fact column="ur_kazn_state_name" as="isp_sost_kazn" title="Состояние в казначействе" />
        <fact column="ur_kazn_dat_otv" as="isp_dat_kazn_isp" title="Дата исполнения казначейства" />
        <fact column="ur_kazn_dat_otz" as="isp_dat_otz_kazn" />
        <fact column="ur_hist_mat_ba_is_in_reestr" as="maratornaya_zadolg" title="Мараторная задолженность" />
        <call function="over" as="dog_sverh_dolg_dat">
          <call function="sum">
            <column table="this" column="sverh_dolg_dat" />
          </call>
          <call function="partition by">
            <column table="kod_dog" column="kod_dog" />
          </call>
        </call>
        <fact column="ur_mat_kod_mat" title="Номер дела" as="kod_mat" />
        <!--<column table="kod_sf" column="kod_sf" group="max"/>
        <column table="kod_opl" column="kod_opl" group="max"/>-->
        <!--<column table="kod_sf" column="kod_sf" group="1" />
        <column table="kod_sf" column="vid_real" group="1" />
        <column table="kod_sf" column="name" group="1" />-->
        <!--<fact table="opl" column="kod_ur_state" group="1"/>
        <column table="ur_state" column="name" group="1"/>
        <column table="kod_sf" column="kod_sf" group="1"/>-->
      </select>
      <from>
        <qube>
          <link name="kod_sf">
            <link name="kod_dog">
              <link name="kodp">
                <link name="udo" />
                <link name="udo1" exclude="1" />
              </link>
              <link name="kod_dog_dop">
                <link name="kod_group_cust">
                  <link name="kod_group_cust_parent" />
                </link>
              </link>
            </link>
          </link>
          <dimset as="graf">
            <link name="qube_sf_graf" only-for-cond="1" />
            <where>
              <call function="between" dont-push="1">
                <call function="ym begin time">
                  <call function="date to ym">
                    <useparam name="p_dat" />
                  </call>
                </call>
                <column table="qube_sf_graf" column="doc_date" />
                <call function="nvl">
                  <column table="qube_sf_graf" column="dat_finish" />
                  <call function="doomsday" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="sud_resh">
            <link name="kod_hist_mat_dec" only-for-cond="1" />
            <where>
              <call function="and">
                <call function="=">
                  <column table="kod_hist_mat_dec" column="kod_result" />
                  <const>7</const>
                </call>
                <call function="ge" dont-push="1">
                  <useparam name="p_dat" />
                  <column table="kod_hist_mat_dec" column="dat_resh" />
                </call>
              </call>
            </where>
          </dimset>
          <where exclude="1">
            <call function="and">
              <call function="true" />
              <call function="=" optional="1">
                <column table="kod_dog" column="kod_dog" />
                <const>8360</const>
                <useparam name="p_kod_dog" exclude="1" />
              </call>
            </call>
          </where>
          <!--<link name="ym" />-->
        </qube>
      </from>
      <where>
        <call function="in">
          <column table="kod_dog" column="kod_dog" />
          <query>
            <select>
              <column table="dog_list" column="kod_dog" />
            </select>
            <from>
              <query name="55300-dog_data_list" as="dog_list">
                <withparams>
                  <usepart part="55300-withparams" />
                </withparams>
              </query>
            </from>
          </query>
        </call>
      </where>
    </query>
    <query name="55300-dog_data_list" timestamp="16.07.2021 18:24:07" use-repository="1" materialize="1" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <params>
        <usepart part="55300-params" />
      </params>
      <select>
        <column table="a" column="kod_dog" />
        <!--<column table="kod_sf" column="kod_sf" group="max"/>
        <column table="kod_opl" column="kod_opl" group="max"/>-->
        <!--<column table="kod_sf" column="kod_sf" group="1" />
        <column table="kod_sf" column="vid_real" group="1" />
        <column table="kod_sf" column="name" group="1" />-->
        <!--<fact table="opl" column="kod_ur_state" group="1"/>
        <column table="ur_state" column="name" group="1"/>
        <column table="kod_sf" column="kod_sf" group="1"/>-->
      </select>
      <from>
        <query name="55300-dog_pre" as="a">
          <withparams>
            <usepart part="55300-withparams" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="ge" optional="1">
            <column table="a" column="sverh_dolg_dat" exclude="1" />
            <column table="a" column="sverh_dolg_per" />
            <call function="*">
              <const>1000</const>
              <useparam name="p_min_debt" />
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="55300-data" timestamp="08.06.2023 15:15:11" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <params>
        <usepart part="55300-params" />
      </params>
      <select>
        <column table="a" column="kod_sf" exclude="1" />
        <column table="a" column="kod_dog" />
        <column table="a" column="dog_sverh_dolg_dat" />
        <column table="a" column="podgr_potr" />
        <column table="a" column="podgr_potr_cust" />
        <column table="a" column="gr_potr" />
        <column table="a" column="gr_potr_kod" />
        <column table="a" column="ndog" />
        <column table="a" column="name" />
        <column table="a" column="ym" />
        <column table="a" column="ym_char" />
        <column table="a" column="dog_pp" />
        <column table="a" column="kod_mat" />
        <column table="a" column="is_other_vid_real" />
        <column table="a" column="max_ym" />
        <column table="a" column="udo" group="max" />
        <column table="a" column="nachisl" group="sum" />
        <column table="a" column="dolg_deb_per" group="sum" />
        <column table="a" column="sverh_dolg_per" group="sum" />
        <column table="a" column="sverh_dolg_per_1_3" group="sum" />
        <column table="a" column="sverh_dolg_per_3_6" group="sum" />
        <column table="a" column="sverh_dolg_per_6_12" group="sum" />
        <column table="a" column="sverh_dolg_per_12g" group="sum" />
        <column table="a" column="dat_bzad" group="max" />
        <column table="a" column="dolg_graf_per" group="sum" />
        <column table="a" column="opl_cur_month" group="sum" />
        <column table="a" column="dolg_deb_dat" group="sum" />
        <column table="a" column="sverh_dolg_dat" group="sum" />
        <column table="a" column="peni_dolg_resh" group="sum" />
        <column table="a" column="gp_dolg_resh" group="sum" />
        <column table="a" column="astr_dolg" group="sum" />
        <column table="a" column="sud_rab" group="max" />
        <column table="a" column="isp_info" group="max" />
        <column table="a" column="maratornaya_zadolg" group="max" />
        <column table="a" column="peni_dolg_resh_x" group="sum" />
        <column table="a" column="astr_dolg_x" group="sum" />
        <column table="a" column="gp_dolg_resh_x" group="sum" />
        <column table="a" column="dolg_main_x" group="sum" />
        <column table="a" column="del" />
        <column table="otv" column="fio" title="Ответственный сотрудник филиала по договору" as="dog_otv" />
        <column table="sov" column="info" title="Принятые решения на совещании от  __.__.__" as="sov_info" />
        <!--<column table="kod_sf" column="kod_sf" group="max"/>
        <column table="kod_opl" column="kod_opl" group="max"/>-->
        <!--<column table="kod_sf" column="kod_sf" group="1" />
        <column table="kod_sf" column="vid_real" group="1" />
        <column table="kod_sf" column="name" group="1" />-->
        <!--<fact table="opl" column="kod_ur_state" group="1"/>
        <column table="ur_state" column="name" group="1"/>
        <column table="kod_sf" column="kod_sf" group="1"/>-->
      </select>
      <from>
        <query name="55300-data_pre4" as="a">
          <withparams>
            <usepart part="55300-withparams" />
          </withparams>
        </query>
        <query name="55300-dog_otv" join="left outer" as="otv">
          <call function="=">
            <column table="a" column="kod_dog" />
            <column table="otv" column="kod_dog" />
          </call>
        </query>
        <query name="55300-sov_info" join="left outer" as="sov">
          <withparams>
            <useparam name="p_dat" />
          </withparams>
          <call function="=">
            <column table="a" column="kod_dog" />
            <column table="sov" column="kod_dog" />
          </call>
        </query>
      </from>
      <where exclude="1">
        <call function="or">
          <call function="!=0">
            <column table="this" column="dolg_deb_per" />
          </call>
          <call function="!=0">
            <column table="this" column="sverh_dolg_per" />
          </call>
          <call function="!=0">
            <column table="this" column="dolg_graf_per" />
          </call>
          <call function="!=0">
            <column table="this" column="dolg_deb_dat" />
          </call>
          <call function="!=0">
            <column table="this" column="sverh_dolg_dat" />
          </call>
          <call function="!=0">
            <column table="this" column="peni_dolg_resh" />
          </call>
          <call function="!=0">
            <column table="this" column="gp_dolg_resh" />
          </call>
          <call function="!=0">
            <column table="this" column="astr_dolg" />
          </call>
        </call>
      </where>
      <grouping>
        <grset as="itog">
          <grset as="gr_potr_g" order="gr_potr">
            <group>
              <column table="a" column="gr_potr" />
              <column table="a" column="gr_potr_kod" />
            </group>
            <grset as="podgr_potr_g" order="podgr_potr_cust">
              <group>
                <column table="a" column="podgr_potr_cust" />
                <column table="a" column="podgr_potr" />
              </group>
              <grset as="dog" order="dog_sverh_dolg_dat desc">
                <group>
                  <column table="a" column="kod_dog" />
                  <column table="a" column="ndog" />
                  <column table="a" column="name" />
                  <column table="a" column="dog_sverh_dolg_dat" />
                  <column table="this" column="dog_pp" />
                  <column table="this" column="dog_otv" />
                  <column table="this" column="sov_info" />
                </group>
                <grset as="sf" order="max_ym,ym">
                  <where>
                    <call function="=0">
                      <column table="this" column="del" />
                    </call>
                  </where>
                  <group>
                    <column table="a" column="kod_sf" exclude="1" />
                    <column table="this" column="ym" />
                    <column table="this" column="del" />
                    <column table="this" column="is_other_vid_real" />
                    <column table="this" column="max_ym" />
                    <column table="this" column="ym_char" />
                    <column table="this" column="kod_mat" />
                    <column table="this" column="sud_rab" exclude="1" />
                    <column table="this" column="isp_info" exclude="1" />
                  </group>
                </grset>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="55300-gr_potr" timestamp="16.07.2021 18:26:19" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <params>
        <usepart part="55300-params" />
      </params>
      <select>
        <column table="a" column="gr_potr" />
        <column table="a" column="sverh_dolg_dat" group="sum" mp="-3" />
        <column table="a" column="sverh_dolg_per" group="sum" mp="-3" />
        <column table="a" column="opl_cur_month" group="sum" mp="-3" />
        <!--<column table="kod_sf" column="kod_sf" group="max"/>
        <column table="kod_opl" column="kod_opl" group="max"/>-->
        <!--<column table="kod_sf" column="kod_sf" group="1" />
        <column table="kod_sf" column="vid_real" group="1" />
        <column table="kod_sf" column="name" group="1" />-->
        <!--<fact table="opl" column="kod_ur_state" group="1"/>
        <column table="ur_state" column="name" group="1"/>
        <column table="kod_sf" column="kod_sf" group="1"/>-->
      </select>
      <from>
        <query name="55300-dog_pre" as="a">
          <withparams>
            <usepart part="55300-withparams" />
          </withparams>
        </query>
      </from>
      <grouping>
        <grset as="itog">
          <grset as="gr_potr_g" order="gr_potr">
            <group>
              <column table="a" column="gr_potr" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="55300-dog_otv" timestamp="16.07.2021 18:26:54" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <select>
        <column table="dog_e" column="kod_dog" group="1" />
        <column table="kod_emp" column="fio" group="stragg" />
        <!--<column table="kod_sf" column="kod_sf" group="max"/>
        <column table="kod_opl" column="kod_opl" group="max"/>-->
        <!--<column table="kod_sf" column="kod_sf" group="1" />
        <column table="kod_sf" column="vid_real" group="1" />
        <column table="kod_sf" column="name" group="1" />-->
        <!--<fact table="opl" column="kod_ur_state" group="1"/>
        <column table="ur_state" column="name" group="1"/>
        <column table="kod_sf" column="kod_sf" group="1"/>-->
      </select>
      <from>
        <query name="kr_dogobj_emp" as="dog_e">
          <link name="kod_emp" />
        </query>
      </from>
      <where>
        <call function="=">
          <column table="kod_emp" column="kod_dolzhfun" />
          <const>5</const>
        </call>
      </where>
    </query>
    <query name="55300-right_sov" timestamp="16.07.2021 18:27:26" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <select>
        <call function="if" as="right_sov">
          <call function="=">
            <const>2</const>
            <call function="user_rights_kod_menu">
              <const>12233</const>
            </call>
          </call>
          <const>1</const>
          <const>0</const>
        </call>
      </select>
      <from>
        <query name="dual" />
      </from>
    </query>
    <query name="55300-sov_info" timestamp="13.10.2021 16:14:21" use-repository="1" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <params>
        <param name="p_dat" type="date">
          <const>to_date('21.09.2021','dd.MM.yyyy')</const>
        </param>
      </params>
      <select>
        <column table="sov_info" column="kod_dog" group="1" />
        <column table="sov_info" column="info" group="stragg" />
      </select>
      <from>
        <query name="sqlb_55300_soveshanie_info" as="sov_info" />
      </from>
      <where>
        <call function="in">
          <column table="sov_info" column="kod_soveshanie" />
          <query>
            <select>
              <call function="over" as="kod_numobj_ym" title="kod_numobj_ym">
                <call function="first_value">
                  <column table="sov" column="kod_soveshanie" />
                </call>
                <call function="order by rows * *">
                  <call function="desc">
                    <column table="sov" column="dat" />
                  </call>
                </call>
              </call>
            </select>
            <from>
              <query name="sqlb_55300_soveshanie" as="sov" />
            </from>
            <where>
              <call function="le">
                <column table="sov" column="dat" />
                <useparam name="p_dat" />
              </call>
            </where>
          </query>
        </call>
      </where>
    </query>
    <query name="55300-title" timestamp="16.07.2021 18:29:01" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <params>
        <usepart part="55300-params" />
      </params>
      <select>
        <call function="date to char" as="first_date">
          <call function="ym begin time">
            <call function="date to ym">
              <useparam name="p_dat" />
            </call>
          </call>
        </call>
        <call function="()" as="dep_name" type="string">
          <query>
            <select>
              <column table="dep" column="name" />
            </select>
            <from>
              <query name="kr_org" as="dep" />
            </from>
            <where>
              <call function="=">
                <column table="dep" column="kodp" />
                <useparam name="p_dep" />
              </call>
            </where>
          </query>
        </call>
        <call function="date to char" as="cur_date">
          <useparam name="p_dat" />
        </call>
        <call function="()" as="last_sov" type="string">
          <query>
            <select>
              <call function="date to char" as="dat_sov">
                <call function="max">
                  <column table="sov" column="dat" />
                </call>
              </call>
            </select>
            <from>
              <query name="sqlb_55300_soveshanie" as="sov" />
            </from>
            <where>
              <call function="le">
                <column table="sov" column="dat" />
                <useparam name="p_dat" />
              </call>
            </where>
          </query>
        </call>
      </select>
      <from>
        <query name="dual" as="a" />
      </from>
    </query>
    <query name="55300-dog_pre_test" timestamp="16.07.2021 18:29:38" use-repository="1" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <expressions>
        <call function="if" group="sum" title="Оплата на 01.__.20__г." as="opl_per">
          <call function="lt">
            <column table="dat" column="val" />
            <call function="ym begin time">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
          </call>
          <fact column="sr_opl_opl_sf" />
        </call>
        <call function="if" group="sum" title="Оплата на дату отчета" as="opl_dat">
          <call function="lt">
            <column table="dat" column="val" />
            <useparam name="p_dat" />
          </call>
          <fact column="sr_opl_opl_sf" />
        </call>
        <call function="if" group="sum" as="nachisl_ym">
          <call function="and">
            <call function="le">
              <column table="dat" column="val" />
              <call function="ym end time">
                <useparam name="p_ym" />
              </call>
            </call>
            <call function="ge">
              <column table="dat" column="val" />
              <call function="ym begin time">
                <useparam name="p_ym" />
              </call>
            </call>
          </call>
          <fact column="sr_facras_nachisl" />
        </call>
        <call function="if" group="sum" as="opl_ym">
          <call function="and">
            <call function="le">
              <column table="dat" column="val" />
              <call function="ym end time">
                <useparam name="p_ym" />
              </call>
            </call>
            <call function="ge">
              <column table="dat" column="val" />
              <call function="ym begin time">
                <useparam name="p_ym" />
              </call>
            </call>
          </call>
          <fact column="sr_opl_opl_sf" />
        </call>
      </expressions>
      <params>
        <usepart part="55300-params" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" />
        <column table="kod_dog" column="ndog" />
        <column table="kod_sf" column="kod_sf" exclude="1" />
        <column table="kod_sf" column="ym_vozn" exclude="1" />
        <column table="kod_gr_potr_dog" column="name" as="gr_name" exclude="1" />
        <call function="ym begin time" as="dd" exclude="1">
          <call function="date to ym">
            <useparam name="p_dat" />
          </call>
        </call>
        <column table="kod_group_cust_parent" column="name" as="gr_potr" />
        <!--<column table="kod_sf" column="kod_sf" group="max"/>
        <column table="kod_opl" column="kod_opl" group="max"/>-->
        <!--<column table="kod_sf" column="kod_sf" group="1" />
        <column table="kod_sf" column="vid_real" group="1" />
        <column table="kod_sf" column="name" group="1" />-->
        <fact title="Сверхнормативная задолженность(деб) на дату" as="sverh_dolg_dat" column="fin_ul_sverh_dolg_deb_ng">
          <withparams>
            <useparam name="p_dat" />
            <call function="ym begin time" exclude="1">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
          </withparams>
        </fact>
        <fact column="fin_ul_dolg_deb_per_dog" exclude="1">
          <withparams>
            <useparam name="p_dat" />
            <call function="ym begin time" exclude="1">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
          </withparams>
        </fact>
        <fact column="fin_ul_sverh_dolg_deb_pre_dog" exclude="1">
          <withparams>
            <useparam name="p_dat" />
            <call function="ym begin time" exclude="1">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
          </withparams>
        </fact>
        <fact column="fin_ul_sverh_dolg_deb_pre_ym" exclude="1">
          <withparams>
            <useparam name="p_dat" />
            <call function="ym begin time" exclude="1">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
          </withparams>
        </fact>
        <fact column="fin_ul_sverh_dolg_deb_pre" exclude="1">
          <withparams>
            <useparam name="p_dat" />
          </withparams>
        </fact>
        <fact column="fin_ul_gaf_dolg_in_out_dt" exclude="1">
          <withparams>
            <useparam name="p_dat" />
          </withparams>
        </fact>
        <fact column="qube_graf_in_ob" exclude="1" />
        <fact column="qube_graf_out_ob" exclude="1" />
        <fact column="sr_facvip_norm_av_av_nach" exclude="1" />
        <fact column="sr_facvip_norm_av_osn_nach" exclude="1" />
        <fact column="sr_opl_norm_av_av_opl" exclude="1" />
        <fact column="sr_opl_norm_av_osn_opl" exclude="1" />
        <fact title="Сверхнормативная задолженность(деб) на 1 число" as="sverh_dolg_per" column="fin_ul_sverh_dolg_deb_ng">
          <withparams>
            <call function="ym begin time">
              <call function="date to ym">
                <useparam name="p_dat" />
              </call>
            </call>
            <useparam name="p_dat" exclude="1" />
          </withparams>
        </fact>
        <call function="-" as="opl_cur_month" title="Оплата в текущем месяце" exclude="1">
          <call function="nvl0">
            <fact column="opl_dat" />
          </call>
          <call function="nvl0">
            <fact column="opl_per" />
          </call>
        </call>
        <!--<fact table="opl" column="kod_ur_state" group="1"/>
        <column table="ur_state" column="name" group="1"/>
        <column table="kod_sf" column="kod_sf" group="1"/>-->
      </select>
      <from>
        <qube>
          <link name="kod_dog">
            <link name="kod_gr_potr_dog" exclude="1" />
            <link name="kod_dog_dop">
              <link name="kod_group_cust">
                <link name="kod_group_cust_parent" />
              </link>
            </link>
          </link>
          <!--<link name="ym" />-->
        </qube>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="kod_dog" column="dep" />
            <const name="p_dep">102276621</const>
          </call>
          <call function="=" exclude="1">
            <column table="kod_dog" column="kod_dog" />
            <const name="p_dep">50010261</const>
          </call>
          <call function="gt">
            <column table="this" column="sverh_dolg_dat" />
            <const>0</const>
          </call>
          <call function="or">
            <call function="!=">
              <column table="kod_dog" column="pr_active" />
              <const>1</const>
            </call>
            <call function="!=0">
              <fact column="nachisl_ym" />
            </call>
            <call function="!=0">
              <fact column="opl_ym" />
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="55300-gr_potr_test" timestamp="16.07.2021 18:30:15" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <params>
        <usepart part="55300-params" />
      </params>
      <select>
        <column table="a" column="gr_potr" />
        <column table="a" column="kod_dog" />
        <column table="a" column="sverh_dolg_dat" group="sum" mp="-3" />
        <column table="a" column="sverh_dolg_per" group="sum" mp="-3" />
        <column table="a" column="opl_cur_month" group="sum" mp="-3" />
        <!--<column table="kod_sf" column="kod_sf" group="max"/>
        <column table="kod_opl" column="kod_opl" group="max"/>-->
        <!--<column table="kod_sf" column="kod_sf" group="1" />
        <column table="kod_sf" column="vid_real" group="1" />
        <column table="kod_sf" column="name" group="1" />-->
        <!--<fact table="opl" column="kod_ur_state" group="1"/>
        <column table="ur_state" column="name" group="1"/>
        <column table="kod_sf" column="kod_sf" group="1"/>-->
      </select>
      <from>
        <query name="55300-dog_pre" as="a">
          <withparams>
            <usepart part="55300-withparams" />
          </withparams>
        </query>
      </from>
      <grouping>
        <grset as="itog">
          <grset as="gr_potr_g" order="gr_potr">
            <group>
              <column table="a" column="gr_potr" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="55300-data_pre2" timestamp="14.10.2021 05:02:41" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <params>
        <usepart part="55300-params" />
      </params>
      <select>
        <column table="a" column="kod_sf" />
        <column table="a" column="kod_dog" />
        <column table="a" column="dog_sverh_dolg_dat" />
        <column table="a" column="podgr_potr" />
        <column table="a" column="podgr_potr_cust" />
        <column table="a" column="gr_potr" />
        <column table="a" column="gr_potr_kod" />
        <column table="a" column="ndog" />
        <column table="a" column="name" />
        <column table="a" column="ym" />
        <call as="ym_char" type="string" function="nvl">
          <column table="a" column="ym_char" as="" type="" />
          <call function="ym to char">
            <column table="mat_ym" column="ym" />
          </call>
        </call>
        <column table="a" column="is_other_vid_real" />
        <column table="a" column="dog_pp" />
        <column table="a" column="udo" />
        <column table="a" column="nachisl" exclude="1" />
        <column table="a" column="dolg_deb_per" />
        <column table="a" column="sverh_dolg_per" />
        <column table="a" column="sverh_dolg_per_1_3" />
        <column table="a" column="sverh_dolg_per_3_6" />
        <column table="a" column="sverh_dolg_per_6_12" />
        <column table="a" column="sverh_dolg_per_12g" />
        <column table="a" column="dat_bzad" />
        <column table="a" column="dolg_graf_per" />
        <column table="a" column="opl_cur_month" />
        <column table="a" column="dolg_deb_dat" />
        <column table="a" column="sverh_dolg_dat" />
        <call as="peni_dolg_resh" type="number" function="if">
          <call type="" function="=">
            <call function="nvl" as="" type="">
              <column table="mat_ym" column="rwnum" />
              <const>1</const>
            </call>
            <const>1</const>
          </call>
          <column table="a" column="peni_dolg_resh" as="" type="" />
        </call>
        <call as="gp_dolg_resh" type="number" function="if">
          <call type="" function="=">
            <call function="nvl" as="" type="">
              <column table="mat_ym" column="rwnum" />
              <const>1</const>
            </call>
            <const>1</const>
          </call>
          <column table="a" column="gp_dolg_resh" as="" type="" />
        </call>
        <call as="astr_dolg" type="number" function="if">
          <call type="" function="=">
            <call function="nvl" as="" type="">
              <column table="mat_ym" column="rwnum" />
              <const>1</const>
            </call>
            <const>1</const>
          </call>
          <column table="a" column="astr_dolg" as="" type="" />
        </call>
        <column table="a" column="kod_mat" />
        <column table="a" column="sud_rab" />
        <column table="a" column="isp_info" />
        <column table="a" column="maratornaya_zadolg" />
        <call function="over" type="number" as="peni_dolg_resh_x">
          <call function="sum">
            <column table="this" column="peni_dolg_resh" />
          </call>
          <call function="partition by">
            <column table="this" column="kod_dog" />
            <column table="this" column="kod_mat" />
          </call>
        </call>
        <call function="over" type="number" as="astr_dolg_x">
          <call function="sum">
            <column table="this" column="astr_dolg" />
          </call>
          <call function="partition by">
            <column table="this" column="kod_dog" />
            <column table="this" column="kod_mat" />
          </call>
        </call>
        <call function="over" type="number" as="gp_dolg_resh_x">
          <call function="sum">
            <column table="this" column="gp_dolg_resh" />
          </call>
          <call function="partition by">
            <column table="this" column="kod_dog" />
            <column table="this" column="kod_mat" />
          </call>
        </call>
        <call as="rn_x" function="row_number" type="number">
          <call function="partition by">
            <column column="kod_dog" table="this" />
            <column column="kod_mat" table="this" />
            <column column="rwnum" table="mat_ym" />
          </call>
          <call function="order by simple">
            <const>null</const>
          </call>
        </call>
        <call as="dolg_main_x" function="over" type="number">
          <call function="sum">
            <call function="+nvl" type="">
              <column column="dolg_deb_dat" table="this" />
              <column column="dolg_deb_per" table="this" />
            </call>
          </call>
          <call function="partition by">
            <column column="kod_dog" table="this" />
            <column column="kod_mat" table="this" />
          </call>
        </call>
        <call as="max_ym_other" function="over" type="number">
          <call function="max">
            <call type="" function="if">
              <call as="" function="=" type="">
                <column column="is_other_vid_real" table="a" />
                <array>1</array>
              </call>
              <column column="ym" table="mat_ym" />
            </call>
          </call>
          <call function="partition by">
            <column column="kod_dog" table="this" />
            <column column="kod_mat" table="this" />
          </call>
        </call>
        <call as="max_ym" function="over" type="number">
          <call function="max">
            <call type="" function="if">
              <call as="" function="!=" type="">
                <column column="is_other_vid_real" table="a" />
                <array>1</array>
              </call>
              <column column="ym" table="this" />
            </call>
          </call>
          <call function="partition by">
            <column column="kod_dog" table="this" />
            <column column="kod_mat" table="this" />
          </call>
        </call>
        <call as="nachisl" type="number" function="if" mp="-3">
          <call function="!=nvl">
            <column table="a" column="is_other_vid_real" />
            <const>1</const>
          </call>
          <column table="kod_sf" column="nachisl" />
        </call>
        <!--<column table="kod_sf" column="kod_sf" group="max"/>
        <column table="kod_opl" column="kod_opl" group="max"/>-->
        <!--<column table="kod_sf" column="kod_sf" group="1" />
        <column table="kod_sf" column="vid_real" group="1" />
        <column table="kod_sf" column="name" group="1" />-->
        <!--<fact table="opl" column="kod_ur_state" group="1"/>
        <column table="ur_state" column="name" group="1"/>
        <column table="kod_sf" column="kod_sf" group="1"/>-->
      </select>
      <from>
        <query name="55300-data_pre3" as="a">
          <withparams>
            <usepart part="55300-withparams" />
          </withparams>
        </query>
        <query name="sr_facvip" join="left outer" as="kod_sf">
          <call function="=">
            <column table="a" column="kod_sf" />
            <column table="kod_sf" column="kod_sf" />
          </call>
        </query>
        <query name="55300-mat_ym" join="left outer" as="mat_ym" comment="55300(19) ">
          <call type="" function="and">
            <call function="=" as="" type="">
              <column table="a" column="kod_mat" />
              <column table="mat_ym" column="kod_mat" />
            </call>
            <call function="is null">
              <column table="a" column="ym_char" />
            </call>
          </call>
        </query>
      </from>
    </query>
    <query name="55300-data_pre3" timestamp="14.10.2021 03:25:10" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <params>
        <usepart part="55300-params" />
      </params>
      <select>
        <column table="a" column="kod_sf" comment="невидим" group="1" />
        <column table="a" column="kod_dog" comment="невидим" group="1" />
        <column table="a" column="dog_sverh_dolg_dat" comment="невидим" group="1" />
        <column table="a" column="podgr_potr" group="1" />
        <column table="a" column="podgr_potr_cust" group="1" />
        <column table="a" column="gr_potr" group="1" />
        <column table="a" column="gr_potr_kod" comment="невидим" group="1" />
        <column table="a" column="ndog" title="Номер договора" group="1" />
        <column table="a" column="name" title="Наименование абонента" group="1" />
        <column table="a" column="ym" title="Период начисления" group="1" />
        <column table="a" column="ym_char" group="1" />
        <column table="a" column="is_other_vid_real" group="1" />
        <call function="dense_rank" as="dog_pp">
          <call function="partition by">
            <column table="a" column="podgr_potr" group="max" />
          </call>
          <call function="order by simple">
            <column table="a" column="dog_sverh_dolg_dat" group="max" />
          </call>
          <const> desc</const>
        </call>
        <column table="a" column="udo" title="Статус банкротства" group="max" />
        <column table="a" column="nachisl" title="Объем продаж (отпуск)" group="sum" mp="-3" exclude="1" />
        <column table="a" column="dolg_deb_per" title="Дебиторская задолженность на 01.__.20__г." group="sum" mp="-3" />
        <column table="a" column="sverh_dolg_per" title="в т.ч. просроченная задолженность на 01.__.20__ г. Всего" group="sum" mp="-3" />
        <call function="if" title="в т.ч. просроченная задолженность на 01.__.20__ г. от 1-3 мес." as="sverh_dolg_per_1_3" group="sum" mp="-3">
          <call function="and">
            <call function="ge">
              <column table="a" column="dat_bzad" />
              <call function="add_months">
                <call function="ym end time">
                  <useparam name="p_ym" />
                </call>
                <const>-3</const>
              </call>
            </call>
            <call function="le" exclude="1">
              <column table="a" column="dat_bzad" />
              <call function="add_months">
                <call function="ym end time">
                  <useparam name="p_ym" />
                </call>
                <const>-1</const>
              </call>
            </call>
          </call>
          <column table="a" column="sverh_dolg_per" />
        </call>
        <call function="if" title="в т.ч. просроченная задолженность на 01.__.20__ г. от 3-6 мес." as="sverh_dolg_per_3_6" group="sum" mp="-3">
          <call function="and">
            <call function="ge">
              <column table="a" column="dat_bzad" />
              <call function="add_months">
                <call function="ym end time">
                  <useparam name="p_ym" />
                </call>
                <const>-6</const>
              </call>
            </call>
            <call function="le">
              <column table="a" column="dat_bzad" />
              <call function="add_months">
                <call function="ym end time">
                  <useparam name="p_ym" />
                </call>
                <const>-3</const>
              </call>
            </call>
          </call>
          <column table="a" column="sverh_dolg_per" />
        </call>
        <call function="if" title="в т.ч. просроченная задолженность на 01.__.20__ г. от 6-до 1 года" as="sverh_dolg_per_6_12" group="sum" mp="-3">
          <call function="and">
            <call function="ge">
              <column table="a" column="dat_bzad" />
              <call function="add_months">
                <call function="ym end time">
                  <useparam name="p_ym" />
                </call>
                <const>-12</const>
              </call>
            </call>
            <call function="le">
              <column table="a" column="dat_bzad" />
              <call function="add_months">
                <call function="ym end time">
                  <useparam name="p_ym" />
                </call>
                <const>-6</const>
              </call>
            </call>
          </call>
          <column table="a" column="sverh_dolg_per" />
        </call>
        <call function="if" title="в т.ч. просроченная задолженность на 01.__.20__ г. более 1 года" as="sverh_dolg_per_12g" group="sum" mp="-3">
          <call function="le">
            <column table="a" column="dat_bzad" />
            <call function="add_months">
              <call function="ym end time">
                <useparam name="p_ym" />
              </call>
              <const>-12</const>
            </call>
          </call>
          <column table="a" column="sverh_dolg_per" />
        </call>
        <column table="a" column="dat_bzad" comment="невидим" group="max" />
        <column table="a" column="dolg_graf_per" title="Задолженность  на  01.__.20__, включенная в ГПЗ" group="sum" mp="-3" />
        <column table="a" column="opl_cur_month" title="Оплата, поступившая в текущем месяце" group="sum" mp="-3" />
        <column table="a" column="dolg_deb_dat" title="Задолженность на текущую дату ДЗ" group="sum" mp="-3" />
        <column table="a" column="sverh_dolg_dat" title="Задолженность на текущую дату в т.ч. просроченная задолженность" group="sum" mp="-3" />
        <column table="a" column="peni_dolg_resh" title="Задолженность по % присужденным судом" group="sum" mp="-3" />
        <column table="a" column="gp_dolg_resh" title="Задолженность по госпошлине" group="sum" mp="-3" />
        <column table="a" column="astr_dolg" title="Задолженность по % начисленным за нарушение сроков оплаты" group="sum" mp="-3" />
        <column table="a" column="kod_mat" title="Задолженность по % начисленным за нарушение сроков оплаты" group="1" />
        <call function="||" title="Судебная работа" as="sud_rab" group="max">
          <call function="if">
            <call function="is not null">
              <column table="a" column="pret_dat" />
            </call>
            <call function="||">
              <const>'Претензия от '</const>
              <call function="date to char">
                <column table="a" column="pret_dat" />
              </call>
              <const>'.  '</const>
            </call>
          </call>
          <call function="if">
            <call function="is not null">
              <column table="a" column="isk_dat" />
            </call>
            <call function="||">
              <const>'Дата подачи искового заявления '</const>
              <call function="date to char">
                <column table="a" column="isk_dat" />
              </call>
              <const>'.  '</const>
            </call>
          </call>
          <call function="if">
            <call function="is not null">
              <column table="a" column="isk_num" />
            </call>
            <call function="||">
              <const>'Номер дела '</const>
              <column table="a" column="isk_num" />
              <const>'.  '</const>
            </call>
          </call>
          <call function="if">
            <call function="is not null">
              <column table="a" column="isk_dec_resh" />
            </call>
            <call function="||">
              <column table="a" column="isk_dec_resh" />
              <const>'.  '</const>
            </call>
          </call>
          <call function="if">
            <call function="is not null">
              <column table="a" column="isk_resh" />
            </call>
            <call function="||">
              <column table="a" column="isk_resh" />
              <const>'.  '</const>
            </call>
          </call>
          <call function="if">
            <call function="is not null">
              <column table="a" column="isk_dec_gp" />
            </call>
            <call function="||">
              <const>'Госпошлина '</const>
              <call function="number_to_currency_string">
                <column table="a" column="isk_dec_gp" />
              </call>
              <const>' р.  '</const>
            </call>
          </call>
          <call function="if">
            <call function="is not null">
              <column table="a" column="isk_dec_peni" />
            </call>
            <call function="||">
              <const>'Пени '</const>
              <call function="number_to_currency_string">
                <column table="a" column="isk_dec_peni" />
              </call>
              <const>' р.  '</const>
            </call>
          </call>
        </call>
        <call function="||" title="Исполнительное производство" as="isp_info" group="max">
          <call function="if">
            <call function="is not null">
              <column table="a" column="isp_info" />
            </call>
            <call function="||">
              <column table="a" column="isp_info" />
              <const>'.  '</const>
            </call>
          </call>
          <call function="if">
            <call function="is not null">
              <column table="a" column="isp_dat_ssp" />
            </call>
            <call function="||">
              <const>'Дата направления ИЛ в ССП '</const>
              <call function="date to char">
                <column table="a" column="isp_dat_ssp" />
              </call>
              <const>'.  '</const>
            </call>
          </call>
          <call function="if">
            <call function="is not null">
              <column table="a" column="isp_resh" />
            </call>
            <call function="||">
              <column table="a" column="isp_resh" />
              <const>'.  '</const>
            </call>
          </call>
          <call function="if">
            <call function="is not null">
              <column table="a" column="isp_bank_inkasso" />
            </call>
            <call function="||">
              <const>'Наименование банка '</const>
              <column table="a" column="isp_bank_inkasso" />
              <const>'.  '</const>
            </call>
          </call>
          <call function="if">
            <call function="is not null">
              <column table="a" column="isp_dat_inkasso" />
            </call>
            <call function="||">
              <const>'Дата передачи в банк ИЛ  '</const>
              <call function="date to char">
                <column table="a" column="isp_dat_inkasso" />
              </call>
              <const>'.  '</const>
            </call>
          </call>
          <call function="if">
            <call function="is not null">
              <column table="a" column="isp_dat_otz_inkasso" />
            </call>
            <call function="||">
              <const>'Дата отзыва из банка  '</const>
              <call function="date to char">
                <column table="a" column="isp_dat_otz_inkasso" />
              </call>
              <const>'.  '</const>
            </call>
          </call>
          <call function="if">
            <call function="!=">
              <column table="a" column="gr_potr_kod" />
              <const comment="Бюджеты">100023</const>
            </call>
            <call function="||">
              <call function="if">
                <call function="is not null">
                  <column table="a" column="isp_dat_kazn" />
                </call>
                <call function="||">
                  <const>'Дата письма в казначейство '</const>
                  <call function="date to char">
                    <column table="a" column="isp_dat_kazn" />
                  </call>
                  <const>'.  '</const>
                </call>
              </call>
              <call function="if">
                <call function="is not null">
                  <column table="a" column="isp_num_kazn" />
                </call>
                <call function="||">
                  <const>'Номер письма в казначейство '</const>
                  <column table="a" column="isp_num_kazn" />
                  <const>'.  '</const>
                </call>
              </call>
            </call>
            <call function="||">
              <call function="if">
                <call function="is not null">
                  <column table="a" column="isp_sost_kazn" />
                </call>
                <call function="||">
                  <const>'Состояние в казначействе '</const>
                  <column table="a" column="isp_sost_kazn" />
                  <const>'.  '</const>
                </call>
              </call>
              <call function="if">
                <call function="is not null">
                  <column table="a" column="isp_dat_kazn_isp" />
                </call>
                <call function="||">
                  <const>'Дата исполнения в казначействе '</const>
                  <call function="date to char">
                    <column table="a" column="isp_dat_kazn_isp" />
                  </call>
                  <const>'.  '</const>
                </call>
              </call>
              <call function="if">
                <call function="is not null">
                  <column table="a" column="isp_dat_otz_kazn" />
                </call>
                <call function="||">
                  <const>'Дата отзыва из казначейства '</const>
                  <call function="date to char">
                    <column table="a" column="isp_dat_otz_kazn" />
                  </call>
                  <const>'.  '</const>
                </call>
              </call>
            </call>
          </call>
        </call>
        <call function="if" title="Мораторная задолженность" group="max" as="maratornaya_zadolg" type="string">
          <call function="=1">
            <column table="a" column="maratornaya_zadolg" />
          </call>
          <const>'Да'</const>
          <const>'Нет'</const>
        </call>
        <!--<column table="kod_sf" column="kod_sf" group="max"/>
        <column table="kod_opl" column="kod_opl" group="max"/>-->
        <!--<column table="kod_sf" column="kod_sf" group="1" />
        <column table="kod_sf" column="vid_real" group="1" />
        <column table="kod_sf" column="name" group="1" />-->
        <!--<fact table="opl" column="kod_ur_state" group="1"/>
        <column table="ur_state" column="name" group="1"/>
        <column table="kod_sf" column="kod_sf" group="1"/>-->
      </select>
      <from>
        <query name="55300-data_pre" as="a">
          <withparams>
            <usepart part="55300-withparams" />
          </withparams>
        </query>
      </from>
      <where exclude="1">
        <call function="=">
          <column table="this" column="kod_mat" />
          <const>3316</const>
        </call>
      </where>
      <having>
        <call function="or">
          <call function="!=0">
            <column table="this" column="dolg_deb_per" />
          </call>
          <call function="!=0">
            <column table="this" column="sverh_dolg_per" />
          </call>
          <call function="!=0">
            <column table="this" column="dolg_graf_per" />
          </call>
          <call function="!=0">
            <column table="this" column="dolg_deb_dat" />
          </call>
          <call function="!=0">
            <column table="this" column="sverh_dolg_dat" />
          </call>
          <call function="!=0">
            <column table="this" column="peni_dolg_resh" />
          </call>
          <call function="!=0">
            <column table="this" column="gp_dolg_resh" />
          </call>
          <call function="!=0">
            <column table="this" column="astr_dolg" />
          </call>
        </call>
      </having>
    </query>
    <query name="55300-data_pre4" timestamp="14.10.2021 04:45:44" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <params>
        <usepart part="55300-params" />
      </params>
      <select>
        <column table="a" column="kod_dog" />
        <column table="a" column="dog_sverh_dolg_dat" />
        <column table="a" column="podgr_potr" />
        <column table="a" column="podgr_potr_cust" />
        <column table="a" column="gr_potr" />
        <column table="a" column="gr_potr_kod" />
        <column table="a" column="ndog" />
        <column table="a" column="name" />
        <column table="a" column="ym" />
        <column table="a" column="ym_char" />
        <column table="a" column="is_other_vid_real" />
        <call as="max_ym" type="number" function="nvl">
          <column table="a" column="max_ym" as="" type="" />
          <column table="a" column="max_ym_other" as="" type="" />
        </call>
        <column table="a" column="dog_pp" />
        <column table="a" column="udo" />
        <column table="a" column="nachisl" />
        <column table="a" column="dolg_deb_per" />
        <column table="a" column="sverh_dolg_per" />
        <column table="a" column="sverh_dolg_per_1_3" />
        <column table="a" column="sverh_dolg_per_3_6" />
        <column table="a" column="sverh_dolg_per_6_12" />
        <column table="a" column="sverh_dolg_per_12g" />
        <column table="a" column="dat_bzad" />
        <column table="a" column="dolg_graf_per" />
        <column table="a" column="opl_cur_month" />
        <column table="a" column="dolg_deb_dat" />
        <column table="a" column="sverh_dolg_dat" />
        <column table="a" column="peni_dolg_resh" />
        <column table="a" column="gp_dolg_resh" />
        <column table="a" column="astr_dolg" />
        <column table="a" column="kod_mat" />
        <column table="a" column="sud_rab" />
        <column table="a" column="isp_info" />
        <column table="a" column="maratornaya_zadolg" />
        <column table="a" column="peni_dolg_resh_x" />
        <column table="a" column="astr_dolg_x" />
        <column table="a" column="gp_dolg_resh_x" />
        <column table="a" column="rn_x" />
        <column table="a" column="dolg_main_x" />
        <call function="if" as="del" type="number" comment="удаляем строки ГП Пени. При этом , если осн реал нет, одноу строку оставляем">
          <call type="" function="and">
            <call type="" function="or">
              <call function="!=0" as="" type="">
                <column table="a" column="dolg_main_x" />
              </call>
              <call function="!=" as="" type="">
                <column table="a" column="rn_x" />
                <const>1</const>
              </call>
            </call>
            <call function="=" as="" type="">
              <column table="a" column="is_other_vid_real" />
              <const>1</const>
            </call>
          </call>
          <const>1</const>
          <const>0</const>
        </call>
        <!--<column table="kod_sf" column="kod_sf" group="max"/>
        <column table="kod_opl" column="kod_opl" group="max"/>-->
        <!--<column table="kod_sf" column="kod_sf" group="1" />
        <column table="kod_sf" column="vid_real" group="1" />
        <column table="kod_sf" column="name" group="1" />-->
        <!--<fact table="opl" column="kod_ur_state" group="1"/>
        <column table="ur_state" column="name" group="1"/>
        <column table="kod_sf" column="kod_sf" group="1"/>-->
      </select>
      <from>
        <query name="55300-data_pre2" as="a">
          <withparams>
            <usepart part="55300-withparams" />
          </withparams>
        </query>
      </from>
      <where exclude="1">
        <call function="!=nvl">
          <column table="this" column="del" />
          <const>1</const>
        </call>
      </where>
    </query>
    <query name="55300-mat_ym" timestamp="14.10.2021 04:12:46" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <select>
        <column table="a" column="kod_mat" group="1" />
        <column table="kod_sf" column="ym" group="1" />
        <call function="row_number" as="rwnum">
          <call function="partition by">
            <column table="this" column="kod_mat" />
          </call>
          <call function="order by simple">
            <column table="this" column="ym" />
          </call>
        </call>
      </select>
      <from>
        <query name="ur_dogplat" as="a">
          <link name="kod_sf" />
        </query>
      </from>
      <where>
        <call function="=">
          <column table="a" column="vid_real" />
          <const>2</const>
        </call>
      </where>
    </query>
    <query name="belchenko_test1_blank" timestamp="18.07.2021 22:26:24" file="sql.builder.templates\sql.builder\projects\55300\all\test.xml">
      <select />
      <from />
    </query>
  </queries>
  <functions child-name="function" key-name="name" />
  <parts child-name="part" key-name="id">
    <part id="55300-params" timestamp="14.05.2024 11:02:30" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <param name="p_ym" type="number">
        <const>2021.08</const>
      </param>
      <param name="p_dat" type="date">
        <const>to_date('2021.09.21', 'YYYY.MM.DD')</const>
      </param>
      <param name="p_dep" type="number">
        <const>102276621</const>
      </param>
      <param name="p_min_debt" type="number">
        <const exclude="1">0</const>
      </param>
      <param name="p_kod_dog" type="number">
        <const exclude="1">8360</const>
      </param>
      <param name="p_cat_rep" type="string" comment="Категория отчета из таблицы kk_report_sulst" />
    </part>
    <part id="55300-withparams" timestamp="13.10.2021 15:17:01" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <useparam name="p_ym" />
      <useparam name="p_dat" />
      <useparam name="p_dep" />
      <useparam name="p_min_debt" />
      <undefined />
      <useparam name="p_cat_rep" />
    </part>
  </parts>
  <views child-name="view" key-name="id" />
  <reports child-name="report" key-name="name">
    <report name="55300" form="55300" title="Анализ состояния просроченной дебиторской задолженности" nogrid="1" timestamp="13.05.2024 13:58:33" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <params>
        <usepart part="55300-params" />
      </params>
      <customers>
        <customer id="101" />
      </customers>
      <procedure><![CDATA[
begin
	
vg_mview.refresh('vv_sr_facvip_norm_av');
	
vg_mview.refresh('vv_sr_opl_norm_av');
	

end;
]]></procedure>
      <print-templates>
        <excel>
          <template name="55300.xlsx" title="Анализ состояния просроченной дебиторской задолженности" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="55300-data" as="a">
          <withparams>
            <usepart part="55300-withparams" />
          </withparams>
        </query>
        <query name="55300-gr_potr" as="b">
          <withparams>
            <usepart part="55300-withparams" />
          </withparams>
        </query>
        <query name="55300-title" as="t">
          <withparams>
            <usepart part="55300-withparams" />
          </withparams>
        </query>
      </queries>
    </report>
  </reports>
  <forms child-name="form" key-name="name">
    <form name="55300" timestamp="14.05.2024 18:05:53" file="sql.builder.templates\sql.builder\projects\55300\all\main.xml">
      <field edit-mask="f" format="F2" title="Период" name="p_ym" type="number" editable="0" controlType="UIText" column-editable="0">
        <defaultquery>
          <query name="55300-dat_to_ym" />
        </defaultquery>
      </field>
      <usefield field="cmn_date_cur" name="p_dat" title="Дата" mandatory="1" />
      <usefield field="asuse_dep_single" name="p_dep" mandatory="1" />
      <field controlType="UINumber" edit-mask="d" format="N0" title="Просроченная ДЗ по договору более чем (в т.р.)" name="p_min_debt" type="number" />
      <field edit-mask="f" format="F2" title="Право редактирования совещаний" name="p_right_sov" type="number" editable="0" controlType="UIText" column-editable="0" visible="0">
        <defaultquery>
          <query name="55300-right_sov" />
        </defaultquery>
      </field>
      <uicommand is-ret="0" visible="p_right_sov" editable="p_right_sov" action-type="dynamic-form" call="soveshanie_55300">
        <useparam name="p_dep" />
      </uicommand>
      <field name="p_cat_rep" type="string" visible="0" controlType="UIText" title="Категория отчета">
        <defaultquery>
          <query name="category_report_num_1" />
        </defaultquery>
      </field>
    </form>
  </forms>
  <datatypes />
  <editors />
  <folders />
  <globalparams child-name="param" key-name="name" />
  <!--<globalconsts child-name="globalconst" key-name="name">
  </globalconsts>-->
  <expression-packages child-name="expression-package" key-name="name" />
  <dimension-packages child-name="dimension-package" key-name="name" />
  <security-packages child-name="security-package" key-name="name" />
  <color-packages child-name="color-package" key-name="name" />
  <format-packages child-name="format-package" key-name="name" />
  <button-types child-name="button-type" key-name="name" />
  <!--раздел qlikview организовать по аналогии с остальными вместо qlikview/customer/@id   дать имена   qwprojects/qwproject/@customer-->
  <qvprojects />
  <!--<images>
    <image char="" name="link" />
    <image char="" name="dlink" rotate-flip="RotateNoneFlipY"/>
    <image char="" name="call"/>
    <image char="" name="column"/>
  </images>
  <eltypes>
    <eltype  name="vcall" image="call"/>
    <eltype  name="vlink" image="link"/>
    <eltype  name="vdink" image="dlink"/>
    <eltype  name="vcolumn" image="column"/>
  </eltypes>-->
  <fields child-name="field" key-name="id" />
  <actions child-name="action" key-name="name" />
  <navigators child-name="navigator" key-name="name" />
  <projects child-name="project" key-name="name" />
</root>