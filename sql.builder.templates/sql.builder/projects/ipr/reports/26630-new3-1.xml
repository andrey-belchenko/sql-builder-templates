<?xml version="1.0" encoding="utf-8"?>
<root>
  <queries>
    <query name="26630-dat-new3" grouplevel="no" timestamp="12.01.2018 01:10:48" use-repository="1">
      <params>
        <usepart part="26630-params" />
      </params>
      <select>
        <usepart part="26630-common-columns" />
        <call function="time ym2 id" as="ym_nxt_dog_id" group="9">
          <column table="a" column="ym_nxt_dog" />
        </call>
        <call function="time ym2 id" as="ym_nxt_smet_id" group="10">
          <column table="a" column="ym_nxt_smet" />
        </call>
        <column table="a" column="rn_dog" />
        <column table="a" column="rn_smet" />
        <column table="a" column="kod_smet" group="2" />
        <column table="kod_smet" column="name" as="smet_name" group="kod_smet" />
        <column table="a" column="kod_dog_i" group="3" />
        <column table="kod_dog_i" column="name_i" as="dog_i_name" group="kod_dog_i" />
        <column table="kod_dog_i" column="date_i" as="dog_i_date" group="kod_dog_i" />
        <column table="a" column="kodzatrat" group="4" />
        <column table="kodzatrat" column="full_name" as="zatr_full_name" group="kodzatrat" />
        <column table="kodzatrat" column="kod_parent" as="zatr_parent" group="kodzatrat" />
        <column table="e_code" column="name" as="e_name" group="kod_dog_i" />
        <call function="nvl" as="status_name" group="kod_dog_i">
          <column table="status" column="name" />
          <!--<const>'-'</const>-->
          <call function="if">
            <call function="=">
              <column table="kod_ipr_dog" column="kod_dog_type" />
              <const>52</const>
            </call>
            <const>'-'</const>
            <const>'Плановый'</const>
          </call>
        </call>
        <column table="a" column="summ_k_rasp_usr" group="sum" mp="[:mp]" as="summ_usr" exclude="1" />
        <column table="a" column="summ_k_rasp_psd" group="sum" mp="[:mp]" as="summ_psd" exclude="1" />
        <call as="summ_psd" function="if" group="sum" mp="[:mp]">
          <call function="or">
            <call function="false" />
            <call function="=1" optional="1">
              <useparam name="pr_tek_smet" />
            </call>
          </call>
          <call function="if">
            <call function="=1">
              <column table="a" column="pr_last_smet" />
            </call>
            <column table="a" column="summ_k_rasp_psd_tek" />
          </call>
          <column table="a" column="summ_k_rasp_psd" />
        </call>
        <call as="summ_usr" function="if" group="sum" mp="[:mp]">
          <call function="or">
            <call function="false" />
            <call function="=1" optional="1">
              <useparam name="pr_tek_smet" />
            </call>
          </call>
          <call function="if">
            <call function="=1">
              <column table="a" column="pr_last_smet" />
            </call>
            <column table="a" column="summ_k_rasp_usr_tek" />
          </call>
          <column table="a" column="summ_k_rasp_usr" />
        </call>
        <column table="a" column="dog_plan_cost" group="sum" mp="[:mp]" master="kod_dog_i" />
        <call function="if" type="number" as="pr_plan" group="max">
          <call function="is not null">
            <column table="a" column="kod_ipr" />
          </call>
          <const>1</const>
        </call>
        <const as="empty" group="sum" type="number">null</const>
        <column table="a" column="dog_plan_cost_nds" group="sum" mp="[:mp]" master="kod_dog_i" />
        <!--ДЗ КЗ НЗС-->
        <column table="a" column="saldo_itog" as="sld_pl_sn_cm" group="sum" mp="[:mp]" title="Сальдо" colset="План" />
        <column table="a" column="saldo_wait_itog" as="sld_wf_sn_cm" group="sum" mp="[:mp]" title="Сальдо" colset="Ожидаемый факт" />
        <column table="a" column="saldo_fact_itog" as="sld_ft_sn_cm" group="sum" mp="[:mp]" title="Сальдо" colset="Факт" />
        <column table="a" column="deb_smet" as="smet_dz_pl_sn_cm" group="sum" mp="[:mp]" title="Дебиторская задолженность план(на уровне сметы)" colset="План" />
        <column table="a" column="kred_smet" as="smet_kz_pl_sn_cm" group="sum" mp="[:mp]" title="Дебиторская задолженность план(на уровне сметы)" colset="План" />
        <column table="a" column="deb_dog" as="dog_dz_pl_sn_cm" group="sum" mp="[:mp]" title="Дебиторская задолженность план(на уровне сметы)" colset="План" />
        <column table="a" column="kred_dog" as="dog_kz_pl_sn_cm" group="sum" mp="[:mp]" title="Дебиторская задолженность план(на уровне сметы)" colset="План" />
        <column table="a" column="nzs_itog" as="nzs_pl_bn_cm" group="sum" mp="[:mp]" title="НЗС" colset="План" />
        <column table="a" column="deb_wait_smet" as="smet_dz_wf_sn_cm" group="sum" mp="[:mp]" title="Дебиторская задолженность Ожидаемый факт(на уровне сметы)" colset="Ожидаемый факт" />
        <column table="a" column="kred_wait_smet" as="smet_kz_wf_sn_cm" group="sum" mp="[:mp]" title="Дебиторская задолженность Ожидаемый факт(на уровне сметы)" colset="Ожидаемый факт" />
        <column table="a" column="deb_wait_dog" as="dog_dz_wf_sn_cm" group="sum" mp="[:mp]" title="Дебиторская задолженность Ожидаемый факт(на уровне сметы)" colset="Ожидаемый факт" />
        <column table="a" column="kred_wait_dog" as="dog_kz_wf_sn_cm" group="sum" mp="[:mp]" title="Дебиторская задолженность Ожидаемый факт(на уровне сметы)" colset="Ожидаемый факт" />
        <column table="a" column="nzs_wait_itog" as="nzs_wf_bn_cm" group="sum" mp="[:mp]" title="НЗС" colset="Ожидаемый факт" />
        <column table="a" column="deb_fact_smet" as="smet_dz_ft_sn_cm" group="sum" mp="[:mp]" title="Дебиторская задолженность Факт(на уровне сметы)" colset="Факт" />
        <column table="a" column="kred_fact_smet" as="smet_kz_ft_sn_cm" group="sum" mp="[:mp]" title="Дебиторская задолженность Факт(на уровне сметы)" colset="Факт" />
        <column table="a" column="deb_fact_dog" as="dog_dz_ft_sn_cm" group="sum" mp="[:mp]" title="Дебиторская задолженность Факт(на уровне сметы)" colset="Факт" />
        <column table="a" column="kred_fact_dog" as="dog_kz_ft_sn_cm" group="sum" mp="[:mp]" title="Дебиторская задолженность Факт(на уровне сметы)" colset="Факт" />
        <column table="a" column="nzs_fact_c_itog" as="nzs_ft_bn_cm" group="sum" mp="[:mp]" title="НЗС" colset="Факт" />
        <!--Освоение-План-->
        <column table="a" column="kap_sum" as="os_pl_bn_gd" title="Освоение план без НДС" group="sum" mp="[:mp]" if="god" colset="План">
          <usepart part="26630-if-god" />
        </column>
        <column table="a" column="kap_nds" as="os_pl_nn_gd" title="Освоение план НДС" group="sum" mp="[:mp]" if="god" colset="План" />
        <column table="a" column="kap_sum" as="kap_sum_fix_all" title="Освоение план без НДС" group="sum" mp="[:mp]" if="all">
          <usepart part="26630-if-all" />
        </column>
        <column table="a" column="kap_sum_itog" as="os_pl_bn_cm" title="Освоение план без НДС" group="sum" mp="[:mp]" colset="План" />
        <column table="a" column="kap_nds_itog" as="os_pl_nn_cm" title="Освоение план НДС" group="sum" mp="[:mp]" colset="План" />
        <column table="a" column="kap_sum" as="os_pl_bn" title="Освоение план без НДС" group="sum" mp="[:mp]" colset="План" />
        <column table="a" column="kap_nds" as="os_pl_nn" title="Освоение план НДС" group="sum" mp="[:mp]" colset="План" />
        <!--Освоение-Ожидаемый факт-->
        <column table="a" column="kap_sum_wait_itog" as="os_wf_bn_cm" title="Освоение Ожидаемый факт без НДС" group="sum" mp="[:mp]" colset="Ожидаемый факт" />
        <column table="a" column="kap_nds_wait_itog" as="os_wf_nn_cm" title="Освоение Ожидаемый факт НДС" group="sum" mp="[:mp]" colset="Ожидаемый факт" />
        <column table="a" column="kap_sum_wait" as="os_wf_bn" title="Освоение Ожидаемый факт без НДС" group="sum" mp="[:mp]" colset="Ожидаемый факт" />
        <column table="a" column="kap_nds_wait" as="os_wf_nn" title="Освоение Ожидаемый факт НДС" group="sum" mp="[:mp]" colset="Ожидаемый факт" />
        <!--Освоение-Факт-->
        <column table="a" column="kod_schet_y" as="kod_schet" />
        <call function="if" as="kod_schet_vvod" type="number">
          <call function="=">
            <column table="kod_razdel" column="kod_root" />
            <const>246</const>
          </call>
          <const>4</const>
          <const>1</const>
        </call>
        <!--<column table="a" column="kap_sum_fact_b"  as="os_ft_bn_b"/>
        <column table="a" column="kap_nds_fact_b"  as="os_ft_nn_b"/>-->
        <call function="-nvl" as="os_ft_bn_b">
          <column table="a" column="kap_sum_fact_b" />
          <column table="this" column="nzs_pp_pg" />
        </call>
        <call function="-nvl" as="os_ft_nn_b">
          <column table="a" column="kap_nds_fact_b" />
          <column table="this" column="nzs_nn_pp_pg" />
        </call>
        <column table="this" column="os_ft_bn_b" as="os_ft_bn_s1" title="Освоение Факт без НДС" group="sum" mp="[:mp]" if="s1" colset="Факт">
          <if>
            <call function="and">
              <call function="=">
                <column table="this" column="kod_schet" />
                <const>1</const>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="os_ft_bn_b" as="os_ft_bn_s2" title="Освоение Факт без НДС" group="sum" mp="[:mp]" if="s2" colset="Факт">
          <if>
            <call function="and">
              <call function="=">
                <column table="this" column="kod_schet" />
                <const>2</const>
              </call>
            </call>
          </if>
        </column>
        <!--<call function="or">
              <call function="in">
                <column table="this" column="kod_schet" />
                <array>3</array>
              </call>
              <call function="and">
                <call function="le">
                  <column table="a" column="ym" />
                  <const>201709</const>
                </call>
                <call function="in">
                  <column table="this" column="kod_schet" />
                  <array>6,7</array>
                </call>
              </call>
            </call>-->
        <column table="this" column="os_ft_bn_b" as="os_ft_bn_s3" title="Освоение Факт без НДС" group="sum" mp="[:mp]" if="s3" colset="Факт">
          <if>
            <call function="and">
              <call function="in">
                <column table="this" column="kod_schet" />
                <array>3,6,7</array>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="os_ft_bn_b" as="os_ft_bn_s3_n" title="Освоение Факт без НДС" group="sum" mp="[:mp]" if="s3_n" colset="Факт">
          <if>
            <call function="and">
              <call function="in">
                <column table="this" column="kod_schet" />
                <array>3</array>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="os_ft_bn_b" as="os_ft_bn_s6" title="Освоение Факт без НДС" group="sum" mp="[:mp]" if="s6" colset="Факт">
          <if>
            <call function="and">
              <call function="in">
                <column table="this" column="kod_schet" />
                <array>6</array>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="os_ft_bn_b" as="os_ft_bn_s7" title="Освоение Факт без НДС" group="sum" mp="[:mp]" if="s7" colset="Факт">
          <if>
            <call function="and">
              <call function="in">
                <column table="this" column="kod_schet" />
                <array>7</array>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="os_ft_bn_b" as="os_ft_bn_s4" title="Освоение Факт без НДС" group="sum" mp="[:mp]" if="s4" colset="Факт">
          <if>
            <call function="and">
              <call function="=">
                <column table="this" column="kod_schet" />
                <const>4</const>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="os_ft_bn_b" as="os_ft_bn_s5" title="Освоение Факт без НДС" group="sum" mp="[:mp]" if="s5" colset="Факт">
          <if>
            <call function="and">
              <call function="=">
                <column table="this" column="kod_schet" />
                <const>5</const>
              </call>
            </call>
          </if>
        </column>
        <!--<call function="if">
          
        </call>-->
        <column table="a" column="kap_sum_fact_d" as="os_ft_bn" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="kap_nds_fact_d" as="os_ft_nn" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="kap_sum_fact_d" as="kap_sum_fact_fix_all" group="sum" mp="[:mp]" if="all" />
        <column table="a" column="kap_sum_fact_n" as="os_ft_bn_n" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="kap_nds_fact_n" as="os_ft_nn_n" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="kap_sum_fact_n" as="kap_sum_fact_fix_all_n" group="sum" mp="[:mp]" if="all" />
        <!--1-->
        <column table="a" column="kap_sum_fact_b_itog" as="os_ft_bn_cm_b" />
        <column table="a" column="kap_nds_fact_b_itog" as="os_nn_bn_cm_b" />
        <column table="a" column="kap_sum_fact_itog" as="os_ft_bn_cm_b_n" />
        <column table="this" column="os_ft_bn_cm_b" as="os_ft_bn_cm_s1" title="Освоение Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s1" />
        <column table="this" column="os_ft_bn_cm_b" as="os_ft_bn_cm_s2" title="Освоение Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s2" />
        <column table="this" column="os_ft_bn_cm_b" as="os_ft_bn_cm_s3" title="Освоение Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s3" />
        <column table="this" column="os_ft_bn_cm_b_n" as="os_ft_bn_cm_s3_n" title="Освоение Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s3_n" />
        <column table="this" column="os_ft_bn_cm_b" as="os_ft_bn_cm_s4" title="Освоение Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s4" />
        <column table="this" column="os_ft_bn_cm_b" as="os_ft_bn_cm_s5" title="Освоение Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s5" />
        <column table="this" column="os_ft_bn_cm_b" as="os_ft_bn_cm_s6" title="Освоение Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s6" />
        <column table="this" column="os_ft_bn_cm_b" as="os_ft_bn_cm_s7" title="Освоение Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s7" />
        <column table="a" column="kap_sum_fact_c_itog" as="os_ft_bn_cm" title="Освоение Факт НДС" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="kap_nds_fact_c_itog" as="os_ft_nn_cm" title="Освоение Факт НДС" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="kap_sum_fact_itog" as="os_ft_bn_cm_n" title="Освоение Факт НДС" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="kap_nds_fact_itog" as="os_ft_nn_cm_n" title="Освоение Факт НДС" group="sum" mp="[:mp]" colset="Факт" />
        <!--Финансирование-План-->
        <column table="a" column="fp_sum_nds" as="fn_pl_sn_gd" title="Финансирование план без НДС" group="sum" mp="[:mp]" if="god" colset="План" />
        <column table="a" column="fp_nds" as="fn_pl_nn_gd" title="Финансирование план НДС" group="sum" mp="[:mp]" if="god" colset="План" />
        <column table="a" column="fp_sum_nds" as="fp_sum_nds_fix_all" title="Финансирование план без НДС" group="sum" mp="[:mp]" if="all" />
        <column table="a" column="fp_sum_nds_itog" as="fn_pl_sn_cm" title="Финансирование план без НДС" group="sum" mp="[:mp]" colset="План" />
        <column table="a" column="fp_nds_itog" as="fn_pl_nn_cm" title="Финансирование план НДС" group="sum" mp="[:mp]" colset="План" />
        <column table="a" column="fp_sum_nds" as="fn_pl_sn" title="Финансирование план без НДС" group="sum" mp="[:mp]" colset="План" />
        <column table="a" column="fp_nds" as="fn_pl_nn" title="Финансирование план НДС" group="sum" mp="[:mp]" colset="План" />
        <!--Финансирование-Ожидаемый факт-->
        <column table="a" column="fp_sum_nds_wait_itog" as="fn_wf_sn_cm" title="Финансирование Ожидаемый факт без НДС" group="sum" mp="[:mp]" colset="Ожидаемый факт" />
        <column table="a" column="fp_nds_wait_itog" as="fn_wf_nn_cm" title="Финансирование Ожидаемый факт НДС" group="sum" mp="[:mp]" colset="Ожидаемый факт" />
        <column table="a" column="fp_sum_nds_wait" as="fn_wf_sn" title="Финансирование Ожидаемый факт без НДС" group="sum" mp="[:mp]" colset="Ожидаемый факт" />
        <column table="a" column="fp_nds_wait" as="fn_wf_nn" title="Финансирование Ожидаемый факт НДС" group="sum" mp="[:mp]" colset="Ожидаемый факт" />
        <!--Финансирование-Факт-->
        <column table="a" column="fp_sum_nds_fact_b" as="fn_ft_sn_b" />
        <column table="a" column="fp_nds_fact_b" as="fn_ft_nn_b" />
        <column table="this" column="fn_ft_sn_b" as="fp_sum_nds_fact_fix_all" title="Финансирование Факт НДС" group="sum" mp="[:mp]" if="all" />
        <column table="this" column="fn_ft_sn_b" as="fn_ft_sn_s1" title="Финансирование Факт без НДС" group="sum" mp="[:mp]" if="s1" colset="Факт" />
        <column table="this" column="fn_ft_sn_b" as="fn_ft_sn_s2" title="Финансирование Факт без НДС" group="sum" mp="[:mp]" if="s2" colset="Факт" />
        <column table="this" column="fn_ft_sn_b" as="fn_ft_sn_s3" title="Финансирование Факт без НДС" group="sum" mp="[:mp]" if="s3" colset="Факт" />
        <column table="this" column="fn_ft_sn_b" as="fn_ft_sn_s4" title="Финансирование Факт без НДС" group="sum" mp="[:mp]" if="s4" colset="Факт" />
        <column table="this" column="fn_ft_sn_b" as="fn_ft_sn_s5" title="Финансирование Факт без НДС" group="sum" mp="[:mp]" if="s5" colset="Факт" />
        <column table="this" column="fn_ft_sn_b" as="fn_ft_sn" title="Финансирование Факт без НДС" group="sum" mp="[:mp]" colset="Факт" />
        <!--1-->
        <column table="this" column="fn_ft_nn_b" as="fn_ft_nn" title="Финансирование Факт НДС" group="sum" mp="[:mp]" colset="Факт" />
        <!--1-->
        <!--1-->
        <!--1-->
        <column table="a" column="fp_sum_nds_fact_itog" as="fn_ft_sn_cm_s1" title="Финансирование Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s1" />
        <column table="a" column="fp_sum_nds_fact_itog" as="fn_ft_sn_cm_s2" title="Финансирование Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s2" />
        <column table="a" column="fp_sum_nds_fact_itog" as="fn_ft_sn_cm_s3" title="Финансирование Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s3" />
        <column table="a" column="fp_sum_nds_fact_itog" as="fn_ft_sn_cm_s4" title="Финансирование Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s4" />
        <column table="a" column="fp_sum_nds_fact_itog" as="fn_ft_sn_cm_s5" title="Финансирование Факт НДС" group="sum" mp="[:mp]" colset="Факт" if="s5" />
        <column table="a" column="fp_sum_nds_fact_itog" as="fn_ft_sn_cm" title="Финансирование Факт НДС" group="sum" mp="[:mp]" colset="Факт" />
        <!--1-->
        <column table="a" column="fp_nds_fact_itog" as="fn_ft_nn_cm" title="Финансирование Факт НДС" group="sum" mp="[:mp]" colset="Факт" />
        <!--Ввод-План-->
        <column table="a" column="vvod_sum" as="vvod_sum_fix_all" group="sum" mp="[:mp]" if="all" />
        <column table="a" column="vvod_sum" as="vv_pl_bn_gd" title="Ввод план без НДС" group="sum" mp="[:mp]" if="god" colset="План" />
        <column table="a" column="vvod_sum_itog" as="vv_pl_bn_cm" title="Ввод план без НДС" group="sum" mp="[:mp]" colset="План" />
        <column table="a" column="vvod_sum" as="vv_pl_bn" title="Ввод план без НДС" group="sum" mp="[:mp]" colset="План" />
        <!--Ввод-Ожидаемый факт-->
        <column table="a" column="vvod_sum_wait_itog" as="vv_wf_bn_cm" title="Ввод Ожидаемый факт без НДС" group="sum" mp="[:mp]" colset="Ожидаемый факт" />
        <column table="a" column="vvod_sum_wait" as="vv_wf_bn" title="Ввод Ожидаемый факт без НДС" group="sum" mp="[:mp]" colset="Ожидаемый факт" />
        <!--Ввод-Факт-->
        <column table="a" column="vvod_sum_fact" as="vv_ft_bn_s1" title="Ввод Факт без НДС" group="sum" mp="[:mp]" colset="Факт" if="vs1">
          <if>
            <call function="=">
              <column table="this" column="kod_schet_vvod" />
              <const>1</const>
            </call>
          </if>
        </column>
        <column table="a" column="vvod_sum_fact" as="vv_ft_bn_s4" title="Ввод Факт без НДС" group="sum" mp="[:mp]" colset="Факт" if="vs4">
          <if>
            <call function="=">
              <column table="this" column="kod_schet_vvod" />
              <const>4</const>
            </call>
          </if>
        </column>
        <column table="a" column="vvod_sum_fact_itog" as="vv_ft_bn_cm_s4" title="Ввод Факт без НДС" group="sum" mp="[:mp]" colset="Факт" if="vs4" />
        <column table="a" column="vvod_sum_fact_itog" as="vv_ft_bn_cm_s1" title="Ввод Факт без НДС" group="sum" mp="[:mp]" colset="Факт" if="vs1" />
        <column table="a" column="vvod_sum_fact" as="vvod_sum_fact_fix_all" group="sum" mp="[:mp]" if="all" />
        <column table="a" column="vvod_sum_fact_itog" as="vv_ft_bn_cm" title="Ввод Факт без НДС" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="vvod_sum_fact" as="vv_ft_bn" title="Ввод Факт без НДС" group="sum" mp="[:mp]" colset="Факт" />
        <!--Списание прием передача-->
        <!--Списание прием передача-Деньги-->
        <column table="a" column="kap_sum_fact_sp" as="nzs_sp_ag" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="kap_sum_fact_pp" as="nzs_pp_ag" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="kap_nds_fact_pp" as="nzs_nn_pp_ag" group="sum" mp="[:mp]" colset="Факт" />
        <call function="if" as="fin_sp_ag" group="sum" mp="[:mp]" colset="Факт">
          <call function="=1">
            <column table="a" column="pr_opl_spis" />
          </call>
          <column table="a" column="fp_sum_nds_fact" />
        </call>
        <column table="a" column="fp_sum_nds_fact_pp" as="fin_pp_ag" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="fp_nds_fact_pp" as="fin_nn_pp_ag" group="sum" mp="[:mp]" colset="Факт" />
        <!--чтобы определить if ы-->
        <column table="a" column="kap_sum_fact_sp" as="kap_sum_fact_sp_pr" group="sum" mp="[:mp]" colset="Факт" if="pr_god">
          <if>
            <call function="lt">
              <call function="ym2 god">
                <column table="a" column="ym_vozn" />
              </call>
              <call function="ym2 god">
                <column table="a" column="ym" />
              </call>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_fact_sp" as="kap_sum_fact_sp_tek" group="sum" mp="[:mp]" colset="Факт" if="tek_god">
          <if>
            <call function="=">
              <call function="ym2 god">
                <column table="a" column="ym_vozn" />
              </call>
              <call function="ym2 god">
                <column table="a" column="ym" />
              </call>
            </call>
          </if>
        </column>
        <column table="a" column="fp_sum_nds_fact_pp_pg" as="fin_pp_pg" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="fp_nds_fact_pp_pg" as="fin_nn_pp_pg" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="kap_sum_fact_pp_pg" as="nzs_pp_pg" group="sum" mp="[:mp]" colset="Факт" />
        <column table="a" column="kap_nds_fact_pp_pg" as="nzs_nn_pp_pg" group="sum" mp="[:mp]" colset="Факт" />
        <!--<column table="this" column="nzs_sp_ag" as="nzs_sp_pg" group="sum" mp="[:mp]" if="pr_god" colset="Факт" />
        <column table="this" column="fin_pp_ag" as="fin_pp_pg" group="sum" mp="[:mp]" if="pr_god" colset="Факт" />
        <column table="this" column="fin_nn_pp_ag" as="fin_nn_pp_pg" group="sum" mp="[:mp]" if="pr_god" colset="Факт" />
        <column table="this" column="nzs_pp_ag" as="nzs_pp_pg" group="sum" mp="[:mp]" if="pr_god" colset="Факт" />-->
        <column table="this" column="nzs_sp_ag" as="nzs_sp_pg" group="sum" mp="[:mp]" if="pr_god" colset="Факт" />
        <column table="this" column="nzs_sp_ag" as="nzs_sp_tg" group="sum" mp="[:mp]" if="tek_god" colset="Факт" />
        <column table="this" column="nzs_pp_ag" as="nzs_pp_tg" group="sum" mp="[:mp]" if="tek_god" colset="Факт" />
        <column table="this" column="fin_pp_ag" as="fin_pp_tg" group="sum" mp="[:mp]" if="tek_god" colset="Факт" />
        <!--Причины отклонения-->
        <column table="ipr_planfactanaliz" column="kvl_prim" as="os_prich_0" dgroup="stragg_dist" group="max" exclude="1" />
        <column table="ipr_planfactanaliz" column="fin_prim" as="fn_prich_0" dgroup="stragg_dist" group="max" exclude="1" />
        <column table="ipr_planfactanaliz" column="vv_prim" as="vv_prich_0" dgroup="stragg_dist" group="max" exclude="1" />
        <column table="kvl_krit" column="full_name1" as="os_krm_0" dgroup="stragg_dist" group="max" exclude="1" />
        <column table="fin_krit" column="full_name1" as="fn_krm_0" dgroup="stragg_dist" group="max" exclude="1" />
        <column table="vv_krit" column="full_name1" as="vv_krm_0" dgroup="stragg_dist" group="max" exclude="1" />
        <column table="kvl_krit" column="full_name" as="os_krr_0" dgroup="stragg_dist" group="max" exclude="1" />
        <column table="fin_krit" column="full_name" as="fn_krr_0" dgroup="stragg_dist" group="max" exclude="1" />
        <column table="vv_krit" column="full_name" as="vv_krr_0" dgroup="stragg_dist" group="max" exclude="1" />
        <column table="pfa" column="os_prich_0" exclude="1" />
        <column table="pfa" column="fn_prich_0" exclude="1" />
        <column table="pfa" column="vv_prich_0" exclude="1" />
        <column table="pfa" column="os_krm_0" exclude="1" />
        <column table="pfa" column="fn_krm_0" exclude="1" />
        <column table="pfa" column="vv_krm_0" exclude="1" />
        <column table="pfa" column="os_krr_0" exclude="1" />
        <column table="pfa" column="fn_krr_0" exclude="1" />
        <column table="pfa" column="vv_krr_0" exclude="1" />
        <column table="a" column="kod_ipr" group="max" />
      </select>
      <from>
        <query name="ipr_fin_body_united" as="a">
          <extendwhere exclude="1">
            <call function="and">
              <call function="=">
                <column table="kod_doc_osn" column="kod_doc" />
                <useparam name="kod_doc" />
              </call>
              <call function="in" optional="1">
                <column table="kod_main_titul" column="kod_subject" />
                <useparam name="kod_subject" />
              </call>
              <call function="or" optional="1">
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip" column="kod_direct" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="in">
                    <useparam name="kod_dirisp" />
                    <array>1,2</array>
                  </call>
                </call>
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip" column="kod_ispolnit" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="in">
                    <useparam name="kod_dirisp" />
                    <array>1,3</array>
                  </call>
                </call>
              </call>
              <call function="or" optional="1">
                <call function="in">
                  <column table="kod_titul_ip" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_main_titul" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_sbor_titul1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
              </call>
              <call function="not" optional="1">
                <call function="=">
                  <column table="kod_titul_ip" column="kod_aip" />
                  <useparam name="pr_notaip" />
                </call>
              </call>
              <call function="and" optional="1">
                <call function="=1">
                  <useparam name="pr_all_fact_not" />
                </call>
                <call function="is not null">
                  <column table="kod_ipr" column="kod_ipr" />
                </call>
              </call>
            </call>
          </extendwhere>
          <withparams exclude="1">
            <useparam name="kod_titul_ip" />
            <useparam name="year" />
          </withparams>
          <link name="check_pl_ft" />
          <link name="kod_ipr" as="ipr_ipr_data">
            <dlink name="ipr_planfactanaliz" exclude="1">
              <link name="kvl_krit" />
              <link name="vv_krit" />
              <link name="fin_krit" />
              <where>
                <call function="and">
                  <call function="=">
                    <column table="ipr_planfactanaliz" column="kod_doc" />
                    <useparam name="kod_doc" />
                  </call>
                  <call function="=">
                    <column table="ipr_planfactanaliz" column="year" />
                    <useparam name="year" />
                  </call>
                  <call function="=">
                    <column table="ipr_planfactanaliz" column="kvart" />
                    <!--<call function="mes to kv">
                      <useparam name="mon1" />
                    </call>-->
                    <call function="mes to kv">
                      <useparam name="mon2" />
                    </call>
                  </call>
                </call>
              </where>
            </dlink>
            <link name="kod_kriteria" exclude="1" />
            <link name="kod_priority_insert_ip" exclude="1" />
            <link name="kod_klass" exclude="1" />
            <link name="kod_status" />
          </link>
          <link name="kod_ipr_ext">
            <link name="kod_razdel" />
          </link>
          <link name="kod_titul_ip">
            <link name="kod_direct" />
            <link name="kod_ispolnit" />
          </link>
          <link name="kod_main_titul">
            <link name="kod_subject" as="kod_subject_main" />
            <link name="kod_direct" as="kod_direct_main" />
            <link name="kod_ispolnit" as="kod_ispolnit_main" />
            <link name="kod_sbor_titul">
              <link name="kod_titul_ip" as="kod_titul_ip_sbor" />
            </link>
          </link>
          <!--<link name="kod_dog"/>-->
          <link name="kod_smet" />
          <link name="kodzatrat" />
          <link name="kod_dog">
            <link name="e_code" />
            <link name="status" />
          </link>
          <link name="kod_dog_i" />
          <link name="kod_ipr_dog" />
        </query>
        <query name="26630-dat-new3-pfa" as="pfa" join="left outer" exclude="1">
          <call function="=">
            <column table="a" column="kod_ipr" />
            <column table="pfa" column="kod_ipr" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="kod_doc_osn" />
            <useparam name="kod_doc" />
          </call>
          <call function="in" optional="1">
            <column table="kod_main_titul" column="kod_subject" />
            <useparam name="kod_subject" />
          </call>
          <call function="or" optional="1">
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_direct" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,2</array>
              </call>
            </call>
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_ispolnit" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,3</array>
              </call>
            </call>
          </call>
          <call function="in" optional="1">
            <column table="a" column="kod_titul_ip" />
            <useparam name="kod2_titul_ip" />
          </call>
          <call function="or" optional="1" exclude="1">
            <call function="in">
              <column table="a" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="a" column="kod_main_titul" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_sbor_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
          <call function="and" optional="1">
            <call function="=1">
              <useparam name="pr_all_fact_not" />
            </call>
            <call function="=nvl">
              <column table="a" column="kod_ipr" />
              <column table="a" column="kod_ipr_ext" />
            </call>
          </call>
          <!--заменить на section-->
          <call function="or">
            <call function="is null">
              <column table="a" column="ym" />
            </call>
            <call function="and">
              <call function="le">
                <column table="a" column="ym" />
                <call function="num to ym2">
                  <useparam name="year" />
                  <const>12</const>
                </call>
              </call>
              <call function="or">
                <call function="ge">
                  <column table="a" column="ym" />
                  <call function="ym2 add month">
                    <call function="num to ym2">
                      <useparam name="year" />
                      <const>1</const>
                    </call>
                    <const>-1</const>
                  </call>
                </call>
                <call function="ge">
                  <column table="a" column="ym_nxt" />
                  <call function="ym2 add month">
                    <call function="num to ym2">
                      <useparam name="year" />
                      <const>1</const>
                    </call>
                    <const>-1</const>
                  </call>
                </call>
                <call function="is null">
                  <column table="a" column="ym_nxt" />
                </call>
              </call>
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_titul_ip" column="pr_ofz" />
            <useparam name="kod_ofz" />
          </call>
          <call function="is not null" comment="химия. когда вырезается условие по подразделениям , дает ошибку из-за лишнего параметра">
            <useparam name="kod_dirisp" />
          </call>
          <call function="and" optional="1">
            <call function="=1">
              <useparam name="pr_no_zero" />
            </call>
            <call function="!=">
              <column table="this" column="pr_check_plan_fact" />
              <const>3</const>
            </call>
          </call>
          <!--<call function="between">
            <call function="nvl">
              <column table="a" column="ym" />
              <call function="num to ym2">
                <useparam  name="year"/>
                <useparam  name="mon1"/>
              </call>
            </call>
            <call function="ym2 add month">
              <call function="num to ym2">
                <useparam  name="year"/>
                <const>1</const>
              </call>
              <const>-1</const>
            </call>
            <call function="num to ym2">
              <useparam  name="year"/>
              <const>12</const>
            </call>
          </call>-->
        </call>
        <call function="false" exclude="1" />
      </where>
    </query>
    <query name="26630-dat-new3-pfa" grouplevel="no" timestamp="22.01.2018 19:24:36" use-repository="1">
      <params>
        <usepart part="26630-params" />
      </params>
      <select>
        <column table="kod_ipr" column="kod_ipr" group="1" />
        <!--ДЗ КЗ НЗС-->
        <!--Освоение-План-->
        <!--Освоение-Ожидаемый факт-->
        <!--Освоение-Факт-->
        <!--<column table="a" column="kap_sum_fact_b"  as="os_ft_bn_b"/>
        <column table="a" column="kap_nds_fact_b"  as="os_ft_nn_b"/>-->
        <!--<call function="or">
              <call function="in">
                <column table="this" column="kod_schet" />
                <array>3</array>
              </call>
              <call function="and">
                <call function="le">
                  <column table="a" column="ym" />
                  <const>201709</const>
                </call>
                <call function="in">
                  <column table="this" column="kod_schet" />
                  <array>6,7</array>
                </call>
              </call>
            </call>-->
        <!--<call function="if">
          
        </call>-->
        <!--1-->
        <!--Финансирование-План-->
        <!--Финансирование-Ожидаемый факт-->
        <!--Финансирование-Факт-->
        <!--1-->
        <!--1-->
        <!--1-->
        <!--1-->
        <!--1-->
        <!--Ввод-План-->
        <!--Ввод-Ожидаемый факт-->
        <!--Ввод-Факт-->
        <!--Списание прием передача-->
        <!--Списание прием передача-Деньги-->
        <!--чтобы определить if ы-->
        <!--<column table="this" column="nzs_sp_ag" as="nzs_sp_pg" group="sum" mp="[:mp]" if="pr_god" colset="Факт" />
        <column table="this" column="fin_pp_ag" as="fin_pp_pg" group="sum" mp="[:mp]" if="pr_god" colset="Факт" />
        <column table="this" column="fin_nn_pp_ag" as="fin_nn_pp_pg" group="sum" mp="[:mp]" if="pr_god" colset="Факт" />
        <column table="this" column="nzs_pp_ag" as="nzs_pp_pg" group="sum" mp="[:mp]" if="pr_god" colset="Факт" />-->
        <!--Причины отклонения-->
        <column table="ipr_planfactanaliz" column="kvl_prim" as="os_prich_0" dgroup="stragg_dist" group="stragg" />
        <column table="ipr_planfactanaliz" column="fin_prim" as="fn_prich_0" dgroup="stragg_dist" group="stragg" />
        <column table="ipr_planfactanaliz" column="vv_prim" as="vv_prich_0" dgroup="stragg_dist" group="stragg" />
        <column table="kvl_krit" column="full_name1" as="os_krm_0" dgroup="stragg_dist" group="stragg" />
        <column table="fin_krit" column="full_name1" as="fn_krm_0" dgroup="stragg_dist" group="stragg" />
        <column table="vv_krit" column="full_name1" as="vv_krm_0" dgroup="stragg_dist" group="stragg" />
        <column table="kvl_krit" column="full_name" as="os_krr_0" dgroup="stragg_dist" group="stragg" />
        <column table="fin_krit" column="full_name" as="fn_krr_0" dgroup="stragg_dist" group="stragg" />
        <column table="vv_krit" column="full_name" as="vv_krr_0" dgroup="stragg_dist" group="stragg" />
      </select>
      <from>
        <query name="ipr_planfactanaliz">
          <link name="kod_ipr" />
          <link name="kvl_krit" />
          <link name="vv_krit" />
          <link name="fin_krit" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="ipr_planfactanaliz" column="kod_doc" />
            <useparam name="kod_doc" />
          </call>
          <call function="=">
            <column table="ipr_planfactanaliz" column="year" />
            <useparam name="year" />
          </call>
          <call function="=">
            <column table="ipr_planfactanaliz" column="kvart" />
            <!--<call function="mes to kv">
                      <useparam name="mon1" />
                    </call>-->
            <call function="mes to kv">
              <useparam name="mon2" />
            </call>
          </call>
        </call>
      </where>
    </query>
  </queries>
</root>