<?xml version="1.0" encoding="utf-8"?>
<root>
  <parts>
    <part id="29611-params" timestamp="24.10.2016 11:01:48">
      <param name="year" />
      <param name="kv" />
      <param name="kod_doc" />
      <param name="kod_direct" />
      <param name="kod_dirisp" />
      <param name="pr_notaip" />
      <param name="pr_gorobl" />
      <param name="krit_autor" />
      <param name="pr_sbor" />
      <param name="mes" />
      <param name="pr_aip_detail" />
      <param name="kod_ofz" />
    </part>
    <part id="29611-withparams" timestamp="24.10.2016 11:02:03">
      <withparams>
        <useparam name="year" />
        <useparam name="kv" />
        <useparam name="kod_doc" />
        <useparam name="kod_direct" />
        <useparam name="kod_dirisp" />
        <useparam name="pr_notaip" />
        <useparam name="pr_gorobl" />
        <useparam name="krit_autor" />
        <useparam name="pr_sbor" />
        <useparam name="mes" />
        <useparam name="pr_aip_detail" />
        <useparam name="kod_ofz" />
      </withparams>
    </part>
  </parts>
  <forms>
    <form name="29611" timestamp="21.11.2016 14:26:58" with-behavior="0">
      <content>
        <field name="year" type="number" controlType="UICombo" title="Год" mandatory="1">
          <listquery>
            <query name="25499-year_list" />
          </listquery>
          <defaultquery>
            <query name="25499-year_def" />
          </defaultquery>
        </field>
        <field name="kv" type="number" controlType="UICombo" title="Период" mandatory="1">
          <listquery>
            <query name="spr_time_kv_ni" />
          </listquery>
          <defaultquery>
            <query name="spr_time_kv_ni_cur" />
          </defaultquery>
        </field>
        <field name="kod_doc" type="number" controlType="UICombo" title="Документ" mandatory="1">
          <listquery>
            <query name="25499-ipr_doc_main_list" />
          </listquery>
        </field>
        <field name="kod_direct" type="number" controlType="UIList" title="Подразделение" show-nulls="0">
          <listquery>
            <query name="25499-ipr_direct" />
          </listquery>
        </field>
        <field name="kod_dirisp" type="number" controlType="UICombo" title="Заказчик/Исполнитель" mandatory="1">
          <listquery>
            <query name="is_spr_dirisp2" />
          </listquery>
          <defaultquery>
            <query name="is_spr_dirisp_isp" />
          </defaultquery>
        </field>
        <field name="pr_notaip" type="number" controlType="UICheck" title="Исключить титулы АИП" />
        <field name="pr_gorobl" type="number" controlType="UICheck" title="Город/область" />
        <field name="krit_autor" type="number" controlType="UICombo" title="ОАО «Россети»/Минэнерго" mandatory="1">
          <listquery>
            <query name="ips_kriteria_otklon_autor" />
          </listquery>
          <defaultquery>
            <query name="ips_kriteria_otklon_autor_def" />
          </defaultquery>
        </field>
        <field name="pr_sbor" type="number" controlType="UICheck" title="Отображать сборные" />
        <field name="colsets_pre" type="string" controlType="UIList" title="План/Лимит">
          <listquery>
            <query name="29611_cols_pf" />
          </listquery>
          <defaultquery>
            <query name="29611_cols_pf" />
          </defaultquery>
        </field>
        <field name="pr_wait" type="number" controlType="UICheck" title="План и ожидаемый факт на месяц" />
        <field name="mes" type="number" controlType="UICombo" mandatory="1" title="Месяц для анализа ожидаемого факта" visible="pr_wait">
          <listquery>
            <query name="spr_time_mes" />
          </listquery>
          <defaultquery>
            <query name="29611_mon_def" />
          </defaultquery>
        </field>
        <field name="colsets" type="string" controlType="UIList" special-type="colsets" title="Вывод колонок" visible="0">
          <defaultquery>
            <query name="29611_cols_def" />
          </defaultquery>
        </field>
        <field name="pr_aip_detail" type="number" controlType="UICheck" title="Детализация по титулам АИП" checked="1" />
        <usefield field="ipr_kod_ofz" />
      </content>
    </form>
  </forms>
  <reports>
    <report name="29611" title="План-факторный анализ" form="29611" folder="invpro" nogrid="1" edit-columns="2" timestamp="03.10.2016 13:32:30" datareader="1">
      <params>
        <usepart part="29611-params" />
      </params>
      <print-templates>
        <excel>
          <template name="29611.xml" title="План-факторный анализ" conv-to-openxml="0" print-proc="2" del-cols="1" headmarker="1" />
        </excel>
      </print-templates>
      <customers>
        <customer id="17" />
      </customers>
      <queries>
        <query name="29611-gr" as="a" node-id="growid" parent-node-id="parent_growid">
          <usepart part="29611-withparams" />
        </query>
        <query name="29611-title" as="b">
          <usepart part="29611-withparams" />
        </query>
      </queries>
    </report>
  </reports>
  <queries>
    <query name="29611-title" timestamp="17.07.2016 17:44:46">
      <params>
        <usepart part="29611-params" />
      </params>
      <select>
        <call function="replace" as="name_direct" type="string">
          <column table="a" column="name_direct" group="stragg_dist" />
          <const>','</const>
          <const>'; '</const>
        </call>
        <call function="" as="year" group="max" type="number">
          <useparam name="year" />
        </call>
        <!--<call function="" as="kv" group="max" type="number">
          <useparam name="kv" />
        </call>-->
        <call function="decode" as="kv" type="string">
          <useparam name="kv" />
          <const as="id" type="number">1</const>
          <const as="name" type="string">'1 квартал'</const>
          <const>2</const>
          <const>'1 полугодие'</const>
          <const>3</const>
          <const>'9 месяцев'</const>
          <const>4</const>
          <const>''</const>
        </call>
        <call as="mes_name" function="mes-name">
          <useparam name="mes" />
        </call>
      </select>
      <from>
        <query name="25499-ipr_direct" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <column table="a" column="kod_direct" />
            <useparam name="kod_direct" />
          </call>
          <call function="true" />
        </call>
      </where>
    </query>
    <query name="29611-gr" timestamp="16.10.2018 18:13:34">
      <params>
        <usepart part="29611-params" />
      </params>
      <select>
        <column table="a" column="*" />
        <call function="/nvl" as="otkl_kap_pl_perc" colset="План" title="% отклонения факта от плана" mp="2">
          <column table="a" column="otkl_kap_pl" />
          <column table="a" column="kap_sum" />
        </call>
        <call function="/nvl" as="otkl_kap_lim_perc" colset="Лимит" title="% Отклонение факта от лимита" mp="2">
          <column table="a" column="otkl_kap_lim" />
          <column table="a" column="kap_lim_sum" />
        </call>
        <call function="/nvl" as="otkl_fp_pl_perc" colset="План" title="% Отклонение факта от плана" mp="2">
          <column table="a" column="otkl_fp_pl" />
          <column table="a" column="fp_sum_nds" />
        </call>
        <call function="/nvl" as="otkl_fp_lim_perc" colset="Лимит" title="% Отклонение факта от лимита" mp="2">
          <column table="a" column="otkl_fp_lim" />
          <column table="a" column="fp_lim_sum_nds" />
        </call>
        <call function="/nvl" as="otkl_vvod_pl_perc" colset="План" title="% Отклонение факта от плана" mp="2">
          <column table="a" column="otkl_vvod_pl" />
          <column table="a" column="vvod_sum" />
        </call>
        <call function="/nvl" as="otkl_vvod_lim_perc" colset="Лимит" title="% Отклонение факта от лимита" mp="2">
          <column table="a" column="otkl_vvod_lim" />
          <column table="a" column="vvod_lim_sum" />
        </call>
        <call function="/nvl" as="otkl_pow_mba_perc" title="% Отклонение факта от плана" mp="2" colset="Ожидаемый факт">
          <column table="a" column="otkl_pow_mba" />
          <column table="a" column="pow_mba" />
        </call>
        <call function="/nvl" as="otkl_pow_km_all_perc" title="% Отклонение факта от плана" mp="2" colset="Ожидаемый факт">
          <column table="a" column="otkl_pow_km_all" />
          <column table="a" column="pow_km_all" />
        </call>
        <call function="/nvl" as="otkl_kap_mes_perc" title="% отклонения факта от плана" mp="2" colset="Ожидаемый факт">
          <column table="a" column="otkl_kap_mes" />
          <column table="a" column="kap_sum_mes" />
        </call>
        <call function="/nvl" as="otkl_fp_mes_perc" title="% Отклонение факта от плана" mp="2" colset="Ожидаемый факт">
          <column table="a" column="otkl_fp_mes" />
          <column table="a" column="fp_sum_nds_mes" />
        </call>
        <call function="/nvl" as="otkl_vvod_mes_perc" title="% Отклонение факта от плана" mp="2" colset="Ожидаемый факт">
          <column table="a" column="otkl_vvod_mes" />
          <column table="a" column="vvod_sum_mes" />
        </call>
        <call function="/nvl" as="otkl_pow_mba_mes_perc" title="% Отклонение факта от плана" mp="2" colset="Ожидаемый факт">
          <column table="a" column="otkl_pow_mba_mes" />
          <column table="a" column="pow_mba_mes" />
        </call>
        <call function="/nvl" as="otkl_pow_km_all_mes_perc" title="% Отклонение факта от плана" mp="2" colset="Ожидаемый факт">
          <column table="a" column="otkl_pow_km_all_mes" />
          <column table="a" column="pow_km_all_mes" />
        </call>
      </select>
      <from>
        <query name="29611" as="a">
          <usepart part="29611-withparams" />
          <grsets>
            <grset level="1" as="itog" title="Группа" order="go_grp">
              <where>
                <call function="is not null">
                  <column table="a" column="go_grp" />
                </call>
              </where>
              <grset level="4" as="sbor" title="Сборный титул" order="subject_abbr,podr_abbr_sbor,tit_num_new_sbor">
                <where exclude="1">
                  <call function="or">
                    <call function="and" optional="1">
                      <call function="=">
                        <call function="nvlu">
                          <useparam name="pr_aip_detail" />
                          <const>0</const>
                        </call>
                        <const>1</const>
                      </call>
                      <call function="=">
                        <column table="a" column="kod_aip_sbor" />
                        <const>1</const>
                      </call>
                    </call>
                    <call function="=">
                      <column table="a" column="kod_aip_sbor" nvl="0" />
                      <const>0</const>
                    </call>
                  </call>
                </where>
                <grset level="" as="sborinfo" title="Сборный титул(информация)">
                  <where>
                    <call function="and">
                      <call function="is not null">
                        <column table="a" column="kod_titul_ip_sbor" />
                      </call>
                      <call function="=">
                        <call function="nvlu">
                          <useparam name="pr_sbor" />
                          <const>0</const>
                        </call>
                        <const>1</const>
                      </call>
                    </call>
                  </where>
                </grset>
                <grset level="2" as="main" title="Головной/ одиночный титул" order="subject_abbr,podr_abbr_main,tit_num_new_main">
                  <where>
                    <call function="and">
                      <call function="=0">
                        <column table="a" column="is_sbor_main" />
                      </call>
                      <call function="or">
                        <call function="and" optional="1">
                          <call function="=">
                            <call function="nvlu">
                              <useparam name="pr_aip_detail" />
                              <const>0</const>
                            </call>
                            <const>1</const>
                          </call>
                          <call function="=">
                            <column table="a" column="kod_aip_main" />
                            <const>1</const>
                          </call>
                        </call>
                        <call function="=">
                          <column table="a" column="kod_aip_main" />
                          <const>0</const>
                        </call>
                      </call>
                    </call>
                  </where>
                  <grset level="" as="head" title="Головной титул">
                    <where>
                      <call function="=">
                        <column table="a" column="is_head_tit" />
                        <const>1</const>
                      </call>
                    </where>
                    <grset level="" as="head1" title="Головной титул (без дочерних)">
                      <where>
                        <call function="=">
                          <column table="a" column="is_head_tit1" />
                          <const>1</const>
                        </call>
                      </where>
                    </grset>
                  </grset>
                  <grset level="" as="single" title="Одиночный титул">
                    <where>
                      <call function="!=nvl">
                        <column table="a" column="is_head_tit" />
                        <const>1</const>
                      </call>
                    </where>
                  </grset>
                  <grset level="3" as="child" title="Дочерний титул" order="subject_abbr,podr_abbr,tit_num_new">
                    <where>
                      <call function="and">
                        <call function="or">
                          <call function="and" optional="1">
                            <call function="=">
                              <call function="nvlu">
                                <useparam name="pr_aip_detail" />
                                <const>0</const>
                              </call>
                              <const>1</const>
                            </call>
                            <call function="=">
                              <column table="a" column="kod_aip_child" />
                              <const>1</const>
                            </call>
                          </call>
                          <call function="=">
                            <column table="a" column="kod_aip_child" />
                            <const>0</const>
                          </call>
                        </call>
                        <call function="is not null">
                          <column table="a" column="kod_child_titul" />
                        </call>
                      </call>
                    </where>
                  </grset>
                </grset>
              </grset>
            </grset>
          </grsets>
        </query>
      </from>
    </query>
    <query name="29611-test">
      <select>
        <column table="ipr_ipr_data" column="kod_ipr" />
        <column table="ipr_fin_body_united" column="fp_sum" dgroup="sum" />
      </select>
      <from>
        <query name="ipr_ipr_data">
          <dlink name="ipr_fin_body_united" />
        </query>
      </from>
    </query>
    <query name="29611" grouplevel="no" timestamp="08.01.2018 16:36:24">
      <params>
        <usepart part="29611-params" />
      </params>
      <select>
        <call function="if" as="go_grp" group="1" title="Группа">
          <call function="=">
            <call function="nvlu">
              <useparam name="pr_gorobl" />
              <const>0</const>
            </call>
            <const>0</const>
          </call>
          <const>'СПб и ЛО'</const>
          <column table="kod_subject" column="abbr" />
        </call>
        <column table="kod_titul_ip_sbor" column="kod_titul_ip" group="4" as="kod_sbor_titul" />
        <column table="kod_titul_ip_sbor" column="kod_titul_ip" as="kod_titul_ip_sbor" group="kod_sbor_titul" />
        <column table="kod_titul_ip_sbor" column="tit_num_new_n" as="tit_num_new_sbor" group="kod_sbor_titul" title="Номер сборного" />
        <column table="kod_titul_ip_sbor" column="full_name" as="+_sbor" group="kod_sbor_titul" title="Наименование сборного титула" />
        <column table="kod_titul_ip_sbor" column="beg_year" as="+_sbor" group="kod_sbor_titul" />
        <column table="kod_titul_ip_sbor" column="end_year" as="+_sbor" group="kod_sbor_titul" />
        <column table="kod_direct_sbor" column="name_kr" as="direct_sbor_abbr" group="kod_sbor_titul" title="Заказчик сборного титула" />
        <column table="kod_ispolnit_sbor" column="name_kr" as="ispolnit_sbor_abbr" group="kod_sbor_titul" title="Исполнитель сборного титула" />
        <column table="kod_titul_ip_sbor" column="kod_aip" as="kod_aip_sbor" group="kod_sbor_titul" />
        <call function="if" group="kod_sbor_titul" as="podr_abbr_sbor" title="Подразделение сборного титула" description="Подразделение заказчика или исполнителя">
          <call function="=">
            <useparam name="kod_dirisp" />
            <const>3</const>
          </call>
          <column table="kod_ispolnit_sbor" column="name_kr" />
          <column table="kod_direct_sbor" column="name_kr" />
        </call>
        <column table="kod_ipr" column="kod_main_titul" group="2" />
        <column table="kod_main_titul" column="tit_num_new_n" as="tit_num_new_main" group="kod_main_titul" title="Номер головного/одиночного титула" />
        <column table="kod_main_titul" column="full_name" as="full_name_main" group="kod_main_titul" title="Наименование головного/одиночного титула" />
        <column table="kod_main_titul" column="beg_year" as="beg_year_main" group="kod_main_titul" />
        <column table="kod_main_titul" column="end_year" as="end_year_main" group="kod_main_titul" />
        <column table="kod_main_titul" column="is_head_tit" group="kod_main_titul" />
        <column table="kod_main_titul" column="is_sbor" as="is_sbor_main" group="kod_main_titul" />
        <column table="kod_titul_ip" column="is_head_tit" as="is_head_tit1" />
        <column table="kod_subject" column="kod_subject" group="kod_main_titul" />
        <column table="kod_subject" column="abbr" as="subject_abbr" group="kod_main_titul" />
        <column table="kod_direct_main" column="name_kr" as="direct_main_abbr" group="kod_main_titul" title="Заказчик головного/одиночного титула" />
        <column table="kod_ispolnit_main" column="name_kr" as="ispolnit_main_abbr" group="kod_main_titul" title="Исполнитель головного/одиночного титула" />
        <column table="kod_main_titul" column="kod_aip" as="kod_aip_main" group="kod_main_titul" />
        <call function="if" group="kod_main_titul" as="podr_abbr_main" title="Подразделение головного/одиночного титула">
          <call function="=">
            <useparam name="kod_dirisp" />
            <const>3</const>
          </call>
          <column table="kod_ispolnit_main" column="name_kr" />
          <column table="kod_direct_main" column="name_kr" />
        </call>
        <column table="kod_ipr" column="kod_child_titul" group="3" />
        <column table="kod_titul_ip" column="is_sbor" group="kod_child_titul" />
        <column table="kod_titul_ip" column="tit_num_new_n" group="kod_child_titul" title="Номер дочернего титула" as="tit_num_new" />
        <column table="kod_titul_ip" column="full_name" group="kod_child_titul" title="Наименование дочернего титула" />
        <column table="kod_titul_ip" column="beg_year" group="kod_child_titul" />
        <column table="kod_titul_ip" column="end_year" group="kod_child_titul" />
        <column table="kod_titul_ip" column="kod_aip" as="kod_aip_child" group="kod_child_titul" />
        <column table="kod_direct" column="name_kr" as="direct_abbr" group="kod_child_titul" title="Заказчик дочернего титула" />
        <column table="kod_ispolnit" column="name_kr" as="ispolnit_abbr" group="kod_child_titul" title="Исполнитель дочернего титула" />
        <column table="a" column="kod_ipr" group="max" />
        <call function="if" group="kod_child_titul" as="podr_abbr" title="Подразделение дочернего титула">
          <call function="=">
            <useparam name="kod_dirisp" />
            <const>3</const>
          </call>
          <column table="kod_ispolnit" column="name_kr" />
          <column table="kod_direct" column="name_kr" />
        </call>
        <column table="a" column="ipr_fin_ipr" group="sum" />
        <column table="a" column="kap_sum" group="sum" mp="-3" colset="План" if="kv">
          <if>
            <call function="le">
              <call function="mes to kv">
                <column table="a" column="period" />
              </call>
              <useparam name="kv" />
            </call>
          </if>
        </column>
        <column table="a" column="kap_lim_sum" group="sum" mp="-3" colset="Лимит" if="kv" />
        <column table="a" column="kap_sum_fact_a" group="sum" mp="-3" if="kv" as="kap_sum_fact" exclude="1" />
        <column table="a" column="kap_sum_fact_d" group="sum" mp="-3" if="kv" as="kap_sum_fact" exclude="1" />
        <call function="if" as="kap_sum_fact" group="sum" title="Отклонение фактического освоения от планового освоения" type="number">
          <call function="le">
            <call function="num to ym2">
              <useparam name="year" />
              <call function="kv end mes">
                <useparam name="kv" />
              </call>
            </call>
            <const>201709</const>
          </call>
          <column table="a" column="kap_sum_fact_d" mp="-3" if="kv" />
          <column table="a" column="kap_sum_fact_n" mp="-3" if="kv" />
        </call>
        <call function="-nvl" as="otkl_kap_pl" colset="План" title="Отклонение факта от плана" group="sum">
          <column table="this" column="kap_sum_fact" />
          <column table="this" column="kap_sum" />
        </call>
        <call function="-nvl" as="otkl_kap_lim" colset="Лимит" title="Отклонение факта от лимита" group="sum">
          <column table="this" column="kap_sum_fact" />
          <column table="this" column="kap_lim_sum" />
        </call>
        <column table="a" column="fp_sum_nds" group="sum" mp="-3" colset="План" if="kv" />
        <column table="a" column="fp_lim_sum_nds" group="sum" mp="-3" colset="Лимит" if="kv" />
        <column table="a" column="fp_sum_nds_fact_a" group="sum" mp="-3" if="kv" as="fp_sum_nds_fact" exclude="1" />
        <column table="a" column="fp_sum_nds_fact_b" group="sum" mp="-3" if="kv" as="fp_sum_nds_fact" />
        <call function="-nvl" as="otkl_fp_pl" colset="План" title="Отклонение факта от плана" group="sum">
          <column table="this" column="fp_sum_nds_fact" />
          <column table="this" column="fp_sum_nds" />
        </call>
        <call function="-nvl" as="otkl_fp_lim" colset="Лимит" title="Отклонение факта от лимита" group="sum">
          <column table="this" column="fp_sum_nds_fact" />
          <column table="this" column="fp_lim_sum_nds" />
        </call>
        <column table="a" column="vvod_sum" group="sum" mp="-3" colset="План" if="kv" />
        <column table="a" column="vvod_lim_sum" group="sum" mp="-3" colset="Лимит" if="kv" />
        <column table="a" column="vvod_sum_fact" group="sum" mp="-3" if="kv" />
        <call function="-nvl" as="otkl_vvod_pl" colset="План" title="Отклонение факта от плана" group="sum">
          <column table="this" column="vvod_sum_fact" />
          <column table="this" column="vvod_sum" />
        </call>
        <call function="-nvl" as="otkl_vvod_lim" colset="Лимит" title="Отклонение факта от лимита" group="sum">
          <column table="this" column="vvod_sum_fact" />
          <column table="this" column="vvod_lim_sum" />
        </call>
        <column table="a" column="pow_mba" group="sum" if="kv" />
        <column table="a" column="pow_km_all" group="sum" if="kv" />
        <column table="a" column="pow_other" group="sum" if="kv" />
        <column table="a" column="pow_mba_pr" group="sum" if="kv" />
        <column table="a" column="pow_km_all_pr" group="sum" if="kv" />
        <column table="a" column="pow_other_pr" group="sum" if="kv" />
        <column table="a" column="pow_mba_fact" group="sum" if="kv" />
        <column table="a" column="pow_km_all_fact" group="sum" if="kv" />
        <column table="a" column="pow_other_fact" group="sum" if="kv" />
        <column table="a" column="pow_mba_fact_pr" group="sum" if="kv" />
        <column table="a" column="pow_km_all_fact_pr" group="sum" if="kv" />
        <column table="a" column="pow_other_fact_pr" group="sum" if="kv" />
        <call function="-nvl" as="otkl_pow_mba" title="Отклонение факта от плана" group="sum">
          <column table="this" column="pow_mba_fact" />
          <column table="this" column="pow_mba" />
        </call>
        <call function="-nvl" as="otkl_pow_km_all" title="Отклонение факта от плана" group="sum">
          <column table="this" column="pow_km_all_fact" />
          <column table="this" column="pow_km_all" />
        </call>
        <column table="a" column="pfa_kvl_prim" group="max" if="kv1">
          <if>
            <call function="=">
              <column table="a" column="kvart" />
              <useparam name="kv" />
            </call>
          </if>
        </column>
        <column table="a" column="pfa_vv_prim" group="max" if="kv1" />
        <column table="a" column="pfa_fin_prim" group="max" if="kv1" />
        <column table="a" column="pfa_mba_prim" group="max" if="kv1" />
        <column table="a" column="pfa_km_prim" group="max" if="kv1" />
        <column table="a" column="pfa_kvl_krit_name" group="max" if="kv1" />
        <column table="a" column="pfa_vv_krit_name" group="max" if="kv1" />
        <column table="a" column="pfa_fin_krit_name" group="max" if="kv1" />
        <column table="a" column="pfa_kvl_krit_name1" group="max" if="kv1" />
        <column table="a" column="pfa_vv_krit_name1" group="max" if="kv1" />
        <column table="a" column="pfa_fin_krit_name1" group="max" if="kv1" />
        <call function="if" group="max" as="fa_kvl_krit_name_a" title="Критерий отклонения по освоению">
          <call function="=">
            <useparam name="krit_autor" />
            <const>0</const>
          </call>
          <column table="this" column="pfa_kvl_krit_name" />
          <column table="this" column="pfa_kvl_krit_name1" />
        </call>
        <call function="if" group="max" as="fa_vv_krit_name_a" title="Критерий отклонения по вводу">
          <call function="=">
            <useparam name="krit_autor" />
            <const>0</const>
          </call>
          <column table="this" column="pfa_vv_krit_name" />
          <column table="this" column="pfa_vv_krit_name1" />
        </call>
        <call function="if" group="max" as="fa_fin_krit_name_a" title="Критерий отклонения по финансированию">
          <call function="=">
            <useparam name="krit_autor" />
            <const>0</const>
          </call>
          <column table="this" column="pfa_fin_krit_name" />
          <column table="this" column="pfa_fin_krit_name1" />
        </call>
        <column table="sbor_fin" column="pfa_kvl_prim" as="+_sbor" group="max" dgroup="max" if="kv1" />
        <column table="sbor_fin" column="pfa_vv_prim" group="max" as="+_sbor" dgroup="max" if="kv1" />
        <column table="sbor_fin" column="pfa_fin_prim" group="max" as="+_sbor" dgroup="max" if="kv1" />
        <column table="sbor_fin" column="pfa_mba_prim" group="max" as="+_sbor" dgroup="max" if="kv1" />
        <column table="sbor_fin" column="pfa_km_prim" group="max" as="+_sbor" dgroup="max" if="kv1" />
        <column table="sbor_fin" column="pfa_kvl_krit_name" group="max" as="+_sbor" dgroup="max" if="kv1" />
        <column table="sbor_fin" column="pfa_vv_krit_name" group="max" as="+_sbor" dgroup="max" if="kv1" />
        <column table="sbor_fin" column="pfa_fin_krit_name" group="max" as="+_sbor" dgroup="max" if="kv1" />
        <column table="sbor_fin" column="pfa_kvl_krit_name1" group="max" as="+_sbor" dgroup="max" if="kv1" />
        <column table="sbor_fin" column="pfa_vv_krit_name1" group="max" as="+_sbor" dgroup="max" if="kv1" />
        <column table="sbor_fin" column="pfa_fin_krit_name1" group="max" as="+_sbor" dgroup="max" if="kv1" />
        <call function="if" as="fa_kvl_krit_name_a_sbor" group="max" title="Критерий отклонения по освоению">
          <call function="=">
            <useparam name="krit_autor" />
            <const>0</const>
          </call>
          <column table="this" column="pfa_kvl_krit_name_sbor" />
          <column table="this" column="pfa_kvl_krit_name1_sbor" />
        </call>
        <call function="if" as="fa_vv_krit_name_a_sbor" group="max" title="Критерий отклонения по вводу">
          <call function="=">
            <useparam name="krit_autor" />
            <const>0</const>
          </call>
          <column table="this" column="pfa_vv_krit_name_sbor" />
          <column table="this" column="pfa_vv_krit_name1_sbor" />
        </call>
        <call function="if" as="fa_fin_krit_name_a_sbor" group="max" title="Критерий отклонения по финансированию">
          <call function="=">
            <useparam name="krit_autor" />
            <const>0</const>
          </call>
          <column table="this" column="pfa_fin_krit_name_sbor" />
          <column table="this" column="pfa_fin_krit_name1_sbor" />
        </call>
        <column table="a" column="kap_sum_wait" group="sum" mp="-3" if="mes" colset="Ожидаемый факт">
          <if>
            <call function="le">
              <column table="a" column="period" />
              <useparam name="mes" />
            </call>
          </if>
        </column>
        <column table="a" column="fp_sum_nds_wait" group="sum" mp="-3" if="mes" colset="Ожидаемый факт" />
        <column table="a" column="vvod_sum_wait" group="sum" mp="-3" if="mes" colset="Ожидаемый факт" />
        <column table="a" column="pow_mba_wait" group="sum" mp="-3" if="mes" colset="Ожидаемый факт" />
        <column table="a" column="pow_km_all_wait" group="sum" if="mes" colset="Ожидаемый факт" />
        <column table="a" column="pow_other_wait" group="sum" if="mes" colset="Ожидаемый факт" />
        <column table="a" column="pow_mba_wait_pr" group="sum" if="mes" mp="-3" colset="Ожидаемый факт" />
        <column table="a" column="pow_km_all_wait_pr" group="sum" if="mes" colset="Ожидаемый факт" />
        <column table="a" column="pow_other_wait_pr" group="sum" if="mes" colset="Ожидаемый факт" />
        <column table="a" column="kap_sum" group="sum" mp="-3" if="mes" as="kap_sum_mes" colset="Ожидаемый факт" />
        <column table="a" column="fp_sum_nds" group="sum" mp="-3" if="mes" as="fp_sum_nds_mes" colset="Ожидаемый факт" />
        <column table="a" column="vvod_sum" group="sum" mp="-3" if="mes" as="vvod_sum_mes" colset="Ожидаемый факт" />
        <column table="a" column="pow_mba" group="sum" if="mes" as="pow_mba_mes" colset="Ожидаемый факт" />
        <column table="a" column="pow_km_all" group="sum" if="mes" as="pow_km_all_mes" colset="Ожидаемый факт" />
        <column table="a" column="pow_other" group="sum" if="mes" as="pow_other_mes" colset="Ожидаемый факт" />
        <column table="a" column="pow_mba_pr" group="sum" if="mes" as="pow_mba_pr_mes" colset="Ожидаемый факт" />
        <column table="a" column="pow_km_all_pr" group="sum" if="mes" as="pow_km_all_pr_mes" colset="Ожидаемый факт" />
        <column table="a" column="pow_other_pr" group="sum" if="mes" as="pow_other_pr_mes" colset="Ожидаемый факт" />
        <call function="-nvl" as="otkl_kap_mes" title="Отклонение факта от плана" group="sum" colset="Ожидаемый факт">
          <column table="this" column="kap_sum_wait" />
          <column table="this" column="kap_sum_mes" />
        </call>
        <call function="-nvl" as="otkl_fp_mes" title="Отклонение факта от плана" group="sum" colset="Ожидаемый факт">
          <column table="this" column="fp_sum_nds_wait" />
          <column table="this" column="fp_sum_nds_mes" />
        </call>
        <call function="-nvl" as="otkl_vvod_mes" title="Отклонение факта от плана" group="sum" colset="Ожидаемый факт">
          <column table="this" column="vvod_sum_wait" />
          <column table="this" column="vvod_sum_mes" />
        </call>
        <call function="-nvl" as="otkl_pow_mba_mes" title="Отклонение факта от плана" group="sum" colset="Ожидаемый факт">
          <column table="this" column="pow_mba_wait" />
          <column table="this" column="pow_mba_mes" />
        </call>
        <call function="-nvl" as="otkl_pow_km_all_mes" title="Отклонение факта от плана" group="sum" colset="Ожидаемый факт">
          <column table="this" column="pow_km_all_wait" />
          <column table="this" column="pow_km_all_mes" />
        </call>
        <column table="a" column="pfa_kvl_wprim" group="max" if="mes1" colset="Ожидаемый факт">
          <if>
            <call function="=">
              <column table="a" column="kvart" />
              <call function="mes to kv">
                <useparam name="mes" />
              </call>
            </call>
          </if>
        </column>
        <column table="a" column="pfa_vv_wprim" group="max" if="mes1" colset="Ожидаемый факт" />
        <column table="a" column="pfa_fin_wprim" group="max" if="mes1" colset="Ожидаемый факт" />
        <column table="a" column="pfa_mba_wprim" group="max" if="mes1" colset="Ожидаемый факт" />
        <column table="a" column="pfa_km_wprim" group="max" if="mes1" colset="Ожидаемый факт" />
        <column table="sbor_fin" column="pfa_kvl_wprim" group="max" if="mes1" as="pfa_kvl_wprim_sbor" colset="Ожидаемый факт" />
        <column table="sbor_fin" column="pfa_vv_wprim" group="max" if="mes1" as="pfa_vv_wprim_sbor" colset="Ожидаемый факт" />
        <column table="sbor_fin" column="pfa_fin_wprim" group="max" if="mes1" as="pfa_fin_wprim_sbor" colset="Ожидаемый факт" />
        <column table="sbor_fin" column="pfa_mba_wprim" group="max" if="mes1" as="pfa_mba_wprim_sbor" colset="Ожидаемый факт" />
        <column table="sbor_fin" column="pfa_km_wprim" group="max" if="mes1" as="pfa_km_wprim_sbor" colset="Ожидаемый факт" />
      </select>
      <from>
        <query name="ipr_fin_body_united" as="a">
          <link name="kod_ipr">
            <link name="kod_titul_ip">
              <link name="kod_direct" />
              <link name="kod_ispolnit" />
            </link>
            <link name="kod_main_titul">
              <link name="kod_subject" />
              <link name="kod_direct" as="kod_direct_main" />
              <link name="kod_ispolnit" as="kod_ispolnit_main" />
              <link name="kod_sbor_titul">
                <link name="kod_titul_ip" as="kod_titul_ip_sbor">
                  <link name="kod_ispolnit" as="kod_ispolnit_sbor" />
                  <link name="kod_direct" as="kod_direct_sbor" />
                  <dlink name="ipr_fin_body_united" as="sbor_fin">
                    <extendwhere>
                      <call function="and">
                        <call function="and" selective="1">
                          <call function="=">
                            <column table="*" column="year" />
                            <useparam name="year" />
                          </call>
                          <call function="le" exclude="1">
                            <call function="mes to kv">
                              <column table="*" column="period" />
                            </call>
                            <useparam name="kv" />
                          </call>
                        </call>
                        <call function="=" selective="1" exclude="1">
                          <column table="*" column="kvart" />
                          <useparam name="kv" />
                        </call>
                        <call function="=">
                          <column table="kod_ipr" column="kod_doc_osn" />
                          <useparam name="kod_doc" />
                        </call>
                        <call function="=">
                          <column table="kod_titul_ip1" column="is_sbor" />
                          <const>1</const>
                        </call>
                      </call>
                    </extendwhere>
                  </dlink>
                </link>
              </link>
            </link>
          </link>
          <extendwhere>
            <call function="and">
              <call function="and" selective="1">
                <call function="=">
                  <column table="*" column="year" />
                  <useparam name="year" />
                </call>
                <call function="le" exclude="1">
                  <call function="mes to kv">
                    <column table="*" column="period" />
                  </call>
                  <useparam name="kv" />
                </call>
              </call>
              <call function="=" selective="1" exclude="1">
                <column table="*" column="kvart" />
                <useparam name="kv" />
              </call>
              <call function="=">
                <column table="kod_ipr" column="kod_doc_osn" />
                <useparam name="kod_doc" />
              </call>
            </call>
            <call function="or" optional="1">
              <call function="and">
                <call function="in">
                  <column table="kod_titul_ip1" column="kod_ispolnit" />
                  <useparam name="kod_direct" />
                </call>
                <call function="=">
                  <const>3</const>
                  <useparam name="kod_dirisp" />
                </call>
              </call>
              <call function="and">
                <call function="in">
                  <column table="kod_titul_ip1" column="kod_direct" />
                  <useparam name="kod_direct" />
                </call>
                <call function="=">
                  <const>2</const>
                  <useparam name="kod_dirisp" />
                </call>
              </call>
            </call>
            <call function="in" optional="1">
              <column table="kod_titul_ip1" column="pr_ofz" />
              <useparam name="kod_ofz" />
            </call>
          </extendwhere>
        </query>
      </from>
      <where>
        <call function="and">
          <!--<call function="=">
            <column table="kod_ipr" column="pr_last" />
            <const>1</const>
          </call>-->
          <!--<call function="is not null">
            <column table="kod_subject" column="abbr" />
          </call>-->
          <call function="true" />
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="29611_mon_def" timestamp="17.07.2016 17:48:26">
      <select>
        <call function="month" as="mon">
          <call function="sysdate" />
        </call>
      </select>
      <from>
        <table name="dual" as="a" />
      </from>
    </query>
    <query name="29611_cols_pf" timestamp="18.07.2016 01:19:13">
      <const as="id" type="string">'План'</const>
      <const as="name" type="string" title="Группа колонок">'План'</const>
      <const>'Лимит'</const>
      <const>'Лимит'</const>
    </query>
    <query name="29611_cols_all" timestamp="18.07.2016 01:32:33">
      <const as="id" type="string">'План'</const>
      <const as="name" type="string">'План'</const>
      <const>'Лимит'</const>
      <const>'Лимит'</const>
      <const>'Ожидаемый факт'</const>
      <const>'Ожидаемый факт'</const>
    </query>
    <query name="29611_cols_def" timestamp="18.07.2016 01:36:26">
      <params>
        <param name="colsets_pre" type="array" />
        <param name="pr_wait" type="number" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="29611_cols_all" as="a" />
      </from>
      <where>
        <call function="or">
          <call function="in">
            <column table="a" column="id" />
            <useparam name="colsets_pre" />
          </call>
          <call function="and" optional="1">
            <call function="=">
              <column table="a" column="id" />
              <const>'Ожидаемый факт'</const>
            </call>
            <call function="=1">
              <useparam name="pr_wait" />
            </call>
          </call>
        </call>
      </where>
    </query>
  </queries>
</root>