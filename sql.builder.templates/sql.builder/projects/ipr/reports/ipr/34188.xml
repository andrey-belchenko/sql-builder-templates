<?xml version="1.0" encoding="utf-8"?>
<root>
  <parts>
    <part id="34188-params" timestamp="25.12.2017 13:01:38">
      <param name="kod_doc">
        <const>43383</const>
      </param>
      <param name="kod_dirisp">
        <const exclude="1">2</const>
      </param>
      <param name="kod_direct" />
      <param name="kod_subject" />
      <param name="pr_notaip" />
      <param name="pr_sbor" />
      <param name="pr_child" />
      <param name="kod_titul_ip">
        <array>
          <const>143403</const>
        </array>
      </param>
      <param name="doc_type" />
      <param name="kod_ofz" />
      <param name="kod_status_tit" />
      <param name="dat_doc_s" />
      <param name="dat_doc_po" />
    </part>
    <part id="34188-withparams" timestamp="25.12.2017 13:01:57">
      <useparam name="kod_doc" />
      <useparam name="kod_dirisp" />
      <useparam name="kod_direct" />
      <useparam name="kod_subject" />
      <useparam name="pr_notaip" />
      <useparam name="pr_sbor" />
      <useparam name="pr_child" />
      <useparam name="kod_titul_ip" />
      <useparam name="doc_type" />
      <useparam name="kod_ofz" />
      <useparam name="kod_status_tit" />
      <useparam name="dat_doc_s" />
      <useparam name="dat_doc_po" />
    </part>
  </parts>
  <forms>
    <form name="34188" timestamp="25.12.2017 12:58:44" with-behavior="0">
      <customers>
        <customer id="17" />
      </customers>
      <content>
        <usefield field="ipr_kod_doc" />
        <usefield field="ipr_kod_direct" />
        <usefield name="kod_dirisp" field="ipr_kod_dirisp_all" />
        <usefield field="ipr_subject" />
        <usefield field="ipr_pr_notaip" />
        <usefield field="ipr_pr_sbor" />
        <usefield field="ipr_pr_child" />
        <usefield field="ipr_kod_titul_ip" />
        <usefield field="ipr_status_tit" />
        <usefield field="ipr_doc_type" />
        <usefield field="ipr_kod_ofz" />
        <fieldgroup title="Дата документа-основания">
          <usefield field="cmn_date" title="С" name="dat_doc_s" width-perc="50" />
          <usefield field="cmn_date" title="По" name="dat_doc_po" width-perc="50" />
        </fieldgroup>
        <usefield field="cmn_check" name="by_cognos_num" title="Формирование пакета обосновывающих документов к титулу" />
        <uicommand action-type="dynamic-form" call="vr_doc_reestr_types" modal="1" title="Настройка выходных каталогов для документов" />
      </content>
    </form>
  </forms>
  <reports>
    <report name="34188" form="34188" title="Отчет о вложенных документах с реестром" edit-columns="2" nogrid="1" folder="invpro">
      <params>
        <usepart part="34188-params" />
      </params>
      <customers>
        <customer id="17" />
      </customers>
      <print-templates>
        <excel>
          <template name="34188.xml" title="Отчет о вложенных документах с реестром" del-cols="1" print-proc="2" />
        </excel>
      </print-templates>
      <queries>
        <query name="34188" as="a" title="Данные">
          <withparams>
            <usepart part="34188-withparams" />
          </withparams>
        </query>
        <query name="form:34188" as="b" title="Параметры" />
      </queries>
    </report>
    <report name="34189-test-vertica" form="34188" title="Отчет о вложенных документах с реестром" edit-columns="2" nogrid="1" folder="invpro" visible="0">
      <params>
        <usepart part="34188-params" />
      </params>
      <customers>
        <customer id="17" />
      </customers>
      <print-templates>
        <excel>
          <template name="34188.xml" title="Отчет о вложенных документах с реестром" del-cols="1" print-proc="2" />
        </excel>
      </print-templates>
      <queries>
        <query name="34188" as="a" title="Данные">
          <withparams>
            <usepart part="34188-withparams" />
          </withparams>
        </query>
      </queries>
    </report>
  </reports>
  <queries>
    <query name="34188" order="kod_titul_ip,kod_doc_type,kod_doc,kod_file">
      <params>
        <usepart part="34188-params" />
      </params>
      <select>
        <call function="row_number" as="rown">
          <call function="partition by">
            <column table="this" column="kod_titul_ip" />
            <column table="this" column="kod_doc_type" />
          </call>
          <call function="order by 2">
            <column table="this" column="kod_doc" />
            <column table="this" column="kod_file" />
          </call>
        </call>
        <call function="dense_rank" as="rown1">
          <!--<call function="partition by">
            <column table="this" column="kod_titul_ip" />
            -->
          <!--<column table="this" column="kod_doc_type" />-->
          <!--
          </call>-->
          <call function="order by 2">
            <column table="this" column="kod_titul_ip" />
            <column table="this" column="kod_doc_type" />
          </call>
        </call>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="34188-dat-all" as="a" grouplevel="2">
          <withparams>
            <usepart part="34188-withparams" />
          </withparams>
        </query>
      </from>
    </query>
    <query name="34188-dat-all" grouplevel="no" timestamp="08.12.2017 15:56:48">
      <params>
        <usepart part="34188-params" />
      </params>
      <select>
        <column table="a" column="kod_file" group="1" title="Идентификатор файла" />
        <column table="a" column="kod_doc" group="kod_file" />
        <column table="a" column="kod_sbor_titul" group="max" />
        <column table="a" column="kod_main_titul" group="max" />
        <column table="a" column="kod_titul_ip" group="2" />
        <column table="a" column="itip" group="kod_titul_ip" />
        <column table="a" column="tit_num_new" group="kod_titul_ip" title="{+} (одиночный/дочерний)" />
        <column table="a" column="name_tit" group="kod_titul_ip" title="{+} (одиночный/дочерний)" />
        <column table="a" column="cognos_num" group="kod_titul_ip" title="Код для Минэнерго" />
        <column table="a" column="subj_abbr" group="kod_titul_ip" />
        <column table="a" column="podr_abbr_dir" group="kod_titul_ip" title="Подразделение заказчика" />
        <column table="a" column="podr_abbr_isp" group="kod_titul_ip" title="Подразделение исполнителя" />
        <column table="a" column="kod_doc_type" group="kod_file" />
        <column table="a" column="doc_date_c" group="kod_file" />
        <column table="a" column="doc_num" group="kod_file" />
        <column table="a" column="name" group="kod_file" />
        <column table="a" column="abbr" group="kod_file" />
        <column table="a" column="ipr_fin_doc" group="max" />
        <column table="a" column="kod_ipr" group="kod_file" />
        <column table="a" column="kod_file1" group="kod_file" />
        <column table="a" column="folders" title="Выходные каталоги" group="kod_file" />
      </select>
      <from>
        <query as="a">
          <union>
            <query title="Документы ИнвестПро">
              <select>
                <column table="a" column="*" />
              </select>
              <from>
                <query as="a" name="34188-dat">
                  <withparams>
                    <usepart part="34188-withparams" />
                  </withparams>
                </query>
              </from>
            </query>
            <query title="Документы КИДО КС-3">
              <select>
                <column table="a" column="*" />
              </select>
              <from>
                <query as="a" name="34188-dat-kido-ks3">
                  <withparams>
                    <usepart part="34188-withparams" />
                  </withparams>
                </query>
              </from>
            </query>
            <query title="Документы КИДО КС-2">
              <select>
                <column table="a" column="*" />
              </select>
              <from>
                <query as="a" name="34188-dat-kido-ks2" title="Документы КИДО КС-2">
                  <withparams>
                    <usepart part="34188-withparams" />
                  </withparams>
                </query>
              </from>
            </query>
            <query title="Документы КИДО Договоры услуг, поставки, подряда">
              <select>
                <column table="a" column="*" />
              </select>
              <from>
                <query as="a" name="34188-dat-kido-dog">
                  <withparams>
                    <usepart part="34188-withparams" />
                  </withparams>
                </query>
              </from>
            </query>
            <query title="Документы КИДО Договоры ТП, АТП (новый вариант)">
              <select>
                <column table="a" column="*" />
              </select>
              <from>
                <query as="a" name="34188-dat-kido-tp">
                  <withparams>
                    <usepart part="34188-withparams" />
                  </withparams>
                </query>
              </from>
            </query>
            <query title="Документы КИДО АТП (из заявок)">
              <select>
                <column table="a" column="*" />
              </select>
              <from>
                <query as="a" name="34188-dat-kido-atp1">
                  <withparams>
                    <usepart part="34188-withparams" />
                  </withparams>
                </query>
              </from>
            </query>
            <query title="Документы КИДО АТП (старый вариант)">
              <select>
                <column table="a" column="*" />
              </select>
              <from>
                <query as="a" name="34188-dat-kido-atp2">
                  <withparams>
                    <usepart part="34188-withparams" />
                  </withparams>
                </query>
              </from>
            </query>
          </union>
        </query>
      </from>
    </query>
    <query name="34188-dat" timestamp="25.12.2017 13:04:20">
      <params>
        <usepart part="34188-params" />
      </params>
      <select>
        <column table="ipr_doc_files_all" column="kod_file" />
        <column table="kod_doc" column="kod_doc" />
        <column table="kod_sbor_titul" column="kod_sbor_titul" />
        <column table="kod_ipr" column="kod_main_titul" />
        <column table="kod_ipr" column="kod_titul_ip" />
        <column table="kod_ipr" column="itip" />
        <column table="kod_titul_ip" column="tit_num_new" as="tit_num_new" />
        <column table="kod_titul_ip" column="name" as="name_tit" />
        <column table="kod_titul_ip" column="export_cognos_num" as="cognos_num" />
        <column table="kod_subject" column="abbr" as="subj_abbr" />
        <column table="kod_direct" column="name_kr" as="podr_abbr_dir" />
        <column table="kod_ispolnit" column="name_kr" as="podr_abbr_isp" />
        <column table="kod_doc" column="kod_doc_type" />
        <column table="kod_doc" column="doc_date_c" />
        <column table="kod_doc" column="doc_num" />
        <column table="kod_doc_type" column="name" />
        <call function="nvl" as="abbr" type="string">
          <column table="kod_doc_type" column="abbr" />
          <column table="kod_doc_type" column="name" />
        </call>
        <column table="a" column="ipr_fin_doc" />
        <column table="a" column="kod_ipr" />
        <column table="ipr_doc_files_all" column="kod_file" as="kod_file1">
          <if>
            <call function="and">
              <call function="is not null">
                <column table="ipr_doc_files_all" column="file_name" />
              </call>
              <call function="is not null">
                <column table="ipr_doc_files_all" column="file_data" />
              </call>
            </call>
          </if>
        </column>
        <column table="kod_folder" column="name" as="folders" dgroup="stragg" />
      </select>
      <from>
        <query name="ipr_fin_body_united" as="a">
          <link name="kod_doc">
            <link name="kod_doc_type">
              <dlink name="vr_doc_reestr_types">
                <link name="kod_folder" />
              </dlink>
            </link>
            <elink name="ipr_doc_files_all" />
          </link>
          <link name="kod_ipr">
            <link name="kod_titul_ip">
              <link name="kod_direct" />
              <link name="kod_ispolnit" />
            </link>
            <link name="kod_parent">
              <link name="kod_subject" as="kod_subject_par" />
              <link name="kod_direct" as="kod_direct_par" />
              <link name="kod_ispolnit" as="kod_ispolnit_par" />
            </link>
            <link name="kod_main_titul">
              <link name="kod_subject" />
              <link name="kod_sbor_titul">
                <link name="kod_titul_ip" as="kod_titul_ip_sbor">
                  <link name="kod_subject" as="kod_subject_sbor" />
                  <link name="kod_direct" as="kod_direct_sbor" />
                  <link name="kod_ispolnit" as="kod_ispolnit_sbor" />
                </link>
              </link>
            </link>
          </link>
          <extendwhere>
            <call function="and">
              <call function="true" />
              <!--<call function="=">
                <column table="kod_doc" column="kod_doc" />
                <const>143579</const>
              </call>-->
              <call function="=">
                <column table="kod_ipr" column="kod_doc_osn" />
                <useparam name="kod_doc" />
              </call>
              <call function="or" optional="1">
                <call function="in">
                  <column table="kod_sbor_titul1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_main_titul1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_titul_ip1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
              </call>
              <call function="in" optional="1">
                <column table="kod_main_titul1" column="kod_subject" />
                <useparam name="kod_subject" />
              </call>
              <call function="or" optional="1">
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip1" column="kod_direct" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="in">
                    <useparam name="kod_dirisp" />
                    <array>1,2</array>
                  </call>
                </call>
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip1" column="kod_ispolnit" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="in">
                    <useparam name="kod_dirisp" />
                    <array>1,3</array>
                  </call>
                </call>
              </call>
              <call function="in" optional="1">
                <column table="kod_titul_ip1" column="pr_ofz" />
                <useparam name="kod_ofz" />
              </call>
              <call function="in" optional="1">
                <column table="kod_ipr" column="kod_status" />
                <useparam name="kod_status_tit" />
              </call>
            </call>
          </extendwhere>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_doc_type" column="kod_doc_type" />
            <useparam name="doc_type" />
          </call>
          <call function="is not null">
            <column table="kod_doc" column="link_storage" />
          </call>
          <call function="is not null">
            <column table="kod_doc" column="document" />
          </call>
          <call function="le" optional="1">
            <column table="kod_doc" column="doc_date_c" />
            <useparam name="dat_doc_po" />
          </call>
          <call function="ge" optional="1">
            <column table="kod_doc" column="doc_date_c" />
            <useparam name="dat_doc_s" />
          </call>
        </call>
      </where>
    </query>
    <query name="34188-dat-kido-ks3" timestamp="25.12.2017 13:05:21">
      <params>
        <usepart part="34188-params" />
      </params>
      <select>
        <call function="||" as="kod_file">
          <const>'kido-ks3|'</const>
          <call function="to_char">
            <column table="kod_doc_vip" column="kod_doc_vip" />
          </call>
        </call>
        <const as="kod_doc" type="number">null</const>
        <column table="kod_sbor_titul" column="kod_sbor_titul" />
        <column table="kod_ipr" column="kod_main_titul" />
        <column table="kod_ipr" column="kod_titul_ip" />
        <column table="kod_ipr" column="itip" />
        <column table="kod_titul_ip" column="tit_num_new" />
        <column table="kod_titul_ip" column="name" as="name_tit" />
        <column table="kod_titul_ip" column="export_cognos_num" as="cognos_num" />
        <column table="kod_subject" column="abbr" as="subj_abbr" />
        <column table="kod_direct" column="name_kr" as="podr_abbr_dir" />
        <column table="kod_ispolnit" column="name_kr" as="podr_abbr_isp" />
        <const as="kod_doc_type" type="number">1191</const>
        <column table="kod_doc_vip" column="dat_doc" as="dat_doc_c" />
        <column table="kod_doc_vip" column="num" as="doc_num" />
        <column as="name" type="string" table="kod_doc_type" column="name" />
        <column as="abbr" type="string" table="kod_doc_type" column="abbr" />
        <const as="ipr_fin_doc" type="number">null</const>
        <column table="kod_ipr" column="kod_ipr" />
        <column table="this" column="kod_file" title="kod_file1" />
        <column table="kod_folder" column="name" as="folders" dgroup="stragg" />
      </select>
      <from>
        <query name="is_doc_vip" as="kod_doc_vip">
          <link name="kod_titul_ip_ks3" as="kod_titul_ip">
            <link name="kod_direct" />
            <link name="kod_ispolnit" />
            <elink name="ipr_ipr_data" as="kod_ipr">
              <link name="kod_main_titul">
                <link name="kod_subject" />
                <link name="kod_sbor_titul">
                  <link name="kod_titul_ip" as="kod_titul_ip_sbor">
                    <link name="kod_subject" as="kod_subject_sbor" />
                    <link name="kod_direct" as="kod_direct_sbor" />
                    <link name="kod_ispolnit" as="kod_ispolnit_sbor" />
                  </link>
                </link>
              </link>
              <link name="kod_parent">
                <link name="kod_subject" as="kod_subject_par" />
                <link name="kod_direct" as="kod_direct_par" />
                <link name="kod_ispolnit" as="kod_ispolnit_par" />
              </link>
            </elink>
          </link>
        </query>
        <query name="ips_doc_type" as="kod_doc_type" join="left outer">
          <call function="=">
            <column table="this" column="kod_doc_type" />
            <column table="kod_doc_type" column="kod_doc_type" />
          </call>
          <dlink name="vr_doc_reestr_types">
            <link name="kod_folder" />
          </dlink>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="kod_doc_vip" column="kod_spr_doc" />
            <const>85</const>
          </call>
          <call function="is not null">
            <column table="kod_doc_vip" column="kod_titul_ip_ks3" />
          </call>
          <call function="is not null">
            <column table="kod_doc_vip" column="file_data" />
          </call>
          <call function="=">
            <column table="kod_ipr" column="kod_doc_osn" />
            <useparam name="kod_doc" />
          </call>
          <call function="or" optional="1">
            <call function="in">
              <column table="kod_sbor_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_main_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_titul_ip" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_main_titul" column="kod_subject" />
            <useparam name="kod_subject" />
          </call>
          <call function="or" optional="1">
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_direct" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,2</array>
              </call>
            </call>
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_ispolnit" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,3</array>
              </call>
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_titul_ip" column="pr_ofz" />
            <useparam name="kod_ofz" />
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="this" column="kod_doc_type" />
            <useparam name="doc_type" />
          </call>
          <call function="in" optional="1">
            <column table="kod_ipr" column="kod_status" />
            <useparam name="kod_status_tit" />
          </call>
          <call function="le" optional="1">
            <column table="kod_doc_vip" column="dat_doc" />
            <useparam name="dat_doc_po" />
          </call>
          <call function="ge" optional="1">
            <column table="kod_doc_vip" column="dat_doc" />
            <useparam name="dat_doc_s" />
          </call>
        </call>
      </where>
    </query>
    <query name="34188-dat-kido-ks2" timestamp="25.12.2017 13:06:06">
      <params>
        <usepart part="34188-params" />
      </params>
      <select>
        <call function="||" as="kod_file">
          <const>'kido-ks2|'</const>
          <call function="to_char">
            <column table="kod_ks2" column="kod" />
          </call>
        </call>
        <const as="kod_doc" type="number">null</const>
        <column table="kod_sbor_titul" column="kod_sbor_titul" />
        <column table="kod_ipr" column="kod_main_titul" />
        <column table="kod_ipr" column="kod_titul_ip" />
        <column table="kod_ipr" column="itip" />
        <column table="kod_titul_ip" column="tit_num_new" />
        <column table="kod_titul_ip" column="name" as="name_tit" />
        <column table="kod_titul_ip" column="export_cognos_num" as="cognos_num" />
        <column table="kod_subject" column="abbr" as="subj_abbr" />
        <column table="kod_direct" column="name_kr" as="podr_abbr_dir" />
        <column table="kod_ispolnit" column="name_kr" as="podr_abbr_isp" />
        <const as="kod_doc_type" type="number">1183</const>
        <column table="kod_ks2" column="date_doc" as="dat_doc_c" />
        <column table="kod_ks2" column="num" as="doc_num" />
        <column as="name" type="string" table="kod_doc_type" column="name" />
        <column as="abbr" type="string" table="kod_doc_type" column="abbr" />
        <const as="ipr_fin_doc" type="number">null</const>
        <column table="kod_ipr" column="kod_ipr" />
        <column table="this" column="kod_file" title="kod_file1" />
        <column table="kod_folder" column="name" as="folders" dgroup="stragg" />
      </select>
      <from>
        <query name="is_ks2" as="kod_ks2">
          <link name="kod_titul" as="kod_titul_ip">
            <link name="kod_direct" />
            <link name="kod_ispolnit" />
            <elink name="ipr_ipr_data" as="kod_ipr">
              <link name="kod_main_titul">
                <link name="kod_subject" />
                <link name="kod_sbor_titul">
                  <link name="kod_titul_ip" as="kod_titul_ip_sbor">
                    <link name="kod_subject" as="kod_subject_sbor" />
                    <link name="kod_direct" as="kod_direct_sbor" />
                    <link name="kod_ispolnit" as="kod_ispolnit_sbor" />
                  </link>
                </link>
              </link>
              <link name="kod_parent">
                <link name="kod_subject" as="kod_subject_par" />
                <link name="kod_direct" as="kod_direct_par" />
                <link name="kod_ispolnit" as="kod_ispolnit_par" />
              </link>
            </elink>
          </link>
        </query>
        <query name="ips_doc_type" as="kod_doc_type" join="left outer">
          <call function="=">
            <column table="this" column="kod_doc_type" />
            <column table="kod_doc_type" column="kod_doc_type" />
          </call>
          <dlink name="vr_doc_reestr_types">
            <link name="kod_folder" />
          </dlink>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="is not null">
            <column table="kod_ks2" column="kod_titul" />
          </call>
          <call function="is not null">
            <column table="kod_ks2" column="file_data" />
          </call>
          <call function="=">
            <column table="kod_ipr" column="kod_doc_osn" />
            <useparam name="kod_doc" />
          </call>
          <call function="or" optional="1">
            <call function="in">
              <column table="kod_sbor_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_main_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_titul_ip" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_main_titul" column="kod_subject" />
            <useparam name="kod_subject" />
          </call>
          <call function="or" optional="1">
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_direct" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,2</array>
              </call>
            </call>
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_ispolnit" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,3</array>
              </call>
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_titul_ip" column="pr_ofz" />
            <useparam name="kod_ofz" />
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="this" column="kod_doc_type" />
            <useparam name="doc_type" />
          </call>
          <call function="in" optional="1">
            <column table="kod_ipr" column="kod_status" />
            <useparam name="kod_status_tit" />
          </call>
          <call function="le" optional="1">
            <column table="kod_ks2" column="date_doc" />
            <useparam name="dat_doc_po" />
          </call>
          <call function="ge" optional="1">
            <column table="kod_ks2" column="date_doc" />
            <useparam name="dat_doc_s" />
          </call>
        </call>
      </where>
    </query>
    <query name="34188-dat-kido-dog" timestamp="25.12.2017 13:06:58">
      <params>
        <usepart part="34188-params" />
      </params>
      <select>
        <call function="||" as="kod_file">
          <const>'kido-dog|'</const>
          <call function="to_char">
            <column table="kod_dog" column="kod_dog" />
          </call>
        </call>
        <const as="kod_doc" type="number">null</const>
        <column table="kod_sbor_titul" column="kod_sbor_titul" />
        <column table="kod_ipr" column="kod_main_titul" />
        <column table="kod_ipr" column="kod_titul_ip" />
        <column table="kod_ipr" column="itip" />
        <column table="kod_titul_ip" column="tit_num_new" />
        <column table="kod_titul_ip" column="name" as="name_tit" />
        <column table="kod_titul_ip" column="export_cognos_num" as="cognos_num" />
        <column table="kod_subject" column="abbr" as="subj_abbr" />
        <column table="kod_direct" column="name_kr" as="podr_abbr_dir" />
        <column table="kod_ispolnit" column="name_kr" as="podr_abbr_isp" />
        <call as="kod_doc_type" type="number" function="case">
          <call function="when" comment="поставки">
            <call function="=">
              <column table="kod_tip_dog" column="kod_parent" />
              <const>220</const>
            </call>
            <const>1187</const>
          </call>
          <call function="when" comment="подряда">
            <call function="=">
              <column table="kod_tip_dog" column="kod_tip_dog" />
              <const>269</const>
            </call>
            <const>1188</const>
          </call>
          <call function="else" comment="услуг">
            <const>1189</const>
          </call>
        </call>
        <column table="kod_dog" column="dat_dog" as="dat_doc_c" />
        <call function="||" as="doc_num">
          <call function="substr">
            <call function="to_char">
              <column table="kod_dog" column="year" />
            </call>
            <const>3</const>
            <const>2</const>
          </call>
          <const>'-'</const>
          <call function="to_char">
            <column table="kod_dog" column="kod_unig_dog" />
          </call>
        </call>
        <column as="name" type="string" table="kod_doc_type" column="name" />
        <column as="abbr" type="string" table="kod_doc_type" column="abbr" />
        <const as="ipr_fin_doc" type="number">null</const>
        <column table="kod_ipr" column="kod_ipr" />
        <column table="this" column="kod_file" title="kod_file1" />
        <column table="kod_folder" column="name" as="folders" dgroup="stragg" />
      </select>
      <from>
        <query name="is_dogovor" as="kod_dog">
          <elink name="is_fin_doc_dog_titul_uniq">
            <link name="kod_titul_ip" as="kod_titul_ip">
              <link name="kod_direct" />
              <link name="kod_ispolnit" />
              <elink name="ipr_ipr_data" as="kod_ipr">
                <link name="kod_main_titul">
                  <link name="kod_subject" />
                  <link name="kod_sbor_titul">
                    <link name="kod_titul_ip" as="kod_titul_ip_sbor">
                      <link name="kod_subject" as="kod_subject_sbor" />
                      <link name="kod_direct" as="kod_direct_sbor" />
                      <link name="kod_ispolnit" as="kod_ispolnit_sbor" />
                    </link>
                  </link>
                </link>
                <link name="kod_parent">
                  <link name="kod_subject" as="kod_subject_par" />
                  <link name="kod_direct" as="kod_direct_par" />
                  <link name="kod_ispolnit" as="kod_ispolnit_par" />
                </link>
              </elink>
            </link>
          </elink>
          <link name="kod_tip_dog" />
        </query>
        <query name="ips_doc_type" as="kod_doc_type" join="left outer">
          <call function="=">
            <column table="this" column="kod_doc_type" />
            <column table="kod_doc_type" column="kod_doc_type" />
          </call>
          <dlink name="vr_doc_reestr_types">
            <link name="kod_folder" />
          </dlink>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="kod_ipr" column="kod_doc_osn" />
            <useparam name="kod_doc" />
          </call>
          <call function="or" optional="1">
            <call function="in">
              <column table="kod_sbor_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_main_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_titul_ip" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_main_titul" column="kod_subject" />
            <useparam name="kod_subject" />
          </call>
          <call function="or" optional="1">
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_direct" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,2</array>
              </call>
            </call>
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_ispolnit" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,3</array>
              </call>
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_titul_ip" column="pr_ofz" />
            <useparam name="kod_ofz" />
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="this" column="kod_doc_type" />
            <useparam name="doc_type" />
          </call>
          <call function="in" optional="1">
            <column table="kod_ipr" column="kod_status" />
            <useparam name="kod_status_tit" />
          </call>
          <call function="le" optional="1">
            <column table="kod_dog" column="dat_dog" />
            <useparam name="dat_doc_po" />
          </call>
          <call function="ge" optional="1">
            <column table="kod_dog" column="dat_dog" />
            <useparam name="dat_doc_s" />
          </call>
        </call>
      </where>
    </query>
    <query name="34188-dat-kido-tp" timestamp="25.12.2017 13:07:45">
      <params>
        <usepart part="34188-params" />
      </params>
      <select>
        <call function="||" as="kod_file">
          <const>'kido-tp|'</const>
          <call function="to_char">
            <column table="a" column="kod_dop_doc" />
          </call>
        </call>
        <const as="kod_doc" type="number">null</const>
        <column table="kod_sbor_titul" column="kod_sbor_titul" />
        <column table="kod_ipr" column="kod_main_titul" />
        <column table="kod_ipr" column="kod_titul_ip" />
        <column table="kod_ipr" column="itip" />
        <column table="kod_titul_ip" column="tit_num_new" />
        <column table="kod_titul_ip" column="name" as="name_tit" />
        <column table="kod_titul_ip" column="export_cognos_num" as="cognos_num" />
        <column table="kod_subject" column="abbr" as="subj_abbr" />
        <column table="kod_direct" column="name_kr" as="podr_abbr_dir" />
        <column table="kod_ispolnit" column="name_kr" as="podr_abbr_isp" />
        <call function="case" as="kod_doc_type" type="number">
          <call function="when">
            <call function="=">
              <column table="kod_vid_doc" column="pr_rekv" />
              <const>284</const>
            </call>
            <const>1202</const>
          </call>
          <call function="when">
            <call function="=">
              <column table="kod_vid_doc" column="pr_rekv" />
              <const>293</const>
            </call>
            <const>1186</const>
          </call>
        </call>
        <const as="kod_doc_type" type="number" exclude="1">804</const>
        <column table="a" column="dat_doc" as="dat_doc_c" />
        <column table="a" column="num_doc" as="doc_num" />
        <column as="name" type="string" table="kod_doc_type" column="name" />
        <column as="abbr" type="string" table="kod_doc_type" column="abbr" />
        <const as="ipr_fin_doc" type="number">null</const>
        <column table="kod_ipr" column="kod_ipr" />
        <column table="this" column="kod_file" title="kod_file1" />
        <column table="kod_folder" column="name" as="folders" dgroup="stragg" />
      </select>
      <from>
        <query name="c_dop_doc" as="a">
          <link name="kod_dop_contract">
            <elink name="ipr_titul_dop_contract">
              <link name="kod_titul_ip" as="kod_titul_ip">
                <link name="kod_direct" />
                <link name="kod_ispolnit" />
                <elink name="ipr_ipr_data" as="kod_ipr">
                  <link name="kod_main_titul">
                    <link name="kod_subject" />
                    <link name="kod_sbor_titul">
                      <link name="kod_titul_ip" as="kod_titul_ip_sbor">
                        <link name="kod_subject" as="kod_subject_sbor" />
                        <link name="kod_direct" as="kod_direct_sbor" />
                        <link name="kod_ispolnit" as="kod_ispolnit_sbor" />
                      </link>
                    </link>
                  </link>
                  <link name="kod_parent">
                    <link name="kod_subject" as="kod_subject_par" />
                    <link name="kod_direct" as="kod_direct_par" />
                    <link name="kod_ispolnit" as="kod_ispolnit_par" />
                  </link>
                </elink>
              </link>
            </elink>
          </link>
          <link name="kod_vid_doc" />
        </query>
        <query name="ips_doc_type" as="kod_doc_type" join="left outer">
          <call function="=">
            <column table="this" column="kod_doc_type" />
            <column table="kod_doc_type" column="kod_doc_type" />
          </call>
          <dlink name="vr_doc_reestr_types">
            <link name="kod_folder" />
          </dlink>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="is not null">
            <column table="a" column="doc_file_name" />
          </call>
          <call function="is not null">
            <column table="a" column="doc_file" />
          </call>
          <call function="in">
            <column table="kod_vid_doc" column="pr_rekv" />
            <array>
              <const>293</const>
              <const>284</const>
            </array>
          </call>
          <call function="=">
            <column table="kod_ipr" column="kod_doc_osn" />
            <useparam name="kod_doc" />
          </call>
          <call function="or" optional="1">
            <call function="in">
              <column table="kod_sbor_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_main_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_titul_ip" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_main_titul" column="kod_subject" />
            <useparam name="kod_subject" />
          </call>
          <call function="or" optional="1">
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_direct" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,2</array>
              </call>
            </call>
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_ispolnit" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,3</array>
              </call>
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_titul_ip" column="pr_ofz" />
            <useparam name="kod_ofz" />
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="this" column="kod_doc_type" />
            <useparam name="doc_type" />
          </call>
          <call function="in" optional="1">
            <column table="kod_ipr" column="kod_status" />
            <useparam name="kod_status_tit" />
          </call>
          <call function="le" optional="1">
            <column table="a" column="dat_doc" />
            <useparam name="dat_doc_po" />
          </call>
          <call function="ge" optional="1">
            <column table="a" column="dat_doc" />
            <useparam name="dat_doc_s" />
          </call>
        </call>
      </where>
    </query>
    <query name="34188-dat-kido-atp2" timestamp="25.12.2017 13:09:17">
      <params>
        <usepart part="34188-params" />
      </params>
      <select>
        <call function="||" as="kod_file">
          <const>'kido-atp2|'</const>
          <call function="to_char">
            <column table="a" column="kod_atp_dop_info" />
          </call>
        </call>
        <const as="kod_doc" type="number">null</const>
        <column table="kod_sbor_titul" column="kod_sbor_titul" />
        <column table="kod_ipr" column="kod_main_titul" />
        <column table="kod_ipr" column="kod_titul_ip" />
        <column table="kod_ipr" column="itip" />
        <column table="kod_titul_ip" column="tit_num_new" />
        <column table="kod_titul_ip" column="name" as="name_tit" />
        <column table="kod_titul_ip" column="export_cognos_num" as="cognos_num" />
        <column table="kod_subject" column="abbr" as="subj_abbr" />
        <column table="kod_direct" column="name_kr" as="podr_abbr_dir" />
        <column table="kod_ispolnit" column="name_kr" as="podr_abbr_isp" />
        <const as="kod_doc_type" type="number">1202</const>
        <column table="kn_sert_power" column="dt_reg" as="dat_doc_c" />
        <call function="to_char" as="doc_num">
          <column table="kn_sert_power" column="kn_sert_power" />
        </call>
        <column as="name" type="string" table="kod_doc_type" column="name" />
        <column as="abbr" type="string" table="kod_doc_type" column="abbr" />
        <const as="ipr_fin_doc" type="number">null</const>
        <column table="kod_ipr" column="kod_ipr" />
        <column table="this" column="kod_file" title="kod_file1" />
        <column table="kod_folder" column="name" as="folders" dgroup="stragg" />
      </select>
      <from>
        <query name="is_atp_dop_info" as="a">
          <link name="kod_dop_contract">
            <elink name="ipr_titul_dop_contract">
              <link name="kod_titul_ip" as="kod_titul_ip">
                <link name="kod_direct" />
                <link name="kod_ispolnit" />
                <elink name="ipr_ipr_data" as="kod_ipr">
                  <link name="kod_main_titul">
                    <link name="kod_subject" />
                    <link name="kod_sbor_titul">
                      <link name="kod_titul_ip" as="kod_titul_ip_sbor">
                        <link name="kod_subject" as="kod_subject_sbor" />
                        <link name="kod_direct" as="kod_direct_sbor" />
                        <link name="kod_ispolnit" as="kod_ispolnit_sbor" />
                      </link>
                    </link>
                  </link>
                  <link name="kod_parent">
                    <link name="kod_subject" as="kod_subject_par" />
                    <link name="kod_direct" as="kod_direct_par" />
                    <link name="kod_ispolnit" as="kod_ispolnit_par" />
                  </link>
                </elink>
              </link>
            </elink>
          </link>
          <link name="kn_sert_power" />
        </query>
        <query name="ips_doc_type" as="kod_doc_type" join="left outer">
          <call function="=">
            <column table="this" column="kod_doc_type" />
            <column table="kod_doc_type" column="kod_doc_type" />
          </call>
          <dlink name="vr_doc_reestr_types">
            <link name="kod_folder" />
          </dlink>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="is not null">
            <column table="a" column="doc_data" />
          </call>
          <call function="=">
            <column table="kod_ipr" column="kod_doc_osn" />
            <useparam name="kod_doc" />
          </call>
          <call function="or" optional="1">
            <call function="in">
              <column table="kod_sbor_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_main_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_titul_ip" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_main_titul" column="kod_subject" />
            <useparam name="kod_subject" />
          </call>
          <call function="or" optional="1">
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_direct" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,2</array>
              </call>
            </call>
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_ispolnit" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,3</array>
              </call>
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_titul_ip" column="pr_ofz" />
            <useparam name="kod_ofz" />
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="this" column="kod_doc_type" />
            <useparam name="doc_type" />
          </call>
          <call function="in" optional="1">
            <column table="kod_ipr" column="kod_status" />
            <useparam name="kod_status_tit" />
          </call>
          <call function="le" optional="1">
            <column table="kn_sert_power" column="dt_reg" />
            <useparam name="dat_doc_po" />
          </call>
          <call function="ge" optional="1">
            <column table="kn_sert_power" column="dt_reg" />
            <useparam name="dat_doc_s" />
          </call>
        </call>
      </where>
    </query>
    <query name="34188-dat-kido-atp1" timestamp="25.12.2017 13:09:10">
      <params>
        <usepart part="34188-params" />
      </params>
      <select>
        <call function="||" as="kod_file">
          <const>'kido-atp1|'</const>
          <call function="to_char">
            <column table="a" column="kn_dfile" />
          </call>
        </call>
        <const as="kod_doc" type="number">null</const>
        <column table="kod_sbor_titul" column="kod_sbor_titul" />
        <column table="kod_ipr" column="kod_main_titul" />
        <column table="kod_ipr" column="kod_titul_ip" />
        <column table="kod_ipr" column="itip" />
        <column table="kod_titul_ip" column="tit_num_new" />
        <column table="kod_titul_ip" column="name" as="name_tit" />
        <column table="kod_titul_ip" column="export_cognos_num" as="cognos_num" />
        <column table="kod_subject" column="abbr" as="subj_abbr" />
        <column table="kod_direct" column="name_kr" as="podr_abbr_dir" />
        <column table="kod_ispolnit" column="name_kr" as="podr_abbr_isp" />
        <const as="kod_doc_type" type="number">1202</const>
        <column table="a" column="dt_put" as="dat_doc_c" />
        <call function="to_char" as="doc_num">
          <column table="a" column="kn_dfile" />
        </call>
        <column as="name" type="string" table="kod_doc_type" column="name" />
        <column as="abbr" type="string" table="kod_doc_type" column="abbr" />
        <const as="ipr_fin_doc" type="number">null</const>
        <column table="kod_ipr" column="kod_ipr" />
        <column table="this" column="kod_file" title="kod_file1" />
        <column table="kod_folder" column="name" as="folders" dgroup="stragg" />
      </select>
      <from>
        <query name="as_dfile" as="a">
          <link name="kn_request">
            <elink name="is_dop_contract">
              <elink name="ipr_titul_dop_contract">
                <link name="kod_titul_ip" as="kod_titul_ip">
                  <link name="kod_direct" />
                  <link name="kod_ispolnit" />
                  <elink name="ipr_ipr_data" as="kod_ipr">
                    <link name="kod_main_titul">
                      <link name="kod_subject" />
                      <link name="kod_sbor_titul">
                        <link name="kod_titul_ip" as="kod_titul_ip_sbor">
                          <link name="kod_subject" as="kod_subject_sbor" />
                          <link name="kod_direct" as="kod_direct_sbor" />
                          <link name="kod_ispolnit" as="kod_ispolnit_sbor" />
                        </link>
                      </link>
                    </link>
                    <link name="kod_parent">
                      <link name="kod_subject" as="kod_subject_par" />
                      <link name="kod_direct" as="kod_direct_par" />
                      <link name="kod_ispolnit" as="kod_ispolnit_par" />
                    </link>
                  </elink>
                </link>
              </elink>
            </elink>
          </link>
        </query>
        <query name="ips_doc_type" as="kod_doc_type" join="left outer">
          <call function="=">
            <column table="this" column="kod_doc_type" />
            <column table="kod_doc_type" column="kod_doc_type" />
          </call>
          <dlink name="vr_doc_reestr_types">
            <link name="kod_folder" />
          </dlink>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="kn_dkind" />
            <const>31</const>
          </call>
          <call function="is not null">
            <column table="a" column="dfile" />
          </call>
          <call function="=">
            <column table="kod_ipr" column="kod_doc_osn" />
            <useparam name="kod_doc" />
          </call>
          <call function="or" optional="1">
            <call function="in">
              <column table="kod_sbor_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_main_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_titul_ip" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_main_titul" column="kod_subject" />
            <useparam name="kod_subject" />
          </call>
          <call function="or" optional="1">
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_direct" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,2</array>
              </call>
            </call>
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_ispolnit" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,3</array>
              </call>
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_titul_ip" column="pr_ofz" />
            <useparam name="kod_ofz" />
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="this" column="kod_doc_type" />
            <useparam name="doc_type" />
          </call>
          <call function="in" optional="1">
            <column table="kod_ipr" column="kod_status" />
            <useparam name="kod_status_tit" />
          </call>
          <call function="le" optional="1">
            <column table="a" column="dt_put" />
            <useparam name="dat_doc_po" />
          </call>
          <call function="ge" optional="1">
            <column table="a" column="dt_put" />
            <useparam name="dat_doc_s" />
          </call>
        </call>
      </where>
    </query>
  </queries>
</root>