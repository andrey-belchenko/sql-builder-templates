<?xml version="1.0" encoding="utf-8"?>
<root>
  <reports>
    <report name="53419" timestamp="20.07.2019 12:54:16" form="53419" table_select="1" mode="excel" nogrid="1" title="Вынос сетей 1" visible="0">
      <params>
        <usepart part="45676-params" />
      </params>
      <procedure>
        begin
          is_job.set_id_slice(:id_slice);
        end;
      </procedure>
      <customers>
        <customer id="17" />
      </customers>
      <print-templates>
        <excel>
          <template name="53419.xlsx" title="Вынос сетей 1" print-proc="2" print-xlsx="1" format-source="53419-format.xlsx" />
        </excel>
      </print-templates>
      <queries>
        <query name="53419-title" as="t">
          <withparams>
            <usepart part="45676-withparams" />
          </withparams>
        </query>
        <query name="53419_vs1" as="p5">
          <withparams>
            <usepart part="45676-withparams" />
          </withparams>
        </query>
      </queries>
    </report>
  </reports>
  <queries>
    <query name="53419_vs1" timestamp="26.07.2019 14:14:00">
      <params>
        <usepart part="45676-params" />
      </params>
      <expressions>
        <call as="is_sou_nxt1_2" dontpushpred="1" function="and">
          <call function="=">
            <call function="trunc">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
              <const>'Q'</const>
            </call>
            <useparam name="date_beg_next_Q" />
          </call>
        </call>
        <call as="is_sou_nxt2" function="and">
          <call function="ge">
            <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            <useparam name="date_beg_cur_Q_pl2" />
          </call>
        </call>
        <call as="is_sou_nxt3" function="and">
          <call dontpushpred="1" function="ge">
            <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            <useparam name="date_beg_next_Y" />
          </call>
        </call>
        <call as="is_sou_cur" function="and">
          <call dontpushpred="1" function="le">
            <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            <useparam name="date_end_cur_Q" />
          </call>
        </call>
        <call as="is_sou_pr" dontpushpred="1" function="and">
          <call function="lt">
            <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            <useparam name="date_otch" />
          </call>
        </call>
        <call as="is_sou_mon0" function="and">
          <call dontpushpred="1" function="le">
            <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            <call function="ym2 end time">
              <call function="+">
                <call function="*">
                  <call function="year">
                    <useparam name="date_otch" />
                  </call>
                  <const>100</const>
                </call>
                <call function="month">
                  <useparam name="date_otch" />
                </call>
              </call>
            </call>
          </call>
        </call>
        <call as="is_sou_mon1" dontpushpred="1" function="and">
          <call function="=">
            <call function="year">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <useparam name="cur_year" />
            <const exclude="1">2018</const>
          </call>
          <call function="=">
            <call function="month">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>1</const>
          </call>
        </call>
        <call as="is_sou_mon2" dontpushpred="1" function="and">
          <call function="=">
            <call function="year">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <useparam name="cur_year" />
            <const exclude="1">2018</const>
          </call>
          <call function="=">
            <call function="month">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>2</const>
          </call>
        </call>
        <call as="is_sou_mon3" dontpushpred="1" function="and">
          <call function="=">
            <call function="year">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <useparam name="cur_year" />
            <const exclude="1">2018</const>
          </call>
          <call function="=">
            <call function="month">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>3</const>
          </call>
        </call>
        <call as="is_sou_mon4" dontpushpred="1" function="and">
          <call function="=">
            <call function="year">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <useparam name="cur_year" />
            <const exclude="1">2018</const>
          </call>
          <call function="=">
            <call function="month">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>4</const>
          </call>
        </call>
        <call as="is_sou_mon5" dontpushpred="1" function="and">
          <call function="=">
            <call function="year">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <useparam name="cur_year" />
            <const exclude="1">2018</const>
          </call>
          <call function="=">
            <call function="month">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>5</const>
          </call>
        </call>
        <call as="is_sou_mon6" dontpushpred="1" function="and">
          <call function="=">
            <call function="year">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <useparam name="cur_year" />
            <const exclude="1">2018</const>
          </call>
          <call function="=">
            <call function="month">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>6</const>
          </call>
        </call>
        <call as="is_sou_mon7" dontpushpred="1" function="and">
          <call function="=">
            <call function="year">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <useparam name="cur_year" />
            <const exclude="1">2018</const>
          </call>
          <call function="=">
            <call function="month">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>7</const>
          </call>
        </call>
        <call as="is_sou_mon8" dontpushpred="1" function="and">
          <call function="=">
            <call function="year">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <useparam name="cur_year" />
            <const exclude="1">2018</const>
          </call>
          <call function="=">
            <call function="month">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>8</const>
          </call>
        </call>
        <call as="is_sou_mon9" dontpushpred="1" function="and">
          <call function="=">
            <call function="year">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <useparam name="cur_year" />
            <const exclude="1">2018</const>
          </call>
          <call function="=">
            <call function="month">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>9</const>
          </call>
        </call>
        <call as="is_sou_mon10" dontpushpred="1" function="and">
          <call function="=">
            <call function="year">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <useparam name="cur_year" />
            <const exclude="1">2018</const>
          </call>
          <call function="=">
            <call function="month">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>10</const>
          </call>
        </call>
        <call as="is_sou_mon11" dontpushpred="1" function="and">
          <call function="=">
            <call function="year">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <useparam name="cur_year" />
            <const exclude="1">2018</const>
          </call>
          <call function="=">
            <call function="month">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>11</const>
          </call>
        </call>
        <call as="is_sou_mon12" dontpushpred="1" function="and">
          <call function="=">
            <call function="year">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <useparam name="cur_year" />
            <const exclude="1">2018</const>
          </call>
          <call function="=">
            <call function="month">
              <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>12</const>
          </call>
        </call>
        <call as="col_no_fact_nxt1_2" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_nxt1_2" />
        </call>
        <call as="col_no_fact_cur" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_cur" />
        </call>
        <call as="col_no_fact_nxt2" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_nxt2" />
        </call>
        <call as="col_no_fact_nxt3" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_nxt3" />
        </call>
        <call as="col_no_fact_pr" function="()" group="sum" type="number">
          <fact column="col_no_fact_cur" condition="is_sou_pr" />
        </call>
        <call as="col_no_fact_mon0" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon0" />
        </call>
        <call as="col_no_fact_mon1" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon1" />
        </call>
        <call as="col_no_fact_mon2" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon2" />
        </call>
        <call as="col_no_fact_mon3" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon3" />
        </call>
        <call as="col_no_fact_mon4" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon4" />
        </call>
        <call as="col_no_fact_mon5" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon5" />
        </call>
        <call as="col_no_fact_mon6" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon6" />
        </call>
        <call as="col_no_fact_mon7" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon7" />
        </call>
        <call as="col_no_fact_mon8" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon8" />
        </call>
        <call as="col_no_fact_mon9" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon9" />
        </call>
        <call as="col_no_fact_mon10" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon10" />
        </call>
        <call as="col_no_fact_mon11" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon11" />
        </call>
        <call as="col_no_fact_mon12" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_mon12" />
        </call>
        <call as="is_cur" dontpushpred="1" function="=">
          <column column="id_slice" table="id_slice" />
          <useparam name="id_slice" />
        </call>
        <call as="is_week" dontpushpred="1" function="=">
          <column column="id_slice" table="id_slice" />
          <useparam name="id_slice_week" />
        </call>
        <call as="is_3week" dontpushpred="1" function="=">
          <column column="id_slice" table="id_slice" />
          <useparam name="id_slice_3week" />
        </call>
        <call as="is_2week" dontpushpred="1" function="=">
          <column column="id_slice" table="id_slice" />
          <useparam name="id_slice_2week" />
        </call>
        <call as="col_any_fact_week" function="-nvl" group="sum" type="number">
          <fact column="col_no_fact_cur" condition="is_week" />
          <fact column="col_no_fact_cur" condition="is_cur" />
        </call>
        <call as="is_fact_week" dontpushpred="1" function="and">
          <call function="=">
            <column column="id_slice" table="kod_isv_ad_evd_vs1" />
            <useparam name="id_slice" />
          </call>
          <call function="=0">
            <call function="over" title=" " type="number">
              <call function="max">
                <call function="if">
                  <call function="and">
                    <call function="=">
                      <column column="id_slice" table="kod_isv_ad_evd" />
                      <useparam name="id_slice_week" />
                    </call>
                    <call function="=">
                      <column column="col_any_fact" table="kod_isv_ad_evd" />
                      <const>1</const>
                    </call>
                  </call>
                  <const>1</const>
                </call>
              </call>
              <call function="partition by">
                <column column="kod_dop_contract" table="kod_isv_ad_evd" />
              </call>
            </call>
          </call>
        </call>
        <call as="col_any_fact_3week" function="-nvl" group="sum" type="number">
          <fact column="col_no_fact_cur" condition="is_3week" />
          <fact column="col_no_fact_cur" condition="is_cur" />
        </call>
        <call as="col_any_fact_2to1w" function="-nvl" group="sum" type="number">
          <fact column="col_no_fact_cur" condition="is_2week" />
          <fact column="col_no_fact_cur" condition="is_week" />
        </call>
        <call as="is_sou_changed1_1" dontpushpred="1" function="and">
          <call function="=">
            <column column="id_slice" table="kod_isv_ad_evd_vs1" />
            <useparam name="id_slice" />
          </call>
          <call function="gt">
            <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            <useparam name="date_end_cur_Q" />
          </call>
          <call function="=1">
            <call function="over" title=" " type="number">
              <call function="max">
                <call function="if">
                  <call function="and">
                    <call function="=">
                      <column column="id_slice" table="kod_isv_ad_evd_vs1" />
                      <useparam name="id_slice_week" />
                    </call>
                    <call function="le">
                      <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
                      <useparam name="date_end_cur_Q" />
                    </call>
                  </call>
                  <const>1</const>
                </call>
              </call>
              <call function="partition by">
                <column column="kod_dop_contract" table="kod_isv_ad_evd_vs1" />
              </call>
            </call>
          </call>
        </call>
        <call as="is_sou_changed1_2" dontpushpred="1" function="and">
          <call function="=">
            <column column="id_slice" table="kod_isv_ad_evd_vs1" />
            <useparam name="id_slice" />
          </call>
          <call dontpushpred="1" function="and">
            <call function="=">
              <call function="trunc">
                <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
                <const>'Q'</const>
              </call>
              <useparam name="date_beg_next_Q" />
            </call>
          </call>
          <call function="=1">
            <call function="over" title=" " type="number">
              <call function="max">
                <call function="if">
                  <call function="and">
                    <call function="=">
                      <column column="id_slice" table="kod_isv_ad_evd_vs1" />
                      <useparam name="id_slice_week" />
                    </call>
                    <call function="le">
                      <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
                      <useparam name="date_end_cur_Q" />
                    </call>
                  </call>
                  <const>1</const>
                </call>
              </call>
              <call function="partition by">
                <column column="kod_dop_contract" table="kod_isv_ad_evd_vs1" />
              </call>
            </call>
          </call>
        </call>
        <call as="is_sou_changed2" dontpushpred="1" function="and">
          <call function="=">
            <column column="id_slice" table="kod_isv_ad_evd_vs1" />
            <useparam name="id_slice" />
          </call>
          <call function="ge">
            <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            <useparam name="date_beg_cur_Q_pl2" />
          </call>
          <call function="=1">
            <call function="over" title=" " type="number">
              <call function="max">
                <call function="if">
                  <call function="and">
                    <call function="=">
                      <column column="id_slice" table="kod_isv_ad_evd_vs1" />
                      <useparam name="id_slice_week" />
                    </call>
                    <call function="lt">
                      <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
                      <useparam name="date_beg_cur_Q_pl2" />
                    </call>
                  </call>
                  <const>1</const>
                </call>
              </call>
              <call function="partition by">
                <column column="kod_dop_contract" table="kod_isv_ad_evd_vs1" />
              </call>
            </call>
          </call>
        </call>
        <call as="is_sou2019p" dontpushpred="1" function="and">
          <call function="=">
            <column column="id_slice" table="kod_isv_ad_evd_vs1" />
            <useparam name="id_slice" />
          </call>
          <call function="ge">
            <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
            <useparam name="date_beg_cur_Q_pl2" />
          </call>
          <call function="=1">
            <call function="over" title=" " type="number">
              <call function="max">
                <call function="if">
                  <call function="and">
                    <call function="=">
                      <column column="id_slice" table="kod_isv_ad_evd_vs1" />
                      <useparam name="id_slice_week" />
                    </call>
                    <call function="gt">
                      <call function="+nvl">
                        <column column="col_n" table="kod_isv_ad_evd_vs1" />
                        <column column="col_p_2" table="kod_isv_ad_evd_vs1" />
                      </call>
                      <const>0</const>
                    </call>
                    <call function="=">
                      <call function="trunc">
                        <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
                        <const>'Q'</const>
                      </call>
                      <useparam name="date_beg_next_Q" />
                    </call>
                  </call>
                  <const>1</const>
                </call>
              </call>
              <call function="partition by">
                <column column="kod_dop_contract" table="kod_isv_ad_evd_vs1" />
              </call>
            </call>
          </call>
          <call function="!=">
            <call function="+nvl">
              <column column="col_n" table="kod_isv_ad_evd_vs1" />
              <column column="col_p_2" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>0</const>
          </call>
        </call>
        <call as="is_ispoln" dontpushpred="1" function="and">
          <call function="=">
            <column column="id_slice" table="kod_isv_ad_evd_vs1" />
            <useparam name="id_slice" />
          </call>
          <call function="=">
            <call function="+nvl">
              <column column="col_n" table="kod_isv_ad_evd_vs1" />
              <column column="col_p_2" table="kod_isv_ad_evd_vs1" />
            </call>
            <const>0</const>
          </call>
          <call function="=1">
            <call function="over" title=" " type="number">
              <call function="max">
                <call function="if">
                  <call function="and">
                    <call function="=">
                      <column column="id_slice" table="kod_isv_ad_evd_vs1" />
                      <useparam name="id_slice_week" />
                    </call>
                    <call function="gt">
                      <call function="+nvl">
                        <column column="col_n" table="kod_isv_ad_evd_vs1" />
                        <column column="col_p_2" table="kod_isv_ad_evd_vs1" />
                      </call>
                      <const>0</const>
                    </call>
                    <call function="=">
                      <call function="trunc">
                        <column column="srok_uslug" table="kod_isv_ad_evd_vs1" />
                        <const>'Q'</const>
                      </call>
                      <useparam name="date_beg_next_Q" />
                    </call>
                  </call>
                  <const>1</const>
                </call>
              </call>
              <call function="partition by">
                <column column="kod_dop_contract" table="kod_isv_ad_evd_vs1" />
              </call>
            </call>
          </call>
        </call>
        <call as="sou_changed1_1" function="()" group="sum" title="было СОУ 1кв2018 - продлено" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_changed1_1" />
        </call>
        <call as="sou_changed1_2" function="()" group="sum" title="продлено на 2-4кв.2018" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_changed1_2" />
        </call>
        <call as="sou_changed2" function="()" group="sum" title="продлено на 2019" type="number">
          <fact column="isv_ad_evd_vs1_col_no_fact" condition="is_sou_changed2" />
        </call>
        <call as="sou_unchanged_week" function="-nvl" group="sum" nvl="0" title="Факт за неделю в т.ч. без продления">
          <fact column="col_any_fact_week" nvl="0" />
          <fact column="sou_changed1_1" nvl="0" />
        </call>
        <call as="col_no_fact_nxt1_2_week" function="()" group="sum" type="number">
          <fact column="col_no_fact_nxt1_2" condition="is_week" />
        </call>
        <call as="col_no_fact_nxt1_1_ispoln" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_count" condition="is_ispoln" />
        </call>
        <call as="col_no_fact_nxt1_2_to_2019" function="()" group="sum" type="number">
          <fact column="isv_ad_evd_vs1_count" condition="is_sou2019p" />
        </call>
        <call as="is_not_fl_reestr_2018_fact" function="!=">
          <column column="fl_reestr_fact" table="kod_isv_ad_evd_vs1" />
          <const>1</const>
        </call>
        <call as="col_any_fact_2018" function="()" group="sum" title="Исполнено за 2018 год" type="number">
          <fact column="isv_ad_evd_vs1_col_any_fact" condition="is_not_fl_reestr_2018_fact" />
        </call>
        <call as="col_any_fact_week_diff" function="-nvl" group="sum">
          <fact column="isv_ad_evd_vs1_col_any_fact" condition="is_cur" />
          <fact column="isv_ad_evd_vs1_col_any_fact" condition="is_week" />
        </call>
      </expressions>
      <select>
        <column table="ipr_kod_ispolnit" column="kod_direct" />
        <column table="ipr_kod_ispolnit" column="name" as="name_podr" />
        <column column="kod_predpr" as="kod_predpr" table="ipr_kod_ispolnit" />
        <column table="ipr_kod_ispolnit" column="fl_branch" />
        <call function="year" as="year_zakl" group="max">
          <column table="kod_isv_ad_evd" column="dt_contract" />
        </call>
        <fact column="isv_ad_everyday_vs1_col_plan" as="col_plan" nvl="0" group="sum" table="evd_cur" />
        <fact column="isv_ad_evd_vs1_col_any_fact" as="col_any_fact" nvl="0" group="sum" table="evd_cur" />
        <fact column="isv_ad_everyday_vs1_col_i" as="col_i" nvl="0" group="sum" table="evd_cur" />
        <fact column="isv_ad_everyday_vs1_col_l" as="col_l" nvl="0" group="sum" table="evd_cur" />
        <fact column="isv_ad_everyday_vs1_col_l_2" as="col_l_2" nvl="0" group="sum" table="evd_cur" />
        <fact column="isv_ad_everyday_vs1_col_p" as="col_p" nvl="0" group="sum" table="evd_cur" />
        <fact column="isv_ad_evd_vs1_col_no_fact" as="col_no_fact" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_cur" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_nxt1_2" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_nxt2" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_nxt3" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_pr" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_any_fact_week" nvl="0" group="sum" table="evd" />
        <fact column="col_any_fact_3week" nvl="0" group="sum" table="evd" />
        <fact column="col_any_fact_2to1w" nvl="0" group="sum" table="evd" />
        <call function="()" as="col_any_fact_3w_avg" group="sum">
          <call function="/">
            <fact column="col_any_fact_3week" nvl="0" table="evd" />
            <const>3</const>
          </call>
        </call>
        <call function="()" as="col_any_fact_mon_avg" group="sum">
          <call function="*">
            <call function="/">
              <fact column="col_any_fact_3week" nvl="0" table="evd" />
              <const>21</const>
            </call>
            <call function="/">
              <const column="col_any_fact_3week" nvl="0" table="evd">365</const>
              <const>12</const>
            </call>
          </call>
        </call>
        <call as="col_any_fact_mon_avg0" function="()" group="sum">
          <call function="if">
            <call function="gt">
              <call function="over">
                <call function="sum">
                  <column column="col_any_fact_mon_avg" nvl="0" table="this" group="no" />
                </call>
                <call function="partition by">
                  <column table="ipr_kod_ispolnit" column="kod_direct" />
                </call>
              </call>
              <const>0</const>
            </call>
            <column column="col_any_fact_mon_avg" nvl="0" table="this" group="no" />
            <const>0</const>
          </call>
        </call>
        <call function="round" as="weeks_to_end" group="max">
          <call function="/">
            <call function="+">
              <call function="-">
                <useparam name="date_end_cur_Q" />
                <useparam name="date_otch" />
              </call>
              <const>1</const>
            </call>
            <const>7</const>
          </call>
          <const>0</const>
        </call>
        <call function="round" as="weeks_to_end2" group="max">
          <call function="/">
            <call function="+">
              <call function="-">
                <useparam name="date_end_cur_Y" />
                <useparam name="date_otch" />
              </call>
              <const>1</const>
            </call>
            <const>7</const>
          </call>
          <const>0</const>
        </call>
        <call function="*" as="wait_end1" group="sum">
          <column table="this" column="col_any_fact_3w_avg" group="no" />
          <column table="this" column="weeks_to_end" group="no" />
        </call>
        <call function="()" group="sum" as="wait_end">
          <call function="if" type="number">
            <call function="gt">
              <call function="over">
                <call function="sum">
                  <column table="this" column="wait_end1" group="no" />
                </call>
                <call function="partition by">
                  <column table="ipr_kod_ispolnit" column="kod_direct" />
                </call>
              </call>
              <const>0</const>
            </call>
            <column table="this" column="wait_end1" group="no" />
            <const>0</const>
          </call>
        </call>
        <fact column="sou_changed1_2" group="sum" table="evd" nvl="0" />
        <fact column="sou_changed2" group="sum" table="evd" nvl="0" />
        <fact column="sou_unchanged_week" table="evd" group="sum" nvl="0" />
        <fact column="col_no_fact_nxt1_2_week" table="evd" group="sum" title="Остаток плана на 2-4 кв. 2018" nvl="0" />
        <fact column="col_no_fact_nxt1_2_to_2019" table="evd" group="sum" title="Остаток плана на 2-4 кв. 2018. Продлено на 2019" nvl="0" />
        <fact column="col_no_fact_nxt1_1_ispoln" table="evd" group="sum" title="Остаток плана на 2-4 кв. 2018 Исполнено" nvl="0" />
        <fact column="col_no_fact_mon0" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_mon1" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_mon2" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_mon3" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_mon4" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_mon5" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_mon6" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_mon7" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_mon8" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_mon9" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_mon10" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_mon11" nvl="0" group="sum" table="evd_cur" />
        <fact column="col_no_fact_mon12" nvl="0" group="sum" table="evd_cur" />
        <column table="kod_isv_ad_evd" column="fl_fake" />
        <fact group="sum" table="evd_cur" column="col_any_fact_2018" nvl="0" />
        <fact table="evd" column="col_any_fact_week_diff" group="sum" />
      </select>
      <from>
        <qube>
          <link name="ipr_kod_ispolnit" />
          <link name="kod_isv_ad_evd_vs1" as="kod_isv_ad_evd" />
          <link name="id_slice" />
          <link name="evd_c_zayav_num_z_id" exclude="1" />
          <dimset as="evd">
            <where>
              <call function="in">
                <column table="id_slice" column="id_slice" />
                <useparam name="id_slice_range2" />
              </call>
              <call function="or" exclude="1">
                <call function="=">
                  <column table="evd_c_zayav_num_z_id" column="kod_spr_query" />
                  <const comment="Вынос сетей">21</const>
                </call>
                <call function="is null">
                  <column table="kod_isv_ad_evd" column="num_req" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="evd_cur">
            <where>
              <call function="=">
                <column table="id_slice" column="id_slice" />
                <useparam name="id_slice" />
              </call>
              <call function="or" exclude="1">
                <call function="=">
                  <column table="evd_c_zayav_num_z_id" column="kod_spr_query" />
                  <const comment="Вынос сетей">21</const>
                </call>
                <call function="=">
                  <column table="kod_isv_ad_evd" column="fl_fake" />
                  <const>1</const>
                </call>
              </call>
            </where>
          </dimset>
        </qube>
      </from>
      <grouping materialize-type="temp-table">
        <grset as="all" title="Итог">
          <grset as="by_dep" title="По филиалам" order="fl_branch, kod_predpr">
            <group>
              <sourcelink table="ipr_kod_ispolnit" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="53419-title" timestamp="20.07.2019 12:52:57">
      <params>
        <usepart part="45676-params" />
      </params>
      <select>
        <call function="to_char" as="slice_date" group="max">
          <column table="a" column="dat_copy_time" />
          <const>'DD.MM.YYYY'</const>
        </call>
        <call as="sdate_begin" function="to_char" group="max">
          <useparam name="date_from" />
          <const>'dd.mm'</const>
        </call>
        <call function="to_char" as="sdate_end" group="max">
          <useparam name="date_to" />
          <const>'dd.mm'</const>
        </call>
        <call function="to_char" as="sdate_begin_full" group="max">
          <useparam name="date_from" />
          <const>'dd.mm.yyyy'</const>
        </call>
        <call function="||" as="sdate_range" group="max">
          <column table="this" column="sdate_begin" group="no" />
          <const>'-'</const>
          <column table="this" column="sdate_end" group="no" />
        </call>
        <call function="to_char" as="sdate_begin_1w" group="max">
          <useparam name="date_last_2week" />
          <const>'dd.mm'</const>
        </call>
        <call function="to_char" as="sdate_end_1w" group="max">
          <call function="date add days">
            <useparam name="date_last_week" />
            <const>-1</const>
          </call>
          <const>'dd.mm'</const>
        </call>
        <call function="||" as="sdate_range_1w" group="max">
          <column table="this" column="sdate_begin_1w" group="no" />
          <const>'-'</const>
          <column table="this" column="sdate_end_1w" group="no" />
        </call>
        <call as="slice_month_name" function="mes-name" group="max">
          <call function="month">
            <column table="a" column="dat_copy" />
          </call>
        </call>
        <call function="to_char" as="date_end_cur_Q" group="max">
          <useparam name="date_end_cur_Q" />
          <const>'dd.mm.yyyy'</const>
        </call>
        <call function="()" as="cy" type="number" group="max">
          <useparam name="cur_year" />
        </call>
        <call function="year" as="ny" group="max">
          <useparam name="date_beg_next_Y" />
        </call>
        <call as="nkv" function="||" group="max">
          <call name="kv" function="mes to kv">
            <call function="month">
              <useparam name="date_beg_next_Q" />
            </call>
          </call>
          <const>' кв. '</const>
          <call name="year" function="year">
            <useparam name="date_beg_next_Q" />
          </call>
        </call>
        <call as="ckv" function="||" group="max">
          <useparam name="kv" />
          <const>' кв. '</const>
          <useparam name="year" />
        </call>
        <call as="nnkv" function="||" group="max">
          <call function="if">
            <call function="=">
              <call function="month">
                <useparam name="date_beg_cur_Q_pl2" />
              </call>
              <const>1</const>
            </call>
            <const>''</const>
            <call function="||">
              <call name="kv" function="mes to kv">
                <call function="month">
                  <useparam name="date_beg_cur_Q_pl2" />
                </call>
              </call>
              <const>' кв. '</const>
            </call>
          </call>
          <call name="year" function="year">
            <useparam name="date_beg_cur_Q_pl2" />
          </call>
        </call>
      </select>
      <from>
        <query name="is_ad_all_slice" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="id_slice" />
            <useparam name="id_slice" />
          </call>
        </call>
      </where>
    </query>
  </queries>
  <forms>
    <form name="53419" timestamp="20.07.2019 13:03:03">
      <usefield field="kido_id_slice_2" column-mandatory="1">
        <defaultquery>
          <query name="45676-id_slice_cur" />
        </defaultquery>
      </usefield>
      <fieldgroup title="Квартал отчета">
        <usefield field="asuse_year2" mandatory="1" column-visible="0" column-editable="0">
          <defaultquery>
            <query name="45676-49578_def_year" />
          </defaultquery>
        </usefield>
        <usefield field="asuse_kv" column-mandatory="1" column-visible="0" column-editable="0">
          <defaultquery>
            <query name="45676-49578_def_kv" />
          </defaultquery>
        </usefield>
      </fieldgroup>
      <fieldgroup title="Контрольные даты">
        <usefield field="kido_id_slice_2" name="id_slice_week" title="Неделя" column-mandatory="1">
          <defaultquery>
            <query name="45676-id_slice_week" />
          </defaultquery>
        </usefield>
        <usefield field="kido_id_slice_2" name="id_slice_2week" title="2 недели" column-mandatory="1">
          <defaultquery>
            <query name="45676-id_slice_2week" />
          </defaultquery>
        </usefield>
        <usefield field="kido_id_slice_2" name="id_slice_3week" title="3 недели" column-mandatory="1">
          <defaultquery>
            <query name="45676-id_slice_3week" />
          </defaultquery>
        </usefield>
      </fieldgroup>
      <fieldgroup title="Контрольные даты">
        <usefield field="cmn_date" name="date_otch" title="Отчетная дата" column-mandatory="1" column-editable="0" column-visible="0">
          <defaultquery>
            <query name="45676-date-otch-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_date" name="date_from" title="Неделя" column-mandatory="1" column-visible="0">
          <defaultquery>
            <query name="45676-date-from-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_date" name="date_to" title="Конец недели" column-mandatory="1" column-visible="0">
          <defaultquery>
            <query name="45676-date-to-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_date" name="date_last_week" title="Неделя" column-visible="0">
          <defaultquery>
            <query name="45676-date-last-week-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_date" name="date_last_2week" title="2 недели" column-visible="0">
          <defaultquery>
            <query name="45676-date-last-2week-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_date" name="date_last_3week" title="3 недели" column-visible="0">
          <defaultquery>
            <query name="45676-date-last-3week-def" />
          </defaultquery>
        </usefield>
        <usefield field="kido_id_slice_m" title="Выбранные диапазоны 2" name="id_slice_range2" column-visible="0">
          <defaultquery>
            <query name="45676-id_slice_range2" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_date" name="date_beg_cur_Q" column-mandatory="1" column-editable="0" title="Первая дата текущего квартала" column-visible="0">
          <defaultquery>
            <query name="45676-49578-date_beg_cur_Q" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_date" name="date_end_cur_Q" column-mandatory="1" column-editable="0" title="Последняя дата текущего квартала" column-visible="0">
          <defaultquery>
            <query name="45676-49578-date_end_cur_Q" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_date" name="date_beg_next_Q" column-mandatory="1" column-editable="0" title="Первая дата следующего квартала" column-visible="0">
          <defaultquery>
            <query name="45676-49578-date_beg_next_Q" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_date" name="date_beg_cur_Q_pl2" column-mandatory="1" column-editable="0" title="Первая дата квартала + 2" column-visible="0">
          <defaultquery>
            <query name="45676-49578-date_beg_cur_Q_pl2" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_date" name="date_beg_next_Y" column-mandatory="1" column-editable="0" title="Первая дата следующего года" column-visible="0">
          <defaultquery>
            <query name="45676-49578-date_beg_next_Y" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_date" name="date_end_cur_Y" column-mandatory="1" column-editable="0" title="Последняя дата текущего года" column-visible="0">
          <defaultquery>
            <query name="45676-49578-date_end_cur_Y" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_integer" name="cur_year" column-mandatory="1" column-editable="0" title="Год отчета" column-visible="0">
          <defaultquery>
            <query name="45676-49578-cur_year" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_integer" name="next_year" column-mandatory="1" column-editable="0" title="Следующий год" column-visible="0">
          <defaultquery>
            <query name="45676-48004-next_year" />
          </defaultquery>
        </usefield>
      </fieldgroup>
    </form>
  </forms>
</root>