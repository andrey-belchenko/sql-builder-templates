<?xml version="1.0" encoding="utf-8"?>
<root>
  <!--У юр лиц не учитываются привязанные платежки!-->
  <parts>
    <!--Параметры по умолчанию-->
    <part id="26897-params1">
      <param name="dep">
        <const>18322</const>
      </param>
      <param name="abon_type">
        <array>
          <const>1</const>
          <const>2</const>
        </array>
      </param>
      <param name="dat_form">
        <const>sysdate</const>
      </param>
      <param name="ym1">
        <const>2010.01</const>
      </param>
      <param name="ym2">
        <const>2010.12</const>
      </param>
      <param name="prizn_po">
        <const>1</const>
      </param>
    </part>
    <part id="26897-useparams1">
      <useparam name="dep" />
      <useparam name="abon_type" />
      <call function="nvlu">
        <useparam name="dat_form" />
        <const>sysdate</const>
      </call>
      <useparam name="ym1" />
      <useparam name="ym2" />
      <useparam name="prizn_po" />
    </part>
    <part id="26897-params2">
      <param name="dep">
        <const>27040</const>
      </param>
      <param name="abon_type">
        <array>
          <const>1</const>
          <const>2</const>
        </array>
      </param>
      <param name="dat_begin_gp">
        <call function="nativity" />
      </param>
      <param name="dat_end_gp">
        <const>to_date('01.01.2014','dd.mm.yyyy')</const>
      </param>
      <param name="dat_begin_opl">
        <!--<const>to_date('01.01.2010','dd.mm.yyyy')</const>-->
        <call function="nativity" />
      </param>
      <param name="dat_end_opl">
        <!--<const>to_date('31.12.2010','dd.mm.yyyy')</const>-->
        <const>to_date('01.01.2014','dd.mm.yyyy')</const>
      </param>
      <param name="dat_border">
        <const>to_date('01.01.2014','dd.mm.yyyy')</const>
      </param>
    </part>
    <part id="26897-useparams2">
      <useparam name="dep" />
      <useparam name="abon_type" />
      <useparam name="dat_begin_gp" />
      <useparam name="dat_end_gp" />
      <useparam name="dat_begin_opl" />
      <useparam name="dat_end_opl" />
      <useparam name="dat_border" />
    </part>
    <!--ПО на начало года-->
    <part id="26897-useparams-nyny">
      <useparam name="dep" />
      <useparam name="abon_type" />
      <!--Иски собираем с датой ГП до начала года-->
      <call function="nativity" />
      <call function="year begin time">
        <call function="year">
          <call function="ym begin time">
            <useparam name="ym1" />
          </call>
        </call>
      </call>
      <!--Оплаты собираем на начало года-->
      <call function="nativity" />
      <call function="year begin time">
        <call function="year">
          <call function="ym begin time">
            <useparam name="ym1" />
          </call>
        </call>
      </call>
      <!--Считаем задолженность на начало отчётного года(!) и отбрасываем погашеные иски-->
      <call function="year begin time">
        <call function="year">
          <call function="ym begin time">
            <useparam name="ym1" />
          </call>
        </call>
      </call>
    </part>
    <part id="26897-useparams-nypp">
      <useparam name="dep" />
      <useparam name="abon_type" />
      <!--Иски собираем с датой ГП до начала года-->
      <call function="nativity" />
      <call function="year begin time">
        <call function="year">
          <call function="ym begin time">
            <useparam name="ym1" />
          </call>
        </call>
      </call>
      <!--Оплаты собираем с начала года до даты формирования ведомости-->
      <call function="year begin time">
        <call function="year">
          <call function="ym begin time">
            <useparam name="ym1" />
          </call>
        </call>
      </call>
      <useparam name="dat_form" />
      <!--Считаем задолженность на начало отчётного года(!) и отбрасываем погашеные иски-->
      <call function="year begin time">
        <call function="year">
          <call function="ym begin time">
            <useparam name="ym1" />
          </call>
        </call>
      </call>
    </part>
    <!--ПО после начала года-->
    <part id="26897-useparams-ypnp">
      <useparam name="dep" />
      <useparam name="abon_type" />
      <!--Иски собираем с датой ГП после начала года до отчётного периода-->
      <call function="year begin time">
        <call function="year">
          <call function="ym begin time">
            <useparam name="ym1" />
          </call>
        </call>
      </call>
      <call function="ym begin time">
        <useparam name="ym1" />
      </call>
      <!--Оплаты собираем до отчётного периода-->
      <call function="year begin time">
        <call function="year">
          <call function="ym begin time">
            <useparam name="ym1" />
          </call>
        </call>
      </call>
      <call function="ym begin time">
        <useparam name="ym1" />
      </call>
      <!--Считаем задолженность на начало отчётного года(!) и отбрасываем погашеные иски-->
      <call function="year begin time">
        <call function="year">
          <call function="ym begin time">
            <useparam name="ym1" />
          </call>
        </call>
      </call>
    </part>
    <part id="26897-useparams-yppp">
      <useparam name="dep" />
      <useparam name="abon_type" />
      <!--Иски собираем с датой ГП после начала года до отчётного периода-->
      <call function="year begin time">
        <call function="year">
          <call function="ym begin time">
            <useparam name="ym1" />
          </call>
        </call>
      </call>
      <call function="ym begin time">
        <useparam name="ym1" />
      </call>
      <!--Оплаты собираем с начала отчётного периода до даты формирования ведомости-->
      <call function="ym begin time">
        <useparam name="ym1" />
      </call>
      <useparam name="dat_form" />
      <!--Считаем задолженность на начало отчётного года(!) и отбрасываем погашеные иски-->
      <call function="year begin time">
        <call function="year">
          <call function="ym begin time">
            <useparam name="ym1" />
          </call>
        </call>
      </call>
    </part>
    <!--Отчётный период-->
    <part id="26897-useparams-pppp">
      <useparam name="dep" />
      <useparam name="abon_type" />
      <!--Иски собираем в отч. периоде-->
      <call function="ym begin time">
        <useparam name="ym1" />
      </call>
      <call function="add_month">
        <call function="ym begin time">
          <useparam name="ym2" />
        </call>
      </call>
      <!--Оплаты собираем с начала отчётного периода до даты формирования ведомости-->
      <call function="ym begin time">
        <useparam name="ym1" />
      </call>
      <useparam name="dat_form" />
      <!--Считаем задолженность на начало отчётного года(!) и отбрасываем погашеные иски-->
      <call function="year begin time">
        <call function="year">
          <call function="ym begin time">
            <useparam name="ym1" />
          </call>
        </call>
      </call>
    </part>
  </parts>
  <!--Владивосток-->
  <forms>
    <form name="26897" with-behavior="0" timestamp="21.11.2016 14:26:50">
      <content>
        <field name="abon_type" controlType="UIList" title="Тип абонентов" show-nulls="0">
          <listquery>
            <query name="kr_payer_abon_type" />
          </listquery>
          <defaultquery>
            <query name="abon_type_current" />
          </defaultquery>
        </field>
        <field name="dep" controlType="UIList" title="Отделения">
          <listquery>
            <query name="kr_dep"></query>
          </listquery>
          <defaultquery>
            <query name="kr_dep_current" />
          </defaultquery>
          <return>
            <array>
              <fieldvalue />
            </array>
          </return>
        </field>
        <!--<field name="dat_form" controlType="UIDate" title="Дата формирования ведомости" mandatory="1" valuequery="cur-date"/>-->
        <field name="ym" controlType="UIComboRange" title="Отчётный период" mandatory="1">
          <listquery>
            <query name="kr_calc_list_with_cur"></query>
          </listquery>
          <defaultquery>
            <query name="kr_calc_cur"></query>
          </defaultquery>
        </field>
        <field name="prizn_po" controlType="UICheck" title="С детализацией переходящих остатков" checked="1" />
      </content>
    </form>
    <form name="testo" comment="проверка" with-behavior="0" timestamp="21.11.2016 14:26:51">
      <content>
        <field name="dep" controlType="UIList" title="Список" single-value="1" mandatory="1">
          <listquery>
            <query name="kr_dep" />
          </listquery>
          <defaultquery>
            <query name="kr_dep" />
          </defaultquery>
          <return>
            <array>
              <fieldvalue />
            </array>
          </return>
        </field>
        <field name="dat_form" controlType="UIDate" title="Дата" mandatory="1" valuequery="cur-date" />
        <field name="ymmm" controlType="UICombo" title="Комбик" mandatory="1">
          <listquery>
            <query name="kr_calc_list_with_cur" />
          </listquery>
          <defaultquery>
            <query name="kr_calc_cur" />
          </defaultquery>
        </field>
        <field name="ym" controlType="UIComboRange" title="Комбики" mandatory="1">
          <listquery>
            <query name="kr_calc_list_with_cur" />
          </listquery>
          <defaultquery>
            <query name="kr_calc_cur" />
          </defaultquery>
        </field>
        <field name="text1" controlType="UITextEx" title="Текст" mandatory="1" valuequery="cur-date" />
        <field name="text2" controlType="UITextEx" title="Текст" mandatory="1" />
      </content>
    </form>
  </forms>
  <reports>
    <report name="26897" title="Ведомость по учету государственной пошлины" form="26897" allow-save="1" folder="ur_reports">
      <customers>
        <customer id="2" />
      </customers>
      <params>
        <usepart part="26897-params1" />
      </params>
      <print-templates>
        <excel>
          <template name="26897.xml" title="Ведомость по учету государственной пошлины" />
        </excel>
      </print-templates>
      <queries>
        <query name="26897-rep" as="m" title="Шапка">
          <withparams>
            <useparam name="abon_type" />
            <call function="nvlu">
              <useparam name="dat_form" />
              <const>sysdate</const>
            </call>
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="prizn_po" />
          </withparams>
          <!--ПО на начало года-->
          <query name="26897-rep-fl" as="c0" title="ФЛ. ПО на начало года">
            <withparams>
              <useparam name="abon_type" />
            </withparams>
            <query name="26897-mat-nyny-fl" as="c" title="ФЛ. Иски. ПО на начало года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <query name="26897-opl-mat-nyny-fl" as="c1" title="ФЛ. Оплаты по иску. ПО на начало года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="c" column="kod_mat_pp" />
                  <column table="c1" column="kod_mat_pp" />
                </call>
              </query>
              <query name="26897-opl-isp-nyny-fl" as="c2" title="ФЛ. Оплаты по ИЛ. ПО на начало года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="c" column="kod_mat_pp" />
                  <column table="c2" column="kod_mat_pp" />
                </call>
              </query>
              <call function="=">
                <column table="c0" column="kod_abon_type" />
                <column table="c" column="kod_abon_type" />
              </call>
            </query>
            <query name="26897-mat-nyny-fl-itog" as="c3" title="ФЛ. Итог. ПО на начало года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <call function="=">
                <column table="c0" column="kod" />
                <column table="c3" column="kod" />
              </call>
            </query>
            <call function="=">
              <column table="m" column="kod" />
              <column table="c0" column="kod" />
            </call>
          </query>
          <query name="26897-rep-ul" as="d0" title="ЮЛ. ПО на начало года">
            <withparams>
              <useparam name="abon_type" />
            </withparams>
            <query name="26897-mat-nyny-ul" as="d" title="ЮЛ. Иски. ПО на начало года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <query name="26897-opl-mat-nyny-ul" as="d1" title="ЮЛ. Оплаты по иску. ПО на начало года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="d" column="kod_mat_pp" />
                  <column table="d1" column="kod_mat_pp" />
                </call>
              </query>
              <query name="26897-opl-isp-nyny-ul" as="d2" title="ЮЛ. Оплаты по ИЛ. ПО на начало года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="d" column="kod_mat_pp" />
                  <column table="d2" column="kod_mat_pp" />
                </call>
              </query>
              <call function="=">
                <column table="d0" column="kod_abon_type" />
                <column table="d" column="kod_abon_type" />
              </call>
            </query>
            <query name="26897-mat-nyny-ul-itog" as="d3" title="ЮЛ. Итог. ПО на начало года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <call function="=">
                <column table="d0" column="kod" />
                <column table="d3" column="kod" />
              </call>
            </query>
            <call function="=">
              <column table="m" column="kod" />
              <column table="d0" column="kod" />
            </call>
          </query>
          <query name="26897-mat-nyny-itog" as="cd" title="Итог. ПО на начало года">
            <withparams>
              <usepart part="26897-useparams1" />
            </withparams>
            <call function="=">
              <column table="m" column="kod" />
              <column table="cd" column="kod" />
            </call>
          </query>
          <!--Погашено ПО на начало года-->
          <query name="26897-rep-fl" as="e0" title="ФЛ. Погашено ПО на начало года">
            <withparams>
              <useparam name="abon_type" />
            </withparams>
            <query name="26897-mat-nypp-fl" as="e" title="ФЛ. Иски. Погашено ПО на начало года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <query name="26897-opl-mat-nypp-fl" as="e1" title="ФЛ. Оплаты по иску. Погашено ПО на начало года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="e" column="kod_mat_pp" />
                  <column table="e1" column="kod_mat_pp" />
                </call>
              </query>
              <query name="26897-opl-isp-nypp-fl" as="e2" title="ФЛ. Оплаты по ИЛ. Погашено ПО на начало года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="e" column="kod_mat_pp" />
                  <column table="e2" column="kod_mat_pp" />
                </call>
              </query>
              <call function="=">
                <column table="e0" column="kod_abon_type" />
                <column table="e" column="kod_abon_type" />
              </call>
            </query>
            <query name="26897-mat-nypp-fl-itog" as="e3" title="ФЛ. Итог. Погашено ПО на начало года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <call function="=">
                <column table="e0" column="kod" />
                <column table="e3" column="kod" />
              </call>
            </query>
            <call function="=">
              <column table="m" column="kod" />
              <column table="e0" column="kod" />
            </call>
          </query>
          <query name="26897-rep-ul" as="f0" title="ЮЛ. Погашено ПО на начало года">
            <withparams>
              <useparam name="abon_type" />
            </withparams>
            <query name="26897-mat-nypp-ul" as="f" title="ЮЛ. Иски. Погашено ПО на начало года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <query name="26897-opl-mat-nypp-ul" as="f1" title="ЮЛ. Оплаты по иску. Погашено ПО на начало года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="f" column="kod_mat_pp" />
                  <column table="f1" column="kod_mat_pp" />
                </call>
              </query>
              <query name="26897-opl-isp-nypp-ul" as="f2" title="ЮЛ. Оплаты по ИЛ. Погашено ПО на начало года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="f" column="kod_mat_pp" />
                  <column table="f2" column="kod_mat_pp" />
                </call>
              </query>
              <call function="=">
                <column table="f0" column="kod_abon_type" />
                <column table="f" column="kod_abon_type" />
              </call>
            </query>
            <query name="26897-mat-nypp-ul-itog" as="f3" title="ЮЛ. Итог. Погашено ПО на начало года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <call function="=">
                <column table="f0" column="kod" />
                <column table="f3" column="kod" />
              </call>
            </query>
            <call function="=">
              <column table="m" column="kod" />
              <column table="f0" column="kod" />
            </call>
          </query>
          <query name="26897-mat-nypp-itog" as="ef" title="Итог. Погашено ПО на начало года">
            <withparams>
              <usepart part="26897-useparams1" />
            </withparams>
            <call function="=">
              <column table="m" column="kod" />
              <column table="ef" column="kod" />
            </call>
          </query>
          <!--ПО после начала года-->
          <query name="26897-rep-fl" as="g0" title="ФЛ. ПО после начала года">
            <withparams>
              <useparam name="abon_type" />
            </withparams>
            <query name="26897-mat-ypnp-fl" as="g" title="ФЛ. Иски. ПО после начала года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <query name="26897-opl-mat-ypnp-fl" as="g1" title="ФЛ. Оплаты по иску. ПО после начала года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="g" column="kod_mat_pp" />
                  <column table="g1" column="kod_mat_pp" />
                </call>
              </query>
              <query name="26897-opl-isp-ypnp-fl" as="g2" title="ФЛ. Оплаты по ИЛ. ПО после начала года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="g" column="kod_mat_pp" />
                  <column table="g2" column="kod_mat_pp" />
                </call>
              </query>
              <call function="=">
                <column table="g0" column="kod_abon_type" />
                <column table="g" column="kod_abon_type" />
              </call>
            </query>
            <query name="26897-mat-ypnp-fl-itog" as="g3" title="ФЛ. Итог. ПО после начала года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <call function="=">
                <column table="g0" column="kod" />
                <column table="g3" column="kod" />
              </call>
            </query>
            <call function="=">
              <column table="m" column="kod" />
              <column table="g0" column="kod" />
            </call>
          </query>
          <query name="26897-rep-ul" as="h0" title="ЮЛ. ПО после начала года">
            <withparams>
              <useparam name="abon_type" />
            </withparams>
            <query name="26897-mat-ypnp-ul" as="h" title="ЮЛ. Иски. ПО после начала года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <query name="26897-opl-mat-ypnp-ul" as="h1" title="ЮЛ. Оплаты по иску. ПО после начала года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="h" column="kod_mat_pp" />
                  <column table="h1" column="kod_mat_pp" />
                </call>
              </query>
              <query name="26897-opl-isp-ypnp-ul" as="h2" title="ЮЛ. Оплаты по ИЛ. ПО после начала года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="h" column="kod_mat_pp" />
                  <column table="h2" column="kod_mat_pp" />
                </call>
              </query>
              <call function="=">
                <column table="h0" column="kod_abon_type" />
                <column table="h" column="kod_abon_type" />
              </call>
            </query>
            <query name="26897-mat-ypnp-ul-itog" as="h3" title="ЮЛ. Итог. ПО после начала года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <call function="=">
                <column table="h0" column="kod" />
                <column table="h3" column="kod" />
              </call>
            </query>
            <call function="=">
              <column table="m" column="kod" />
              <column table="h0" column="kod" />
            </call>
          </query>
          <query name="26897-mat-ypnp-itog" as="gh" title="Итог. ПО после начала года">
            <withparams>
              <usepart part="26897-useparams1" />
            </withparams>
            <call function="=">
              <column table="m" column="kod" />
              <column table="gh" column="kod" />
            </call>
          </query>
          <!--Погашено ПО после начала года-->
          <query name="26897-rep-fl" as="k0" title="ФЛ. Погашено ПО после начала года">
            <withparams>
              <useparam name="abon_type" />
            </withparams>
            <query name="26897-mat-yppp-fl" as="k" title="ФЛ. Иски. Погашено ПО после начала года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <query name="26897-opl-mat-yppp-fl" as="k1" title="ФЛ. Оплаты по иску. Погашено ПО после начала года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="k" column="kod_mat_pp" />
                  <column table="k1" column="kod_mat_pp" />
                </call>
              </query>
              <query name="26897-opl-isp-yppp-fl" as="k2" title="ФЛ. Оплаты по ИЛ. Погашено ПО после начала года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="k" column="kod_mat_pp" />
                  <column table="k2" column="kod_mat_pp" />
                </call>
              </query>
              <call function="=">
                <column table="k0" column="kod_abon_type" />
                <column table="k" column="kod_abon_type" />
              </call>
            </query>
            <query name="26897-mat-yppp-fl-itog" as="k3" title="ФЛ. Итог. Погашено ПО после начала года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <call function="=">
                <column table="k0" column="kod" />
                <column table="k3" column="kod" />
              </call>
            </query>
            <call function="=">
              <column table="m" column="kod" />
              <column table="k0" column="kod" />
            </call>
          </query>
          <query name="26897-rep-ul" as="l0" title="ЮЛ. Погашено ПО после начала года">
            <withparams>
              <useparam name="abon_type" />
            </withparams>
            <query name="26897-mat-yppp-ul" as="l" title="ЮЛ. Иски. Погашено ПО после начала года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <query name="26897-opl-mat-yppp-ul" as="l1" title="ЮЛ. Оплаты по иску. Погашено ПО после начала года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="l" column="kod_mat_pp" />
                  <column table="l1" column="kod_mat_pp" />
                </call>
              </query>
              <query name="26897-opl-isp-yppp-ul" as="l2" title="ЮЛ. Оплаты по ИЛ. Погашено ПО после начала года">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="l" column="kod_mat_pp" />
                  <column table="l2" column="kod_mat_pp" />
                </call>
              </query>
              <call function="=">
                <column table="l0" column="kod_abon_type" />
                <column table="l" column="kod_abon_type" />
              </call>
            </query>
            <query name="26897-mat-yppp-ul-itog" as="l3" title="ЮЛ. Итог. Погашено ПО после начала года">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <call function="=">
                <column table="l0" column="kod" />
                <column table="l3" column="kod" />
              </call>
            </query>
            <call function="=">
              <column table="m" column="kod" />
              <column table="l0" column="kod" />
            </call>
          </query>
          <query name="26897-mat-yppp-itog" as="kl" title="Итог. Погашено ПО после начала года">
            <withparams>
              <usepart part="26897-useparams1" />
            </withparams>
            <call function="=">
              <column table="m" column="kod" />
              <column table="kl" column="kod" />
            </call>
          </query>
          <!--Отчётный период-->
          <query name="26897-rep-fl" as="a0" title="ФЛ. Отчётный период">
            <withparams>
              <useparam name="abon_type" />
            </withparams>
            <query name="26897-mat-pppp-fl" as="a" title="ФЛ. Иски. Отчётный период" main="1">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <query name="26897-opl-mat-pppp-fl" as="a1" title="ФЛ. Оплаты по иску. Отчётный период">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="a" column="kod_mat_pp" />
                  <column table="a1" column="kod_mat_pp" />
                </call>
              </query>
              <query name="26897-opl-isp-pppp-fl" as="a2" title="ФЛ. Оплаты по ИЛ. Отчётный период">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="a" column="kod_mat_pp" />
                  <column table="a2" column="kod_mat_pp" />
                </call>
              </query>
              <call function="=">
                <column table="a0" column="kod_abon_type" />
                <column table="a" column="kod_abon_type" />
              </call>
            </query>
            <query name="26897-mat-pppp-fl-itog" as="a3" title="ФЛ. Итог. Отчётный период">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <call function="=">
                <column table="a0" column="kod" />
                <column table="a3" column="kod" />
              </call>
            </query>
            <call function="=">
              <column table="m" column="kod" />
              <column table="a0" column="kod" />
            </call>
          </query>
          <query name="26897-rep-ul" as="b0" title="ЮЛ. Отчётный период">
            <withparams>
              <useparam name="abon_type" />
            </withparams>
            <query name="26897-mat-pppp-ul" as="b" title="ЮЛ. Иски. Отчётный период">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <query name="26897-opl-mat-pppp-ul" as="b1" title="ЮЛ. Оплаты по иску. Отчётный период">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="b" column="kod_mat_pp" />
                  <column table="b1" column="kod_mat_pp" />
                </call>
              </query>
              <query name="26897-opl-isp-pppp-ul" as="b2" title="ЮЛ. Оплаты по ИЛ. Отчётный период">
                <withparams>
                  <usepart part="26897-useparams1" />
                </withparams>
                <call function="=">
                  <column table="b" column="kod_mat_pp" />
                  <column table="b2" column="kod_mat_pp" />
                </call>
              </query>
              <call function="=">
                <column table="b0" column="kod_abon_type" />
                <column table="b" column="kod_abon_type" />
              </call>
            </query>
            <query name="26897-mat-pppp-ul-itog" as="b3" title="ЮЛ. Итог. Отчётный период">
              <withparams>
                <usepart part="26897-useparams1" />
              </withparams>
              <call function="=">
                <column table="b0" column="kod" />
                <column table="b3" column="kod" />
              </call>
            </query>
            <call function="=">
              <column table="m" column="kod" />
              <column table="b0" column="kod" />
            </call>
          </query>
          <query name="26897-mat-pppp-itog" as="ab" title="Итог. Отчётный период">
            <withparams>
              <usepart part="26897-useparams1" />
            </withparams>
            <call function="=">
              <column table="m" column="kod" />
              <column table="ab" column="kod" />
            </call>
          </query>
        </query>
      </queries>
    </report>
    <report name="test_data" title="Данные (тест)" form="testo" visible="0" allow-save="1">
      <customers>
        <customer id="2" />
        <!--<customer id="101"/>-->
      </customers>
      <print-templates>
        <excel>
          <template name="26897.xml" title="Ведомость по учету государственной пошлины" />
        </excel>
      </print-templates>
      <queries>
        <query name="26897-mat" as="a" grouplevel="no" title="Данные"></query>
      </queries>
    </report>
    <report name="bad_izv" title="Неправильные извещения на ГП" visible="0">
      <customers>
        <customer id="2" />
      </customers>
      <print-templates>
        <excel>
          <template name="bad_izv.xml" title="Неправильные извещения на ГП" />
        </excel>
      </print-templates>
      <queries>
        <query name="bizv_abon" as="m" title="Абонент">
          <query name="bizv_mat" as="a" title="Иски">
            <call function="=">
              <column table="m" column="kodp" />
              <column table="a" column="kodp" />
            </call>
          </query>
          <query name="bizv_izv" as="b" title="Извещения">
            <call function="=">
              <column table="m" column="kodp" />
              <column table="b" column="kodp" />
            </call>
          </query>
        </query>
      </queries>
    </report>
    <report name="bad_sf" title="Неправильные счета на ГП" form="test" visible="0">
      <customers>
        <customer id="2" />
      </customers>
      <print-templates>
        <excel>
          <template name="bad_sf.xml" title="Неправильные счета на ГП" />
        </excel>
      </print-templates>
      <queries>
        <query name="bsf_abon" as="m" title="Абонент">
          <query name="bsf_mat" as="a" title="Иски">
            <call function="=">
              <column table="m" column="kodp" />
              <column table="a" column="kodp" />
            </call>
          </query>
          <query name="bsf_sf" as="b" title="Счета">
            <call function="=">
              <column table="m" column="kodp" />
              <column table="b" column="kodp" />
            </call>
          </query>
        </query>
      </queries>
    </report>
  </reports>
  <queries>
    <!--Отчёт-->
    <query name="26897-rep">
      <params>
        <param name="abon_type" />
        <param name="dat_form">
          <const>sysdate</const>
        </param>
        <param name="ym1" />
        <param name="ym2" />
        <param name="prizn_po" />
      </params>
      <select>
        <const as="kod" type="number" key="1">1</const>
        <call function="" as="dat_form" title="Дата формирования" type="string">
          <call function="date to char">
            <useparam name="dat_form" />
          </call>
        </call>
        <call function="" as="ym1" title="Начальный период" type="string">
          <call function="ym to char">
            <useparam name="ym1" />
          </call>
        </call>
        <call function="" as="ym2" title="Конечный период" type="string">
          <call function="ym to char">
            <useparam name="ym2" />
          </call>
        </call>
        <call function="" as="dat_begin" type="string" title="Начальная отчётная дата">
          <call function="date to char">
            <call function="ym begin time">
              <useparam name="ym1" />
            </call>
          </call>
        </call>
        <call function="" as="dat_end" type="string" title="Конечная отчётная дата">
          <call function="date to char">
            <!--<call function="ym end time">
              <useparam name="ym2"/>
            </call>-->
            <call function="add_month">
              <call function="ym begin time">
                <useparam name="ym2" />
              </call>
            </call>
          </call>
        </call>
        <call function="" as="dat_begin_year" type="string" title="Начало года">
          <call function="date to char">
            <call function="year begin time">
              <call function="year">
                <call function="ym begin time">
                  <useparam name="ym1" />
                </call>
              </call>
            </call>
          </call>
        </call>
        <call function="" as="text_po" type="string" title="Вид итогов по ПО">
          <call function="||">
            <call function="case">
              <call function="when">
                <call function="and">
                  <call function="true" />
                  <call function="in" optional="1">
                    <const>1</const>
                    <useparam name="abon_type" />
                  </call>
                  <call function="in" optional="1">
                    <const>2</const>
                    <useparam name="abon_type" />
                  </call>
                </call>
                <const>'По физическим и юридическим лицам - '</const>
              </call>
              <call function="when">
                <call function="or">
                  <call function="false" />
                  <call function="in" optional="1">
                    <const>1</const>
                    <useparam name="abon_type" />
                  </call>
                </call>
                <const>'По физическим лицам - '</const>
              </call>
              <call function="when">
                <call function="or">
                  <call function="false" />
                  <call function="in" optional="1">
                    <const>2</const>
                    <useparam name="abon_type" />
                  </call>
                </call>
                <const>'По юридическим лицам - '</const>
              </call>
            </call>
            <call function="if">
              <call function="=">
                <call function="nvlu">
                  <useparam name="prizn_po" />
                  <const>0</const>
                </call>
                <const>1</const>
              </call>
              <const>'развёрнуто.'</const>
              <const>'одной строкой.'</const>
            </call>
          </call>
        </call>
        <call function="" as="text_pp" type="string" title="Вид итогов по отчётному периоду">
          <call function="||">
            <call function="case">
              <call function="when">
                <call function="and">
                  <call function="true" />
                  <call function="in" optional="1">
                    <const>1</const>
                    <useparam name="abon_type" />
                  </call>
                  <call function="in" optional="1">
                    <const>2</const>
                    <useparam name="abon_type" />
                  </call>
                </call>
                <const>'По физическим и юридическим лицам - '</const>
              </call>
              <call function="when">
                <call function="or">
                  <call function="false" />
                  <call function="in" optional="1">
                    <const>1</const>
                    <useparam name="abon_type" />
                  </call>
                </call>
                <const>'По физическим лицам - '</const>
              </call>
              <call function="when">
                <call function="or">
                  <call function="false" />
                  <call function="in" optional="1">
                    <const>2</const>
                    <useparam name="abon_type" />
                  </call>
                </call>
                <const>'По юридическим лицам - '</const>
              </call>
            </call>
            <const>'развёрнуто.'</const>
          </call>
        </call>
      </select>
      <from>
        <table name="dual" as="a" />
      </from>
    </query>
    <query name="26897-rep-fl">
      <params>
        <param name="abon_type" />
      </params>
      <select>
        <const as="kod_abon_type" type="number" key="1">1</const>
        <const as="kod" type="number">1</const>
      </select>
      <from>
        <table name="dual" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
        </call>
      </where>
    </query>
    <query name="26897-rep-ul">
      <params>
        <param name="abon_type" />
      </params>
      <select>
        <const as="kod_abon_type" type="number" key="1">2</const>
        <const as="kod" type="number">1</const>
      </select>
      <from>
        <table name="dual" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
        </call>
      </where>
    </query>
    <!--ПО на начало года-->
    <!--ФЛ. Детализация-->
    <query name="26897-mat-nyny-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="no" as="a">
          <withparams>
            <usepart part="26897-useparams-nyny" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <!--Строки с pr_use = 1 в детализации не нужны-->
          <call function="gt">
            <column table="a" column="kod_mat_pp" />
            <const>0</const>
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-mat-nyny-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-mat" as="a">
          <withparams>
            <usepart part="26897-useparams-nyny" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-isp-nyny-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-isp" as="a">
          <withparams>
            <usepart part="26897-useparams-nyny" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <!--ФЛ. Итог-->
    <query name="26897-mat-nyny-fl-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="1" as="a">
          <withparams>
            <usepart part="26897-useparams-nyny" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <!--ЮЛ. Детализация-->
    <query name="26897-mat-nyny-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="no" as="a">
          <withparams>
            <usepart part="26897-useparams-nyny" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <!--Строки с pr_use = 1 в детализации не нужны-->
          <call function="gt">
            <column table="a" column="kod_mat_pp" />
            <const>0</const>
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-mat-nyny-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-mat" as="a">
          <withparams>
            <usepart part="26897-useparams-nyny" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-isp-nyny-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-isp" as="a">
          <withparams>
            <usepart part="26897-useparams-nyny" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <!--ЮЛ. Итог-->
    <query name="26897-mat-nyny-ul-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="1" as="a">
          <withparams>
            <usepart part="26897-useparams-nyny" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <!--Итог-->
    <query name="26897-mat-nyny-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="0" as="a">
          <withparams>
            <usepart part="26897-useparams-nyny" />
          </withparams>
        </query>
      </from>
    </query>
    <!--Погашено ПО на начало года-->
    <!--ФЛ. Детализация-->
    <query name="26897-mat-nypp-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="no" as="a">
          <withparams>
            <usepart part="26897-useparams-nypp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <!--Строки с pr_use = 1 в детализации не нужны-->
          <call function="gt">
            <column table="a" column="kod_mat_pp" />
            <const>0</const>
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-mat-nypp-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-mat" as="a">
          <withparams>
            <usepart part="26897-useparams-nypp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-isp-nypp-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-isp" as="a">
          <withparams>
            <usepart part="26897-useparams-nypp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <!--ФЛ. Итог-->
    <query name="26897-mat-nypp-fl-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="1" as="a">
          <withparams>
            <usepart part="26897-useparams-nypp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <!--ЮЛ. Детализация-->
    <query name="26897-mat-nypp-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="no" as="a">
          <withparams>
            <usepart part="26897-useparams-nypp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <!--Строки с pr_use = 1 в детализации не нужны-->
          <call function="gt">
            <column table="a" column="kod_mat_pp" />
            <const>0</const>
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-mat-nypp-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-mat" as="a">
          <withparams>
            <usepart part="26897-useparams-nypp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-isp-nypp-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-isp" as="a">
          <withparams>
            <usepart part="26897-useparams-nypp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <!--ЮЛ. Итог-->
    <query name="26897-mat-nypp-ul-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="1" as="a">
          <withparams>
            <usepart part="26897-useparams-nypp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <!--Итог-->
    <query name="26897-mat-nypp-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="0" as="a">
          <withparams>
            <usepart part="26897-useparams-nypp" />
          </withparams>
        </query>
      </from>
    </query>
    <!--ПО после начала года-->
    <!--ФЛ. Детализация-->
    <query name="26897-mat-ypnp-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="no" as="a">
          <withparams>
            <usepart part="26897-useparams-ypnp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <!--Строки с pr_use = 1 в детализации не нужны-->
          <call function="gt">
            <column table="a" column="kod_mat_pp" />
            <const>0</const>
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-mat-ypnp-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-mat" as="a">
          <withparams>
            <usepart part="26897-useparams-ypnp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-isp-ypnp-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-isp" as="a">
          <withparams>
            <usepart part="26897-useparams-ypnp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <!--ФЛ. Итог-->
    <query name="26897-mat-ypnp-fl-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="1" as="a">
          <withparams>
            <usepart part="26897-useparams-ypnp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <!--ЮЛ. Детализация-->
    <query name="26897-mat-ypnp-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="no" as="a">
          <withparams>
            <usepart part="26897-useparams-ypnp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <!--Строки с pr_use = 1 в детализации не нужны-->
          <call function="gt">
            <column table="a" column="kod_mat_pp" />
            <const>0</const>
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-mat-ypnp-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-mat" as="a">
          <withparams>
            <usepart part="26897-useparams-ypnp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-isp-ypnp-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-isp" as="a">
          <withparams>
            <usepart part="26897-useparams-ypnp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <!--ЮЛ. Итог-->
    <query name="26897-mat-ypnp-ul-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="1" as="a">
          <withparams>
            <usepart part="26897-useparams-ypnp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <!--Итог-->
    <query name="26897-mat-ypnp-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="0" as="a">
          <withparams>
            <usepart part="26897-useparams-ypnp" />
          </withparams>
        </query>
      </from>
    </query>
    <!--Погашено ПО после начала года-->
    <!--ФЛ. Детализация-->
    <query name="26897-mat-yppp-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="no" as="a">
          <withparams>
            <usepart part="26897-useparams-yppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <!--Строки с pr_use = 1 в детализации не нужны-->
          <call function="gt">
            <column table="a" column="kod_mat_pp" />
            <const>0</const>
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-mat-yppp-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-mat" as="a">
          <withparams>
            <usepart part="26897-useparams-yppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-isp-yppp-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-isp" as="a">
          <withparams>
            <usepart part="26897-useparams-yppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <!--ФЛ. Итог-->
    <query name="26897-mat-yppp-fl-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="1" as="a">
          <withparams>
            <usepart part="26897-useparams-yppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <!--ЮЛ. Детализация-->
    <query name="26897-mat-yppp-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="no" as="a">
          <withparams>
            <usepart part="26897-useparams-yppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <!--Строки с pr_use = 1 в детализации не нужны-->
          <call function="gt">
            <column table="a" column="kod_mat_pp" />
            <const>0</const>
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-mat-yppp-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-mat" as="a">
          <withparams>
            <usepart part="26897-useparams-yppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-isp-yppp-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-isp" as="a">
          <withparams>
            <usepart part="26897-useparams-yppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <call function="nvlu">
              <useparam name="prizn_po" />
              <const>0</const>
            </call>
          </call>
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <!--ЮЛ. Итог-->
    <query name="26897-mat-yppp-ul-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="1" as="a">
          <withparams>
            <usepart part="26897-useparams-yppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <!--Итог-->
    <query name="26897-mat-yppp-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="0" as="a">
          <withparams>
            <usepart part="26897-useparams-yppp" />
          </withparams>
        </query>
      </from>
    </query>
    <!--Отчётный период-->
    <!--ФЛ. Детализация-->
    <query name="26897-mat-pppp-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="no" as="a">
          <withparams>
            <usepart part="26897-useparams-pppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <!--Строки с pr_use = 1 в детализации не нужны-->
          <call function="gt">
            <column table="a" column="kod_mat_pp" />
            <const>0</const>
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-mat-pppp-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-mat" as="a">
          <withparams>
            <usepart part="26897-useparams-pppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-isp-pppp-fl">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-isp" as="a">
          <withparams>
            <usepart part="26897-useparams-pppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <!--ФЛ. Итог-->
    <query name="26897-mat-pppp-fl-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="1" as="a">
          <withparams>
            <usepart part="26897-useparams-pppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>1</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
        </call>
      </where>
    </query>
    <!--ЮЛ. Детализация-->
    <query name="26897-mat-pppp-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="no" as="a">
          <withparams>
            <usepart part="26897-useparams-pppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <!--Строки с pr_use = 1 в детализации не нужны-->
          <call function="gt">
            <column table="a" column="kod_mat_pp" />
            <const>0</const>
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-mat-pppp-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-mat" as="a">
          <withparams>
            <usepart part="26897-useparams-pppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-isp-pppp-ul">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl-isp" as="a">
          <withparams>
            <usepart part="26897-useparams-pppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <!--ЮЛ. Итог-->
    <query name="26897-mat-pppp-ul-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="1" as="a">
          <withparams>
            <usepart part="26897-useparams-pppp" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in" optional="1">
            <const>2</const>
            <useparam name="abon_type" />
          </call>
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>2</const>
          </call>
        </call>
      </where>
    </query>
    <!--Итог-->
    <query name="26897-mat-pppp-itog">
      <params>
        <usepart part="26897-params1" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-mat" grouplevel="0" as="a">
          <withparams>
            <usepart part="26897-useparams-pppp" />
          </withparams>
        </query>
      </from>
    </query>
    <!--Иски-->
    <query name="26897-mat" grouplevel="no" order="dat_gp">
      <params>
        <usepart part="26897-params2" />
      </params>
      <select>
        <const as="kod" type="number" group="max">1</const>
        <column table="a" column="kod_abon_type" group="1" />
        <column table="a" column="kod_mat_pp" group="kod_abon_type" />
        <column table="a" column="dat_isk" group="kod_abon_type" />
        <column table="a" column="kod_dep" group="kod_abon_type" />
        <!--1.1-->
        <column table="a" column="dep_name" group="kod_abon_type" />
        <!--1.2 № п/п-->
        <!--1.3-->
        <column table="a" column="sud_region" group="kod_abon_type" />
        <!--1.4-->
        <column table="a" column="num_reg" group="kod_abon_type" />
        <!--2-->
        <call function="if" as="ndog_nump" type="string" group="kod_abon_type">
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
          <column table="a" column="nump" />
          <column table="a" column="ndog" />
        </call>
        <!--3-->
        <column table="a" column="abon_name" group="kod_abon_type" />
        <!--4-->
        <column table="a" column="abon_city" group="kod_abon_type" />
        <!--5-->
        <column table="a" column="abon_street" group="kod_abon_type" />
        <!--6-->
        <column table="a" column="abon_house" group="kod_abon_type" />
        <!--7-->
        <column table="a" column="abon_flat" group="kod_abon_type" />
        <!--8-->
        <call function="||" as="ym_s_po" title="Период взыскания" group="kod_abon_type">
          <call function="ym to char">
            <column table="a" column="ym_min" />
          </call>
          <const>'-'</const>
          <call function="ym to char">
            <column table="a" column="ym_max" />
          </call>
        </call>
        <!--9-->
        <column table="a" column="inst_name" group="kod_abon_type" />
        <!--10-->
        <column table="a" column="num_delo" group="kod_abon_type" />
        <!--11-->
        <column table="a" column="sum_gp" group="sum" />
        <!--12-->
        <column table="a" column="num_pp_gp" group="kod_abon_type" />
        <!--13 -->
        <column table="a" column="dat_gp" group="kod_abon_type" />
        <!--14-->
        <column table="a" column="sum_zach_gp" group="sum" />
        <!--15 -->
        <column table="a" column="num_zach_doc" group="kod_abon_type" />
        <!--16-->
        <column table="a" column="dat_zach" group="kod_abon_type" />
        <!--17-->
        <column table="a" column="opl_mat" group="sum" />
        <!--18 Дата оплаты до вступления акта в законную силу-->
        <!--19-->
        <column table="a" column="otkaz_gp" group="sum" />
        <!--20-->
        <column table="a" column="gp_otv" group="sum" />
        <!--21-->
        <column table="a" column="vozvrat_gp" group="sum" />
        <!--22-->
        <column table="a" column="opl_isp" group="sum" />
        <!--23 № документа оплаты по исп. листу-->
        <!--24 Дата оплаты по исп. листу-->
        <!--25-->
        <column table="a" column="sum_ifns_gp" group="sum" />
        <!--26 -->
        <column table="a" column="num_ifns_doc" group="kod_abon_type" />
        <!--27-->
        <column table="a" column="dat_ifns" group="kod_abon_type" />
        <!--28-->
        <column table="a" column="num_otz" group="kod_abon_type" />
        <!--29-->
        <column table="a" column="dat_otz" group="kod_abon_type" />
        <!--30-->
        <call function="-" as="itog" title="Итого не погашено" group="sum">
          <column table="a" column="sum_gp" />
          <call function="+nvl">
            <column table="a" column="opl_before" />
            <column table="a" column="opl_mat" />
            <column table="a" column="opl_isp" />
            <column table="a" column="sum_ifns_gp" />
          </call>
        </call>
      </select>
      <from>
        <query name="26897-data2" grouplevel="1" as="a">
          <withparams>
            <usepart part="26897-useparams2" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="or">
          <call function="and">
            <call function="in" optional="1">
              <column table="a" column="kod_abon_type" />
              <useparam name="abon_type" />
            </call>
            <call function="=">
              <column table="a" column="pr_use" />
              <const>1</const>
            </call>
          </call>
          <call function="and">
            <!--есть задолженность на начало года (для каждой строчки собирается через over())-->
            <call function="gt">
              <column table="a" column="ost_border" />
              <const>0</const>
            </call>
            <!--дата гп или дата иска попадают в диапазон-->
            <call function="and">
              <call function="ge">
                <call function="coalesce">
                  <column table="a" column="dat_gp" group="max" />
                  <column table="a" column="dat_isk" group="max" />
                  <!--всегда ложно-->
                  <const>null</const>
                </call>
                <useparam name="dat_begin_gp" />
              </call>
              <call function="lt" optional="1">
                <call function="coalesce">
                  <column table="a" column="dat_gp" group="max" />
                  <column table="a" column="dat_isk" group="max" />
                  <!--всегда ложно-->
                  <const>null</const>
                </call>
                <useparam name="dat_end_gp" />
              </call>
            </call>
          </call>
        </call>
      </where>
    </query>
    <!--Оплаты-->
    <query name="26897-opl">
      <params>
        <usepart part="26897-params2" />
        <param name="pr_opl" />
      </params>
      <select>
        <column table="a" column="kod_mat_pp" />
        <column table="a" column="kod_opl" />
        <column table="a" column="kod_dep" />
        <column table="a" column="kod_abon_type" />
        <column table="a" column="dep_name" />
        <column table="a" column="nump" />
        <column table="a" column="num_reg" />
        <column table="a" column="num_opl" />
        <column table="a" column="dat_opl" />
        <column table="a" column="opl" />
        <column table="a" column="opl_before" />
        <column table="a" column="opl_mat" />
        <column table="a" column="opl_isp" />
        <column table="a" column="opl_after" />
      </select>
      <from>
        <query name="26897-data2" grouplevel="2" as="a">
          <withparams>
            <usepart part="26897-useparams2" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="=">
            <column table="a" column="pr_opl" />
            <useparam name="pr_opl" />
          </call>
        </call>
      </where>
    </query>
    <query name="26897-opl-mat" order="dat_opl">
      <params>
        <usepart part="26897-params2" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl" as="a">
          <withparams>
            <usepart part="26897-useparams2" />
            <const>1</const>
          </withparams>
        </query>
      </from>
    </query>
    <query name="26897-opl-isp" order="dat_opl">
      <params>
        <usepart part="26897-params2" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-opl" as="a">
          <withparams>
            <usepart part="26897-useparams2" />
            <const>2</const>
          </withparams>
        </query>
      </from>
    </query>
    <!--Данные-->
    <query name="26897-data2" grouplevel="no">
      <params>
        <usepart part="26897-params2" />
      </params>
      <select>
        <column table="a" column="kod_mat_pp" group="1" />
        <column table="a" column="kod_opl" group="2" />
        <column table="a" column="kod_abon_type" group="kod_mat_pp" />
        <column table="a" column="kod_dep" group="kod_mat_pp" />
        <column table="a" column="abon_type_name" group="kod_mat_pp" />
        <column table="a" column="nump" group="kod_mat_pp" />
        <column table="a" column="opl" group="sum" />
        <column table="a" column="dat_opl" group="kod_opl" />
        <column table="a" column="num_opl" group="kod_opl" />
        <column table="a" column="dep_name" group="kod_mat_pp" />
        <column table="a" column="sud_region" group="kod_mat_pp" />
        <column table="a" column="num_reg" group="kod_mat_pp" />
        <column table="a" column="ndog" group="kod_mat_pp" />
        <column table="a" column="abon_name" group="kod_mat_pp" />
        <column table="a" column="abon_city" group="kod_mat_pp" />
        <column table="a" column="abon_street" group="kod_mat_pp" />
        <column table="a" column="abon_house" group="kod_mat_pp" />
        <column table="a" column="abon_flat" group="kod_mat_pp" />
        <column table="a" column="ym_max" group="kod_mat_pp" />
        <column table="a" column="ym_min" group="kod_mat_pp" />
        <column table="a" column="inst_name" group="kod_mat_pp" />
        <column table="a" column="num_delo" group="kod_mat_pp" />
        <column table="a" column="sum_gp" group="sum" />
        <column table="a" column="num_pp_gp" group="kod_mat_pp" />
        <column table="a" column="dat_gp" group="kod_mat_pp" />
        <column table="a" column="sum_zach_gp" group="sum" />
        <column table="a" column="num_zach_doc" group="kod_mat_pp" />
        <column table="a" column="dat_zach" group="kod_mat_pp" />
        <column table="a" column="otkaz_gp" group="sum" />
        <column table="a" column="gp_otv" group="sum" />
        <column table="a" column="vozvrat_gp" group="sum" />
        <column table="a" column="sum_ifns_gp" group="sum" />
        <column table="a" column="num_ifns_doc" group="kod_mat_pp" />
        <column table="a" column="dat_ifns" group="kod_mat_pp" />
        <column table="a" column="num_otz" group="kod_mat_pp" />
        <column table="a" column="dat_otz" group="kod_mat_pp" />
        <column table="a" column="dat_isp" group="kod_mat_pp" />
        <column table="a" column="dat_isk" group="kod_mat_pp" />
        <column table="a" column="pr_use" group="max" />
        <call function="if" as="opl_before" type="number" group="sum">
          <call function="lt">
            <column table="a" column="dat_opl" />
            <useparam name="dat_begin_opl" />
          </call>
          <column table="a" column="opl" />
          <const>0</const>
        </call>
        <call function="if" as="opl_mat" title="Сумма оплаты до вступления акта в законную силу" type="number" group="sum">
          <call function="and">
            <call function="ge">
              <column table="a" column="dat_opl" />
              <useparam name="dat_begin_opl" />
            </call>
            <call function="lt">
              <column table="a" column="dat_opl" />
              <useparam name="dat_end_opl" />
            </call>
            <call function="lt">
              <column table="a" column="dat_opl" />
              <call function="nvl">
                <column table="a" column="dat_isp" />
                <const>sysdate</const>
              </call>
            </call>
          </call>
          <column table="a" column="opl" />
          <const>0</const>
        </call>
        <call function="if" as="opl_isp" title="Сумма оплаты по исп. листу" type="number" group="sum">
          <call function="and">
            <call function="ge">
              <column table="a" column="dat_opl" />
              <useparam name="dat_begin_opl" />
            </call>
            <call function="lt">
              <column table="a" column="dat_opl" />
              <useparam name="dat_end_opl" />
            </call>
            <call function="ge">
              <column table="a" column="dat_opl" />
              <call function="nvl">
                <column table="a" column="dat_isp" />
                <const>sysdate</const>
              </call>
            </call>
          </call>
          <column table="a" column="opl" />
          <const>0</const>
        </call>
        <call function="if" as="opl_after" type="number" group="sum">
          <call function="ge">
            <column table="a" column="dat_opl" />
            <useparam name="dat_end_opl" />
          </call>
          <column table="a" column="opl" />
          <const>0</const>
        </call>
        <call function="-" as="ost_border" title="Задолженность на начало года" group="kod_mat_pp">
          <!--Сумма ГП по иску-->
          <call function="over">
            <call function="sum">
              <call function="nvl0">
                <column table="a" column="sum_gp" />
              </call>
            </call>
            <call function="partition by">
              <column table="a" column="kod_mat_pp" />
            </call>
          </call>
          <!--Оплата по иску-->
          <call function="over">
            <call function="sum">
              <call function="if">
                <call function="lt">
                  <call function="nvl">
                    <column table="a" column="dat_opl" />
                    <call function="doomsday" />
                  </call>
                  <useparam name="dat_border" />
                </call>
                <call function="nvl0">
                  <column table="a" column="opl" />
                </call>
                <const>0</const>
              </call>
            </call>
            <call function="partition by">
              <column table="a" column="kod_mat_pp" />
            </call>
          </call>
          <!--Сумма ИФНС по иску-->
          <call function="over">
            <call function="sum">
              <call function="if">
                <call function="lt">
                  <call function="nvl">
                    <column table="a" column="dat_ifns" />
                    <call function="doomsday" />
                  </call>
                  <useparam name="dat_border" />
                </call>
                <call function="nvl0">
                  <column table="a" column="sum_ifns_gp" />
                </call>
                <const>0</const>
              </call>
            </call>
            <call function="partition by">
              <column table="a" column="kod_mat_pp" />
            </call>
          </call>
        </call>
        <call function="case" as="pr_opl" type="number" group="kod_opl">
          <call function="when">
            <call function="!=nvl">
              <column table="this" column="opl_before" />
              <const>0</const>
            </call>
            <const>0</const>
          </call>
          <call function="when">
            <call function="!=nvl">
              <column table="this" column="opl_mat" />
              <const>0</const>
            </call>
            <const>1</const>
          </call>
          <call function="when">
            <call function="!=nvl">
              <column table="this" column="opl_isp" />
              <const>0</const>
            </call>
            <const>2</const>
          </call>
          <call function="when">
            <call function="!=nvl">
              <column table="this" column="opl_after" />
              <const>0</const>
            </call>
            <const>3</const>
          </call>
          <call function="else">
            <const>-1</const>
          </call>
        </call>
      </select>
      <from>
        <query name="26897-data" as="a">
          <withparams>
            <useparam name="dep" />
            <useparam name="abon_type" />
          </withparams>
        </query>
      </from>
    </query>
    <!--<query name="26897-data">-->
    <query name="26897-data" materialize="1">
      <params>
        <param name="dep"></param>
        <param name="abon_type"></param>
      </params>
      <select>
        <column table="a" column="kod_abon_type" />
        <column table="a" column="kod_mat_pp" />
        <column table="a" column="kod_opl" />
        <column table="a" column="kod_dep" />
        <column table="a" column="abon_type_name" />
        <column table="a" column="nump" title="Код абонента" />
        <column table="a" column="opl" title="Оплата" />
        <column table="a" column="dat_opl" title="Дата оплаты" />
        <column table="a" column="num_opl" title="№ документа оплаты" />
        <column table="a" column="dep_name" title="АУП/Отделение/РКЦ" />
        <column table="a" column="sud_region" title="адм. Р-н/ГО" />
        <column table="a" column="num_reg" title="№ иска" />
        <column table="a" column="ndog" title="Лицевой счет/номер договора" />
        <column table="a" column="abon_name" title="Ф.И.О./наименование ю/л" />
        <call function="if" as="abon_city" type="string" title="Населенный пункт">
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
          <column table="a" column="abon_city" />
          <column table="a" column="abon_city_ur" />
        </call>
        <call function="if" as="abon_street" type="string" title="Улица">
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
          <column table="a" column="abon_street" />
          <column table="a" column="abon_street_ur" />
        </call>
        <call function="if" as="abon_house" type="string" title="№ дома">
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
          <column table="a" column="abon_house" />
          <column table="a" column="abon_house_ur" />
        </call>
        <call function="if" as="abon_flat" type="string" title="Квартира">
          <call function="=">
            <column table="a" column="kod_abon_type" />
            <const>1</const>
          </call>
          <column table="a" column="abon_flat" />
          <column table="a" column="abon_flat_ur" />
        </call>
        <column table="a" column="ym_max" />
        <column table="a" column="ym_min" />
        <column table="a" column="inst_name" title="Судебная инстанция" />
        <column table="a" column="num_delo" title="№ Дела" />
        <column table="a" column="sum_gp" title="Сумма, руб. Оплачено госпошлины при подаче иска" />
        <column table="a" column="num_pp_gp" title="№ платежного поручения. Оплачено госпошлины при подаче иска" />
        <column table="a" column="dat_gp" title="Дата платежного поручения. Оплачено госпошлины при подаче иска" />
        <column table="a" column="sum_zach_gp" title="Сумма, руб. Зачтено госпошлины при подаче иска" />
        <column table="a" column="num_zach_doc" title="№ определения суда/решения налогового органа о зачете. Зачтено госпошлины при подаче иска" />
        <column table="a" column="dat_zach" title="Дата определения суда/решения налогового органа о зачете. Зачтено госпошлины при подаче иска" />
        <column table="a" column="otkaz_gp" title="Отказано ГП. Результат по делу" />
        <column table="a" column="gp_otv" title="Взыскано ГП. Результат по делу" />
        <column table="a" column="vozvrat_gp" title="Подлежит возврату из бюджета ГП. Результат по делу" />
        <column table="a" column="sum_ifns_gp" title="Сумма, руб. Погашено ИФНС госпошлины при подаче иска" />
        <column table="a" column="num_ifns_doc" title="№ извещения ИФНС. Погашено ИФНС госпошлины при подаче иска" />
        <column table="a" column="dat_ifns" title="Дата извещения ИФНС. Погашено ИФНС госпошлины при подаче иска" />
        <column table="a" column="num_otz" title="№ документа. Наличие основания о невозможности взыскания" />
        <column table="a" column="dat_otz" title="Дата. Наличие основания о невозможности взыскания" />
        <column table="a" column="dat_isp" />
        <column table="a" column="dat_isk" />
        <column table="a" column="pr_use" />
      </select>
      <from>
        <query name="26897-un-all" as="a">
          <!--<extendwhere>
            <call function="=">
              <column table="*" column="kod_mat_pp"/>
              <const>1000000446</const>
            </call>
          </extendwhere>-->
        </query>
      </from>
      <where>
        <call function="or">
          <call function="and">
            <call function="true" />
            <!--Отделения-->
            <call function="in" optional="1">
              <column table="a" column="kod_dep" />
              <useparam name="dep" />
            </call>
            <!--Физ/Юр-->
            <call function="in" optional="1">
              <column table="a" column="kod_abon_type" />
              <useparam name="abon_type" />
            </call>
          </call>
          <call function="and">
            <call function="in" optional="1">
              <column table="a" column="kod_abon_type" />
              <useparam name="abon_type" />
            </call>
            <!--Физ/Юр-->
            <call function="=">
              <column table="a" column="pr_use" />
              <const>1</const>
            </call>
          </call>
        </call>
      </where>
    </query>
    <!--Общий запрос-->
    <query name="26897-un-all" cstyle="union">
      <select>
        <column table="*" column="kod_abon_type" group="1" />
        <column table="*" column="kod_mat_pp" group="1" />
        <column table="*" column="kod_opl" group="1" />
        <column table="abt" column="pr_use" group="kod_abon_type" />
        <column table="kod_abon_type" column="abon_type_name" group="kod_abon_type" />
        <!--Иск-->
        <column table="ur_mat" column="num_reg" group="kod_mat_pp" />
        <column table="ur_mat" column="num_delo" group="kod_mat_pp" />
        <column table="ur_mat" column="dat_doc" as="dat_isk" group="kod_mat_pp" />
        <column table="mat" column="sum_gp" group="sumnvl" />
        <column table="ur_mat" column="num_pp_gp" group="kod_mat_pp" />
        <column table="ur_mat" column="dat_gp" group="kod_mat_pp" />
        <column table="mat" column="sum_zach_gp" group="sumnvl" />
        <column table="ur_mat" column="num_zach_doc" group="kod_mat_pp" />
        <column table="ur_mat" column="dat_zach" group="kod_mat_pp" />
        <column table="mat" column="sum_ifns_gp" group="sumnvl" />
        <column table="ur_mat" column="num_ifns_doc" group="kod_mat_pp" />
        <column table="ur_mat" column="dat_ifns" group="kod_mat_pp" />
        <column table="ur_mat" column="num_otz" group="kod_mat_pp" />
        <column table="ur_mat" column="dat_otz" group="kod_mat_pp" />
        <column table="kod_sud" column="region" as="sud_region" group="kod_mat_pp" />
        <column table="kod_doc" column="inst_name" group="kod_mat_pp" />
        <column table="kod_hist_mat_last" column="dat_post" group="kod_mat_pp" />
        <column table="kod_result_last" column="name" as="result_name" group="kod_mat_pp" />
        <!--Абонент-->
        <column table="kodp" column="kodp" group="kod_mat_pp" />
        <column table="kodp" column="nump" group="kod_mat_pp" />
        <column table="kodp" column="name" as="abon_name" group="kod_mat_pp" />
        <column table="kod_m" column="name_p" as="abon_city" group="kod_mat_pp" />
        <column table="kod_s" column="name" as="abon_street" group="kod_mat_pp" />
        <column table="kod_d" column="house_name" as="abon_house" group="kod_mat_pp" />
        <column table="kod_d" column="flat_name" as="abon_flat" group="kod_mat_pp" />
        <column table="kod_m_ur" column="name_p" as="abon_city_ur" group="kod_mat_pp" />
        <column table="kod_s_ur" column="name" as="abon_street_ur" group="kod_mat_pp" />
        <column table="kod_d_ur" column="house_name" as="abon_house_ur" group="kod_mat_pp" />
        <column table="kod_d_ur" column="flat_name" as="abon_flat_ur" group="kod_mat_pp" />
        <column table="kodp" column="dep" group="kod_mat_pp" />
        <column table="dep" column="kodp" as="kod_dep" group="kod_mat_pp" />
        <column table="dep" column="name" as="dep_name" group="kod_mat_pp" />
        <!--Договор-->
        <call function="coalesce" as="kod_dog" type="number">
          <column table="this" column="kod_dog_fl" />
          <column table="this" column="kod_dog_ul_sf" />
          <column table="this" column="kod_dog_ul_deb" />
        </call>
        <call function="coalesce" as="ndog" type="string">
          <column table="this" column="ndog_fl" />
          <column table="this" column="ndog_ul_sf" />
          <column table="this" column="ndog_ul_deb" />
        </call>
        <column table="nach_ul_sf" column="kod_dog" group="max" as="kod_dog_ul_sf" />
        <column table="nach_ul_deb" column="kod_dog" group="max" as="kod_dog_ul_deb" />
        <column table="nach_fl" column="kod_dog" group="max" as="kod_dog_fl" />
        <column table="nach_ul_sf" column="ndog" group="max" as="ndog_ul_sf" />
        <column table="nach_ul_deb" column="ndog" group="max" as="ndog_ul_deb" />
        <column table="nach_fl" column="ndog" group="max" as="ndog_fl" />
        <!--Папка-->
        <column table="kod_folders" column="kod_folders" group="kod_mat_pp" />
        <!--Решение-->
        <column table="hist_mat" column="gp_otv" group="sumnvl" />
        <column table="hist_mat" column="gp_es" as="otkaz_gp" group="sumnvl" />
        <column table="hist_mat" column="gp_ret" as="vozvrat_gp" group="sumnvl" />
        <!--Исполнительный лист-->
        <column table="kod_isp" column="dat_doc" as="dat_isp" dgroup="max" group="kod_mat_pp" />
        <!--<call function="+nvl" as="nachisl_osn">
          <column table="this" column="nachisl_osn_ul"/>
          <column table="this" column="nachisl_osn_fl"/>
        </call>
        <call function="+nvl" as="nachisl_gp">
          <column table="this" column="nachisl_gp_ul"/>
          <column table="this" column="nachisl_gp_fl"/>
        </call>

        <column table="nach_ul" column="nachisl_osn" group="sum" as="nachisl_osn_ul"/>
        <column table="nach_fl" column="nachisl_osn" group="sum" as="nachisl_osn_fl"/>
        <column table="nach_ul" column="nachisl_gp" group="sum" as="nachisl_gp_ul"/>
        <column table="nach_fl" column="nachisl_gp" group="sum" as="nachisl_gp_fl"/>-->
        <!--Период-->
        <column table="nach_ul_sf" column="ym" group="max" as="ym_ul_sf_max" />
        <column table="nach_ul_deb" column="ym" group="max" as="ym_ul_deb_max" />
        <column table="nach_fl" column="ym" group="max" as="ym_fl_max" />
        <column table="nach_ul_sf" column="ym" group="min" as="ym_ul_sf_min" />
        <column table="nach_ul_deb" column="ym" group="min" as="ym_ul_deb_min" />
        <column table="nach_fl" column="ym" group="min" as="ym_fl_min" />
        <call function="coalesce" as="ym_min">
          <column table="this" column="ym_fl_min" />
          <column table="this" column="ym_ul_sf_min" />
          <column table="this" column="ym_ul_deb_min" />
        </call>
        <call function="coalesce" as="ym_max">
          <column table="this" column="ym_fl_max" />
          <column table="this" column="ym_ul_sf_max" />
          <column table="this" column="ym_ul_deb_max" />
        </call>
        <!--Оплаты-->
        <call function="+nvl" as="opl">
          <column table="this" column="opl_fl" />
          <column table="this" column="opl_ul_sf" />
          <column table="this" column="opl_ul_deb" />
          <column table="this" column="oplmat_ul" />
          <column table="this" column="oplmat_fl" />
        </call>
        <call function="coalesce" as="dat_opl">
          <column table="this" column="dat_opl_fl" />
          <column table="this" column="dat_opl_ul_sf" />
          <column table="this" column="dat_opl_ul_deb" />
          <column table="this" column="dat_oplmat_ul" />
          <column table="this" column="dat_oplmat_fl" />
        </call>
        <call function="coalesce" as="num_opl">
          <column table="this" column="num_opl_fl" />
          <column table="this" column="num_opl_ul_sf" />
          <column table="this" column="num_opl_ul_deb" />
          <column table="this" column="num_oplmat_ul" />
          <column table="this" column="num_oplmat_fl" />
        </call>
        <column table="opl_fl" column="opl" group="sum" as="opl_fl" />
        <column table="opl_ul_sf" column="opl" group="sum" as="opl_ul_sf" />
        <column table="opl_ul_deb" column="opl" group="sum" as="opl_ul_deb" />
        <column table="opl_fl" column="dat_opl" group="max" as="dat_opl_fl" />
        <column table="opl_ul_sf" column="dat_opl" group="max" as="dat_opl_ul_sf" />
        <column table="opl_ul_deb" column="dat_opl" group="max" as="dat_opl_ul_deb" />
        <column table="opl_fl" column="num_opl" group="max" as="num_opl_fl" />
        <column table="opl_ul_sf" column="num_opl" group="max" as="num_opl_ul_sf" />
        <column table="opl_ul_deb" column="num_opl" group="max" as="num_opl_ul_deb" />
        <!--Переплаты по ГП на иске(без извещения/счета)-->
        <column table="oplmat_ul" column="opl" group="sum" as="oplmat_ul" />
        <column table="oplmat_fl" column="opl" group="sum" as="oplmat_fl" />
        <column table="oplmat_ul" column="dat_opl" group="max" as="dat_oplmat_ul" />
        <column table="oplmat_fl" column="dat_opl" group="max" as="dat_oplmat_fl" />
        <column table="oplmat_ul" column="num_opl" group="max" as="num_oplmat_ul" />
        <column table="oplmat_fl" column="num_opl" group="max" as="num_oplmat_fl" />
        <!--<call function="if" as="pr_first_opl" type="number">
          <call function="=">
            <column table="this" column="kod_opl"/>
            <call function="over" as="kod_opl_first">
              <call function="first_value">
                <column table="this" column="kod_opl"/>
              </call>
              <call function="partition by">
                <column table="this" column="kod_mat_pp"/>
              </call>
              <call function="order by rows * *">
                <column table="this" column="dat_opl"/>
              </call>
            </call>
          </call>
          <const>1</const>
          <const>0</const>
        </call>-->
      </select>
      <from>
        <query name="un-abon-type" as="abt" />
        <query name="un-mat" as="mat" />
        <query name="un-hist-mat" as="hist_mat" />
        <query name="un-nach-sf" as="nach_ul_sf" />
        <query name="un-nach-deb" as="nach_ul_deb" />
        <query name="un-nach-izv" as="nach_fl" />
        <query name="un-opl-gp-sf" as="opl_ul_sf" />
        <query name="un-opl-gp-deb" as="opl_ul_deb" />
        <query name="un-opl-gp-fl" as="opl_fl" />
        <query name="un-oplmat-gp-sf" as="oplmat_ul" />
        <query name="un-oplmat-gp-izv" as="oplmat_fl" />
      </from>
      <push>
        <from>
          <query name="ur_mat" join="left outer">
            <call function="=">
              <column table="ur_mat" column="kod_mat" />
              <column table="*" column="kod_mat_pp" />
            </call>
            <link name="kod_folders">
              <link name="kodp">
                <link name="kod_d">
                  <link name="kod_s">
                    <link name="kod_m" />
                  </link>
                </link>
                <link name="kod_d_ur">
                  <link name="kod_s" as="kod_s_ur">
                    <link name="kod_m" as="kod_m_ur" />
                  </link>
                </link>
                <link name="dep" />
              </link>
            </link>
            <link name="kod_hist_mat_last">
              <link name="kod_result" as="kod_result_last" />
            </link>
            <link name="kod_sud" />
            <link name="kod_doc" />
            <link name="kod_hist_mat_last">
              <dlink name="ur_isp" as="kod_isp" />
            </link>
          </query>
          <query name="kr_payer_abon_type" as="kod_abon_type" join="left outer">
            <using>
              <column column="kod_abon_type" />
            </using>
          </query>
        </from>
        <where>
          <!--<call function="=">
            <column table="ur_mat" column="kod_mat"/>
            <const>1000000446</const>
          </call>-->
          <call function="=">
            <!--Сделал так, чтобы строки с pr_use=1 попадали-->
            <call function="nvl">
              <column table="kod_folders" column="kod_sdp" />
              <const>1</const>
            </call>
            <const>1</const>
          </call>
        </where>
      </push>
    </query>
    <!--Пока пусть будет тута-->
    <query name="un-abon-type">
      <select>
        <column table="a" column="kod_abon_type" />
        <const as="kod_opl" type="number">null</const>
        <call function="0-" as="kod_mat_pp" type="number">
          <column table="a" column="kod_abon_type" />
        </call>
        <const as="pr_use" type="number">1</const>
        <column table="a" column="abon_type_name" />
      </select>
      <from>
        <query name="kr_payer_abon_type" as="a" />
      </from>
    </query>
    <query name="un-mat">
      <select>
        <column table="a" column="kod_mat" as="kod_mat_pp" />
        <const as="kod_opl" type="number">null</const>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="a" column="num_reg" />
        <column table="a" column="num_delo" />
        <column table="a" column="sum_gp" />
        <column table="a" column="num_pp_gp" />
        <column table="a" column="dat_gp" />
        <column table="a" column="sum_zach_gp" />
        <column table="a" column="num_zach_doc" />
        <column table="a" column="dat_zach" />
        <column table="a" column="sum_ifns_gp" />
        <column table="a" column="num_ifns_doc" />
        <column table="a" column="dat_ifns" />
        <column table="a" column="num_otz" />
        <column table="a" column="dat_otz" />
      </select>
      <from>
        <query name="ur_mat" as="a">
          <link name="kod_folders" />
        </query>
      </from>
    </query>
    <query name="un-hist-mat">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="a" column="kod_mat" as="kod_mat_pp" />
        <const as="kod_opl" type="number">null</const>
        <column table="a" column="gp_otv" />
        <column table="a" column="gp_es" />
        <column table="a" column="gp_ret" />
      </select>
      <from>
        <query name="ur_hist_mat" as="a">
          <link name="kod_result" />
          <link name="kod_mat" as="kod_mat_pp">
            <link name="kod_folders" />
          </link>
        </query>
      </from>
      <where>
        <call function="=">
          <column table="kod_result" column="decision" />
          <const>1</const>
        </call>
      </where>
    </query>
    <query name="un-nach-sf">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="kod_mat_pp" column="kod_mat" as="kod_mat_pp" />
        <column table="a" column="kod_sf" />
        <const as="kod_opl" type="number">null</const>
        <column table="kod_sf" column="num_sf" />
        <column table="kod_sf" column="ym" />
        <column table="kod_dog" column="kod_dog" />
        <column table="kod_dog" column="ndog" />
        <column table="a" column="nachisl" />
        <call function="if" as="nachisl_osn" nvl="0">
          <call function="=">
            <column table="kod_sf" column="vid_real" />
            <const>2</const>
          </call>
          <column table="a" column="nachisl" />
        </call>
        <call function="if" as="nachisl_gp" nvl="0">
          <call function="=">
            <column table="kod_sf" column="vid_real" />
            <const>9</const>
          </call>
          <column table="a" column="nachisl" />
        </call>
      </select>
      <from>
        <query name="sr_facras" as="a">
          <link name="kod_sf">
            <link name="kod_dog" />
            <elink name="ur_dogplat">
              <link name="kod_mat_pp">
                <link name="kod_folders" />
              </link>
            </elink>
          </link>
        </query>
      </from>
      <where>
        <call function="is not null">
          <column table="kod_mat_pp" column="kod_mat" />
        </call>
      </where>
    </query>
    <query name="un-nach-deb">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="kod_mat_pp" column="kod_mat" as="kod_mat_pp" />
        <column table="a" column="kod_sf" />
        <const as="kod_opl" type="number">null</const>
        <column table="kod_sf" column="num_sf" />
        <column table="kod_sf" column="ym" />
        <column table="kod_dog" column="kod_dog" />
        <column table="kod_dog" column="ndog" />
        <column table="a" column="nachisl" />
        <call function="if" as="nachisl_osn" nvl="0">
          <call function="=">
            <column table="kod_sf" column="vid_real" />
            <const>2</const>
          </call>
          <column table="a" column="nachisl" />
        </call>
        <call function="if" as="nachisl_gp" nvl="0">
          <call function="=">
            <column table="kod_sf" column="vid_real" />
            <const>9</const>
          </call>
          <column table="a" column="nachisl" />
        </call>
      </select>
      <from>
        <query name="sr_facras" as="a">
          <link name="kod_sf">
            <link name="kod_dog" />
            <link name="kod_deb">
              <elink name="ur_dogplat">
                <link name="kod_mat_pp">
                  <link name="kod_folders" />
                </link>
              </elink>
            </link>
          </link>
        </query>
      </from>
      <where>
        <call function="is not null">
          <column table="kod_mat_pp" column="kod_mat" />
        </call>
      </where>
    </query>
    <query name="un-nach-izv">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="kod_mat_pp" column="kod_mat" as="kod_mat_pp" />
        <const as="kod_opl" type="number">null</const>
        <column table="kod_izv" column="ym" />
        <column table="kod_dog" column="kod_dog" />
        <column table="kod_dog" column="ndog" />
        <call function="if" as="nachisl_osn" nvl="0">
          <call function="=">
            <column table="vid_t" column="vid_real" />
            <const>2</const>
          </call>
          <column table="a" column="nachisl" />
        </call>
        <call function="if" as="nachisl_gp" nvl="0">
          <call function="=">
            <column table="vid_t" column="vid_real" />
            <const>9</const>
          </call>
          <column table="a" column="nachisl" />
        </call>
      </select>
      <from>
        <query name="tnr_account" as="a">
          <link name="vid_t" />
          <link name="kod_izv">
            <link name="kod_dog" />
            <elink name="ur_dogplat">
              <link name="kod_mat_pp">
                <link name="kod_folders" />
              </link>
            </elink>
          </link>
        </query>
      </from>
      <where>
        <call function="is not null">
          <column table="kod_mat_pp" column="kod_mat" />
        </call>
      </where>
    </query>
    <query name="un-prizn-sf">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="kod_mat_pp" column="kod_mat" as="kod_mat_pp" />
        <column table="a" column="kod_sf" />
        <column table="kod_sf" column="num_sf" />
        <column table="kod_sf" column="ym" />
        <column table="a" column="summa" as="vist" />
        <call function="nvl" as="prizn">
          <column table="a" column="sum_v" />
          <column table="a" column="summa" />
        </call>
      </select>
      <from>
        <query name="ur_dogplat" as="a">
          <link name="kod_mat_pp">
            <link name="kod_folders" />
          </link>
          <link name="kod_sf" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="is not null">
            <column table="a" column="kod_sf" />
          </call>
          <call function="!=">
            <column table="a" column="vid_real" />
            <const>9</const>
          </call>
        </call>
      </where>
    </query>
    <query name="un-prizn-deb">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="kod_mat_pp" column="kod_mat" as="kod_mat_pp" />
        <column table="kod_sf" column="kod_sf" />
        <const as="kod_opl" type="number">null</const>
        <column table="kod_sf" column="num_sf" />
        <column table="kod_sf" column="ym" />
        <column table="a" column="summa" as="vist" />
        <call function="nvl" as="prizn">
          <column table="a" column="sum_v" />
          <column table="a" column="summa" />
        </call>
      </select>
      <from>
        <query name="ur_dogplat" as="a">
          <link name="kod_mat_pp">
            <link name="kod_folders" />
          </link>
          <link name="kod_deb">
            <elink name="sr_facvip" as="kod_sf" />
          </link>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="is not null">
            <column table="a" column="kod_deb" />
          </call>
          <call function="!=">
            <column table="a" column="vid_real" />
            <const>9</const>
          </call>
        </call>
      </where>
    </query>
    <query name="un-opl-sf">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="kod_mat_pp" column="kod_mat" as="kod_mat_pp" />
        <column table="kod_sf" column="kod_sf" />
        <column table="a" column="kod_opl" />
        <column table="a" column="opl" />
        <column table="a" column="dat_opl" />
        <column table="a" column="num_opl" />
        <column table="a" column="kod_vidopl" />
      </select>
      <from>
        <query name="sr_opl" as="a">
          <link name="kod_sf">
            <elink name="ur_dogplat">
              <link name="kod_mat_pp">
                <link name="kod_folders" />
              </link>
            </elink>
          </link>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="!=">
            <column table="kod_sf" column="vid_real" />
            <const>9</const>
          </call>
          <call function="is not null">
            <column table="kod_mat_pp" column="kod_mat" />
          </call>
        </call>
      </where>
    </query>
    <query name="un-opl-deb">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="kod_mat_pp" column="kod_mat" as="kod_mat_pp" />
        <column table="kod_sf" column="kod_sf" />
        <column table="a" column="kod_opl" />
        <column table="a" column="opl" />
        <column table="a" column="dat_opl" />
        <column table="a" column="num_opl" />
        <column table="a" column="kod_vidopl" />
      </select>
      <from>
        <query name="sr_opl" as="a">
          <link name="kod_sf">
            <link name="kod_deb">
              <elink name="ur_dogplat">
                <link name="kod_mat_pp">
                  <link name="kod_folders" />
                </link>
              </elink>
            </link>
          </link>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="!=">
            <column table="kod_sf" column="vid_real" />
            <const>9</const>
          </call>
          <call function="is not null">
            <column table="kod_mat_pp" column="kod_mat" />
          </call>
        </call>
      </where>
    </query>
    <query name="un-opl-gp-sf">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="kod_mat_pp" column="kod_mat" as="kod_mat_pp" />
        <column table="kod_sf" column="kod_sf" />
        <column table="a" column="kod_opl" />
        <column table="a" column="opl" />
        <column table="a" column="dat_opl" />
        <column table="a" column="num_opl" />
      </select>
      <from>
        <query name="sr_opl" as="a">
          <link name="kod_sf">
            <elink name="ur_dogplat">
              <link name="kod_mat_pp">
                <link name="kod_folders" />
              </link>
            </elink>
          </link>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="kod_sf" column="vid_real" />
            <const>9</const>
          </call>
          <call function="is not null">
            <column table="kod_mat_pp" column="kod_mat" />
          </call>
        </call>
      </where>
    </query>
    <query name="un-opl-gp-deb">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="kod_mat_pp" column="kod_mat" as="kod_mat_pp" />
        <column table="kod_sf" column="kod_sf" />
        <column table="a" column="kod_opl" />
        <column table="a" column="opl" />
        <column table="a" column="dat_opl" />
        <column table="a" column="num_opl" />
      </select>
      <from>
        <query name="sr_opl" as="a">
          <link name="kod_sf">
            <link name="kod_deb">
              <elink name="ur_dogplat">
                <link name="kod_mat_pp">
                  <link name="kod_folders" />
                </link>
              </elink>
            </link>
          </link>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="kod_sf" column="vid_real" />
            <const>9</const>
          </call>
          <call function="is not null">
            <column table="kod_mat_pp" column="kod_mat" />
          </call>
        </call>
      </where>
    </query>
    <query name="un-opl-gp-fl">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="kod_mat_pp" column="kod_mat" as="kod_mat_pp" />
        <column table="a" column="kod_opl" />
        <column table="a" column="opl" />
        <column table="kod_opl" column="dat_opl" />
        <column table="kod_opl" column="num_opl" />
      </select>
      <from>
        <query name="tnr_accopl" as="a">
          <link name="kod_opl" />
          <link name="kod_account">
            <link name="vid_t" />
            <link name="kod_izv">
              <elink name="ur_dogplat">
                <link name="kod_mat_pp">
                  <link name="kod_folders" />
                </link>
              </elink>
            </link>
          </link>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="vid_t" column="vid_real" />
            <const>9</const>
          </call>
          <call function="is not null">
            <column table="kod_mat_pp" column="kod_mat" />
          </call>
          <!--<call function="=">
            <column table="kod_mat_pp" column="kod_mat"/>
            <const>1000000446</const>
          </call>-->
        </call>
      </where>
    </query>
    <query name="un-oplmat-gp-sf">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="kod_mat_pp" column="kod_mat" as="kod_mat_pp" />
        <column table="a" column="kod_opl" />
        <call function="+nvl" as="opl" comment="Итоговая сумма переплаты">
          <column table="a" column="opl" comment="Начальная сумма переплаты" />
          <column table="kod_opl_storno" column="opl" dgroup="sumnvl" comment="Сторно к переплате" />
        </call>
        <column table="a" column="dat_opl" />
        <column table="a" column="num_opl" />
      </select>
      <from>
        <query name="sr_opl" as="a">
          <link name="kod_link">
            <link name="kod_mat" as="kod_mat_pp">
              <link name="kod_folders" />
            </link>
          </link>
          <dlink name="storno" as="kod_opl_storno" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="kod_type_opl" />
            <const>1</const>
          </call>
          <call function="is not null">
            <column table="kod_mat_pp" column="kod_mat" />
          </call>
          <call function="=">
            <column table="a" column="vid_real" />
            <const>9</const>
          </call>
          <call function="gt">
            <column table="this" column="opl" />
            <const>0</const>
          </call>
        </call>
      </where>
    </query>
    <query name="un-oplmat-gp-izv">
      <select>
        <column table="kod_folders" column="kod_abon_type" />
        <column table="kod_mat_pp" column="kod_mat" as="kod_mat_pp" />
        <column table="a" column="kod_opl" />
        <call function="+nvl" as="opl" comment="Итоговая сумма переплаты">
          <column table="a" column="opl" comment="Начальная сумма переплаты" />
          <column table="kod_opl_storno" column="opl" dgroup="sumnvl" comment="Сторно к переплате" />
        </call>
        <column table="a" column="dat_opl" />
        <column table="a" column="num_opl" />
      </select>
      <from>
        <query name="tsr_opl" as="a">
          <link name="kod_link">
            <link name="kod_mat" as="kod_mat_pp">
              <link name="kod_folders" />
            </link>
          </link>
          <dlink name="storno" as="kod_opl_storno" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="kod_type_opl" />
            <const>1</const>
          </call>
          <call function="is not null">
            <column table="kod_mat_pp" column="kod_mat" />
          </call>
          <call function="=">
            <column table="a" column="vid_real" />
            <const>9</const>
          </call>
          <call function="gt">
            <column table="this" column="opl" />
            <const>0</const>
          </call>
        </call>
      </where>
    </query>
    <!--Тест-->
    <query name="26897_test">
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26897-un-all" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="gt">
            <column table="this" column="nachisl_gp" />
            <const>0</const>
          </call>
          <call function="gt">
            <column table="this" column="gp_otv" />
            <const>0</const>
          </call>
          <call function="gt">
            <column table="this" column="opl_fl" />
            <const>0</const>
          </call>
        </call>
      </where>
    </query>
    <query name="26897_test_opl">
      <select>
        <column table="a" column="kod_mat_pp" />
        <column table="a" column="kod_opl" />
        <column table="a" column="opl_do" />
      </select>
      <from>
        <query name="26897-un-all" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="gt">
            <column table="this" column="opl_do" />
            <const>0</const>
          </call>
        </call>
      </where>
    </query>
    <query name="test_repository">
      <select>
        <column table="a" column="kod" as="key" />
        <column table="a" column="name" as="text" />
        <!--<call function="" as="one">
          <const>1</const>
        </call>-->
      </select>
      <from>
        <table name="test_repository_view" view="1" as="a" />
      </from>
    </query>
    <query name="bizv_abon">
      <select>
        <column table="a" column="kodp" type="number" />
        <column table="a" column="dep_name" type="string" title="Отделение" />
        <column table="a" column="fio" type="string" title="ФИО" />
        <column table="a" column="nump" type="string" title="Лицевой счёт" />
      </select>
      <from>
        <table name="bizv_abon_view" view="1" as="a" />
      </from>
    </query>
    <query name="bizv_mat">
      <select>
        <column table="a" column="kod_mat_pp" type="number" title="kod_mat_pp" />
        <column table="a" column="kodp" type="number" />
        <column table="a" column="dat_create" type="date" title="Дата создания папки" />
        <column table="a" column="dat_finish" type="date" title="Дата закрытия папки" />
        <column table="a" column="num_reg" type="string" title="Номер иска" />
        <column table="a" column="num_delo" type="string" title="Номер дела" />
        <column table="a" column="dat_doc" type="date" title="Дата иска" />
        <column table="a" column="dat_gp" type="date" title="Номер ГП" />
        <column table="a" column="sum_gp" type="number" title="Сумма ГП" />
      </select>
      <from>
        <table name="bizv_mat_view" view="1" as="a" />
      </from>
    </query>
    <query name="bizv_izv">
      <select>
        <column table="a" column="kod_izv" type="number" title="kod_izv" />
        <column table="a" column="kodp" type="number" />
        <column table="a" column="num_izv" type="string" title="Номер извещения" />
        <column table="a" column="date_izv" type="date" title="Дата извещения" />
        <column table="a" column="ym" type="number" title="Период задолженности" />
        <column table="a" column="nachisl" type="number" title="Начислено" />
        <column table="a" column="opl" type="number" title="Оплачено" />
        <column table="a" column="ost" type="number" title="Остаток" />
      </select>
      <from>
        <table name="bizv_izv_view" view="1" as="a" />
      </from>
    </query>
    <query name="bsf_abon">
      <select>
        <column table="a" column="kodp" type="number" />
        <column table="a" column="dep_name" type="string" title="Отделение" />
        <column table="a" column="fio" type="string" title="Наименование" />
        <column table="a" column="nump" type="string" title="Код абонента" />
      </select>
      <from>
        <table name="bsf_abon_view" view="1" as="a" />
      </from>
    </query>
    <query name="bsf_mat">
      <select>
        <column table="a" column="kod_mat_pp" type="number" title="kod_mat_pp" />
        <column table="a" column="kodp" type="number" />
        <column table="a" column="dat_create" type="date" title="Дата создания папки" />
        <column table="a" column="dat_finish" type="date" title="Дата закрытия папки" />
        <column table="a" column="num_reg" type="string" title="Номер иска" />
        <column table="a" column="num_delo" type="string" title="Номер дела" />
        <column table="a" column="dat_doc" type="date" title="Дата иска" />
        <column table="a" column="dat_gp" type="date" title="Номер ГП" />
        <column table="a" column="sum_gp" type="number" title="Сумма ГП" />
      </select>
      <from>
        <table name="bsf_mat_view" view="1" as="a" />
      </from>
    </query>
    <query name="bsf_sf" timestamp="23.06.2016 03:53:51">
      <select>
        <column table="a" column="kod_sf" type="number" title="kod_izv" />
        <column table="a" column="kodp" type="number" />
        <column table="a" column="num_sf" type="string" title="Номер счета" />
        <column table="a" column="dat_sf" type="date" title="Дата счета" />
        <column table="a" column="kod_deb" type="number" />
        <column table="a" column="num_pl" type="string" title="Номер платежного требования" />
        <column table="a" column="dat_deb" type="date" title="Дата платежного требования" />
        <column table="a" column="ym" type="number" title="Период задолженности" />
        <column table="a" column="nachisl" type="number" title="Начислено" />
        <column table="a" column="opl" type="number" title="Оплачено" />
        <column table="a" column="ost" type="number" title="Остаток" />
      </select>
      <from>
        <table name="bsf_sf_view" view="1" as="a" />
      </from>
    </query>
  </queries>
  <views>
    <view name="test_repository_view">
      select 0 as kod, 'Активный' as name from dual union
      select 1, 'Неактивный' from dual union
      select 2, 'Преддоговорной' from dual union
      select 3, 'Нахальный' from dual
    </view>
    <view name="bizv_mat_view">
      select
      p.kodp,
      f.dat_create, f.dat_finish,
      m.kod_mat, m.num_reg, m.num_delo, m.dat_doc, m.dat_gp, decode(nvl(hm.gp_otv,0),0,nvl(m.sum_gp,0),nvl(hm.gp_otv,0)) as sum_gp
      from kr_payer p, ur_folders f, ur_mat m,ur_hist_mat hm
      where nvl(f.kodp_new,f.kodp) = p.kodp and f.vvod = 0 and f.tep_el = 4
      and m.kod_folders = f.kod_folders
      and not exists (select 1 from ur_dogplat where vid_real = 9 and kod_sdp = 6 and kod = m.kod_mat)
      and hm.kod_mat=m.kod_mat and hm.kod_result = 7
      and decode(nvl(hm.gp_otv,0),0,nvl(m.sum_gp,0),nvl(hm.gp_otv,0))!=0
    </view>
    <view name="bizv_izv_view">
      select p.kodp as kodp,
      s.kod_izv as kod_izv,
      s.num_izv as num_izv,
      s.ym as ym,
      s.date_izv as date_izv,
      nvl(a.nachisl,0) as nachisl,
      nvl(o.opl,0) as opl,
      (nvl(a.nachisl,0) - nvl(o.opl,0)) as ost
      from kr_payer p, kr_dogovor d, kr_org org,
      (
      select i.kod_izv,
      i.num_izv,
      i.ym,
      i.date_izv,
      i.kod_dog
      from tnr_izv i
      where i.type_izv = 10
      and not exists (select 1 from ur_dogplat where vid_real = 9 and kod_izv = i.kod_izv)
      ) s,
      (
      select kod_izv,
      sum(opl) as opl
      from tsr_opl
      group by kod_izv
      ) o,
      (
      select kod_izv,
      sum(nachisl) as nachisl
      from tnr_account
      group by kod_izv
      ) a
      where s.kod_dog = d.kod_dog and d.tep_el = 4
      and p.kodp = d.kodp
      and a.kod_izv (+) = s.kod_izv
      and o.kod_izv (+) = s.kod_izv
      and org.kodp = d.dep
    </view>
    <view name="bizv_abon_view">
      select o.name as dep_name, p.kodp, p.name as fio, p.nump
      from kr_payer p, kr_org o
      where exists (select 1 from kr_dogovor where kodp = p.kodp and tep_el = 4)
      and o.kodp = (select max(dep) from kr_dogovor where kodp = p.kodp and tep_el = 4)
      order by 1,3
    </view>
    <view name="bsf_mat_view">
      select
      p.kodp,
      f.dat_create, f.dat_finish,
      m.kod_mat, m.num_reg, m.num_delo, m.dat_doc, m.dat_gp, m.sum_gp--decode(nvl(hm.gp_otv,0),0,nvl(m.sum_gp,0),nvl(hm.gp_otv,0)) as sum_gp
      from kr_payer p, ur_folders f, ur_mat m--,ur_hist_mat hm
      where exists (select 1 from kr_dogovor where p.kodp = kodp and tep_el != 4)
      and nvl(f.kodp_new,f.kodp) = p.kodp and f.vvod = 0 and f.tep_el != 4
      and m.kod_folders = f.kod_folders
      and not exists (select 1 from ur_dogplat where vid_real = 9 and kod_sdp = 6 and kod = m.kod_mat)
      --and hm.kod_mat=m.kod_mat and hm.kod_result = 7
      --and decode(nvl(hm.gp_otv,0),0,nvl(m.sum_gp,0),nvl(hm.gp_otv,0))!=0
    </view>sq
    <view name="bsf_sf_view">
      select p.kodp as kodp,
      s.kod_sf as kod_sf,
      s.num_sf as num_sf,
      s.dat_sf as dat_sf,
      s.ym as ym,
      s.kod_deb as kod_deb,
      s.num_pl as num_pl,
      s.dat_deb as dat_deb,
      nvl(a.nachisl,0) as nachisl,
      nvl(o.opl,0) as opl,
      (nvl(a.nachisl,0) - nvl(o.opl,0)) as ost
      from kr_payer p, kr_dogovor d, kr_org org,
      (
      select sf.kod_sf,
      sf.num_sf,
      sf.dat_sf,
      sf.ym,
      sf.kod_dog,
      deb.kod_deb,
      deb.num_pl,
      deb.dat_deb
      from sr_facvip sf, sr_debet deb
      where sf.vid_sf = 5
      and deb.kod_deb (+) = sf.kod_deb
      and
      (
      not exists (select 1 from ur_dogplat where vid_real = 9 and kod_sf = sf.kod_sf)
      or
      (
      deb.kod_deb is not null
      and
      not exists (select 1 from ur_dogplat where vid_real = 9 and kod_deb = sf.kod_deb)
      )
      )
      ) s,
      (
      select kod_sf,
      sum(opl) as opl
      from sr_opl
      group by kod_sf
      ) o,
      (
      select kod_sf,
      sum(nachisl) as nachisl
      from sr_facras a
      group by kod_sf
      ) a
      where s.kod_dog = d.kod_dog and d.tep_el != 4
      and p.kodp = d.kodp
      and a.kod_sf (+) = s.kod_sf
      and o.kod_sf (+) = s.kod_sf
      and org.kodp = d.dep
    </view><view name="bsf_abon_view">
      select o.name as dep_name, p.kodp, p.name as fio, p.nump
      from kr_payer p, kr_org o
      where exists (select 1 from kr_dogovor where kodp = p.kodp and tep_el != 4)
      and o.kodp = (select max(dep) from kr_dogovor where kodp = p.kodp and tep_el != 4)
      order by 1,3
    </view></views>
</root>