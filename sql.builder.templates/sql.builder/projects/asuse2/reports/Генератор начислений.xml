<?xml version="1.0" encoding="utf-8"?>
<root>
  <parts>
    <part id="fingen-acc-cond">
      <call function="and">
        <call function="!=">
          <column table="vid_t" column="vid_real" />
          <const>0</const>
        </call>
        <call function="ge" optional="1">
          <column table="a" column="ym" />
          <call function="date to ym">
            <useparam name="date1" />
          </call>
        </call>
        <call function="le" optional="1">
          <column table="a" column="ym" />
          <call function="date to ym">
            <useparam name="date2" />
          </call>
        </call>
      </call>
    </part>
    <part id="fingen-acc-cond-bu">
      <call function="and">
        <call function="=">
          <column table="vid_t" column="vid_real" />
          <const>0</const>
        </call>
        <call function="ge" optional="1">
          <column table="kod_bu_akt" column="date_isp" />
          <useparam name="date1" />
        </call>
        <call function="le" optional="1">
          <column table="kod_bu_akt" column="date_isp" />
          <useparam name="date2" />
        </call>
        <call function="is not null">
          <column table="kod_bu_akt" column="date_isp" />
        </call>
        <call function="=">
          <column table="kod_bu_akt" column="pr_sf" />
          <const>0</const>
        </call>
      </call>
    </part>
    <part id="fingen-acc-cond-bu-nepriz">
      <call function="and">
        <call function="=">
          <column table="vid_t" column="vid_real" />
          <const>0</const>
        </call>
        <call function="is null">
          <column table="kod_bu_akt" column="date_isp" />
        </call>
        <call function="=">
          <column table="kod_bu_akt" column="pr_sf" />
          <const>0</const>
        </call>
      </call>
    </part>
    <part id="fingen-cols-acc">
      <column table="account_period" column="nachisl" as="acc_nach" group="sum" title="Начислено с НДС (руб.)" />
      <column table="account_period" column="cust" as="acc_cust" group="sum" title="Начислено (нат. пок.)" />
      <column table="account_period_nal" column="nal" as="acc_nal" group="sum" />
      <column table="account_period_sost" column="nachisl" as="acc_nach_bn_sost" group="sum" title="Начислено без НДС (руб.)" />
      <column table="account_period_sost" column="cust" as="acc_cust_sost" group="sum" title="Начислено (нат. пок.)" />
      <column table="account_period_bu" column="nachisl" as="acc_nach_dop_bu" group="sum" />
      <column table="account_period_bu" column="cust" as="acc_cust_dop_bu" group="sum" />
      <column table="account_period_nal_bu" column="nal" as="acc_nal_dop_bu" group="sum" />
      <column table="account_period_sost_bu" column="nachisl" as="acc_nach_bn_sost_dop_bu" group="sum" />
      <column table="account_period_sost_bu" column="cust" as="acc_cust_sost_dop_bu" group="sum" />
      <column table="account_period_bu_np" column="nachisl" as="acc_nach_np_bu" group="sum" />
      <column table="account_period_bu_np" column="cust" as="acc_cust_np_bu" group="sum" />
      <call function="-nvl" as="acc_nach_bn" group="sum" title="Начислено без НДС (руб.)">
        <column table="this" column="acc_nach" group="" />
        <column table="this" column="acc_nal" group="" />
      </call>
      <call function="/" as="acc_tax">
        <column table="this" column="acc_nal" window="kod_account" />
        <column table="this" column="acc_nach_bn" window="kod_account" />
      </call>
      <call function="*" as="acc_nal_sost">
        <column table="this" column="acc_nach_bn_sost" />
        <column table="this" column="acc_tax" />
      </call>
      <call function="*" as="acc_nach_sost" title="Начислено c НДС (руб.)">
        <column table="this" column="acc_nach_bn_sost" />
        <call function="+">
          <column table="this" column="acc_tax" />
          <const>1</const>
        </call>
      </call>
      <call function="-nvl" as="acc_nach_bn_dop_bu">
        <column table="this" column="acc_nach_dop_bu" />
        <column table="this" column="acc_nal_dop_bu" />
      </call>
      <call function="/" as="acc_tax_dop_bu">
        <column table="this" column="acc_nal_dop_bu" window="kod_account" />
        <column table="this" column="acc_nach_bn_dop_bu" window="kod_account" />
      </call>
      <call function="*" as="acc_nal_sost_dop_bu">
        <column table="this" column="acc_nach_bn_sost_dop_bu" />
        <column table="this" column="acc_tax_dop_bu" />
      </call>
      <call function="*" as="acc_nach_sost_dop_bu">
        <column table="this" column="acc_nach_bn_sost_dop_bu" />
        <call function="+">
          <column table="this" column="acc_tax_dop_bu" />
          <const>1</const>
        </call>
      </call>
      <call function="+nvl" as="acc_nach_pl_dbu" title="Начисления с НДС, руб.">
        <column table="this" column="acc_nach" />
        <column table="this" column="acc_nach_dop_bu" />
      </call>
      <!--начисления vid_real не 0 + признанная безучетка + непризнанная безучетка-->
      <call function="+nvl" as="acc_nach_pl_bu" title="Начисления с НДС, руб.">
        <column table="this" column="acc_nach" />
        <column table="this" column="acc_nach_dop_bu" />
        <column table="this" column="acc_nach_np_bu" />
      </call>
      <call function="+nvl" as="acc_cust_pl_bu" title="Начисления с НДС, руб.">
        <column table="this" column="acc_cust" />
        <column table="this" column="acc_cust_dop_bu" />
        <column table="this" column="acc_cust_np_bu" />
      </call>
      <call function="+nvl" as="acc_nach_bn_pl_dbu" title="Начисления без НДС, руб.">
        <column table="this" column="acc_nach_bn" />
        <column table="this" column="acc_nach_bn_dop_bu" />
      </call>
      <call function="+nvl" as="acc_nal_pl_dbu" title="Начисления НДС, руб.">
        <column table="this" column="acc_nal" />
        <column table="this" column="acc_nal_dop_bu" />
      </call>
      <call function="+nvl" as="acc_cust_pl_dbu" title="Начисления, нат. пок.">
        <column table="this" column="acc_cust" />
        <column table="this" column="acc_cust_dop_bu" />
      </call>
      <call function="+nvl" as="acc_nach_sost_pl_dbu" title="Начисления с НДС, руб. (по составляющим)">
        <column table="this" column="acc_nach_sost" />
        <column table="this" column="acc_nach_sost_dop_bu" />
      </call>
      <call function="+nvl" as="acc_nach_bn_sost_pl_dbu" title="Начисления без НДС, руб. (по составляющим)">
        <column table="this" column="acc_nach_bn_sost" />
        <column table="this" column="acc_nach_bn_sost_dop_bu" />
      </call>
      <call function="+nvl" as="acc_nal_sost_pl_dbu" title="Начисления НДС, руб. (по составляющим)">
        <column table="this" column="acc_nal_sost" />
        <column table="this" column="acc_nal_sost_dop_bu" />
      </call>
      <call function="+nvl" as="acc_cust_sost_pl_dbu" title="Начисления, нат. пок. (по составляющим)">
        <column table="this" column="acc_cust_sost" />
        <column table="this" column="acc_cust_sost_dop_bu" />
      </call>
    </part>
    <part id="fingen-cols-acc-1" timestamp="24.04.2019 13:22:59">
      <column table="this" column="acc_cust_pl_dbu" as="acc_cust_pl_dbu_e3" title="Начисления, квт">
        <if>
          <call function="=">
            <column table="this" column="edizm" />
            <const>3</const>
          </call>
        </if>
      </column>
      <column table="this" column="acc_cust_pl_dbu" as="acc_cust_pl_dbu_e3_t22" title="Начисления, квт">
        <if>
          <call function="and">
            <call function="=">
              <column table="this" column="edizm" />
              <const>3</const>
            </call>
            <call function="=">
              <column table="this" column="vid_t" />
              <const>22</const>
            </call>
          </call>
        </if>
      </column>
      <column table="this" column="acc_cust_pl_dbu" as="acc_cust_pl_dbu_e4" title="Начисления, квтч">
        <if>
          <call function="=">
            <column table="this" column="edizm" />
            <const>4</const>
          </call>
        </if>
      </column>
      <column table="this" column="acc_nach_bn_sost_pl_dbu" as="acc_nach_bn_sost_pl_dbu_s1" if="s1" title="Начисления по срвзв. нерег. ц. без НДС, руб.">
        <if>
          <call function="=">
            <column table="this" column="tip_tarif_sost" />
            <const>-1</const>
          </call>
        </if>
      </column>
      <column table="this" column="acc_nach_sost_pl_dbu" as="acc_nach_sost_pl_dbu_s1" if="s1" title="Начисления по срвзв. нерег. ц. с НДС, руб." />
      <column table="this" column="acc_nach_bn_sost_pl_dbu" as="acc_nach_bn_sost_pl_dbu_s2" if="s2" title="Начисления за услуги по передаче без НДС, руб.">
        <if>
          <call function="=">
            <column table="this" column="tip_tarif_sost" />
            <const>2</const>
          </call>
        </if>
      </column>
      <column table="this" column="acc_nach_sost_pl_dbu" as="acc_nach_sost_pl_dbu_s2" if="s2" title="Начисления за услуги по передаче с НДС, руб." />
      <column table="this" column="acc_nach_bn_sost_pl_dbu" as="acc_nach_bn_sost_pl_dbu_s10" if="s10" title="Начисления за иные услуги без НДС, руб.">
        <if>
          <call function="=">
            <column table="this" column="tip_tarif_sost" />
            <const>10</const>
          </call>
        </if>
      </column>
      <column table="this" column="acc_nach_sost_pl_dbu" as="acc_nach_sost_pl_dbu_s10" if="s10" title="Начисления за иные услуги с НДС, руб." />
      <column table="this" column="acc_nach_bn_sost_pl_dbu" as="acc_nach_bn_sost_pl_dbu_s16" if="s16" title="Начисления сбытовая надбавка без НДС, руб.">
        <if>
          <call function="=">
            <column table="this" column="tip_tarif_sost" />
            <const>16</const>
          </call>
        </if>
      </column>
      <column table="this" column="acc_nach_sost_pl_dbu" as="acc_nach_sost_pl_dbu_s16" if="s16" title="Начисления сбытовая надбавка с НДС, руб." />
      <column table="this" column="acc_nach_bn_pl_dbu" as="acc_nach_bn_pl_dbu_t22" if="t22" title="Начисления за сетевую мощность без НДС, руб.">
        <if>
          <call function="=">
            <column table="this" column="vid_t" />
            <const>22</const>
          </call>
        </if>
      </column>
      <column table="this" column="acc_nach_pl_dbu" as="acc_nach_pl_dbu_t22" if="t22" title="Начисления за сетевую мощность с НДС, руб." />
      <column table="this" column="acc_nach_bn_pl_dbu" as="acc_nach_bn_pl_dbu_t72" if="t72" title="Начисления за генер. мощность без НДС, руб.">
        <if>
          <call function="=">
            <column table="this" column="vid_t" />
            <const>72</const>
          </call>
        </if>
      </column>
      <column table="this" column="acc_nach_pl_dbu" as="acc_nach_pl_dbu_t72" if="t72" title="Начисления за генер. мощность с НДС, руб." />
    </part>
    <part id="fingen-cols-for-46" timestamp="22.09.2022 13:03:04">
      <call function="case" as="pr_2rate1" group="kod_account" type="number">
        <call function="when">
          <call function="=">
            <column table="this" column="vid_t" />
            <const>22</const>
          </call>
          <const>1</const>
        </call>
      </call>
      <call function="if" group="kod_account" as="pr_2rate" type="number">
        <call function="!=0">
          <column table="this" column="pr_2rate1" window="kod_numobj,ym" />
        </call>
        <const>1</const>
        <const>0</const>
      </call>
      <call function="if" group="kod_account" as="pr_usl" type="number">
        <call function="is not null">
          <column table="this" column="tarif2" window="kod_numobj,ym" />
        </call>
        <const>1</const>
        <const>0</const>
      </call>
      <call function="if" group="kod_account" as="pr_free">
        <call function="is not null">
          <call function="if" window="kod_numobj,ym">
            <call function="in">
              <column table="this" column="vid_t" />
              <array>77,78,79</array>
            </call>
            <const>1</const>
          </call>
        </call>
        <const>1</const>
        <const>0</const>
      </call>
      <call function="case" type="number" as="pr_nasel" group="kod_account">
        <call function="when">
          <call function="in">
            <column table="this" column="vid_t" />
            <call function="array">
              <const>25</const>
              <const>35</const>
              <const exclude="1">17</const>
            </call>
          </call>
          <const>1</const>
        </call>
        <call function="else">
          <const>0</const>
        </call>
      </call>
      <call function="case" type="string" group="kod_account" as="f46_podrazdel" title="">
        <call function="when">
          <call function="=">
            <column table="this" column="pr_nasel" group="" />
            <const>1</const>
          </call>
          <const>'В'</const>
        </call>
        <call function="else">
          <call function="case">
            <call function="when">
              <call function="=">
                <column table="this" column="pr_usl" group="" />
                <const>1</const>
              </call>
              <const>'А'</const>
            </call>
            <call function="else">
              <const>'Б'</const>
            </call>
          </call>
        </call>
      </call>
      <call function="case" type="string" group="kod_account" as="f46_podrazdel_ies" title="">
        <call function="when">
          <call function="=">
            <column table="this" column="pr_nasel" group="" />
            <const>1</const>
          </call>
          <const>'В'</const>
        </call>
        <call function="when">
          <call function="and">
            <call function="=0">
              <column table="this" column="kod_tipdog" />
            </call>
            <call function="=">
              <column table="this" column="kod_vdoc" group="" />
              <const>1</const>
            </call>
          </call>
          <const>'А'</const>
        </call>
        <call function="when">
          <call function="and">
            <call function="in">
              <column table="this" column="kod_tipdog" />
              <array>0,4</array>
            </call>
            <call function="=">
              <column table="this" column="kod_vdoc" group="" />
              <const>5</const>
            </call>
          </call>
          <const>'Б'</const>
        </call>
        <call function="else">
          <const>'Н'</const>
        </call>
        <call function="else" exclude="1">
          <call function="case">
            <call function="when">
              <call function="and">
                <call function="=0">
                  <column table="this" column="kod_tipdog" />
                </call>
                <call function="=">
                  <column table="this" column="kod_vdoc" group="" />
                  <const>1</const>
                </call>
              </call>
              <const>'А'</const>
            </call>
            <call function="when">
              <call function="and">
                <call function="=0">
                  <column table="this" column="kod_tipdog" />
                </call>
                <call function="=">
                  <column table="this" column="kod_vdoc" group="" />
                  <const>5</const>
                </call>
              </call>
              <const>'Б'</const>
            </call>
            <call function="else">
              <const>'Н'</const>
            </call>
          </call>
        </call>
      </call>
      <call function="case" type="string" group="kod_account" as="f46_razdel" title="">
        <call function="when">
          <call function="and">
            <call function="=">
              <column table="this" column="pr_free" group="" />
              <const>1</const>
            </call>
            <call function="=">
              <column table="this" column="pr_nasel" group="" />
              <const>0</const>
            </call>
          </call>
          <const>'II'</const>
        </call>
        <call function="else">
          <const>'I'</const>
        </call>
      </call>
      <call function="case" type="string" group="kod_account" as="f46_razdel_ies" title="" exclude="1">
        <call function="when">
          <call function="and">
            <call function="=" exclude="1">
              <column table="this" column="pr_free" group="" />
              <const>1</const>
            </call>
            <call function="=">
              <column table="this" column="pr_nasel" group="" />
              <const>0</const>
            </call>
          </call>
          <const>'II'</const>
        </call>
        <call function="else">
          <const>'I'</const>
        </call>
      </call>
      <call function="()" type="string" group="kod_account" as="f46_razdel_ies" title="">
        <const>'I'</const>
      </call>
    </part>
    <part id="fingen-cols-for-sections" timestamp="24.03.2016 20:12:54">
      <call function="-nvl" as="ob_deb" class-title="За период" title="Оборот по дебету, руб.">
        <column table="this" column="nachisl" />
        <column table="this" column="opl_nach" />
      </call>
      <call function="-nvl" as="ob_deb_0_30" class-title="За период" title="Оборот по авансам 30%, руб.">
        <column table="this" column="nachisl_0_30" />
        <column table="this" column="opl_0_30" />
      </call>
      <call function="-nvl" as="ob_deb_0_40" class-title="За период" title="Оборот по авансам 40%, руб.">
        <column table="this" column="nachisl_0_40" />
        <column table="this" column="opl_0_40" />
      </call>
      <call function="-nvl" as="ob_deb_2" class-title="За период" title="Оборот по основной реализации, руб.">
        <column table="this" column="nachisl_2" />
        <column table="this" column="opl_2" />
      </call>
      <call function="-nvl" as="ob_full_pa" class-title="За период" title="Оборот полный (кред:переплата и ав. как переплата), руб.">
        <column table="this" column="ob_deb" />
        <column table="this" column="opl_kred_per_avans" />
      </call>
      <column table="this" column="ob_deb" as="+_it" cumulate="ym" />
      <column table="this" column="ob_deb_2" as="+_it" cumulate="ym" />
      <column table="this" column="ob_deb_2" as="+_it_pr" cumulate="next_ym" />
      <column table="this" column="nachisl_0" as="+_in_ym" sections="ym" />
      <column table="this" column="opl_bank" as="+_in_ym" sections="ym" />
      <call function="if" as="dolg_ym">
        <call function="not 0">
          <column table="this" column="ob_deb_2_it" />
        </call>
        <column table="this" column="ym_nach" />
      </call>
      <column table="this" column="ob_deb_0_30" as="+_it" cumulate="ym" />
      <column table="this" column="ob_deb_0_40" as="+_it" cumulate="ym" />
      <column table="this" column="kredit_per" as="ob_kred_it" cumulate="ym" />
      <column table="this" column="kredit_per_kor" as="ob_kred_kor" cumulate="ym" />
      <call as="ob_kred_it_kor" class-title="За период" title="Оборот по основной реализации, руб." function="+nvl">
        <column table="this" column="ob_kred_it" />
        <column table="this" column="ob_kred_kor" />
      </call>
      <column table="this" column="opl_kred_per_avans" as="ob_kred_pa_it" cumulate="ym" />
      <column table="this" column="ob_full_pa" as="+_it" cumulate="ym" />
      <column table="this" column="ob_full_pa" as="+_it_pr" cumulate="next_ym" />
      <!--<call function="+nvl" as="dlg_kz" virtual="1">
        <column table="this"  column="ob_full_pa_it_pr"/>
        <call function="-nvl">
          <column table="this"  column="nachisl_0_in_ym"/>
          <column table="this"  column="opl_bank_in_ym"/>
        </call>
      </call>

      <call function="+nvl" as="dlg_kz_dog" virtual="1">
        <column table="this"  column="ob_full_pa_it_pr" window="kod_dog"/>
        <call function="-nvl">
          <column table="this"  column="nachisl_0_in_ym" window="kod_dog"/>
          <column table="this"  column="opl_bank_in_ym" window="kod_dog"/>
        </call>
      </call>



      <call function="if" as="tst" virtual="1">
          <call function="and">
            <call function="gt">
              <column table="this"  column="dlg_kz_dog" />
              <const>0</const>
            </call>
            <call function="gt">
              <column table="this"  column="ob_full_pa_it" />
              <const>0</const>
            </call>
          </call>
          <call function="if">
            <call function="gt">
              <call function="-nvl">
                <column table="this"  column="dlg_kz_dog" />
                <column table="this"  column="ob_kred_pa_it" window="kod_dog" />
              </call>
              <const>0</const>
            </call>
            <call function="if">
              <call function="gt">
                <column table="this"  column="dlg_kz_dog" />
                <column table="this"  column="ob_deb_it" window="kod_dog"/>
              </call>
              <column table="this"  column="ob_deb_it"/>
              <column table="this"  column="dlg_kz"/>
            </call>
          </call>
      </call>-->
    </part>
  </parts>
  <!--<forms>
    <form name="fingen_nach_period">
      <content>
        <field name="ym" controlType="UIComboRange" title="Период">
          <listquery>
            <query name="kr_calc_list">
            </query>
          </listquery>
          <defaultquery>
            <query name="kr_calc_max">
            </query>
          </defaultquery>
        </field>
        <field name="dep" controlType="UIList" title="Отделения">
          <listquery>
            <query name="kr_dep">
            </query>
          </listquery>
        </field>
        <field name="kod_dog" controlType="UIList" title="Абоненты и договоры">
          <listquery>
            <query name="kr_dogovor_list(dep)">
            </query>
          </listquery>
        </field>
        <field name="vidreal" controlType="UIList" title="Виды реализации">
          <listquery>
            <query name="sk_vid_real_list">
            </query>
          </listquery>
        </field>
        <field name="vidt_filtr" controlType="UIList" title="Виды товаров (фильтр)">
          <listquery>
            <query name="sk_nachisl(vidreal)">
            </query>
          </listquery>
        </field>
        <field name="vidt_col" controlType="UIList" title="Виды товаров (транспонирование)">
          <listquery>
            <query name="sk_nachisl(vidreal)">
            </query>
          </listquery>
        </field>
        <field name="edizm_filtr" controlType="UIList" title="Натуральные показатели (фильтр)">
          <listquery>
            <query name="sk_edizm_list">
            </query>
          </listquery>
        </field>
        <field name="edizm_col" controlType="UIList" title="Натуральные показатели (транспонирование)">
          <listquery>
            <query name="sk_edizm_list">
            </query>
          </listquery>
        </field>
        <field name="typeopl_filtr" controlType="UIList" title="Типы оплат (фильтр)">
          <listquery>
            <query name="sk_type_opl_list">
            </query>
          </listquery>
        </field>
        <field name="typeopl_col" controlType="UIList" title="Типы оплат (транспонирование)">
          <listquery>
            <query name="sk_type_opl_list">
            </query>
          </listquery>
        </field>
        <field name="vidopl_filtr" controlType="UIList" title="Виды оплат (фильтр)">
          <listquery>
            <query name="ss_vidopl_list">
            </query>
          </listquery>
        </field>
        <field name="vidopl_col" controlType="UIList" title="Виды оплат (транспонирование)">
          <listquery>
            <query name="ss_vidopl_list">
            </query>
          </listquery>
        </field>
      </content>
    </form>

    <form name="fingen_opl_nach_period">
      <content>
        <field name="ym" controlType="UIComboRange" title="Период">
          <listquery>
            <query name="kr_calc_list">
            </query>
          </listquery>
          <defaultquery>
            <query name="kr_calc_max">
            </query>
          </defaultquery>
        </field>
        <field name="dep" controlType="UIList" title="Отделения">
          <listquery>
            <query name="kr_dep">
            </query>
          </listquery>
        </field>
        <field name="kod_dog" controlType="UIList" title="Абоненты и договоры">
          <listquery>
            <query name="kr_dogovor_list(dep)">
            </query>
          </listquery>
        </field>
        <field name="vidreal" controlType="UIList" title="Виды реализации">
          <listquery>
            <query name="sk_vid_real_list">
            </query>
          </listquery>
        </field>
        <field name="vidt_filtr" controlType="UIList" title="Виды товаров (фильтр)">
          <listquery>
            <query name="sk_nachisl(vidreal)">
            </query>
          </listquery>
        </field>
        <field name="vidt_col" controlType="UIList" title="Виды товаров (транспонирование)">
          <listquery>
            <query name="sk_nachisl(vidreal)">
            </query>
          </listquery>
        </field>
        <field name="edizm_filtr" controlType="UIList" title="Натуральные показатели (фильтр)">
          <listquery>
            <query name="sk_edizm_list">
            </query>
          </listquery>
        </field>
        <field name="edizm_col" controlType="UIList" title="Натуральные показатели (транспонирование)">
          <listquery>
            <query name="sk_edizm_list">
            </query>
          </listquery>
        </field>
        <field name="typeopl_filtr" controlType="UIList" title="Типы оплат (фильтр)">
          <listquery>
            <query name="sk_type_opl_list">
            </query>
          </listquery>
        </field>
        <field name="typeopl_col" controlType="UIList" title="Типы оплат (транспонирование)">
          <listquery>
            <query name="sk_type_opl_list">
            </query>
          </listquery>
        </field>
        <field name="vidopl_filtr" controlType="UIList" title="Виды оплат (фильтр)">
          <listquery>
            <query name="ss_vidopl_list">
            </query>
          </listquery>
        </field>
        <field name="vidopl_col" controlType="UIList" title="Виды оплат (транспонирование)">
          <listquery>
            <query name="ss_vidopl_list">
            </query>
          </listquery>
        </field>
      </content>
    </form>
  </forms>-->
  <!--<reports>
    <report name="fingen_nach_period" title="Генератор выписок/начислений" form="fingen_nach_period" autobands="1">
      <params>
        <param name="ym1">
          <const>2009.03</const>
        </param>
        <param name="ym2">
          <const>2009.08</const>
        </param>
        <param name="kod_dog">
          <array>162,270,297,401,775,834,1009,1039,1771,2021,10010863,10019549</array>
        </param>
        <param name="vidreal"></param>
        <param name="vidt_filtr"></param>
        <param name="vidt_col"></param>
        <param name="edizm_filtr"></param>
        <param name="edizm_col"></param>
      </params>
      <customers>
        <customer id="-1"/>
      </customers>
      <queries>
        <query name="fingen_nach_period" as="a">
        
          <withparams>
            <useparam name="ym1"/>
            <useparam name="ym2"/>
            <useparam name="kod_dog"/>
            <useparam name="vidreal"/>
            <useparam name="vidt_filtr"/>
            <useparam name="vidt_col"/>
            <useparam name="edizm_filtr"/>
            <useparam name="edizm_col"/>
          </withparams>
        </query>
      </queries>
    </report>

    <report name="fingen_opl_nach_period" title="Генератор оплат" form="fingen_opl_nach_period">
      <params>
        <param name="ym1">
          <const>2009.03</const>
        </param>
        <param name="ym2">
          <const>2009.08</const>
        </param>
        <param name="kod_dog">
          <array>162,270,297,401,775,834,1009,1039,1771,2021,10010863,10019549</array>
        </param>
        <param name="vidreal"></param>
        <param name="typeopl_filtr"></param>
        <param name="typeopl_col"></param>
        <param name="vidopl_filtr"></param>
        <param name="vidopl_col"></param>
      </params>
      <customers>
        <customer id="-1"/>
      </customers>
      <queries>
        <query name="fingen_opl_nach_period" as="a">
          <withparams>
            <useparam name="ym1"/>
            <useparam name="ym2"/>
            <useparam name="kod_dog"/>
            <useparam name="vidreal"/>
            <useparam name="typeopl_filtr"></useparam>
            <useparam name="typeopl_col"></useparam>
            <useparam name="vidopl_filtr"></useparam>
            <useparam name="vidopl_col"></useparam>
          </withparams>
        </query>
      </queries>
    </report>


    <report name="fingen" title="Финансовый генератор отчетов" form="fingen_nach_period" autobands="1">
      <params>
        <param name="ym1">
          <const>2009.03</const>
        </param>
        <param name="ym2">
          <const>2009.08</const>
        </param>
      </params>
      <customers>
        <customer id="-1"/>
      </customers>
      <queries>
        <query name="fingen_united" as="a">
          
          <withparams>
            <useparam name="ym1"/>
            <useparam name="ym2"/>
          </withparams>
        </query>
      </queries>
    </report>
  </reports>-->
  <queries>
    <query name="fingen_test">
      <select>
        <!--<column table="a" column="*" />-->
        <column table="a" column="ndog" />
        <column table="a" column="cust_teplo" />
        <!--<column table="a" column="vid_real_name" />
        <column table="a" column="nachisl_bef" />
        <column table="a" column="opl_nach_bef" />
        <column table="a" column="ostatok_beg" />
        <column table="a" column="kredit_beg" />
        <column table="a" column="nachisl" />
        <column table="a" column="nachisl_by_vid_t" />
        <column table="a" column="nachisl_by_edizm" />
        <column table="a" column="cust" />
        <column table="a" column="cust_by_vid_t" />
        <column table="a" column="cust_by_edizm" />
        <column table="a" column="opl_nach" />
        <column table="a" column="opl_nach_cust" />
        <column table="a" column="opl" />
        <column table="a" column="opl_per" />
        <column table="a" column="opl_avans"/>
        <column table="a" column="opl_avans_per" />-->
        <!--<column table="a" column="kredit_per" />
        <column table="a" column="kredit_end" />-->
      </select>
      <from>
        <query name="fingen_united" as="a"></query>
      </from>
    </query>
    <query name="fingen_opl_period_test">
      <select>
        <!--<column table="a" column="*" />-->
        <column table="a" column="kod_opl_master" />
        <column table="kod_dog" column="kod_dog" />
        <column table="a" column="opl_zadat" />
        <column table="a" column="opl_zadat_fk" />
        <column table="a" column="opl_storno_zadat" />
        <column table="a" column="opl_storno_fk_zadat" />
        <column table="a" column="opl_spisanie_zadat" />
        <column table="a" column="opl_spisanie_avans" />
        <column table="a" column="opl_vozvrat_avans" />
        <column table="a" column="opl_perenos_avans" />
        <column table="a" column="opl_zadat_2" />
        <column table="a" column="opl_zadat_fk_2" />
        <column table="a" column="opl_zadat_0" />
        <column table="a" column="opl_zadat_fk_0" />
        <column table="a" column="opl_pstorno_zadat1" />
        <column table="a" column="opl_fk_pstorno_zadat2" />
        <column table="a" column="opl_fk_pstorno_zadat0" />
      </select>
      <from>
        <query name="fingen_united" as="a">
          <withparams>
            <call function="to_date">
              <const>'01.09.2015'</const>
              <const>'dd.mm.yyyy'</const>
            </call>
            <call function="to_date">
              <const>'30.09.2015'</const>
              <const>'dd.mm.yyyy'</const>
            </call>
          </withparams>
          <link name="kod_opl_master">
            <link name="kod_dog"></link>
          </link>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in">
            <column table="kod_dog" column="kod_dog" />
            <array>279505</array>
            <!--274657-->
          </call>
        </call>
      </where>
    </query>
    <!--<array>
      2566815
    </array>-->
    <query name="fingen_united" cstyle="union" timestamp="29.12.2023 13:34:19">
      <params>
        <param name="date1" />
        <param name="date2" />
        <param name="kod_dog" />
        <param name="vid_real" />
        <param name="vid_t" />
        <param name="edizm" />
        <param name="typeopl" />
        <param name="vidopl" />
        <param name="vidt_col">
          <array />
        </param>
        <param name="edizm_col">
          <array />
        </param>
        <param name="typeopl_col" />
        <param name="vidopl_col" />
        <param name="kod_tipdog" />
        <param name="kod_dog_fin" />
        <param name="dep_fin" />
      </params>
      <select>
        <column table="*" column="kod_dog" group="1" />
        <column table="*" column="vid_t" group="1" />
        <column table="*" column="vid_real" group="1" />
        <column table="*" column="kod_opl" group="1" />
        <column table="*" column="kod_opl_main" group="1" />
        <column table="*" column="kod_opl_master" group="1" />
        <column table="*" column="kod_sf" group="1" />
        <column table="*" column="rym" group="1" />
        <column table="*" column="ym" group="1" timeline="time1" title="Отчетный период" />
        <call function="ym add month" group="1" as="next_ym" timeline="time1">
          <column table="this" column="ym" />
          <const />
        </call>
        <column table="*" column="kod_bu_akt" group="1" />
        <column table="*" column="kod_bu_akt_main" group="1" />
        <column table="*" column="kod_numobj" group="1" />
        <column table="*" column="edizm" group="1" />
        <column table="*" column="tip_tarif_sost" group="1" />
        <column table="*" column="kod_account" group="1" />
        <column table="*" column="tarif2" group="1" />
        <column table="*" column="sost_tarif" group="1" />
        <column table="*" column="kod_account_sost" group="1" />
        <column table="*" column="kod_kor_saldo" group="1" exclude="1" />
        <column table="kr_dopdoc" column="kod_dopdoc" group="kod_sf" />
        <column table="kod_dog" column="ndog" group="kod_dog" />
        <column table="kod_dog" column="tep_el" group="kod_dog" />
        <column table="*" column="dat_vozn" group="1" />
        <column table="*" column="dat_vozn2" group="1" />
        <column table="kod_vdog" column="kod_tipdog" group="1" />
        <column table="kod_vdog" column="kod_vdoc" group="1" />
        <column table="vid_t" column="name" as="vid_t_name" group="vid_t" />
        <column table="vid_t" column="num_t" group="vid_t" />
        <column table="kodp_uch" column="name" as="name_uch" group="kod_dog" title="Участок" />
        <column table="dep" column="kodp" as="dep" group="1" />
        <column table="dep" column="name" as="dep_name" group="dep" title="Отделение" />
        <column table="kodp" column="kodp" group="1" />
        <column table="kodp" column="name" as="payer_name" title="Наименование абонента" group="kodp" />
        <column table="kodp" column="nump" as="payer_nump" title="Номер абонента" group="kodp" />
        <column table="kod_m" column="kod_m" as="kod_ministry" group="kodp" />
        <column table="kod_m" column="name" as="ministry_name" group="kodp" />
        <column table="kod_ist" column="kod_ist" as="kod_istfin" group="kodp" />
        <column table="kod_ist" column="name" as="istfin_name" title="Источник финансирования" group="kodp" />
        <column table="vid_real" column="name" as="vid_real_name" group="vid_real" />
        <column table="vid_sf" column="abbr" as="vid_sf_abbr" group="kod_sf" title="Наименование документа" />
        <column table="kod_type_opl" column="name" as="typeopl_name" title="Тип оплаты" group="kod_opl" />
        <column table="kod_link" column="remark" as="remark" title="Примечание по оплате" group="kod_opl" />
        <column table="kodbpol" column="bankpol_name" as="bankpol_name" group="kod_opl" />
        <column table="kod_deb" column="num_pl" as="num_pl" group="kod_sf" />
        <column table="kod_deb" column="dat_deb" as="dat_pl" group="kod_sf" />
        <column table="kod_sf" column="num_sf" as="num_sf" group="kod_sf" />
        <column table="kod_sf" column="dat_sf" as="dat_sf" group="kod_sf" />
        <column table="kod_sf" column="ym" as="ym_nach" group="kod_sf" />
        <column table="kod_sf" column="nachisl" as="nachisl_sf" group="kod_sf" />
        <column table="kod_opl_main" column="num_opl" group="kod_opl_main" />
        <column table="kod_opl_main" column="dat_opl" group="kod_opl_main" />
        <column table="kod_opl_master" column="num_sf" as="num_sf_opl" title="Номер СФ" group="kod_opl_master" />
        <column table="kod_opl_master" column="dat_opl" as="dat_sf_opl" title="Дата СФ" group="kod_opl_master" />
        <column table="kod_opl" column="ym" as="ym_opl" group="kod_opl" />
        <column table="kod_opl_main" column="dat_dog_edit" as="dat_dog_edit" group="kod_opl" />
        <column table="kod_opl_main" column="ym" as="ym_opl_main" group="kod_opl_main" />
        <column table="kod_opl_main" column="kod_vidopl" group="kod_opl_main" />
        <column table="kod_vidopl" column="full_name" as="vidopl_full_name" group="kod_opl_main" />
        <column table="nach_bef" column="nachisl" as="nachisl_bef" nvl="0" group="sum" title="" />
        <column table="opl_nach_bef" column="opl" as="opl_nach_bef" nvl="0" group="sum" title="" />
        <column table="nach_bef" column="nachisl_0" as="nachisl_0_bef" group="sum" title="" />
        <column table="opl_nach_bef" column="opl_0" as="opl_0_bef" group="sum" title="" />
        <column table="nach_bef" column="nachisl_2" as="nachisl_2_bef" group="sum" title="" />
        <column table="opl_nach_bef" column="opl_2" as="opl_2_bef" group="sum" title="" />
        <call function="-nvl" as="ostatok_beg" class-title="Сальдо на начало периода" title="Дебиторская задолженность, руб.">
          <column table="this" column="nachisl_bef" />
          <column table="this" column="opl_nach_bef" />
        </call>
        <call function="-nvl" as="ostatok_0_beg" class-title="Сальдо на начало периода" title="Задолженность аванса, руб.">
          <column table="this" column="nachisl_0_bef" />
          <column table="this" column="opl_0_bef" />
        </call>
        <call function="-nvl" as="ostatok_2_beg" class-title="Сальдо на начало периода" title="Задолженность основная реализация, руб.">
          <column table="this" column="nachisl_2_bef" />
          <column table="this" column="opl_2_bef" />
        </call>
        <column table="opl_kredit_bef" column="opl_kred" as="kredit_beg" class-title="Сальдо на начало периода" nvl="0" title="Кредиторская задолженность, руб." group="sum" />
        <column table="opl_kredit_bef" column="opl_kred_per_avans" as="kredit_per_beg" class-title="Сальдо на начало периода" group="sum" />
        <column table="opl_kredit_bef" column="opl_kred_avans_no_pros" as="kredit_avans_beg" class-title="Сальдо на начало периода" group="sum" />
        <column table="opl_kredit_bef" column="opl_kred_zadat" as="kredit_zadat_beg" class-title="Сальдо на начало периода" group="sum" />
        <column table="nach_bef" column="ym_dolg" group="min" />
        <column table="nach_period" column="ym_dolg" as="ym_dolg_per" group="min" />
        <column table="nach_period" column="nachisl" nvl="0" group="sum" />
        <column table="nach_period" column="nal" group="sum" />
        <column table="nach_period" column="nachisl_by_ym" group="sum" />
        <column table="nach_period" column="nachisl_0" group="sum" />
        <column table="nach_period" column="nachisl_2" group="sum" />
        <column table="nach_period" column="nachisl_0_30" group="sum" />
        <column table="nach_period" column="nachisl_0_40" group="sum" />
        <column table="nach_period" column="cust" group="sum" />
        <column table="nach_period" column="nachisl_by_vid_t" group="sum" />
        <column table="nach_period" column="cust_by_vid_t" group="sum" />
        <column table="nach_period" column="nachisl_by_edizm" group="sum" />
        <column table="nach_period" column="cust_by_edizm" group="sum" />
        <column table="nach_period" column="cust_teplo" nvl="0" group="sum" />
        <column table="nach_period" column="cust_teplo_by_ym" nvl="0" group="sum" />
        <column table="nach_period" column="cust_gvs" group="sum" />
        <column table="nach_period" column="cust_gvs_by_ym" group="sum" />
        <column table="nach_period" column="cust_teplo_kub" group="sum" />
        <column table="nach_period" column="cust_teplo_kub_by_ym" group="sum" />
        <column table="nach_period" column="cust_teplo_kub_u" group="sum" />
        <column table="nach_period" column="cust_teplo_kub_u_by_ym" group="sum" />
        <column table="nach_period" column="cust_teplo_c" group="sum" />
        <column table="nach_period" column="cust_teplo_c_by_ym" group="sum" />
        <column table="nach_period" column="cust_teplo_hv" group="sum" />
        <column table="nach_period" column="cust_teplo_hv_by_ym" group="sum" />
        <column table="opl_nach_period" column="opl" as="opl_nach" nvl="0" group="sum" title="Оплата начислений, руб." />
        <column table="opl_nach_period_nal" column="nal" as="opl_nal" nvl="0" group="sum" title="Оплата начислений (налог), руб." />
        <call function="-nvl" as="opl_nach_bn" title="Оплата начислений (без НДС), руб.">
          <column table="this" column="opl_nach" />
          <column table="this" column="opl_nal" />
        </call>
        <column table="opl_nach_period" column="opl_by_ym" as="opl_nach_by_ym" group="sum" title="Оплата начислений, руб." />
        <column table="opl_nach_period" column="opl_by_ym_bank" as="opl_nach_by_ym_bank" group="sum" title="Оплата начислений, руб." />
        <column table="opl_nach_period" column="opl_0" as="opl_0" group="sum" title="Оплата аванса, руб." />
        <column table="opl_nach_period" column="opl_0_30" group="sum" />
        <column table="opl_nach_period" column="opl_0_40" group="sum" />
        <column table="opl_nach_period" column="opl_2" group="sum" />
        <column table="opl_nach_period" column="opl_other" group="sum" />
        <column table="opl_nach_period" column="cust" as="opl_nach_cust" group="sum" />
        <column table="this" column="opl_nach_cust" as="opl_nach_cust_e3" title="Оплачено, нат. пок. квт">
          <if>
            <call function="in">
              <column table="this" column="vid_t" />
              <const>(22)</const>
            </call>
          </if>
        </column>
        <column table="this" column="opl_nach_cust" as="opl_nach_cust_e4" title="Оплачено, нат. пок. квт.ч">
          <if>
            <call function="not in">
              <column table="this" column="vid_t" />
              <const>(22,72)</const>
            </call>
          </if>
        </column>
        <column table="opl_period" column="opl" group="sum" />
        <column table="opl_period" column="oplf" group="sum" />
        <column table="opl_period" column="opl_fact_for_rks" group="sum" title="Оплата РКС" />
        <column table="opl_period" column="oplf_by_ym" group="sum" />
        <column table="opl_period" column="opl_per" group="sum" />
        <column table="opl_period" column="opl_storno_per" group="sum" />
        <column table="opl_period" column="opl_pfact_per" group="sum" />
        <column table="opl_period" column="opl_avans" group="sum" />
        <column table="opl_period" column="opl_pfact_avans" group="sum" />
        <column table="opl_period" column="opl_storno_avans" group="sum" />
        <column table="opl_period" column="opl_avans_per" group="sum" />
        <column table="opl_period" column="opl_per_av_no_fk" group="sum" />
        <column table="opl_period" column="opl_per_av_fk" group="sum" />
        <column table="opl_period" column="opl_storno_avans_per" group="sum" />
        <column table="opl_period" column="opl_pfact_avans_per" group="sum" />
        <column table="opl_period" column="opl_kred" as="kredit_per" group="sum" />
        <column table="opl_kor_period" column="korr_opl_av" as="kredit_per_kor" group="sum" />
        <column table="opl_period" column="opl_zadat" group="sum" />
        <column table="opl_period" column="opl_zadat_fk" group="sum" />
        <column table="opl_period" column="opl_storno_zadat" group="sum" />
        <column table="opl_period" column="opl_storno_fk_zadat" group="sum" />
        <column table="opl_period" column="opl_spisanie_zadat" group="sum" />
        <column table="opl_period" column="opl_spisanie_avans" group="sum" />
        <column table="opl_period" column="opl_vozvrat_avans" group="sum" />
        <column table="opl_period" column="opl_perenos_avans_fk" group="sum" />
        <column table="opl_period" column="opl_perenos_avans" group="sum" />
        <column table="opl_period" column="opl_zadat_2" group="sum" />
        <column table="opl_period" column="opl_zadat_fk_2" group="sum" />
        <column table="opl_period" column="opl_zadat_0" group="sum" />
        <column table="opl_period" column="opl_zadat_fk_0" group="sum" />
        <column table="opl_period" column="opl_pstorno_zadat1" group="sum" />
        <column table="opl_period" column="opl_fk_pstorno_zadat2" group="sum" />
        <column table="opl_period" column="opl_fk_pstorno_zadat0" group="sum" />
        <column table="opl_period" column="opl_kred_zadat" as="kredit_zadat_per" group="sum" />
        <column table="opl_period" column="opl_kred_per_avans" group="sum" />
        <column table="opl_period" column="opl_kred_avans_no_pros" group="sum" />
        <column table="opl_period" column="opl_bank" group="sum" />
        <call function="+nvl" as="ostatok_end" class-title="Сальдо на конец периода" title="Дебиторская задолженность, руб.">
          <column table="this" column="ostatok_beg" />
          <column table="this" column="ob_deb" />
        </call>
        <call function="+nvl" as="kredit_end" class-title="Сальдо на конец периода">
          <column table="this" column="kredit_beg" />
          <column table="this" column="kredit_per" />
        </call>
        <call function="+nvl" as="kredit_zadat_end" class-title="Сальдо на конец периода">
          <column table="this" column="kredit_zadat_beg" />
          <column table="this" column="kredit_zadat_per" />
        </call>
        <call function="+nvl" as="kredit_per_end" class-title="Сальдо на конец периода">
          <column table="this" column="kredit_per_beg" />
          <column table="this" column="opl_kred_per_avans" />
        </call>
        <call function="+nvl" as="kredit_avans_end" class-title="Сальдо на конец периода">
          <column table="this" column="kredit_avans_beg" />
          <column table="this" column="opl_kred_avans_no_pros" />
        </call>
        <call function="+nvl" as="ostatok_0_end" class-title="Сальдо на конец периода">
          <column table="this" column="ostatok_0_beg" />
          <call function="-nvl">
            <column table="this" column="nachisl_0" />
            <column table="this" column="opl_0" />
          </call>
        </call>
        <call function="over" as="oplf_sum_on_kod_opl_main">
          <call function="sum">
            <column table="this" column="oplf" />
          </call>
          <call function="partition by">
            <column table="this" column="kod_opl_main" />
          </call>
        </call>
        <call function="+nvl" as="opl_nach_pl_stor_av" class-title="Сальдо на конец периода" title="Оплата начислений (с учетом сторно авансов), руб.">
          <column table="this" column="opl_nach" />
          <column table="this" column="opl_storno_avans" />
        </call>
        <usepart part="fingen-cols-acc" />
        <usepart part="fingen-cols-acc-1" />
        <usepart part="fingen-cols-for-46" />
        <usepart part="fingen-cols-for-sections" />
        <column table="fingen_bu_akt" column="bu_akt_cnt" group="sum" />
        <column table="fingen_dog" column="dog_cnt" group="sum" />
      </select>
      <from>
        <query name="fingen_nach_period" as="nach_period" title="Начисления">
          <withparams>
            <useparam name="date1" />
            <useparam name="date2" />
            <useparam name="vidt_col" />
            <useparam name="edizm_col" />
          </withparams>
        </query>
        <query name="fingen_nach_period" as="nach_bef">
          <withparams>
            <call function="nativity" />
            <call function="-sec">
              <call function="nvlu">
                <useparam name="date1" />
                <call function="nativity" />
              </call>
            </call>
            <useparam name="vidt_col" />
            <useparam name="edizm_col" />
          </withparams>
        </query>
        <query name="fingen_opl_period" as="opl_period">
          <withparams>
            <useparam name="date1" />
            <useparam name="date2" />
            <useparam name="typeopl" />
            <useparam name="vidopl" />
          </withparams>
        </query>
        <query name="fingen_opl_nach_period" as="opl_nach_bef">
          <withparams>
            <call function="nativity" />
            <call function="-sec">
              <call function="nvlu">
                <useparam name="date1" />
                <call function="nativity" />
              </call>
            </call>
            <useparam name="typeopl" />
            <useparam name="vidopl" />
          </withparams>
        </query>
        <query name="fingen_opl_period" as="opl_kredit_bef">
          <withparams>
            <call function="nativity" />
            <call function="-sec">
              <call function="nvlu">
                <useparam name="date1" />
                <call function="nativity" />
              </call>
            </call>
            <useparam name="typeopl" />
            <useparam name="vidopl" />
          </withparams>
        </query>
        <query name="fingen_opl_nach_period" as="opl_nach_period">
          <withparams>
            <useparam name="date1" />
            <useparam name="date2" />
            <useparam name="typeopl" />
            <useparam name="vidopl" />
            <useparam name="typeopl_col" />
            <useparam name="vidopl_col" />
          </withparams>
        </query>
        <query name="fingen_opl_nach_period_nal" as="opl_nach_period_nal">
          <withparams>
            <useparam name="date1" />
            <useparam name="date2" />
            <useparam name="typeopl" />
            <useparam name="vidopl" />
            <useparam name="typeopl_col" />
            <useparam name="vidopl_col" />
          </withparams>
        </query>
        <query name="fingen_kor_saldo" as="opl_kor_period" />
        <query name="fingen_account" as="account_period" title="Предварительные начисления">
          <extendwhere>
            <usepart part="fingen-acc-cond" />
          </extendwhere>
        </query>
        <query name="fingen_account_nal" as="account_period_nal" title="Предварительные начисления">
          <extendwhere>
            <usepart part="fingen-acc-cond" />
          </extendwhere>
        </query>
        <query name="fingen_account_sost" as="account_period_sost" title="Предварительные начисления">
          <extendwhere>
            <usepart part="fingen-acc-cond" />
          </extendwhere>
        </query>
        <query name="fingen_account" as="account_period_bu" title="Предварительные начисления">
          <extendwhere>
            <usepart part="fingen-acc-cond-bu" />
          </extendwhere>
        </query>
        <query name="fingen_account_nal" as="account_period_nal_bu" title="Предварительные начисления">
          <extendwhere>
            <usepart part="fingen-acc-cond-bu" />
          </extendwhere>
        </query>
        <query name="fingen_account_sost" as="account_period_sost_bu" title="Предварительные начисления">
          <extendwhere>
            <usepart part="fingen-acc-cond-bu" />
          </extendwhere>
        </query>
        <query name="fingen_account" as="account_period_bu_np" title="Предварительные начисления">
          <extendwhere>
            <usepart part="fingen-acc-cond-bu-nepriz" />
          </extendwhere>
        </query>
        <query name="fingen_account_nal" as="account_period_nal_bu_np" title="Предварительные начисления">
          <extendwhere>
            <usepart part="fingen-acc-cond-bu-nepriz" />
          </extendwhere>
        </query>
        <query name="fingen_bu_akt" title="Предварительные начисления" />
        <query name="fingen_dog" title="Предварительные начисления" />
      </from>
      <push>
        <from>
          <query name="kr_dogovor" as="kod_dog" join="left outer">
            <using>
              <column column="kod_dog" />
            </using>
            <link name="dep" />
            <link name="kodp">
              <link name="kod_m" />
            </link>
            <link name="kod_vdog" />
            <link name="kod_ist" />
            <link name="kod_dog_fin" />
            <link name="kodp_uch" />
          </query>
          <query name="sk_nachisl" as="vid_t" join="left outer">
            <using>
              <column column="vid_t" />
            </using>
          </query>
          <query name="sk_vid_real" as="vid_real" join="left outer">
            <using>
              <column column="vid_real" />
            </using>
          </query>
          <query name="sr_opl" as="kod_opl" join="left outer">
            <using>
              <column column="kod_opl" />
            </using>
            <link name="kod_type_opl" />
            <link name="kod_link">
              <link name="kodbpol" />
            </link>
          </query>
          <query name="sr_opl" as="kod_opl_main" join="left outer">
            <call function="=">
              <column table="*" column="kod_opl_main" />
              <column table="kod_opl_main" column="kod_opl" />
            </call>
            <link name="kod_vidopl" as="kod_vidopl" />
          </query>
          <query name="sr_opl" as="kod_opl_master" join="left outer">
            <call function="=">
              <column table="*" column="kod_opl_master" />
              <column table="kod_opl_master" column="kod_opl" />
            </call>
          </query>
          <query name="sr_facvip" as="kod_sf" join="left outer">
            <using>
              <column column="kod_sf" />
            </using>
            <link name="kod_sf_text" as="kod_sf_text">
              <link name="kod_dopdoc" as="kr_dopdoc" />
            </link>
            <link name="vid_sf" as="vid_sf" />
            <link name="kod_deb" as="kod_deb" />
          </query>
          <query name="kr_dopdoc" as="kod_dopdoc" join="left outer">
            <call function="and">
              <call function="=">
                <column table="*" column="kod_dog" />
                <column table="kod_dopdoc" column="kod_dog" />
              </call>
            </call>
          </query>
          <query name="hr_bu_akt" as="kod_bu_akt" join="left outer">
            <using>
              <column column="kod_bu_akt" />
            </using>
          </query>
          <query name="hr_bu_akt" as="kod_bu_akt_main" join="left outer">
            <call function="and">
              <call function="=">
                <column table="*" column="kod_bu_akt_main" />
                <column table="kod_bu_akt_main" column="kod_bu_akt" />
              </call>
            </call>
          </query>
          <query name="kr_numobj" as="kod_numobj" join="left outer">
            <using>
              <column column="kod_numobj" />
            </using>
          </query>
          <query name="nr_account" as="kod_account" join="left outer">
            <using>
              <column column="kod_account" />
            </using>
          </query>
          <query name="kk_tarif_sost" join="left outer" as="tip_tarif_sost">
            <using>
              <column column="tip_tarif_sost" />
            </using>
          </query>
          <query name="nr_account_sost" as="kod_account_sost" join="left outer">
            <using>
              <column column="kod_account_sost" />
            </using>
          </query>
          <query name="ks_tarif" as="sost_tarif" join="left outer">
            <call function="=">
              <column table="*" column="sost_tarif" />
              <column table="sost_tarif" column="tarif" />
            </call>
          </query>
          <query name="kr_calc_list" as="ym" join="left outer">
            <using>
              <column column="ym" />
            </using>
          </query>
        </from>
        <where>
          <call function="and">
            <call function="true" />
            <call function="in" optional="1">
              <column table="*" column="kod_dog" />
              <useparam name="kod_dog" />
            </call>
            <call function="in" optional="1">
              <column table="vid_real" column="vid_real" />
              <useparam name="vid_real" />
            </call>
            <call function="in" optional="1">
              <column table="kod_vdog" column="kod_tipdog" />
              <useparam name="kod_tipdog" />
            </call>
            <call function="in" optional="1">
              <column table="vid_t" column="vid_t" />
              <useparam name="vid_t" />
            </call>
            <call function="in" optional="1">
              <column table="kod_dog" column="kod_dog_fin" />
              <useparam name="kod_dog_fin" />
            </call>
            <call function="in" optional="1">
              <column table="kod_dog_fin" column="dep" />
              <useparam name="dep_fin" />
            </call>
          </call>
        </where>
      </push>
    </query>
    <query name="fingen_nach_period" timestamp="13.03.2023 14:20:01">
      <params>
        <param name="date1">
          <const>sysdate-40</const>
        </param>
        <param name="date2">
          <const>sysdate</const>
        </param>
        <param name="vidt_col" />
        <param name="edizm_col" />
      </params>
      <select>
        <column table="a" column="vid_t" />
        <column table="a" column="rym" />
        <column table="kod_sf" column="ym" />
        <column table="kod_sf" column="kod_bu_akt" />
        <call function="nvl" as="kod_bu_akt_main">
          <column table="kod_sf_first" column="kod_bu_akt" />
          <column table="kod_sf" column="kod_bu_akt" />
        </call>
        <column table="a" column="kod_numobj" />
        <column table="a" column="edizm" />
        <column table="kod_sf" column="kod_dog" />
        <column table="kod_sf" column="vid_real" />
        <column table="kod_sf" column="kod_sf" />
        <column table="sr_facras_text" column="kod_account" />
        <const as="kod_opl">null</const>
        <const as="kod_opl_main">null</const>
        <const as="kod_opl_master">null</const>
        <call function="nvl0" as="nachisl">
          <column table="a" column="nachisl" />
        </call>
        <column table="a" column="nachisl" as="nachisl_by_ym" dimname="ym" />
        <column table="a" column="cust" />
        <column table="a" column="nachisl" as="nachisl_by_vid_t" dimname="vid_t">
          <pivot title=" по видам товара">
            <column table="a" column="vid_t" />
            <!--<column table="vid_t" column="full_name"/>-->
            <query order="full_name">
              <select>
                <column table="sk_nachisl" column="vid_t" />
                <column table="sk_nachisl" column="full_name" />
              </select>
              <from>
                <query name="sk_nachisl" as="sk_nachisl" />
              </from>
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="in" optional="1">
                    <column table="sk_nachisl" column="vid_t" />
                    <useparam name="vidt_col" />
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="cust" as="cust_by_vid_t" dimname="vid_t" />
        <column table="a" column="nachisl" as="nachisl_by_edizm" dimname="edizm">
          <pivot title=" по единицам измерения">
            <column table="a" column="edizm" />
            <!--<column table="edizm" column="name"/>-->
            <query order="name">
              <select>
                <column table="sk_edizm" column="edizm" />
                <column table="sk_edizm" column="name" />
              </select>
              <from>
                <query name="sk_edizm" as="sk_edizm" />
              </from>
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="in" optional="1">
                    <column table="sk_edizm" column="edizm" />
                    <useparam name="edizm_col" />
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="cust" as="cust_by_edizm" dimname="edizm" />
        <call function="-" as="nachisl_not_nal" title="Начислено, руб.  (без налогов)">
          <column table="a" column="nachisl" />
          <column table="a" column="nal" />
        </call>
        <column table="a" column="nal" title="Начислено, руб  (налоги)" />
        <call function="if" as="nachisl_0" title="Начислено авансов, руб">
          <call function="and">
            <call function="=">
              <column table="kod_sf" column="vid_real" />
              <const>0</const>
            </call>
            <call function="le" optional="1">
              <useparam name="date2" />
              <call function="nvl">
                <column table="kod_sf" column="dat_ezad" />
                <useparam name="date2" />
              </call>
            </call>
          </call>
          <column table="a" column="nachisl" />
          <const>0</const>
        </call>
        <call function="if" as="nachisl_0_30" title="Начислено авансов 30%, руб">
          <call function="=">
            <column table="kod_av" column="perc" />
            <const>30</const>
          </call>
          <column table="this" column="nachisl_0" />
        </call>
        <call function="if" as="nachisl_0_40" title="Начислено авансов 40%, руб">
          <call function="=">
            <column table="kod_av" column="perc" />
            <const>40</const>
          </call>
          <column table="this" column="nachisl_0" />
        </call>
        <call function="if" as="nachisl_2" title="Начислено основная реализация, руб">
          <call function="and">
            <call function="=">
              <column table="kod_sf" column="vid_real" />
              <const>2</const>
            </call>
          </call>
          <column table="a" column="nachisl" />
          <const>0</const>
        </call>
        <!--cust для тепла по видам товаров-->
        <column table="a" column="cust_teplo" />
        <column table="a" column="cust_teplo" as="cust_teplo_by_ym" dimname="ym">
          <pivot title=" по периодам ">
            <column table="kod_sf" column="ym" group="1" />
            <query order="ym">
              <select>
                <column table="ym_list" column="ym" />
                <column table="ym_list" column="name" />
              </select>
              <from>
                <query name="kr_calc_list" as="ym_list" />
              </from>
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="between" optional="1">
                    <column table="ym_list" column="ym" />
                    <call function="date to ym">
                      <useparam name="date1" />
                    </call>
                    <call function="date to ym">
                      <useparam name="date2" />
                    </call>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="cust_gvs" />
        <column table="a" column="cust_gvs" as="cust_gvs_by_ym" dimname="ym" />
        <column table="a" column="cust_teplo_kub" />
        <column table="a" column="cust_teplo_kub" as="cust_teplo_kub_by_ym" dimname="ym" />
        <column table="a" column="cust_teplo_kub_u" />
        <column table="a" column="cust_teplo_kub_u" as="cust_teplo_kub_u_by_ym" dimname="ym" />
        <column table="a" column="cust_teplo_c" />
        <column table="a" column="cust_teplo_c" as="cust_teplo_c_by_ym" dimname="ym" />
        <column table="a" column="cust_teplo_hv" />
        <column table="a" column="cust_teplo_hv" as="cust_teplo_hv_by_ym" dimname="ym" />
        <call function="if" as="ym_dolg" title="Период долгового счета" type="number">
          <call function="gt">
            <!--переделать чтобы не вызывался sr_facvip(date)-->
            <column table="sr_facvip_date" column="ostatok_full" />
            <const>0</const>
          </call>
          <column table="kod_sf" column="ym" />
        </call>
      </select>
      <from>
        <query name="sr_facras" as="a">
          <slink name="sr_facras_text">
            <link name="kod_av" />
          </slink>
          <link name="kod_sf">
            <!--переделать чтобы не вызывался sr_facvip(date)-->
            <slink name="sr_facvip(date)" as="sr_facvip_date">
              <withparams>
                <useparam name="date2" />
              </withparams>
            </slink>
            <link name="kod_sf_first" />
          </link>
          <link name="vid_t_teplo" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="is not null">
            <column table="this" column="kod_sf" />
          </call>
          <call function="ge" optional="1">
            <column table="kod_sf" column="ym" />
            <call function="date to ym">
              <useparam name="date1" />
            </call>
          </call>
          <call function="le" optional="1">
            <column table="kod_sf" column="ym" />
            <call function="date to ym">
              <useparam name="date2" />
            </call>
          </call>
          <!--<call function="between" optional="1">
            <column table="kod_sf" column="dat_sf"/>
            <useparam name="date1"/>
            <useparam name="date2"/>
          </call>-->
        </call>
      </where>
    </query>
    <!--<array>162,270,297,401,775,834,1009,1039,1771,2021,10010863,10019549</array>-->
    <query name="fingen_opl_nach_period" title="Оплата" timestamp="19.04.2020 17:14:34">
      <params>
        <param name="date1" />
        <param name="date2" />
        <param name="typeopl" />
        <param name="vidopl" />
        <param name="typeopl_col" />
        <param name="vidopl_col" />
      </params>
      <select>
        <!--<column table="a" column="kod_ras" group="1"/>-->
        <!--<column table="o" column="kod_vidopl" group="1"/>-->
        <column table="kod_opl" column="kod_dog" />
        <column table="kod_opl" column="ym" exclude="1" />
        <!--<column table="kod_opl" column="ym" as="ym_opl" />-->
        <column table="kod_sf" column="kod_sf" />
        <column table="kod_sf" column="kod_bu_akt" />
        <call function="nvl" as="kod_bu_akt_main">
          <column table="kod_sf_first" column="kod_bu_akt" />
          <column table="kod_sf" column="kod_bu_akt" />
        </call>
        <column table="kod_ras" column="vid_t" />
        <column table="kod_ras" column="edizm" />
        <column table="kod_ras" column="rym" />
        <column table="kod_ras" column="kod_numobj" />
        <column table="kod_sf" column="vid_real" />
        <column table="sr_facras_text" column="kod_account" />
        <column table="kod_opl" column="kod_opl" />
        <call function="nvl" as="kod_opl_main">
          <column table="kod_opl" column="kod_parent" />
          <column table="kod_opl" column="kod_opl" />
        </call>
        <const as="kod_opl_master">null</const>
        <column table="kod_opl" column="num_opl" />
        <column table="kod_opl" column="dat_opl" />
        <column column="ym" table="kod_opl" />
        <column table="a" column="opl" title="Оплачено, руб." />
        <column table="a" column="opl" as="opl_by_ym" dimname="ym">
          <pivot title=" по периодам ">
            <column table="kod_opl" column="ym" group="1" />
            <query order="ym">
              <select>
                <column table="ym_list" column="ym" />
                <column table="ym_list" column="name" />
              </select>
              <from>
                <query name="kr_calc_list" as="ym_list" />
              </from>
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="between" optional="1">
                    <column table="ym_list" column="ym" />
                    <call function="date to ym">
                      <useparam name="date1" />
                    </call>
                    <call function="date to ym">
                      <useparam name="date2" />
                    </call>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="opl" as="opl_by_ym_bank" dimname="ym_opl">
          <pivot title=" по периодам ">
            <column table="kod_opl" column="ym_bank" group="1" />
            <query order="ym">
              <select>
                <column table="ym_list" column="ym" />
                <column table="ym_list" column="name" />
              </select>
              <from>
                <query name="kr_calc_list" as="ym_list" />
              </from>
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="between" optional="1">
                    <column table="ym_list" column="ym" />
                    <call function="date to ym">
                      <useparam name="date1" />
                    </call>
                    <call function="date to ym">
                      <useparam name="date2" />
                    </call>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="nal" title="Оплачено, руб. (налоги)" />
        <call function="-" as="opl_not_nal" title="Оплачено, руб. (без налогов)">
          <column table="a" column="opl" />
          <column table="a" column="nal" />
        </call>
        <column table="a" column="cust" title="Оплачено, нат. пок." />
        <call function="if" as="opl_0" title="Оплачено авансов, руб.">
          <call function="and">
            <call function="in">
              <column table="kod_sf" column="vid_real" />
              <array>0</array>
            </call>
            <call function="or">
              <call function="is null">
                <column table="kod_sf" column="dat_ezad" />
              </call>
              <call function="le" optional="1">
                <useparam name="date2" />
                <column table="kod_sf" column="dat_ezad" />
              </call>
            </call>
          </call>
          <column table="a" column="opl" />
        </call>
        <call function="if" as="opl_0_30" title="Оплачено авансов 30%, руб">
          <call function="=">
            <column table="kod_av" column="perc" />
            <const>30</const>
          </call>
          <column table="this" column="opl_0" />
        </call>
        <call function="if" as="opl_0_40" title="Оплачено авансов 40%, руб">
          <call function="=">
            <column table="kod_av" column="perc" />
            <const>40</const>
          </call>
          <column table="this" column="opl_0" />
        </call>
        <call function="if" as="opl_2" title="Оплачено основная реализация, руб.">
          <call function="and">
            <call function="=">
              <column table="kod_sf" column="vid_real" />
              <const>2</const>
            </call>
          </call>
          <column table="a" column="opl" />
        </call>
        <call function="if" as="opl_other" title="Оплачено другие виды реализации, руб.">
          <call function="and">
            <call function="not in">
              <column table="kod_sf" column="vid_real" />
              <array>0,2</array>
            </call>
          </call>
          <column table="a" column="opl" />
        </call>
        <!--разложение не проверял-->
        <column table="a" column="opl" as="opl_by_typeopl" dimname="kod_type_opl">
          <pivot title=" по типам оплат">
            <column table="kod_opl" column="kod_type_opl" />
            <query order="name">
              <select>
                <column table="sk_type_opl" column="kod_type_opl" />
                <column table="sk_type_opl" column="name" />
              </select>
              <from>
                <query name="sk_type_opl" as="sk_type_opl" />
              </from>
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="in" optional="1">
                    <column table="sk_type_opl" column="kod_type_opl" />
                    <useparam name="typeopl_col" />
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="opl" as="opl_by_vidopl" dimname="kod_vidopl">
          <pivot title=" по видам оплат">
            <column table="kod_opl" column="kod_vidopl" />
            <query order="full_name">
              <select>
                <column table="ss_vidopl" column="kod_vidopl" />
                <column table="ss_vidopl" column="full_name" />
              </select>
              <from>
                <query name="ss_vidopl" as="ss_vidopl" />
              </from>
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="in" optional="1">
                    <column table="ss_vidopl" column="kod_vidopl" />
                    <useparam name="vidopl_col" />
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
      </select>
      <from>
        <query name="sr_facopl" as="a">
          <link name="kod_opl" />
          <link name="kod_ras">
            <slink name="sr_facras_text">
              <link name="kod_av" />
            </slink>
            <link name="kod_sf">
              <link name="kod_sf_first" />
            </link>
          </link>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="ge" optional="1">
            <column table="kod_opl" column="dat_oper" />
            <useparam name="date1" />
          </call>
          <call function="le" optional="1">
            <column table="kod_opl" column="dat_oper" />
            <useparam name="date2" />
          </call>
          <call function="in" optional="1">
            <column table="kod_opl" column="kod_type_opl" />
            <useparam name="typeopl" />
          </call>
          <call function="in" optional="1">
            <column table="kod_opl" column="kod_vidopl" />
            <useparam name="vidopl" />
          </call>
        </call>
      </where>
    </query>
    <query name="fingen_opl_nach_period_nal" title="Оплата">
      <params>
        <param name="date1"></param>
        <param name="date2"></param>
        <param name="typeopl"></param>
        <param name="vidopl"></param>
        <param name="typeopl_col"></param>
        <param name="vidopl_col"></param>
      </params>
      <select>
        <column table="kod_opl" column="kod_dog" />
        <column table="kod_opl" column="ym" />
        <column table="kod_sf" column="kod_sf" />
        <column table="kod_sf" column="kod_bu_akt" />
        <call function="nvl" as="kod_bu_akt_main">
          <column table="kod_sf_first" column="kod_bu_akt" />
          <column table="kod_sf" column="kod_bu_akt" />
        </call>
        <column table="kod_ras" column="vid_t" />
        <column table="kod_ras" column="edizm" />
        <column table="kod_ras" column="rym" />
        <column table="kod_ras" column="kod_numobj" />
        <column table="kod_sf" column="vid_real" />
        <column table="sr_facras_text" column="kod_account" />
        <column table="kod_opl" column="kod_opl" />
        <call function="nvl" as="kod_opl_main">
          <column table="kod_opl" column="kod_parent" />
          <column table="kod_opl" column="kod_opl" />
        </call>
        <const as="kod_opl_master">null</const>
        <column table="kod_opl" column="num_opl" />
        <column table="kod_opl" column="dat_opl" />
        <column table="kod_opl" column="ym" />
        <column table="a" column="nal" title="Оплачено, руб. (налоги)" />
      </select>
      <from>
        <query name="sr_facopl_nal" as="a">
          <link name="kod_fopl">
            <link name="kod_opl"></link>
            <link name="kod_ras">
              <slink name="sr_facras_text">
                <link name="kod_av" />
              </slink>
              <link name="kod_sf">
                <link name="kod_sf_first" />
              </link>
            </link>
          </link>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="ge" optional="1">
            <column table="kod_opl" column="dat_oper" />
            <useparam name="date1" />
          </call>
          <call function="le" optional="1">
            <column table="kod_opl" column="dat_oper" />
            <useparam name="date2" />
          </call>
          <call function="in" optional="1">
            <column table="kod_opl" column="kod_type_opl" />
            <useparam name="typeopl" />
          </call>
          <call function="in" optional="1">
            <column table="kod_opl" column="kod_vidopl" />
            <useparam name="vidopl" />
          </call>
        </call>
      </where>
    </query>
    <query name="fingen_opl_period" title="Оплата" timestamp="25.03.2024 15:57:01">
      <params>
        <param name="date1">
          <const>sysdate-931</const>
        </param>
        <param name="date2">
          <const>sysdate-931</const>
        </param>
        <param name="typeopl" />
        <param name="vidopl" />
      </params>
      <select>
        <column table="kod_opl" column="kod_dog" />
        <column table="kod_opl" column="ym" />
        <column table="kod_opl_master1" column="dat_opl" as="dat_vozn" />
        <column table="kod_opl_master2" column="dat_opl" as="dat_vozn2" comment="Для Татэнерго см. 67565 обсужд. от 2023-05-06 и далее " />
        <const as="vid_t">null</const>
        <const as="edizm">null</const>
        <const as="kod_numobj">null</const>
        <column table="kod_opl" column="kod_opl" />
        <call function="nvl" as="kod_opl_main">
          <column table="kod_opl" column="kod_parent" />
          <column table="kod_opl" column="kod_opl" />
        </call>
        <column table="kod_recalc1" column="kod_opl" as="kod_opl_ish" />
        <call function="nvl" as="kod_opl_master2">
          <call type="" function="if">
            <call function="=">
              <column table="kod_opl" column="kod_dog" />
              <column table="ish_opl" column="kod_dog" />
            </call>
            <column table="this" column="kod_opl_ish" as="" type="" />
            <column table="this" column="kod_opl_main" />
          </call>
          <column table="this" column="kod_opl_main" />
        </call>
        <call function="nvl" as="kod_opl_master">
          <column table="this" column="kod_opl_ish" />
          <column table="this" column="kod_opl_main" />
        </call>
        <column table="sr_recalc_opl" column="pr_hand" as="pr_raznos" />
        <column table="kod_opl" column="kod_sf" />
        <column table="kod_sf" column="kod_bu_akt" />
        <call function="nvl" as="kod_bu_akt_main">
          <column table="kod_sf_first" column="kod_bu_akt" />
          <column table="kod_sf" column="kod_bu_akt" />
        </call>
        <!--Наверное нужно завести 2 разные колонки vid_real, одна будет показывать (opl.vid_real)  а другая 2-ку по авансам и переплатам чтобы аванс садился в кредит по основной-->
        <call function="if" as="vid_real">
          <call function="=">
            <column table="kod_opl" column="vid_real" />
            <const>0</const>
          </call>
          <const>2</const>
          <column table="kod_opl" column="vid_real" />
        </call>
        <!--<column table="kod_opl" column="vid_real" />-->
        <column table="kod_opl" column="opl" />
        <column table="kod_opl" column="oplf" title="Сумма оплаты" />
        <column table="kod_opl" column="oplf" as="oplf_by_ym" title="Сумма оплаты" dimname="ym_opl">
          <pivot title=" по периодам ">
            <column table="kod_opl" column="ym" group="1" />
            <query order="ym">
              <select>
                <column table="ym_list" column="ym" />
                <column table="ym_list" column="name" />
              </select>
              <from>
                <query name="kr_calc_list" as="ym_list" />
              </from>
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="between" optional="1">
                    <column table="ym_list" column="ym" />
                    <call function="date to ym">
                      <useparam name="date1" />
                    </call>
                    <call function="date to ym">
                      <useparam name="date2" />
                    </call>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <call function="if" as="opl_per" title="Переплата, руб.">
          <call function="=">
            <column table="kod_opl" column="kod_type_opl" />
            <const>1</const>
          </call>
          <column table="this" column="opl" />
        </call>
        <call function="if" as="opl_fact_for_rks" title="Переплата, руб.">
          <call function="in">
            <column table="kod_opl" column="kod_type_opl" />
            <const type="number">(0,3,4)</const>
          </call>
          <column table="this" column="oplf" />
        </call>
        <call function="if" as="opl_pfact_per" title="Погашение факта переплатой, руб.">
          <call function="=">
            <column table="kod_opl" column="kod_type_opl" />
            <const>3</const>
          </call>
          <column table="this" column="opl" />
        </call>
        <call function="if" as="opl_storno_per" title="Сторно переплаты, руб.">
          <call function="=">
            <column table="kod_opl" column="kod_type_opl" />
            <const>5</const>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_avans" title="Аванс, руб.">
          <call function="=">
            <column table="kod_opl" column="kod_type_opl" />
            <const>2</const>
          </call>
          <column table="this" column="opl" />
        </call>
        <call function="if" as="opl_avans_as_per" title="Аванс как переплата, руб.">
          <call function="and">
            <call function="=">
              <column table="kod_opl" column="kod_type_opl" />
              <const>2</const>
            </call>
            <call function="and">
              <call function="is not null">
                <column table="kod_sf" column="dat_ezad" />
              </call>
              <call function="ge" optional="1">
                <useparam name="date2" />
                <column table="kod_sf" column="dat_ezad" />
                <!--<call function="nvl">
                <column table="kod_sf" column="dat_ezad"/>
                <call function="date add days">
                  <useparam name="date2"/>
                  <const>1</const>
                </call>
              </call>-->
              </call>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
          <const>0</const>
        </call>
        <call function="if" as="opl_pfact_avans" title="Погашение факта авансом, руб.">
          <call function="=">
            <column table="kod_opl" column="kod_type_opl" />
            <const>4</const>
          </call>
          <column table="this" column="opl" />
        </call>
        <call function="if" as="opl_storno_avans" title="Сторно аванса, руб.">
          <call function="=">
            <column table="kod_opl" column="kod_type_opl" />
            <const>6</const>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_storno_avans_as_per" title="Сторно аванса как переплата, руб.">
          <call function="and">
            <call function="=">
              <column table="kod_opl" column="kod_type_opl" />
              <const>6</const>
            </call>
            <call function="and">
              <call function="is not null">
                <column table="kod_sf" column="dat_ezad" />
              </call>
              <call function="ge" optional="1">
                <useparam name="date2" />
                <column table="kod_sf" column="dat_ezad" />
              </call>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="+" as="opl_storno_avans_per" title="Сторно переплаты и аванса, руб.">
          <column table="this" column="opl_storno_per" />
          <column table="this" column="opl_storno_avans" />
        </call>
        <call function="+" as="opl_pfact_avans_per" title="Погашение факта переплатой и авансом, руб.">
          <column table="this" column="opl_pfact_per" />
          <column table="this" column="opl_pfact_avans" />
        </call>
        <call function="+" as="opl_avans_per" title="Переплата и аванс, руб.">
          <column table="this" column="opl_per" />
          <column table="this" column="opl_avans" />
        </call>
        <call function="if" as="opl_per_av_no_fk" title="Переплата аванс за месяц без учета ФК">
          <call function="and">
            <call function="or">
              <call function="is null">
                <column table="kod_opl_master" column="kod_opl" />
              </call>
              <call function="is null">
                <column table="this" column="pr_raznos" />
              </call>
            </call>
            <call function="in">
              <column table="kod_opl" column="kod_type_opl" />
              <array>1,2</array>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_per_av_fk" title="Переплата аванс за месяц ФК (+)">
          <call function="and">
            <call function="=1">
              <column table="this" column="pr_raznos" />
            </call>
            <call function="is not null">
              <column table="kod_opl_master" column="kod_opl" />
            </call>
            <call function="in">
              <column table="kod_opl" column="kod_type_opl" />
              <array>1,2</array>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_kred" title="Кредит, руб.">
          <call function="in">
            <column table="kod_opl" column="kod_type_opl" />
            <array>1,2,5,6</array>
          </call>
          <call function="+nvl">
            <column table="this" column="opl" />
            <column table="kod_opl" column="opls" />
          </call>
        </call>
        <call function="if" as="opl_perenos_avans" title="ФК как перенос аванса, руб." exclude="1">
          <call function="and">
            <call function="=">
              <column table="kod_recalc" column="vid_recalc" />
              <const>1</const>
            </call>
            <call function="=" exclude="1">
              <column table="this" column="pr_raznos" />
              <const>0</const>
            </call>
            <call function="in">
              <column table="kod_opl" column="kod_type_opl" />
              <array>1,2,5,6</array>
            </call>
            <call function="!=nvl">
              <column table="kod_opl" column="kod_dog" />
              <column table="kod_opl_master" column="kod_dog" />
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_bank" title="Оплата по банку, руб.">
          <call function="in">
            <column table="kod_opl" column="kod_type_opl" />
            <array>0,1,2</array>
          </call>
          <column table="this" column="opl" />
        </call>
        <call function="+" as="opl_kred_per" title="Кредит переплата, руб.">
          <column table="this" column="opl_per" />
          <column table="this" column="opl_storno_per" />
        </call>
        <call function="+" as="opl_kred_per_avans" title="Кредит переплата и авансы прошлых периодов, руб.">
          <column table="this" column="opl_per" />
          <column table="this" column="opl_storno_per" />
          <column table="this" column="opl_avans_as_per" />
          <column table="this" column="opl_storno_avans_as_per" />
        </call>
        <call function="+" as="opl_kred_avans" title="Кредит аванса, руб.">
          <column table="this" column="opl_avans" />
          <column table="this" column="opl_storno_avans" />
        </call>
        <call function="-" as="opl_kred_avans_no_pros" title="Кредит аванса без авансов прошлых периодов, руб.">
          <column table="this" column="opl_kred_avans" />
          <column table="this" column="opl_avans_as_per" />
          <column table="this" column="opl_storno_avans_as_per" />
        </call>
        <!--Задаток-->
        <call function="if" as="opl_zadat" title="Задаток, руб.">
          <call function="and">
            <call function="=">
              <column table="kod_opl" column="kod_type_opl" />
              <const>2</const>
            </call>
            <call function="=">
              <column table="kod_opl" column="vid_real" />
              <const>1</const>
            </call>
            <call function="gt">
              <column table="this" column="opl" />
              <const>0</const>
            </call>
          </call>
          <column table="this" column="opl" />
        </call>
        <call function="if" as="opl_storno_zadat" title="Сторно задатка, руб.">
          <call function="and">
            <call function="=">
              <column table="kod_opl" column="kod_type_opl" />
              <const>6</const>
            </call>
            <call function="=">
              <column table="kod_opl" column="vid_real" />
              <const>1</const>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_storno_fk_zadat" title="ФК как сторно задатка, руб.">
          <call function="and">
            <call function="=">
              <column table="this" column="pr_raznos" />
              <const>0</const>
            </call>
            <call function="!=">
              <column table="kod_recalc" column="vid_recalc" />
              <const>-1</const>
            </call>
            <call function="=">
              <column table="kod_opl_master" column="vid_real" />
              <const>1</const>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_spisanie_zadat" title="ФК как списание задатка, руб.">
          <call function="and">
            <call function="=">
              <column table="kod_recalc" column="vid_recalc" />
              <const>-1</const>
            </call>
            <call function="=">
              <column table="this" column="pr_raznos" />
              <const>0</const>
            </call>
            <call function="=">
              <column table="kod_opl_master" column="vid_real" />
              <const>1</const>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_spisanie_avans" title="ФК как списание аванса, руб.">
          <call function="and">
            <call function="=">
              <column table="kod_recalc" column="vid_recalc" />
              <const>-1</const>
            </call>
            <call function="=">
              <column table="this" column="pr_raznos" />
              <const>0</const>
            </call>
            <call function="in">
              <column table="kod_opl_master" column="kod_type_opl" />
              <array>1,2,5,6</array>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_perenos_avans_fk" title="ФК как перенос аванса, руб.">
          <call function="and">
            <call function="in">
              <column table="kod_recalc" column="vid_recalc" />
              <array>-2,1</array>
            </call>
            <call function="=">
              <column table="this" column="pr_raznos" />
              <const>0</const>
            </call>
            <call function="in">
              <column table="kod_opl_master" column="kod_type_opl" />
              <array>1,2,5,6</array>
            </call>
            <call function="in">
              <column table="kod_opl" column="kod_type_opl" />
              <array>1,2</array>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_perenos_avans" title="ФК как перенос аванса, руб.">
          <call function="and">
            <call function="=">
              <column table="kod_recalc" column="vid_recalc" />
              <const>1</const>
            </call>
            <call function="=" exclude="1">
              <column table="this" column="pr_raznos" />
              <const>0</const>
            </call>
            <call function="in">
              <column table="kod_opl_master" column="kod_type_opl" />
              <array>1,2,5,6</array>
            </call>
            <call function="in">
              <column table="kod_opl" column="kod_type_opl" />
              <array>1,2</array>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_vozvrat_avans" title="ФК как возврат аванса, руб.">
          <call function="and">
            <call function="in">
              <column table="kod_recalc" column="vid_recalc" />
              <array>2,17</array>
            </call>
            <call function="=">
              <column table="this" column="pr_raznos" />
              <const>0</const>
            </call>
            <call function="in">
              <column table="kod_opl_master" column="kod_type_opl" />
              <array>1,2,5,6</array>
            </call>
            <call function="in">
              <column table="kod_opl" column="kod_type_opl" />
              <array>1,2,5,6</array>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_zadat_2" title="Задаток на основную реализацию, руб.">
          <call function="and">
            <call function="=">
              <column table="this" column="pr_raznos" />
              <const>1</const>
            </call>
            <call function="=">
              <column table="kod_opl" column="vid_real" />
              <const>2</const>
            </call>
            <call function="=">
              <column table="kod_opl_master" column="vid_real" />
              <const>1</const>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_zadat_0" title="Задаток на аванс, руб.">
          <call function="and">
            <call function="=">
              <column table="this" column="pr_raznos" />
              <const>1</const>
            </call>
            <call function="=">
              <column table="kod_opl" column="vid_real" />
              <const>0</const>
            </call>
            <call function="=">
              <column table="kod_opl_master" column="vid_real" />
              <const>1</const>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_zadat_fk" title="Финансовая корректировка задатка, руб.">
          <call function="and">
            <call function="=">
              <column table="this" column="pr_raznos" />
              <const>0</const>
            </call>
            <call function="=">
              <column table="kod_opl_master" column="vid_real" />
              <const>1</const>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_zadat_fk_2" title="Финансовая корректировка задатка на осн.реализацию, руб.">
          <call function="and">
            <call function="=">
              <column table="this" column="pr_raznos" />
              <const>0</const>
            </call>
            <call function="=">
              <column table="kod_opl" column="vid_real" />
              <const>2</const>
            </call>
            <call function="=">
              <column table="kod_opl_master" column="vid_real" />
              <const>1</const>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" as="opl_zadat_fk_0" title="Финансовая корректировка задатка на аванс, руб.">
          <call function="and">
            <call function="=">
              <column table="this" column="pr_raznos" />
              <const>0</const>
            </call>
            <call function="=">
              <column table="kod_opl" column="vid_real" />
              <const>0</const>
            </call>
            <call function="=">
              <column table="kod_opl_master" column="vid_real" />
              <const>1</const>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="+" as="opl_kred_zadat" title="Кредит задатка, руб.">
          <column table="this" column="opl_zadat" />
          <column table="this" column="opl_storno_zadat" />
          <column table="this" column="opl_zadat_fk" />
        </call>
        <call function="if" title="Сторно задатка, руб." as="opl_storno_zadat1">
          <call function="and">
            <call function="=">
              <column table="kod_parent" column="vid_real" />
              <const>1</const>
            </call>
            <call function="in">
              <column table="kod_opl" column="kod_type_opl" />
              <array>5,6</array>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" title="Погашение сторно задатка, руб." as="opl_pstorno_zadat1">
          <call function="and">
            <call function="=">
              <column table="kod_parent" column="vid_real" />
              <const>1</const>
            </call>
            <call function="in">
              <column table="kod_opl" column="kod_type_opl" />
              <array>3,4</array>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" title="ФК сторно задатка, руб." as="opl_fk_storno_zadat1">
          <call function="and">
            <call function="=">
              <column table="kod_opl_master" column="vid_real" />
              <const>1</const>
            </call>
            <call function="!=">
              <column table="kod_recalc" column="vid_recalc" />
              <const>-1</const>
            </call>
            <call function="in">
              <column table="this" column="pr_raznos" />
              <array>0</array>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" title="ФК сторно задатка на основную реализацию, руб." as="opl_fk_pstorno_zadat2">
          <call function="and">
            <call function="=">
              <column table="kod_opl_master" column="vid_real" />
              <const>1</const>
            </call>
            <call function="!=">
              <column table="kod_recalc" column="vid_recalc" />
              <const>-1</const>
            </call>
            <call function="in">
              <column table="this" column="pr_raznos" />
              <array>1</array>
            </call>
            <call function="=">
              <column table="kod_opl" column="vid_real" />
              <const>2</const>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
        <call function="if" title="ФК сторно задатка на аванс, руб." as="opl_fk_pstorno_zadat0">
          <call function="and">
            <call function="=">
              <column table="kod_opl_master" column="vid_real" />
              <const>1</const>
            </call>
            <call function="!=">
              <column table="kod_recalc" column="vid_recalc" />
              <const>-1</const>
            </call>
            <call function="in">
              <column table="this" column="pr_raznos" />
              <array>1</array>
            </call>
            <call function="=">
              <column table="kod_opl" column="vid_real" />
              <const>0</const>
            </call>
          </call>
          <column table="kod_opl" column="oplf" />
        </call>
      </select>
      <from>
        <query name="sr_opl" as="kod_opl">
          <link name="kod_sf">
            <link name="kod_sf_first" />
          </link>
          <link name="kod_parent" />
          <link name="kod_opl_main">
            <link name="kod_recalc" as="kod_recalc1">
              <link name="kod_opl" as="ish_opl" />
            </link>
          </link>
          <slink name="sr_recalc_opl" as="sr_recalc_opl">
            <link name="kod_recalc">
              <link name="kod_opl" as="kod_opl_master" />
            </link>
          </slink>
        </query>
        <query as="kod_opl_master1" name="sr_opl" join="left outer">
          <call function="=">
            <column table="this" column="kod_opl_master" />
            <column table="kod_opl_master1" column="kod_opl" />
          </call>
        </query>
        <query as="kod_opl_master2" name="sr_opl" join="left outer">
          <call function="=">
            <column table="this" column="kod_opl_master2" />
            <column table="kod_opl_master2" column="kod_opl" />
          </call>
        </query>
        <!--<query name="sr_opl" as ="kod_opl_master2" join="left outer">
          <call function="=">
            <column table="this" column="kod_opl_master"/>
            <column table="kod_opl_master2" column="kod_opl"/>
          </call>
        </query>-->
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="ge" optional="1">
            <column table="kod_opl" column="ym" />
            <call function="date to ym">
              <useparam name="date1" />
            </call>
          </call>
          <call function="le" optional="1">
            <column table="kod_opl" column="ym" />
            <call function="date to ym">
              <useparam name="date2" />
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_opl" column="kod_type_opl" />
            <useparam name="typeopl" />
          </call>
          <call function="in" optional="1">
            <column table="kod_opl" column="kod_vidopl" />
            <useparam name="vidopl" />
          </call>
        </call>
      </where>
    </query>
    <query name="fingen_account">
      <select>
        <column table="a" column="ym" />
        <column table="a" column="kod_dog" />
        <column table="kod_ras" column="kod_sf" />
        <column table="a" column="kod_numobj" />
        <column table="a" column="kod_account" />
        <column table="a" column="vid_t" />
        <column table="vid_t" column="vid_real" />
        <column table="vid_t" column="edizm" />
        <column table="a" column="kod_bu_akt" />
        <call function="nvl" as="kod_bu_akt_main">
          <column table="kod_account_parent" column="kod_bu_akt" />
          <column table="a" column="kod_bu_akt" />
        </call>
        <column table="a" column="nachisl" />
        <column table="a" column="cust" />
        <column table="a" column="tarif2" />
      </select>
      <from>
        <query name="nr_account" as="a">
          <link name="kod_account_parent" />
          <link name="vid_t" />
          <link name="kod_bu_akt" />
          <link name="kod_ras" />
        </query>
      </from>
    </query>
    <query name="fingen_account_nal">
      <select>
        <column table="a" column="ym" />
        <column table="a" column="kod_numobj" />
        <column table="a" column="kod_account" />
        <column table="a" column="vid_t" />
        <column table="vid_t" column="edizm" />
        <column table="vid_t" column="vid_real" />
        <column table="a" column="kod_dog" />
        <column table="kod_ras" column="kod_sf" />
        <column table="a" column="kod_bu_akt" />
        <call function="nvl" as="kod_bu_akt_main">
          <column table="kod_account_parent" column="kod_bu_akt" />
          <column table="a" column="kod_bu_akt" />
        </call>
        <column table="nr_account_nal" column="nal" />
        <column table="a" column="tarif2" />
      </select>
      <from>
        <query name="nr_account" as="a">
          <link name="kod_account_parent" />
          <link name="vid_t" />
          <link name="kod_bu_akt" />
          <elink name="nr_account_nal" />
          <link name="kod_ras" />
        </query>
      </from>
    </query>
    <query name="fingen_account_sost">
      <select>
        <column table="a" column="ym" />
        <column table="a" column="kod_numobj" />
        <column table="a" column="kod_account" />
        <column table="nr_account_sost" column="kod_account_sost" />
        <column table="a" column="vid_t" />
        <column table="nr_account_sost" column="tarif" as="sost_tarif" />
        <column table="vid_t" column="edizm" />
        <column table="vid_t" column="vid_real" />
        <column table="a" column="kod_dog" />
        <column table="kod_ras" column="kod_sf" />
        <column table="a" column="kod_bu_akt" />
        <call function="nvl" as="kod_bu_akt_main">
          <column table="kod_account_parent" column="kod_bu_akt" />
          <column table="a" column="kod_bu_akt" />
        </call>
        <column table="nr_account_sost" column="tip_tarif_sost" />
        <column table="nr_account_sost" column="cust" />
        <column table="nr_account_sost" column="nachisl" />
        <column table="a" column="tarif2" />
      </select>
      <from>
        <query name="nr_account" as="a">
          <link name="kod_account_parent" />
          <link name="vid_t" />
          <link name="kod_bu_akt" />
          <elink name="nr_account_sost" />
          <link name="kod_ras" />
        </query>
      </from>
    </query>
    <!--<query name="fingen_bu_akt">
      <select>
        <column table="a" column="kod_numobj"/>
        <column table="a" column="kod_account"/>
        <column table="kod_numobj" column="kod_dog"/>
        <column table="a" column="kod_bu_akt"/>
        <const as="fingen_bu_akt" type="number">1</const>
      </select>
      <from>
        <query name="hr_bu_akt" as="a">
          <link name="kod_numobj"/>
        </query>
      </from>
    </query>-->
    <!--<query name="fingen_account_sost">
      <params>
        <param name="tip_tarif_sost"/>
      </params>
      <select>
        <column table="vid_t" column="edizm"/>
        <column table="a" column="tip_tarif_sost"/>
        <column table="kod_account" column="kod_dog"/>
        <column table="kod_account" column="kod_bu_akt"/>
        <column table="a" column="cust" group="sum"></column>
        <column table="a" column="nachisl" group="sum"></column>
      </select>
      <from>
        <query name="nr_account_sost" as="a">
          <link name="kod_account">
            <link name="vid_t"/>
            <link name="kod_bu_akt"/>
          </link>
        </query>
      </from>
    </query>-->
    <query name="fingen_bu_akt" timestamp="30.03.2016 22:03:41">
      <select>
        <column table="kod_numobj" column="kod_dog" />
        <column table="hr_bu_akt" column="kod_numobj" />
        <column table="hr_bu_akt" column="kod_bu_akt" />
        <call function="nvl" as="kod_bu_akt_main">
          <column table="hr_bu_akt" column="kod_bu_akt_parent" />
          <column table="hr_bu_akt" column="kod_bu_akt" />
        </call>
        <call function="if" as="bu_akt_cnt" type="number">
          <call function="is null">
            <column table="hr_bu_akt" column="kod_bu_akt_parent" />
          </call>
          <const>1</const>
          <const>0</const>
        </call>
      </select>
      <from>
        <query name="hr_bu_akt">
          <link name="kod_numobj">
            <link name="kod_dog" />
          </link>
        </query>
      </from>
    </query>
    <query name="fingen_kor_saldo" timestamp="14.05.2023 16:52:52">
      <select>
        <column table="vr_kor_saldo" column="kod_dog" />
        <call function="date to ym" as="ym">
          <column table="vr_kor_saldo" column="dat_otch" />
        </call>
        <const as="vid_t">null</const>
        <const as="edizm">null</const>
        <const as="kod_numobj">null</const>
        <column table="vr_kor_saldo" column="dat_otch" />
        <column table="vr_kor_saldo" column="vid_real" />
        <column table="vr_kor_saldo" column="dat_vozn" />
        <column table="vr_kor_saldo" column="dat_vozn" as="dat_vozn2" />
        <column table="vr_kor_saldo" column="kod_kor_saldo" />
        <column table="vr_kor_saldo" column="val" as="korr_opl_av" title="Корректировка оплаты аванса" />
      </select>
      <from>
        <query name="vr_kor_saldo" />
      </from>
    </query>
    <query name="fingen_dog" timestamp="26.07.2021 05:59:24">
      <select>
        <column table="kod_dog" column="kod_dog" />
        <call function="()" type="number" as="dog_cnt">
          <const>1</const>
        </call>
        <call function="()" type="number" as="vid_real">
          <const>2</const>
        </call>
      </select>
      <from>
        <query name="kr_dogovor" as="kod_dog" />
      </from>
      <where>
        <call function="=">
          <column table="kod_dog" column="pr_active" />
          <const>0</const>
        </call>
      </where>
    </query>
  </queries>
</root>