<?xml version="1.0" encoding="utf-8"?>
<root>
  <!--queries>
    <query name="test_tree_grouping_hand" timestamp="21.11.2016 14:21:15" is-report="1" title="Группировка по дереву (ручной)" visible="0" with-behavior="0">
      <customers>
        <customer id="101" />
        <customer id="16" />
      </customers>
      <select>
        <column table="tarif_lev1" column="tarif" as="tarif1" tree-original-column="tarif" />
        <column column="tarif" as="tarif2" table="tarif_lev2" tree-original-column="tarif" />
        <column column="tarif" as="tarif3" table="tarif_lev3" tree-original-column="tarif" />
        <column column="tarif" as="tarif4" table="tarif_lev4" tree-original-column="tarif" />
        <column column="tarif" as="tarif5" table="tarif_lev5" tree-original-column="tarif" />
        <column table="tarif_lev1" column="sname" as="sname_lev1" tree-original-column="sname" title="Тариф" />
        <column table="tarif_lev2" column="sname" as="sname_lev2" tree-original-column="sname" title="Тариф" />
        <column table="tarif_lev3" column="sname" as="sname_lev3" tree-original-column="sname" title="Тариф" />
        <column table="tarif_lev4" column="sname" as="sname_lev4" tree-original-column="sname" title="Тариф" />
        <column table="tarif_lev5" column="sname" as="sname_lev5" tree-original-column="sname" title="Тариф" />
        <column table="kod_dog" column="kod_dog" />
        <column table="kod_dog" column="ndog" />
        <column table="vid_t" column="vid_t" />
        <column table="vid_t" column="num_t" />
        <fact column="sr_facras_nachisl" group="sum" />
      </select>
      <from>
        <qube>
          <link name="tarif" is-tree="1" as="a1" />
          <link name="kod_dog" />
          <link name="vid_t" />
          <link name="ym" />
          <where>
            <call function="=">
              <column table="ym" column="val" />
              <const>2016.01</const>
            </call>
          </where>
        </qube>
        <query join="left outer" as="tarif_tree">
          <call function="=">
            <column table="a1" column="tarif" />
            <column table="tarif_tree" column="tarif" />
          </call>
          <select>
            <call function="case" as="tarif1">
              <call function="when">
                <call function="is null">
                  <column table="a2" column="tarif" />
                </call>
                <column table="a1" column="tarif" />
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a3" column="tarif" />
                </call>
                <column table="a2" column="tarif" />
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a4" column="tarif" />
                </call>
                <column table="a3" column="tarif" />
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a5" column="tarif" />
                </call>
                <column table="a4" column="tarif" />
              </call>
              <call function="else">
                <column table="a5" column="tarif" />
              </call>
            </call>
            <call function="case" as="tarif2">
              <call function="when">
                <call function="is null">
                  <column table="a2" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a3" column="tarif" />
                </call>
                <column table="a1" column="tarif" />
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a4" column="tarif" />
                </call>
                <column table="a2" column="tarif" />
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a5" column="tarif" />
                </call>
                <column table="a3" column="tarif" />
              </call>
              <call function="else">
                <column table="a4" column="tarif" />
              </call>
            </call>
            <call function="case" as="tarif3">
              <call function="when">
                <call function="is null">
                  <column table="a2" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a3" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a4" column="tarif" />
                </call>
                <column table="a1" column="tarif" />
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a5" column="tarif" />
                </call>
                <column table="a2" column="tarif" />
              </call>
              <call function="else">
                <column table="a3" column="tarif" />
              </call>
            </call>
            <call function="case" as="tarif4">
              <call function="when">
                <call function="is null">
                  <column table="a2" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a3" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a4" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a5" column="tarif" />
                </call>
                <column table="a1" column="tarif" />
              </call>
              <call function="else">
                <column table="a2" column="tarif" />
              </call>
            </call>
            <call function="case" as="tarif5">
              <call function="when">
                <call function="is null">
                  <column table="a2" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a3" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a4" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a5" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="else">
                <column table="a1" column="tarif" />
              </call>
            </call>
            <column table="a1" column="tarif" as="tarif" />
          </select>
          <from>
            <query name="ks_tarif" as="a1">
              <link name="tarif_parent" as="a2">
                <link name="tarif_parent" as="a3">
                  <link name="tarif_parent" as="a4">
                    <link as="a5" name="tarif_parent" />
                  </link>
                </link>
              </link>
            </query>
          </from>
        </query>
        <query name="ks_tarif" as="tarif_lev1" join="left outer">
          <call function="=">
            <column table="tarif_lev1" column="tarif" />
            <column table="tarif_tree" column="tarif1" />
          </call>
        </query>
        <query name="ks_tarif" as="tarif_lev2" join="left outer">
          <call function="=">
            <column table="tarif_lev2" column="tarif" />
            <column table="tarif_tree" column="tarif2" />
          </call>
        </query>
        <query name="ks_tarif" as="tarif_lev3" join="left outer">
          <call function="=">
            <column table="tarif_lev3" column="tarif" />
            <column table="tarif_tree" column="tarif3" />
          </call>
        </query>
        <query name="ks_tarif" as="tarif_lev4" join="left outer">
          <call function="=">
            <column table="tarif_lev4" column="tarif" />
            <column table="tarif_tree" column="tarif4" />
          </call>
        </query>
        <query name="ks_tarif" as="tarif_lev5" join="left outer">
          <call function="=">
            <column table="tarif_lev5" column="tarif" />
            <column table="tarif_tree" column="tarif5" />
          </call>
        </query>
      </from>
      <grouping>
        <grset as="l1" name="l">
          <group>
            <sourcelink table="tarif_lev1" />
          </group>
          <grset as="l2" name="l">
            <group>
              <sourcelink table="tarif_lev2" />
            </group>
            <where>
              <call function="is not null">
                <column table="this" column="tarif2" />
              </call>
            </where>
            <grset as="l3" name="l">
              <group>
                <sourcelink table="tarif_lev3" />
              </group>
              <where>
                <call function="is not null">
                  <column table="this" column="tarif3" />
                </call>
              </where>
              <grset as="l4" name="l">
                <group>
                  <sourcelink table="tarif_lev4" />
                </group>
                <where>
                  <call function="is not null">
                    <column table="this" column="tarif4" />
                  </call>
                </where>
                <grset as="l5" name="l">
                  <group>
                    <sourcelink table="tarif_lev5" />
                  </group>
                  <where>
                    <call function="is not null">
                      <column table="this" column="tarif5" />
                    </call>
                  </where>
                  <grset as="d5">
                    <group>
                      <sourcelink table="kod_dog" />
                    </group>
                    <grset as="t5">
                      <group>
                        <sourcelink table="vid_t" />
                      </group>
                    </grset>
                  </grset>
                </grset>
                <grset as="d4">
                  <group>
                    <sourcelink table="kod_dog" />
                  </group>
                  <where>
                    <call function="is null">
                      <column table="this" column="tarif5" />
                    </call>
                  </where>
                  <grset as="t4">
                    <group>
                      <sourcelink table="vid_t" />
                    </group>
                  </grset>
                </grset>
              </grset>
              <grset as="d3">
                <group>
                  <sourcelink table="kod_dog" />
                </group>
                <where>
                  <call function="is null">
                    <column table="this" column="tarif4" />
                  </call>
                </where>
                <grset as="t3">
                  <group>
                    <sourcelink table="vid_t" />
                  </group>
                </grset>
              </grset>
            </grset>
            <grset as="d2">
              <group>
                <sourcelink table="kod_dog" />
              </group>
              <where>
                <call function="is null">
                  <column table="this" column="tarif3" />
                </call>
              </where>
              <grset as="t2">
                <group>
                  <sourcelink table="vid_t" />
                </group>
              </grset>
            </grset>
          </grset>
          <grset as="d1">
            <group>
              <sourcelink table="kod_dog" />
            </group>
            <grset as="t1">
              <group>
                <sourcelink table="vid_t" />
              </group>
            </grset>
            <where>
              <call function="is null">
                <column table="this" column="tarif2" />
              </call>
            </where>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="test_tree_grouping_otrasl" timestamp="28.02.2017 15:11:20" is-report="1" title="Группировка по дереву (автоматичекий) отрасли" visible="0" with-behavior="0">
      <customers>
        <customer id="101" />
        <customer id="16" />
      </customers>
      <print-templates>
        <excel>
          <template name="test_tree_grouping.xml" title="Тест группировки по дереву" print-proc="2" />
        </excel>
      </print-templates>
      <select>
        <column table="kod_otrasl" column="kod_otrasl" />
        <column table="kod_otrasl" column="name" />
        <column table="kod_dog" column="kod_dog" />
        <column table="kod_dog" column="ndog" />
        <column table="vid_t" column="vid_t" />
        <column table="vid_t" column="num_t" />
        <fact column="sr_facras_nachisl" as="summ" agg="no" group="sum" />
      </select>
      <from>
        <qube>
          <link name="kod_otrasl" is-tree="1" />
          <link name="kod_dog" />
          <link name="vid_t" />
          <link name="ym" />
          <where>
            <call function="=">
              <column table="ym" column="val" />
              <const>2016.01</const>
            </call>
          </where>
        </qube>
      </from>
      <grouping>
        <grset as="itog" title="Итого">
          <grset as="tar" title="Отрасль">
            <group>
              <sourcelink table="kod_otrasl" />
            </group>
            <grset as="dog" title="Договор">
              <group>
                <sourcelink table="kod_dog" />
              </group>
              <grset title="Вид начисления" as="vid_t">
                <group>
                  <sourcelink table="vid_t" />
                </group>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="testtreegrouping_2" timestamp="12.05.2016 18:51:56">
      <select>
        <call function="case" as="tarif1">
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif2" />
            </call>
            <column table="a" column="tarif1" />
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif3" />
            </call>
            <column table="a" column="tarif2" />
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif4" />
            </call>
            <column table="a" column="tarif3" />
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif5" />
            </call>
            <column table="a" column="tarif4" />
          </call>
          <call function="else">
            <column table="a" column="tarif5" />
          </call>
        </call>
        <call function="case" as="tarif2">
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif2" />
            </call>
            <const>null</const>
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif3" />
            </call>
            <column table="a" column="tarif1" />
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif4" />
            </call>
            <column table="a" column="tarif2" />
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif5" />
            </call>
            <column table="a" column="tarif3" />
          </call>
          <call function="else">
            <column table="a" column="tarif4" />
          </call>
        </call>
        <call function="case" as="tarif3">
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif2" />
            </call>
            <const>null</const>
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif3" />
            </call>
            <const>null</const>
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif4" />
            </call>
            <column table="a" column="tarif1" />
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif5" />
            </call>
            <column table="a" column="tarif2" />
          </call>
          <call function="else">
            <column table="a" column="tarif3" />
          </call>
        </call>
        <call function="case" as="tarif4">
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif2" />
            </call>
            <const>null</const>
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif3" />
            </call>
            <const>null</const>
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif4" />
            </call>
            <const>null</const>
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif5" />
            </call>
            <column table="a" column="tarif1" />
          </call>
          <call function="else">
            <column table="a" column="tarif2" />
          </call>
        </call>
        <call function="case" as="tarif5">
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif2" />
            </call>
            <const>null</const>
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif3" />
            </call>
            <const>null</const>
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif4" />
            </call>
            <const>null</const>
          </call>
          <call function="when">
            <call function="is null">
              <column table="a" column="tarif5" />
            </call>
            <const>null</const>
          </call>
          <call function="else">
            <column table="a" column="tarif1" />
          </call>
        </call>
        <column table="a" column="tarif1" as="tarif" />
      </select>
      <from>
        <query name="test_tree_grouping_1" as="a" />
      </from>
    </query>
    <query name="testtreegrouping_6" timestamp="12.05.2016 19:05:59">
      <select>
        <column table="tarif" column="tarif" />
        <column table="tarif" column="tarif_parent" />
        <fact column="sr_facras_nachisl" />
      </select>
      <from>
        <qube>
          <link name="tarif" is-tree="1" />
          <link name="ym" />
          <where>
            <call function="=">
              <column table="ym" column="val" />
              <const>2016.01</const>
            </call>
          </where>
        </qube>
      </from>
    </query>
    <query name="test_tree_grouping" timestamp="21.11.2016 14:21:21" is-report="1" title="Группировка по дереву (автоматичекий)" visible="0" with-behavior="0">
      <customers>
        <customer id="101" />
        <customer id="16" />
      </customers>
      <print-templates>
        <excel>
          <template name="test_tree_grouping.xml" title="Тест группировки по дереву" print-proc="2" />
        </excel>
      </print-templates>
      <select>
        <column table="dep" column="kodp" />
        <column table="dep" column="name" />
        <column table="a1" column="tarif" />
        <column table="a1" column="sname" />
        <column table="kod_dog" column="kod_dog" />
        <column table="kod_dog" column="ndog" />
        <column table="vid_t" column="vid_t" />
        <column table="vid_t" column="num_t" />
        <fact column="sr_facras_nachisl" group="sum" as="summ" agg="no" />
      </select>
      <from>
        <qube>
          <link name="tarif" is-tree="1" as="a1" />
          <link name="kod_dog">
            <link name="dep" />
          </link>
          <link name="vid_t" />
          <link name="ym" />
          <where>
            <call function="=">
              <column table="ym" column="val" />
              <const>2016.01</const>
            </call>
          </where>
        </qube>
      </from>
      <grouping>
        <grset as="itog" title="Итого">
          <group>
            <sourcelink table="dep" />
          </group>
          <grset as="tar" title="Тариф">
            <group>
              <sourcelink table="a1" />
            </group>
            <grset as="dog" title="Договор">
              <group>
                <sourcelink table="kod_dog" />
              </group>
              <grset title="Вид начисления" as="vid_t">
                <group>
                  <sourcelink table="vid_t" />
                </group>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="test_tree_grouping_otrasl_tar" timestamp="21.11.2016 14:21:21" is-report="1" title="Группировка по дереву (автоматичекий) отрасли" visible="0" with-behavior="0">
      <customers>
        <customer id="101" />
        <customer id="16" />
      </customers>
      <print-templates>
        <excel>
          <template name="test_tree_grouping.xml" title="Тест группировки по дереву" print-proc="2" />
        </excel>
      </print-templates>
      <select>
        <column table="dep" column="kodp" />
        <column table="dep" column="name" as="dep_name" />
        <column table="tarif" column="tarif" />
        <column table="tarif" column="sname" />
        <column table="kod_otrasl" column="kod_otrasl" />
        <column table="kod_otrasl" column="name" />
        <column table="kod_dog" column="kod_dog" />
        <column table="kod_dog" column="ndog" />
        <column table="vid_t" column="vid_t" />
        <column table="vid_t" column="num_t" />
        <fact column="sr_facras_nachisl" as="summ" agg="no" group="sum" />
      </select>
      <from>
        <qube>
          <link name="tarif" is-tree="1" />
          <link name="kod_otrasl" is-tree="1" />
          <link name="kod_dog">
            <link name="dep" />
          </link>
          <link name="vid_t" />
          <link name="ym" />
          <where>
            <call function="=">
              <column table="ym" column="val" />
              <const>2016.01</const>
            </call>
          </where>
        </qube>
      </from>
      <grouping>
        <grset as="dep">
          <grset as="tar" title="Тариф">
            <group>
              <sourcelink table="tarif" />
            </group>
            <grset as="otr" title="Отрасль">
              <group>
                <sourcelink table="kod_otrasl" />
              </group>
              <grset as="dog" title="Договор">
                <group>
                  <sourcelink table="kod_dog" />
                </group>
              </grset>
              <grset title="Вид начисления" as="vid_t">
                <group>
                  <sourcelink table="vid_t" />
                </group>
              </grset>
            </grset>
          </grset>
          <group>
            <sourcelink table="dep" />
          </group>
        </grset>
      </grouping>
    </query>
    <query name="test_tree_grouping_att" timestamp="21.11.2016 14:21:21" is-report="1" title="Группировка по дереву (автоматичекий) отрасли" visible="0" with-behavior="0">
      <customers>
        <customer id="101" />
        <customer id="16" />
      </customers>
      <print-templates>
        <excel>
          <template name="test_tree_grouping.xml" title="Тест группировки по дереву" print-proc="2" />
        </excel>
      </print-templates>
      <select>
        <column table="tarif" column="tarif" />
        <column table="tarif" column="sname" />
        <column table="kod_otrasl" column="kod_otrasl" />
        <column table="kod_otrasl" column="name" />
        <column table="kod_dog" column="kod_dog" />
        <column table="kod_dog" column="ndog" />
        <column table="vid_t" column="vid_t" />
        <column table="vid_t" column="num_t" />
        <fact column="sr_facras_nachisl" as="summ" agg="no" />
      </select>
      <from>
        <qube>
          <link name="kod_otrasl" is-tree="1" />
          <link name="tarif" is-tree="1" />
          <link name="kod_dog" />
          <link name="vid_t" />
          <link name="ym" />
          <where>
            <call function="=">
              <column table="ym" column="val" />
              <const>2016.01</const>
            </call>
          </where>
        </qube>
      </from>
      <grouping exclude="1">
        <grset as="tar" title="Тариф">
          <group>
            <sourcelink table="tarif" />
          </group>
          <grset as="otr" title="Отрасль">
            <group>
              <sourcelink table="kod_otrasl" />
            </group>
            <grset as="dog" title="Договор">
              <group>
                <sourcelink table="kod_dog" />
              </group>
              <grset title="Вид начисления" as="vid_t">
                <group>
                  <sourcelink table="vid_t" />
                </group>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="test_tree_grouping_hand2" timestamp="21.11.2016 14:21:21" is-report="1" title="Группировка по дереву (ручной)" visible="0" with-behavior="0">
      <customers>
        <customer id="101" />
        <customer id="16" />
      </customers>
      <select>
        <column table="a1" column="tarif" as="tarif_o" tree-original-column="tarif" />
        <column table="a1" column="sname" as="sname_o" tree-original-column="sname" />
        <column table="tarif_lev1" column="tarif" as="tarif1" tree-original-column="tarif" />
        <column column="tarif" as="tarif2" table="tarif_lev2" tree-original-column="tarif" />
        <column column="tarif" as="tarif3" table="tarif_lev3" tree-original-column="tarif" />
        <column column="tarif" as="tarif4" table="tarif_lev4" tree-original-column="tarif" />
        <column column="tarif" as="tarif5" table="tarif_lev5" tree-original-column="tarif" />
        <column table="tarif_lev1" column="sname" as="sname_lev1" tree-original-column="sname" title="Тариф" />
        <column table="tarif_lev2" column="sname" as="sname_lev2" tree-original-column="sname" title="Тариф" />
        <column table="tarif_lev3" column="sname" as="sname_lev3" tree-original-column="sname" title="Тариф" />
        <column table="tarif_lev4" column="sname" as="sname_lev4" tree-original-column="sname" title="Тариф" />
        <column table="tarif_lev5" column="sname" as="sname_lev5" tree-original-column="sname" title="Тариф" />
        <column table="kod_dog" column="kod_dog" />
        <column table="kod_dog" column="ndog" />
        <column table="vid_t" column="vid_t" />
        <column table="vid_t" column="num_t" />
        <fact column="sr_facras_nachisl" group="sum" />
      </select>
      <from>
        <qube>
          <link name="tarif" as="a1" />
          <link name="kod_dog" />
          <link name="vid_t" />
          <link name="ym" />
          <where>
            <call function="=">
              <column table="ym" column="val" />
              <const>2016.01</const>
            </call>
          </where>
        </qube>
        <query join="left outer" as="tarif_tree">
          <call function="=">
            <column table="a1" column="tarif" />
            <column table="tarif_tree" column="tarif" />
          </call>
          <select>
            <call function="case" as="tarif1">
              <call function="when">
                <call function="is null">
                  <column table="a2" column="tarif" />
                </call>
                <column table="a1" column="tarif" />
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a3" column="tarif" />
                </call>
                <column table="a2" column="tarif" />
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a4" column="tarif" />
                </call>
                <column table="a3" column="tarif" />
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a5" column="tarif" />
                </call>
                <column table="a4" column="tarif" />
              </call>
              <call function="else">
                <column table="a5" column="tarif" />
              </call>
            </call>
            <call function="case" as="tarif2">
              <call function="when">
                <call function="is null">
                  <column table="a2" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a3" column="tarif" />
                </call>
                <column table="a1" column="tarif" />
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a4" column="tarif" />
                </call>
                <column table="a2" column="tarif" />
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a5" column="tarif" />
                </call>
                <column table="a3" column="tarif" />
              </call>
              <call function="else">
                <column table="a4" column="tarif" />
              </call>
            </call>
            <call function="case" as="tarif3">
              <call function="when">
                <call function="is null">
                  <column table="a2" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a3" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a4" column="tarif" />
                </call>
                <column table="a1" column="tarif" />
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a5" column="tarif" />
                </call>
                <column table="a2" column="tarif" />
              </call>
              <call function="else">
                <column table="a3" column="tarif" />
              </call>
            </call>
            <call function="case" as="tarif4">
              <call function="when">
                <call function="is null">
                  <column table="a2" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a3" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a4" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a5" column="tarif" />
                </call>
                <column table="a1" column="tarif" />
              </call>
              <call function="else">
                <column table="a2" column="tarif" />
              </call>
            </call>
            <call function="case" as="tarif5">
              <call function="when">
                <call function="is null">
                  <column table="a2" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a3" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a4" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="when">
                <call function="is null">
                  <column table="a5" column="tarif" />
                </call>
                <const>null</const>
              </call>
              <call function="else">
                <column table="a1" column="tarif" />
              </call>
            </call>
            <column table="a1" column="tarif" as="tarif" />
          </select>
          <from>
            <query name="ks_tarif" as="a1">
              <link name="tarif_parent" as="a2">
                <link name="tarif_parent" as="a3">
                  <link name="tarif_parent" as="a4">
                    <link as="a5" name="tarif_parent" />
                  </link>
                </link>
              </link>
            </query>
          </from>
        </query>
        <query name="ks_tarif" as="tarif_lev1" join="left outer">
          <call function="=">
            <column table="tarif_lev1" column="tarif" />
            <column table="tarif_tree" column="tarif1" />
          </call>
        </query>
        <query name="ks_tarif" as="tarif_lev2" join="left outer">
          <call function="=">
            <column table="tarif_lev2" column="tarif" />
            <column table="tarif_tree" column="tarif2" />
          </call>
        </query>
        <query name="ks_tarif" as="tarif_lev3" join="left outer">
          <call function="=">
            <column table="tarif_lev3" column="tarif" />
            <column table="tarif_tree" column="tarif3" />
          </call>
        </query>
        <query name="ks_tarif" as="tarif_lev4" join="left outer">
          <call function="=">
            <column table="tarif_lev4" column="tarif" />
            <column table="tarif_tree" column="tarif4" />
          </call>
        </query>
        <query name="ks_tarif" as="tarif_lev5" join="left outer">
          <call function="=">
            <column table="tarif_lev5" column="tarif" />
            <column table="tarif_tree" column="tarif5" />
          </call>
        </query>
      </from>
      <grouping>
        <grset as="l1" name="l" key="tarif1">
          <group>
            <sourcelink table="tarif_lev1" />
          </group>
          <grset as="l2" name="l" key="tarif2">
            <group>
              <sourcelink table="tarif_lev2" />
            </group>
            <where>
              <call function="is not null">
                <column table="this" column="tarif2" />
              </call>
            </where>
            <grset as="l3" name="l" key="tarif3">
              <group>
                <sourcelink table="tarif_lev3" />
              </group>
              <where>
                <call function="is not null">
                  <column table="this" column="tarif3" />
                </call>
              </where>
              <grset as="l4" name="l" key="tarif4">
                <group>
                  <sourcelink table="tarif_lev4" />
                </group>
                <where>
                  <call function="is not null">
                    <column table="this" column="tarif4" />
                  </call>
                </where>
                <grset as="l5" name="l" key="tari5">
                  <group>
                    <sourcelink table="tarif_lev5" />
                  </group>
                  <where>
                    <call function="is not null">
                      <column table="this" column="tarif5" />
                    </call>
                  </where>
                </grset>
              </grset>
            </grset>
          </grset>
        </grset>
        <grset as="dog" parent="l" parent-key="tarif_o">
          <group>
            <sourcelink table="a1" />
            <sourcelink table="kod_dog" />
          </group>
          <grset as="vid_t">
            <group>
              <sourcelink table="vid_t" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="test_tree_grouping_ipr" timestamp="28.02.2017 16:20:46" is-report="1" title="Тест настраиваемого дерева" visible="0" mode="tree" with-behavior="0">
      <customers>
        <customer id="17" />
      </customers>
      <content>
        <usefield field="ipr_kod_doc" />
        <field controlType="UICombo" name="kod_tree_struct" title="Структура" type="number" mandatory="1">
          <listquery>
            <query name="vr_tree_struct" />
          </listquery>
        </field>
      </content>
      <select>
        <column table="ipr_kod_tree_sprav" column="kod_tree_sprav" />
        <column table="ipr_kod_tree_sprav" column="ord" />
        <column table="ipr_kod_tree_sprav" column="kod_tree_struct" />
        <column table="ipr_kod_tree_sprav" column="name" as="node_name" title="Узел" />
        <column table="ipr_kod_tree_sprav" column="detail" />
        <column table="kod_ipr" column="kod_ipr" />
        <column table="kod_doc_osn" column="full_name" title="Версия ИПР" />
        <column table="kod_titul_ip" column="tit_num_new" />
        <fact column="ipr_kap_sum" group="sum" />
      </select>
      <from>
        <qube>
          <link name="ipr_kod_tree_sprav" is-tree="1" />
          <link name="kod_ipr" all-rows="1">
            <link name="kod_titul_ip" />
            <link name="kod_doc_osn" />
          </link>
          <where>
            <call function="=">
              <column table="ipr_kod_tree_sprav" column="kod_tree_struct" />
              <useparam name="kod_tree_struct">1</useparam>
            </call>
            <call function="=">
              <column table="kod_ipr" column="kod_doc_osn" />
              <useparam name="kod_doc" />
            </call>
          </where>
        </qube>
      </from>
      <grouping>
        <grset as="tr" title="Узел" order="ord">
          <group>
            <sourcelink table="ipr_kod_tree_sprav" />
          </group>
          <grset as="ipr" title="Титул">
            <group>
              <sourcelink table="kod_ipr" />
            </group>
            <where>
              <call function="=">
                <column table="this" column="detail" />
                <const>1</const>
              </call>
            </where>
          </grset>
        </grset>
      </grouping>
    </query>
  </queries-->
</root>