<?xml version="1.0" encoding="utf-8"?>
<root>
  <queries>
    <query name="55865" timestamp="24.12.2021 11:49:08" title="Отчет по количеству документов в АСУСЭ" is-report="1" nogrid="1">
      <print-templates>
        <excel>
          <template name="55865.xlsx" title="Отчет по количеству документов в АСУСЭ" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <content>
        <usefield field="asuse_dep" name="p_dep" />
        <usefield field="asuse_ym_othr" name="p_ym_s" title="Период с" column-mandatory="1" />
        <usefield field="asuse_ym_othr" name="p_ym_po" title="Период по" column-mandatory="1" />
      </content>
      <select>
        <column table="data" column="ndog" title="Номер договора" />
        <column table="data" column="dep" title="Подразделение" />
        <column table="data" column="sf_total" title="Счет-фактура всего" group="sum" />
        <column table="data" column="sf_edo" title="Счет-фактура ЭДО" group="sum" />
        <column table="data" column="akt_pp_total" group="sum" title="Акты приема передачи всего" />
        <column table="data" column="akt_pp_edo" title="Акты приема передачи ЭДО" group="sum" />
        <column table="data" column="akt_sv_total" title="Акт сверки всего" group="sum" />
        <column table="data" column="akt_sv_edo" title="Акт сверки ЭДО" group="sum" />
        <column table="data" column="kvit_cnt" title="Квитанции" group="sum" />
        <column table="data" column="pret_total" title="Претензии всего" group="sum" />
        <column table="data" column="pret_edo" title="Претензии ЭДО" group="sum" />
        <column table="data" column="naryad_cnt" title="Наряды" group="sum" />
        <column table="data" column="dog_status" title="Статус договора" />
        <column table="data" column="oper_edo" title="Статус договора" />
      </select>
      <from>
        <query name="55865_data" as="data">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
        </query>
      </from>
      <grouping>
        <grset as="itog">
          <grset as="dep" order="dep">
            <group>
              <column table="data" column="dep" />
            </group>
            <grset as="dog" order="ndog">
              <group>
                <column table="data" column="ndog" />
                <column table="data" column="dog_status" title="Статус договора" />
                <column table="data" column="oper_edo" title="Статус договора" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="55865_debet" timestamp="08.05.2020 16:33:51" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" group="1" />
        <column table="sr_debet" column="kod_deb" group="count" as="cnt_deb" />
      </select>
      <from>
        <query name="sr_debet">
          <link name="kod_dog" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="ge">
            <call function="date to ym">
              <column table="sr_debet" column="dat_deb" />
            </call>
            <useparam name="p_ym_s" />
          </call>
          <call function="le">
            <call function="date to ym">
              <column table="sr_debet" column="dat_deb" />
            </call>
            <useparam name="p_ym_po" />
          </call>
          <call function="=">
            <column table="sr_debet" column="vid_pl" />
            <const>4</const>
          </call>
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_akt" timestamp="08.05.2020 17:11:36" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" group="1" />
        <call function="if" type="number" group="count" as="akt_edo">
          <call function="is not null">
            <column table="akt_edo" column="kod_dog" />
          </call>
          <const>1</const>
        </call>
        <call function="if" type="number" group="count" as="akt_not_edo">
          <call function="is null">
            <column table="akt_edo" column="kod_dog" />
          </call>
          <const>0</const>
        </call>
      </select>
      <from>
        <query name="sr_akt">
          <elink name="sr_akt_text">
            <link name="kod_dog" />
          </elink>
        </query>
        <query name="55865_akt_edo" join="left outer" as="akt_edo">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="and">
            <call function="=">
              <call function="date to ym">
                <column table="sr_akt" column="dat_akt" />
              </call>
              <column table="akt_edo" column="ym" />
            </call>
            <call function="=">
              <column table="kod_dog" column="kod_dog" />
              <column table="akt_edo" column="kod_dog" />
            </call>
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="ge">
            <call function="date to ym">
              <column table="sr_akt" column="dat_akt" />
            </call>
            <useparam name="p_ym_s" />
          </call>
          <call function="le">
            <call function="date to ym">
              <column table="sr_akt" column="dat_akt" />
            </call>
            <useparam name="p_ym_po" />
          </call>
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_facvip" timestamp="19.08.2020 19:12:15" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" group="1" />
        <call function="if" type="number" as="fv_edo" group="count">
          <call function="is not null all">
            <column table="kod_sf_text" column="kod_edo_pol" />
            <column table="kod_sf_text" column="kod_edo_pok" />
          </call>
          <const>1</const>
        </call>
        <call function="if" type="number" as="fv_not_edo" group="count">
          <call function="or">
            <call function="is null">
              <column table="kod_sf_text" column="kod_edo_pol" />
            </call>
            <call function="is null">
              <column table="kod_sf_text" column="kod_edo_pok" />
            </call>
          </call>
          <const>1</const>
        </call>
      </select>
      <from>
        <query name="sr_facvip">
          <link name="kod_dog" />
          <link name="kod_sf_text" />
          <link name="vid_real" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="ge">
            <call function="date to ym">
              <column table="sr_facvip" column="dat_sf" />
            </call>
            <useparam name="p_ym_s" />
          </call>
          <call function="le">
            <call function="date to ym">
              <column table="sr_facvip" column="dat_sf" />
            </call>
            <useparam name="p_ym_po" />
          </call>
          <call function="=1">
            <column table="sr_facvip" column="pr_osn" />
          </call>
          <call function="=1">
            <column table="vid_real" column="pr_osn" />
          </call>
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_pret" timestamp="17.07.2020 18:39:09" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" group="1" />
        <call function="if" type="number" as="pret_edo" group="count">
          <call function="=1">
            <call function="is_dog_edo">
              <column table="kod_dog" column="kod_dog" />
            </call>
          </call>
          <const>1</const>
        </call>
        <call function="if" type="number" as="pret_not_edo" group="count">
          <call function="=0">
            <call function="is_dog_edo">
              <column table="kod_dog" column="kod_dog" />
            </call>
          </call>
          <const>0</const>
        </call>
      </select>
      <from>
        <query name="kr_pret">
          <link name="kod_dog" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="ge">
            <call function="date to ym">
              <column table="kr_pret" column="dat_form" />
            </call>
            <useparam name="p_ym_s" />
          </call>
          <call function="le">
            <call function="date to ym">
              <column table="kr_pret" column="dat_form" />
            </call>
            <useparam name="p_ym_po" />
          </call>
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_naryad" timestamp="08.05.2020 16:32:18" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" group="1" />
        <column table="a" column="ordnum" group="count" as="naryad_cnt" />
      </select>
      <from>
        <query as="a">
          <union>
            <query>
              <select>
                <column table="oto_order_obj" column="kod_dog" group="1" />
                <column table="oto_order" column="on_off" group="1" />
                <column table="oto_order" column="ordnum" group="1" />
                <column table="oto_order" column="orddat" group="1" />
              </select>
              <from>
                <query name="br_oto_order" as="oto_order" />
                <query name="br_oto_obj" join="left outer" as="oto_order_obj">
                  <call function="=">
                    <column table="oto_order_obj" column="kod" />
                    <column table="oto_order" column="kod" />
                  </call>
                </query>
              </from>
              <where>
                <call function="and">
                  <call function="ge">
                    <call function="date to ym">
                      <column table="oto_order" column="orddat" />
                    </call>
                    <useparam name="p_ym_s" />
                  </call>
                  <call function="le">
                    <call function="date to ym">
                      <column table="oto_order" column="orddat" />
                    </call>
                    <useparam name="p_ym_po" />
                  </call>
                </call>
              </where>
            </query>
            <query>
              <select>
                <column table="oto_on" column="kod_dog" group="1" />
                <const as="on_off" group="1">1</const>
                <column table="oto_on" column="nn" group="1" />
                <column table="oto_on" column="dat_n" group="1" />
              </select>
              <from>
                <query name="br_oto_obj" as="oto_on" />
              </from>
              <where>
                <call function="and">
                  <call function="ge">
                    <call function="date to ym">
                      <column table="oto_on" column="dat_n" />
                    </call>
                    <useparam name="p_ym_s" />
                  </call>
                  <call function="le">
                    <call function="date to ym">
                      <column table="oto_on" column="dat_n" />
                    </call>
                    <useparam name="p_ym_po" />
                  </call>
                </call>
              </where>
            </query>
            <query>
              <select>
                <column table="oto_ff" column="kod_dog" group="1" />
                <const as="on_off" group="0">1</const>
                <column table="oto_ff" column="nn_off" group="1" />
                <column table="oto_ff" column="dat_n_off" group="1" />
              </select>
              <from>
                <query name="br_oto_obj" as="oto_ff" />
              </from>
              <where>
                <call function="and">
                  <call function="ge">
                    <call function="date to ym">
                      <column table="oto_ff" column="dat_n_off" />
                    </call>
                    <useparam name="p_ym_s" />
                  </call>
                  <call function="le">
                    <call function="date to ym">
                      <column table="oto_ff" column="dat_n_off" />
                    </call>
                    <useparam name="p_ym_po" />
                  </call>
                </call>
              </where>
            </query>
          </union>
        </query>
        <query name="kr_dogovor" join="inner" as="kod_dog">
          <call function="=">
            <column table="kod_dog" column="kod_dog" />
            <column table="a" column="kod_dog" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_data" timestamp="08.06.2020 16:30:44" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kr_dogovor" column="ndog" />
        <column table="kod_dep" column="sname" as="dep" />
        <call function="+nvl" as="sf_total">
          <column table="facvip" column="fv_edo" />
          <column table="facvip" column="fv_not_edo" />
          <column table="sf_opl_av" column="sf_opl_av_edo" />
          <column table="sf_opl_av" column="sf_opl_av_not_edo" />
        </call>
        <call function="+nvl" as="sf_edo">
          <column table="facvip" column="fv_edo" />
          <column table="sf_opl_av" column="sf_opl_av_edo" />
        </call>
        <call function="+nvl" as="akt_pp_total">
          <column table="facvip" column="fv_edo" />
          <column table="facvip" column="fv_not_edo" />
        </call>
        <column table="facvip" column="fv_edo" as="akt_pp_edo" />
        <call function="+nvl" as="akt_sv_total">
          <column table="akt" column="akt_edo" />
          <column table="akt" column="akt_not_edo" />
        </call>
        <column table="akt" column="akt_edo" as="akt_sv_edo" />
        <column table="debet" column="cnt_deb" as="kvit_cnt" />
        <call function="+nvl" as="pret_total">
          <column table="pret" column="pret_edo" />
          <column table="pret" column="pret_not_edo" />
        </call>
        <column table="pret" column="pret_edo" />
        <column table="naryad" column="naryad_cnt" />
        <column table="pr_active" column="name" as="dog_status" />
        <column table="kr_el_inter_contact" column="text" as="oper_edo" />
      </select>
      <from>
        <query name="kr_dogovor">
          <link name="kod_dep" />
          <link name="pr_active" />
        </query>
        <query join="left outer" name="55865_debet" as="debet">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="=">
            <column table="kr_dogovor" column="kod_dog" />
            <column table="debet" column="kod_dog" />
          </call>
        </query>
        <query join="left outer" name="55865_facvip" as="facvip">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="=">
            <column table="kr_dogovor" column="kod_dog" />
            <column table="facvip" column="kod_dog" />
          </call>
        </query>
        <query join="left outer" name="55865_opl_av" as="sf_opl_av">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="=">
            <column table="kr_dogovor" column="kod_dog" />
            <column table="sf_opl_av" column="kod_dog" />
          </call>
        </query>
        <query join="left outer" name="55865_akt" as="akt">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="=">
            <column table="kr_dogovor" column="kod_dog" />
            <column table="akt" column="kod_dog" />
          </call>
        </query>
        <query join="left outer" name="55865_naryad" as="naryad">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="=">
            <column table="kr_dogovor" column="kod_dog" />
            <column table="naryad" column="kod_dog" />
          </call>
        </query>
        <query join="left outer" name="55865_pret" as="pret">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="=">
            <column table="kr_dogovor" column="kod_dog" />
            <column table="pret" column="kod_dog" />
          </call>
        </query>
        <query name="kr_dogovor_el_inter_type" join="left outer">
          <call function="and">
            <call function="=">
              <column table="kr_dogovor" column="kod_dog" />
              <column table="kr_dogovor_el_inter_type" column="kod_dog" />
            </call>
            <call function="=">
              <column table="kr_dogovor_el_inter_type" column="kod_el_inter_type" />
              <const>1</const>
            </call>
          </call>
        </query>
        <query name="kr_el_inter_contact" join="left outer">
          <call function="and">
            <call function="=">
              <column table="kr_dogovor_el_inter_type" column="kod_dog" />
              <column table="kr_el_inter_contact" column="kod_dog" />
            </call>
            <call function="=">
              <column table="kr_el_inter_contact" column="kod_el_inter_type" />
              <const>1</const>
            </call>
            <call function="=">
              <column table="kr_el_inter_contact" column="pr_active" />
              <const>0</const>
            </call>
          </call>
        </query>
      </from>
      <where>
        <call function="or">
          <call function="is not null">
            <column table="debet" column="kod_dog" />
          </call>
          <call function="is not null">
            <column table="facvip" column="kod_dog" />
          </call>
          <call function="is not null">
            <column table="sf_opl_av" column="kod_dog" />
          </call>
          <call function="is not null">
            <column table="akt" column="kod_dog" />
          </call>
          <call function="is not null">
            <column table="naryad" column="kod_dog" />
          </call>
          <call function="is not null">
            <column table="pret" column="kod_dog" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_akt_edo" timestamp="08.05.2020 16:33:06" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" group="1" />
        <call function="date to ym" as="ym" group="1">
          <column table="kod_paket" column="dat_receive" />
        </call>
      </select>
      <from>
        <query name="ks_konvert_doc">
          <link name="kod_paket">
            <link name="kod_dog" />
          </link>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="ge">
            <call function="date to ym">
              <column table="kod_paket" column="dat_receive" />
            </call>
            <useparam name="p_ym_s" />
          </call>
          <call function="le">
            <call function="date to ym">
              <column table="kod_paket" column="dat_receive" />
            </call>
            <useparam name="p_ym_po" />
          </call>
          <call function="=">
            <column table="ks_konvert_doc" column="kod_doc" />
            <const>11</const>
          </call>
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_opl_av" timestamp="19.08.2020 19:12:27" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" group="1" />
        <call function="if" type="number" group="count" as="sf_opl_av_edo">
          <call function="is not null all">
            <column table="kod_sf_text" column="kod_edo_pol" />
            <column table="kod_sf_text" column="kod_edo_pok" />
          </call>
          <const>1</const>
        </call>
        <call function="if" type="number" group="count" as="sf_opl_av_not_edo">
          <call function="or">
            <call function="is null">
              <column table="kod_sf_text" column="kod_edo_pol" />
            </call>
            <call function="is null">
              <column table="kod_sf_text" column="kod_edo_pok" />
            </call>
          </call>
          <const>1</const>
        </call>
      </select>
      <from>
        <query name="sr_opl">
          <link name="kod_sf">
            <link name="kod_sf_text" />
          </link>
          <link name="kod_dog" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="ge">
            <call function="date to ym">
              <column table="sr_opl" column="dat_opl" />
            </call>
            <useparam name="p_ym_s" />
          </call>
          <call function="le">
            <call function="date to ym">
              <column table="sr_opl" column="dat_opl" />
            </call>
            <useparam name="p_ym_po" />
          </call>
          <call function="=" exclude="1">
            <column table="sr_opl" column="vid_real" />
            <const>0</const>
          </call>
          <call function="is not null">
            <column table="sr_opl" column="num_sf" />
          </call>
          <call function="!=0">
            <column table="sr_opl" column="num_sf" />
          </call>
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_test" timestamp="17.07.2020 19:37:43" title="Отчет по количеству документов в АСУСЭ  в разрезе документов" is-report="1" visible="0">
      <content>
        <usefield field="asuse_dep" name="p_dep" />
        <usefield field="asuse_ym_othr" name="p_ym_s" title="Период с" column-mandatory="1" />
        <usefield field="asuse_ym_othr" name="p_ym_po" title="Период по" column-mandatory="1" />
      </content>
      <select>
        <column table="data" column="ndog" title="Номер договора" />
        <column table="data" column="dep" title="Подразделение" />
        <column table="data" column="doc_type" title="Тип документа" />
        <column table="data" column="kod_doc" title="Код документа" />
        <column table="data" column="num_doc" title="Номер документ" />
        <column table="data" column="vid_real" title="Вид реализации" />
        <column table="data" column="add_info" title="Дополнительная информация по документу" />
        <column table="data" column="sf_total" title="Счет-фактура всего" />
        <column table="data" column="sf_edo" title="Счет-фактура ЭДО" />
        <column table="data" column="akt_pp_total" title="Акты приема передачи всего" />
        <column table="data" column="akt_pp_edo" title="Акты приема передачи ЭДО" />
        <column table="data" column="akt_sv_total" title="Акт сверки всего" />
        <column table="data" column="akt_sv_edo" title="Акт сверки ЭДО" />
        <column table="data" column="kvit_cnt" title="Квитанции" />
        <column table="data" column="pret_total" title="Претензии всего" />
        <column table="data" column="pret_edo" title="Претензии ЭДО" />
        <column table="data" column="naryad_cnt" title="Наряды" />
        <column table="data" column="dog_status" title="Статус договора" />
        <column table="data" column="oper_edo" title="Статус договора" />
      </select>
      <from>
        <query name="55865_data_test" as="data">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
        </query>
      </from>
    </query>
    <query name="55865_data_test" timestamp="17.07.2020 19:09:15" visible="0">
      <params>
        <param name="p_dep" type="array">
          <const>102276625</const>
        </param>
        <param name="p_ym_s" type="number">
          <const>2020.05</const>
        </param>
        <param name="p_ym_po" type="number">
          <const>2020.05</const>
        </param>
      </params>
      <select>
        <column table="kr_dogovor" column="ndog" />
        <column table="kod_dep" column="sname" as="dep" />
        <call function="coalesce" as="doc_type">
          <column table="debet" column="doc_type" />
          <column table="facvip" column="doc_type" />
          <column table="sf_opl_av" column="doc_type" />
          <column table="akt" column="doc_type" />
          <column table="naryad" column="doc_type" />
          <column table="pret" column="doc_type" />
        </call>
        <call function="coalesce" as="kod_doc">
          <column table="debet" column="kod_doc" />
          <column table="facvip" column="kod_doc" />
          <column table="sf_opl_av" column="kod_doc" />
          <column table="akt" column="kod_doc" />
          <column table="pret" column="kod_doc" />
        </call>
        <call function="coalesce" as="num_doc" type="string">
          <column table="debet" column="num_doc" />
          <column table="facvip" column="num_doc" />
          <column table="sf_opl_av" column="num_doc" />
          <column table="akt" column="num_doc" />
          <column table="naryad" column="num_doc" />
        </call>
        <call function="coalesce" as="vid_real">
          <column table="facvip" column="vid_real" />
          <column table="sf_opl_av" column="vid_real" />
        </call>
        <call function="coalesce" as="add_info" type="string">
          <column table="facvip" column="sf_korr" />
          <column table="sf_opl_av" column="num_sf" />
          <column table="pret" column="dat_form" />
        </call>
        <call function="+nvl" as="sf_total">
          <column table="facvip" column="fv_edo" />
          <column table="facvip" column="fv_not_edo" />
          <column table="sf_opl_av" column="sf_opl_av_edo" />
          <column table="sf_opl_av" column="sf_opl_av_not_edo" />
        </call>
        <call function="+nvl" as="sf_edo">
          <column table="facvip" column="fv_edo" />
          <column table="sf_opl_av" column="sf_opl_av_edo" />
        </call>
        <call function="+nvl" as="akt_pp_total">
          <column table="facvip" column="fv_edo" />
          <column table="facvip" column="fv_not_edo" />
        </call>
        <column table="facvip" column="fv_edo" as="akt_pp_edo" />
        <call function="+nvl" as="akt_sv_total">
          <column table="akt" column="akt_edo" />
          <column table="akt" column="akt_not_edo" />
        </call>
        <column table="akt" column="akt_edo" as="akt_sv_edo" />
        <column table="debet" column="cnt_deb" as="kvit_cnt" />
        <call function="+nvl" as="pret_total">
          <column table="pret" column="pret_edo" />
          <column table="pret" column="pret_not_edo" />
        </call>
        <column table="pret" column="pret_edo" />
        <column table="naryad" column="naryad_cnt" />
        <column table="pr_active" column="name" as="dog_status" />
        <column table="kr_el_inter_contact" column="text" as="oper_edo" />
      </select>
      <from>
        <query join="left outer" name="55865_debet_test" as="debet">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
        </query>
        <query join="full outer" name="55865_facvip_test" as="facvip">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="false" />
        </query>
        <query join="full outer" name="55865_opl_av_test" as="sf_opl_av">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="false" />
        </query>
        <query join="full outer" name="55865_akt_test" as="akt">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="false" />
        </query>
        <query join="full outer" name="55865_naryad_test" as="naryad">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="false" />
        </query>
        <query join="full outer" name="55865_pret_test" as="pret">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="false" />
        </query>
        <query name="kr_dogovor" join="left outer">
          <link name="kod_dep" />
          <link name="pr_active" />
          <call function="=">
            <call function="coalesce" as="doc_type">
              <column table="debet" column="kod_dog" />
              <column table="facvip" column="kod_dog" />
              <column table="sf_opl_av" column="kod_dog" />
              <column table="akt" column="kod_dog" />
              <column table="naryad" column="kod_dog" />
              <column table="pret" column="kod_dog" />
            </call>
            <column table="kr_dogovor" column="kod_dog" />
          </call>
        </query>
        <query name="kr_dogovor_el_inter_type" join="left outer">
          <call function="and">
            <call function="=">
              <column table="kr_dogovor" column="kod_dog" />
              <column table="kr_dogovor_el_inter_type" column="kod_dog" />
            </call>
            <call function="=">
              <column table="kr_dogovor_el_inter_type" column="kod_el_inter_type" />
              <const>1</const>
            </call>
          </call>
        </query>
        <query name="kr_el_inter_contact" join="left outer">
          <call function="and">
            <call function="=">
              <column table="kr_dogovor_el_inter_type" column="kod_dog" />
              <column table="kr_el_inter_contact" column="kod_dog" />
            </call>
            <call function="=">
              <column table="kr_el_inter_contact" column="kod_el_inter_type" />
              <const>1</const>
            </call>
            <call function="=">
              <column table="kr_el_inter_contact" column="pr_active" />
              <const>0</const>
            </call>
          </call>
        </query>
      </from>
      <where>
        <call function="or">
          <call function="is not null">
            <column table="debet" column="kod_dog" />
          </call>
          <call function="is not null">
            <column table="facvip" column="kod_dog" />
          </call>
          <call function="is not null">
            <column table="sf_opl_av" column="kod_dog" />
          </call>
          <call function="is not null">
            <column table="akt" column="kod_dog" />
          </call>
          <call function="is not null">
            <column table="naryad" column="kod_dog" />
          </call>
          <call function="is not null">
            <column table="pret" column="kod_dog" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_debet_test" timestamp="17.07.2020 18:49:03" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" />
        <const as="doc_type" type="string">'квитанции sr_debet'</const>
        <column table="sr_debet" column="kod_deb" as="kod_doc" />
        <call function="to_char" as="num_doc">
          <column table="sr_debet" column="num_pl" as="num_doc" />
        </call>
        <const as="cnt_deb">1</const>
      </select>
      <from>
        <query name="sr_debet">
          <link name="kod_dog" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="ge">
            <call function="date to ym">
              <column table="sr_debet" column="dat_deb" />
            </call>
            <useparam name="p_ym_s" />
          </call>
          <call function="le">
            <call function="date to ym">
              <column table="sr_debet" column="dat_deb" />
            </call>
            <useparam name="p_ym_po" />
          </call>
          <call function="=">
            <column table="sr_debet" column="vid_pl" />
            <const>4</const>
          </call>
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_facvip_test" timestamp="19.08.2020 19:12:42" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" />
        <const as="doc_type">'с/ф, акт пп sr_facvip'</const>
        <column table="sr_facvip" column="kod_sf" as="kod_doc" />
        <call function="to_char" as="num_doc">
          <column table="sr_facvip" column="num_sf" as="num_doc" />
        </call>
        <column table="sr_facvip" column="vid_real" />
        <call function="if" type="number" as="sf_korr">
          <call function="is not null">
            <column table="sr_facvip" column="kod_sf_first" />
          </call>
          <const>'корректировочная'</const>
        </call>
        <call function="if" type="number" as="fv_edo">
          <call function="is not null all">
            <column table="kod_sf_text" column="kod_edo_pol" />
            <column table="kod_sf_text" column="kod_edo_pok" />
          </call>
          <const>1</const>
        </call>
        <call function="if" type="number" as="fv_not_edo">
          <call function="or">
            <call function="is null">
              <column table="kod_sf_text" column="kod_edo_pol" />
            </call>
            <call function="is null">
              <column table="kod_sf_text" column="kod_edo_pok" />
            </call>
          </call>
          <const>1</const>
        </call>
      </select>
      <from>
        <query name="sr_facvip">
          <link name="kod_dog" />
          <link name="kod_sf_text" />
          <link name="vid_real" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="ge">
            <call function="date to ym">
              <column table="sr_facvip" column="dat_sf" />
            </call>
            <useparam name="p_ym_s" />
          </call>
          <call function="le">
            <call function="date to ym">
              <column table="sr_facvip" column="dat_sf" />
            </call>
            <useparam name="p_ym_po" />
          </call>
          <call function="=1">
            <column table="sr_facvip" column="pr_osn" />
          </call>
          <call function="=1">
            <column table="vid_real" column="pr_osn" />
          </call>
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_opl_av_test" timestamp="19.08.2020 19:12:42" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" />
        <const as="doc_type" type="string">'с/ф sr_opl'</const>
        <column table="sr_opl" column="kod_opl" as="kod_doc" />
        <column table="sr_opl" column="num_opl" as="num_doc" />
        <column table="sr_opl" column="vid_real" />
        <call function="if" type="number" as="num_sf">
          <call function="is not null">
            <column table="sr_opl" column="num_sf" />
          </call>
          <call function="||">
            <const>'num_sf: '</const>
            <column table="sr_opl" column="num_sf" />
          </call>
        </call>
        <call function="if" type="number" as="sf_opl_av_edo">
          <call function="is not null all">
            <column table="kod_sf_text" column="kod_edo_pol" />
            <column table="kod_sf_text" column="kod_edo_pok" />
          </call>
          <const>1</const>
        </call>
        <call function="if" type="number" as="sf_opl_av_not_edo">
          <call function="or">
            <call function="is null">
              <column table="kod_sf_text" column="kod_edo_pol" />
            </call>
            <call function="is null">
              <column table="kod_sf_text" column="kod_edo_pok" />
            </call>
          </call>
          <const>1</const>
        </call>
      </select>
      <from>
        <query name="sr_opl">
          <link name="kod_sf">
            <link name="kod_sf_text" />
          </link>
          <link name="kod_dog" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="ge">
            <call function="date to ym">
              <column table="sr_opl" column="dat_opl" />
            </call>
            <useparam name="p_ym_s" />
          </call>
          <call function="le">
            <call function="date to ym">
              <column table="sr_opl" column="dat_opl" />
            </call>
            <useparam name="p_ym_po" />
          </call>
          <call function="=" exclude="1">
            <column table="sr_opl" column="vid_real" />
            <const>0</const>
          </call>
          <call function="is not null">
            <column table="sr_opl" column="num_sf" />
          </call>
          <call function="!=0">
            <column table="sr_opl" column="num_sf" />
          </call>
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_akt_test" timestamp="17.07.2020 19:31:38" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" />
        <const as="doc_type">'акт сверки sr_akt'</const>
        <column table="sr_akt" column="kod" as="kod_doc" />
        <call function="to_char" as="num_doc">
          <column table="sr_akt" column="act_number" as="num_doc" />
        </call>
        <call function="if" type="number" as="akt_edo">
          <call function="is not null">
            <column table="akt_edo" column="kod_dog" />
          </call>
          <const>1</const>
        </call>
        <call function="if" type="number" as="akt_not_edo">
          <call function="is null">
            <column table="akt_edo" column="kod_dog" />
          </call>
          <const>1</const>
        </call>
      </select>
      <from>
        <query name="sr_akt">
          <elink name="sr_akt_text">
            <link name="kod_dog" />
          </elink>
        </query>
        <query name="55865_akt_edo" join="left outer" as="akt_edo">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_s" />
            <useparam name="p_ym_po" />
          </withparams>
          <call function="and">
            <call function="=">
              <call function="date to ym">
                <column table="sr_akt" column="dat_akt" />
              </call>
              <column table="akt_edo" column="ym" />
            </call>
            <call function="=">
              <column table="kod_dog" column="kod_dog" />
              <column table="akt_edo" column="kod_dog" />
            </call>
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="ge">
            <call function="date to ym">
              <column table="sr_akt" column="dat_akt" />
            </call>
            <useparam name="p_ym_s" />
          </call>
          <call function="le">
            <call function="date to ym">
              <column table="sr_akt" column="dat_akt" />
            </call>
            <useparam name="p_ym_po" />
          </call>
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_naryad_test" timestamp="17.07.2020 18:56:53" visible="0">
      <params>
        <param name="p_dep" type="array" />
        <param name="p_ym_s" type="number" />
        <param name="p_ym_po" type="number" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" />
        <const as="doc_type">'наряды br_oto_*'</const>
        <const as="naryad_cnt">1</const>
        <call function="to_char" as="num_doc">
          <column table="a" column="ordnum" as="doc_num" />
        </call>
      </select>
      <from>
        <query as="a">
          <union>
            <query>
              <select>
                <column table="oto_order_obj" column="kod_dog" group="1" />
                <column table="oto_order" column="on_off" group="1" />
                <column table="oto_order" column="ordnum" group="1" />
                <column table="oto_order" column="orddat" group="1" />
              </select>
              <from>
                <query name="br_oto_order" as="oto_order" />
                <query name="br_oto_obj" join="left outer" as="oto_order_obj">
                  <call function="=">
                    <column table="oto_order_obj" column="kod" />
                    <column table="oto_order" column="kod" />
                  </call>
                </query>
              </from>
              <where>
                <call function="and">
                  <call function="ge">
                    <call function="date to ym">
                      <column table="oto_order" column="orddat" />
                    </call>
                    <useparam name="p_ym_s" />
                  </call>
                  <call function="le">
                    <call function="date to ym">
                      <column table="oto_order" column="orddat" />
                    </call>
                    <useparam name="p_ym_po" />
                  </call>
                </call>
              </where>
            </query>
            <query>
              <select>
                <column table="oto_on" column="kod_dog" group="1" />
                <const as="on_off" group="1">1</const>
                <column table="oto_on" column="nn" group="1" />
                <column table="oto_on" column="dat_n" group="1" />
              </select>
              <from>
                <query name="br_oto_obj" as="oto_on" />
              </from>
              <where>
                <call function="and">
                  <call function="ge">
                    <call function="date to ym">
                      <column table="oto_on" column="dat_n" />
                    </call>
                    <useparam name="p_ym_s" />
                  </call>
                  <call function="le">
                    <call function="date to ym">
                      <column table="oto_on" column="dat_n" />
                    </call>
                    <useparam name="p_ym_po" />
                  </call>
                </call>
              </where>
            </query>
            <query>
              <select>
                <column table="oto_ff" column="kod_dog" group="1" />
                <const as="on_off" group="0">1</const>
                <column table="oto_ff" column="nn_off" group="1" />
                <column table="oto_ff" column="dat_n_off" group="1" />
              </select>
              <from>
                <query name="br_oto_obj" as="oto_ff" />
              </from>
              <where>
                <call function="and">
                  <call function="ge">
                    <call function="date to ym">
                      <column table="oto_ff" column="dat_n_off" />
                    </call>
                    <useparam name="p_ym_s" />
                  </call>
                  <call function="le">
                    <call function="date to ym">
                      <column table="oto_ff" column="dat_n_off" />
                    </call>
                    <useparam name="p_ym_po" />
                  </call>
                </call>
              </where>
            </query>
          </union>
        </query>
        <query name="kr_dogovor" join="inner" as="kod_dog">
          <call function="=">
            <column table="kod_dog" column="kod_dog" />
            <column table="a" column="kod_dog" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="55865_pret_test" timestamp="17.07.2020 19:31:13" visible="0">
      <params>
        <param name="p_dep" type="array">
          <const>102276623</const>
        </param>
        <param name="p_ym_s" type="number">
          <const>2020.07</const>
        </param>
        <param name="p_ym_po" type="number">
          <const>2020.07</const>
        </param>
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" />
        <const as="doc_type" type="string">'претензии kr_pret'</const>
        <column table="kr_pret" column="kod_pret" as="kod_doc" />
        <call function="||" as="dat_form">
          <const>'Дата формирования: '</const>
          <column table="kr_pret" column="name" />
        </call>
        <call function="if" type="number" as="pret_edo">
          <call function="=1">
            <call function="is_dog_edo">
              <column table="kod_dog" column="kod_dog" />
            </call>
          </call>
          <const>1</const>
        </call>
        <call function="if" type="number" as="pret_not_edo">
          <call function="=0">
            <call function="is_dog_edo">
              <column table="kod_dog" column="kod_dog" />
            </call>
          </call>
          <const>1</const>
        </call>
      </select>
      <from>
        <query name="kr_pret">
          <link name="kod_dog" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="ge">
            <call function="date to ym">
              <column table="kr_pret" column="dat_form" />
            </call>
            <useparam name="p_ym_s" />
          </call>
          <call function="le">
            <call function="date to ym">
              <column table="kr_pret" column="dat_form" />
            </call>
            <useparam name="p_ym_po" />
          </call>
          <call function="in" optional="1">
            <column table="kod_dog" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
  </queries>
</root>