<?xml version="1.0" encoding="utf-8"?>
<root timestamp="2025-06-29T01:41:11.6457363+03:00">
  <customers child-name="customer" key-name="id" />
  <queries child-name="query" key-name="name">
    <query name="61880_10_main_ryaz" nogrid="1" timestamp="06.04.2025 15:51:07" file="sql.builder.templates\sql.builder\projects\ryazan\reports\61880_10_ryaz.xml">
      <params>
        <param name="is_dog" type="number">
          <const type="number">1</const>
        </param>
      </params>
      <select>
        <column table="gr_potr" column="kod_gr" as="kod_gr" />
        <call function="if" group="max" as="name" type="string">
          <call function="=">
            <column table="gr_potr" column="kod_sub_gr" />
            <const type="number">0</const>
          </call>
          <column table="gr_potr" column="name" />
        </call>
        <column table="gr_potr" column="kod_sub_gr" />
        <column column="name" group="max" table="gr_potr" as="name_p" type="string" exclude="1" />
        <call function="if" group="max" as="name_p" type="string">
          <call function="=">
            <column table="gr_potr" column="kod_sub_gr" />
            <const type="number">0</const>
          </call>
          <const type="string">'!deleterow'</const>
          <column table="gr_potr" column="name" type="string" />
        </call>
        <column table="d" column="kod_dog" as="kod_dog" type="number" />
        <call function="||" as="name_dog" group="max" exclude="1">
          <column table="b" column="payer_name" />
          <const>' '</const>
          <column table="b" column="ndog" />
        </call>
        <column group="max" table="d" column="ndog" as="name_dog" />
        <column group="sum" table="b" column="cust_kvth_in_period" mp="-3" as="cust_kvth_per" />
        <column group="sum" table="b" column="saldo_beg" mp="-3" exclude="1" />
        <call group="sum" function="-nvl" as="saldo_beg" mp="-3">
          <column table="b" column="dz_beg" />
          <column table="b" column="kz_beg" />
        </call>
        <column group="sum" table="b" column="nachisl_osn_in_period" mp="-3" as="nachisl_per" />
        <column group="sum" table="b" column="nachisl_osn_in_period_fact" mp="-3" as="nachisl_fact_per" />
        <column group="sum" table="b" column="opl_all_in_period" mp="-3" as="opl_per" />
        <column group="sum" table="b" column="realiz_per" mp="-3" exclude="1" />
        <call group="sum" function="-nvl" as="realiz_per" mp="-3">
          <call function="+nvl">
            <column table="b" column="dz_beg" />
            <column table="b" column="nachisl_osn_in_period" />
          </call>
          <column table="b" column="dz_end" />
          <column table="b" column="spis_dz" />
        </call>
        <column table="b" column="spis_dz" group="sum" mp="-3" as="spis_bezn_per" />
        <call function="-nvl" as="saldo_end" group="sum" mp="-3">
          <column table="b" column="dz_end" />
          <column table="b" column="kz_end" />
        </call>
        <column group="sum" table="b" column="dz_end" mp="-3" as="saldo_deb_end" />
        <column group="sum" table="b" column="kz_end" mp="-3" as="saldo_kred_end" />
        <column group="sum" table="b" column="dz_end_tek" mp="-3" as="dz_end_tek" exclude="1" />
        <call group="sum" function="-nvl" as="dz_end_tek" mp="-3">
          <column table="b" column="dz_end" />
          <column table="b" column="overdue_dz_end" />
        </call>
        <column group="sum" table="b" column="dz_end_rest" mp="-3" exclude="1" />
        <const group="sum" table="b" column="dz_end_rest" mp="-3" as="dz_end_rest" type="number">0</const>
        <column group="sum" table="b" column="overdue_dz_end" mp="-3" as="dz_end_pros" />
        <column group="sum" table="b" column="dz_end_isk" mp="-3" exclude="1" />
        <const group="sum" table="b" column="dz_end_isk" mp="-3" type="number" as="dz_end_isk">0</const>
        <column group="sum" table="b" column="dz_end_mor" mp="-3" as="dz_end_mor" exclude="1" />
        <const group="sum" table="b" column="dz_end_mor" mp="-3" as="dz_end_mor" type="number">0</const>
        <column group="sum" table="b" column="dz_end_bezn" mp="-3" exclude="1" />
        <const group="sum" table="b" column="dz_end_bezn" mp="-3" as="dz_end_bezn" type="number">0</const>
        <column group="sum" table="b" column="dz_rezerv" mp="-3" exclude="1" />
        <const group="sum" table="b" column="dz_rezerv" mp="-3" as="dz_rezerv" type="number">0</const>
      </select>
      <from>
        <query name="61880_10-spr_gr_potr_ryaz" as="gr_potr" />
        <query name="rr_refprop_dog_81_ryaz" as="r81" join="left outer">
          <call function="=">
            <column table="gr_potr" column="kod_refcode" />
            <column table="r81" column="num" />
          </call>
        </query>
        <query name="rr_rep_dog" as="d" join="left outer">
          <call function="=">
            <column table="r81" column="kod_numobj" />
            <column table="d" column="kod_numobj" />
          </call>
        </query>
        <query name="rr_rep_dz_kz_dog" as="b" join="left outer">
          <call function="and">
            <call function="=">
              <column table="d" column="kod_numobj" />
              <column table="b" column="kod_numobj" />
            </call>
          </call>
        </query>
      </from>
      <grouping>
        <grset as="itog">
          <grset as="gr_potr" order="kod_gr">
            <group>
              <column table="this" column="kod_gr" />
            </group>
            <grset as="gr_potr_p" order="kod_sub_gr">
              <group>
                <column table="this" column="kod_sub_gr" />
              </group>
              <grset as="dog_p" order="name_dog">
                <group>
                  <column table="this" column="kod_dog" />
                </group>
                <where>
                  <call function="and">
                    <call function="=1">
                      <call function="nvlu">
                        <useparam name="is_dog" />
                        <const>0</const>
                      </call>
                    </call>
                    <call function="is not null" exclude="1">
                      <column table="this" column="kod_dog" />
                    </call>
                  </call>
                </where>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="61880_10-spr_gr_potr_ryaz" class="1" timestamp="19.08.2022 11:06:38" file="sql.builder.templates\sql.builder\projects\ryazan\reports\61880_10_ryaz.xml">
      <select>
        <column table="a" column="kod_gr" type="number" />
        <column table="a" column="kod_sub_gr" type="number" />
        <column table="a" column="name" type="string" />
        <column table="a" column="kod_refcode" type="number" />
      </select>
      <from>
        <table name="61880_10-spr_gr_potr_ryaz" as="a" view="1" />
      </from>
    </query>
    <query name="64649_ryaz_data" timestamp="20.12.2024 18:34:26" file="sql.builder.templates\sql.builder\projects\ryazan\reports\64649_ryaz.xml">
      <params>
        <param type="array" name="p_dep">
          <const exclude="1">1172</const>
        </param>
        <param name="p_ym_beg" type="number">
          <const type="number" exclude="1">2024.08</const>
        </param>
      </params>
      <select>
        <column table="d" column="kod_dog" />
        <column group="max" table="p" column="allname" as="fname" />
        <column group="max" table="p" column="inn" as="inn" />
        <column table="v" column="name" group="max" as="vdog" exclude="1" />
        <const table="v" column="name" group="max" as="vdog" type="string">'покупки'</const>
        <column table="d" column="dat_dog" as="date_dog" type="date" function="to_char0" group="max" />
        <call function="case" group="max" as="date_compare" type="date">
          <call function="when">
            <call function="between">
              <call function="mes">
                <useparam name="p_ym_beg" />
              </call>
              <const>1</const>
              <const>6</const>
            </call>
            <call function="to_date">
              <call function="||">
                <const>'30.06.'</const>
                <call function="to_char">
                  <call function="trunc">
                    <useparam name="p_ym_beg" />
                  </call>
                </call>
              </call>
              <const>'dd.mm.yyyy'</const>
            </call>
          </call>
          <call function="else">
            <call function="to_date">
              <call function="||">
                <const>'31.12.'</const>
                <call function="to_char">
                  <call function="trunc">
                    <useparam name="p_ym_beg" />
                  </call>
                </call>
              </call>
              <const>'dd.mm.yyyy'</const>
            </call>
          </call>
        </call>
        <call function="case" group="max" as="date_fin_compare" type="date">
          <call function="when">
            <call function="between">
              <call function="mes">
                <useparam name="p_ym_beg" />
              </call>
              <const>1</const>
              <const>6</const>
            </call>
            <call function="to_date">
              <call function="||">
                <const>'01.01.'</const>
                <call function="to_char">
                  <call function="trunc">
                    <useparam name="p_ym_beg" />
                  </call>
                </call>
              </call>
              <const>'dd.mm.yyyy'</const>
            </call>
          </call>
          <call function="else">
            <call function="to_date">
              <call function="||">
                <const>'01.07.'</const>
                <call function="to_char">
                  <call function="trunc">
                    <useparam name="p_ym_beg" />
                  </call>
                </call>
              </call>
              <const>'dd.mm.yyyy'</const>
            </call>
          </call>
        </call>
        <column function="if" as="region_name" type="string" group="max" table="d" column="adress_region_name" />
      </select>
      <from>
        <query name="kr_dogovor" as="d" />
        <query name="kr_payer" join="left outer" as="p">
          <call function="=">
            <column table="d" column="kodp" />
            <column table="p" column="kodp" />
          </call>
        </query>
        <query name="ks_okved" as="k" join="left outer">
          <call function="=">
            <column table="p" column="kod_okved" />
            <column table="k" column="kod_okved" />
          </call>
        </query>
        <query name="ks_vdog" as="v" join="left outer">
          <call function="=">
            <column table="d" column="kod_vdog" />
            <column table="v" column="kod_vdog" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column function="true" table="d" column="dep" />
            <useparam name="p_dep" />
          </call>
          <call function="in">
            <column table="d" column="pr_active" />
            <const>(0,1)</const>
          </call>
          <call function="=">
            <column function="=" table="d" column="kod_vdog" />
            <const function="=">221</const>
          </call>
          <call function="=">
            <column table="k" column="kod_str_ies" />
            <const>10414</const>
          </call>
          <call function="in">
            <column table="p" column="kod_ecls" />
            <const>(4,7)</const>
          </call>
          <call function="le">
            <column table="this" column="date_dog" />
            <column table="this" column="date_compare" />
          </call>
          <call function="or">
            <call function="is null">
              <column table="d" column="dat_fin" />
            </call>
            <call function="ge">
              <column table="d" column="dat_fin" />
              <column table="this" column="date_fin_compare" />
            </call>
          </call>
        </call>
      </where>
      <grouping>
        <grset as="grdog" order="date_dog">
          <group>
            <column table="d" column="kod_dog" />
          </group>
        </grset>
      </grouping>
    </query>
    <query name="64950_ryaz" is-report="1" title="52. Раскрытие до 26 числа по ЦЗ (Приложение 127 к запросу ОАО 'АТС' 'Объемы и стоимости потребленной электрической энергии (мощности) по уровням напряжения')" nogrid="1" order="kod_level_voltage" timestamp="31.10.2024 15:01:08" file="sql.builder.templates\sql.builder\projects\ryazan\reports\64950_ryaz.xml">
      <customers>
        <customer id="310" />
      </customers>
      <print-templates>
        <excel>
          <template name="64950.xlsx" title="Приложение 127 к запросу ОАО 'АТС' 'Объемы и стоимости потребленной электрической энергии (мощности) по уровням напряжения'" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <content>
        <usefield field="asuse_dep" name="p_dep" mandatory="1" />
        <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" show-checkbox="0" />
        <usefield field="asuse_adr_m_obj_dep_sng" name="kod_adr_m" show-checkbox="0" as="" title="Субъект Федерации" mandatory="1" />
      </content>
      <procedure><![CDATA[begin
    delete vr_number_array;
 

for rec in (select * from kr_org where kodp in :p_dep)
    loop
       insert into vr_number_array (array_id,val) 
       values ('p_dep',rec.kodp);
    end loop;
 
/* 
for rec in (select tp from adr_m where kod_m in :kod_adr_m)
     loop
       insert into vr_number_array (array_id,val) 
       values ('kod_adr_m',rec.tp);
     end loop;

*/
for rec in (select substr(oktmo,1,2) as sub_rf_oktmo from adr_m where kod_m in :kod_adr_m)
    loop
      insert into vr_number_array (array_id,val) 
      values ('sub_rf_oktmo',rec.sub_rf_oktmo);
    end loop;

sqlb_rep_64950.fill_table_ryaz(:p_ym);
end;     


  ]]></procedure>
      <select>
        <query table="a" column="sub_rf" as="sub_rf" group="max" function="if">
          <select function="nvl">
            <column table="v" column="val" />
          </select>
          <from>
            <query name="vr_number_array" as="v" />
          </from>
          <where>
            <call function="=">
              <column table="v" column="array_id" />
              <const type="string">'sub_rf_oktmo'</const>
            </call>
          </where>
        </query>
        <call group="max" as="ym_first_day" function="kg_ym_first_day">
          <useparam name="p_ym" />
        </call>
        <column table="a" column="dep_name" as="dep_name" type="string" group="stragg_dist" />
        <column table="a" column="pr_opt" as="pr_opt" title="Признак ГТП(опт)" />
        <call table="a" column="kod_gtp" type="string" as="kod_gtp" function="if">
          <call function="=">
            <column table="a" column="pr_opt" />
            <const type="number">0</const>
          </call>
          <const type="string">'PPPPPPP1'</const>
          <column table="a" column="kod_gtp" />
        </call>
        <const table="a" column="kod_eso" as="kod_eso" function="if" type="string" title="Код участника АТС" group="stragg_dist">'RYAZENGR'</const>
        <column table="a" column="kod_level_voltage" type="number" as="kod_level_voltage" />
        <column table="a" column="pr_dkp" as="pr_dkp" comment="Признак ДКП (договор купли-продажи)" title="Признак ДКП" />
        <call group="sum" table="a" column="cust_kvth" as="cust_kvth" nvl="0" function="if">
          <call function="=">
            <column table="a" column="pr_dkp" />
            <const type="number">1</const>
          </call>
          <const>0</const>
          <column table="a" column="cust_kvth" />
        </call>
        <call group="sum" table="a" column="nach" as="nach" nvl="0" function="if">
          <call function="=">
            <column table="a" column="pr_dkp" />
            <const>1</const>
          </call>
          <const>0</const>
          <column table="a" column="nach" />
        </call>
        <call group="sum" table="a" column="nas_cust_kvth" as="nas_cust_kvth" nvl="0" function="if">
          <call function="=">
            <column table="a" column="pr_dkp" />
            <const>1</const>
          </call>
          <const>0</const>
          <column table="a" column="nas_cust_kvth" />
        </call>
        <call group="sum" table="a" column="nas_nach" as="nas_nach" nvl="0" function="if">
          <call function="=">
            <column table="a" column="pr_dkp" />
            <const>1</const>
          </call>
          <const>0</const>
          <column table="a" column="nas_nach" />
        </call>
        <call group="sum" as="cust_kvth_1" nvl="0" function="if">
          <call function="=">
            <column table="a" column="pr_dkp" />
            <const>1</const>
          </call>
          <column table="a" column="cust_kvth" />
          <const>0</const>
        </call>
        <call group="sum" as="nach_1" nvl="0" function="if">
          <call function="=">
            <column table="a" column="pr_dkp" />
            <const>1</const>
          </call>
          <column table="a" column="nach" />
          <const>0</const>
        </call>
        <call group="sum" as="nas_cust_kvth_1" nvl="0" function="if">
          <call function="=">
            <column table="a" column="pr_dkp" />
            <const>1</const>
          </call>
          <column table="a" column="nas_cust_kvth" />
          <const>0</const>
        </call>
        <call group="sum" as="nas_nach_1" nvl="0" function="if">
          <call function="=">
            <column table="a" column="pr_dkp" />
            <const>1</const>
          </call>
          <column table="a" column="nas_nach" />
          <const>0</const>
        </call>
      </select>
      <from>
        <query name="sqlb_rep_64950_tbl" as="a" />
      </from>
      <grouping>
        <grset as="itog">
          <grset as="level">
            <group>
              <column table="this" column="kod_level_voltage" />
            </group>
          </grset>
          <grset as="gtp" order="kod_gtp nulls last">
            <group>
              <column table="this" column="kod_gtp" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="72257_data" timestamp="14.08.2024 23:31:23" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72257.xml">
      <select>
        <column table="c" column="ym" type="number" nvl="0" as="ym" />
        <call function="mes-name" type="string" as="month" group="max">
          <call function="mes">
            <column name="p_ym" table="c" column="ym" />
          </call>
        </call>
        <call function="year" as="year" type="number" group="max">
          <call function="ym end time">
            <column name="p_ym" table="c" column="ym" />
          </call>
        </call>
        <column table="c" column="kod_dog" type="number" as="kod_dog" />
        <column table="c" column="kod_sf" type="number" as="kod_sf" />
        <column table="d" column="ndog" type="string" group="max" />
        <column table="d" column="payer_name" type="string" group="max" />
        <column table="c" column="dat_sf" type="date" group="max" />
        <column table="c" column="nom_sf" type="string" group="max" />
        <column table="c" column="nachisl" group="sum" type="number" nvl="0" />
        <column table="c" column="nal" group="sum" type="number" nvl="0" />
        <column table="c" column="nachisl_re" group="sum" type="number" nvl="0" />
        <column table="c" column="nal_re" group="sum" type="number" nvl="0" />
      </select>
      <from>
        <query name="rr_rep_dz_kz" as="c" />
        <query name="rr_rep_dog" as="d" join="inner">
          <call function="=">
            <column table="c" column="kod_dog" />
            <column table="d" column="kod_dog" />
          </call>
        </query>
      </from>
      <grouping>
        <grset as="itog" />
        <grset order="ym" as="ym">
          <group>
            <column table="this" column="ym" type="number" />
          </group>
          <grset order="ndog" as="dog">
            <group>
              <column table="this" column="kod_dog" type="number" />
            </group>
            <grset order="nom_sf" as="sf">
              <group>
                <column table="this" column="kod_sf" type="number" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="72319_data" title="Основной запрос для отчета № 34" timestamp="10.04.2025 12:57:36" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72319.xml">
      <params>
        <param name="p_is_flag" type="number">
          <const type="number">0</const>
        </param>
      </params>
      <select>
        <call function="row_number" as="rwn">
          <call function="order by simple">
            <column table="this" column="ndog" />
          </call>
        </call>
        <column table="d" column="kod_dog" type="number" as="kod_dog" />
        <column table="d" column="ndog" type="string" as="ndog" group="stragg_dist" />
        <column table="d" column="payer_name" type="string" as="payer_name" group="max" />
        <call as="saldo_beg" function="-nvl" group="sum">
          <column column="dz_beg" nvl="0" table="c" type="number" />
          <column column="kz_beg" nvl="0" table="c" type="number" />
        </call>
        <call as="expected_payment" function="+nvl" group="sum">
          <column table="c" column="nachisl_av_per_period" type="number" nvl="0" />
          <call function="if">
            <call function="lt">
              <column table="this" column="saldo_beg" type="number" nvl="0" />
              <const type="number">0</const>
            </call>
            <const type="number">0</const>
            <column table="this" column="saldo_beg" type="number" nvl="0" />
          </call>
          <call function="if" optional="1">
            <call function="and">
              <call function="=">
                <useparam table="this" column="saldo_beg" type="number" nvl="0" name="p_is_flag" />
                <const type="number">1</const>
              </call>
              <call function="=">
                <column table="d" column="kod_perper" type="number" nvl="0" name="p_is_flag" />
                <const type="number">0</const>
              </call>
            </call>
            <column table="c" column="nachisl_osn_in_period" type="number" nvl="0" />
            <const type="number">0</const>
          </call>
        </call>
      </select>
      <from>
        <query name="rr_rep_dz_kz_dog" as="c" />
        <query name="rr_rep_dog" as="d" join="inner">
          <call function="=">
            <column table="c" column="kod_dog" />
            <column table="d" column="kod_dog" />
          </call>
        </query>
      </from>
      <grouping>
        <grset as="itog">
          <grset order="ndog" as="dog">
            <group>
              <column table="this" column="kod_dog" type="number" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="72418_data" title="Запрос для отчета № 19" timestamp="08.08.2024 09:43:16" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72418.xml">
      <select>
        <call function="nvlu" as="cust">
          <column table="v" column="n1" type="number" />
          <const type="number">0</const>
        </call>
      </select>
      <from>
        <table name="rr_temp" as="v" />
      </from>
      <where>
        <call function="=">
          <column table="v" column="skod" />
          <const>'{3d8b60b1-6cd0-416a-ac16-8c99c9d294fb}'</const>
        </call>
      </where>
    </query>
    <query name="72430_data" title="Основной запрос к отчёту № 18 (РГМЭК)" timestamp="04.03.2025 16:07:00" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72430.xml">
      <params>
        <param type="array" name="p_kod_m_srf" />
        <param name="p_no_detail" type="number" />
      </params>
      <select>
        <call function="row_number" as="rw_n" key="1">
          <call function="order by simple">
            <column table="this" column="kod_m_srf_name" />
            <column table="this" column="kod_m_srf" />
          </call>
        </call>
        <column table="a" type="number" column="kod_m_srf" as="kod_m_srf" nvl="0" key="1" />
        <column table="adr_m" type="string" column="name_p" as="kod_m_srf_name" title="Наименование субъекта Рф" group="max" />
        <column table="a" type="number" column="nachisl_osn_in_period" as="nachisl_osn_in_period" group="sumnvl" mp="-6" nvl="0" />
        <call group="sum" function="if" as="nachisl_osn_in_period_iku" type="number" mp="-6">
          <call function="=">
            <column table="dog" column="forma_dog" />
            <const type="number">1</const>
          </call>
          <column table="a" column="nachisl_osn_in_period" nvl="0" />
        </call>
        <call group="sum" function="if" as="nachisl_osn_in_period_other" type="number" mp="-6">
          <call function="!=">
            <column table="dog" column="forma_dog" />
            <const type="number">1</const>
          </call>
          <column table="a" column="nachisl_osn_in_period" nvl="0" />
        </call>
        <column table="a" type="number" column="opl_all_in_period" as="opl_in_period" group="sumnvl" mp="-6" nvl="0" />
        <call group="sum" function="if" as="opl_in_period_iku" type="number" mp="-6">
          <call function="=">
            <column table="dog" column="forma_dog" />
            <const type="number">1</const>
          </call>
          <column table="a" column="opl_all_in_period" nvl="0" />
        </call>
        <call group="sum" function="if" as="opl_in_period_other" type="number" mp="-6">
          <call function="!=">
            <column table="dog" column="forma_dog" />
            <const type="number">1</const>
          </call>
          <column table="a" column="opl_all_in_period" nvl="0" />
        </call>
        <column table="a" type="number" column="dz_end" as="dz_end" group="sumnvl" mp="-6" nvl="0" />
        <call group="sum" function="if" as="dz_end_iku" type="number" mp="-6">
          <call function="=">
            <column table="dog" column="forma_dog" />
            <const type="number">1</const>
          </call>
          <column table="a" column="dz_end" nvl="0" />
        </call>
        <call group="sum" function="if" as="dz_end_other" type="number" mp="-6">
          <call function="!=">
            <column table="dog" column="forma_dog" />
            <const type="number">1</const>
          </call>
          <column table="a" column="dz_end" nvl="0" />
        </call>
        <column table="a" type="number" column="overdue_dz_end" as="overdue_dz_end" group="sumnvl" mp="-6" nvl="0" />
        <call group="sum" function="if" as="overdue_dz_end_iku" type="number" mp="-6">
          <call function="=">
            <column table="dog" column="forma_dog" />
            <const type="number">1</const>
          </call>
          <column table="a" column="overdue_dz_end" nvl="0" />
        </call>
        <call group="sum" function="if" as="overdue_dz_end_other" type="number" mp="-6">
          <call function="!=">
            <column table="dog" column="forma_dog" />
            <const type="number">1</const>
          </call>
          <column table="a" column="overdue_dz_end" nvl="0" />
        </call>
        <column table="a" type="number" column="spis_dz" as="spis_dz" group="sumnvl" mp="-6" nvl="0" />
        <call group="sum" function="if" as="spis_dz_iku" type="number" mp="-6">
          <call function="=">
            <column table="dog" column="forma_dog" />
            <const type="number">1</const>
          </call>
          <column table="a" column="spis_dz" nvl="0" />
        </call>
        <call group="sum" function="if" as="spis_dz_other" type="number" mp="-6">
          <call function="!=">
            <column table="dog" column="forma_dog" />
            <const type="number">1</const>
          </call>
          <column table="a" column="spis_dz" nvl="0" />
        </call>
        <column table="a" type="number" column="kz_end" as="kz_end" group="sumnvl" mp="-6" nvl="0" />
      </select>
      <from>
        <query name="rr_rep_dz_kz_dog" as="a" />
        <query join="inner" name="rr_rep_dog" as="dog">
          <call function="=">
            <column table="a" column="kod_numobj" />
            <column table="dog" column="kod_numobj" />
          </call>
        </query>
        <query name="adr_m" as="adr_m" join="inner">
          <call function="=">
            <column table="a" column="kod_m_srf" />
            <column table="adr_m" column="kod_m" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in" optional="1">
            <column table="a" column="kod_m_srf" />
            <useparam name="p_kod_m_srf" />
          </call>
        </call>
      </where>
      <grouping>
        <grset as="itog">
          <grset order="kod_m_srf_name" as="srf">
            <group>
              <column table="this" column="kod_m_srf" type="number" />
            </group>
            <where>
              <call function="and">
                <call function="=">
                  <call function="nvlu">
                    <useparam name="p_no_detail" />
                    <const>0</const>
                  </call>
                  <const>1</const>
                </call>
              </call>
            </where>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="72482_data" timestamp="15.08.2024 00:00:29" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72482.xml">
      <select>
        <column table="c" column="kod_dog" type="number" as="kod_dog" />
        <column table="d" column="ndog" type="string" group="max" />
        <column table="d" column="payer_name" type="string" group="max" />
        <column table="c" column="kod_sf" as="kod_sf" type="number" />
        <column table="c" column="nom_sf" type="string" group="max" />
        <call table="c" column="nachisl" group="sum" type="number" nvl="0" as="nach" function="-">
          <column table="c" column="nachisl" nvl="0" />
          <column table="c" column="nal" nvl="0" />
        </call>
        <column table="c" column="nachisl" group="sum" type="number" nvl="0" />
        <column table="c" column="nal" group="sum" type="number" nvl="0" />
        <call table="c" column="nachisl" group="sum" type="number" nvl="0" as="nach_re" function="-">
          <column table="c" column="nachisl_re" nvl="0" />
          <column table="c" column="nal_re" nvl="0" />
        </call>
        <column table="c" column="nachisl_re" group="sum" type="number" nvl="0" />
        <column table="c" column="nal_re" group="sum" type="number" nvl="0" />
      </select>
      <from>
        <query name="rr_rep_dz_kz" as="c" />
        <query name="rr_rep_dog" as="d" join="inner">
          <call function="=">
            <column table="c" column="kod_dog" />
            <column table="d" column="kod_dog" />
          </call>
        </query>
      </from>
      <grouping>
        <grset as="itog" />
        <grset order="ndog" as="dog">
          <group>
            <column table="this" column="kod_dog" type="number" />
          </group>
          <grset order="nom_sf" as="sf">
            <group>
              <column table="this" column="kod_sf" type="string" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="72544_main_data" title="Основной запрос к отчету № 8" order="fo_name,region_name,guarantp_name" timestamp="24.12.2024 14:41:40" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72544.xml">
      <select>
        <column table="a" column="n1" as="kod_fo" type="number" title="Код федерального округа" />
        <column table="a" column="s1" as="fo_name" type="string" title="Наименование федерального округа" group="stragg_dist" />
        <column table="a" column="n2" as="kod_m" type="number" title="Код региона" />
        <column table="a" column="s2" as="region_name" type="string" title="Наименование региона" group="stragg_dist" />
        <column table="a" column="n3" as="kodp" type="number" title="Код гарантирующего поставщика" />
        <column table="a" column="s3" as="guarantp_name" type="string" title="Наименование генерального поставщика" group="stragg_dist" />
        <column table="a" column="n4" as="gr1_part1_year1" type="number" title="Сбытовая надбавка за 1 полугодие первого года в гр. менее 670 " group="sum" />
        <column table="a" column="n5" as="gr1_part2_year1" type="number" title="Сбытовая надбавка за 2 полугодие первого года" group="sum" />
        <column table="a" column="n6" as="gr1_part1_year2" type="number" title="Сбытовая надбавка за 1 полугодие второго года" group="sum" />
        <column table="a" column="n7" as="gr1_part2_year2" type="number" title="Сбытовая надбавка за 2 полугодие второго года" group="sum" />
        <column table="a" column="n8" as="gr2_part1_year1" type="number" title="Сбытовая надбавка за 1 полугодие первого года от 670 до 10 МВт" group="sum" />
        <column table="a" column="n9" as="gr2_part2_year1" type="number" title="Сбытовая надбавка за 2 полугодие первого года" group="sum" />
        <column table="a" column="n10" as="gr2_part1_year2" type="number" title="Сбытовая надбавка за 1 полугодие второго года" group="sum" />
        <column table="a" column="n11" as="gr2_part2_year2" type="number" title="Сбытовая надбавка за 2 полугодие второго года" group="sum" />
        <column table="a" column="n12" as="gr3_part1_year1" type="number" title="Сбытовая надбавка за 1 полугодие первого года в гр не менее 10МВт" group="sum" />
        <column table="a" column="n13" as="gr3_part2_year1" type="number" title="Сбытовая надбавка за 2 полугодие первого года" group="sum" />
        <column table="a" column="n14" as="gr3_part1_year2" type="number" title="Сбытовая надбавка за 1 полугодие второго года" group="sum" />
        <column table="a" column="n15" as="gr3_part2_year2" type="number" title="Сбытовая надбавка за 2 полугодие второго года" group="sum" />
      </select>
      <from>
        <table name="rr_temp" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="skod" />
          <const type="string">'3d8b60b1-7254-416a-ac16-8c99c9d294fb'</const>
        </call>
      </where>
      <grouping>
        <grset order="fo_name" as="fo">
          <group>
            <column table="this" column="kod_fo" type="number" />
          </group>
          <grset order="region_name" as="region">
            <group>
              <column table="this" column="kod_m" type="number" />
            </group>
            <grset order="guarantp_name" as="gp">
              <group>
                <column table="this" column="kodp" type="number" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="guarantp_list" title="Гарантирующие поставщики для отчета по сбытовым надбавкам" timestamp="23.12.2024 19:19:19" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72544.xml">
      <params>
        <param name="p_guarantp" />
      </params>
      <select>
        <column table="t" column="kodp" as="kodp" group="1" />
        <column table="p" column="name" as="gp_name" group="max" />
      </select>
      <from>
        <query name="ks_tarif" as="t" />
        <query name="adr_m" as="a" join="inner">
          <call function="=">
            <column table="t" column="prizn_selo" />
            <column table="a" column="kod_m" />
          </call>
        </query>
        <query name="kr_org" join="inner" as="p">
          <call function="=">
            <column table="t" column="kodp" />
            <column table="p" column="kodp" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in" optional="1">
            <column table="t" column="kodp" />
            <useparam name="p_guarantp" />
          </call>
        </call>
      </where>
    </query>
    <query name="72544_title" title="Шапка отчета № 8" timestamp="24.12.2024 11:57:10" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72544.xml">
      <params>
        <param type="number" name="p_guarantp" />
      </params>
      <select>
        <call function="nvl" type="string" as="guarantp_name">
          <query>
            <select>
              <column table="gp" column="gp_name" as="gp_name" />
            </select>
            <from>
              <query name="guarantp_list" as="gp" />
            </from>
            <where>
              <call function="or">
                <call function="false" />
                <call function="=" optional="1">
                  <column column="kodp" table="gp" />
                  <useparam name="p_guarantp" />
                </call>
              </call>
            </where>
          </query>
          <const type="string">'все '</const>
        </call>
      </select>
      <from>
        <query name="dual" />
      </from>
    </query>
    <query name="72554_main_data" title="Основной запрос к отчёту № 12." timestamp="13.03.2025 10:42:09" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72554.xml">
      <select>
        <call function="row_number" as="rwn" type="number">
          <call function="order by simple">
            <column table="this" column="sname" key="1" />
          </call>
        </call>
        <column table="a" column="s1" as="sname" type="string" title="Наименование СО(ТСО)" />
        <column table="a" column="n1" as="inn" type="number" title="ИНН" />
        <column table="a" column="s2" as="status" type="string" title="добавлена/удалена" />
      </select>
      <from>
        <table name="rr_temp" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="is not null">
            <column table="this" column="status" />
          </call>
          <call function="=">
            <column table="a" column="skod" />
            <const type="string">'3d8b60b1-7255-416a-ac16-8c99c9d294fb'</const>
          </call>
        </call>
      </where>
    </query>
    <query name="72559_main_data" title="Основной запрос отчета № 13." order="n1" timestamp="15.01.2025 18:36:51" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72559.xml">
      <select>
        <column table="a" column="n1" type="number" as="srf_oktmo" title="Код субъекта РФ" key="1" fixed="1" />
        <column table="a" column="s1" type="string" as="kod_region_name" title="Наименование субъекта РФ" />
        <column table="a" column="s2" type="string" as="status_dep" title="Статус участия" />
        <column table="a" column="s3" type="string" as="status" title="Изменения" />
      </select>
      <from>
        <table name="rr_temp" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="=">
            <column table="a" column="skod" />
            <const type="string">'3d8b60b1-7255-916a-ac16-8c99c9d294fb'</const>
          </call>
        </call>
      </where>
    </query>
    <query name="72565_data" title="Основной запрос для отчета № 15" timestamp="26.11.2024 17:15:03" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72565.xml">
      <select>
        <column table="po" column="kod_region" as="kod_region" type="number" />
        <column table="po" column="region_name" type="string" as="region_name" group="max" />
        <column table="po" column="kod_okved" type="number" as="kod_okved" />
        <column table="okved" column="okved" type="string" as="okved" group="max" />
        <column table="okved" column="name_okved" type="string" as="name_okved" group="max" />
        <column table="okved" column="okved_level_1" type="string" as="okved_level_1" group="max" />
        <column table="okved" column="okved_level_2" type="string" as="okved_level_2" group="max" />
        <column table="okved" column="okved_level_3" type="string" as="okved_level_3" group="max" />
        <column table="po" column="kodp" as="kodp" type="number" />
        <column table="po" column="payer_name" type="string" as="payer_name" group="max" />
        <call function="if" as="cust_kvth" group="max">
          <call function="=">
            <column table="po" column="edizm" type="number" nvl="0" />
            <const type="number">4</const>
          </call>
          <column table="po" column="cust" type="number" nvl="0" />
          <const type="number">0</const>
        </call>
        <column table="this" column="cust_kvth" type="number" as="cust" group="sum" nvl="0" dimname="ym" mp="-6">
          <pivot>
            <call function="mes" as="ym">
              <column table="po" column="ym" />
            </call>
            <query>
              <select>
                <column table="m" column="mon" />
                <column table="m" column="name" as="t" />
                <column table="m" column="mon" as="n" />
              </select>
              <from>
                <query name="spr_time_mes" as="m" />
              </from>
            </query>
          </pivot>
        </column>
      </select>
      <from>
        <query name="rr_rep_po" as="po">
          <where>
            <call function="=">
              <column table="po" column="edizm" />
              <const type="number" comment="Отчёт только по Э/Э">4</const>
            </call>
          </where>
        </query>
        <query name="kv_okved_level" as="okved" join="left outer">
          <call function="=">
            <column table="po" column="kod_okved" />
            <column table="okved" column="kod_okved" />
          </call>
        </query>
      </from>
      <grouping>
        <grset as="itog" />
        <grset order="region_name" as="region">
          <group>
            <column table="this" column="kod_region" />
          </group>
          <grset order="okved_level_1,okved_level_2,okved_level_3" as="okved">
            <group>
              <column table="this" column="kod_okved" />
            </group>
            <grset order="payer_name" as="payer">
              <group>
                <column table="this" column="kodp" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="72587_data" title="Основной запрос к отчету № 17" timestamp="22.02.2025 14:40:18" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72587.xml">
      <select>
        <call function="dense_rank" as="tco_rwn" title="Номер строки ТСО">
          <call function="order by simple">
            <column table="this" column="tco_pwr_name" />
          </call>
        </call>
        <column table="r" column="n1" as="tco_pwr_kodp" title="kodp для ТСО (услуги по пеердаче)" type="number" />
        <column table="r" column="s1" as="tco_pwr_name" title="наименование ТСО (по услугам по передаче)" type="string" group="max" />
        <column table="r" column="n2" as="kod_region" />
        <column table="r" column="s2" as="region_name" group="max" />
        <column table="r" column="n3" as="gr_num" />
        <column table="r" column="s3" as="gr_name" group="max" />
        <column table="r" column="n4" as="voltage_fact" />
        <column table="r" column="s4" as="voltage_fact_abbr" group="max" />
        <column table="r" column="n5" as="cust_kvth_1" group="sum" nvl="0" />
        <column group="sum" table="r" column="n6" as="cust_kvth_2" nvl="0" />
        <column group="sum" table="r" column="n7" as="cust_kvt" nvl="0" mp="-3" />
      </select>
      <from>
        <query name="rr_temp" as="r" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="=">
            <column table="r" column="skod" />
            <const type="string">'{3d8b60b1-7258-716a-ac16-8c99c9d294fb}'</const>
          </call>
          <call function="or">
            <call function="!=">
              <column table="this" column="cust_kvth_1" />
              <const type="number">0</const>
            </call>
            <call function="!=">
              <column table="this" column="cust_kvth_2" />
              <const type="number">0</const>
            </call>
            <call function="!=">
              <column table="this" column="cust_kvt" />
              <const type="number">0</const>
            </call>
          </call>
        </call>
      </where>
      <grouping>
        <grset as="itog">
          <grset order="tco_pwr_name" as="tco">
            <group>
              <column table="this" column="tco_pwr_kodp" type="number" />
            </group>
            <grset as="r" order="region_name">
              <group>
                <column table="this" column="kod_region" />
              </group>
              <grset order="gr_num" as="gr">
                <group>
                  <column table="this" column="gr_num" type="number" />
                </group>
                <grset order="voltage_fact_abbr" as="volt">
                  <group>
                    <column table="this" column="voltage_fact" type="number" />
                  </group>
                </grset>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="72595_data_tco" timestamp="14.03.2025 12:34:06" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72595.xml">
      <select>
        <column table="r" column="n1" as="kodp" title="код ТСО" />
        <column table="r" column="s1" as="tco_name" group="max" />
        <column table="r" column="n5" as="max_power" title="максимальная мощность на объекте" nvl="0" group="sum" />
        <column table="r" column="n7" as="cust_kvth" nvl="0" group="sum" />
        <column table="r" column="n8" as="cust_kvt" nvl="0" group="sum" />
        <column table="r" column="n9" as="cust_kvt_set" nvl="0" group="sum" />
        <call group="sum" function="-" title="резервируемая мощность" as="pw_reserve">
          <column table="this" column="max_power" />
          <column table="this" column="cust_kvt_set" />
        </call>
        <column table="r" column="n11" title="генерирующая (Мощность фактическая по общему профилю ГТП) " as="pw" group="max" />
        <column table="r" column="n12" as="pw_set" title="сетевая (Мощность сетевая по общему профилю ГТП)" group="max" />
      </select>
      <from>
        <query name="rr_temp" as="r" />
      </from>
      <where>
        <call function="=">
          <column table="r" column="skod" />
          <const type="string">'{3d8b60b1-72595-ac16-8c99c9d294fb}'</const>
        </call>
      </where>
      <grouping>
        <grset as="itog" />
        <grset as="tco" order="tco_name">
          <group>
            <column table="this" column="kodp" />
          </group>
        </grset>
      </grouping>
    </query>
    <query name="72595_data_obj" timestamp="14.03.2025 14:24:44" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72595.xml">
      <select>
        <column table="r" column="n2" as="kod_dog" />
        <column table="r" column="s2" as="ndog" group="max" />
        <column table="r" column="n3" as="kod_numobj" />
        <column table="r" column="n4" as="numobj_num" group="max" />
        <column table="r" column="s3" as="numobj_name" group="max" />
        <column table="r" column="n5" as="max_power" title="максимальная мощность на объекте" nvl="0" group="sum" />
        <column table="r" column="n6" as="max_by_obj_per_period" title="максимальное числовое значение по объекту в течение месяца" group="max" />
        <column table="r" column="n7" as="cust_kvth" nvl="0" group="sum" />
        <column table="r" column="n8" as="cust_kvt" nvl="0" group="sum" />
        <column table="r" column="n9" as="cust_kvt_set" nvl="0" group="sum" />
        <column table="r" column="n11" title="генерирующая (Мощность фактическая по общему профилю ГТП) " as="pw" group="max" />
        <column table="r" column="n12" as="pw_set" title="сетевая (Мощность сетевая по общему профилю ГТП)" group="max" />
      </select>
      <from>
        <query name="rr_temp" as="r" />
      </from>
      <where>
        <call function="=">
          <column table="r" column="skod" />
          <const type="string">'{3d8b60b1-72595-ac16-8c99c9d294fb}'</const>
        </call>
      </where>
      <grouping>
        <grset as="itog" />
        <grset as="dog" order="ndog">
          <group>
            <column table="this" column="kod_dog" />
          </group>
          <grset as="numobj" order="numobj_num">
            <group>
              <column table="this" column="kod_numobj" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="72601_data" title="Основной запрос для отчета № 33" timestamp="21.06.2025 12:11:37" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72601.xml">
      <params>
        <param name="is_dog" type="number" />
      </params>
      <select>
        <column table="c" column="kod_dog" type="number" as="kod_dog" />
        <column table="d" column="ndog" type="string" as="ndog" group="max" />
        <column table="d" column="payer_name" type="string" as="payer_name" group="max" />
        <column column="dz_beg" nvl="0" table="c" type="number" group="sum" as="dz_beg" />
        <call group="sum" as="kz_beg" function="*" type="number">
          <const type="number" nvl="0">-1</const>
          <column table="c" column="kz_beg" type="number" nvl="0" />
        </call>
        <call as="saldo_beg" function="-nvl" group="sum" type="number">
          <column column="dz_beg" nvl="0" table="c" type="number" />
          <column column="kz_beg" nvl="0" table="c" type="number" />
        </call>
        <column table="c" column="nachisl_osn_in_period_fact" group="sum" type="number" nvl="0" />
        <column table="c" column="nachisl_osn_in_period_recalc" group="sum" type="number" nvl="0" />
        <column table="c" column="nachisl_sf_with_zero" group="sum" type="number" nvl="0" />
        <column group="sum" table="c" column="nachisl_gp_in_period" type="number" />
        <column group="sum" table="c" column="nachisl_pe_in_period" type="number" />
        <call group="sum" function="*" as="opl_all_in_period" title="Поступило оплаты" type="number">
          <const type="number" nvl="0">-1</const>
          <column table="c" column="opl_all_in_period" type="number" nvl="0" />
        </call>
        <call group="sum" function="*" as="transfer_opl_new" title="Зачтено в оплату" type="number">
          <const type="number" nvl="0">-1</const>
          <column table="c" column="transfer_opl_new" type="number" nvl="0" />
        </call>
        <call group="sum" function="*" as="transfer_opl_old" title="Списано с оплаты" type="number">
          <const type="number" nvl="0">-1</const>
          <call function="+nvl">
            <column table="c" column="refund_opl" type="number" nvl="0" />
            <column table="c" column="transfer_opl_old" type="number" nvl="0" />
          </call>
        </call>
        <column column="dz_end" nvl="0" table="c" type="number" group="sum" as="dz_end" />
        <call group="sum" as="kz_end" function="*" type="number">
          <const type="number" nvl="0">-1</const>
          <column table="c" column="kz_end" type="number" nvl="0" />
        </call>
        <call as="saldo_end" function="-nvl" group="sum" type="number">
          <column column="dz_end" nvl="0" table="c" type="number" />
          <column column="kz_end" nvl="0" table="c" type="number" />
        </call>
      </select>
      <from>
        <query name="rr_rep_dz_kz_dog" as="c" />
        <query name="rr_rep_dog" as="d" join="inner">
          <call function="=">
            <column table="c" column="kod_dog" />
            <column table="d" column="kod_dog" />
          </call>
        </query>
      </from>
      <grouping>
        <grset as="itog">
          <grset order="LPAD(ndog,10,'0')" as="dog">
            <group>
              <column table="this" column="kod_dog" type="number" />
            </group>
            <where>
              <call function="=1">
                <call function="nvlu">
                  <useparam name="is_dog" />
                  <const>0</const>
                </call>
              </call>
            </where>
          </grset>
        </grset>
      </grouping>
      <having>
        <call function="!=0">
          <column table="this" column="dz_beg" />
          <column table="this" column="kz_beg" />
          <column table="this" column="saldo_beg" />
          <column table="this" column="nachisl_osn_in_period_fact" />
          <column table="this" column="nachisl_osn_in_period_recalc" />
          <column table="this" column="nachisl_sf_with_zero" />
          <column table="this" column="nachisl_gp_in_period" />
          <column table="this" column="nachisl_pe_in_period" />
          <column table="this" column="opl_all_in_period" />
          <column table="this" column="transfer_opl_old" />
          <column table="this" column="transfer_opl_new" />
          <column table="this" column="dz_end" />
          <column table="this" column="kz_end" />
          <column table="this" column="saldo_end" />
        </call>
      </having>
    </query>
    <query name="72609_data" timestamp="07.02.2025 14:22:51" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72609.xml">
      <select>
        <column table="rr_temp" column="n1" as="tco_pwr_kodp" type="number" />
        <column group="max" table="rr_temp" column="s1" as="tco_pwr_name" title="наименование ТСО" type="string" />
        <column table="rr_temp" column="n2" title="номер группы потребителей ( 1 - прочие или 2 - население)      " as="gr_num" type="number" />
        <column table="rr_temp" column="s2" group="max" as="gr_name" title="наименование группы потребителей" type="string" />
        <call function="row_number" as="volt_rwn" title="Номер строки УН">
          <call function="partition by">
            <column table="this" column="tco_pwr_kodp" />
            <column table="this" column="gr_num" />
          </call>
          <call function="order by simple">
            <column table="this" column="voltage_fact_abbr" />
          </call>
        </call>
        <column table="rr_temp" column="n3" title="фактический УН" as="voltage_fact" type="number" />
        <column table="rr_temp" column="s3" type="string" as="voltage_fact_abbr" group="max" />
        <column table="rr_temp" column="n4" as="cust_kvth" title="натуральные показатели мощности: ПО КВтч" type="number" group="sum" mp="-3" />
        <column group="sum" table="rr_temp" column="n5" type="number" title="натуральные показатели э/э: ПО КВт" as="cust_kvt" mp="-3" />
      </select>
      <from>
        <query name="rr_temp" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="=">
            <column table="rr_temp" column="skod" />
            <const>'{3d8b60b1-7260-916a-ac16-8c99c9d294fb}'</const>
          </call>
          <call function="or">
            <call function="!=">
              <column table="this" column="cust_kvth" />
              <const type="number">0</const>
            </call>
            <call function="!=">
              <column table="this" column="cust_kvt" />
              <const type="number">0</const>
            </call>
          </call>
        </call>
      </where>
      <grouping>
        <grset as="itog">
          <grset order="tco_pwr_name" as="tco">
            <group>
              <column table="this" column="tco_pwr_kodp" type="number" />
            </group>
            <grset order="gr_num" as="gr">
              <group>
                <column table="this" column="gr_num" type="number" />
              </group>
              <grset order="voltage_fact_abbr" as="volt">
                <group>
                  <column table="this" column="voltage_fact" type="number" />
                </group>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="72852_data" title="Оновной запрос для отчета 35, 36." timestamp="25.11.2024 18:07:57" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72852.xml">
      <params>
        <param name="is_dog" type="number" />
      </params>
      <select>
        <column table="d" column="dep_id" type="number" />
        <column table="d" column="dep_name" type="string" group="max" />
        <column table="d" column="gr_cust_id" type="number" />
        <column table="d" column="gr_cust_num" type="number" group="max" />
        <column table="d" column="gr_cust_snum" type="string" group="max" />
        <column table="d" column="gr_cust_name" type="string" group="max" />
        <column table="c" column="kod_dog" type="number" as="kod_dog" />
        <column table="d" column="ndog" type="string" as="ndog" comment="Номер договора" group="max" />
        <call group="sum" as="saldo_beg" function="-nvl">
          <column table="c" column="dz_beg" type="number" nvl="0" />
          <column table="c" column="kz_beg" type="number" nvl="0" />
        </call>
        <column table="c" column="dz_beg" group="sum" type="number" nvl="0" as="dz_beg" />
        <call group="sum" as="kz_beg" function="*">
          <const table="c" column="dz_beg" type="number" nvl="0">-1</const>
          <column table="c" column="kz_beg" type="number" nvl="0" />
        </call>
        <column table="c" column="dz_pe_beg" group="sum" type="number" nvl="0" as="dz_pe_beg" title="Пени на начало периода" />
        <column table="c" column="nachisl_osn_in_period" group="sum" type="number" nvl="0" as="nachisl_osn_in_period" />
        <column table="c" column="cust_kvth_in_period" group="sum" type="number" nvl="0" as="cust_kvth_in_period" />
        <column table="c" column="nachisl_pe_in_period" group="sum" type="number" nvl="0" as="nachisl_pe_in_period" />
        <call group="sum" as="pay_off" title="Погашение факта" function="+nvl">
          <column table="c" column="overpayment_pay_off" type="number" nvl="0" />
          <column table="c" column="av_pay_off" type="number" nvl="0" />
        </call>
        <call group="sum" as="av_get" title="Авансы, полученные за (в)  отчетный период" comment="Лицевая карта =&gt; Переплата + Оплата аванса" function="+nvl">
          <column table="c" column="overpayment_in_period" type="number" nvl="0" />
          <column table="c" column="av_pay_in_period" type="number" nvl="0" />
        </call>
        <column table="c" column="opl_all_in_period" group="sum" type="number" nvl="0" as="opl_all_in_period" />
        <column table="c" column="opl_pe_in_period" group="sum" type="number" nvl="0" as="opl_pe_in_period" />
        <column table="c" column="refund_opl" group="sum" type="number" nvl="0" as="refund_opl" />
        <column table="c" column="spis_dz" group="sum" type="number" nvl="0" as="spis_dz" />
        <column table="c" column="dz_end" group="sum" type="number" nvl="0" as="dz_end" />
        <call group="sum" as="kz_end" function="*">
          <const table="c" column="dz_beg" type="number" nvl="0">-1</const>
          <column table="c" column="kz_end" type="number" nvl="0" />
        </call>
        <column group="sum" table="c" column="dz_pe_end" type="number" as="dz_pe_end" />
        <call group="sum" as="saldo_end" function="-nvl">
          <column table="c" column="dz_end" type="number" nvl="0" />
          <column table="c" column="kz_end" type="number" nvl="0" />
        </call>
        <column table="c" column="overdue_dz_end" group="sum" type="number" nvl="0" comment="Просроченная задолженность на конец периода" />
      </select>
      <from>
        <query name="rr_rep_dz_kz_dog" as="c" />
        <query name="rr_rep_dog" as="d" join="inner">
          <call function="=">
            <column table="c" column="kod_dog" />
            <column table="d" column="kod_dog" />
          </call>
        </query>
      </from>
      <grouping>
        <grset as="itog" />
        <grset as="grc" order="gr_cust_num">
          <group>
            <column table="this" column="gr_cust_id" type="number" />
          </group>
          <grset order="ndog" as="dog">
            <group>
              <column table="this" column="kod_dog" type="number" />
            </group>
            <where>
              <call function="=1">
                <call function="nvlu">
                  <useparam name="is_dog" />
                  <const>0</const>
                </call>
              </call>
            </where>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="72943_data" title="Основной запрос к отчету № 31" timestamp="12.12.2024 12:37:04" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72943.xml">
      <select>
        <column table="po" column="pr_byt" type="number" />
        <call type="string" group="max" function="if" as="pr_byt_name">
          <call function="=">
            <column table="po" column="pr_byt" />
            <const type="number">1</const>
          </call>
          <const type="string"> 'Население'</const>
          <const type="string">'Прочие'</const>
        </call>
        <column table="po" column="edizm" as="edizm" />
        <call function="decode" type="string" as="edizm_name" group="max">
          <column table="po" column="edizm" />
          <const>4</const>
          <const>'Электроэнергия (мощность)'</const>
          <const type="number">3</const>
          <const>'Мощность'</const>
          <const table="po" column="edizm" type="string">'другое'</const>
        </call>
        <call function="if" type="string" as="ed_izm" group="max">
          <call function="!=">
            <column table="po" column="edizm" />
            <const>3</const>
          </call>
          <const>'кВт.ч'</const>
          <const>'кВт'</const>
        </call>
        <column table="po" column="vid_calc" as="vid_calc" type="number" />
        <call function="decode" as="vid_calc_name" group="max">
          <column function="=" table="po" column="vid_calc" />
          <const type="number">0</const>
          <const type="string">'Фактические начисления'</const>
          <const function="=" type="number">1</const>
          <const type="string">'Корректировки'</const>
          <const table="po" column="edizm" type="string">'Перерасчеты'</const>
        </call>
        <column table="po" column="ym" type="number" as="ym" />
        <call function="||" as="ym_name" group="max">
          <call function="mes-name">
            <call function="mes">
              <column name="p_ym_beg" table="po" column="ym" />
            </call>
          </call>
          <const table="this" column="mes" type="string">' '</const>
          <call function="trunc">
            <column name="p_ym_beg" table="po" column="ym" />
          </call>
        </call>
        <column table="po" column="kod_dog" type="number" as="kod_dog" />
        <column table="po" column="ndog" type="string" group="max" as="ndog" />
        <column table="po" column="payer_name" type="string" group="max" as="payer_name" />
        <column table="po" column="voltage" type="number" as="voltage" />
        <column table="po" column="volt_abbr" type="string" group="max" as="volt_abbr" />
        <column table="po" column="max_power" type="string" group="max" as="max_power" />
        <column table="po" column="pr_hand" type="number" as="pr_hand" />
        <column table="po" column="cust" type="number" group="sum" as="cust" />
        <call group="sum" as="nach" function="-nvl" title="Начислено без НДС">
          <column table="this" column="nachisl" type="number" nvl="0" />
          <column table="this" column="nal" type="number" nvl="0" />
        </call>
        <column table="po" column="nal" type="number" group="sum" as="nal" />
        <column table="po" column="nachisl" type="number" group="sum" as="nachisl" />
        <call function="round" type="number" as="price" title="Цена">
          <call function="if">
            <call function="=">
              <column table="this" column="cust" />
              <const type="number">0</const>
            </call>
            <const type="number">0</const>
            <call function="/">
              <call function="if">
                <call function="=">
                  <column table="this" column="pr_byt" />
                  <const type="number">1</const>
                </call>
                <column table="this" column="nachisl" />
                <column table="this" column="nach" type="number" nvl="0" />
              </call>
              <column table="this" column="cust" type="number" nvl="0" />
            </call>
          </call>
          <const type="number">9</const>
        </call>
      </select>
      <from>
        <query name="rr_rep_po" as="po" />
      </from>
      <where>
        <call function="!=0">
          <column table="this" column="cust" />
          <column table="this" column="nach" />
        </call>
      </where>
      <grouping>
        <grset as="itog" />
        <grset as="byt" order="pr_byt_name">
          <group>
            <column table="this" column="pr_byt" />
          </group>
          <grset as="edizm" order="edizm desc">
            <group>
              <column table="this" column="edizm" />
            </group>
            <grset as="vid_calc" order="vid_calc_name">
              <group>
                <column table="this" column="vid_calc" />
              </group>
              <grset as="ym" order="ym">
                <group>
                  <column table="this" column="ym" />
                </group>
                <grset as="dog" order="ndog">
                  <group>
                    <column table="this" column="kod_dog" />
                  </group>
                  <grset as="volt" order="volt_abbr">
                    <group>
                      <column table="this" column="voltage" />
                    </group>
                    <grset as="hand" order="pr_hand">
                      <group>
                        <column table="this" column="pr_hand" />
                      </group>
                    </grset>
                  </grset>
                </grset>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="72956_data" title="Основной запрос к отчету № 32" timestamp="10.12.2024 17:45:24" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72956.xml">
      <select>
        <column table="po" column="kod_region" type="number" as="kod_region" />
        <column table="po" column="region_name" type="string" group="max" as="region_name" />
        <column table="po" column="pr_byt" type="number" as="pr_byt" function="nvlu" nvl="0" />
        <call type="string" group="max" function="if" as="pr_byt_name">
          <call function="=">
            <column table="po" column="pr_byt" />
            <const type="number">1</const>
          </call>
          <const type="string"> 'Население'</const>
          <const type="string">'Прочие'</const>
        </call>
        <call function="dense_rank" type="number" as="row_num">
          <call function="order by simple">
            <column table="this" column="region_name" />
            <column table="this" column="pr_byt_name" />
            <column table="this" column="ndog" />
          </call>
        </call>
        <call function="dense_rank" type="number" as="row_num_in_dog">
          <call function="partition by">
            <column column="kod_dog" table="this" />
          </call>
          <call function="order by 2">
            <column table="this" column="pr_opt_name" />
            <column table="this" column="volt_abbr" />
          </call>
        </call>
        <column table="po" column="kod_dog" type="number" as="kod_dog" />
        <column table="po" column="ndog" type="string" group="max" as="ndog" />
        <column table="po" column="payer_name" type="string" group="max" as="payer_name" />
        <column table="po" column="ym" type="number" as="ym" />
        <column table="po" column="pr_opt" type="number" as="pr_opt" />
        <call type="string" group="max" function="if" as="pr_opt_name">
          <call function="=">
            <column table="po" column="pr_opt" />
            <const type="number">1</const>
          </call>
          <const type="string"> 'Опт'</const>
          <const type="string">'Розница'</const>
        </call>
        <column table="po" column="voltage" type="number" as="voltage" />
        <column table="po" column="volt_abbr" type="string" group="max" as="volt_abbr" />
        <column table="po" column="cust" type="number" group="sum" as="cust" dimname="ym">
          <pivot>
            <column table="po" column="ym" />
            <query>
              <select>
                <column table="a1" column="val" />
                <column table="a1" column="val" as="t" />
              </select>
              <from>
                <query name="vr_number_array" as="a1" />
              </from>
              <where>
                <call function="=">
                  <column table="a1" column="array_id" />
                  <const type="string">'p_ym'</const>
                </call>
              </where>
            </query>
          </pivot>
        </column>
      </select>
      <from>
        <query name="rr_rep_po" as="po" />
      </from>
      <where>
        <call function="=">
          <column table="po" column="edizm" />
          <const type="number" comment="Отчёт только по Э/Э">4</const>
        </call>
      </where>
      <grouping>
        <grset as="itog" />
        <grset order="region_name" as="region">
          <group>
            <column table="this" column="kod_region" />
          </group>
          <grset as="byt" order="pr_byt_name">
            <group>
              <column table="this" column="pr_byt" />
            </group>
            <grset as="dog" order="ndog">
              <group>
                <column table="this" column="kod_dog" />
              </group>
              <grset as="opt" order="pr_opt_name">
                <group>
                  <column table="this" column="pr_opt" />
                </group>
                <grset as="volt" order="volt_abbr">
                  <group>
                    <column table="this" column="voltage" />
                  </group>
                </grset>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="74287_data_gr" title="Данные по группам" order="gr" timestamp="22.01.2025 17:44:10" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74287.xml">
      <select>
        <column table="r" column="n1" as="gr" type="number" key="1" />
        <column table="r" column="s1" type="string" as="okved_name" />
        <column table="r" column="s2" type="string" as="kod_okved_str" />
        <column table="r" column="s3" type="string" as="kod_str" />
        <column table="r" column="n3" type="number" as="cust_kvth" mp="-3" />
      </select>
      <from>
        <query name="rr_temp" as="r" />
      </from>
      <where>
        <call function="and">
          <call function="is not null">
            <column table="r" column="n4" />
          </call>
          <call function="is null">
            <column table="r" column="n2" />
          </call>
          <call function="=">
            <column table="r" column="skod" />
            <const type="string">'D250859F-7428-7FAE-9EB6-78FD1AA8728F'</const>
          </call>
        </call>
      </where>
    </query>
    <query name="74287_data_sub_gr" order="gr,sub_gr" title="Данные по подгруппам" timestamp="22.01.2025 17:44:39" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74287.xml">
      <select>
        <column table="r" column="n1" as="gr" type="number" key="1" />
        <column table="r" column="n2" type="number" as="sub_gr" key="1" />
        <column table="r" column="s1" type="string" as="okved_name" />
        <column table="r" column="s2" type="string" as="kod_okved_str" />
        <column table="r" column="s3" type="string" as="kod_str" />
        <column table="r" column="n3" type="number" as="cust_kvth" mp="-3" />
      </select>
      <from>
        <query name="rr_temp" as="r" />
      </from>
      <where>
        <call function="and">
          <call function="is not null">
            <column table="r" column="n4" />
          </call>
          <call function="is not null">
            <column table="r" column="n2" />
          </call>
          <call function="=">
            <column table="r" column="skod" />
            <const type="string">'D250859F-7428-7FAE-9EB6-78FD1AA8728F'</const>
          </call>
        </call>
      </where>
    </query>
    <query name="74287_data_gr_add" order="gr" title="Строки &quot;в том числе&quot; после некоторых разделов." timestamp="22.01.2025 18:15:18" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74287.xml">
      <select>
        <column table="r" column="n1" as="gr" type="number" key="1" />
        <column table="r" column="s1" type="string" as="okved_name" />
        <column table="r" column="s2" type="string" as="kod_okved_str" />
        <column table="r" column="s3" type="string" as="kod_str" />
        <column table="r" column="n3" type="number" as="cust_kvth" mp="-3" />
      </select>
      <from>
        <query name="rr_temp" as="r" />
      </from>
      <where>
        <call function="and">
          <call function="is null">
            <column table="r" column="n4" />
          </call>
          <call function="is not null">
            <column table="r" column="n1" />
          </call>
          <call function="is null">
            <column table="r" column="n2" />
          </call>
          <call function="=">
            <column table="r" column="skod" />
            <const type="string">'D250859F-7428-7FAE-9EB6-78FD1AA8728F'</const>
          </call>
        </call>
      </where>
    </query>
    <query name="74287_data_sub_gr_add" order="gr" title="Строки &quot;в том числе потребители с потреблением ....&quot; после некоторых ПОДразделов." timestamp="22.01.2025 19:05:06" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74287.xml">
      <select>
        <column table="r" column="n1" as="gr" type="number" key="1" />
        <column table="r" column="n2" as="sub_gr" type="number" key="1" />
        <column table="r" column="s1" type="string" as="okved_name" />
        <column table="r" column="s2" type="string" as="kod_okved_str" />
        <column table="r" column="s3" type="string" as="kod_str" />
        <column table="r" column="n3" type="number" as="cust_kvth" mp="-3" />
      </select>
      <from>
        <query name="rr_temp" as="r" />
      </from>
      <where>
        <call function="and">
          <call function="is null">
            <column table="r" column="n4" />
          </call>
          <call function="is not null">
            <column table="r" column="n1" />
          </call>
          <call function="is not null">
            <column table="r" column="n2" />
          </call>
          <call function="=">
            <column table="r" column="skod" />
            <const type="string">'D250859F-7428-7FAE-9EB6-78FD1AA8728F'</const>
          </call>
        </call>
      </where>
    </query>
    <query name="adr_m_ncz" class="1" timestamp="13.02.2025 22:48:45" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
      </params>
      <select>
        <column table="ncz" column="kod_srf" type="number" as="kod_srf" />
        <column table="ncz" column="kod_srf_name" type="string" as="kod_srf_name" />
      </select>
      <from>
        <table name="adr_m_ncz" title="Субъекты РФ по НЦЗ" as="ncz" view="1" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="=" optional="1">
            <column table="ncz" column="dep" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="gtp_ncz" class="1" timestamp="13.02.2025 22:48:19" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
        <param name="p_kod_m_srf" type="number" />
      </params>
      <select>
        <column table="ncz" column="kod_gtp" type="number" as="kod_gtp" />
        <column table="ncz" column="kod_gtp" type="number" as="kod_name" />
      </select>
      <from>
        <table name="adr_m_ncz" title="Субъекты РФ по НЦЗ" as="ncz" view="1" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="=" optional="1">
            <column table="ncz" column="dep" />
            <useparam name="p_dep" />
          </call>
          <call function="=" optional="1">
            <column table="ncz" column="kod_srf" />
            <useparam name="p_kod_m_srf" />
          </call>
        </call>
      </where>
    </query>
    <query name="74491_hours" class="1" timestamp="11.02.2025 16:58:45" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      <select>
        <column table="a" column="h" type="number" as="h" />
        <column table="a" column="h_name" type="string" as="h_name" />
      </select>
      <from>
        <table name="74491_hours" as="a" view="1" />
      </from>
    </query>
    <query name="74491_voltage" class="1" title="Список УН для отчета № 51" timestamp="11.02.2025 16:58:45" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      <params>
        <param name="p_ym" type="number">
          <const type="number">2024.11</const>
        </param>
        <param name="p_kod_m_srf" type="number">
          <const type="number">11874</const>
        </param>
      </params>
      <select>
        <column table="a" column="voltage" type="number" as="voltage" />
        <column table="a" column="voltage_name" type="string" as="voltage_name" />
      </select>
      <from>
        <table name="74491_rate_service_kvt" as="a" view="1" />
      </from>
    </query>
    <query name="74491_service_kvt" class="1" title="запрос из вью для отчета № 51" timestamp="14.02.2025 17:17:10" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      <params>
        <param name="p_ym" type="number">
          <const type="number">2024.11</const>
        </param>
        <param name="p_kod_m_srf" type="number">
          <const type="number">11874</const>
        </param>
      </params>
      <select>
        <column table="a" column="kod_m" type="number" as="kod_m" />
        <column table="a" column="voltage" type="number" as="voltage" />
        <column table="a" column="voltage_name" type="string" as="voltage_name" />
        <column table="a" column="voltage_sort" type="number" as="voltage_sort" />
        <column table="a" column="rate_service_kvt" type="number" as="rate_service_kvt" />
      </select>
      <from>
        <table name="74491_rate_service_kvt" as="a" view="1" />
      </from>
    </query>
    <query name="74491_rate_service_kvt" class="1" timestamp="14.02.2025 18:36:59" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      <params>
        <param name="p_ym" type="number">
          <const type="number">2024.11</const>
        </param>
        <param name="p_kod_m_srf" type="number">
          <const type="number">11874</const>
        </param>
      </params>
      <select>
        <column table="a" column="kod_m" type="number" as="kod_m" key="1" />
        <column table="a" column="voltage_name" type="string" group="max" />
        <column table="a" column="rate_service_kvt" as="rate_service_kvt" type="number" mp="3" dimname="volt" group="max">
          <pivot>
            <column table="a" column="voltage" type="number" />
            <query>
              <select>
                <column table="a1" column="voltage" type="number" />
                <column table="a1" column="voltage_name" type="string" as="t" />
              </select>
              <from>
                <query name="74491_voltage" as="a1">
                  <withparams>
                    <useparam name="p_ym" />
                    <useparam name="p_kod_m_srf" />
                  </withparams>
                </query>
              </from>
            </query>
          </pivot>
        </column>
      </select>
      <from>
        <query name="74491_service_kvt" as="a">
          <withparams exclude="1">
            <useparam name="p_ym" />
            <useparam name="p_kod_m_srf" />
          </withparams>
        </query>
      </from>
      <grouping>
        <grset as="itog" />
        <grset order="kod_m" as="voltage">
          <group>
            <column table="this" column="kod_m" type="number" />
          </group>
        </grset>
      </grouping>
    </query>
    <query name="74491_dif_price_per_hour" class="1" timestamp="14.02.2025 11:28:09" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
        <param name="p_kod_m_srf" type="number" />
        <param name="p_kod_gtp" type="number" />
      </params>
      <select>
        <column table="a" column="kod_gtp" type="number" as="kod_gtp" />
        <column table="a" column="voltage" type="number" as="voltage" />
        <column table="a" column="voltage_name" type="string" as="voltage_name" group="max" />
        <column table="a" column="voltage_sort" type="string" as="voltage_sort" group="max" />
        <column table="a" column="date_day" type="number" as="date_day" />
        <column table="a" column="rate_noplan_v2" as="rate_noplan_v2" type="number" dimname="h" group="max" mp="3">
          <pivot>
            <column table="a" column="h" type="number" nvl="0" />
            <query>
              <select>
                <column table="a1" column="h" type="number" />
                <column table="a1" column="h_name" as="t" />
              </select>
              <from>
                <query name="74491_hours" as="a1" />
              </from>
            </query>
          </pivot>
        </column>
        <column table="a" column="rate_free2" as="rate_free2" type="number" dimname="h" group="max" mp="3" />
        <column table="a" column="rate_up" as="rate_up" type="number" dimname="h" group="max" mp="3" />
        <column table="a" column="rate_down" as="rate_down" type="number" dimname="h" group="max" mp="3" />
        <column table="a" column="rate_cfr" type="number" as="rate_cfr" title="Иные услуги" mp="3" group="max" />
        <column table="a" column="rate_service_kvth" type="number" as="rate_service_kvth" title="Услуги по передаче" mp="3" group="max" />
        <column table="a" column="rate_sbyt" type="number" as="rate_sbyt" title="Сбытовая надбавка" mp="3" group="max" />
        <column table="a" column="rate2_free" type="number" as="rate2_free" title="Средневзвешенная рег.цена на мощность на опт.рынке. D16 из отчета АТС " mp="3" group="max" />
      </select>
      <from>
        <table name="74491_dif_price_per_hour" as="a" view="1" />
      </from>
      <grouping>
        <grset as="itog" />
        <grset order="kod_gtp" as="gtp">
          <group>
            <column table="this" column="kod_gtp" type="number" />
          </group>
          <grset order="voltage_sort" as="volt">
            <group>
              <column table="this" column="voltage" type="number" />
            </group>
            <grset order="date_day" as="date_day">
              <group>
                <column table="this" column="date_day" type="number" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="74491_ext_price_per_hour" class="1" timestamp="14.02.2025 11:28:09" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
        <param name="p_kod_m_srf" type="number" />
        <param name="p_kod_gtp" type="number" />
      </params>
      <select>
        <column table="a" column="kod_gtp" type="number" as="kod_gtp" />
        <column table="a" column="date_day" type="number" as="date_day" />
        <column table="a" column="rate_up" as="rate_up" type="number" dimname="h" group="max" mp="3">
          <pivot>
            <column table="a" column="h" type="number" nvl="0" />
            <query>
              <select>
                <column table="a1" column="h" type="number" />
                <column table="a1" column="h_name" as="t" />
              </select>
              <from>
                <query name="74491_hours" as="a1" />
              </from>
            </query>
          </pivot>
        </column>
        <column table="a" column="rate_down" as="rate_down" type="number" dimname="h" group="max" mp="3" />
        <column table="a" column="rsv_nebalans" type="number" as="rsv_nebalans" group="max" mp="3" />
      </select>
      <from>
        <table name="74491_dif_price_per_hour" as="a" view="1" />
      </from>
      <grouping>
        <grset as="itog" />
        <grset order="kod_gtp" as="gtp">
          <group>
            <column table="this" column="kod_gtp" type="number" />
          </group>
          <grset order="date_day" as="date_day">
            <group>
              <column table="this" column="date_day" type="number" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="74610_query_gr_pr" title="Запрос для отчета № 21 для группы прочие" timestamp="25.02.2025 17:55:36" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74610.xml">
      <select>
        <column table="r" column="n1" as="gr_num" key="1" type="number" />
        <column table="r" column="s1" group="max" as="gr_name" type="string" />
        <column table="r" column="s2" as="payer_name" title="Наименование потребителя" group="max" type="string" />
        <column table="r" column="n2" as="voltage_fact" title="фактический УН" type="number" />
        <column table="r" column="s3" as="volt_abbr" group="max" type="string" />
        <column table="r" column="n3" group="max" as="volt_kod_sort" type="number" />
        <column table="r" column="n4" as="edizm" type="number" />
        <column group="max" table="r" column="s4" as="edizm_name" type="string" />
        <column group="sum" table="r" column="n5" as="cust" type="number" />
        <column type="number" table="r" column="n6" as="cust_in_gr" group="sum" />
      </select>
      <from>
        <query name="rr_temp" as="r" />
      </from>
      <where>
        <call function="=">
          <column table="r" column="skod" />
          <const type="string">'3d8b60b1-74610-gr_pr-8c99c9d294fb'</const>
        </call>
      </where>
      <grouping>
        <grset as="itog">
          <grset order="gr_num" as="gr">
            <group>
              <column table="this" column="gr_num" type="number" />
            </group>
            <grset as="volt" order="volt_kod_sort">
              <group>
                <column table="this" column="voltage_fact" />
              </group>
              <grset order="edizm desc" as="edizm">
                <group>
                  <column table="this" column="edizm" />
                </group>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="74610_query_gr_byt" title="Запрос для отчета № 21 для группы население" timestamp="26.02.2025 10:17:17" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74610.xml">
      <select>
        <column table="r" column="n1" as="gr_num" key="1" type="number" />
        <column table="r" column="n5" as="cust" type="number" />
      </select>
      <from>
        <query name="rr_temp" as="r" />
      </from>
      <where>
        <call function="=">
          <column table="r" column="skod" />
          <const type="string">'3d8b60b1-74610-gr_byt-8c99c9d294fb'</const>
        </call>
      </where>
    </query>
    <query name="75041_data" timestamp="26.05.2025 13:01:03" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75041.xml">
      <select>
        <column table="r" column="gr_num_obj" as="gr_num_obj" title="Номер группы потребителя (на объекте. hs_23)" nvl="2" type="number" />
        <column table="r" column="gr_name_obj" as="gr_name_obj" title="Наименование группы потребителя на объекте" group="max" nvl="'- '" />
        <column table="r" column="sub_gr_num" as="sub_gr_num" title="Номер подгруппы в отчете (1 или 2)" nvl="0" />
        <column table="r" column="sub_gr_name" as="sub_gr_name" title="Наименование подгруппы потребителя в отчете " group="max" nvl="'-'" type="string" />
        <column table="r" column="kod_dog" as="kod_dog" group="max" />
        <column table="r" column="ndog" as="ndog" group="max" />
        <column table="r" column="payer_name" as="payer_name" title="Наименование потребителя" group="max" />
        <column table="r" column="gr_cust_name" as="gr_cust_name" title="Категория потребителя (номер и наименование гр.потребителя на договоре из спр-ка ks_group_cust)" group="max" />
        <column table="r" column="rwn" as="rwn" title="Номер строки" type="number" group="max" />
        <column table="r" column="kod_numobj" as="kod_numobj" />
        <column table="r" column="obj_num" as="obj_num" group="max" />
        <column table="r" column="obj_name" group="max" as="obj_name" title="Наименование объекта" comment="Формат поля: (№ договора.Номер объекта) Наименование объекта" />
        <column table="r" column="obj_adr_name" as="obj_adr_name" title="Адрес объекта" group="max" />
        <column table="r" column="obj_date_beg" as="obj_date_beg" title="Дата постановки на учет объекта " group="max" />
        <column table="r" column="max_power" as="max_power" title="Максимальная мощность на объекте (кВт)" group="max" nvl="0" />
        <column table="r" column="numobj_cnt" group="count" as="numobj_cnt" title="Кол-во объектов" />
        <column table="r" column="slpnt_cnt" as="slpnt_cnt" title="Кол-во ТП (точек поставки)" group="sum" />
        <column table="r" column="pnt_cnt" as="pnt_cnt" title="Кол-во ТН (точек учета)" group="sum" />
      </select>
      <from>
        <query name="75041_data_pre" as="r" />
      </from>
      <grouping>
        <grset as="itog" />
        <grset order="gr_num_obj nulls last" as="gr">
          <group>
            <column table="this" column="gr_num_obj" type="number" />
          </group>
          <grset order="sub_gr_num nulls last" as="sub_gr">
            <group>
              <column table="this" column="sub_gr_num" type="number" />
            </group>
            <grset order="lpad(ndog,10,'0'),obj_num" as="numobj">
              <group>
                <column table="this" column="kod_numobj" type="number" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="75041_gr_cust" title="Список групп потребителей как в таблице." order="num_gr" timestamp="25.05.2025 14:45:51" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75041.xml">
      <select>
        <column table="gr" column="kod_group_cust" type="number" />
        <column table="gr" column="num_gr" type="string" title="Номер" />
        <column table="gr" column="name" type="string" />
      </select>
      <from>
        <query name="ks_group_cust" as="gr" />
      </from>
    </query>
    <query name="75041_data_pre" timestamp="26.05.2025 13:33:00" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75041.xml">
      <select>
        <column table="r" column="n9" as="rwn" title="Номер строки" type="number" />
        <column table="r" column="n1" as="gr_num_obj" title="Номер группы потребителя (на объекте. hs_23)" nvl="2" type="number" />
        <column table="r" column="s1" as="gr_name_obj" title="Наименование группы потребителя на объекте" nvl="'- '" />
        <column table="r" column="n2" as="sub_gr_num" title="Номер подгруппы в отчете (1 или 2)" nvl="0" />
        <column table="r" column="s2" as="sub_gr_name" title="Наименование подгруппы потребителя в отчете " nvl="'-'" type="string" />
        <column table="r" column="n3" as="kod_dog" />
        <column table="r" column="s3" as="ndog" />
        <column table="r" column="s4" as="payer_name" title="Наименование потребителя" />
        <column table="r" column="s5" as="gr_cust_name" title="Категория потребителя (номер и наименование гр.потребителя на договоре из спр-ка ks_group_cust)" />
        <column table="r" column="n4" as="kod_numobj" />
        <column table="r" column="n5" as="obj_num" />
        <column table="r" column="s6" as="obj_name" title="Наименование объекта" comment="Формат поля: (№ договора.Номер объекта) Наименование объекта" />
        <column table="r" column="s7" as="obj_adr_name" title="Адрес объекта" />
        <column table="r" column="d1" as="obj_date_beg" title="Дата постановки на учет объекта " />
        <column table="r" column="n6" as="max_power" title="Максимальная мощность на объекте (кВт)" nvl="0" />
        <column table="r" column="n4" as="numobj_cnt" title="Кол-во объектов" />
        <column table="r" column="n7" as="slpnt_cnt" title="Кол-во ТП (точек поставки)" />
        <column table="r" column="n8" as="pnt_cnt" title="Кол-во ТН (точек учета)" />
      </select>
      <from>
        <query name="rr_temp" as="r" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="=">
            <column table="r" column="skod" />
            <const type="string">'3d8b60b1-75041-ac16-8c99c9d294fb'</const>
          </call>
        </call>
      </where>
    </query>
    <query name="75061_data" timestamp="04.05.2025 11:12:03" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75061.xml">
      <params>
        <param name="p_sum" type="number" />
        <param name="p_is_flag" type="number">
          <const type="number">0</const>
        </param>
      </params>
      <select>
        <call function="row_number" as="rwn" title="Номер строки" type="number" key="1">
          <call function="order by simple">
            <call function="lpad">
              <column table="this" column="ndog" />
              <const>10</const>
              <const>0</const>
            </call>
            <column table="this" column="kod_dog" exclude="1" />
          </call>
        </call>
        <column table="r" column="n1" as="kod_dog" type="number" />
        <column group="max" table="r" column="s1" as="ndog" type="string" title="Номер договора" />
        <column table="r" column="s2" type="string" group="max" title="Наименование потребителя" as="payer_name" />
        <column table="r" column="s3" type="string" group="max" title="Юр.адрес потребителя" as="adr" />
        <call function="||" type="string" group="min" title="Период образования задолженности" as="dolg_ym">
          <call function="mes-name">
            <call function="month">
              <column table="r" column="d1" />
            </call>
          </call>
          <const type="string">'  '</const>
          <call function="year">
            <column table="r" column="d1" />
          </call>
        </call>
        <call group="sum" table="r" column="n3" type="number" title="Сумма задолженности" as="dolg" function="+nvl" nvl="0">
          <column table="this" column="dolg_osn" nvl="0" />
          <call function="if">
            <call function="=">
              <call function="nvlu">
                <useparam name="p_is_flag" />
                <const type="number">0</const>
              </call>
              <const type="number">1</const>
            </call>
            <column table="this" column="dolg_av" type="number" nvl="0" />
            <const type="number">0</const>
          </call>
        </call>
        <column group="sum" table="r" column="n3" type="number" title="Сумма задолженности по основной реализации" as="dolg_osn" nvl="0" />
        <column group="sum" table="r" column="n4" type="number" title="Сумма задолженности по авансам" as="dolg_av" nvl="0" />
      </select>
      <from>
        <query name="rr_temp" as="r" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="=">
            <column table="r" column="skod" />
            <const>'3d8b60b1-75061-ac16-8c99c9d294fb'</const>
          </call>
        </call>
      </where>
      <grouping>
        <grset as="itog" />
        <grset order="lpad(ndog,10,'0')" as="dog">
          <group>
            <column table="this" column="kod_dog" type="number" />
          </group>
        </grset>
      </grouping>
      <having>
        <call function="and">
          <call function="true" />
          <call function="!=0">
            <column table="this" column="dolg" nvl="0" />
          </call>
          <call function="ge" optional="1">
            <column table="this" column="dolg" />
            <useparam name="p_sum" />
          </call>
        </call>
      </having>
    </query>
    <query name="75061-title" timestamp="06.04.2025 22:32:40" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75061.xml">
      <params>
        <param name="p_date" />
        <param type="number" name="p_is_flag">
          <const type="number">0</const>
        </param>
        <param name="p_gr" type="number">
          <const type="number">0</const>
        </param>
      </params>
      <select>
        <call function="if" type="string" as="param_flag">
          <call function="=">
            <call function="nvlu">
              <useparam name="p_is_flag" />
              <const type="number">0</const>
            </call>
            <const type="number">1</const>
          </call>
          <const table="this" column="dolg_av" type="string" nvl="0">'С учетом авансов'</const>
          <const type="number">'Без учетов авансов'</const>
        </call>
        <call function="to_char" type="string" as="param_date">
          <useparam name="p_date" />
          <const type="string">'DD.MM.YYYY'</const>
        </call>
        <call function="sysdate" as="dat" />
      </select>
      <from>
        <query name="dual" />
      </from>
    </query>
    <query name="75061_gr_cust" title="Группа потребителей для отчета № 1102." timestamp="23.06.2025 20:34:36" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75061.xml">
      <select>
        <column table="gr" column="kod_group_cust" />
        <column table="gr" column="num_gr" title="№" as="num_cust" />
        <column table="gr" column="name" title="Группа потребителей" />
        <column table="gr" column="num_cust" as="n_num_cust" />
      </select>
      <from>
        <query name="ks_group_cust" as="gr" />
      </from>
      <where>
        <call function="and">
          <call function="is null">
            <column table="gr" column="kod_gr_parent" />
          </call>
          <call function="in">
            <column table="gr" column="num_gr" />
            <array type="string">'2','4'</array>
          </call>
        </call>
      </where>
    </query>
    <query name="75141_data" timestamp="27.04.2025 22:03:26" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75141.xml">
      <select>
        <column table="a" column="n1" type="number" title="код корневого уровня группы потребителей" as="kod_gr_level_1" />
        <column table="a" column="s1" as="gr_num_level_1" />
        <column table="a" column="n2" title="числовое значение кода второго уровня ОКВЭДа" as="okved_level_2" />
        <column table="a" column="n3" as="npp_parent" title="код родительского тарифа" />
        <column table="a" column="n4" as="cust_kvth" />
        <column table="a" column="n5" as="nach" />
        <column table="a" column="n6" as="nachisl" />
      </select>
      <from>
        <query name="rr_temp" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="skod" />
          <const>'{3d8b60b1-75141-nach-8c99c9d294fb}'</const>
        </call>
      </where>
    </query>
    <query name="75141_d1" title="Запрос для отчета 1103." timestamp="20.06.2025 12:24:42" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75141.xml">
      <select>
        <call group="sum" function="if" as="cust_2_4">
          <call function="in">
            <column table="a" column="gr_num_level_1" />
            <array type="string">'2','4'</array>
          </call>
          <column table="a" column="cust_kvth" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nach_2_4">
          <call function="in">
            <column table="a" column="gr_num_level_1" />
            <array type="string">'2','4'</array>
          </call>
          <column table="a" column="nach" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="cust_3">
          <call function="=">
            <column table="a" column="gr_num_level_1" />
            <const type="string">'3'</const>
          </call>
          <column table="a" column="cust_kvth" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nach_3">
          <call function="=">
            <column table="a" column="gr_num_level_1" />
            <const type="string">'3'</const>
          </call>
          <column table="a" column="nach" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="cust_3_86">
          <call function="and">
            <call function="=">
              <column table="a" column="gr_num_level_1" />
              <const type="string">'3'</const>
            </call>
            <call function="=">
              <column table="a" column="okved_level_2" />
              <const type="number">86</const>
            </call>
          </call>
          <column table="a" column="cust_kvth" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nach_3_86">
          <call function="and">
            <call function="=">
              <column table="a" column="gr_num_level_1" />
              <const type="string">'3'</const>
            </call>
            <call function="=">
              <column table="a" column="okved_level_2" />
              <const type="number">86</const>
            </call>
          </call>
          <column table="a" column="nach" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="cust_3_85">
          <call function="and">
            <call function="=">
              <column table="a" column="gr_num_level_1" />
              <const type="string">'3'</const>
            </call>
            <call function="=">
              <column table="a" column="okved_level_2" />
              <const type="number">85</const>
            </call>
          </call>
          <column table="a" column="cust_kvth" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nach_3_85">
          <call function="and">
            <call function="=">
              <column table="a" column="gr_num_level_1" />
              <const type="string">'3'</const>
            </call>
            <call function="=">
              <column table="a" column="okved_level_2" />
              <const type="number">85</const>
            </call>
          </call>
          <column table="a" column="nach" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_2_4">
          <call function="in">
            <column table="a" column="gr_num_level_1" />
            <array type="string">'2','4'</array>
          </call>
          <column table="a" column="nachisl" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_2_4_gaz">
          <call function="and">
            <call function="in">
              <column table="a" column="gr_num_level_1" />
              <array type="string">'2','4'</array>
            </call>
            <call function="in">
              <column table="a" column="npp_parent" />
              <array type="number">621,625,631,633</array>
            </call>
          </call>
          <column table="a" column="nachisl" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_2_4_el">
          <call function="and">
            <call function="in">
              <column table="a" column="gr_num_level_1" />
              <array type="string">'2','4'</array>
            </call>
            <call function="in">
              <column table="a" column="npp_parent" />
              <array type="number">630,632,635</array>
            </call>
          </call>
          <column table="a" column="nachisl" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_3">
          <call function="=">
            <column table="a" column="gr_num_level_1" />
            <const type="string">'3'</const>
          </call>
          <column table="a" column="nachisl" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_3_gaz">
          <call function="and">
            <call function="=">
              <column table="a" column="gr_num_level_1" />
              <const type="string">'3'</const>
            </call>
            <call function="in">
              <column table="a" column="npp_parent" />
              <array type="number">621,625,631,633</array>
            </call>
          </call>
          <column table="a" column="nachisl" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_3_el">
          <call function="and">
            <call function="=">
              <column table="a" column="gr_num_level_1" />
              <const type="string">'3'</const>
            </call>
            <call function="in">
              <column table="a" column="npp_parent" />
              <array type="number">630,632,635</array>
            </call>
          </call>
          <column table="a" column="nachisl" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_no_2_3_4">
          <call function="not in">
            <column table="a" column="gr_num_level_1" />
            <array type="string">'2','3','4'</array>
          </call>
          <column table="a" column="nachisl" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_no_2_3_4_gaz">
          <call function="and">
            <call function="not in">
              <column table="a" column="gr_num_level_1" />
              <array type="string">'2','3','4'</array>
            </call>
            <call function="in">
              <column table="a" column="npp_parent" />
              <array type="number">621,625,631,633</array>
            </call>
          </call>
          <column table="a" column="nachisl" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_no_2_3_4_el">
          <call function="and">
            <call function="not in">
              <column table="a" column="gr_num_level_1" />
              <array type="string">'2','3','4'</array>
            </call>
            <call function="in">
              <column table="a" column="npp_parent" />
              <array type="number">630,632,635</array>
            </call>
          </call>
          <column table="a" column="nachisl" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_2_4_direct_dog">
          <call function="and">
            <call function="in">
              <column table="a" column="gr_num_level_1" />
              <array type="string">'2','4'</array>
            </call>
            <call function="in">
              <column table="a" column="npp_parent" />
              <array type="number">631,632,633</array>
            </call>
          </call>
          <column table="a" column="nachisl" />
          <const type="number">0</const>
        </call>
      </select>
      <from>
        <query name="75141_data" as="a" />
      </from>
    </query>
    <query name="75141_data_opl" timestamp="20.06.2025 12:01:37" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75141.xml">
      <select>
        <call group="sum" function="if" as="opl_2_4" title="сумма оплат  в отчетном периоде (с НДС) договоры группы потребителей = 2+4">
          <call function="in">
            <column table="a" column="s1" comment="gr_num_level_1" />
            <array type="string">'2','4'</array>
          </call>
          <column table="a" column="n7" comment="оплата в периоде" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="opl_dolg_2_4" title="сумма оплат в счет оплаты задолженности, сложившейся по состоянию  на 01.01.отчетного года. Договоры группы потребителей = 2+4">
          <call function="in">
            <column table="a" column="s1" comment="gr_num_level_1" />
            <array type="string">'2','4'</array>
          </call>
          <column table="a" column="n8" comment="оплата в периоде" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="opl_3">
          <call function="=">
            <column table="a" column="s1" comment="gr_num_level_1" />
            <const type="string">'3'</const>
          </call>
          <column table="a" column="n7" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="opl_dolg_3">
          <call function="=">
            <column table="a" column="s1" comment="gr_num_level_1" />
            <const type="string">'3'</const>
          </call>
          <column table="a" column="n8" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="opl_no_2_3_4" title="сумма оплат  в отчетном периоде (с НДС) договоры группы потребителей не равный 2,3,4">
          <call function="not in">
            <column table="a" column="s1" comment="gr_num_level_1" />
            <array type="string">'2','3','4'</array>
          </call>
          <column table="a" column="n7" comment="оплата в периоде" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="opl_dolg_no_2_3_4" title="сумма оплат в счет оплаты задолженности, сложившейся по состоянию  на 01.01.отчетного года по договорам групп потребителей не равных 2,3,4">
          <call function="not in">
            <column table="a" column="s1" comment="gr_num_level_1" />
            <array type="string">'2','3','4'</array>
          </call>
          <column table="a" column="n8" comment="оплата в периоде" />
          <const type="number">0</const>
        </call>
      </select>
      <from>
        <query name="rr_temp" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="skod" />
          <const>'{3d8b60b1-75141-opl-8c99c9d294fb}'</const>
        </call>
      </where>
    </query>
    <query name="75141_data_sqoi" timestamp="01.05.2025 23:05:28" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75141.xml">
      <select>
        <column table="a" column="n1" as="sqoi" nvl="0" />
      </select>
      <from>
        <query name="rr_temp" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="skod" />
          <const>'{3d8b60b1-75141-sqoi-8c99c9d294fb}'</const>
        </call>
      </where>
    </query>
    <query name="75227_data" title="запрос для отчета № 1063 и № 1064." timestamp="23.04.2025 14:09:56" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75227.xml">
      <select>
        <call function="row_number" as="rwn" title="Номер строки" type="number" key="1">
          <call function="order by simple">
            <call function="lpad">
              <column table="this" column="ndog" />
              <const>10</const>
              <const>0</const>
            </call>
            <column table="this" column="num_obj" />
          </call>
        </call>
        <column table="a" column="ndog" as="ndog" type="string" />
        <column table="a" column="payer_name" as="payer_name" />
        <column table="a" column="num_obj" as="num_obj" />
        <column table="a" column="obj_name" as="obj_name" />
        <column table="a" column="obj_adr_name" as="obj_adr_name" />
        <column table="a" column="obj_dat_create" as="obj_dat_create" />
        <column table="a" column="obj_dat_postav" as="obj_dat_postav" />
        <column table="a" column="obj_dat_fin" as="obj_dat_fin" />
      </select>
      <from>
        <query name="rr_rep_dog_obj" as="a" />
      </from>
    </query>
    <query name="75529_data" title="Запрос к отчету № 2001." timestamp="22.05.2025 16:43:23" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75529.xml">
      <select>
        <call function="row_number" as="rwn" title="Номер строки" type="number" key="1">
          <call function="order by simple">
            <call function="lpad">
              <column table="this" column="ndog" />
              <const>10</const>
              <const>0</const>
            </call>
          </call>
        </call>
        <column table="a" column="kod_dog" as="kod_dog" />
        <column table="a" column="ndog" as="ndog" group="max" />
        <column table="a" column="payer_name" as="payer_name" group="max" />
        <column table="a" column="cust" as="cust" group="sum" />
        <column table="a" column="nach" as="nach" group="sum" />
        <column table="a" column="price" as="price" group="max" />
        <column table="a" column="nachisl" as="nachisl" group="sum" />
        <column table="a" column="nal" as="nal" group="sum" />
      </select>
      <from>
        <query name="rr_rep_po" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="edizm" />
          <const type="number">4</const>
        </call>
      </where>
      <grouping>
        <grset as="itog" />
        <grset order="lpad(ndog,10,'0')" as="dog">
          <group>
            <column table="this" column="kod_dog" type="number" />
          </group>
        </grset>
      </grouping>
    </query>
    <query name="75545_data" title="Запрос для отчета 2002." timestamp="24.05.2025 16:38:10" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75545.xml">
      <select>
        <call function="row_number" as="rwn" title="Номер строки" type="number" key="1">
          <call function="order by simple">
            <call function="lpad">
              <column table="this" column="ndog" />
              <const>10</const>
              <const>0</const>
            </call>
          </call>
        </call>
        <column table="a" column="kod_dog" as="kod_dog" />
        <column table="a" column="ndog" as="ndog" group="max" />
        <column table="a" column="payer_name" as="payer_name" group="max" />
        <column table="a" column="opl" as="opl" group="sum" />
        <column table="a" column="price" as="price" group="max" />
        <column table="a" column="price_gp" group="max" as="price_gp_pre" />
      </select>
      <from>
        <query name="rr_rep_po" as="a" />
      </from>
      <grouping>
        <grset as="itog" />
        <grset order="lpad(ndog,10,'0')" as="dog">
          <group>
            <column table="this" column="kod_dog" type="number" />
          </group>
        </grset>
      </grouping>
    </query>
    <query name="75580_data" timestamp="03.06.2025 19:45:18" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75580.xml">
      <select>
        <call function="row_number" title="Номер строки" type="number" key="1" as="n_row">
          <call function="order by simple">
            <column table="this" column="region_name" />
            <call function="lpad">
              <column table="this" column="ndog" />
              <const>10</const>
              <const>0</const>
            </call>
            <column table="this" column="volt_abbr" />
            <column table="this" column="f_slova_account" />
          </call>
        </call>
        <call function="dense_rank" as="rwn" title="Номер строки" type="number">
          <call function="order by simple">
            <column table="this" column="region_name" />
            <call function="lpad">
              <column table="this" column="ndog" />
              <const>10</const>
              <const>0</const>
            </call>
          </call>
        </call>
        <column table="r" column="kod_region" as="kod_region" />
        <column table="r" column="region_name" as="region_name" group="max" />
        <column table="r" column="kod_dog" as="kod_dog" />
        <column table="r" column="ndog" as="ndog" group="max" />
        <call table="r" column="dog_dat_beg" as="dog_dat_beg" group="max" function="to_char" type="string">
          <column table="r" column="dog_dat_beg" type="date" />
          <const type="string">'DD.MM.YYYY'</const>
        </call>
        <column table="r" column="payer_name" as="payer_name" group="max" />
        <column table="r" column="note" as="note" group="max" />
        <column table="r" column="edizm" as="edizm" />
        <column table="r" column="voltage" as="voltage" />
        <column table="r" column="volt_abbr" as="volt_abbr" group="max" />
        <column table="r" column="f_slova_account" as="f_slova_account" />
        <column table="r" column="price" as="price" nvl="0" group="sum" />
      </select>
      <from>
        <query name="rr_rep_po" as="r" />
      </from>
      <grouping>
        <grset as="itog" />
        <grset order="region_name" as="region">
          <group>
            <column table="this" column="kod_region" type="number" />
          </group>
          <grset order="lpad(ndog,10,'0')" as="dog">
            <group>
              <column table="this" column="kod_dog" type="number" />
            </group>
            <grset as="volt" order="volt_abbr">
              <group>
                <column table="this" column="voltage" type="number" />
              </group>
              <grset as="s" order="f_slova_account">
                <group>
                  <column table="this" column="f_slova_account" type="number" />
                </group>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="75680_data" title="Запрос к отчету № 1058." timestamp="08.06.2025 19:40:15" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75680.xml">
      <select>
        <column table="r" column="kod_dog" as="kod_dog" />
        <call type="string" function="||" as="month" key="1">
          <call function="mes-name">
            <call function="mes">
              <column table="r" column="ym" />
            </call>
          </call>
          <const type="string">' '</const>
          <call function="int to char">
            <call function="trunc">
              <column table="r" column="ym" />
            </call>
          </call>
        </call>
        <column table="r" column="saldo_beg" as="saldo_beg" />
        <column table="r" column="cust_kvth_in_period" as="cust_kvth_in_period" />
        <column table="r" column="nachisl_osn_in_period" as="nachisl_osn_in_period" />
        <column table="r" column="opl_all_in_period" as="opl_all_in_period" />
        <column table="r" column="saldo_end" as="saldo_end" />
        <column table="r" column="nachisl_pe_in_period" as="nachisl_pe_in_period" />
        <column table="r" column="opl_pe_in_period" as="opl_pe_in_period" />
      </select>
      <from>
        <query name="rr_rep_dz_kz_dog" as="r" />
      </from>
    </query>
    <query name="75680_dog" timestamp="08.06.2025 19:40:45" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75680.xml">
      <select>
        <column table="dog" column="kod_dog" as="kod_dog" key="1" />
        <column table="dog" column="ndog" as="ndog" />
        <column table="dog" column="payer_name" as="payer_name" />
      </select>
      <from>
        <query name="rr_rep_dog" as="dog" />
      </from>
    </query>
    <query name="75728_data" timestamp="19.06.2025 16:19:17" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75728.xml">
      <params>
        <param name="p_no_detail" type="number" />
        <param name="p_no_detail_dog" type="number" />
      </params>
      <select>
        <call function="row_number" title="Номер строки" type="number" key="1" as="n_row">
          <call function="order by simple">
            <column table="this" column="kod_m_srf" />
            <call function="lpad">
              <column table="this" column="ndog" />
              <const>10</const>
              <const type="string">'0'</const>
            </call>
          </call>
        </call>
        <call function="dense_rank" as="rw_n">
          <call function="order by simple">
            <column table="this" column="kod_m_srf_name" />
            <column table="this" column="kod_m_srf" />
          </call>
        </call>
        <column table="a" type="number" column="kod_m_srf" as="kod_m_srf" nvl="0" />
        <column table="adr_m" type="string" column="name_p" as="kod_m_srf_name" title="Наименование субъекта Рф" group="max" />
        <column table="a" column="kod_dog" as="kod_dog" type="number" />
        <column group="max" table="dog" column="ndog" as="ndog" />
        <column table="a" type="number" column="nachisl_osn_in_period" as="nachisl_osn_in_period" group="sumnvl" mp="-6" nvl="0" />
        <call group="sum" function="if" as="nachisl_osn_in_period_fb" type="number" mp="-6" title="начислено из федерального бюджета">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(31)</const>
          </call>
          <column table="a" column="nachisl_osn_in_period" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_osn_in_period_sb" type="number" mp="-6" title="начислено из бюджета субъекта Российской Федерации">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(32)</const>
          </call>
          <column table="a" column="nachisl_osn_in_period" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_osn_in_period_mb" type="number" mp="-6" title="начислено из местных бюджетов">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(33,331,332,333,334,34,35)</const>
          </call>
          <column table="a" column="nachisl_osn_in_period" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_osn_in_period_iku" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust_level_1" />
            <const type="number">(2,4)</const>
          </call>
          <column table="a" column="nachisl_osn_in_period" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="nachisl_osn_in_period_other" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust_level_1" />
            <const type="number">(1,5,6,7)</const>
          </call>
          <column table="a" column="nachisl_osn_in_period" nvl="0" />
          <const type="number">0</const>
        </call>
        <column table="a" type="number" column="opl_all_in_period" as="opl_in_period" group="sumnvl" mp="-6" nvl="0" />
        <call group="sum" function="if" as="opl_in_period_fb" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(31)</const>
          </call>
          <column table="a" column="opl_all_in_period" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="opl_in_period_sb" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(32)</const>
          </call>
          <column table="a" column="opl_all_in_period" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="opl_in_period_mb" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(33,331,332,333,334,34,35)</const>
          </call>
          <column table="a" column="opl_all_in_period" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="opl_in_period_iku" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust_level_1" />
            <const type="number">(2,4)</const>
          </call>
          <column table="a" column="opl_all_in_period" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="opl_in_period_other" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust_level_1" />
            <const type="number">(1,5,6,7)</const>
          </call>
          <column table="a" column="opl_all_in_period" nvl="0" />
          <const type="number">0</const>
        </call>
        <column table="a" type="number" column="dz_end" as="dz_end" group="sumnvl" mp="-6" nvl="0" />
        <call group="sum" function="if" as="dz_end_fb" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(31)</const>
          </call>
          <column table="a" column="dz_end" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="dz_end_sb" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(32)</const>
          </call>
          <column table="a" column="dz_end" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="dz_end_mb" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(33,331,332,333,334,34,35)</const>
          </call>
          <column table="a" column="dz_end" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="dz_end_iku" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust_level_1" />
            <const type="number">(2,4)</const>
          </call>
          <column table="a" column="dz_end" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="dz_end_other" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust_level_1" />
            <const type="number">(1,5,6,7)</const>
          </call>
          <column table="a" column="dz_end" nvl="0" />
          <const type="number">0</const>
        </call>
        <column table="a" type="number" column="overdue_dz_end" as="overdue_dz_end" group="sumnvl" mp="-6" nvl="0" />
        <call group="sum" function="if" as="overdue_dz_end_fb" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(31)</const>
          </call>
          <column table="a" column="overdue_dz_end" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="overdue_dz_end_sb" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(32)</const>
          </call>
          <column table="a" column="overdue_dz_end" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="overdue_dz_end_mb" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(33,331,332,333,334,34,35)</const>
          </call>
          <column table="a" column="overdue_dz_end" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="overdue_dz_end_iku" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust_level_1" />
            <const type="number">(2,4)</const>
          </call>
          <column table="a" column="overdue_dz_end" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="overdue_dz_end_other" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust_level_1" />
            <const type="number">(1,5,6,7)</const>
          </call>
          <column table="a" column="overdue_dz_end" nvl="0" />
          <const type="number">0</const>
        </call>
        <column table="a" type="number" column="spis_dz" as="spis_dz" group="sumnvl" mp="-6" nvl="0" />
        <call group="sum" function="if" as="spis_dz_fb" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(31)</const>
          </call>
          <column table="a" column="spis_dz" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="spis_dz_sb" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(32)</const>
          </call>
          <column table="a" column="spis_dz" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="spis_dz_mb" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust" />
            <const type="number">(33,331,332,333,334,34,35)</const>
          </call>
          <column table="a" column="spis_dz" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="spis_dz_iku" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust_level_1" />
            <const type="number">(2,4)</const>
          </call>
          <column table="a" column="spis_dz" nvl="0" />
          <const type="number">0</const>
        </call>
        <call group="sum" function="if" as="spis_dz_other" type="number" mp="-6">
          <call function="in">
            <column table="cust" column="num_cust_level_1" />
            <const type="number">(1,5,6,7)</const>
          </call>
          <column table="a" column="spis_dz" nvl="0" />
          <const type="number">0</const>
        </call>
        <column table="a" type="number" column="kz_end" as="kz_end" group="sumnvl" mp="-6" nvl="0" />
      </select>
      <from>
        <query name="rr_rep_dz_kz_dog" as="a" />
        <query join="inner" name="rr_rep_dog" as="dog">
          <call function="=">
            <column table="a" column="kod_numobj" />
            <column table="dog" column="kod_numobj" />
          </call>
        </query>
        <query name="adr_m" as="adr_m" join="inner">
          <call function="=">
            <column table="a" column="kod_m_srf" />
            <column table="adr_m" column="kod_m" />
          </call>
        </query>
        <query name="kv_group_cust_level" as="cust" title="Группы потребителей" join="left outer">
          <call function="=">
            <column table="dog" column="gr_cust_id" />
            <column table="cust" column="kod_group_cust" />
          </call>
        </query>
      </from>
      <grouping>
        <grset as="itog" />
        <grset order="kod_m_srf_name" as="srf">
          <group>
            <column table="this" column="kod_m_srf" type="number" />
          </group>
          <where>
            <call function="and">
              <call function="=">
                <call function="nvlu">
                  <useparam name="p_no_detail" />
                  <const>0</const>
                </call>
                <const>1</const>
              </call>
            </call>
          </where>
          <grset order="LPAD(ndog,10,'0')" as="dog">
            <group>
              <column table="this" column="kod_dog" type="number" />
            </group>
            <where>
              <call function="and">
                <call function="=">
                  <call function="nvlu">
                    <useparam name="p_no_detail_dog" />
                    <const>0</const>
                  </call>
                  <const>1</const>
                </call>
              </call>
            </where>
          </grset>
        </grset>
      </grouping>
      <having>
        <call function="or">
          <call function="!=">
            <column table="this" column="nachisl_osn_in_period" />
            <const type="number">0</const>
          </call>
          <call function="!=">
            <column table="this" column="opl_in_period" />
            <const type="number">0</const>
          </call>
          <call function="!=">
            <column table="this" column="spis_dz" />
            <const type="number">0</const>
          </call>
          <call function="!=">
            <column table="this" column="dz_end" />
            <const type="number">0</const>
          </call>
          <call function="!=">
            <column table="this" column="kz_end" />
            <const type="number">0</const>
          </call>
          <call function="!=">
            <column table="this" column="overdue_dz_end" />
            <const type="number">0</const>
          </call>
        </call>
      </having>
    </query>
    <query name="75780_data" title="Запрос для отчета № 1101. Для верхней таблицы" timestamp="28.06.2025 10:33:41" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75780.xml">
      <params>
        <param name="is_dog" type="number" />
      </params>
      <select>
        <call function="row_number" as="rwn" title="Номер строки" type="number" key="1">
          <call function="order by simple">
            <column table="this" column="num_gr_level_1" />
            <column table="this" column="num_gr_level_2" />
            <column table="this" column="num_gr_level_3" />
            <call function="lpad">
              <column table="this" column="ndog" />
              <const>10</const>
              <const>0</const>
            </call>
          </call>
        </call>
        <column table="gr" column="kod_level_1" as="kod_level_1" type="number" />
        <column table="gr" column="num_gr_level_1" as="num_gr_level_1" type="string" group="max" />
        <column table="gr" column="name_level_1" as="name_level_1" type="string" group="max" />
        <column table="gr" column="kod_level_2" as="kod_level_2" type="number" />
        <column table="gr" column="num_gr_level_2" as="num_gr_level_2" type="string" group="max" />
        <column table="gr" column="name_level_2" as="name_level_2" type="string" group="max" />
        <column table="gr" column="num_gr" as="gr_cust_snum" type="string" group="max" />
        <column table="gr" column="kod_level_3" as="kod_level_3" />
        <column table="gr" column="num_gr_level_3" as="num_gr_level_3" group="max" />
        <column table="gr" column="name_level_3" as="name_level_3" group="max" />
        <column table="d" column="gr_cust_id" type="number" exclude="1" />
        <column table="d" column="gr_cust_num" type="number" group="max" exclude="1" />
        <column table="d" column="gr_cust_snum" type="string" group="max" exclude="1" />
        <column table="gr" column="gr_cust_name" type="string" group="max" as="gr_cust_name" title="Наименование группы потребителей" />
        <column table="c" column="kod_dog" type="number" as="kod_dog" />
        <column table="d" column="gr_cust_level_num" as="gr_cust_level_num" title="Номер уровня группы потр. для договора" group="max" />
        <column table="d" column="ndog" type="string" as="ndog" comment="Номер договора" group="max" />
        <column table="d" column="payer_name" type="string" as="payer_name" comment="Номер договора" group="max" />
        <call group="sum" as="saldo_beg" function="-nvl">
          <column table="c" column="dz_beg" type="number" nvl="0" />
          <column table="c" column="kz_beg" type="number" nvl="0" />
        </call>
        <column table="c" column="dz_beg" group="sum" type="number" nvl="0" as="dz_beg" />
        <call group="sum" as="kz_beg" function="*">
          <const table="c" column="dz_beg" type="number" nvl="0">-1</const>
          <column table="c" column="kz_beg" type="number" nvl="0" />
        </call>
        <column table="c" column="dz_pe_beg" group="sum" type="number" nvl="0" as="dz_pe_beg" title="Пени на начало периода" />
        <column table="c" column="nachisl_osn_in_period" group="sum" type="number" nvl="0" as="nachisl_osn_in_period" />
        <column table="c" column="cust_kvth_in_period" group="sum" type="number" nvl="0" as="cust_kvth_in_period" />
        <column table="c" column="nachisl_pe_in_period" group="sum" type="number" nvl="0" as="nachisl_pe_in_period" />
        <call group="sum" as="pay_off" title="Погашение факта" function="+nvl">
          <column table="c" column="overpayment_pay_off" type="number" nvl="0" />
          <column table="c" column="av_pay_off" type="number" nvl="0" />
        </call>
        <call group="sum" as="av_get" title="Авансы, полученные за (в)  отчетный период" comment="Лицевая карта =&gt; Переплата + Оплата аванса" function="+nvl">
          <column table="c" column="overpayment_in_period" type="number" nvl="0" />
          <column table="c" column="av_pay_in_period" type="number" nvl="0" />
        </call>
        <column table="c" column="opl_all_in_period" group="sum" type="number" nvl="0" as="opl_all_in_period" />
        <column table="c" column="opl_pe_in_period" group="sum" type="number" nvl="0" as="opl_pe_in_period" />
        <column table="c" column="refund_opl" group="sum" type="number" nvl="0" as="refund_opl" />
        <column table="c" column="spis_dz" group="sum" type="number" nvl="0" as="spis_dz" />
        <column table="c" column="dz_end" group="sum" type="number" nvl="0" as="dz_end" />
        <call group="sum" as="kz_end" function="*">
          <const table="c" column="dz_beg" type="number" nvl="0">-1</const>
          <column table="c" column="kz_end" type="number" nvl="0" />
        </call>
        <column group="sum" table="c" column="dz_pe_end" type="number" as="dz_pe_end" />
        <call group="sum" as="saldo_end" function="-nvl">
          <column table="c" column="dz_end" type="number" nvl="0" />
          <column table="c" column="kz_end" type="number" nvl="0" />
        </call>
        <column table="c" column="overdue_dz_end" group="sum" type="number" nvl="0" comment="Просроченная задолженность на конец периода" />
      </select>
      <from>
        <query name="gr_cust_list" as="gr" />
        <query name="rr_rep_dog" as="d" join="left outer">
          <call function="=">
            <column table="gr" column="kod_group_cust" />
            <column table="d" column="gr_cust_id" />
          </call>
        </query>
        <query name="rr_rep_dz_kz_dog" as="c" join="left outer">
          <call function="=">
            <column table="c" column="kod_dog" />
            <column table="d" column="kod_dog" />
          </call>
        </query>
      </from>
      <where>
        <call function="lt">
          <column table="gr" column="num_gr" />
          <const type="string">'8'</const>
        </call>
      </where>
      <grouping>
        <grset as="itog" />
        <grset as="grc1" order="num_gr_level_1 asc nulls first">
          <group>
            <column table="this" column="kod_level_1" type="number" />
          </group>
          <grset as="grc2" order="gr_cust_snum">
            <group>
              <column table="this" column="kod_level_2" type="number" />
            </group>
            <grset as="grc3" order="gr_cust_snum">
              <group>
                <column table="this" column="kod_level_3" type="number" />
              </group>
              <grset order="LPAD(ndog,10,'0')" as="dog3">
                <group>
                  <column table="this" column="kod_dog" type="number" />
                </group>
                <where>
                  <call function="and">
                    <call function="=1">
                      <call function="nvlu">
                        <useparam name="is_dog" />
                        <const>0</const>
                      </call>
                    </call>
                    <call function="=">
                      <column table="this" column="gr_cust_level_num" />
                      <const type="number">3</const>
                    </call>
                  </call>
                </where>
              </grset>
            </grset>
            <grset order="LPAD(ndog,10,'0')" as="dog2">
              <group>
                <column table="this" column="kod_dog" type="number" />
              </group>
              <where>
                <call function="and">
                  <call function="=1">
                    <call function="nvlu">
                      <useparam name="is_dog" />
                      <const>0</const>
                    </call>
                  </call>
                  <call function="=">
                    <column table="this" column="gr_cust_level_num" />
                    <const type="number">2</const>
                  </call>
                </call>
              </where>
            </grset>
          </grset>
          <grset order="LPAD(ndog,10,'0')" as="dog1">
            <group>
              <column table="this" column="kod_dog" type="number" />
            </group>
            <where>
              <call function="and">
                <call function="=1">
                  <call function="nvlu">
                    <useparam name="is_dog" />
                    <const>0</const>
                  </call>
                </call>
                <call function="=">
                  <column table="this" column="gr_cust_level_num" />
                  <const type="number">1</const>
                </call>
              </call>
            </where>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="75780_data_8" title="Запрос для отчета 1101 для гр. потребителей № 8." timestamp="28.06.2025 10:33:08" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75780.xml">
      <params>
        <param name="is_dog" type="number" />
      </params>
      <select>
        <call function="row_number" as="rwn" title="Номер строки" type="number" key="1">
          <call function="order by simple">
            <call function="lpad">
              <column table="this" column="ndog" />
              <const>10</const>
              <const>0</const>
            </call>
          </call>
        </call>
        <column table="gr" column="num_gr" as="gr_cust_snum" />
        <column table="d" column="gr_cust_id" type="number" exclude="1" />
        <column table="d" column="gr_cust_num" type="number" group="max" exclude="1" />
        <column table="d" column="gr_cust_snum" type="string" group="max" exclude="1" />
        <column table="gr" column="gr_cust_name" type="string" group="max" as="gr_cust_name" title="Наименование группы потребителей" />
        <column table="c" column="kod_dog" type="number" as="kod_dog" />
        <column table="d" column="ndog" type="string" as="ndog" comment="Номер договора" group="max" />
        <column table="d" column="payer_name" type="string" as="payer_name" comment="Номер договора" group="max" />
        <call group="sum" as="saldo_beg" function="-nvl">
          <column table="c" column="dz_beg" type="number" nvl="0" />
          <column table="c" column="kz_beg" type="number" nvl="0" />
        </call>
        <column table="c" column="dz_beg" group="sum" type="number" nvl="0" as="dz_beg" />
        <call group="sum" as="kz_beg" function="*">
          <const table="c" column="dz_beg" type="number" nvl="0">-1</const>
          <column table="c" column="kz_beg" type="number" nvl="0" />
        </call>
        <column table="c" column="dz_pe_beg" group="sum" type="number" nvl="0" as="dz_pe_beg" title="Пени на начало периода" />
        <column table="c" column="nachisl_osn_in_period" group="sum" type="number" nvl="0" as="nachisl_osn_in_period" />
        <column table="c" column="cust_kvth_in_period" group="sum" type="number" nvl="0" as="cust_kvth_in_period" />
        <column table="c" column="nachisl_pe_in_period" group="sum" type="number" nvl="0" as="nachisl_pe_in_period" />
        <call group="sum" as="pay_off" title="Погашение факта" function="+nvl">
          <column table="c" column="overpayment_pay_off" type="number" nvl="0" />
          <column table="c" column="av_pay_off" type="number" nvl="0" />
        </call>
        <call group="sum" as="av_get" title="Авансы, полученные за (в)  отчетный период" comment="Лицевая карта =&gt; Переплата + Оплата аванса" function="+nvl">
          <column table="c" column="overpayment_in_period" type="number" nvl="0" />
          <column table="c" column="av_pay_in_period" type="number" nvl="0" />
        </call>
        <column table="c" column="opl_all_in_period" group="sum" type="number" nvl="0" as="opl_all_in_period" />
        <column table="c" column="opl_pe_in_period" group="sum" type="number" nvl="0" as="opl_pe_in_period" />
        <column table="c" column="refund_opl" group="sum" type="number" nvl="0" as="refund_opl" />
        <column table="c" column="spis_dz" group="sum" type="number" nvl="0" as="spis_dz" />
        <column table="c" column="dz_end" group="sum" type="number" nvl="0" as="dz_end" />
        <call group="sum" as="kz_end" function="*">
          <const table="c" column="dz_beg" type="number" nvl="0">-1</const>
          <column table="c" column="kz_end" type="number" nvl="0" />
        </call>
        <column group="sum" table="c" column="dz_pe_end" type="number" as="dz_pe_end" />
        <call group="sum" as="saldo_end" function="-nvl">
          <column table="c" column="dz_end" type="number" nvl="0" />
          <column table="c" column="kz_end" type="number" nvl="0" />
        </call>
        <column table="c" column="overdue_dz_end" group="sum" type="number" nvl="0" comment="Просроченная задолженность на конец периода" />
      </select>
      <from>
        <query name="gr_cust_list" as="gr" />
        <query name="rr_rep_dog" as="d" join="left outer">
          <call function="=">
            <column table="gr" column="kod_group_cust" />
            <column table="d" column="gr_cust_id" />
          </call>
        </query>
        <query name="rr_rep_dz_kz_dog" as="c" join="left outer">
          <call function="=">
            <column table="c" column="kod_dog" />
            <column table="d" column="kod_dog" />
          </call>
        </query>
      </from>
      <where>
        <call function="=">
          <column table="gr" column="num_gr" />
          <const type="string">'8'</const>
        </call>
      </where>
      <grouping>
        <grset as="itog" />
        <grset as="grc" order="gr_cust_snum">
          <group>
            <column table="this" column="gr_cust_snum" title="Строковое значение номера группы" />
          </group>
          <grset order="LPAD(ndog,10,'0')" as="dog">
            <group>
              <column table="this" column="kod_dog" type="number" />
            </group>
            <where>
              <call function="=1">
                <call function="nvlu">
                  <useparam name="is_dog" />
                  <const>0</const>
                </call>
              </call>
            </where>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="75780_data_all" title="Запрос для отчета 1101 для итогов (для вычисления граф с %) в обеих таблицах" timestamp="28.06.2025 11:05:55" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75780.xml">
      <select>
        <call function="row_number" as="rwn" title="Номер строки" type="number" key="1">
          <call function="order by simple">
            <call function="lpad">
              <column table="this" column="ndog" />
              <const>10</const>
              <const>0</const>
            </call>
          </call>
        </call>
        <column table="gr" column="num_gr" as="gr_cust_snum" />
        <column table="gr" column="gr_cust_name" type="string" group="max" as="gr_cust_name" title="Наименование группы потребителей" />
        <column table="c" column="kod_dog" type="number" as="kod_dog" />
        <column table="d" column="ndog" type="string" as="ndog" comment="Номер договора" group="max" />
        <column table="d" column="payer_name" type="string" as="payer_name" comment="Номер договора" group="max" />
        <call group="sum" as="saldo_beg" function="-nvl">
          <column table="c" column="dz_beg" type="number" nvl="0" />
          <column table="c" column="kz_beg" type="number" nvl="0" />
        </call>
        <column table="c" column="dz_beg" group="sum" type="number" nvl="0" as="dz_beg" />
        <call group="sum" as="kz_beg" function="*">
          <const table="c" column="dz_beg" type="number" nvl="0">-1</const>
          <column table="c" column="kz_beg" type="number" nvl="0" />
        </call>
        <column table="c" column="dz_pe_beg" group="sum" type="number" nvl="0" as="dz_pe_beg" title="Пени на начало периода" />
        <column table="c" column="nachisl_osn_in_period" group="sum" type="number" nvl="0" as="nachisl_osn_in_period" />
        <column table="c" column="cust_kvth_in_period" group="sum" type="number" nvl="0" as="cust_kvth_in_period" />
        <column table="c" column="nachisl_pe_in_period" group="sum" type="number" nvl="0" as="nachisl_pe_in_period" />
        <call group="sum" as="pay_off" title="Погашение факта" function="+nvl">
          <column table="c" column="overpayment_pay_off" type="number" nvl="0" />
          <column table="c" column="av_pay_off" type="number" nvl="0" />
        </call>
        <call group="sum" as="av_get" title="Авансы, полученные за (в)  отчетный период" comment="Лицевая карта =&gt; Переплата + Оплата аванса" function="+nvl">
          <column table="c" column="overpayment_in_period" type="number" nvl="0" />
          <column table="c" column="av_pay_in_period" type="number" nvl="0" />
        </call>
        <column table="c" column="opl_all_in_period" group="sum" type="number" nvl="0" as="opl_all_in_period" />
        <column table="c" column="opl_pe_in_period" group="sum" type="number" nvl="0" as="opl_pe_in_period" />
        <column table="c" column="refund_opl" group="sum" type="number" nvl="0" as="refund_opl" />
        <column table="c" column="spis_dz" group="sum" type="number" nvl="0" as="spis_dz" />
        <column table="c" column="dz_end" group="sum" type="number" nvl="0" as="dz_end" />
        <call group="sum" as="kz_end" function="*">
          <const table="c" column="dz_beg" type="number" nvl="0">-1</const>
          <column table="c" column="kz_end" type="number" nvl="0" />
        </call>
        <column group="sum" table="c" column="dz_pe_end" type="number" as="dz_pe_end" />
        <call group="sum" as="saldo_end" function="-nvl">
          <column table="c" column="dz_end" type="number" nvl="0" />
          <column table="c" column="kz_end" type="number" nvl="0" />
        </call>
        <column table="c" column="overdue_dz_end" group="sum" type="number" nvl="0" comment="Просроченная задолженность на конец периода" />
      </select>
      <from>
        <query name="gr_cust_list" as="gr" />
        <query name="rr_rep_dog" as="d" join="left outer">
          <call function="=">
            <column table="gr" column="kod_group_cust" />
            <column table="d" column="gr_cust_id" />
          </call>
        </query>
        <query name="rr_rep_dz_kz_dog" as="c" join="left outer">
          <call function="=">
            <column table="c" column="kod_dog" />
            <column table="d" column="kod_dog" />
          </call>
        </query>
      </from>
      <grouping>
        <grset as="itog" />
        <grset as="grc" order="gr_cust_snum">
          <group>
            <column table="this" column="gr_cust_snum" title="Строковое значение номера группы" />
          </group>
        </grset>
      </grouping>
    </query>
    <query name="gr_cust_list" title="Список групп потребителей как в таблице." order="num_gr" class="1" timestamp="24.06.2025 20:39:29" file="sql.builder.templates\sql.builder\projects\ryazan\scheme\extension\ks_gr_cust.xml">
      <select>
        <column table="gr" column="kod_group_cust" type="number" as="kod_group_cust" />
        <column table="gr" column="num_gr" type="string" title="Номер (строковый)" as="num_gr" />
        <column table="gr" column="kod_level_1" type="number" as="kod_level_1" />
        <column table="gr" column="num_gr_level_1" as="num_gr_level_1" type="string" />
        <column table="gr" column="name_level_1" as="name_level_1" type="string" />
        <column table="gr" column="kod_level_2" as="kod_level_2" type="number" />
        <column table="gr" column="num_gr_level_2" as="num_gr_level_2" type="string" />
        <column table="gr" column="name_level_2" as="name_level_2" type="string" />
        <column table="gr" column="kod_level_3" as="kod_level_3" type="number" />
        <column table="gr" column="num_gr_level_3" type="string" as="num_gr_level_3" />
        <column table="gr" column="name_level_3" type="string" as="name_level_3" />
        <column table="gr" column="gr_cust_name" as="gr_cust_name" type="string" />
      </select>
      <from>
        <query name="kv_group_cust_level" as="gr" />
      </from>
    </query>
  </queries>
  <functions child-name="function" key-name="name" />
  <parts child-name="part" key-name="id" />
  <views child-name="view" key-name="id">
    <view name="61880_10-spr_gr_potr_ryaz" timestamp="19.08.2022 09:34:13" file="sql.builder.templates\sql.builder\projects\ryazan\reports\61880_10_ryaz.xml">
      select 1 as kod_gr, 0 kod_sub_gr, '1. Промышленные и приравненные к ним потребители' as name, 1 as kod_refcode from  dual  union
      select 2 , 0, '2. Непромышленные потребители', 3  from  dual union
      select 2 , 1, '   2.1. из них: Потребители ЖКХ, ВСЕГО', 2  from  dual union
      select 2 , 2, '   2.2. из них: Владельцы объектов электросетевого хозяйства, утратившие статус ТСО', 5 from  dual union
      select 3 , 0, '3. Предприятия Минобороны РФ (без учета ФГБУ «ЦЖКУ» Минобороны России и АО «Оборонэнергосбыт»).', 13  from  dual union
      select 4 , 0, '4. ОАО "Оборонэнергосбыт"', 14 from  dual union
      select 5 , 0, '5. ФГБУ "ЦЖКУ"  Минобороны РФ', 15 from  dual union
      select 6 , 0, '6. Бюджетные потребители (без учета предприятий Минобороны)', 19 from dual union
      select 6 , 1, '   6.1. из них: Федеральный бюджет (без учета предприятий Минобороны)', 9  from  dual union
      select 6 , 2, '   6.2. Прочие бюджеты (Областной + Местный бюджеты)', 20  from  dual union
      select 7 , 0, '7. Сельскохозяйственные товаропроизводители', 12  from  dual union
      select 8 , 0, '8. Население', 18  from  dual union
      select 9 , 0, '9. Потребители - Управляющие компании, ТСЖ, ЖСК и т.д., ВСЕГО', 8  from  dual union
      select 10 , 0, '10. Энергоснабжающие, энергосбытовые организации (без учета предприятий Минобороны)', 17  from  dual union
      select 11 , 0, '11. Потери', 16  from  dual union
      select 11 , 1, 'в т.ч. потери МРСК ', null  from  dual union
      select 11 , 2, 'в т.ч. потери прочие ТСО ', null  from  dual union
      select 11 , 3, 'в т.ч. потери прочих ТСО, утративших статус ТСО ', null  from  dual
    </view>
    <view name="adr_m_ncz" title="Субъекты РФ по НЦЗ" timestamp="13.02.2025 09:34:13" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      SELECT a.dep
           , a.kod_srf as kod_srf
           , max(a.kod_srf_name) as kod_srf_name
           , a.kod_gtp as kod_gtp
      FROM (
          SELECT d.dep,
                 nk_adress.kf_get_sf(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as kod_srf,
                 nk_adress.kp_get_region_name(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as kod_srf_name,
                 hg_common.get_gtp (n.kod_numobj, :p_ym) as kod_gtp
          FROM kr_dogovor d
              LEFT JOIN kr_numobj n ON d.kod_dog = n.kod_dog
              LEFT JOIN kr_object ob ON n.kod_obj = ob.kod_obj              
        ) a
      INNER JOIN hs_gtp gtp ON a.kod_gtp = gtp.kod_gtp
    WHERE gtp.kod_price_zone in (63, 64)
    GROUP BY a.dep, a.kod_srf, a.kod_gtp
    </view>
    <view name="74491_hours" timestamp="10.02.2025 09:34:13" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      /* select tt.h as h,
      tt.h || ' - ' || COALESCE(LEAD(trim(tt.h),1) over (ORDER BY tt.h),'00:00:00') AS h_name
      from ( SELECT trim(CONCAT(to_char(Value(t),'00'),':00:00')) as h
      FROM TABLE(kg.numerator_from_to(0,23,1)) t
      ) tt
      */
      select tt.h as h,
            to_char(tt.h,'00')  || ':00 - ' || COALESCE(to_char(LEAD(tt.h,1) over (ORDER BY tt.h),'00'),'00') || ':00' AS h_name
      from ( SELECT --trim(to_char(Value(t),'00')) || 'h' as h
                    Value(t) as h
              FROM TABLE(kg.numerator_from_to(0,23,1)) t
      ) tt
    </view>
    <view name="74491_rate_service_kvt" timestamp="14.02.2025 09:34:13" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      -- пунтк 3: мощность по услуге по передаче для обеих вкладок (4ЦК и 6ЦК)
      SELECT  a.kod_m as kod_m,
              t.voltage as voltage,
              tr.rate2 as rate_service_kvt,  --  * 1000
              COALESCE(v.abbr,'-') as voltage_name,
              v.kod_sort as voltage_sort
      FROM ks_tarif t
         INNER JOIN adr_m a ON t.prizn_selo = a.kod_m
         INNER JOIN ks_tarif_rate tr ON t.tarif = tr.tarif
         INNER JOIN hk_voltage v ON t.voltage = v.voltage
      WHERE t.tip_tarif_sost = 2  AND t.tarif_parent is not null
         AND t.pr_active=0
         AND a.kod_m = :p_kod_m_srf
         AND kg.ym_first_day(:p_ym) between tr.dat_beg and tr.dat_end
         AND tr.rate2 is not null      
    </view>
    <view name="74491_dif_price_per_hour" timestamp="10.02.2025 09:34:13" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      SELECT gtp.kod_gtp
      , sr.voltage
      , v.abbr as voltage_name
      , v.kod_sort as voltage_sort  -- сортировка не по наименованию, а по полю kod_sort
      , sr.rate_service_kvth as rate_service_kvth
      , tfh.rate_noplan_v2 -- 4 ЦК э/э
      , tfh.rate_free2  -- 6 ЦК э/э
      , tfh.rate_up    --  для 6 ц.к. "факт над планом = вверх"
      , tfh.rate_down   -- для 6 ц.к. "план над фактом - вниз"
      , tfr.rate_cfr  -- иные услуги
      , tfr.rsv_nebalans -- Ставка для суммы абсолютных значений разностей фактических и плановых почасовых объемов
      , tfr.rate2_free -- 4,6 ЦК мощность, пункт 2.
      , r_sbyt.rate_sbyt --  сбытовая надбавка
      , tfh.date_hour
      , to_char(tfh.date_hour,'dd.mm.yyyy') as date_date
      , to_char(tfh.date_hour,'dd') as date_day
      -- , to_char(tfh.date_hour,'HH24:MI:SS') as h
      , nvl(to_number(to_char(tfh.date_hour,'HH24')),0)  as h

      FROM hs_gtp gtp
      INNER JOIN ks_tar_free tf ON gtp.kod_gtp = tf.kod_gtp
      INNER JOIN ks_tar_free_rate tfr ON tf.kod_tar_free = tfr.kod_tar_free
      LEFT JOIN ks_tar_free_hours tfh ON gtp.kod_gtp = tfh.kod_gtp

      inner join ( -- услуги по передаче
      SELECT  :p_kod_gtp as kod_gtp, t.voltage as voltage, tr.rate1 as rate_service_kvth -- услуги на передачу э/э
      FROM ks_tarif t
      INNER JOIN adr_m a ON t.prizn_selo = a.kod_m
      INNER JOIN ks_tarif_rate tr ON t.tarif = tr.tarif
      WHERE t.tip_tarif_sost = 2   AND t.tarif_parent is not null
      AND t.pr_active=0
      AND  a.kod_m = :p_kod_m_srf
      and kg.ym_first_day(:p_ym) between tr.dat_beg and tr.dat_end
      And  tr.rate2 is not null
      ) sr ON gtp.kod_gtp = sr.kod_gtp

      /*  inner join (-- сбытовая надбавка
      SELECT  :p_kod_gtp as kod_gtp, a.kod_m, tr.rate1 as rate_sbyt
      FROM ks_tarif t
      INNER JOIN adr_m a ON t.prizn_selo = a.kod_m
      INNER JOIN ks_tarif_rate tr ON t.tarif = tr.tarif
      WHERE tip_tarif_sost = 5  AND tarif_parent is not null
      AND (val_from &gt; 0 AND --or 
                                   val_to &gt; 0)  -- отчет пока только для одной группы мощности
      AND pr_active=0
      AND  a.kod_m = :p_kod_m_srf
      and kg.ym_first_day(:p_ym) between dat_beg and dat_end
      ) r_sbyt ON gtp.kod_gtp = r_sbyt.kod_gtp
      */
      -- сбытовая надбавка с объекта
      cross join (select kg_tarif.rate(tarif, 1, kg.YM_LAST_DAY(:p_ym)) as rate_sbyt
                   from ( select max(b.tarif) tarif
                           from kr_plan a, kr_plan_sost b
                           where a.kod_plan=b.kod_plan and tip_tarif_sost = 5
                               and a.kod_plan in(select hg_free.get_plan(kod_numobj, :p_ym, 0) from rr_rep_dog)
                        )
                ) r_sbyt

      inner join hk_voltage v ON sr.voltage = v.voltage
      WHERE gtp.kod_price_zone in (63, 64)
         AND tf.kodinterval = 24
         AND gtp.kod_gtp_gp is not null
         AND tfh.date_hour between to_date(kg.ym_first_day(:p_ym),'dd.mm.yyyy HH24:MI:SS')  AND to_date(kg.ym_last_day(:p_ym)||'23:00:00','dd.mm.yyyy HH24:MI:SS')      
         AND gtp.kod_gtp = :p_kod_gtp
         AND tfr.ym = :p_ym
    </view>
  </views>
  <reports child-name="report" key-name="name">
    <report name="61880_10_ryaz" title="38. Форма 47А 'Информация по реализации на потребительском рынке электрической энергии (мощности), предоставляемая участниками оптового рынка – энергосбытовыми компаниями, гарантирующими поставщиками в ОАО 'ЦФР''" nogrid="1" form="61880_10_ryaz" timestamp="02.02.2025 23:56:14" file="sql.builder.templates\sql.builder\projects\ryazan\reports\61880_10_ryaz.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_dep">
          <const exclude="1">1172</const>
        </param>
        <param type="number" name="p_ym_beg">
          <const exclude="1">2021.08</const>
        </param>
        <param type="number" name="p_ym_end">
          <const exclude="1">2021.09</const>
        </param>
        <param type="array" name="p_kod_adr_m">
          <const exclude="1">1172</const>
        </param>
        <param name="is_dog" type="number">
          <const>0</const>
        </param>
      </params>
      <procedure>
        <text>
          DECLARE tempp number;
          BEGIN
          tempp:= :is_dog;
          delete vr_number_array;
          -- Заполняем вр.таблицу VR_NUMBER_ARRAY фильтрами по отделению и региону РФ
          INSERT INTO vr_number_array (array_id,val)
          SELECT 'p_dep', kodp  FROM kr_org  WHERE 1=0 {OR kodp = :p_dep};

          INSERT INTO vr_number_array (array_id,val)
          SELECT 'p_kod_adr_m', kod_m  FROM adr_m  WHERE 1=0 {OR kod_m in :p_kod_adr_m};

          -- Заполняем вр.таблицу RR_REP_DOG краткой инф-цией по договорам в разрезе объектов на договоре (kod_numobj) и субъектов РФ
          KG_REP_DOG.dog_obj_short;

          -- Заполняем вр.таблицу RR_REP_PO данными по полезному отпуску в разрезе регионов по доп. регламенту "Факт" (из-за договоров с ежемесячным перерасчетом)
          -- для столбца 3а "Фактические начисления, в т.ч. без учета корректировок"
          ng_rep_other.po_per_region_sost(:p_ym_beg, :p_ym_end, 1, 0);

          -- Заполняем вр. таблицу RR_REP_DZ_KZ_DOG
          SG_REP_DZ_KZ.dz_kz_per_period_srf(:p_ym_beg, :p_ym_end);

          update rr_rep_dz_kz_dog t
          SET nachisl_osn_in_period_fact = ( select  sum(po.nachisl) as nachisl from rr_rep_po po  where t.kod_dog=po.kod_dog and t.kod_numobj = po.kod_numobj and po.kod_numobj is not null group by kod_numobj)
          WHERE kod_numobj is not null;
          
          END;</text>
      </procedure>
      <print-templates>
        <excel>
          <template name="61880_10_ryaz.xlsx" title="Информация о реализации на потребительском рынке электрической энергии и мощности" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="61880_10_main_ryaz" as="a">
          <withparams>
            <useparam name="is_dog" />
          </withparams>
        </query>
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym_beg" />
            <useparam name="p_ym_end" />
            <useparam name="p_dep" />
            <useparam name="p_kod_adr_m" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="61880_17_ryaz" form="61880_17" title="Форма 4.41. Раздел 1 (в разрезе договоров)" nogrid="1" timestamp="25.08.2024 14:07:07" file="sql.builder.templates\sql.builder\projects\ryazan\reports\61880_17_ryaz.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <usepart part="61880_17-params" />
      </params>
      <procedure>
        <text exclude="1">
        begin
        delete vr_number_array;
        for rec in (select * from kr_org where kodp in :p_dep)
        loop
        insert into vr_number_array (array_id,val) values ('p_dep',rec.kodp);
        end loop;
        sqlb_rep_61880_17.fill_table(:p_ym_beg);
        end;
      </text>
        <text>
        begin
        delete vr_number_array;
        for rec in (select * from kr_org where kodp in :p_dep)
        loop
        insert into vr_number_array (array_id,val) values ('p_dep',rec.kodp);
        end loop;
        
        for rec in (select * from adr_m where kod_m in :p_kod_adr_m)
        loop
        insert into vr_number_array (array_id,val) values ('adr_m',rec.kod_m);
        end loop;
       sqlb_rep_61880_17.fill_table_res;
        sqlb_rep_61880_17.fill_table(:p_ym_beg);
        end;
      </text>
      </procedure>
      <print-templates>
        <excel>
          <template name="61880_17_r1.xlsx" print-proc="2" print-xlsx="1" title="Макет 4.41 Раздел 1" />
        </excel>
      </print-templates>
      <queries>
        <query name="61880-17-data-rd1" as="a" exclude="1">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <useparam name="no_dog" />
          </withparams>
        </query>
        <query name="61880-17-data-rd1_ls10400" as="ls">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <useparam name="no_dog" />
          </withparams>
        </query>
        <query name="61880-17-data-rd1_gt10400" as="gt">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <useparam name="no_dog" />
          </withparams>
        </query>
        <query name="61880-17-data-rd1_10400" as="i10400">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <const name="no_dog">0</const>
          </withparams>
        </query>
        <query name="61880-17-data-rd1_351" as="i351">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <const name="no_dog">0</const>
          </withparams>
        </query>
        <query name="61880-17-data-rd1_352" as="i352">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <const name="no_dog">0</const>
          </withparams>
        </query>
        <query name="61880-17-data-rd1_353" as="i353">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <useparam name="no_dog" />
          </withparams>
        </query>
        <query name="61880-17-data-rd1_3511" as="i3511">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <useparam name="no_dog">0</useparam>
          </withparams>
        </query>
        <query name="61880-17-data-rd1_3512" as="i3512">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <useparam name="no_dog">0</useparam>
          </withparams>
        </query>
        <query name="61880-17-data-rd1_3514" as="i3514">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <useparam name="no_dog">0</useparam>
          </withparams>
        </query>
        <query name="61880-17-data-rd1a" as="a1">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <useparam name="no_dog" />
          </withparams>
        </query>
        <query name="61880-17-title" as="pars">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <useparam name="no_dog" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="61880_17_v3_ryaz" form="61880_17_v3" title="Форма 4.41. Раздел 1 " nogrid="1" timestamp="27.06.2025 18:24:19" file="sql.builder.templates\sql.builder\projects\ryazan\reports\61880_17_v3_ryaz.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <usepart part="61880_17-params" />
      </params>
      <procedure>
        <text exclude="1">
        begin
        delete vr_number_array;
        for rec in (select * from kr_org where kodp in :p_dep)
        loop
        insert into vr_number_array (array_id,val) values ('p_dep',rec.kodp);
        end loop;

       sqlb_rep_61880_17.fill_table_res;
        sqlb_rep_61880_17.fill_table(:p_ym_beg);
        end;
      </text>
        <text>
        begin
        delete vr_number_array;
        for rec in (select * from kr_org where kodp in :p_dep)
        loop
        insert into vr_number_array (array_id,val) values ('p_dep',rec.kodp);
        end loop;
        
        for rec in (select * from adr_m where kod_m in :p_kod_adr_m)
        loop
        insert into vr_number_array (array_id,val) values ('adr_m',rec.kod_m);
        end loop;
       sqlb_rep_61880_17.fill_table_res;
        sqlb_rep_61880_17.fill_table_ryaz(:p_ym_beg);
        end;
      </text>
      </procedure>
      <print-templates>
        <excel>
          <template name="61880_17_v3.xlsx" print-proc="2" print-xlsx="1" title="Макет 4.41 Раздел 1" />
        </excel>
      </print-templates>
      <queries>
        <query name="61880-17-data-res" as="res">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <useparam name="no_dog" />
          </withparams>
        </query>
        <query name="61880-17-data-rd1a_new" as="a1">
          <withparams>
            <useparam name="p_kod_adr_m" />
          </withparams>
        </query>
        <query name="61880-17-data-rd10920_new" as="a10920">
          <withparams>
            <useparam name="p_kod_adr_m" />
          </withparams>
        </query>
        <query name="61880-17-data-10910" as="a10910">
          <withparams>
            <useparam name="p_kod_adr_m" />
          </withparams>
        </query>
        <query name="61880-17-v3-title" as="pars">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
            <useparam name="p_kod_adr_m" />
            <useparam name="no_dog" />
          </withparams>
        </query>
        <query name="kr_employee_info_short" as="add_info">
          <withparams>
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="64649_ryaz" form="64649" title="57. Форма 4.27. Сведения об энергосбытовых организациях-субъектах розничных рынков электрической энергии (10155)" nogrid="1" timestamp="23.11.2024 13:02:37" file="sql.builder.templates\sql.builder\projects\ryazan\reports\64649_ryaz.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="array" name="p_dep">
          <const exclude="1">1172</const>
        </param>
        <param type="number" name="p_ym_beg" comment="Отчётный период">
          <const exclude="1">2021.08</const>
        </param>
      </params>
      <print-templates>
        <excel>
          <template name="64649.xlsx" print-proc="2" print-xlsx="1" title="Макет 4.27" />
        </excel>
      </print-templates>
      <queries>
        <query name="64649_ryaz_data" as="res">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
          </withparams>
        </query>
        <query name="61880-17-v3-title" as="pars">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym_beg" />
          </withparams>
        </query>
        <query name="kr_employee_info_short" as="add_info">
          <withparams>
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72257" form="72257" title="28. Отчет по корректировкам в разрезе счетов-фактур" nogrid="1" timestamp="19.08.2024 00:07:55" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72257.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_ym" type="number" />
        <param name="p_dep" type="number" />
      </params>
      <print-templates>
        <excel>
          <template name="72257.xlsx" print-proc="2" print-xlsx="1" title="Отчет по корректировкам в разрезе счетов-фактур" />
        </excel>
      </print-templates>
      <procedure><![CDATA[begin
    delete vr_number_array;
  
  kg_rep_dog.dog_orem(:p_ym,1);  -- заполняем vr_number_array kod_dog с ОРЭМ
   kg_rep_dog.dog_adjustment(:p_ym,2);  --   оставляем в vr_number_array только договоры с корректировкой 
 

  insert into vr_number_array (array_id,val) values ('p_dep',:p_dep);
  
   kg_rep_dog.dog_short;
 
sg_rep_dz_kz.corrective_invoice_per_period (:p_ym, :p_ym);
 


end;]]></procedure>
      <queries>
        <query name="72257_data" as="a" />
        <query name="title_info" as="title">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72319" title="34. Справка об ожидаемом поступлении оплаты" nogrid="1" form="72319" timestamp="22.11.2024 21:13:35" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72319.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_ym" type="number" />
        <param name="p_dep" type="number" />
        <param name="p_is_flag" type="number">
          <const type="number">0</const>
        </param>
      </params>
      <print-templates>
        <excel>
          <template name="72319.xlsx" print-proc="2" print-xlsx="1" title="Справка об ожидаемом поступлении оплаты" />
        </excel>
      </print-templates>
      <procedure><![CDATA[begin


  
  delete vr_number_array;
 
  
 

 insert into vr_number_array (array_id,val) values ('p_dep',:p_dep);
 
  
    sg_rep_dz_kz.dz_kz_per_period_dog (:p_ym, :p_ym);
 
 
    kg_rep_dog.dog_short(:p_ym);




end;]]></procedure>
      <queries>
        <query name="72319_data" as="a">
          <withparams>
            <useparam name="p_is_flag" />
          </withparams>
        </query>
        <query name="title_info" as="title">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
            <const name="p_adr_m">null</const>
            <useparam name="p_is_flag" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72418" form="72418" title="19. Полезный отпуск по г. Рязань. " nogrid="1" timestamp="08.08.2024 09:35:01" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72418.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param name="p_year" type="number" />
        <param name="p_kv" type="number" />
      </params>
      <print-templates>
        <excel>
          <template name="72418.xlsx" print-proc="2" print-xlsx="1" title="Полезный отпуск по г. Рязань" />
        </excel>
      </print-templates>
      <procedure><![CDATA[DECLARE
   p_dep         kr_dogovor.dep%type;
   p_year        number;
   p_ym_beg      nv_account.ym%type;
   p_ym_end      nv_account.ym%type;
   s_data_id     rr_temp.skod%type;
BEGIN
  p_dep        := :p_dep;
  p_year       := :p_year;
  p_ym_beg     := p_year + (:p_kv * 3 - 2) / 100;  -- первый месяц квартала периода
  p_ym_end     := p_year + (:p_kv * 3) / 100;	   -- последний месяц квартала периода	
  s_data_id    :='{3d8b60b1-6cd0-416a-ac16-8c99c9d294fb}';         
  
  DELETE FROM rr_temp WHERE skod = s_data_id;
  
  INSERT INTO rr_temp (skod, n1)  
  SELECT  s_data_id,
          sum(CASE WHEN (nk_adress_r.get_oktmo_h(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END)) = 61701000001  -- OКТМО г. Рязань
                  THEN a.cust
                  ELSE 0 
              END) as cust
    FROM nv_account_priem a
      INNER JOIN kr_dogovor d ON a.kod_dog=d.kod_dog             
	  INNER JOIN kr_dogovor dp On dp.kod_dog = d.kod_dog_fin                
      LEFT JOIN kr_numobj no ON no.kod_numobj = a.kod_numobj
      LEFT JOIN kr_object ob ON ob.kod_obj = no.kod_obj             
      LEFT JOIN sk_nachisl n ON a.vid_t=n.vid_t
      LEFT JOIN sk_vid_real vr ON n.vid_real = vr.vid_real
      LEFT JOIN sk_edizm e ON n.edizm = e.edizm
   WHERE  a.ym BETWEEN p_ym_beg AND p_ym_end  
       AND dp.dep = p_dep
       AND a.price is not null
       AND vr.pr_osn = 1 -- основная реализация
       AND e.kod_okei = '245' -- kvth 
 ; END;]]></procedure>
      <queries>
        <query name="72418_data" as="a" />
      </queries>
    </report>
    <report name="72430" form="72430" title="18. Сведения о дебиторской задолженности по НЭСК." nogrid="1" timestamp="04.03.2025 17:56:03" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72430.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
        <param name="p_kod_m_srf" type="array" />
        <param name="p_no_dog" type="array" />
        <param type="number" name="p_no_detail" />
      </params>
      <print-templates>
        <excel>
          <template name="72430.xlsx" print-proc="2" print-xlsx="1" title="Сведения о дебиторской задолженности по НЭСК" />
        </excel>
      </print-templates>
      <procedure><![CDATA[declare 
   ym_year_begin number;
begin
 
 -- почти все данные в отчете формируются нарастающим итогом с начала года:
  ym_year_begin := trunc(:p_ym)+0.01;
 
  delete vr_number_array;
   
 -- добавляем во временную таблицу данные по выбранным отделениям
  INSERT INTO vr_number_array (array_id,val) values ('p_dep',:p_dep);
     
  -- добавляем во временную таблицу данные по выбранным субъектам РФ
  INSERT INTO vr_number_array (array_id,val)  
       SELECT 'p_kod_m_srf', kod_m FROM adr_m WHERE 1=0 {OR kod_m in :p_kod_m_srf};
 -- заполняем вр. таблицу rr_rep_dog данными по договорам
  kg_rep_dog.dog_obj_short;

 -- Удаляем "договоры вне списка"
  DELETE rr_rep_dog where  1 = 0  {OR kod_dog in :p_no_dog};

 -- заполняем вр. таблицу  rr_rep_dz_kz_dog по данными по ДЗ
  SG_REP_DZ_KZ.dz_kz_per_period_srf(ym_year_begin,:p_ym); 
end;]]></procedure>
      <queries>
        <query name="72430_data" as="a">
          <withparams>
            <useparam name="p_kod_m_srf" />
            <useparam name="p_no_detail" />
          </withparams>
        </query>
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
            <useparam name="p_kod_m_srf" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72482" form="72482" title="37. Тест выставленных счетов-фактур" nogrid="1" timestamp="14.08.2024 23:44:25" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72482.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" title="Подразделение" />
        <param name="p_ym" type="number" title="Период" />
        <param name="p_kod_dog" title="Договоры" type="array" />
      </params>
      <print-templates>
        <excel>
          <template name="72482.xlsx" print-proc="2" print-xlsx="1" title="Тест выставленных счетов-фактур" />
        </excel>
      </print-templates>
      <procedure><![CDATA[
BEGIN
  
   delete vr_number_array;
   insert into vr_number_array (array_id,val) values ('p_dep',:p_dep);
   -- Получаем краткую информацию по договорам отделения
   kg_rep_dog.dog_short; 
   
  DELETE FROM rr_rep_dz_kz;
  
  INSERT INTO rr_rep_dz_kz (  kod_dog
						--	, ym
						    , kod_Sf
							, nom_sf       -- полный номер сф (номер и дата)                           		
							, nachisl   -- начислено с ндс 
							, nal       -- начислено налога  
							, nachisl_re -- выставлен сф с ндс
							, nal_re     -- выставлен налог по сф
						  )  
  WITH
	 sf as ( -- выставленные СФ и налог по ним
			 SELECT dp.kod_dog
                 , fv.ym
                 , fr.rym as rym_max
				 , max(fv.kod_sf) as kod_sf
                 , max(fv.nom_sf || ' от ' || to_char(fv.dat_sf,'dd.mm.yyyy')) as nom_sf
                 , SUM(nvl(fr.nachisl,0)) as nachisl_re
                 , SUM(nvl(fr.nal,0)) as nal_re
             FROM sr_facvip fv
                INNER JOIN (select kod_sf
                                   , max(rym) rym 
                                   , SUM(nvl(f.nachisl,0)) as nachisl
                                   , SUM(nvl(nal,0)) as nal
                              FROM  sr_facras f
                                LEFT JOIN (SELECT SUM(nvl(nal,0)) as nal, kod_ras FROM sr_facras_nal GROUP BY kod_ras) n ON f.kod_ras = n.kod_ras
                                LEFT JOIN sk_nachisl n ON f.vid_t = n.vid_t
                                LEFT JOIN sk_vid_real vr ON n.vid_real = vr.vid_real
                              WHERE  f.price is not null 
  							      AND NOT (nvl(f.price,0) = 0 and f.vid_t in (22,42,62,72))
                                  AND vr.pr_osn = 1   -- основная реализация
                              GROUP BY f.kod_sf  
                           ) fr ON fv.kod_sf = fr.kod_sf
                INNER JOIN kr_dogovor d ON fv.kod_dog=d.kod_dog             
                INNER JOIN kr_dogovor dp On dp.kod_dog = d.kod_dog_fin                
			WHERE  fv.ym = :p_ym 
			   AND fv.pr_osn=1
			   AND dp.dep = :p_dep 
			  -- AND ((cnt_dog = 0) Or (cnt_dog > 0 And dp.kod_dog IN (SELECT val FROM vr_number_array WHERE array_id = 'p_kod_dog')))
			  { AND dp.kod_dog IN :p_kod_dog }
		   GROUP BY dp.kod_dog, ym, rym
		)
    , nach AS ( -- начисления
			 SELECT kod_dog as kod_dog_acc
				  , nvl(rym, ym) as rym_acc
				  , ym as ym_acc
				  , sum(nachisl) as nachisl_acc
				  , sum(nal) as nal_acc
			   FROM nv_account 
			  WHERE ym = :p_ym
				AND vid_real=2 
			    AND dep = :p_dep 
			   -- AND ((cnt_dog = 0) Or (cnt_dog > 0 And kod_dog IN (SELECT val FROM vr_number_array WHERE array_id = 'p_kod_dog')))
			   { AND kod_dog IN :p_kod_dog }
			 GROUP BY kod_dog, ym, nvl(rym, ym)
				)
   SELECT  sf.kod_dog
         , sf.kod_Sf
         , sf.nom_sf
         , nach.nachisl_acc as nachisl
         , nach.nal_acc as nal
         , sf.nachisl_re as nachisl_re
         , sf.nal_re as nal_re
      FROM sf
         LEFT JOIN nach ON nach.kod_dog_acc = sf.kod_dog and nach.rym_acc = sf.rym_max
	;
	
 END;
 
 ]]></procedure>
      <queries>
        <query name="72482_data" as="d" />
        <query name="title_info" as="title">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72544" title="8. Анализ сбытовых надбавок гарантирующих поставщиков" form="72544" nogrid="1" timestamp="24.12.2024 13:35:11" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72544.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_year1" />
        <param type="number" name="p_year2" />
        <param name="p_kod_m_srf" type="number" />
        <param name="p_guarantp" type="number" />
      </params>
      <print-templates>
        <excel>
          <template name="72544.xlsx" print-proc="2" print-xlsx="1" title="Анализ сбытовых надбавок гарантирующих поставщиков" />
        </excel>
      </print-templates>
      <procedure><![CDATA[   BEGIN
         ng_rep_other.get_rate_per_part_year(p_year1=>:p_year1,p_year2=>:p_year2 {, p_kod_m=> :p_kod_m_srf}{, p_kodp=>:p_guarantp});
 END;]]></procedure>
      <queries>
        <query name="72544_main_data" as="d" />
        <query name="title_info" as="t">
          <withparams>
            <const>NULL</const>
            <const>NULL</const>
            <const>NULL</const>
            <useparam name="p_kod_m_srf" type="number" />
          </withparams>
        </query>
        <query name="72544_title" as="t_gp">
          <withparams>
            <useparam name="p_guarantp" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72554" title="12. ФОРМА 151с (Информация о сетевых организациях)" form="72554" nogrid="1" timestamp="13.03.2025 10:42:58" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72554.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_dep" />
        <param type="number" name="p_ym" />
      </params>
      <print-templates>
        <excel>
          <template title="ФОРМА 151с (Информация о сетевых организациях)" print-xlsx="1" name="72554.xlsx" />
        </excel>
      </print-templates>
      <procedure><![CDATA[DECLARE
    s_data_id rr_temp.skod%type;
    i_kod_vdoc    NUMBER;
    i_kod_vdog NUMBER;
    i_first_day_ym_next   DATE;
BEGIN
  s_data_id    :='3d8b60b1-7255-416a-ac16-8c99c9d294fb';
  i_first_day_ym_next := kg.ym_first_day(kg.ym_add(:p_ym,1));
  DELETE FROM rr_temp WHERE skod = s_data_id;

  Select kod_vdoc 
     Into i_kod_vdoc
    From ks_vdoc where abbr ='ду';     -- договор услуг. В Рязани kod_vdoc = 25
  
  Select kod_vdog   Into i_kod_vdog
  From ks_vdog where kod_vdoc = nvl(i_kod_vdoc,-99999999)   AND kod_tipdog = 1 ; 

INSERT INTO rr_temp (skod, s1, n1, s2)
SELECT s_data_id    
       , name as sname
       , inn  
       , case WHEN dat_dog between kg.ym_first_day(:p_ym) and kg.ym_last_day(:p_ym) THEN 'добавлена'
              WHEN dat_fin between kg.ym_first_day(:p_ym) and kg.ym_last_day(:p_ym) THEN 'удалена' 
        END as status
from kr_dogovor d
  inner join kr_payer p ON d.kodp = p.kodp
where d.tep_el=7 AND d.kod_vdog = nvl(i_kod_vdog,-999999)  AND p.kod_ecls in (2,5)
    AND d.dat_dog < i_first_day_ym_next ;  
END;
 ]]></procedure>
      <queries>
        <query name="72554_main_data" as="a" />
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72559" title="13. ФОРМА 151 (ИНФОРМАЦИЯ О СУБЪЕКТАХ)" form="72559" nogrid="1" timestamp="10.06.2025 20:35:56" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72559.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_dep" />
        <param type="number" name="p_ym" />
      </params>
      <print-templates>
        <excel>
          <template print-xlsx="1" name="72559.xlsx" title="ФОРМА 151 (ИНФОРМАЦИЯ О СУБЪЕКТАХ)" />
        </excel>
      </print-templates>
      <procedure><![CDATA[DECLARE
    s_data_id rr_temp.skod%type;   
 BEGIN
  s_data_id    :='3d8b60b1-7255-916a-ac16-8c99c9d294fb';
  DELETE FROM rr_temp WHERE skod = s_data_id;

INSERT INTO rr_temp (skod, n1, s1, s2, s3)
with 
  param as (select  kg.ym_first_day(:p_ym) as p_first_day_ym
	                 , kg.ym_last_day(:p_ym) as p_last_day_ym
                	 , kg.ym_first_day(kg.ym_add(:p_ym,-1)) as p_first_day_ym_pre
	                 , kg.ym_last_day(kg.ym_add(:p_ym,-1)) as p_last_day_ym_pre
                   from dual
           )
 , vdog as (select kod_vdog from ks_vdog where kod_tipdog = 0)
 , pre as  (
       SELECT  nk_adress.kf_get_sf(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as kod_srf
        , nk_adress.kp_get_region_name(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as kod_region_name
        , substr(nk_adress_r.get_oktmo_k_house(Decode(ob.kodd, -1, d.kod_d_dog,ob.kodd)),1,2) as srf_oktmo
        , n.kod_numobj as kod_numobj
        , CASE WHEN COALESCE(n.DAT_POSTAV_OBJ,n.dat_create) between p_first_day_ym and p_last_day_ym THEN 1 --'добавлена' 
               WHEN n.dat_fin between p_first_day_ym_pre and p_last_day_ym_pre THEN 2 --'удалена'
               ELSE CASE WHEN COALESCE(n.DAT_POSTAV_OBJ,n.dat_create) < p_first_day_ym THEN 3 --'без изменений' 
                    ELSE 4 --'' 
                    END
          END as status
    FROM kr_dogovor d
        INNER JOIN kr_numobj n ON d.kod_dog = n.kod_dog
        INNER JOIN kr_object ob ON n.kod_obj = ob.kod_obj
        INNER JOIN vdog v ON d.kod_vdog = v.kod_vdog
    cross join param
      where 1=1 { AND d.dep IN :p_dep}  
           and (n.dat_fin is null OR n.dat_fin is not null AND n.dat_fin >= p_first_day_ym_pre) -- НЕ берем договоры (все объекты), которые закончили свое действие за месяц до периода отчета
      )
, pre_obj as (
   select srf_oktmo
       , max(kod_region_name) as kod_region_name   
       , count(CASE WHEN status= 1 THEN kod_numobj END) as s1
       , count(CASE WHEN status= 2 THEN kod_numobj END) as s2
       , count(CASE WHEN status= 3 THEN kod_numobj END) as s3      
     from pre
	 where status < 4
     group by srf_oktmo 
    )
select s_data_id 
     ,  srf_oktmo   -- код региона из ОКТМО
     , kod_region_name
     , CASE WHEN :p_dep = 1172 THEN 'ЭСК' 
            WHEN :p_dep = 27435 THEN 'ГП' END as status_dep
     , CASE WHEN s3 > 0 OR (s1 > 0 AND s2 > 0) THEN 'без изменений' 
            WHEN s1 > 0 THEN 'прибыл'
            WHEN s2 > 0 THEN 'убыл'
        END as status
from pre_obj
;
END;   ]]></procedure>
      <queries>
        <query name="72559_main_data" as="a" />
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72565" form="72565" title="15. Информация о фактических объемах потребления э/э потребителями э/э с годовым объемом потребления э/э, составляющим 60 млн. кВт·ч или более (Форма 39)" nogrid="1" timestamp="02.10.2024 16:57:15" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72565.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
        <param name="p_kod_adr_m" type="array" />
        <param name="kod_emp" type="number" />
      </params>
      <print-templates>
        <excel>
          <template print-xlsx="1" name="72565.xlsx" title="Информация о фактических объемах потребления ЭЭ с годовым объемом потребления 60 млн. кВт·ч  и более (Форма 39)" />
        </excel>
      </print-templates>
      <procedure><![CDATA[DECLARE
 
  p_ym_beg NUMBER;
 

BEGIN



 delete vr_number_array;


 INSERT INTO vr_number_array (array_id,val)  
 
 SELECT 'p_kod_adr_m', kod_m
 FROM adr_m 
 WHERE 1=0 {OR kod_m in :p_kod_adr_m};

 

 INSERT INTO vr_number_array (array_id,val)  
 
 SELECT 'p_kodp', objid as val  
  From rr_refprop ref_p Join rs_refcode ref_c On ref_c.kod_refcode = ref_p.kod_refcode
 Where kod_refbook = 301 and kod_refobject = 1 -- kodp
Group by objid;



   
p_ym_beg := TRUNC(:p_ym)+0.01;

  
   ng_rep_other.po_per_region(p_ym_beg, :p_ym);




END;]]></procedure>
      <queries>
        <query name="72565_data" as="a" />
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
          </withparams>
        </query>
        <query name="query_fio" as="sign">
          <withparams>
            <call name="kod_emp" function="nvl">
              <useparam name="kod_emp" />
              <const>-1</const>
            </call>
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72587" form="72587" title="17. СЗ НЭСК ДЛЯ УиЭФ" nogrid="1" timestamp="21.02.2025 12:02:48" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72587.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
        <param name="p_is_dkp" type="number">
          <const type="number">0</const>
        </param>
        <param name="p_is_rrem" type="number">
          <const type="number">0</const>
        </param>
      </params>
      <print-templates>
        <excel>
          <template name="72587.xlsx" print-proc="2" print-xlsx="1" title="СЗ НЭСК ДЛЯ УиЭФ" />
        </excel>
      </print-templates>
      <procedure><![CDATA[
DECLARE
   s_data_id     rr_temp.skod%type;
 BEGIN
  s_data_id    :='{3d8b60b1-7258-716a-ac16-8c99c9d294fb}';         
  
  DELETE FROM rr_temp WHERE skod = s_data_id;
  INSERT INTO rr_temp (skod, -- kod report
                       n1,   -- kodp для ТСО (услуги по пеердаче)
                       s1,   -- наименование ТСО (по услугам по передаче)
                       n2,   -- код региона
                       s2,   -- наименование региона
                       n3,   -- номер группы потребителей ( 1 - прочие или 2 - население)      
                       s3,   -- наименование группы потребителей
                       n4,   -- фактический УН
                       s4,   -- наименование фактического УН
                       n5,   -- натуральные показатели мощности: ПО КВтч одноставочный
                       n6,   -- натуральные показатели мощности: ПО КВтч двуxставочный
                       n7    -- натуральные показатели э/э: ПО КВт
                       ) 
 WITH
  pre_pr as (  -- Услуги по передаче (по состовляющей = 2) по группе потребителей
    SELECT   tco.kodp as tco_pwr_kodp
           , tco.name as tco_pwr_kodp_name
           , nk_adress.kf_get_sf(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as kod_region
           , nk_adress.kp_get_region_name(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as region_name

           , 1 as gr_num
           , 'Прочие потребители, в т.ч. по уровням напряжения:' as gr_name  
           , COALESCE(HG_CONTROLPOINT_R.get_factVoltage_byNumObj(a.kod_numobj,a.ym), a.voltage) as voltage_fact           
           , CASE WHEN kg_tarif.is_2rate(kg_tarif.subtarif_voltage(b.tarif, a.voltage, a.dat_priem - 1E-5), a.dat_priem - 1E-5) != 1 AND s.edizm = 4 THEN COALESCE(b.cust,0) ELSE 0 END  as cust_kvth_1
           , CASE WHEN kg_tarif.is_2rate(kg_tarif.subtarif_voltage(b.tarif, a.voltage, a.dat_priem - 1E-5), a.dat_priem - 1E-5) = 1 AND s.edizm = 4 THEN COALESCE(b.cust,0) ELSE 0 END  as cust_kvth_2
           , CASE WHEN s.edizm = 3 AND a.vid_t = -222 THEN a.cust ELSE 0 END as cust_kvt   -- сетевая мощность 
      FROM nr_account a
         LEFT JOIN (select kod_account, max(tip_tarif_sost) as tip_tarif_sost
                         , max(tarif) as tarif                       
                         , SUM(cust) as cust
                      from nr_account_sost
                     where tip_tarif_sost = 2 
                     group by kod_account
                    ) b ON a.kod_account = b.kod_account
         INNER JOIN hr_reglament_pp p ON a.kod_reglament=p.kod_reglament
         INNER JOIN hr_calc_variant v ON v.kod_variant=p.kod_variant 
         INNER JOIN sk_nachisl s ON a.vid_t=s.vid_t
         INNER JOIN kr_dogovor d ON a.kod_dog = d.kod_dog
         INNER JOIN kr_dogovor dp ON d.kod_dog_fin = dp.kod_dog
         INNER JOIN ks_vdog vd ON dp.kod_vdog = vd.kod_vdog
         LEFT JOIN kr_numobj kr_n ON a.kod_numobj = kr_n.kod_numobj
         LEFT JOIN kr_object ob ON kr_n.kod_obj = ob.kod_obj
      --   LEFT JOIN kr_payer p ON dp.kodp = p.kodp   -- потребитель
         LEFT JOIN  TABLE (HG_SALEPOINT_R.PL_getSLPOrgs (kod_numobj_   => a.kod_numobj,
                                                             ym_       => a.ym)) pc    ON (a.kod_numobj = pc.kod_numobj)
         LEFT JOIN kr_payer tco ON (pc.kodp_pwrcompany = tco.kodp)
      WHERE 1=1   { AND dp.dep IN :p_dep}               
           { AND a.ym = :p_ym}
           AND v.kod_typevariant = 1 -- покупка
           AND (b.tip_tarif_sost = 2  )  -- составляющая по услуге по передаче        
           AND s.edizm in (3,4)
           AND a.price IS not null
           AND a.rym is null
           AND dp.pr_active in (0,2)
           AND vd.kod_vdoc=1 and vd.kod_tipdog=0
          )
  , pre_byt as ( -- население 
    SELECT   tco.kodp as tco_pwr_kodp
           , tco.name as tco_pwr_kodp_name
           , nk_adress.kf_get_sf(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as kod_region
           , nk_adress.kp_get_region_name(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as region_name
           , 2 as gr_num 
           , 'Исполнители коммунальных услуг' as gr_name
           , COALESCE(HG_CONTROLPOINT_R.get_factVoltage_byNumObj(a.kod_numobj,a.ym), a.voltage) as voltage_fact
           , CASE WHEN s.edizm = 4 THEN COALESCE(a.cust,0) ELSE 0 END as cust_kvth_1
           , CASE WHEN s.edizm = 3 AND a.vid_t = -222 THEN a.cust ELSE 0 END as cust_kvt   -- нужно проработать вопрос с заказчиком и доработать если нужно
       FROM nr_account a
          INNER JOIN hr_reglament_pp p ON a.kod_reglament=p.kod_reglament
          INNER JOIN hr_calc_variant v ON v.kod_variant=p.kod_variant 
          INNER JOIN sk_nachisl s ON a.vid_t=s.vid_t
          INNER JOIN kr_dogovor d ON a.kod_dog = d.kod_dog
          INNER JOIN kr_dogovor dp ON d.kod_dog_fin = dp.kod_dog
          LEFT JOIN kr_numobj kr_n ON a.kod_numobj = kr_n.kod_numobj
          LEFT JOIN kr_object ob ON kr_n.kod_obj = ob.kod_obj
         -- LEFT JOIN kr_payer p ON dp.kodp = p.kodp   -- потребитель
          LEFT JOIN  TABLE (HG_SALEPOINT_R.PL_getSLPOrgs (kod_numobj_   => a.kod_numobj,
                                                              ym_       => a.ym)) pc    ON (a.kod_numobj = pc.kod_numobj)
          LEFT JOIN kr_payer tco ON (pc.kodp_pwrcompany = tco.kodp)
      WHERE 1=1   { AND dp.dep IN :p_dep}               
          { AND a.ym = :p_ym}
          AND v.kod_typevariant = 1 /*покупка*/
          AND s.edizm in (3,4)
          AND a.price IS not null
          AND a.rym is null
          AND dp.pr_active in (0,2)
          AND Decode(nvl(a.tarif,0), 0, 0, kg_tarif.f_byt_cached(a.tarif)) <> 0   -- население определяем по тарифу byt
            )
                 
      SELECT  s_data_id , 
            tco_pwr_kodp as tco_pwr_kodp
           , MAX(tco_pwr_kodp_name) as tco_pwr_name
           , kod_region as kod_region
           , max(region_name) as region_name
           , gr_num as gr_num
           , MAX(gr_name) as gr_name              
           , CASE WHEN nvl(voltage_fact,0) in (-1,6,7) THEN 3 ELSE nvl(voltage_fact,0) END as voltage_fact
           , MAX(CASE WHEN nvl(voltage_fact,0) in (-1,6,7) THEN 'ВН' ELSE COALESCE(vol.abbr,'-') END) as voltage_fact_abbr
           , SUM(cust_kvth_1) as cust_kvth_1   -- натуральные показатели  cust Э/э одноставочный
           , SUM(cust_kvth_2) as cust_kvth_2   -- натуральные показатели  cust э/э двухставочный
           , SUM(cust_kvt) as cust_kvt   -- натуральные показатели     
        FROM pre_pr -- группа Прочие
          LEFT JOIN hk_voltage vol ON pre_pr.voltage_fact = vol.voltage
        GROUP BY kod_region, tco_pwr_kodp, gr_num, nvl(voltage_fact,0)
      UNION ALL
        SELECT  s_data_id ,
              tco_pwr_kodp as tco_pwr_kodp
             , MAX(tco_pwr_kodp_name) as tco_pwr_name
             , kod_region as kod_region
             , max(region_name) as region_name
             , gr_num as gr_num
             , MAX(gr_name) as gr_name    
             , CASE WHEN nvl(voltage_fact,0) in (-1,6,7) THEN 3 ELSE nvl(voltage_fact,0) END as voltage_fact
             , MAX(CASE WHEN nvl(voltage_fact,0) in (-1,6,7) THEN 'ВН' ELSE COALESCE(vol.abbr,'-') END) as voltage_fact_abbr
             , SUM(cust_kvth_1) as cust_kvth_1   -- натуральные показатели   
             , 0 as cust_kvth_2  
             , SUM(cust_kvt) as cust_kvt   -- натуральные показатели      
        FROM pre_byt  -- население
          LEFT JOIN hk_voltage vol ON pre_byt.voltage_fact = vol.voltage
        GROUP BY  tco_pwr_kodp, kod_region, gr_num, nvl(voltage_fact,0)     ;
END;
]]></procedure>
      <queries>
        <query name="72587_data" as="d" />
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72589" title="58. Фактическая покупка-продажа ООО &quot;РГМЭК&quot; электрической энергии и мощности" form="72589" nogrid="1" timestamp="14.10.2024 14:41:31" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72589.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_ym_beg" />
        <param type="number" name="p_ym_end" />
      </params>
      <print-templates exclude="1">
        <excel>
          <template name="72589.xlsx" print-proc="2" print-xlsx="1" title="Фактическая покупка-продажа ООО 'РГМЭК' электрической энергии и мощности" />
        </excel>
      </print-templates>
      <procedure exclude="1" />
      <queries>
        <query name="title_info" as="title">
          <withparams>
            <useparam name="p_ym_beg" type="number" />
            <useparam name="p_ym_end" type="number" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72595" title="29. Отчет по начисленной мощности" form="72595" nogrid="1" timestamp="14.03.2025 14:42:28" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72595.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
        <param name="p_no_dog" type="array" />
      </params>
      <print-templates>
        <excel>
          <template name="72595.xlsx" print-proc="2" print-xlsx="1" title="Отчет по начисленной мощности" />
        </excel>
      </print-templates>
      <procedure><![CDATA[DECLARE
   s_data_id     rr_temp.skod%type;
   p_ym          NUMBER;
 BEGIN
  s_data_id    :='{3d8b60b1-72595-ac16-8c99c9d294fb}';  
  p_ym := :p_ym;       
  delete vr_number_array;     
 -- добавляем во временную таблицу данные по выбранному отделению
  INSERT INTO vr_number_array (array_id,val) values ('p_dep',:p_dep);  -- добавляем фильтр по отделению
  INSERT INTO vr_number_array (array_id,val) values ('p_tipdog',0);    -- нужны только договоры э/э и купли-продажи    
 -- заполняем вр. таблицу rr_rep_dog данными по договорам в разрезе объектов
  kg_rep_dog.dog_obj_short;

 -- Удаляем "договоры вне списка"
  DELETE rr_rep_dog where 1 = 0 {OR kod_dog in :p_no_dog};

  DELETE FROM rr_temp WHERE skod = s_data_id;
  -- заполняем вр. таблицу  rr_temp
  INSERT INTO rr_temp (skod, -- kod report
                       n1,   -- kodp для ТСО
                       s1,   -- tco_name
                       n2,   -- kod_dog
                       s2,   -- ndog
                       n3,   -- kod_numobj
                       n4,   -- numobj_num
                       s3,   -- numobj_name
                       n5,   -- max_power (максимальная мощность на объекте)
                       n6,   -- max_by_obj_per_period (максимальное числовое значение по объекту в течение месяца)
                       n7,   -- cust_kvth
                       n8,   -- cust_kvt
                       n9,   -- cust_kvt_set
                       n10   -- kod_gtp               
                        )     
   SELECT  s_data_id,
         max(tco.kodp) as kodp_tco
        , max(tco.name) as tco_name
        , max(a.kod_dog) as kod_dog
        , max(d.ndog) as ndog        
        , a.kod_numobj
        , max(n.num_obj) as numobj_num
        , max(n.name) as numobj_name
        , max(COALESCE(HG_DOGR.get_PMAX_NUMOBJ(a.kod_numobj, 2, kg.ym_first_day(a.ym) ,0,null),0)) as max_power
        , max(ng_priem.f_max_potr_hour(a.kod_numobj,p_ym)) as max_by_obj_per_period  -- максимальное числовое значение по объекту в течение месяца
        , sum(CASE WHEN s.edizm = 4 THEN COALESCE(cust,0) ELSE 0 END)   as cust_kvth
        , sum(CASE WHEN a.vid_t = -272 THEN COALESCE(cust,0) ELSE 0 END)  as cust_kvt
        , sum(CASE WHEN a.vid_t = -222 THEN COALESCE(cust,0) ELSE 0 END) as cust_kvt_set
        , max(COALESCE(hg_common.get_gtp_add_regl(a.kod_numobj, ym, 0),0)) as kod_gtp
FROM rr_rep_dog d   
   INNER JOIN nr_account a ON d.kod_numobj = a.kod_numobj  -- предварительно таблица rr_rep_dog д.б. заполнена данными по нужным договорам с нужными фильтрами  
   INNER JOIN TABLE (HG_SALEPOINT_R.PL_getSLPOrgs (kod_numobj_  => a.kod_numobj,
                                                       ym_      => p_ym)     
                                                   ) pc  ON (a.kod_numobj = pc.kod_numobj)
   LEFT JOIN kr_payer tco ON pc.kodp_pwrcompany = tco.kodp  
   INNER JOIN sk_nachisl s ON a.vid_t = s.vid_t
   INNER JOIN hr_reglament_pp p ON a.kod_reglament = p.kod_reglament
   INNER JOIN hr_calc_variant v ON p.kod_variant = v.kod_variant   
   LEFT JOIN kr_numobj n ON a.kod_numobj = n.kod_numobj  
 WHERE a.ym = p_ym 
   AND kod_typevariant = 0 -- продажа (Доп. регламент "Факт")
 GROUP BY a.kod_numobj
;

 UPDATE rr_temp t
 SET (t.n11, -- pw as "генерирующая" (Мощность фактическая по общему профилю ГТП) 
      t.n12  -- pw_set as "сетевая" (Мощность сетевая по общему профилю ГТП)
      ) 
      = ( select pw, pw_set
                         from nr_gtp_cost c
                          inner join hs_gtp g  ON g.XLS_GTP_ID = c.XLS_GTP_ID
                        where pr_plan = 0 and ym = p_ym    
                           AND kod_gtp = t.n10          
                      )
 WHERE t.skod = s_data_id;
END;]]></procedure>
      <queries>
        <query name="72595_data_tco" as="d" />
        <query name="72595_data_obj" as="d2" />
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72601" form="72601" nogrid="1" title="33. Сводная ведомость по реализации" timestamp="03.02.2025 19:21:29" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72601.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="array" name="p_dep">
          <const exclude="1">1172</const>
        </param>
        <param type="number" name="p_ym_beg">
          <const exclude="1">2021.08</const>
        </param>
        <param type="number" name="p_ym_end">
          <const exclude="1">2021.09</const>
        </param>
        <param name="is_dog" type="number">
          <const type="number">0</const>
        </param>
      </params>
      <procedure><![CDATA[begin
  delete vr_number_array;
 insert into vr_number_array (array_id,val) values ('p_dep',:p_dep);
 kg_rep_dog.dog_short;
 sg_rep_dz_kz.dz_kz_per_period_dog (:p_ym_beg, :p_ym_end); 
end;]]></procedure>
      <print-templates>
        <excel>
          <template name="72601.xlsx" print-proc="2" print-xlsx="1" title="Сводная ведомость по реализации" />
        </excel>
      </print-templates>
      <queries>
        <query name="72601_data" as="a">
          <withparams>
            <useparam name="is_dog" />
          </withparams>
        </query>
        <query name="title_info" as="title">
          <withparams>
            <useparam name="p_ym_beg" />
            <useparam name="p_ym_end" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="75778_ryaz_gp" form="72601" nogrid="1" title="1155. Сводная ведомость по реализации" timestamp="21.06.2025 11:38:40" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72601.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="array" name="p_dep">
          <const exclude="1">1172</const>
        </param>
        <param type="number" name="p_ym_beg">
          <const exclude="1">2021.08</const>
        </param>
        <param type="number" name="p_ym_end">
          <const exclude="1">2021.09</const>
        </param>
        <param name="is_dog" type="number">
          <const type="number">0</const>
        </param>
      </params>
      <procedure><![CDATA[begin
  delete vr_number_array;
 insert into vr_number_array (array_id,val) values ('p_dep',:p_dep);
 kg_rep_dog.dog_short;
 sg_rep_dz_kz.dz_kz_per_period_dog (:p_ym_beg, :p_ym_end); 
end;]]></procedure>
      <print-templates>
        <excel>
          <template name="72601.xlsx" print-proc="2" print-xlsx="1" title="Сводная ведомость по реализации" />
        </excel>
      </print-templates>
      <queries>
        <query name="72601_data" as="a">
          <withparams>
            <useparam name="is_dog" />
          </withparams>
        </query>
        <query name="title_info" as="title">
          <withparams>
            <useparam name="p_ym_beg" />
            <useparam name="p_ym_end" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72609" form="72609" title="50. Раскрытие по ТСО до 10 числа" nogrid="1" timestamp="07.02.2025 15:24:49" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72609.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_dep" />
        <param type="number" name="p_ym" />
        <param name="p_kodp_pwrcompany" type="number" />
      </params>
      <print-templates>
        <excel>
          <template name="72609.xlsx" print-proc="2" print-xlsx="1" title="Раскрытие по ТСО до 10 числа" />
        </excel>
      </print-templates>
      <procedure><![CDATA[ DECLARE
   s_data_id     rr_temp.skod%type;
  
 BEGIN
  s_data_id    :='{3d8b60b1-7260-916a-ac16-8c99c9d294fb}';         
  
  DELETE FROM rr_temp WHERE skod = s_data_id;
  INSERT INTO rr_temp (skod, -- kod report
                       n1,   -- kodp для ТСО
                       s1,   -- наименование ТСО
                       n2,   -- номер группы потребителей ( 1 - прочие или 2 - население)      
                       s2,   -- наименование группы потребителей
                       n3,   -- фактический УН
                       s3,   -- наименование фактического УН
                       n4,   -- натуральные показатели мощности: ПО КВтч
                       n5    -- натуральные показатели э/э: ПО КВт
                       ) 
  WITH
  pre_pr as (  -- Услуги по передаче (по состовляющей = 2) по группе потребителей
    SELECT -- nk_adress.kf_get_sf(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as kod_region
           --          , nk_adress.kp_get_region_name(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as kod_region_name
           --          ,
                tco.kodp as tco_pwr_kodp
              , tco.name as tco_pwr_kodp_name
            -- Decode(nvl(a.tarif,0), 0, 0, kg_tarif.f_byt_cached(a.tarif)) as pr_byt    -- категория потребителя (население или прочие: признак быт (0- не население, 1 - население))
              , 1 as gr_num
              , 'Прочие потребители, в т.ч. по уровням напряжения:' as gr_name  
              , COALESCE(HG_CONTROLPOINT_R.get_factVoltage_byNumObj(a.kod_numobj,a.ym), a.voltage) as voltage_fact
              , CASE WHEN s.edizm = 4 THEN COALESCE(b.cust,0) ELSE 0 END as cust_kvth
              , CASE WHEN s.edizm = 3 AND a.vid_t = -272 THEN a.cust ELSE 0 END as cust_kvt
      FROM nr_account a
         LEFT JOIN (select kod_account, max(tip_tarif_sost) as tip_tarif_sost, SUM(cust) as cust
                      from nr_account_sost
                     where tip_tarif_sost = 2 
                     group by kod_account
                    ) b ON a.kod_account = b.kod_account
         INNER JOIN hr_reglament_pp p ON a.kod_reglament=p.kod_reglament
         INNER JOIN hr_calc_variant v ON v.kod_variant=p.kod_variant 
         INNER JOIN sk_nachisl s ON a.vid_t=s.vid_t
         INNER JOIN kr_dogovor d ON a.kod_dog = d.kod_dog
         INNER JOIN kr_dogovor dp ON d.kod_dog_fin = dp.kod_dog
         INNER JOIN ks_vdog vd ON dp.kod_vdog = vd.kod_vdog
         LEFT JOIN kr_numobj kr_n ON a.kod_numobj = kr_n.kod_numobj
         LEFT JOIN kr_object ob ON kr_n.kod_obj = ob.kod_obj
      --   LEFT JOIN kr_payer p ON dp.kodp = p.kodp   -- потребитель
         LEFT JOIN  TABLE (HG_SALEPOINT_R.PL_getSLPOrgs (kod_numobj_   => a.kod_numobj,
                                                             ym_       => a.ym)) pc    ON (a.kod_numobj = pc.kod_numobj)
         LEFT JOIN kr_payer tco ON (pc.kodp_pwrcompany = tco.kodp)
      WHERE 1=1 { AND dp.dep IN :p_dep} 
           { AND tco.kodp IN :p_kodp_pwrcompany }
           { AND a.ym = :p_ym}
           AND v.kod_typevariant = 1 /*покупка*/
           AND (b.tip_tarif_sost = 2  OR a.vid_t = -272 )
           AND a.vid_t <> -222
           AND s.edizm in (3,4)
           AND a.price IS not null
           AND a.rym is null
           AND dp.pr_active in (0,2)
           AND vd.kod_vdoc=1 and vd.kod_tipdog=0
          )
  , pre_byt as ( -- население 
    SELECT -- nk_adress.kf_get_sf(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as kod_region
           -- , nk_adress.kp_get_region_name(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as kod_region_name
           --, 
           tco.kodp as tco_pwr_kodp
           , tco.name as tco_pwr_kodp_name
           , 2 as gr_num 
           , 'Население' as gr_name
           , COALESCE(HG_CONTROLPOINT_R.get_factVoltage_byNumObj(a.kod_numobj,a.ym), a.voltage) as voltage_fact
           , CASE WHEN s.edizm = 4 THEN COALESCE(a.cust,0) ELSE 0 END as cust_kvth
           , CASE WHEN s.edizm = 3 AND a.vid_t = -272 THEN a.cust ELSE 0 END as cust_kvt   -- нужно проработать вопрос с заказчиком и доработать если нужно
       FROM nr_account a
          INNER JOIN hr_reglament_pp p ON a.kod_reglament=p.kod_reglament
          INNER JOIN hr_calc_variant v ON v.kod_variant=p.kod_variant 
          INNER JOIN sk_nachisl s ON a.vid_t=s.vid_t
          INNER JOIN kr_dogovor d ON a.kod_dog = d.kod_dog
          INNER JOIN kr_dogovor dp ON d.kod_dog_fin = dp.kod_dog
          LEFT JOIN kr_numobj kr_n ON a.kod_numobj = kr_n.kod_numobj
          LEFT JOIN kr_object ob ON kr_n.kod_obj = ob.kod_obj
         -- LEFT JOIN kr_payer p ON dp.kodp = p.kodp   -- потребитель
          LEFT JOIN  TABLE (HG_SALEPOINT_R.PL_getSLPOrgs (kod_numobj_   => a.kod_numobj,
                                                              ym_       => a.ym)) pc    ON (a.kod_numobj = pc.kod_numobj)
          LEFT JOIN kr_payer tco ON (pc.kodp_pwrcompany = tco.kodp)
      WHERE 1=1 { AND dp.dep IN :p_dep}       
          { AND tco.kodp IN :p_kodp_pwrcompany }
          { AND a.ym = :p_ym}
          AND v.kod_typevariant = 1 /*покупка*/
          AND s.edizm in (3,4)
          AND a.price IS not null
          AND a.rym is null
          AND dp.pr_active in (0,2)
          AND Decode(nvl(a.tarif,0), 0, 0, kg_tarif.f_byt_cached(a.tarif)) <> 0   -- население определяем по тарифу byt
            )
                 
     SELECT  s_data_id  
           , tco_pwr_kodp as tco_pwr_kodp
           , MAX(tco_pwr_kodp_name) as tco_pwr_name
           , gr_num as gr_num
           , MAX(gr_name) as gr_name              
           , CASE WHEN nvl(voltage_fact,0) in (-1,6,7) THEN 3 ELSE nvl(voltage_fact,0) END as voltage_fact
           , MAX(CASE WHEN nvl(voltage_fact,0) in (-1,6,7) THEN 'ВН' ELSE COALESCE(vol.abbr,'-') END) as voltage_fact_abbr
           , SUM(cust_kvth) as cust_kvth   -- натуральные показатели     
           , SUM(cust_kvt) as cust_kvt   -- натуральные показатели     
        FROM pre_pr -- группа Прочие
          LEFT JOIN hk_voltage vol ON pre_pr.voltage_fact = vol.voltage
        GROUP BY tco_pwr_kodp, gr_num, nvl(voltage_fact,0)
      UNION ALL
        SELECT  s_data_id 
             , tco_pwr_kodp as tco_pwr_kodp
             , MAX(tco_pwr_kodp_name) as tco_pwr_name
             , gr_num as gr_num
             , MAX(gr_name) as gr_name    
             , CASE WHEN nvl(voltage_fact,0) in (-1,6,7) THEN 3 ELSE nvl(voltage_fact,0) END as voltage_fact
             , MAX(CASE WHEN nvl(voltage_fact,0) in (-1,6,7) THEN 'ВН' ELSE COALESCE(vol.abbr,'-') END) as voltage_fact_abbr
             , SUM(cust_kvth) as cust_kvth   -- натуральные показатели     
             , SUM(cust_kvt) as cust_kvt   -- натуральные показатели      
        FROM pre_byt  -- население
          LEFT JOIN hk_voltage vol ON pre_byt.voltage_fact = vol.voltage
        GROUP BY  tco_pwr_kodp, gr_num, nvl(voltage_fact,0)
        ;
  END;]]></procedure>
      <queries>
        <query name="72609_data" as="d" title="Основной запрос для отчета № 50" />
        <query name="title_info" as="title">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72852" form="72852" nogrid="1" title="35, 36. Справка о начислении, оплате и задолженности" timestamp="20.12.2024 16:41:05" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72852.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param type="number" name="p_ym" title="Период" />
        <param name="is_dog" type="number">
          <const type="number">0</const>
        </param>
      </params>
      <print-templates>
        <excel>
          <template name="72852.xlsx" del-cols="1" print-proc="2" print-xlsx="1" title="Справка о начислении, оплате и задолженности" />
        </excel>
      </print-templates>
      <procedure><![CDATA[
begin
    
   
   delete vr_number_array;
  
 INSERT INTO vr_number_array (array_id,val) values ('p_dep', :p_dep);

       
kg_rep_dog.dog_gr_customer;
    
sg_rep_dz_kz.dz_kz_per_period_dog(:p_ym,:p_ym);

end;]]></procedure>
      <queries>
        <query name="72852_data" as="a">
          <withparams>
            <useparam name="is_dog" />
          </withparams>
        </query>
        <query name="title_info" as="title">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72943" form="72943" title="31. Полезный отпуск по ценам НЭСК" nogrid="1" timestamp="15.12.2024 12:39:43" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72943.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param type="number" name="p_ym_beg" />
        <param type="number" name="p_ym_end" />
      </params>
      <print-templates>
        <excel>
          <template name="72943.xlsx" print-xlsx="1" title="Полезный отпуск по ценам НЭСК" />
        </excel>
      </print-templates>
      <procedure><![CDATA[
BEGIN
 delete vr_number_array;
 INSERT INTO vr_number_array (array_id,val)  
   SELECT 'p_dep', kodp FROM kr_org  WHERE 1=0 {OR kodp in :p_dep};

 
INSERT INTO vr_number_array (array_id,val)  VALUES('p_kod_tipdog',0); 
-- заполняем  врем. таблицу данными по полезному отпуску по факту
   ng_rep_other.po_per_region_sost(:p_ym_beg, :p_ym_end, 1, 0);
 
 -- по корректировкам
   ng_rep_other.po_per_region_sost(:p_ym_beg, :p_ym_end, 0, 1);
 -- по перерасчетам
   ng_rep_other.po_per_region_sost(:p_ym_beg, :p_ym_end, 0, 2);
END;]]></procedure>
      <queries>
        <query name="72943_data" as="a" />
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym_beg" />
            <useparam name="p_ym_end" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="72956" form="72956" title="32. Полезный отпуск электрической энергии НЭСК" nogrid="1" timestamp="10.12.2024 18:59:51" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72956.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_dep" />
        <param type="number" name="p_ym_beg" />
        <param type="number" name="p_ym_end" />
      </params>
      <print-templates>
        <excel>
          <template name="72956.xlsx" del-cols="1" print-proc="2" print-xlsx="1" title="Полезный отпуск электрической энергии НЭСК" />
        </excel>
      </print-templates>
      <procedure><![CDATA[DECLARE 
 period_beg NUMBER;
 period_end NUMBER;
 period NUMBER;

BEGIN
 -- заполняем таблицу списком периодов для pivot
 
 period_beg:= :p_ym_beg;
 period_end:= kg.ym_add(:p_ym_end,1);
 period := period_beg;

 IF period_beg > period_end 
 THEN
   insert into vr_number_array(array_id, val)
       VALUES('p_ym', 1010.01); 
ELSE

 delete vr_number_array;
  
  WHILE period < period_end
  LOOP
       insert into vr_number_array(array_id, val)
       VALUES('p_ym', period);
       period:= kg.ym_add(period,1);
  END LOOP;
 END IF;

  ng_rep_other.po_per_region(:p_ym_beg, :p_ym_end);

END;]]></procedure>
      <queries>
        <query name="72956_data" as="a" />
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym_beg" />
            <useparam name="p_ym_end" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="74287" nogrid="1" title="16. Структура потребления электрической энергии" form="74287" timestamp="26.01.2025 21:21:01" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74287.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
        <param name="p_kod_m_srf" type="array" />
      </params>
      <print-templates>
        <excel>
          <template name="74287.xlsx" title="Структура полезного отпуска" print-xlsx="1" />
        </excel>
      </print-templates>
      <procedure><![CDATA[ DECLARE
         s_data_id     rr_temp.skod%type;
 BEGIN 
  s_data_id    := 'D250859F-7428-7FAE-9EB6-78FD1AA8728F';
-- подготавливаем данные по полезному отпуску
  delete vr_number_array;
  INSERT INTO vr_number_array (array_id,val) values ('p_dep', :p_dep);
  INSERT INTO vr_number_array (array_id,val)  
       SELECT 'p_kod_adr_m', kod_m  FROM adr_m  WHERE 1=0 {OR kod_m in :p_kod_m_srf};
  -- заполняем rr_rep_po данными по полезному отпуску
  ng_rep_other.po_per_region_add_regl(:p_ym, :p_ym,  1,  1); 
  
  DELETE FROM rr_temp WHERE skod = s_data_id;
  INSERT INTO rr_temp (skod, n4 -- id
                       , n1  -- gr - группа
                       , n2  -- subgr - подгруппа
                       , s1  -- okved_name
                       , s2  -- okved_name
                       , s3  -- kod_okved_str
                       , n3  -- cust (кВтч)
                      )
      SELECT s_data_id, r.id as n4,
             r.gr, r.subgr, max(r.okved_name) as okved_name, max(r.kod_okved_str) as kod_okved_str, max(r.kod_str) as kod_str, 
             SUM(CASE WHEN pr_byt = 0 AND po.pr_opt = 1 AND po.edizm = 4 THEN po.cust ELSE 0 END) as cust_kvth
      FROM (-- справочник ОКВЭД-ов для отчета № 16
               select 1 as id, 1 as gr, null as subgr, 'Сельское хозяйство, лесное хозяйство, охота, рыболовство и рыбоводство' as okved_name, 'Раздел А  01, 02, 03' as kod_okved_str, '10100' as kod_str FROM dual
     UNION ALL select null,  1, null, 'в том числе:', null, null  FROM dual
     UNION ALL select 2,     1, 1,    'Рыболовство и рыбоводство', '03', '10150'  FROM dual
     UNION ALL SELECT 3,     2, null, 'Добыча полезных ископаемых', 'Раздел В  05 - 09', '10200' FROM dual
     UNION ALL select null,  2, null, '   в том числе потребители с потреблением электроэнергии 120 млн кВт·ч в год и выше:', null, null  FROM dual
     UNION ALL SELECT 4,     3, null, 'Обрабатывающие производства', 'Раздел С  10 - 33 ', '10300' FROM dual
     UNION ALL select null,  3, null, 'в том числе:', null, null  FROM dual
     UNION ALL SELECT 5,     3, 1,    'Обработка древесины и производство изделий из дерева и пробки, кроме мебели, производство изделий из соломки и материалов для плетения', '16', ' - ' FROM dual
     UNION ALL SELECT 6,     3, 2,    'Производство бумаги и бумажных изделий', '17' , '103001' FROM dual
     UNION ALL select null,  3, 2,    '   в том числе потребители с потреблением электроэнергии 120 млн кВт·ч в год и выше:', null, null  FROM dual    
     UNION ALL SELECT 7,     3, 3,    'Производство кокса и нефтепродуктов', '19' , '10302' FROM dual
     UNION ALL select null,  3, 3,    '    в том числе потребители с потреблением электроэнергии 120 млн кВт·ч в год и выше:', null, null  FROM dual
     UNION ALL SELECT 8,     3, 4,    'Производство химических веществ и химических продуктов', '20' , '10303' FROM dual
     UNION ALL select null,  3, 4,    '    в том числе потребители с потреблением электроэнергии 120 млн кВт·ч в год и выше:', null, null  FROM dual
     UNION ALL SELECT 9,     3, 5,    'Производство металлургическое', '24' , '10304' FROM dual
     UNION ALL select null,  3, 5,    '    в том числе потребители с потреблением электроэнергии 120 млн кВт·ч в год и выше:', null, null  FROM dual
     UNION ALL SELECT 10,    3, 6,    'Производство компьютеров, электронных и оптических изделий', '26' , '-' FROM dual
     UNION ALL SELECT 11,    3, 7,    'Производство электрического оборудования', '27' , '-' FROM dual
     UNION ALL select null,  3, 7,    '    в том числе потребители с потреблением электроэнергии 120 млн кВт·ч в год и выше:', null, null  FROM dual
     UNION ALL SELECT 12,    3, 8,    'Производство машин и оборудования, не включенных в другие группировки', '28', '10307' FROM dual
     UNION ALL select null,  3, 8,    '    в том числе потребители с потреблением электроэнергии 120 млн кВт·ч в год и выше:', null, null  FROM dual
     UNION ALL SELECT 13,    3, 9,    'Производство автотранспортных средств, прицепов и полуприцепов', '29' , '10308' FROM dual
     UNION ALL SELECT 14,    3, 10,   'Производство прочих транспортных средств и оборудования', '30' , '-' FROM dual
     UNION ALL select null,  3, 10,   '    в том числе потребители с потреблением электроэнергии 120 млн кВт·ч в год и выше:', null, null  FROM dual
     UNION ALL SELECT 15,    4, null, 'Обеспечение электрической энергией, газом и паром, кондиционирование воздуха', 'Раздел D  35', '10400' FROM dual
     UNION ALL SELECT 16,    5, null, 'Водоснабжение; водоотведение, организация сбора и утилизации отходов, деятельность по ликвидации загрязнений', 'Раздел E  36 – 39 ' , '10440' FROM dual
     UNION ALL SELECT 17,    6, null, 'Строительство', 'Раздел F  41 - 43', '10500' FROM dual
     UNION ALL select null,  6, null, '   в том числе потребители с потреблением электроэнергии 120 млн кВт·ч в год и выше:', null, null  FROM dual  
     UNION ALL SELECT 18,    7, null, 'Транспортировка и хранение', 'Раздел H  49 – 53' , '10610' FROM dual
     UNION ALL SELECT 19,    8, null, 'Деятельность в области информации и связи', 'Раздел J  58 - 63 ' , '10620' FROM dual
     UNION ALL select null,  8, null, 'в том числе:', null, null  FROM dual
     UNION ALL SELECT 20,    8, 1,    'Деятельность железнодорожного транспорта', '49.1, 49.2, 49.31.1' , '10601' FROM dual
     UNION ALL select null,  8, 1,    '    в том числе потребители с потреблением электроэнергии 120 млн кВт·ч в год и выше:', null, null  FROM dual
     UNION ALL SELECT 21,    8, 2,    'Деятельность городского электрического транспорта', '49.31.22, 49.31.23, 49.31.24, 49.31.25', '10602' FROM dual
     UNION ALL select null,  8, 2,    '    в том числе потребители с потреблением электроэнергии 120 млн кВт·ч в год и выше:', null, null  FROM dual
     UNION ALL SELECT 22,    8, 3,    'Деятельность трубопроводного транспорта', '49.5' , '10604' FROM dual
     UNION ALL select null,  8, 3, '    в том числе потребители с потреблением электроэнергии 120 млн кВт·ч в год и выше:', null, null  FROM dual
     UNION ALL SELECT 23, 9,  null, 'Торговля оптовая и розничная; ремонт автотранспортных средств и мотоциклов', 'Раздел G  45, 46, 47', '10510' FROM dual
     UNION ALL SELECT 24, 10, null, 'Прочие виды экономической деятельности, не вошедшие в вышеперечисленные группировки', '-', '10700' from dual
  --   UNION ALL SELECT 25, 11, null, 'Население и приравненные к нему группы потребителей', '-', '10800' from dual
            ) r
     LEFT JOIN ( -- связь строк из ref_rep (справочка для отчета) с ОКВЭД-ами из общего справочника
              SELECT  1 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_1 = 1847   -- Раздел А  
    UNION ALL SELECT  2 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_2 = 2018   -- 03
    UNION ALL SELECT  3 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_1 = 1848   -- Раздел В
    UNION ALL SELECT  4 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_1 = 1849   -- Раздел С
    UNION ALL SELECT  5 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_2 = 2902   -- 16
    UNION ALL SELECT  6 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_2 = 2935   -- 17
    UNION ALL SELECT  7 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_2 = 2958   -- 19
    UNION ALL SELECT  8 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_2 = 2974   -- 20
    UNION ALL SELECT  9 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_2 = 2446   -- 24
    UNION ALL SELECT 10 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_2 = 2707   -- 26
    UNION ALL SELECT 11 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_2 = 2786   -- 27
    UNION ALL SELECT 12 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_2 = 2491   -- 28
    UNION ALL SELECT 13 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_2 = 2628   -- 29
    UNION ALL SELECT 14 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_2 = 3081   -- 30
    UNION ALL SELECT 15 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_1 = 1850   -- Раздел D
    UNION ALL SELECT 16 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_1 = 1851   -- Раздел E
    UNION ALL SELECT 17 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_1 = 1852   -- Раздел F
    UNION ALL SELECT 18 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_1 = 1854   -- Раздел H
    UNION ALL SELECT 19 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_1 = 1856   -- Раздел J
    UNION ALL SELECT 20 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_3 in (3845, 3851)   -- 49.1, 49.2
    UNION ALL SELECT 20 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_5 = 3857   -- 49.31.1
    UNION ALL SELECT 21 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_6 in (3862, 3863, 3864, 3862) -- 49.31.22, 49.31.23, 49.31.24, 49.31.25
    UNION ALL SELECT 22 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_3 = 3886 -- 49.5
    UNION ALL SELECT 23 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE kod_okved_level_1 = 1853   -- Раздел G
    UNION ALL SELECT 24 as id , kod_okved as kod_okved  FROM kv_okved_level  WHERE okved_level_2 in (55, 56)  or okved_level_2 > 63    -- 
  --  UNION ALL SELECT 25 as id , 990800 as kod_okved  FROM dual   -- население
          ) rr  ON r.id = rr.id
     LEFT JOIN  rr_rep_po po ON rr.kod_okved = po.kod_okved
  GROUP BY r.id, r.gr, r.subgr
  UNION ALL  SELECT s_data_id, 25 as id,
            11 as gr, null as subgr, 'Население и приравненные к нему группы потребителей' as okved_name, '-' as kod_okved_str, '10800' as kod_str,
            SUM(CASE WHEN po.pr_byt = 1 AND po.pr_opt = 1 AND po.edizm = 4 THEN po.cust ELSE 0 END) as cust_kvth
      FROM rr_rep_po po;
 END;
]]></procedure>
      <queries>
        <query name="74287_data_gr" as="a">
          <query name="74287_data_sub_gr" as="b">
            <call function="=">
              <column table="a" column="gr" />
              <column table="b" column="gr" />
            </call>
            <query name="74287_data_sub_gr_add" as="d">
              <call function="and">
                <call function="=">
                  <column table="b" column="gr" />
                  <column table="d" column="gr" />
                </call>
                <call function="=">
                  <column table="b" column="sub_gr" />
                  <column table="d" column="sub_gr" />
                </call>
              </call>
            </query>
          </query>
          <query name="74287_data_gr_add" as="c">
            <call function="=">
              <column table="a" column="gr" />
              <column table="c" column="gr" />
            </call>
          </query>
        </query>
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
            <useparam name="p_kod_m_srf" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="74491" form="74491" title="51. Раскрытие информации по НЦЗ для ОИТО" nogrid="1" timestamp="14.02.2025 12:29:05" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
        <param name="p_kod_m_srf" type="number" />
        <param name="p_kod_gtp" type="number" />
      </params>
      <print-templates>
        <excel>
          <template name="74491.xlsx" print-proc="2" print-xlsx="1" title="Раскрытие информации по НЦЗ для ОИТО" />
        </excel>
      </print-templates>
      <procedure><![CDATA[BEGIN 
 delete vr_number_array;
 INSERT INTO vr_number_array (array_id,val) values('p_dep', :p_dep);
 INSERT INTO vr_number_array (array_id,val) values('p_kod_adr_m', :p_kod_m_srf);
 kg_rep_dog.dog_obj_short;
END;]]></procedure>
      <queries>
        <query name="74491_dif_price_per_hour" as="a">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym" />
            <useparam name="p_kod_m_srf" />
            <useparam name="p_kod_gtp" />
          </withparams>
        </query>
        <query name="74491_rate_service_kvt" as="b">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_kod_m_srf" />
          </withparams>
        </query>
        <query name="74491_ext_price_per_hour" as="ext">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="p_ym" />
            <useparam name="p_kod_m_srf" />
            <useparam name="p_kod_gtp" />
          </withparams>
        </query>
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
            <useparam name="p_kod_m_srf" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="74610" form="74610" title="21. Отчет для Рязаньэнерго (ПО)" nogrid="1" timestamp="08.04.2025 11:16:30" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74610.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_dep" />
        <param type="number" name="p_ym" />
      </params>
      <print-templates>
        <excel>
          <template name="74610.xlsx" print-proc="2" print-xlsx="1" title="Отчет для Рязаньэнерго (ПО)" />
        </excel>
      </print-templates>
      <procedure><![CDATA[---- отчет № 21
DECLARE
  s_data_pr_id rr_temp.skod%type;
	s_data_byt_id rr_temp.skod%type; 
BEGIN
  s_data_pr_id    :='3d8b60b1-74610-gr_pr-8c99c9d294fb';  
  s_data_byt_id   :='3d8b60b1-74610-gr_byt-8c99c9d294fb';  
  DELETE FROM rr_temp WHERE skod in (s_data_pr_id, s_data_byt_id);
 
INSERT INTO rr_temp (skod, 
					  n1,   -- номер группы
					  s1,   -- наименование группы
            s2,   -- наименование потребителей
					  n2,   -- фактический УН (код)
					  s3,   -- фактический УН (наименование)
					  n3,   -- номер для сортировки УН
					  n4,   -- edizm
					  s4,   -- edizm_name
					  n5,    -- полезный отпуск  cust
					  n6    -- cust кВтч
					)
 -- Услуги по передаче (по составляющей = 2) по группе потребителей прочие
 select  s_data_pr_id
        , gr_num     -- номер группы (1- одноставочные, 2 - двухставочные)
		, max(CASE WHEN gr_num = 1 THEN 'Одноставочный тариф на услуги по передаче' ELSE 'Двухставочный тариф на услуги по передаче' END) as gr_name
        , stragg_dist(payer_name) as payer_name   -- наименование потребителей
        , voltage_fact
        , max(v.abbr) as voltage_fact_name
        , max(v.kod_sort) as volt_kod_sort
        , a.edizm
	    	, max(e.name) as edizm_name
        , sum(COALESCE(a.cust,0)) as cust
	    	, sum(COALESCE(CASE WHEN a.edizm = 4 THEN a.cust ELSE 0 END,0)) as cust_in_gr          -- ПО кВтч
 from (
    SELECT   CASE WHEN kg_tarif.is_2rate(kg_tarif.subtarif_voltage(b.tarif, a.voltage, a.dat_priem - 1E-5), a.dat_priem - 1E-5) = 1 THEN 2 ELSE 1 END gr_num
           , p.name as payer_name
           , COALESCE(HG_CONTROLPOINT_R.get_factVoltage_byNumObj(a.kod_numobj,a.ym), a.voltage) as voltage_fact   
           , a.voltage             
           , s.edizm
           , COALESCE(b.cust,0) as cust
      FROM nr_account a
         LEFT JOIN (select kod_account, max(tip_tarif_sost) as tip_tarif_sost
                         , max(tarif) as tarif                       
                         , SUM(cust) as cust
                     from nr_account_sost
                    where tip_tarif_sost = 2 
                    group by kod_account
                    ) b ON a.kod_account = b.kod_account
         INNER JOIN hr_reglament_pp p ON a.kod_reglament=p.kod_reglament
         INNER JOIN hr_calc_variant v ON v.kod_variant=p.kod_variant 
         INNER JOIN sk_nachisl s ON a.vid_t=s.vid_t
         INNER JOIN kr_dogovor d ON a.kod_dog = d.kod_dog
         INNER JOIN kr_dogovor dp ON d.kod_dog_fin = dp.kod_dog
         INNER JOIN ks_vdog vd ON dp.kod_vdog = vd.kod_vdog
         LEFT JOIN kr_numobj kr_n ON a.kod_numobj = kr_n.kod_numobj
         LEFT JOIN kr_object ob ON kr_n.kod_obj = ob.kod_obj
         LEFT JOIN kr_payer p ON dp.kodp = p.kodp   -- потребитель
         LEFT JOIN  TABLE (HG_SALEPOINT_R.PL_getSLPOrgs (kod_numobj_   => a.kod_numobj,
                                                             ym_       => a.ym)) pc    ON (a.kod_numobj = pc.kod_numobj)
         LEFT JOIN kr_payer tco ON (pc.kodp_pwrcompany = tco.kodp)
      WHERE 1=1  { AND dp.dep IN :p_dep}               
           { AND a.ym = :p_ym}
        and tco.kodp = 27348  -- отчет только по Рязанской ТСО
           AND v.kod_typevariant = 1 -- покупка
           AND (b.tip_tarif_sost = 2  )  -- составляющая по услуге по передаче        
           AND s.edizm in (3,4)
           AND a.price IS not null
           AND a.rym is null
           AND ((dp.pr_active in (0,2) AND dp.dat_fin IS NULL) OR  kg.kf_ym(dp.dat_fin) >= :p_ym)
           AND vd.kod_vdoc=1 and vd.kod_tipdog=0
           ) a
          INNER JOIN hk_voltage v ON a.voltage_fact = v.voltage
		  INNER JOIN sk_edizm e ON a.edizm = e.edizm
  GROUP BY gr_num, voltage_fact, a.edizm ;  
  
  -- для населения отдельный запрос для данного отчета. Пока что достаем одну цифру. Алгоритма анализа групп диапазонов пока нет.
  INSERT INTO rr_temp (skod, 	
					    n1,   -- номер группы  
					  --  n4,   -- edizm
					  --  s4,   -- edizm_name
					    n5    -- полезный отпуск  cust
					)
    SELECT   s_data_byt_id              
	        , 3 as gr_num   -- номер группы
         --  , s.edizm
		     --  , e.name as edizm_name
           , SUM(COALESCE(a.cust,0)) as cust
       FROM nr_account a
          INNER JOIN hr_reglament_pp p ON a.kod_reglament=p.kod_reglament
          INNER JOIN hr_calc_variant v ON v.kod_variant=p.kod_variant 
          INNER JOIN sk_nachisl s ON a.vid_t=s.vid_t
          INNER JOIN kr_dogovor d ON a.kod_dog = d.kod_dog
          INNER JOIN kr_dogovor dp ON d.kod_dog_fin = dp.kod_dog
          LEFT JOIN kr_numobj kr_n ON a.kod_numobj = kr_n.kod_numobj
          LEFT JOIN kr_object ob ON kr_n.kod_obj = ob.kod_obj
          LEFT JOIN kr_payer p ON dp.kodp = p.kodp   -- потребитель
          LEFT JOIN  TABLE (HG_SALEPOINT_R.PL_getSLPOrgs (kod_numobj_   => a.kod_numobj,
                                                              ym_       => a.ym)) pc    ON (a.kod_numobj = pc.kod_numobj)
          LEFT JOIN kr_payer tco ON (pc.kodp_pwrcompany = tco.kodp)
		  INNER JOIN sk_edizm e ON s.edizm = e.edizm
      WHERE 1=1   { AND dp.dep IN :p_dep}               
         { AND a.ym = :p_ym}
         and tco.kodp = 27348  -- отчет только по Рязанской ТСО
          AND v.kod_typevariant = 1 /*покупка*/
          AND s.edizm = 4  -- in (3,4)
          AND a.price IS not null
          AND a.rym is null
          AND ((dp.pr_active in (0,2) AND dp.dat_fin IS NULL) OR  kg.kf_ym(dp.dat_fin) >= :p_ym)
          AND Decode(nvl(a.tarif,0), 0, 0, kg_tarif.f_byt_cached(a.tarif)) <> 0
	 ;   -- население определяем по тарифу byt
END;
 ]]></procedure>
      <queries>
        <query name="74610_query_gr_pr" as="d" />
        <query name="74610_query_gr_byt" as="d2" />
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="75041" form="75041" title="1067. Количество точек поставки (v2.0)" nogrid="1" timestamp="25.05.2025 19:11:51" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75041.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_dep" />
        <param type="date" name="p_date" />
        <param name="p_gr_cust" type="array" />
        <param name="p_dog" type="array" />
        <param name="p_tco" type="array" />
      </params>
      <print-templates>
        <excel>
          <template name="75041.xlsx" print-proc="2" print-xlsx="1" title="Количество точек поставки" />
        </excel>
      </print-templates>
      <procedure><![CDATA[-- Отчет № 1067. SD: 75041. Рязань. ГП.
DECLARE
   s_data_id  rr_temp.skod%type;
   cnt_dep      number;  -- кол-во выбранных отделений
   cnt_gr_cust  number;  -- кол-во выбранных гр. потребителей эл.энергии 
   cnt_dog      number;  -- кол-во выбранных договоров 
   cnt_tco      number;  -- кол-во выбранных ТСО
   p_date 	    date;
BEGIN
  s_data_id    :='3d8b60b1-75041-ac16-8c99c9d294fb';  
 
  p_date := :p_date;  
  delete vr_number_array;
  INSERT INTO vr_number_array (array_id,val) SELECT 'p_dep', kodp  FROM kr_org  WHERE kodp=:p_dep;  
  INSERT INTO vr_number_array (array_id,val) SELECT 'p_gr_cust', kod_group_cust FROM ks_group_cust WHERE 1=0 { OR kod_group_cust in :p_gr_cust};   
  INSERT INTO vr_number_array (array_id,val) SELECT 'p_dog', kod_dog FROM kr_dogovor WHERE 1=0 { OR kod_dog in :p_dog};   
  INSERT INTO vr_number_array (array_id,val) SELECT 'p_tco', kodp FROM kr_payer WHERE 1=0 { OR kodp in :p_tco};   
  cnt_dep := ng_rep_common.get_count_value_param('p_dep');
  cnt_gr_cust := ng_rep_common.get_count_value_param('p_gr_cust');
  cnt_dog := ng_rep_common.get_count_value_param('p_dog');
  cnt_tco := ng_rep_common.get_count_value_param('p_tco');
 	
  DELETE FROM rr_temp WHERE skod = s_data_id;
 
  INSERT INTO rr_temp (skod, n9,
                      n1,   -- gr_num_obj  - номер группы потребителя (на объекте. hs_23)
                      s1,   -- gr_name_obj - наименование группы потребителя на объекте
                      n2,   -- sub_gr_num  - номер подгруппы в отчете (1 или 2)
				s2,   -- sub_gr_name - наименование подгруппы потребителя в отчете (Для группы 1: 1- ИКУ, 2 - Иные потребители, приравненные к населению
							-- для группы 2: 1- 'менее 670 кВт'   2 - '670 кВт и выше'	)
        n3,   -- kod_dog
	      s3,   -- ndog - номер договора
	      s4,   -- payer_name    - наименование потребителя
	      s5,   -- gr_cust_name  - категория потребителя (номер и наименование гр.потребителя на договоре из спр-ка ks_group_cust)
	      n4,   -- kod_numobj
	      n5,   -- n.num_obj - номер объекта (для сортировки)
	      s6,   -- obj_name  	   - номер и наименование объекта  
	      s7,   -- obj_adr_name  - адрес объекта
        d1,   -- obj_date_beg  - дата постановки на учет объекта                    
        n6,   -- max_power 	   - максимальная мощность на объекте (кВт)
        n7,   -- slpnt_cnt	   - кол-во ТП (точек поставки)
	      n8    -- pnt_cnt 	   - кол-во ТН (точек учета)			
      )
 WITH
   slpnt  AS (/*Точки поставки Активных, Новых объектов на заданную дату (sysdate) плюс max мощность, гр.потребителей на объекте*/
           SELECT h.kod_numobj                
                , MAX(COALESCE(HG_DOGR.get_PMAX_NUMOBJ(n.kod_numobj, 2, p_date, 0,null),0)) as max_power
                , MAX(CASE WHEN COALESCE(n.kod_f23,0) = 38 THEN 1 ELSE 2 END) as gr_num_obj  -- номер группы на объекте
                , MAX(CASE WHEN COALESCE(n.kod_f23,0) = 38 THEN 'Население и приравненные к нему категории потребителей' ELSE 'Прочие потребители' END) as gr_name_obj
                , COUNT(COALESCE(KOD_PMAX_DETAIL,0)) as slpnt_cnt				
            FROM kr_dogovor d
               INNER JOIN kr_numobj n ON d.kod_dog = n.kod_dog
               LEFT JOIN hr_pmax_history h   ON n.kod_numobj = h.kod_numobj AND  p_date /*to_date('23.03.2022','DD.MM.YYYY')*/ BETWEEN h.dat_s  AND COALESCE (h.dat_po, SYSDATE + 5000)    
               LEFT JOIN hr_pmax_detail hd   ON h.kod_pmax_history = hd.kod_pmax_history
			         LEFT JOIN hr_attpoint a ON (hd.kod_attpoint = a.kod_attpoint AND  hd.kodnagruzpotreb = a.kodnagruzpotreb)
			         LEFT JOIN kr_payer net ON a.kodp_net = net.kodp
              -- LEFT JOIN hs_23 ON n.kod_f23 = hs_23.kod_f23
           WHERE   (cnt_dep = 0 OR d.dep IN (SELECT val  FROM  vr_number_array  WHERE array_id = 'p_dep'))   
			        AND (cnt_dog = 0 OR d.kod_dog IN (SELECT val  FROM  vr_number_array  WHERE array_id = 'p_dog'))   
			        AND (cnt_tco = 0 OR net.kodp IN (SELECT val  FROM  vr_number_array  WHERE array_id = 'p_tco'))   			   
           GROUP BY h.kod_numobj
          )
  , pnt  AS (  /*Точки учета Активных, Новых объектов на заданную дату (sysdate)*/
            SELECT kod_numobj, COUNT(KOD_POINT) pnt_cnt
              FROM hv_point p
             WHERE  p_date /*to_date('23.03.2022','DD.MM.YYYY') */ BETWEEN p.dat_s  AND COALESCE (p.dat_po,  SYSDATE + 5000) 
				AND (cnt_dep = 0 OR p.dep IN (SELECT val  FROM  vr_number_array  WHERE array_id = 'p_dep'))
            GROUP BY kod_numobj
          )
   , pre AS (SELECT s_data_id
      , gr_num_obj
      , gr_name_obj
      , CASE WHEN slpnt.gr_num_obj = 1 
             THEN (CASE WHEN gc.num_gr in ('2.0', '2.3', '4.0', '4.2') THEN 1 ELSE 2 END)   -- gc.num_gr -  гр. потребителей на договоре для группировки
             ELSE (CASE WHEN slpnt.max_power < 670 THEN 1 ELSE 2 END)
             END as sub_gr_num
      , CASE WHEN slpnt.gr_num_obj = 1 
             THEN (CASE WHEN gc.num_gr in ('2.0', '2.3', '4.0', '4.2') THEN 'Исполнители коммунальных услуг' ELSE 'Иные потребители, приравненные к населению' END) 
             ELSE (CASE WHEN slpnt.max_power < 670 THEN 'менее 670 кВт' ELSE '670 кВт и выше' END)
             END as sub_gr_name            
      , d.kod_dog
      , d.ndog 
      , p.name as payer_name
      , gc.num_gr || ' - ' || gc.name as gr_cust_name  -- категория потребителя (номер и наименование гр.потребителя на договоре из спр-ка ks_group_cust)
      , n.kod_numobj
      , n.num_obj
      ,  '(' || d.ndog || '.' || to_char(n.num_obj,'000') ||') ' || n.name as obj_name 
      , substr(nk_adress.kf_address(2,ob.kodd),26,250) as obj_adr_name   -- адрес должен быть без области и города
      , n.dat_create as obj_date_beg     
      , slpnt.max_power
      , COALESCE(slpnt_cnt, 0) as slpnt_cnt
      , COALESCE(pnt_cnt,0) as pnt_cnt
 FROM kr_dogovor d
   INNER JOIN kr_dogovor_dop dd ON d.kod_dog = dd.kod_dog
  -- INNER JOIN kv_group_cust_level gcc ON dd.kod_group_cust = gcc.kod_group_cust
   LEFT JOIN ks_group_cust gc ON dd.kod_group_cust = gc.kod_group_cust
   INNER JOIN kr_numobj n ON d.kod_dog = n.kod_dog
   LEFT JOIN kr_object ob ON n.kod_obj = ob.kod_obj
   LEFT JOIN kr_payer p ON d.kodp = p.kodp
   LEFT JOIN slpnt ON n.kod_numobj = slpnt.kod_numobj
   LEFT JOIN pnt ON n.kod_numobj = pnt.kod_numobj
   
  WHERE  p_date /*to_date('23.03.2022','DD.MM.YYYY')*/ BETWEEN COALESCE(n.dat_postav_obj, n.dat_create) AND COALESCE(n.dat_fin, SYSDATE + 5000)
      AND (cnt_dep = 0 OR d.dep IN (SELECT val FROM vr_number_array WHERE array_id = 'p_dep'))
	    AND (cnt_gr_cust = 0 OR dd.kod_group_cust IN (SELECT val FROM vr_number_array WHERE array_id = 'p_gr_cust'))
      AND (cnt_dog = 0 OR d.kod_dog IN (SELECT val  FROM  vr_number_array  WHERE array_id = 'p_dog'))  
      )
  
  SELECT s_data_id
      , ROW_NUMBER() OVER (ORDER BY gr_num_obj NULLS LAST, sub_gr_num, (lpad(ndog, 10 , '0')), num_obj) as n9
      , gr_num_obj
      , gr_name_obj
      , sub_gr_num
      , sub_gr_name            
      , kod_dog
      , ndog 
      , payer_name
      , gr_cust_name  -- категория потребителя (номер и наименование гр.потребителя на договоре из спр-ка ks_group_cust)
      , kod_numobj
      , num_obj
      , obj_name 
      , obj_adr_name   -- адрес должен быть без области и города
      , obj_date_beg     
      , max_power
      , slpnt_cnt
      , pnt_cnt  
   FROM pre
;
END;
]]></procedure>
      <queries>
        <query name="75041_data" as="d" />
        <query name="title_info" as="t">
          <withparams>
            <const>NULL</const>
            <const>NULL</const>
            <useparam name="p_dep" />
            <const>NULL</const>
            <const>NULL</const>
            <useparam name="p_date" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="75061" form="75061" title="1102. Информация о задолженности коммунальных организаций (v.1.1)" nogrid="1" timestamp="04.05.2025 11:18:27" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75061.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_dep" />
        <param type="date" name="p_date" />
        <param name="p_gr" type="array" />
        <param name="p_sum" type="number" />
        <param type="number" name="p_is_flag">
          <const type="number">0</const>
        </param>
      </params>
      <print-templates>
        <excel>
          <template name="75061.xlsx" print-proc="2" print-xlsx="1" title="Информация о задолженности коммунальных организаций" />
        </excel>
      </print-templates>
      <procedure><![CDATA[ DECLARE
    s_data_id rr_temp.skod%type;
    p_date DATE;	
   -- p_gr_sel NUMBER;  -- признак выбора групп потребителя
BEGIN
  s_data_id    :='3d8b60b1-75061-ac16-8c99c9d294fb';  
  p_date := :p_date + 1;    -- Отчет собирается на дату (включительно!).
   
  delete vr_number_array;
  INSERT INTO vr_number_array (array_id,val) SELECT 'p_dep', kodp  FROM kr_org  WHERE kodp=:p_dep;   
  INSERT INTO vr_number_array (array_id,val) SELECT 'p_gr_kod_level_1', kod_group_cust  FROM ks_group_cust  WHERE  1=0 { OR kod_group_cust in :p_gr};  
 
/*  Select count (1)             -- проверяем были ли выбраны группы потребителей
        Into p_gr_sel
        From vr_number_array
       Where array_id = 'p_gr_kod_level_1' And val != 0;
 
 if p_gr_sel = 0 then  -- если не выбраны, то собираем по группе 2 и 4
 begin
   INSERT INTO vr_number_array (array_id,val) VALUES('p_gr_kod_level_1', 100002);
   INSERT INTO vr_number_array (array_id,val) VALUES('p_gr_kod_level_1', 100004);
 end;
 */
  kg_rep_dog.dog_gr_customer;   -- достаем только нужные договоры с учетом отделения и группы потребителя
  
  DELETE FROM rr_temp WHERE skod = s_data_id;
  INSERT INTO rr_temp (skod, 
                      n1,   -- kod_dog
                      s1,   -- номер договора
                      s2,   -- наименование потребителя
                      s3,   -- полный юр. адрес абонента потребителя
                      d1,   -- минимальная дата задолженности по основной реализации                     
                      n3,   -- сумма задолженности по основной реализации
                      n4    -- сумма задолженности по авансам                       
                    )
 SELECT s_data_id
       , d.kod_dog
       , d.ndog
       , d.payer_name
       , substr(nk_adress.kf_address(1,p.kod_d_ur),0,250) -- полный юр. адрес абонента
       , f.dat_bzad
       , f.dolg_osn        
       , f.dolg_av     
   FROM rr_rep_dog d
    inner join kr_payer p ON d.payer_id = p.kodp 
    INNER JOIN TABLE(SG_REP_DZ_KZ.get_dolg_on_date_per_dog_vreal(p_date)) f ON d.kod_dog = f.kod_dog
  -- WHERE 1=1  { AND d.gr_cust_kod_level_1 IN :p_gr}  -- по группе потреби отфильтровано уже в rr_rep_dog (kg_rep_dog.dog_gr_customer)
;
END;]]></procedure>
      <queries>
        <query name="75061_data" as="d">
          <withparams>
            <useparam name="p_sum" />
            <useparam name="p_is_flag" />
          </withparams>
        </query>
        <query name="75061-title" as="t">
          <withparams>
            <useparam name="p_date" />
            <useparam name="p_is_flag" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="75141" form="75141" title="1103. 22-ЖКУ (v 1.1)" nogrid="1" timestamp="20.06.2025 18:20:52" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75141.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param name="p_year" type="number" />
        <param name="p_kv" type="number" />
      </params>
      <print-templates>
        <excel>
          <template name="75141.xlsx" print-proc="2" print-xlsx="1" title="22-ЖКУ" />
        </excel>
      </print-templates>
      <procedure><![CDATA[-- Рязань. ГП. Отчет № 1103. 22-ЖКУ (SD:75141)  
 DECLARE
   p_dep         kr_dogovor.dep%type; 
   p_ym_beg      nv_account.ym%type;
   p_ym_end      nv_account.ym%type;
   p_first_day_ym_beg  DATE;
   s_data_id     rr_temp.skod%type;
BEGIN
  p_dep        := :p_dep; 
  p_ym_beg     := :p_year + 1 / 100;  -- первый месяц года
  p_ym_end     := :p_year + (:p_kv * 3) / 100;	   -- последний месяц квартала	
  p_first_day_ym_beg:= kg.ym_first_day(p_ym_beg); -- первый день года
  s_data_id    :='{3d8b60b1-75141-nach-8c99c9d294fb}';         
  
  DELETE FROM rr_temp WHERE skod = s_data_id;
  
  INSERT INTO rr_temp (skod, 
					   n1,  -- kod_gr_level_1 - код корневого уровня группы потребителей
					   s1,  -- gr_num_level_1
					   n2,  -- okved_level_2 - числовое значение кода второго уровня группы потребилей
					   n3,  -- npp_parent  - номер родительской тарифной группы в начислениях
					   n4,  -- cust_kvth
					   n5,  -- nach
					   n6   -- nachisl
					   )  
  SELECT  s_data_id 
        , gcc.kod_level_1 as kod_gr_level_1      
        , max(gcc.num_gr_level_1)  as  gr_num_level_1        
        , max(to_number(okved.okved_level_2)) as okved_level_2_num  -- числовое значение поля OKVED 2-го уровня (на первом уровне идут "Раздел А(В,...)")
        , t2.npp as npp_parent      
        , SUM(CASE WHEN n.edizm = 4 THEN COALESCE(fr.cust,0) ELSE 0 END) as cust_kvth
        , SUM(COALESCE(fr.nachisl,0)) - SUM(nvl(nal.nal,0)) as nach
        , SUM(COALESCE(fr.nachisl,0)) as nachisl       
    FROM  sr_facvip fv
        INNER JOIN sr_facras fr ON fv.kod_sf = fr.kod_sf
        LEFT JOIN (SELECT SUM(COALESCE(nal,0)) as nal, kod_ras FROM sr_facras_nal GROUP BY kod_ras) nal ON fr.kod_ras = nal.kod_ras
        LEFT JOIN sk_nachisl n ON fr.vid_t = n.vid_t
        LEFT JOIN sk_vid_real vr ON n.vid_real = vr.vid_real
  
        INNER JOIN kr_dogovor d ON fv.kod_dog=d.kod_dog             
        INNER JOIN kr_dogovor dp On d.kod_dog_fin = dp.kod_dog     
        INNER JOIN kr_dogovor_dop dd ON dp.kod_dog = dd.kod_dog
        INNER JOIN kv_group_cust_level gcc ON dd.kod_group_cust = gcc.kod_group_cust    
        INNER JOIN kr_payer p ON dp.kodp = p.kodp 
        LEFT JOIN kv_okved_level okved ON p.kod_okved = okved.kod_okved  
        LEFT JOIN ks_tarif t ON fr.tarif = t.tarif  
        LEFT JOIN ks_tarif t2 ON t.tarif_parent = t2.tarif    
   WHERE dp.dep = p_dep
        AND fv.ym BETWEEN p_ym_beg AND p_ym_end
        AND fr.price is not null 
        AND NOT (nvl(fr.price,0) = 0 and fr.vid_t in (22,42,62,72))
        AND vr.pr_osn = 1                                 
        AND fv.pr_osn=1       
   GROUP BY gcc.kod_level_1, okved.kod_okved_level_2, dp.kod_dog, t2.npp       
;
  ----------------- ------------
  -- оплаты
  s_data_id    :='{3d8b60b1-75141-opl-8c99c9d294fb}';  
  DELETE FROM rr_temp WHERE skod = s_data_id;
   INSERT INTO rr_temp (skod, 
					    n1,  -- kod_gr_level_1 - код корневого уровня группы потребителей
					    s1,  -- gr_num_level_1
					    n7,	 -- opl_in_ym
					    n8   -- opl_dolg_beg
					   )					   
  select  s_data_id
       ,  gcc.kod_level_1 as GR_CUST_KOD_LEVEL_1    
       , max(gcc.num_gr_level_1)   as  GR_CUST_NUM_level_1  
       , SUM(COALESCE(o.opl + COALESCE(o.opls,0),0))  as opl_in_ym  -- оплата по сф в периоде кроме задатка, ГП, пеней
       , SUM(CASE WHEN nvl(deb.dat_bzad, fv.dat_zadol) < p_first_day_ym_beg THEN COALESCE(o.opl + COALESCE(o.opls,0),0) ELSE 0 END) as opl_dolg_beg -- плата по задолженности на наначало периода
  FROM sr_opl o
    LEFT JOIN sr_facvip fv ON o.kod_sf = fv.kod_sf AND fv.vid_real <> 0
    LEFT JOIN sr_debet deb ON fv.kod_deb =  deb.kod_deb
    INNER JOIN kr_dogovor d ON o.kod_dog = d.kod_dog
    INNER JOIN kr_dogovor dp ON d.kod_dog_fin = dp.kod_dog          
    INNER JOIN kr_dogovor_dop dd ON o.kod_dog = dd.kod_dog
    INNER JOIN kv_group_cust_level gcc ON dd.kod_group_cust = gcc.kod_group_cust
  WHERE   dp.dep = p_dep
       AND o.ym BETWEEN p_ym_beg AND p_ym_end
	   AND o.vid_real not in (1,7,9)    
   GROUP BY gcc.kod_level_1;   
    ----------------- ------------
  -- площадь общего имущества для догворов с группой потербителей '2' или '4' номероом родительского тарифа с ТУ (npp) in (631,632,633)
  s_data_id    :='{3d8b60b1-75141-sqoi-8c99c9d294fb}';  
  DELETE FROM rr_temp WHERE skod = s_data_id;
   INSERT INTO rr_temp (skod, 
					    n1  -- площадь общего имущества					   
					   )
  with pre as ( -- достаем нужные адреса домов для догворов с группой потербителей '2' или '4'
            select distinct(ob.kodd_house) kodd_house    
          from kr_dogovor dp
            INNER JOIN kr_numobj n ON dp.kod_dog = n.kod_dog
            INNER JOIN kr_object ob ON n.kod_obj = ob.kod_obj
            INNER JOIN kr_dogovor_dop dd ON dp.kod_dog = dd.kod_dog
            INNER JOIN kv_group_cust_level gcc ON dd.kod_group_cust = gcc.kod_group_cust   
            INNER JOIN hr_point po ON ob.kod_obj = po.kod_obj
            INNER JOIN hr_point_tar tar ON po.kod_point = tar.kod_point
            INNER JOIN ks_tarif t ON tar.tarif = t.tarif  
            INNER JOIN ks_tarif t2 ON t.tarif_parent = t2.tarif   
          WHERE dp.dep = p_dep      
             AND gcc.num_gr_level_1 in ('2','4')     
             AND t2.npp in (631,632,633)
           )
  , pre2 as ( -- находим код объекта по нужным адресам
              select o.kod_obj as kod_obj
              from kr_object o
                INNER JOIN pre ON o.kodd = pre.kodd_house
              where o.tep_el = 4
                  and o.dep = p_dep
                  and o.tep_el_byt = 1
                  and not exists (select null from kr_numobj no where no.kod_obj = o.kod_obj)
          )            
  select s_data_id, sum(COALESCE(tr.sqoi,0)) as sqoi 
    from  tr_har_house tr
      inner join pre2 ON tr.kod_obj = pre2.kod_obj       
;            
END;]]></procedure>
      <queries>
        <query name="75141_d1" as="d1" />
        <query name="75141_data_opl" as="d_opl" />
        <query name="75141_data_sqoi" as="s" />
        <query name="title_info" as="t">
          <withparams function="+" type="number">
            <call function="+">
              <useparam name="p_year" />
              <const type="number">0.01</const>
            </call>
            <call function="+" type="number">
              <useparam name="p_year" />
              <call function="*" type="number" mp="-2">
                <useparam name="p_kv" />
                <const type="number">3</const>
              </call>
            </call>
          </withparams>
        </query>
      </queries>
    </report>
    <report name="75227" title="1063. Сведения о заключенных договорах (v1.1)" form="75227" nogrid="1" timestamp="23.04.2025 20:48:59" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75227.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_dep" />
        <param type="date" name="p_date_from" />
        <param name="p_date_to" type="date" />
        <param name="p_tco" type="array" />
      </params>
      <print-templates>
        <excel>
          <template name="75227.xlsx" print-proc="2" print-xlsx="1" title="Сведения о заключенных договорах." />
        </excel>
      </print-templates>
      <procedure><![CDATA[-- Отчет № 1063. SD: 75227. Сведения о заключенных договорах. ( Рязань. ГП)
BEGIN
  DELETE vr_number_array;
  INSERT INTO vr_number_array (array_id,val)  SELECT 'p_dep', kodp  FROM kr_org  WHERE kodp=:p_dep;   
  INSERT INTO vr_number_array (array_id,val)  SELECT 'p_tco_net_kodp', kodp  FROM kr_payer WHERE 1=0 { OR kodp in :p_tco};   
  kg_rep_dog.dog_obj(:p_date_from, :p_date_to, 1, 1);
END;]]></procedure>
      <queries>
        <query name="75227_data" as="d" />
        <query name="title_info" as="t">
          <withparams>
            <const>NULL</const>
            <const>NULL</const>
            <useparam name="p_dep" />
            <const>NULL</const>
            <const>NULL</const>
            <useparam name="p_date_from" />
            <useparam name="p_date_to" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="75237" form="75237" title="1064. Сведения о расторгнутых договорах" nogrid="1" timestamp="17.04.2025 18:30:41" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75237.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_dep" />
        <param type="date" name="p_date_from" />
        <param name="p_date_to" type="date" />
        <param name="p_tco" type="array" />
      </params>
      <print-templates>
        <excel>
          <template name="75237.xlsx" print-proc="2" print-xlsx="1" title="Сведения о расторгнутых договорах." />
        </excel>
      </print-templates>
      <procedure><![CDATA[-- Отчет № 1064. SD: 75237. Сведения о расторгнутых договорах. (Рязань. ГП)
BEGIN
  DELETE vr_number_array;
  INSERT INTO vr_number_array (array_id,val)  SELECT 'p_dep', kodp  FROM kr_org  WHERE kodp=:p_dep;   
  INSERT INTO vr_number_array (array_id,val)  SELECT 'p_tco_net_kodp', kodp  FROM kr_payer WHERE 1=0 { OR kodp in :p_tco};   
  kg_rep_dog.dog_obj(:p_date_from, :p_date_to, 2);
END;]]></procedure>
      <queries>
        <query name="75227_data" as="d" />
        <query name="title_info" as="t">
          <withparams>
            <const>NULL</const>
            <const>NULL</const>
            <useparam name="p_dep" />
            <const>NULL</const>
            <const>NULL</const>
            <useparam name="p_date_from" />
            <useparam name="p_date_to" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="75529" form="75529" title="2001. Отчет о начислениях по договорам энергоснабжения" nogrid="1" timestamp="22.05.2025 16:27:27" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75529.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
      </params>
      <print-templates>
        <excel>
          <template name="75529.xlsx" print-proc="2" print-xlsx="1" title="Отчет о начислениях по договорам энергоснабжения" />
        </excel>
      </print-templates>
      <procedure><![CDATA[BEGIN
 delete vr_number_array;
 INSERT INTO vr_number_array (array_id,val) SELECT 'p_dep', kodp  FROM kr_org  WHERE kodp=:p_dep;   
 ng_rep_other.po_per_region(:p_ym,:p_ym);
END;
]]></procedure>
      <queries>
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <const>NULL</const>
            <useparam name="p_dep" />
            <const>NULL</const>
            <const>NULL</const>
          </withparams>
        </query>
        <query name="75529_data" as="d" />
      </queries>
    </report>
    <report name="75545" form="75545" title="2002.  Отчет об оплате по договорам энергоснабжения" nogrid="1" timestamp="24.05.2025 16:58:37" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75545.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
      </params>
      <print-templates>
        <excel>
          <template name="75545.xlsx" print-proc="2" print-xlsx="1" title=" Отчет об оплате по договорам энергоснабжения" />
        </excel>
      </print-templates>
      <procedure><![CDATA[BEGIN
 
 delete rr_rep_po;

INSERT INTO rr_rep_po (kod_dog, ndog, payer_name, opl, price, nal, price_gp)
WITH
 gp as ( SELECT b.kod_dog,
               	          b.money/b.cust_kvth as price_gp      
             FROM (SELECT dp.kod_dog,
   	                     SUM(a.money) as money,
                	     SUM(COALESCE(CASE WHEN a.edizm = 4 THEN a.cust ELSE 0 END,0)) as cust_kvth
	           FROM nv_account a
                       	  INNER JOIN hr_reglament_pp r ON a.kod_reglament=r.kod_reglament
                 	  INNER JOIN hr_calc_variant v ON v.kod_variant=r.kod_variant
	                  INNER JOIN kr_dogovor dp ON a.kod_dog_fin = dp.kod_dog
                        WHERE dp.dep =  :p_dep
                            AND a.ym = kg.ym_add(:p_ym,-1)  -- цена ГП за предыдущий период
                            AND v.kod_typevariant = 2    -- 2 - цены ГП
                            AND a.price IS not null
                      GROUP BY dp.kod_dog
                ) b
          )
  , pre as (SELECT dp.kod_dog,
                   max(dp.ndog) as ndog,
                   max(p.name) as payer_name,
                   sum(COALESCE(o.opl,0)) as opl,
                   max(fr.price) as price,
                   max(n.nal) as nal                
              FROM sr_opl o 
                  INNER JOIN sr_facvip fv ON o.kod_sf = fv.kod_Sf
                  INNER JOIN sr_facras fr ON fv.kod_sf = fr.kod_sf
                  INNER JOIN kr_dogovor d ON fv.kod_dog = d.kod_dog
                  INNER JOIN kr_dogovor dp ON d.kod_dog_fin = dp.kod_dog
                  INNER JOIN sk_vid_real vr ON fv.vid_real = vr.vid_real    -- pr_osn нужно брать из вида реализации для определения основной реализации
                  LEFT JOIN (SELECT SUM(nvl(nal,0)) as nal, kod_ras FROM sr_facras_nal GROUP BY kod_ras) n ON fr.kod_ras = n.kod_ras
                  LEFT JOIN kr_payer p ON dp.kodp = p.kodp
            WHERE vr.pr_osn=1
               AND dp.dep= :p_dep
               AND o.ym = :p_ym
            GROUP BY dp.kod_dog
            )
   SELECT pre.kod_dog,
          pre.ndog,
          pre.payer_name,
          pre.opl,
          pre.price,
          pre.nal,
          COALESCE(gp.price_gp,0) as price_gp
     FROM pre 
       LEFT JOIN gp ON pre.kod_dog = gp.kod_dog
 ;


END;
]]></procedure>
      <queries>
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <const>NULL</const>
            <useparam name="p_dep" />
            <const>NULL</const>
            <const>NULL</const>
          </withparams>
        </query>
        <query name="75545_data" as="d" />
      </queries>
    </report>
    <report name="75580" form="75580" title="56. Нерегулируемые цены на э.э. (мощность) для потребителей РГМЭК в качестве НЭСК" nogrid="1" timestamp="03.06.2025 23:34:17" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75580.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
        <param name="p_kod_adr_m" type="array" />
      </params>
      <print-templates>
        <excel>
          <template name="75580.xlsx" print-xlsx="1" title="Нерегулируемые цены на э.э. мощность для потребителей РГМЭК в качестве НЭСК" />
        </excel>
      </print-templates>
      <procedure><![CDATA[DECLARE
  p_ym NUMBER;
  p_dep NUMBER;  
BEGIN
 p_ym := :p_ym;  -- 2025.02;  
 p_dep:= :p_dep;   -- 1172;    
 delete vr_number_array;
-- INSERT INTO vr_number_array (array_id, val) SELECT 'p_dep', kodp  FROM kr_org  WHERE kodp=:p_dep;    
 INSERT INTO vr_number_array (array_id, val) VALUES('p_dep', p_dep); 
 INSERT INTO vr_number_array (array_id, val) VALUES('p_tep_el', 1); -- договоры э/э
 INSERT INTO vr_number_array (array_id, val) SELECT 'p_kod_adr_m',  kod_m  FROM adr_m  WHERE 1=0 {OR kod_m in :p_kod_adr_m};
 kg_rep_dog.dog_obj_short(p_ym);

 DELETE rr_rep_po;     
  
 INSERT INTO rr_rep_po ( kod_region, region_name,
                         kod_dog,    ndog, 
                         dog_dat_beg,                     
                         payer_name,    -- наименование потребителя
                         note,
                         f_slova_account,
                         edizm,
                         voltage,    
                         volt_abbr,                        
                         price                        
                       )
   WITH 
    dog as ( select 
                   kod_dog,
                   max(ndog) as ndog
              from rr_rep_dog
            group by  kod_dog
            )
  , 
   size_doc as (select fv.kod_dog, max(size_doc) as size_doc
                  from sr_facvip fv
                   inner join sr_facvip_text t ON fv.kod_sf=t.kod_sf               
                   inner join dog ON fv.kod_dog = dog.kod_dog
                 where  ym = p_ym and vid_real=2 and pr_old in(0,1)
                 group by fv.kod_dog
         )
  , min_doc as ( -- где СФ свернутый
                SELECT  d.kod_region
                    , max(d.region_name) as region_name 
                    , a.kod_dog
                    , max(d.ndog) ndog
                    , max(d.dog_dat_beg) as dog_dat_beg
                    , max(d.payer_name) as payer_name
                    , max(hg_common.get_gtp_add_regl(a.kod_numobj, a.ym, 0))  as gtp
                    , ng_account.f_slova_account(a.kod_account) as f_slova_account
                    , null as edizm
                    , a.voltage
                    , max(COALESCE(volt.abbr,'-'))  as volt_abbr                                       
                    , sum(a.money) as maney                   
                    , sum(COALESCE(CASE WHEN a.edizm = 4 THEN a.cust ELSE 0 END,0))  as cust
                    , count(a.kod_dog) OVER (PARTITION BY d.kod_region, a.kod_dog, a.voltage) as cnt_str_in_volt  
                    , max(t.name) as tarif_sost
             FROM nv_account a --\nr_account
               inner join kr_numobj no On a.kod_numobj= no.kod_numobj
               inner join rr_rep_dog d On no.kod_numobj=d.kod_numobj
               INNER JOIN hr_reglament_pp r ON a.kod_reglament=r.kod_reglament
               INNER JOIN hr_calc_variant v ON v.kod_variant=r.kod_variant
               INNER JOIN size_doc s ON a.kod_Dog = s.kod_dog
               LEFT JOIN hk_voltage volt ON a.voltage = volt.voltage
               LEFT JOIN nr_account_sost a_sost ON a.kod_account = a_sost.kod_account AND a_sost.tip_tarif_sost = 2
               LEFT JOIN ks_tarif t ON a_sost.tarif = t.tarif
           WHERE   a.ym = p_ym
                AND a.price is not null  AND v.kod_typevariant = 0  and a.rym is null
                AND a.nachisl <> 0
                AND s.size_doc = 2                             
           GROUP BY  d.kod_region, a.kod_dog, a.voltage, ng_account.f_slova_account(a.kod_account)             
          )
  
  , max_doc_kvth as ( --  СФ  развернутый, берем КВтч. 
                   SELECT  d.kod_region
                         , max(d.region_name) as region_name
                         , a.kod_dog
                         , max(d.ndog) ndog
                         , max(d.dog_dat_beg) as dog_dat_beg
                         , max(d.payer_name) as payer_name
                         , max(hg_common.get_gtp_add_regl(a.kod_numobj, a.ym, 0))  as gtp    
                         , ng_account.f_slova_account(a.kod_account) as f_slova_account             
                         , a.edizm as edizm
                         , a.voltage
                         , max(COALESCE(volt.abbr,'-'))  as volt_abbr  
                         , sum(a.money) as money   
                         , sum(COALESCE(a.cust,0)) as cust    
                         , count(a.kod_dog) OVER (PARTITION BY d.kod_region, a.kod_dog, a.voltage) as cnt_str_in_volt  
                       
                   , count(a.kod_dog) OVER (PARTITION BY d.kod_region, a.kod_dog, a.voltage) as nach         
                               
                 FROM nv_account a 
                    inner join kr_numobj no On a.kod_numobj= no.kod_numobj
                    inner join rr_rep_dog d On no.kod_numobj=d.kod_numobj
                    INNER JOIN hr_reglament_pp r ON a.kod_reglament=r.kod_reglament
                    INNER JOIN hr_calc_variant v ON v.kod_variant=r.kod_variant
                    INNER JOIN size_doc s ON a.kod_Dog = s.kod_dog
                    LEFT JOIN hk_voltage volt ON a.voltage = volt.voltage               
                 WHERE  a.ym = p_ym
                    AND a.price is not null
                    AND v.kod_typevariant = 0  and a.rym is null
                    AND a.nachisl <> 0
                    AND s.size_doc <> 2
                    AND a.edizm = 4 
                   -- AND (cnt_kod_adr_m = 0 OR (cnt_kod_adr_m > 0 AND kod_region IN (SELECT val FROM vr_number_array WHERE array_id = 'p_kod_adr_m')))
                 GROUP BY  d.kod_region, a.kod_dog, a.voltage, a.edizm
                        , ng_account.f_slova_account(a.kod_account)                          
             ) 
   , max_doc_kvt as ( --  СФ  развернутый, берем Вт. деньги - вся мощность, cust - только -272
                   SELECT  d.kod_region
                         , max(d.region_name) as region_name
                         , a.kod_dog
                         , max(d.ndog) ndog
                         , max(d.dog_dat_beg) as dog_dat_beg
                         , max(d.payer_name) as payer_name
                         , max(hg_common.get_gtp_add_regl(a.kod_numobj, a.ym, 0))  as gtp    
                         , ng_account.f_slova_account(a.kod_account) as f_slova_account        
                         , a.edizm as edizm
                         , a.voltage
                         , max(COALESCE(volt.abbr,'-'))  as volt_abbr                                               
                         , sum(a.money)  as money
                         , sum(case when vid_t = -272 then COALESCE(a.cust,0)/1000 else 0 end) as cust  -- нужно в МВт   
                         , count(a.kod_dog) OVER (PARTITION BY d.kod_region, a.kod_dog, a.voltage) as cnt_str_in_volt  
             FROM nv_account a 
                    inner join kr_numobj no On a.kod_numobj= no.kod_numobj
                    inner join rr_rep_dog d On no.kod_numobj=d.kod_numobj
                    INNER JOIN hr_reglament_pp r ON a.kod_reglament=r.kod_reglament
                    INNER JOIN hr_calc_variant v ON v.kod_variant=r.kod_variant
                    INNER JOIN size_doc s ON a.kod_Dog = s.kod_dog
                    LEFT JOIN hk_voltage volt ON a.voltage = volt.voltage               
                 WHERE  a.ym = p_ym
                    AND a.price is not null
                    AND v.kod_typevariant = 0  and a.rym is null
                    AND a.nachisl <> 0
                    AND s.size_doc <> 2
                    AND a.edizm = 3 
                   -- AND (cnt_kod_adr_m = 0 OR (cnt_kod_adr_m > 0 AND kod_region IN (SELECT val FROM vr_number_array WHERE array_id = 'p_kod_adr_m')))
                 GROUP BY  d.kod_region, a.kod_dog, a.voltage, a.edizm
                        , ng_account.f_slova_account(a.kod_account)                          
             ) 
  
    SELECT  kod_region
                    , region_name 
                    , kod_dog
                    , ndog
                    , dog_dat_beg
                    , payer_name
                    , 'электроэнергия (мощность), руб./кВт.ч' || CASE WHEN cnt_str_in_volt > 1  
                                                                      THEN CASE WHEN cnt_str_in_volt = count(kod_dog) OVER (PARTITION BY kod_region, kod_dog, voltage, gtp) 
                                                                                THEN ' (' || tarif_sost || ')'
                                                                                ELSE ' (' || gtp.name ||')'
                                                                                END
                                                                      ELSE '' 
                                                                      END as note
                    , f_slova_account
                    , edizm
                    , voltage
                    , volt_abbr
                    , round(maney/(CASE WHEN cust = 0 THEN to_number(null) ELSE cust END),6) as price                       
               FROM min_doc
                 LEFT JOIN hs_gtp gtp ON min_doc.gtp = gtp.kod_gtp
      UNION ALL
            SELECT  kod_region
                    , region_name 
                    , kod_dog
                    , ndog
                    , dog_dat_beg
                    , payer_name
                    , 'электроэнергия, руб./кВт.ч' || ' ' as note
                    , f_slova_account
                    , edizm
                    , voltage
                    , volt_abbr
                    , round(money/(CASE WHEN cust = 0 THEN to_number(null) ELSE cust END),6) as price             
               FROM max_doc_kvth 
               
       UNION ALL
            SELECT  kod_region
                    , region_name 
                    , kod_dog
                    , ndog
                    , dog_dat_beg
                    , payer_name
                    , 'мощность фактическая, руб./МВт'  as note
                    , f_slova_account
                    , edizm
                    , voltage
                    , volt_abbr
                    , round(money/(CASE WHEN cust = 0 THEN to_number(null) ELSE cust END),6) as price           
               FROM max_doc_kvt
  ;

end;
]]></procedure>
      <queries>
        <query name="75580_data" as="d" />
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
            <useparam name="p_kod_adr_m" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="75680" form="75680" title="1058. Сведения о начислении и оплате" nogrid="1" timestamp="08.06.2025 19:15:29" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75680.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param type="number" name="p_dep" />
        <param type="number" name="p_ym_beg" />
        <param name="p_ym_end" type="number" />
        <param name="p_kod_dog" type="number" />
      </params>
      <print-templates>
        <excel>
          <template name="75680.xlsx" print-proc="2" print-xlsx="1" title="Сведения о начислении и оплате" />
        </excel>
      </print-templates>
      <procedure><![CDATA[-- Рязань.ГП. SD: 75680. Отчет № 1058. Сведения о начислении и оплате. 
begin 
  DELETE rr_rep_dog;
  INSERT INTO rr_rep_dog ( kod_dog
                            , ndog
                            , payer_id        -- ID потребителя
                            , payer_name      -- наименование потребителя
                        )
  SELECT d.kod_dog
          , d.ndog
          , p.kodp as payer_id
          , p.name as payer_name
    FROM   kr_dogovor d
       LEFT JOIN kr_payer p ON d.kodp = p.kodp   
    WHERE d.kod_dog = :p_kod_dog;

 DELETE rr_rep_dz_kz_dog;
 INSERT INTO rr_rep_dz_kz_dog (kod_dog
                                , ym                               
                                , saldo_beg
                                , cust_kvth_in_period
                                , nachisl_osn_in_period
                                , opl_all_in_period  
                                , nachisl_pe_in_period 
                                , opl_pe_in_period 
                                , saldo_end
                               ) 
 WITH
    pre_nachislenie as (
             SELECT dp.kod_dog
                 , fv.ym
                 , SUM(CASE WHEN vr.pr_osn = 1                    THEN COALESCE(fr.nachisl,0) ELSE 0 END) as nachisl_osn_in_period  -- начислено по осн.реализации в периоде
                 , SUM(CASE WHEN vr.pr_osn = 1   AND fr.edizm = 4 THEN COALESCE(fr.cust,0) ELSE 0 END) as cust_kvth_in_period  -- начислено объем э/э по осн.реализации в периоде
                 , SUM(CASE WHEN fv.vid_real = 7                  THEN COALESCE(fr.nachisl,0) ELSE 0 END) as nachisl_pe_in_period  -- начислено пеней в периоде
             FROM  sr_facvip fv 
               LEFT JOIN sr_facras fr ON fv.kod_sf = fr.kod_sf             
               LEFT JOIN kr_dogovor d ON fv.kod_dog = d.kod_dog
               LEFT JOIN kr_dogovor dp ON d.kod_dog_fin = dp.kod_dog
               LEFT JOIN sk_vid_real vr ON fv.vid_real = vr.vid_real    -- pr_osn нужно брать из вида реализации для определения основной реализации 
            WHERE fv.ym <=  :p_ym_end  -- < p_ym_end_next
                AND fv.pr_osn = 1
                AND dp.kod_dog = :p_kod_dog
          GROUP BY dp.kod_dog, fv.ym       
            )

, nachislenie as (select kod_dog
        , ym
        , lag(nachisl_osn_in_period,1,0) over(order by ym) as nachisl_lag   
        , nachisl_osn_in_period
        , cust_kvth_in_period
        , nachisl_pe_in_period 
 from pre_nachislenie
 )
 
  , pre_opl as ( SELECT dp.kod_dog
                    , o.ym
                    , SUM(CASE WHEN vr.pr_osn = 1 AND o.kod_type_opl IN (0,3,4) THEN COALESCE(o.opl,0) ELSE 0 END) as opl_in_ym  -- оплата ДЗ в периоде
                    , SUM(CASE WHEN o.vid_real = 7 AND o.kod_type_opl IN (0,3,4) THEN COALESCE(o.opl,0) ELSE 0 END) as opl_pe_in_period  -- оплата пеней в периоде
                    , SUM(CASE WHEN o.vid_real <> 1 THEN (COALESCE(o.opl,0) + COALESCE(o.opls,0)) ELSE 0 END) As opl_all_in_period  -- оплачено всего за месяц
                    , SUM(CASE WHEN o.vid_real < 7 AND o.vid_real <> 1 AND o.kod_type_opl IN (1,2,5,6) THEN COALESCE(o.opl,0) + COALESCE(o.opls,0) ELSE 0 END) As kz_ym  -- оплата по КЗ 
               FROM sr_opl o
                INNER JOIN kr_dogovor d ON o.kod_dog = d.kod_dog
                INNER JOIN kr_dogovor dp ON d.kod_dog_fin = dp.kod_dog
                INNER JOIN sk_vid_real vr ON o.vid_real = vr.vid_real    -- pr_osn нужно брать из вида реализации  для проверки основной реализации
             WHERE  o.ym <= :p_ym_end
                AND dp.kod_dog = :p_kod_dog          
             GROUP BY dp.kod_dog, o.ym          
          )
  , opl as (SELECT kod_dog
                , ym
                , opl_in_ym
                , kz_ym
                , lag(opl_in_ym,1,0) over(order by ym) as opl_in_ym_lag   
                , lag(kz_ym,1,0) over(order by ym) as kz_ym_lag   
                , opl_all_in_period  
                , opl_pe_in_period 
            FROM pre_opl
          )        
          
, pre as ( 
    SELECT  n.kod_dog
       , n.ym     
       , sum(n.nachisl_lag) over(order by n.ym)  as nachisl_beg
       , sum(o.opl_in_ym_lag) over(order by o.ym)  as opl_beg
       , n.nachisl_osn_in_period
       , n.cust_kvth_in_period
       , n.nachisl_pe_in_period 
       , sum(o.kz_ym_lag) over(order by o.ym)  as kz_beg
       , COALESCE(opl_all_in_period,0) as opl_all_in_period  
       , COALESCE(opl_pe_in_period,0) as opl_pe_in_period     
 FROM nachislenie n 
   LEFT JOIN opl o ON n.kod_dog=o.kod_dog AND n.ym = o.ym
   )
  
  SELECT kod_dog
        , ym
        , nachisl_beg - opl_beg - kz_beg as saldo_beg
        , cust_kvth_in_period
        , nachisl_osn_in_period
        , opl_all_in_period  
        , nachisl_pe_in_period 
        , opl_pe_in_period 
        , nachisl_beg - opl_beg - kz_beg + nachisl_osn_in_period - opl_all_in_period as saldo_end
    FROM pre  
    WHERE ym >= :p_ym_beg 
    ;
END;]]></procedure>
      <queries>
        <query name="75680_data" as="d" />
        <query name="75680_dog" as="dog" />
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym_beg" />
            <useparam name="p_ym_end" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="75728" title="1107. Отчет по просроченной задолженности" form="75728" nogrid="1" timestamp="18.06.2025 14:25:21" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75728.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param name="p_ym" type="number" />
        <param name="p_kod_adr_m" type="array" />
        <param name="p_no_dog" type="array" exclude="1" />
        <param type="number" name="p_no_detail" />
        <param type="number" name="p_no_detail_dog" />
      </params>
      <print-templates>
        <excel>
          <template name="75728.xlsx" print-proc="2" print-xlsx="1" title="Отчет по просроченной задолженности" />
        </excel>
      </print-templates>
      <procedure><![CDATA[declare 
   ym_year_begin number;
begin
   -- почти все данные в отчете формируются нарастающим итогом с начала года:
   ym_year_begin := trunc(:p_ym)+0.01;
   delete vr_number_array;
  -- добавляем во временную таблицу данные по выбранным отделениям
  INSERT INTO vr_number_array (array_id,val) values ('p_dep',:p_dep);
   -- добавляем во временную таблицу данные по выбранным субъектам РФ
  INSERT INTO vr_number_array (array_id,val)  
       SELECT 'p_kod_adr_m', kod_m FROM adr_m WHERE 1=0 {OR kod_m in :p_kod_adr_m};
 -- заполняем вр. таблицу rr_rep_dog данными по договорам
  kg_rep_dog.dog_obj_short;
 -- Удаляем "договоры вне списка"
 -- DELETE rr_rep_dog where  1 = 0  {OR kod_dog in :p_no_dog};
 -- заполняем вр. таблицу  rr_rep_dz_kz_dog по данными по ДЗ
  SG_REP_DZ_KZ.dz_kz_per_period_srf(ym_year_begin,:p_ym); 
end;
]]></procedure>
      <queries>
        <query name="75728_data" as="a">
          <withparams>
            <useparam name="p_no_detail" />
            <useparam name="p_no_detail_dog" />
          </withparams>
        </query>
        <query name="title_info" as="t">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
            <useparam name="p_kod_adr_m" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="75780" form="75780" title="1101. Справка о начислении, оплате и задолженности (v1.1)" nogrid="1" timestamp="28.06.2025 10:54:21" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75780.xml">
      <customers>
        <customer id="310" />
      </customers>
      <params>
        <param name="p_dep" type="number" />
        <param type="number" name="p_ym" title="Период" />
        <param name="is_dog" type="number">
          <const type="number">0</const>
        </param>
      </params>
      <print-templates>
        <excel>
          <template name="75780.xlsx" del-cols="1" print-proc="2" print-xlsx="1" title="Справка о начислении, оплате и задолженности" />
        </excel>
      </print-templates>
      <procedure><![CDATA[
begin
    delete vr_number_array;
    INSERT INTO vr_number_array (array_id,val) values ('p_dep', :p_dep);
    kg_rep_dog.dog_gr_customer(0,:p_ym);
    sg_rep_dz_kz.dz_kz_per_period_dog(:p_ym,:p_ym);
end;]]></procedure>
      <queries>
        <query name="75780_data" as="a">
          <withparams>
            <useparam name="is_dog" />
          </withparams>
        </query>
        <query name="75780_data_8" as="a8">
          <withparams>
            <useparam name="is_dog" />
          </withparams>
        </query>
        <query name="75780_data_all" as="i" />
        <query name="title_info" as="title">
          <withparams>
            <useparam name="p_ym" />
            <useparam name="p_ym" />
            <useparam name="p_dep" />
          </withparams>
        </query>
      </queries>
    </report>
  </reports>
  <forms child-name="form" key-name="name">
    <form name="61880_10_ryaz" title="Форма 47А" timestamp="26.12.2024 16:34:22" file="sql.builder.templates\sql.builder\projects\ryazan\reports\61880_10_ryaz.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" />
      <usefield field="asuse_ym_tek_dep" name="p_ym_beg" mandatory="1" title="Период с" />
      <usefield field="asuse_ym_tek_dep" name="p_ym_end" mandatory="1" title="Период по" />
      <usefield field="asuse_adr_m_obj_dep" name="p_kod_adr_m" />
      <usefield field="asuse_adr_m_subject_dep" name="p_kod_adr_m" comment="Временно, пока не исправлен пакет отчета для фильтрации по адресам объектов" exclude="1" />
      <usefield type="number" field="cmn_check" name="is_dog" title="Выводить детализацию по договорам" />
    </form>
    <form name="72257" title="Отчет по корректировкам в разрезе счетов-фактур" timestamp="24.07.2024 16:43:10" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72257.xml">
      <usefield field="asuse_dep_single" name="p_dep" mandatory="1" show-checkbox="0" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" show-checkbox="0" />
    </form>
    <form name="72319" title="Справка об ожидаемом поступлении оплаты" timestamp="02.08.2024 11:15:05" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72319.xml">
      <usefield field="asuse_dep_single" name="p_dep" mandatory="1" show-checkbox="0" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" show-checkbox="0" />
      <usefield type="number" field="cmn_check" name="p_is_flag" title="С учетом корректировок" show-nulls="0" />
    </form>
    <form name="72418" title="Полезный отпуск по г. Рязань" timestamp="07.08.2024 14:53:45" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72418.xml">
      <usefield field="asuse_dep_single" name="p_dep" mandatory="1" show-checkbox="0" />
      <usefield field="asuse_year" name="p_year" title="Год" type="number" />
      <usefield field="asuse_kv_str_list" name="p_kv" title="Квартал" />
    </form>
    <form name="72430" title="Сведения о дебиторской задолженности по НЭСК" timestamp="04.03.2025 16:02:00" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72430.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" type="number" />
      <usefield field="asuse_adr_m_obj_dep" name="p_kod_m_srf" title="Субъект РФ" />
      <field id="field_ndog_dep" name="p_no_dog" controlType="UIList" title="Договоры вне списка" type="number" timestamp="10.04.2023 10:51:01" file="sql.builder.templates\sql.builder\projects\ies_garant\reports\64224.xml">
        <listquery>
          <query name="ndog_list_dep" />
        </listquery>
      </field>
      <usefield type="number" field="cmn_check" name="p_no_detail" title="Выводить детализацию по субъектам РФ" />
    </form>
    <form name="72482" title="Тест выставленных счетов-фактур" timestamp="14.08.2024 16:19:47" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72482.xml">
      <usefield field="asuse_dep_single" mandatory="1" show-checkbox="0" name="p_dep" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" show-checkbox="0" />
      <usefield field="cmn_list" name="p_kod_dog" type="number" title="Договоры" name-field-name="ndog">
        <listquery>
          <query name="ndog_fin_list_dep" />
        </listquery>
      </usefield>
    </form>
    <form name="72544" title="Анализ сбытовых надбавок гарантирующих поставщиков" timestamp="24.12.2024 13:20:41" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72544.xml">
      <usefield field="asuse_year" name="p_year1" title="Год">
        <defaultquery>
          <query name="kr_calc_year_max_1" />
        </defaultquery>
      </usefield>
      <usefield field="asuse_year" name="p_year2" title="Год для сравнения" mandatory="1" />
      <usefield field="asuse_adr_m_subject_sng" name="p_kod_m_srf" show-nulls="1" title="Регион" />
      <field name="p_guarantp" controlType="UICombo" title="Гарантирующий поставщик" type="number">
        <listquery>
          <query name="guarantp_list" />
        </listquery>
      </field>
    </form>
    <form name="72554" title="ФОРМА 151с (Информация о сетевых организациях)" timestamp="19.08.2024 15:40:14" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72554.xml">
      <usefield field="asuse_dep_single" name="p_dep" type="number" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" type="number" />
    </form>
    <form name="72559" title="ФОРМА 151 (ИНФОРМАЦИЯ О СУБЪЕКТАХ)" timestamp="20.08.2024 09:08:03" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72559.xml">
      <usefield field="asuse_dep_single" name="p_dep" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" />
    </form>
    <form name="72565" title="Информация о фактических объемах потребления э/э потребителями э/э с годовым объемом потребления э/э, составляющим 60 млн. кВт·ч или более (Форма 39)" timestamp="01.10.2024 10:38:12" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72565.xml">
      <usefield name="p_dep" field="asuse_dep_single" />
      <usefield name="p_ym" field="asuse_ym_tek_dep" />
      <usefield field="asuse_adr_m_obj_dep_reset" type="number" name="p_kod_adr_m" />
      <usefield field="field_signatory" name="kod_emp" title="Подписант" show-checkbox="0" />
    </form>
    <form name="72587" title="СЗ НЭСК ДЛЯ УиЭФ" timestamp="21.02.2025 13:15:45" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72587.xml">
      <usefield field="asuse_dep_single" name="p_dep" mandatory="1" show-checkbox="0" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" show-checkbox="0" />
      <usefield type="number" field="cmn_check" name="p_is_dkp" title="С учётом договоров купли-продажи" show-nulls="0" comment="Флаг выбора договоров купли-продажи" exclude="1" />
      <usefield type="number" field="cmn_check" name="p_is_rrem" title="С учётом договоров РРЭМ" show-nulls="0" comment="Флаг выбора договоров купли-продажи" exclude="1" />
    </form>
    <form name="72589" title="58. Фактическая покупка-продажа ООО &quot;РГМЭК&quot; электрической энергии и мощности" timestamp="25.09.2024 11:44:49" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72589.xml">
      <customers>
        <customer id="310" />
      </customers>
      <usefield field="asuse_ym_tek_dep" name="p_ym_beg" title="Период с" type="number" />
      <usefield field="asuse_ym_tek_dep" name="p_ym_end" title="Период по" type="number" />
      <uicommand action-type="custom" name="button_create_rep" title="Сформировать отчёт">
        <useaction name="create_rep">
          <useparam name="p_ym_beg" type="number" />
          <useparam name="p_ym_end" type="number" />
        </useaction>
      </uicommand>
    </form>
    <form name="72595" title="Отчет по начисленной мощности" timestamp="12.03.2025 18:57:02" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72595.xml">
      <usefield name="p_dep" field="asuse_dep_single" />
      <usefield name="p_ym" field="asuse_ym_tek_dep" />
      <field id="field_ndog_dep" name="p_no_dog" controlType="UIList" title="Договоры вне списка" type="number" timestamp="10.04.2023 10:51:01" file="sql.builder.templates\sql.builder\projects\ies_garant\reports\64224.xml">
        <listquery>
          <query name="ndog_list_dep" />
        </listquery>
      </field>
    </form>
    <form name="72601" title="Сводная ведомость по реализации" timestamp="20.09.2024 10:19:48" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72601.xml">
      <usefield field="asuse_dep_single" name="p_dep" type="number" />
      <usefield field="asuse_ym_tek_dep" name="p_ym_beg" mandatory="1" title="Период с" type="number" />
      <usefield field="asuse_ym_tek_dep" name="p_ym_end" mandatory="1" title="Период по" type="number" />
      <usefield type="number" field="cmn_check" name="is_dog" title="Выводить детализацию по договорам" />
    </form>
    <form name="72609" title="Раскрытие по ТСО до 10 числа" timestamp="07.02.2025 15:26:14" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72609.xml">
      <usefield field="asuse_dep_single" name="p_dep" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" />
      <field field="cmn_list" name="p_kodp_pwrcompany" type="number" title="ТСО для расчета услуги" controlType="UICombo">
        <listquery>
          <query name="64455_1_pwrcompany" />
        </listquery>
      </field>
    </form>
    <form name="72852" title="35, 36. Справка о начислении, оплате и задолженности" timestamp="20.12.2024 16:22:31" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72852.xml">
      <usefield field="asuse_dep_single" name="p_dep" type="number" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" />
      <usefield type="number" field="cmn_check" name="is_dog" title="Выводить детализацию по договорам" />
    </form>
    <form name="72943" title="Полезный отпуск по ценам НЭСК" timestamp="03.10.2024 18:24:38" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72943.xml">
      <usefield name="p_dep" field="asuse_dep_single" />
      <usefield name="p_ym_beg" field="asuse_ym_tek_dep" />
      <usefield name="p_ym_end" field="asuse_ym_tek_dep" />
    </form>
    <form name="72956" timestamp="10.12.2024 19:32:29" file="sql.builder.templates\sql.builder\projects\ryazan\reports\72956.xml">
      <customers>
        <customer id="310" />
      </customers>
      <usefield field="asuse_dep_single" name="p_dep" title="Отделение" />
      <usefield field="asuse_ym_tek_dep" name="p_ym_beg" title="Период с" />
      <usefield field="asuse_ym_tek_dep" name="p_ym_end" title="Период по" />
    </form>
    <form name="74287" title="Структура полезного отпуска" timestamp="21.01.2025 12:07:54" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74287.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" type="number" />
      <usefield field="asuse_adr_m_obj_dep" name="p_kod_m_srf" />
    </form>
    <form name="74491" title="51. Раскрытие информации по НЦЗ для ОИТО" timestamp="14.02.2025 00:08:07" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74491.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" type="number" />
      <field name="p_kod_m_srf" comment="Субъекты РФ по НЦЗ" controlType="UICombo" type="number" title="Субъекты РФ по НЦЗ" mandatory="1">
        <listquery>
          <query name="adr_m_ncz">
            <withparams>
              <useparam name="p_dep" />
            </withparams>
          </query>
        </listquery>
      </field>
      <field name="p_kod_gtp" comment="ГТП субъекта РФ по НЦЗ" controlType="UICombo" type="number" title="ГТП субъекта РФ по НЦЗ" mandatory="1" visible="0">
        <listquery>
          <query name="gtp_ncz">
            <withparams>
              <useparam name="p_dep" />
              <useparam name="p_kod_m_srf" />
            </withparams>
          </query>
        </listquery>
      </field>
    </form>
    <form name="74610" title="Отчет для Рязаньэнерго (ПО)" timestamp="08.04.2025 11:16:27" file="sql.builder.templates\sql.builder\projects\ryazan\reports\74610.xml">
      <usefield field="asuse_dep_single" name="p_dep" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" />
    </form>
    <form name="75041" title="1067. Количество точек поставки" timestamp="25.05.2025 13:28:34" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75041.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" mandatory="1" />
      <usefield field="cmn_date_cur" type="date" name="p_date" mandatory="1" title="На дату" />
      <field field="asuse_kod_group_cust_parent" title="Группа потребителей эл. энергии" name="p_gr_cust" type="number" controlType="UIList">
        <listquery>
          <query name="75041_gr_cust" />
        </listquery>
      </field>
      <field field="field_ndog_dep" type="number" name="p_dog" controlType="UIList" title="Договоры">
        <listquery>
          <query name="ndog_list_dep" />
        </listquery>
      </field>
      <field name="p_tco" controlType="UIList" type="number" title="ТСО (граница с сетями)">
        <listquery>
          <query name="tco_net_dep">
            <withparams>
              <useparam name="p_dep" />
            </withparams>
          </query>
        </listquery>
      </field>
    </form>
    <form name="75061" title="1102. Информация о задолженности коммунальных организаций" timestamp="11.04.2025 14:10:37" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75061.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" mandatory="1" />
      <usefield field="cmn_date_cur" type="date" name="p_date" mandatory="1" title="На дату (включительно!)" />
      <field name="p_gr" title="Группа потребителей" controlType="UIList" type="number" mandatory="1">
        <listquery>
          <query name="75061_gr_cust" />
        </listquery>
        <defaultquery>
          <query name="75061_gr_cust" />
        </defaultquery>
      </field>
      <field name="p_sum" type="number" title="Долг больше или равно" show-nulls="1" controlType="UINumber" edit-mask="d" />
      <usefield type="number" field="cmn_check" name="p_is_flag" show-nulls="0" title="С учетом авансов" />
    </form>
    <form name="75141" title="22-ЖКУ" timestamp="26.04.2025 18:37:34" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75141.xml">
      <usefield field="asuse_dep_single" name="p_dep" mandatory="1" show-checkbox="0" />
      <usefield field="asuse_year" name="p_year" title="Год" type="number" />
      <usefield field="asuse_kv_str_list" name="p_kv" title="Квартал" />
    </form>
    <form name="75227" title="1063. Сведения о заключенных договорах" timestamp="17.04.2025 15:58:54" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75227.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" mandatory="1" />
      <usefield field="cmn_date_cur" type="date" name="p_date_from" mandatory="1" title="Дата с" />
      <usefield field="cmn_date_cur" type="date" name="p_date_to" mandatory="1" title="Дата по" />
      <field name="p_tco" controlType="UIList" type="number" title="ТСО (граница с сетями)">
        <listquery>
          <query name="tco_net_dep">
            <withparams>
              <useparam name="p_dep" />
            </withparams>
          </query>
        </listquery>
      </field>
    </form>
    <form name="75237" title="1064. Сведения о расторгнутых договорах" timestamp="17.04.2025 17:43:34" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75237.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" mandatory="1" />
      <usefield field="cmn_date_cur" type="date" name="p_date_from" mandatory="1" title="Дата с" />
      <usefield field="cmn_date_cur" type="date" name="p_date_to" mandatory="1" title="Дата по" />
      <field name="p_tco" controlType="UIList" type="number" title="ТСО (граница с сетями)">
        <listquery>
          <query name="tco_net_dep">
            <withparams>
              <useparam name="p_dep" />
            </withparams>
          </query>
        </listquery>
      </field>
    </form>
    <form name="75529" title="2001. Отчет о начислениях по договорам энергоснабжения" timestamp="22.05.2025 12:35:53" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75529.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" mandatory="1" title="Отделение" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" type="number" mandatory="1" title="Период" />
    </form>
    <form name="75545" title="2002.  Отчет об оплате по договорам энергоснабжения" timestamp="23.05.2025 21:26:59" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75545.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" mandatory="1" title="Отделение" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" type="number" mandatory="1" title="Период" />
    </form>
    <form name="75580" title="Нерегулируемые цены на э/э (мощность) для потребителей ООО &quot;РГМЭК&quot; в качестве НЭСК" timestamp="03.06.2025 11:34:21" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75580.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" type="number" />
      <usefield field="asuse_adr_m_obj_dep" name="p_kod_adr_m" />
    </form>
    <form name="75680" title="1058. Сведения о начислении и оплате" timestamp="08.06.2025 18:25:25" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75680.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" />
      <field name="p_ym_beg" title="Период с" type="number" controlType="UICombo">
        <listquery>
          <query name="kr_calc_list_tek_dep_1" />
        </listquery>
        <defaultquery>
          <query name="kr_calc_first_month_year_tek_dep" />
        </defaultquery>
      </field>
      <usefield field="asuse_ym_tek_dep" name="p_ym_end" type="number" mandatory="1" title="Период по" />
      <field field="field_ndog_dep" type="number" name="p_kod_dog" controlType="UICombo" title="Договор" mandatory="1">
        <listquery>
          <query name="ndog_list_dep" />
        </listquery>
      </field>
    </form>
    <form name="75728" title="Сведения по просроченной задолженности" timestamp="20.06.2025 10:25:39" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75728.xml">
      <usefield field="asuse_dep_single" type="number" name="p_dep" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" type="number" />
      <usefield field="asuse_adr_m_obj_dep" name="p_kod_adr_m" title="Субъект РФ" />
      <field id="field_ndog_dep" name="p_no_dog" controlType="UIList" title="Договоры вне списка" type="number" timestamp="10.04.2023 10:51:01" file="sql.builder.templates\sql.builder\projects\ies_garant\reports\64224.xml" exclude="1">
        <listquery>
          <query name="ndog_list_dep" />
        </listquery>
      </field>
      <usefield type="number" field="cmn_check" name="p_no_detail" title="Выводить детализацию по субъектам РФ" />
      <usefield type="number" field="cmn_check" name="p_no_detail_dog" title="Выводить детализацию по договорам" />
    </form>
    <form name="75780" title="1101. Справка о начислении, оплате и задолженности" timestamp="23.06.2025 16:00:44" file="sql.builder.templates\sql.builder\projects\ryazan\reports\75780.xml">
      <usefield field="asuse_dep_single" name="p_dep" type="number" />
      <usefield field="asuse_ym_tek_dep" name="p_ym" mandatory="1" title="Период" />
      <usefield type="number" field="cmn_check" name="is_dog" title="Выводить детализацию по договорам" />
    </form>
  </forms>
  <datatypes />
  <editors />
  <folders />
  <globalparams child-name="param" key-name="name" />
  <!--<globalconsts child-name="globalconst" key-name="name">
  </globalconsts>-->
  <expression-packages child-name="expression-package" key-name="name" />
  <dimension-packages child-name="dimension-package" key-name="name" />
  <security-packages child-name="security-package" key-name="name" />
  <color-packages child-name="color-package" key-name="name" />
  <format-packages child-name="format-package" key-name="name" />
  <button-types child-name="button-type" key-name="name" />
  <!--раздел qlikview организовать по аналогии с остальными вместо qlikview/customer/@id   дать имена   qwprojects/qwproject/@customer-->
  <qvprojects />
  <!--<images>
    <image char="" name="link" />
    <image char="" name="dlink" rotate-flip="RotateNoneFlipY"/>
    <image char="" name="call"/>
    <image char="" name="column"/>
  </images>
  <eltypes>
    <eltype  name="vcall" image="call"/>
    <eltype  name="vlink" image="link"/>
    <eltype  name="vdink" image="dlink"/>
    <eltype  name="vcolumn" image="column"/>
  </eltypes>-->
  <fields child-name="field" key-name="id" />
  <actions child-name="action" key-name="name" />
  <navigators child-name="navigator" key-name="name" />
  <projects child-name="project" key-name="name" />
</root>