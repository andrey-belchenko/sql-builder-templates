<?xml version="1.0" encoding="utf-8"?>
<root>
  <queries>
    <query name="ur_dogplat_ext" class="1" timestamp="05.02.2020 23:20:55" extend="ur_dogplat">
      <select>
        <const type="number" as="cnt" fact="ur_dogplat_count" agg="sum">1</const>
        <!--<call function="if" as="kod_sogl">
          <call function="=">
            <column table="a" column="kod_sdp" />
            <const>3</const>
          </call>
          <column table="a" column="kod" />
        </call>-->
        <!--<call function="if" as="kod_pretenz">
          <call function="=">
            <column table="a" column="kod_sdp" />
            <const>4</const>
          </call>
          <column table="a" column="kod" />
        </call>-->
        <!--<call function="if" as="kod_mat" type="number">
          <call function="in">
            <column table="a" column="kod_sdp" />
            <array>6,13,14,15</array>
          </call>
          <column table="a" column="kod" />
        </call>-->
        <call function="if" as="kod_mat_pp" type="number">
          <call function="=">
            <column table="a" column="kod_sdp" />
            <const>6</const>
          </call>
          <column table="a" column="kod" />
        </call>
        <call function="if" as="kod_mat_ssp">
          <call function="=">
            <column table="a" column="kod_sdp" />
            <const>13</const>
          </call>
          <column table="a" column="kod" />
        </call>
        <call function="if" as="kod_mat_ip">
          <call function="=">
            <column table="a" column="kod_sdp" />
            <const>14</const>
          </call>
          <column table="a" column="kod" />
        </call>
        <call function="if" as="kod_mat_ba">
          <call function="=">
            <column table="a" column="kod_sdp" />
            <const>15</const>
          </call>
          <column table="a" column="kod" />
        </call>
        <!--<call function="if" as="kod_inkasso">
          <call function="=">
            <column table="a" column="kod_sdp" />
            <const>11</const>
          </call>
          <column table="a" column="kod" />
        </call>-->
        <!--<call function="if" as="kod_kazn">
          <call function="=">
            <column table="a" column="kod_sdp" />
            <const>12</const>
          </call>
          <column table="a" column="kod" />
        </call>-->
        <!--<call function="if" as="kod_stage_bk">
          <call function="=">
            <column table="a" column="kod_sdp" />
            <const>20</const>
          </call>
          <column table="a" column="kod" />
        </call>-->
        <!--<call function="if" as="kod_likvid">
          <call function="=">
            <column table="a" column="kod_sdp" />
            <const>30</const>
          </call>
          <column table="a" column="kod" />
        </call>-->
        <!--<call function="if" as="kod_dead">
          <call function="=">
            <column table="a" column="kod_sdp" />
            <const>37</const>
          </call>
          <column table="a" column="kod" />
        </call>-->
        <call function="coalesce" as="kod_folders" type="number" exclude="1">
          <column table="kod_sogl" column="kod_folders" />
          <column table="kod_pretenz" column="kod_folders" />
          <column table="kod_mat_pp" column="kod_folders" />
          <column table="kod_inkasso" column="kod_folders" />
          <column table="kod_kazn" column="kod_folders" />
          <column table="kod_mat_ssp" column="kod_folders" />
          <column table="kod_mat_ip" column="kod_folders" />
          <column table="kod_mat_ba" column="kod_folders" />
          <column table="kod_stage_bk" column="kod_folders" />
          <column table="kod_likvid" column="kod_folders" />
          <column table="kod_dead" column="kod_folders" />
        </call>
        <call function="if" as="has_no_prizn" agg="max" fact="ur_dp_has_no_priz" type="number">
          <call function="is null">
            <column table="this" column="sum_v" />
          </call>
          <const>1</const>
        </call>
        <call function="if" as="ym_min" agg="min" fact="ur_dogplat_ym_min" title="Период начисления с" type="number" format="F2">
          <call function="not in">
            <column table="this" column="vid_real" />
            <array>7,9</array>
          </call>
          <column table="this" column="ym" />
        </call>
        <call function="if" as="ym_max" agg="max" fact="ur_dogplat_ym_max" title="Период начисления по" type="number" format="F2">
          <call function="not in">
            <column table="this" column="vid_real" />
            <array>7,9</array>
          </call>
          <column table="this" column="ym" />
        </call>
        <call function="if" as="ym_all" agg="stragg" fact="ur_dogplat_ym_all" type="string" format="F2">
          <call function="not in">
            <column table="this" column="vid_real" />
            <array>7,9</array>
          </call>
          <column table="this" column="ym" />
        </call>
        <call function="ym to char" as="ym_str" fact="ur_dogplat_ym_str" agg="stragg" title="Период начисления">
          <column table="this" column="ym_min" />
        </call>
        <call function="if" as="ym_min_priz" agg="min" fact="ur_dp_ym_min_priz" type="number" title="Период начисления с (призн.)" format="F2">
          <call function="!=0">
            <column table="this" column="sum_v" />
          </call>
          <column table="this" column="ym_min" />
        </call>
        <call function="if" as="ym_max_priz" agg="max" fact="ur_dp_ym_max_priz" type="number" title="Период начисления по (призн.)" format="F2">
          <call function="!=0">
            <column table="this" column="sum_v" />
          </call>
          <column table="this" column="ym_max" />
        </call>
        <call function="case" type="string" as="name_doc">
          <call function="when">
            <call function="is not null">
              <column table="this" column="kod_sf" />
            </call>
            <column table="kod_sf" column="name" />
          </call>
          <call function="when">
            <call function="is not null">
              <column table="this" column="kod_deb" />
            </call>
            <column table="kod_deb" column="name" />
          </call>
          <call function="when">
            <call function="is not null">
              <column table="this" column="kod_izv" />
            </call>
            <column table="kod_izv" column="name" />
          </call>
        </call>
        <call function="coalesce" as="name_doc" title="Документ" exclude="1">
          <column table="kod_sf" column="name" />
          <column table="kod_deb" column="name" />
          <column table="kod_izv" column="name" />
        </call>
        <call function="coalesce" as="is_doc">
          <column table="this" column="kod_sf" />
          <column table="this" column="kod_deb" />
          <column table="this" column="kod_izv" />
        </call>
        <column table="ur_hist_mat_dec" column="dat_entry_st" dgroup="max" dimension="dat_ur" />
        <column table="ur_hist_mat_dec" column="dat_entry_dec" dgroup="max" dimension="dat_ur_ent" />
        <call function="if" agg="min" fact="ur_dp_pr_sch_gp" type="number" title="Признак наличия счета на ГП" as="pr_sch_gp" controlType="UICheck">
          <call function="=">
            <column table="this" column="vid_real" />
            <const>9</const>
          </call>
          <const>1</const>
        </call>
        <call function="if" as="pr_sch_peni" agg="min" fact="ur_dp_pr_sch_peni" type="number" title="Признак наличия счета на проценты(пени)" controlType="UICheck">
          <call function="and">
            <call function="=">
              <column table="this" column="vid_real" />
              <const>7</const>
            </call>
            <call function="=1" exclude="1">
              <column table="this" column="prizn_konv" />
            </call>
          </call>
          <const>1</const>
        </call>
        <call function="if" as="pr_sch_shtr" agg="min" fact="ur_dp_pr_sch_shtr" type="number" title="Признак наличия счета на штраф" controlType="UICheck">
          <call function="and">
            <call function="=">
              <column table="this" column="vid_real" />
              <const>4</const>
            </call>
          </call>
          <const>1</const>
        </call>
        <call function="if" agg="min" fact="ur_dp_dat_sch_gp" type="date" title="Дата формирования счета на ГП" as="dat_sch_gp">
          <call function="=">
            <column table="this" column="vid_real" />
            <const>9</const>
          </call>
          <column table="this" column="dat_form" />
        </call>
        <call function="if" agg="min" fact="ur_dp_dat_sch_shtr" type="date" title="Дата формирования счета на штраф" as="dat_sch_shtr">
          <call function="=">
            <column table="this" column="vid_real" />
            <const>4</const>
          </call>
          <column table="this" column="dat_form" />
        </call>
        <call function="if" agg="min" fact="ur_dp_dat_sch_pn" type="date" title="Дата формирования счета на проценты(пени)" as="dat_sch_pn">
          <call function="=">
            <column table="this" column="vid_real" />
            <const>7</const>
          </call>
          <column table="this" column="dat_form" />
        </call>
        <call function="nvl" as="kod_sf2">
          <column table="a" column="kod_sf" />
          <column table="a" column="kod_sf_dp" />
        </call>
        <call function="if" as="ym_min_mat" format="F2" type="number" title="Период начисления с (для материалов дела)" is-fact="1" agg="min" fact="ur_dp_ym_min_mat">
          <call function="is not null">
            <column table="a" column="kod_mat" />
          </call>
          <column table="this" column="ym_min" />
        </call>
        <call function="if" as="ym_max_mat" format="F2" type="number" title="Период начисления по (для материалов дела)" is-fact="1" agg="max" fact="ur_dp_ym_max_mat">
          <call function="is not null">
            <column table="a" column="kod_mat" />
          </call>
          <column table="this" column="ym_max" />
        </call>
        <call function="if" type="string" as="sum_v_valid">
          <call function="gt">
            <column table="this" column="sum_v" />
            <column table="this" column="summa" />
          </call>
          <const>'Признанная сумма больше предъявленной.'</const>
        </call>
        <!--<call function="coalesce" as="kod_fin_doc">
          <column table="this" column="kod_sf" />
          <column table="this" column="kod_deb" />
          <column table="this" column="kod_izv" />
        </call>
        <call function="if" as="is_fin_doc" fact="ur_dp_is_fin_doc" agg="max">
          <call function="is not null">
            <column table="this" column="kod_fin_doc" />
          </call>
          <const>1</const>
        </call>-->
      </select>
      <from>
        <query name="ur_sogl" as="kod_sogl" join="left outer" dimension="kod_sogl">
          <call function="=">
            <column table="this" column="kod_sogl" />
            <column table="kod_sogl" column="kod_sogl" />
          </call>
        </query>
        <query name="ur_pretenz" as="kod_pretenz" join="left outer" dimension="kod_pretenz">
          <call function="=">
            <column table="a" column="kod_pretenz" />
            <column table="kod_pretenz" column="kod_pretenz" />
          </call>
        </query>
        <query name="ur_mat" dname="ur_dogplat" as="kod_mat" join="left outer" dimension="kod_mat">
          <call function="=">
            <column table="this" column="kod_mat" />
            <column table="kod_mat" column="kod_mat" />
          </call>
        </query>
        <query name="ur_mat" dname="ur_dogplat_pp" as="kod_mat_pp" join="left outer" comment="Претензионно-исковая работа">
          <call function="=">
            <column table="this" column="kod_mat_pp" />
            <column table="kod_mat_pp" column="kod_mat" />
          </call>
        </query>
        <query name="ur_inkasso" as="kod_inkasso" join="left outer">
          <call function="=">
            <column table="this" column="kod_inkasso" />
            <column table="kod_inkasso" column="kod_inkasso" />
          </call>
        </query>
        <query name="ur_kazn" as="kod_kazn" join="left outer">
          <call function="=">
            <column table="this" column="kod_kazn" />
            <column table="kod_kazn" column="kod_kazn" />
          </call>
        </query>
        <query name="ur_mat" dname="ur_dogplat_ssp" as="kod_mat_ssp" join="left outer" comment="ССП">
          <call function="=">
            <column table="this" column="kod_mat_ssp" />
            <column table="kod_mat_ssp" column="kod_mat" />
          </call>
        </query>
        <query name="ur_mat" dname="ur_dogplat_ip" as="kod_mat_ip" join="left outer" comment="Исполнительное производство">
          <call function="=">
            <column table="this" column="kod_mat_ip" />
            <column table="kod_mat_ip" column="kod_mat" />
          </call>
        </query>
        <query name="ur_mat" dname="ur_dogplat_ba" as="kod_mat_ba" join="left outer" comment="Банкротство">
          <call function="=">
            <column table="this" column="kod_mat_ba" />
            <column table="kod_mat_ba" column="kod_mat" />
          </call>
        </query>
        <query name="ur_stage_bk" as="kod_stage_bk" join="left outer">
          <call function="=">
            <column table="this" column="kod_stage_bk" />
            <column table="kod_stage_bk" column="kod_stage_bk" />
          </call>
        </query>
        <query name="ur_likvid" as="kod_likvid" join="left outer">
          <call function="=">
            <column table="this" column="kod_likvid" />
            <column table="kod_likvid" column="kod_likvid" />
          </call>
        </query>
        <query name="ur_dead" as="kod_dead" join="left outer">
          <call function="=">
            <column table="this" column="kod_dead" />
            <column table="kod_dead" column="kod_dead" />
          </call>
        </query>
        <query name="kr_dogovor" as="kod_dog" join="left outer" dimension="kod_dog" allow-back-reference="1">
          <call function="=">
            <column table="a" column="kod_dog" />
            <column table="kod_dog" column="kod_dog" />
          </call>
        </query>
        <query name="ur_folders" as="kod_folders" join="left outer" dimension="kod_folders">
          <call function="=">
            <column table="a" column="kod_folders" />
            <column table="kod_folders" column="kod_folders" />
          </call>
        </query>
      </from>
      <actions>
        <action action-type="client-update" call="ur_dogplat-sum-upd" name="recalc_sum" title="Пересчитать задолженность" />
        <action action-type="client-update" call="ur_dogplat-sum_v-upd" name="set_sum_v" title="Признан полностью" />
        <action action-type="client-update" call="ur_dogplat-sum_v-to-zero" name="set_sum_v_zero" title="Не признан" />
        <action action-type="client-add-by-form" call="editor-ur_mat" name="form_select" exclude="1" />
        <action action-type="dynamic-form" call="ur_dogplat_hand" name="form_hand" exclude="1" />
        <uicommand action-type="dynamic-form-create-multiple" call="ur_dogplat_select" name="select_sf">
          <useparam name="p_kod" />
          <useparam name="p_kod_sdp" />
          <useparam name="kodp" />
        </uicommand>
        <uicommand action-type="dynamic-form-create-multiple" call="ur_dogplat_select_pd" name="select_pd">
          <useparam name="p_kod" />
          <useparam name="p_kod_sdp" />
          <useparam name="kodp" />
        </uicommand>
        <uicommand action-type="dynamic-form-create-multiple" call="ur_dogplat_select_izv" name="select_izv">
          <useparam name="p_kod" />
          <useparam name="p_kod_sdp" />
          <useparam name="kodp" />
        </uicommand>
        <uicommand action-type="dynamic-form" call="ur_dogplat_opl_view" name="opl_view">
          <useparam name="p_kod_dogplat" />
        </uicommand>
      </actions>
      <links>
        <link name="kod_deb_sf" as="kod_deb_sf1">
          <link name="kod_sf" dimension="1" as="kod_sf1">
            <dlink name="sr_opl" dimension="1" />
            <dimlink name="kod_deb" dimension="1" is-final-dimension="1" is-private-dimension="1" />
            <dimlink name="ym_vozn" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          </link>
        </link>
        <link name="kod_izv" as="kod_izv1">
          <link name="kod_dog" />
        </link>
        <link name="kod_mat" as="kod_mat1">
          <dlink name="ur_mat_pp" dimension="1" is-final-dimension="1" is-private-dimension="1">
            <dimlink name="kod_hist_mat" dimension="1" is-final-dimension="1" is-private-dimension="1" />
            <dimlink name="kod_hist_mat_dec" dimension="1" is-final-dimension="1" is-private-dimension="1" />
            <dimlink name="kod_isp" dimension="1" is-final-dimension="1" is-private-dimension="1" />
            <dimlink name="kod_folders_isp" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          </dlink>
          <dlink name="ur_mat_ba" dimension="1" is-final-dimension="1" is-private-dimension="1">
            <dimlink name="kod_hist_mat_ba" dimension="1" is-final-dimension="1" is-private-dimension="1" />
            <dimlink name="kod_hist_mat_dec_ba" dimension="1" is-final-dimension="1" is-private-dimension="1" />
            <dimlink name="kod_folders_ba" dimension="1" is-final-dimension="1" is-private-dimension="1" />
            <dimlink name="kod_stage_bk" is-private-dimension="1" is-final-dimension="1" dimension="1" />
            <dimlink name="kod_hist_mat_dec" dimension="1" is-final-dimension="1" is-private-dimension="1" exclude="1" />
            <dimlink name="kod_isp" dimension="1" is-final-dimension="1" is-private-dimension="1" exclude="1" />
            <dimlink name="kod_folders_isp" dimension="1" is-final-dimension="1" is-private-dimension="1" exclude="1" />
          </dlink>
          <dlink name="ur_hist_mat" comment="поменятл местами c dec, может сломаться арбитраж">
            <dlink name="ur_hist_mat_dec">
              <dlink name="ur_graf" dimension="kod_graf" is-final-dimension="1" exclude="1" />
              <dlink name="ur_isp" exclude="1">
                <dlink name="ur_folders_isp" />
                <dlink name="ur_graf" as="ur_graf1" dimension="kod_graf" is-final-dimension="1" />
              </dlink>
            </dlink>
          </dlink>
        </link>
        <link name="kod_sogl" as="kod_sogl1" exclude="1">
          <dlink name="ur_graf" as="ur_graf2" dimension="kod_graf" is-final-dimension="1" />
        </link>
        <link name="kod_folders" as="kod_folders1">
          <dimlink name="kod_dep" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kodp" dimension="1" is-final-dimension="1" is-private-dimension="1" />
        </link>
        <dlink name="ur_dp_isp" dimension="1">
          <dimlink name="kod_mat_isp" dimension="1" is-private-dimension="1" is-final-dimension="1" />
          <dimlink name="kod_hist_mat_isp" dimension="1" is-private-dimension="1" is-final-dimension="1" />
        </dlink>
        <dlink name="ur_dp_inkasso" dimension="1">
          <dimlink name="kod_inkasso" dimension="1" is-final-dimension="1" is-private-dimension="1" />
        </dlink>
        <dlink name="ur_dp_kazn" dimension="1">
          <dimlink name="kod_kazn" dimension="1" is-final-dimension="1" is-private-dimension="1" />
        </dlink>
        <dlink name="ur_dp_isp_other" dimension="1">
          <dimlink name="kod_isp_other" dimension="1" is-final-dimension="1" is-private-dimension="1" />
        </dlink>
        <dlink name="ur_dp_graf" dimension="1">
          <dimlink name="kod_graf" dimension="1" is-final-dimension="1" />
        </dlink>
        <dimlink name="kod_graf" exclude="1">
          <dimlink name="kod_graf_opl" dimension="1" is-final-dimension="1" is-private-dimension="1" />
        </dimlink>
      </links>
    </query>
    <query name="ur_dogplat_kodps">
      <params>
        <param name="kod_podr" type="number" />
      </params>
      <select>
        <call function="distinct" as="kodp">
          <column table="kr_dogovor_a" column="kodp" />
        </call>
      </select>
      <from>
        <query name="ur_dogplat" as="ur_dogplat_a">
          <link name="kod_dog" as="kr_dogovor_a" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="ur_dogplat_a" column="kod_sdp" />
            <const>4</const>
          </call>
          <call function="=">
            <column table="kr_dogovor_a" column="tep_el" />
            <const>4</const>
          </call>
          <call function="=">
            <column table="kr_dogovor_a" column="podr" />
            <useparam name="kod_podr" />
          </call>
        </call>
      </where>
    </query>
    <query name="prizn_zadol_dogplat">
      <select>
        <column table="a" column="kod" as="kod_prizn_zadol_dogplat" type="number" />
        <column table="a" column="name" as="name_prizn_zadol_dogplat" type="string" title="Наличие задолженности" vid="1" />
      </select>
      <from>
        <table name="prizn_zadol_dogplat_view" view="1" as="a"></table>
      </from>
    </query>
    <query name="un_dogplat_test">
      <select>
        <column table="a" column="row_type" type="string" />
        <column table="a" column="kod_abon_type" type="number" />
        <column table="a" column="dep" type="number" />
        <column table="a" column="kodp" type="number" />
        <column table="a" column="kod_dog" type="number" />
        <!--Документ-->
        <column table="a" column="kod_folders" />
        <column table="a" column="kod_sogl" />
        <column table="a" column="kod_pretenz" />
        <column table="a" column="kod_mat_pp" />
        <column table="a" column="kod_inkasso" />
        <column table="a" column="kod_kazn" />
        <column table="a" column="kod_mat_ssp" />
        <column table="a" column="kod_mat_ip" />
        <column table="a" column="kod_mat_ba" />
        <column table="a" column="kod_stage_bk" />
        <column table="a" column="kod_likvid" />
        <column table="a" column="kod_dead" />
        <!--Связь-->
        <column table="a" column="kod_dogplat" type="number" />
        <column table="a" column="kod_sdp" type="number" />
        <column table="a" column="kod" type="number" />
        <column table="a" column="vid_real" type="number" />
        <column table="a" column="dat_form" type="date" />
        <column table="a" column="kod_izv" type="number" />
        <column table="a" column="kod_sf" type="number" />
        <column table="a" column="kod_deb" type="number" />
        <column table="a" column="dat_izv" type="number" />
        <column table="a" column="dat_sf" type="number" />
        <column table="a" column="dat_deb" type="number" />
        <column table="a" column="ym" type="number" />
        <!--Начисления-->
        <column table="a" column="kod_account" type="number" />
        <column table="a" column="kod_ras" type="number" />
        <column table="a" column="vid_t" type="number" />
        <column table="a" column="dat_priem" type="date" />
        <column table="a" column="ym_nach" type="number" />
        <!--Оплаты-->
        <column table="a" column="kod_opl_fl" type="number" />
        <column table="a" column="kod_opl_ul" type="number" />
        <column table="a" column="dat_deb_bank" type="date" />
        <column table="a" column="dat_opl_bank" type="date" />
        <column table="a" column="dat_bal" type="date" />
        <column table="a" column="dat_opl" type="date" />
        <column table="a" column="ym_opl" type="number" />
        <column table="a" column="sum_gp_otv" type="number" />
        <column table="a" column="summa" type="number" />
        <column table="a" column="sum_v" type="number" />
        <column table="a" column="pr_recalc_opl" type="number" />
        <column table="a" column="un_sogl" />
        <column table="a" column="un_pretenz" />
        <column table="a" column="un_mat_pp" />
        <column table="a" column="un_hist_mat_pp" />
        <column table="a" column="un_isp_pp" />
        <column table="a" column="un_inkasso" />
        <column table="a" column="un_kazn" />
        <column table="a" column="un_mat_ssp" />
        <column table="a" column="un_mat_ip" />
        <column table="a" column="un_mat_ba" />
        <column table="a" column="un_stage_bk" />
        <column table="a" column="un_likvid" />
        <column table="a" column="un_dead" />
        <column table="a" column="nachisl" />
        <column table="a" column="opl" />
      </select>
      <from>
        <query name="un-dogplat" as="a">
          <extendwhere>
            <!--<call function="=">
              <column table="*" column="row_type" />
              <const>'mat-pp'</const>
            </call>-->
            <!--<call function="=">
              <column table="*" column="kod_folders" />
              <const>1000000882</const>
            </call>-->
            <call function="=">
              <column table="*" column="kod_mat_pp" />
              <const>118</const>
            </call>
          </extendwhere>
        </query>
      </from>
      <!--<where>
        <call function="=">
          <column table="a" column="kod_mat_pp"/>
          <const>8477</const>
        </call>
      </where>-->
    </query>
    <query name="ur_dogplat_default" extend="ur_dogplat" class="1" timestamp="04.02.2016 16:10:11">
      <select>
        <const as="kod_sdp_6" type="number">6</const>
        <column table="kod_sf" column="vid_real" as="sf_vid_real" />
      </select>
    </query>
    <query name="ur_dogplat_insert_sf" class="1" update-target="ur_dogplat" timestamp="16.01.2018 16:54:01">
      <params>
        <param name="kod_sdp" type="number" />
        <param name="kod" type="number" />
        <param name="kod_sf" type="number" />
        <param name="summa" type="number" />
        <param name="dat" type="date" />
        <param name="summa_prizn" type="number" />
        <param name="is_auto" type="number" />
      </params>
      <select>
        <call function="()" as="kod_sdp">
          <useparam name="kod_sdp" />
        </call>
        <call function="()" as="kod">
          <useparam name="kod" />
        </call>
        <call function="nvl0" as="summa" comment="nvl0 16.01.18">
          <useparam name="summa" />
        </call>
        <call function="()" as="sum_v">
          <useparam name="summa_prizn" />
        </call>
        <call function="()" as="dat_form">
          <useparam name="dat" />
        </call>
        <call function="()" as="prizn_konv">
          <useparam name="is_auto" />
        </call>
        <column table="a" column="kod_sf" />
        <column table="a" column="vid_real" />
      </select>
      <from>
        <query name="sr_facvip" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="kod_sf" />
          <useparam name="kod_sf" />
        </call>
      </where>
    </query>
    <query name="ur_dogplat_insert_pd" class="1" update-target="ur_dogplat" timestamp="16.01.2018 16:52:47">
      <params>
        <param name="kod_sdp" type="number" />
        <param name="kod" type="number" />
        <param name="kod_deb" type="number" />
        <param name="summa" type="number" />
        <param name="dat" type="date" />
        <param name="summa_prizn" type="number" />
        <param name="is_auto" type="number" />
        <param name="kod_sf_dp" type="number" comment="kod_sf первого счета в платежке" />
      </params>
      <select>
        <call function="()" as="kod_sdp">
          <useparam name="kod_sdp" />
        </call>
        <call function="()" as="kod">
          <useparam name="kod" />
        </call>
        <call function="nvl0" as="summa">
          <useparam name="summa" />
        </call>
        <call function="()" as="sum_v">
          <useparam name="summa_prizn" />
        </call>
        <call function="()" as="dat_form">
          <useparam name="dat" />
        </call>
        <call function="()" as="prizn_konv">
          <useparam name="is_auto" />
        </call>
        <call function="()" as="kod_sf_dp">
          <useparam name="kod_sf_dp" />
        </call>
        <column table="a" column="kod_deb" />
        <fact column="sf_vid_real" as="vid_real" />
      </select>
      <from>
        <query name="sr_debet" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="kod_deb" />
          <useparam name="kod_deb" />
        </call>
      </where>
    </query>
    <query name="ur_dogplat_insert_izv" class="1" update-target="ur_dogplat" timestamp="16.01.2018 16:53:18">
      <params>
        <param name="kod_sdp" type="number" />
        <param name="kod" type="number" />
        <param name="kod_izv" type="number" />
        <param name="summa" type="number" />
        <param name="dat" type="date" />
      </params>
      <select>
        <call function="()" as="kod_sdp">
          <useparam name="kod_sdp" />
        </call>
        <call function="()" as="kod">
          <useparam name="kod" />
        </call>
        <call function="nvl0" as="summa">
          <useparam name="summa" />
        </call>
        <call function="()" as="dat_form">
          <useparam name="dat" />
        </call>
        <column table="a" column="kod_izv" />
        <fact column="tnr_acc_vid_real" as="vid_real" />
      </select>
      <from>
        <query name="tnr_izv" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="kod_izv" />
          <useparam name="kod_izv" />
        </call>
      </where>
    </query>
    <query name="ur_dogplat_bnk" class="1" timestamp="02.06.2017 17:56:08" inherit="ur_dogplat">
      <select>
        <column table="a" column="kod_dog" is-final-dimension="1" dimension="kod_dog" is-private-dimension="1" as="kod_dog_bnk" />
        <column table="a" column="vid_real" is-final-dimension="1" dimension="vid_real" is-private-dimension="1" as="vid_real_bnk" />
      </select>
      <from>
        <query name="ur_mat_ba" as="kod_mat_bnk" join="left outer" comment="Банкротство">
          <call function="=">
            <column table="a" column="kod_mat" />
            <column table="kod_mat_bnk" column="kod_mat" />
          </call>
        </query>
      </from>
      <links>
        <link name="kod_deb_sf" as="kod_deb_sf2">
          <link name="kod_sf" dimension="1" as="kod_sf2" is-final-dimension="1" is-private-dimension="1">
            <dimlink name="kod_deb" dimension="1" is-final-dimension="1" is-private-dimension="1" />
            <dimlink name="ym_vozn" dimension="1" is-final-dimension="1" is-private-dimension="1" />
            <dimlink name="kod_dogplat" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          </link>
        </link>
      </links>
    </query>
    <query name="ur_dogplat-sum-upd" timestamp="29.07.2016 19:50:56">
      <params>
        <param name="kod_dogplat" type="number" class-type="ur_dogplat" />
        <param name="dat" type="date" />
      </params>
      <select>
        <call function="if" as="dat_form">
          <call function="is not null">
            <column table="ur_dogplat" column="is_doc" />
          </call>
          <useparam name="dat" />
          <const>null</const>
        </call>
        <call function="if" as="summa">
          <call function="is not null">
            <column table="ur_dogplat" column="is_doc" />
          </call>
          <fact column="fin_ul_ob_on_date" title="Посроченная задолженность">
            <withparams>
              <useparam name="dat" />
            </withparams>
          </fact>
          <column table="ur_dogplat" column="summa" />
        </call>
      </select>
      <from>
        <query name="ur_dogplat" />
      </from>
      <where>
        <call function="=">
          <column table="ur_dogplat" column="kod_dogplat" />
          <useparam name="kod_dogplat" />
        </call>
      </where>
    </query>
    <query name="ur_dogplat-sum_v-upd" timestamp="27.05.2016 21:11:10">
      <params>
        <param name="kod_dogplat" type="number">
          <const>1</const>
        </param>
        <param name="dat" type="date" />
      </params>
      <select>
        <fact column="ur_dolg_on_dat" as="sum_v">
          <withparams>
            <useparam name="dat" />
          </withparams>
        </fact>
        <column table="ur_dogplat" column="kod_dogplat" />
      </select>
      <from>
        <qube>
          <link name="kod_dogplat" as="ur_dogplat" />
          <where>
            <call function="=">
              <column table="ur_dogplat" column="kod_dogplat" />
              <useparam name="kod_dogplat" />
            </call>
          </where>
        </qube>
      </from>
    </query>
    <query name="ur_dogplat-sum_v-to-zero" timestamp="27.05.2016 21:03:52">
      <params>
        <param name="kod_dogplat" type="number">
          <const>1</const>
        </param>
      </params>
      <select>
        <const as="sum_v" type="number">0</const>
        <column table="ur_dogplat" column="kod_dogplat" />
      </select>
      <from>
        <qube>
          <link name="kod_dogplat" as="ur_dogplat" all-rows="1" />
          <where>
            <call function="=">
              <column table="ur_dogplat" column="kod_dogplat" />
              <useparam name="kod_dogplat" />
            </call>
          </where>
        </qube>
      </from>
    </query>
  </queries>
  <views>
    <view name="prizn_zadol_dogplat_view">
      select 0 as kod, 'Нет' as name from dual union
      select 1, 'Есть' from dual
    </view>
  </views>
  <expression-packages>
    <expression-package name="ur_dogplat" class="1" timestamp="09.03.2025 12:28:38">
      <call function="if" as="ur_dp_vist_or_priz" type="number" title="Сумма по юр. док." group="sum">
        <call function="is null">
          <column table="kod_hist_mat_dec" column="dat_post" />
        </call>
        <fact column="ur_dp_summa" />
        <fact column="ur_dp_sum_v" />
      </call>
      <call function="if" as="ur_dp_vist_or_priz_osn" type="number" group="sum">
        <call function="=">
          <column table="kod_dogplat" column="vid_real" />
          <const>2</const>
        </call>
        <fact column="ur_dp_vist_or_priz" />
      </call>
      <call function="if" as="ur_dp_vist_or_priz_peni" type="number" group="sum">
        <call function="=">
          <column table="kod_dogplat" column="vid_real" />
          <const>7</const>
        </call>
        <fact column="ur_dp_vist_or_priz" />
      </call>
      <call function="if" as="ur_dp_vist_or_priz_gp" type="number" group="sum">
        <call function="=">
          <column table="kod_dogplat" column="vid_real" />
          <const>9</const>
        </call>
        <fact column="ur_dp_vist_or_priz" />
      </call>
      <call function="if" as="ur_dp_sum_osn" type="number" title="Выст. по юр. док. осн. реал." group="sum">
        <call function="=">
          <column table="kod_dogplat" column="vid_real" />
          <const>2</const>
        </call>
        <fact column="ur_dp_summa" />
      </call>
      <call function="if" as="ur_dp_sum_peni" type="number" title="Выст. по юр. док. пени" group="sum">
        <call function="=">
          <column table="kod_dogplat" column="vid_real" />
          <const>7</const>
        </call>
        <fact column="ur_dp_summa" />
      </call>
      <call function="if" as="ur_dp_sum_shtr" type="number" title="Выст. по юр. док. штрафы" group="sum">
        <call function="=">
          <column table="kod_dogplat" column="vid_real" />
          <const>4</const>
        </call>
        <fact column="ur_dp_summa" />
      </call>
      <call function="if" as="ur_dp_sum_all" type="number" title="Выст. по юр. док. всего" group="sum">
        <call function="!=">
          <column table="kod_dogplat" column="vid_real" />
          <const>9</const>
        </call>
        <fact column="ur_dp_summa" />
      </call>
      <call as="ur_dp_priz_all" type="number" title="Призн. по юр. док. всего" group="sum" function="()">
        <fact column="ur_dp_sum_v" />
      </call>
      <call as="ur_dp_priz_all_ba" type="number" title="Призн. по юр. док. всего" function="+nvl" agg="sum">
        <fact column="ur_dp_sum_v" />
        <fact column="ur_hist_mat_ba_gp_ba" exclude="1" />
        <fact column="ur_hist_mat_ba_ogr_ba" />
      </call>
      <call function="if" as="ur_dp_priz_all" type="number" title="Призн. по юр. док. всего" group="sum" exclude="1">
        <call function="!=">
          <column table="kod_dogplat" column="vid_real" />
          <const>9</const>
        </call>
        <fact column="ur_dp_sum_v" />
      </call>
      <call function="if" as="ur_dp_priz_osn" type="number" title="Призн. по юр. док. осн. реал." group="sum">
        <call function="=">
          <column table="kod_dogplat" column="vid_real" />
          <const>2</const>
        </call>
        <fact column="ur_dp_sum_v" />
      </call>
      <call function="if" as="ur_dp_priz_shtr" type="number" title="Призн. по юр. док. штрафы" group="sum">
        <call function="=">
          <column table="kod_dogplat" column="vid_real" />
          <const>4</const>
        </call>
        <fact column="ur_dp_sum_v" />
      </call>
      <call function="if" as="ur_dp_priz_peni" type="number" title="Призн. по юр. док. пени" group="sum">
        <call function="=">
          <column table="kod_dogplat" column="vid_real" />
          <const>7</const>
        </call>
        <fact column="ur_dp_sum_v" />
      </call>
      <call function="if" as="ur_dp_priz_gp" type="number" title="Призн. по юр. док. гп" group="sum">
        <call function="=">
          <column table="kod_dogplat" column="vid_real" />
          <const>9</const>
        </call>
        <fact column="ur_dp_sum_v" />
      </call>
      <call function="if" as="ur_dp_for_doc_cnt" type="number" title="Наличие привязки по указанному документу" group="sum">
        <params>
          <param name="kod" />
          <param name="kod_sdp" />
        </params>
        <call function="and">
          <call function="=">
            <column table="kod_dogplat" column="kod" />
            <useparam name="kod" />
          </call>
          <call function="=">
            <column table="kod_dogplat" column="kod_sdp" />
            <useparam name="kod_sdp" />
          </call>
        </call>
        <fact column="ur_dogplat_count" />
      </call>
      <call function="if" as="ur_dp_isp_for_ur_dp_cnt" type="number" title="Наличие привязки по указанному документу" group="sum">
        <params>
          <param name="kod_mat_isp" />
        </params>
        <call function="=">
          <column table="kod_dp_isp" column="kod_mat" />
          <useparam name="kod_mat_isp" />
        </call>
        <fact column="ur_dp_isp_count" />
      </call>
      <call function="if" as="ur_dp_inkasso_for_ur_dp_cnt" type="number" title="Наличие привязки по указанному документу" group="sum">
        <params>
          <param name="kod_inkasso" />
        </params>
        <call function="=">
          <column table="kod_dp_inkasso" column="kod_inkasso" />
          <useparam name="kod_inkasso" />
        </call>
        <fact column="ur_dp_inkasso_count" />
      </call>
      <call function="if" as="ur_dp_graf_for_ur_dp_cnt" type="number" title="Наличие привязки по указанному документу" group="sum">
        <params>
          <param name="kod_graf" />
        </params>
        <call function="=">
          <column table="kod_dp_graf" column="kod_graf" />
          <useparam name="kod_graf" />
        </call>
        <fact column="ur_dp_graf_count" />
      </call>
      <call function="if" as="ur_dp_kazn_for_ur_dp_cnt" type="number" title="Наличие привязки по указанному документу" group="sum">
        <params>
          <param name="kod_kazn" />
        </params>
        <call function="=">
          <column table="kod_dp_kazn" column="kod_kazn" />
          <useparam name="kod_kazn" />
        </call>
        <fact column="ur_dp_kazn_count" />
      </call>
      <call function="if" as="ur_dp_isp_other_for_ur_dp_cnt" type="number" title="Наличие привязки по указанному документу" group="sum">
        <params>
          <param name="kod_isp_other" />
        </params>
        <call function="=">
          <column table="kod_dp_isp_other" column="kod_isp_other" />
          <useparam name="kod_isp_other" />
        </call>
        <fact column="ur_dp_isp_other_count" />
      </call>
      <call function="if" as="ur_dp_priz_vld" type="string" group="max" title="Валидация (наличие признанных сумм по решению)">
        <call function="and">
          <call function="gt" exclude="1" comment="убрал, наверное случайно осталось">
            <fact column="ur_hist_mat_dec_othr_cnt" />
            <const>0</const>
          </call>
          <call function="gt">
            <fact column="ur_dp_has_no_priz" />
            <const>0</const>
          </call>
        </call>
        <const>'Должны быть заполнены суммы по решению суда'</const>
      </call>
      <call function="if" as="ur_dp_exists_vld" type="string" group="max" title="Валидация (наличие привязанных документов)">
        <call function="!=0">
          <fact column="ur_dogplat_count" />
        </call>
        <const>'Есть суммы по документу'</const>
      </call>
    </expression-package>
  </expression-packages>
</root>