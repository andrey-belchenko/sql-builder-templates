<?xml version="1.0" encoding="utf-8"?>
<root>
  <dimension-packages>
    <dimension-package name="49277" timestamp="16.03.2021 01:53:24">
      <dimension name="d49277_kod_fl" class-type="vr_rb_filial" />
      <dimension name="d49277_bal_id" class-type="vr_rb_pwrc" />
      <dimension name="d49277_pwrc" class-type="vr_rb_pwrc_g" />
      <dimension class-type="vr_rb_fider" name="d49277_fdrid" />
      <dimension class-type="vr_rb_fact" name="d49277_vr_rb_fact" />
      <dimension name="d49277_kod_fl_real" class-type="sqlb_d45862_fl_ym_tbl" />
      <dimension name="id_dat" class-type="vr_rb_dat" />
      <dimension name="def_pwrc" class-type="vb_rb_default_pwrc" />
      <dimension name="def_fdr" class-type="vb_rb_default_fdr" />
      <dimension name="grid_dtl_hist_kg" class-type="vr_rb_eq_kg" />
      <dimension time-type="number" name="ym" exclude="1" />
      <dimension class-type="vr_rb_fact_fider" name="d49277_fact_fider" exclude="1" />
      <dimension class-type="vr_rb_fact_tu" name="d49277_fact_tu" exclude="1" />
      <dimension class-type="vr_rb_fact_tp_all" name="d49277_fact_tp_all" exclude="1" />
      <dimension class-type="vr_rb_fact_tp" name="d49277_fact_tp" exclude="1" />
      <dimension class-type="f53605_rr_temp" name="rep_53605_rr_temp" />
    </dimension-package>
  </dimension-packages>
  <queries>
    <query name="main_49277" timestamp="02.10.2018 17:12:30">
      <select>
        <call as="count_fdr" group="sum" function="()" type="number">
          <const>1</const>1</call>
        <column table="d49277_kod_fl" column="kod_fl" />
        <column table="d49277_pwrc" column="pwrc_id" />
        <column table="d49277_fdrid" column="pwrc_fdrid" />
        <column table="d49277_kod_fl" column="name" as="fskname" group="max" title="Филиал" />
        <column table="d49277_pwrc" column="pwrcname" group="max" title="ДИСП №ПС" />
        <column table="d49277_fdrid" column="pwrc_fdrname" group="max" title="ДИСП №ФИД" />
        <fact column="vr_rb_fact_wp_in_fdr" as="wp_in_st1" group="sum" table="stage1" />
        <fact column="vr_rb_fact_wp_out_fdr" as="wp_out_st1" group="sum" table="stage1" />
        <call function="case" as="neb_st1" group="outer" nullif="0">
          <call function="when">
            <call function="=0">
              <column column="wp_in_st1" table="this" />
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="round">
                <call function="/">
                  <call function="-">
                    <column column="wp_in_st1" table="this" />
                    <column column="wp_out_st1" table="this" />
                  </call>
                  <column column="wp_in_st1" table="this" />
                </call>
                <const>6</const>
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <fact column="vr_rb_fact_wp_in_fdr" as="wp_in_st2" group="sum" table="stage2" />
        <fact column="vr_rb_fact_wp_out_fdr" as="wp_out_st2" group="sum" table="stage2" />
        <call function="case" as="neb_st2" group="outer" nullif="0">
          <call function="when">
            <call function="=0">
              <column column="wp_in_st2" table="this" />
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="round">
                <call function="/">
                  <call function="-">
                    <column column="wp_in_st2" table="this" />
                    <call function="nvl0">
                      <column column="wp_out_st2" table="this" />
                    </call>
                  </call>
                  <column column="wp_in_st2" table="this" />
                </call>
                <const>6</const>
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <fact column="vr_rb_fact_wp_in_fdr" as="wp_in" group="sum" table="main" />
        <fact column="vr_rb_fact_wp_out_fdr" as="wp_out" group="sum" table="main" />
        <call function="case" as="neb" group="outer" nullif="0">
          <call function="when">
            <call function="=0">
              <column column="wp_in" table="this" />
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="/">
                <call function="-">
                  <column column="wp_in" table="this" />
                  <call function="nvl0">
                    <column column="wp_out" table="this" />
                  </call>
                </call>
                <column column="wp_in" table="this" />
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <fact table="stage2" column="vr_rb_fact_count_tp" group="sum" as="tp_st2" nullif="0" />
        <fact table="main" column="vr_rb_fact_count_tp" group="sum" as="tp" nullif="0" exclude="1" />
        <fact table="main" column="vr_rb_fact_count_tp_le" group="sum" as="tp_le" nullif="0" />
        <fact table="main" column="vr_rb_fact_count_tp_potr" group="sum" as="tp_potr" nullif="0" />
        <call group="sum" as="tp_dif_1w" function="-" nullif="0">
          <fact table="main" column="vr_rb_fact_count_tp" />
          <fact table="prev_week" column="vr_rb_fact_count_tp" />
        </call>
        <call as="tp_0null_st2" function="+" group="sum" nullif="0">
          <fact column="vr_rb_fact_count_tp_0" table="stage2" />
          <fact column="vr_rb_fact_count_tp_null" table="stage2" />
        </call>
        <fact column="vr_rb_fact_count_tp_le_0null" group="sum" as="tp_le_0null" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tp_potr_0" group="sum" as="tp_potr_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tp_potr_null" group="sum" as="tp_potr_null" table="main" nullif="0" />
        <call function="-" group="sum" as="tp_0null_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tp_le_0null" table="main" />
            <fact column="vr_rb_fact_count_tp_potr_0" table="main" />
            <fact column="vr_rb_fact_count_tp_potr_null" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tp_le_0null" table="prev_week" />
            <fact column="vr_rb_fact_count_tp_potr_0" table="prev_week" />
            <fact column="vr_rb_fact_count_tp_potr_null" table="prev_week" />
          </call>
        </call>
        <fact column="vr_rb_fact_count_tu_ul" group="sum" as="tu_ul_st2" table="stage2" nullif="0" />
        <fact column="vr_rb_fact_count_tu_nas" group="sum" as="tu_nas_st2" table="stage2" nullif="0" />
        <fact column="vr_rb_fact_count_tu" group="sum" as="tu" table="main" nullif="0" exclude="1" />
        <fact column="vr_rb_fact_count_tu_ul" group="sum" as="tu_ul" table="main" nullif="0" />
        <call group="sum" as="tu_dif_ul_1w" function="-" nullif="0">
          <fact table="main" column="vr_rb_fact_count_tu_ul" />
          <fact table="prev_week" column="vr_rb_fact_count_tu_ul" />
        </call>
        <fact column="vr_rb_fact_count_tu_nas" group="sum" as="tu_nas" table="main" nullif="0" />
        <call group="sum" as="tu_dif_nas_1w" function="-" nullif="0">
          <fact table="main" column="vr_rb_fact_count_tu_nas" />
          <fact table="prev_week" column="vr_rb_fact_count_tu_nas" />
        </call>
        <call group="sum" as="tu_dif_1w" function="-" nullif="0">
          <fact table="main" column="vr_rb_fact_count_tu" />
          <fact table="prev_week" column="vr_rb_fact_count_tu" />
        </call>
        <call as="tu_0null_st2" function="+" group="sum" nullif="0">
          <fact column="vr_rb_fact_count_tu_0" table="stage2" />
          <fact column="vr_rb_fact_count_tu_null" table="stage2" />
        </call>
        <fact column="vr_rb_fact_count_tu_ul_0" group="sum" as="tu_ul_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_ul_null" group="sum" as="tu_ul_null" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_nas_0" group="sum" as="tu_nas_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_nas_null" group="sum" as="tu_nas_null" table="main" nullif="0" />
        <call function="-" group="sum" as="tu_0null_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_0" table="main" />
            <fact column="vr_rb_fact_count_tu_ul_null" table="main" />
            <fact column="vr_rb_fact_count_tu_nas_0" table="main" />
            <fact column="vr_rb_fact_count_tu_nas_null" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_0" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_ul_null" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_nas_0" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_nas_null" table="prev_week" />
          </call>
        </call>
      </select>
      <from>
        <qube star-scheme="1">
          <link name="d49277_kod_fl" />
          <link name="d49277_pwrc" />
          <link name="d49277_fdrid" />
          <where>
            <call function="and">
              <call function="in">
                <column table="d49277_pwrc" column="pwrc_id" />
                <const>(8871, 56215, 342, 78784, 34026, 6665, 59071, 208972)</const>
              </call>
              <call function="in">
                <column table="d49277_fdrid" column="pwrc_fdrid" />
                <const>(8873, 8874, 8875, 8876, 8872, 56264, 56274, 56276, 56266, 56268, 56269, 56270, 56271, 56272, 56273, 1865, 1866, 1867, 1868, 79387, 79388, 79491, 59181, 59180, 59179, 59177, 59182, 59183, 59184, 382276, 472188, 1229, 6670, 6667, 85354, 85355)</const>
              </call>
            </call>
          </where>
          <dimset as="main">
            <link name="dat" only-for-cond="1" />
            <where exclude="1">
              <call function="gt">
                <column table="dat" column="val" />
                <const>to_date('20180102', 'YYYY.MM.DD')</const>
              </call>
            </where>
          </dimset>
          <dimset as="prev_week">
            <link name="dat" only-for-cond="1" />
            <where>
              <call function="le">
                <call function="trunc">
                  <column table="dat" column="val" />
                </call>
                <call function="-">
                  <call function="trunc">
                    <call function="sysdate" />
                  </call>
                  <const>7</const>
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="stage1">
            <link name="dat" only-for-cond="1" />
            <where>
              <call function="=">
                <call function="trunc">
                  <column table="dat" column="val" />
                </call>
                <const>to_date('20180515', 'YYYY.MM.DD')</const>
              </call>
            </where>
          </dimset>
          <dimset as="stage2">
            <link name="dat" only-for-cond="1" />
            <where>
              <call function="le">
                <call function="trunc">
                  <column table="dat" column="val" />
                </call>
                <const>to_date('20180531', 'YYYY.MM.DD')</const>
              </call>
            </where>
          </dimset>
        </qube>
      </from>
      <grouping>
        <grset as="all" title="Всего" />
        <grset as="fl" title="По филиалам" order="upper(fskname)">
          <group>
            <sourcelink table="d49277_kod_fl" />
          </group>
          <grset as="ps" title="По сетям" order="pwrcname">
            <group>
              <sourcelink table="d49277_pwrc" />
            </group>
            <grset as="fdr" title="По фидерам" order="pwrc_fdrname nulls first">
              <group>
                <sourcelink table="d49277_fdrid" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="title_49277" timestamp="06.03.2019 11:51:31">
      <params>
        <usepart part="49277-params_test2" />
      </params>
      <select>
        <call function="trunc" as="dat_otch" type="date">
          <call function="sysdate" />
        </call>
        <call function="to_char" as="num_week" exclude="1">
          <call function="-">
            <call function="sysdate" />
            <const>7</const>
          </call>
          <const>'ww'</const>
        </call>
        <call function="()" as="num_week" type="string">
          <useparam name="w_num" />
        </call>
      </select>
      <from>
        <table name="dual" as="a" />
      </from>
    </query>
    <query name="main_49277_test" timestamp="26.02.2019 13:27:22">
      <select>
        <call as="count_fdr" group="count_dist" function="()" type="number">
          <const exclude="1">1</const>
          <column table="kg_name" column="val" />1</call>
        <column table="d49277_kod_fl" column="kod_fl" />
        <column table="d49277_pwrc" column="pwrc_id" />
        <column table="d49277_fdrid" column="pwrc_fdrid" exclude="1" />
        <column table="kg_name" column="val" title="ДИСП №ФИД" as="pwrc_fdrname" />
        <column table="d49277_kod_fl" column="name" as="fskname" group="max" title="Филиал" />
        <column table="d49277_pwrc" column="pwrcname" group="max" title="ДИСП №ПС" />
        <column table="d49277_fdrid" column="pwrc_fdrname" group="max" title="ДИСП №ФИД" exclude="1" />
        <fact column="vr_rb_fact_test_wp_in_fdr" as="wp_in_st1" group="sum" table="stage1" />
        <fact column="vr_rb_fact_test_wp_out_fdr" as="wp_out_st1" group="sum" table="stage1" />
        <call function="case" as="neb_st1" group="outer" nullif="0">
          <call function="when">
            <call function="=0">
              <column column="wp_in_st1" table="this" />
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="round">
                <call function="/">
                  <call function="-">
                    <column column="wp_in_st1" table="this" />
                    <column column="wp_out_st1" table="this" />
                  </call>
                  <column column="wp_in_st1" table="this" />
                </call>
                <const>6</const>
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <fact column="vr_rb_fact_test_wp_in_fdr" as="wp_in_st2" group="sum" table="stage2" />
        <fact column="vr_rb_fact_test_wp_out_fdr" as="wp_out_st2" group="sum" table="stage2" />
        <call function="case" as="neb_st2" group="outer" nullif="0">
          <call function="when">
            <call function="=0">
              <column column="wp_in_st2" table="this" />
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="round">
                <call function="/">
                  <call function="-">
                    <column column="wp_in_st2" table="this" />
                    <call function="nvl0">
                      <column column="wp_out_st2" table="this" />
                    </call>
                  </call>
                  <column column="wp_in_st2" table="this" />
                </call>
                <const>6</const>
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <fact column="vr_rb_fact_test_wp_in_fdr" as="wp_in" group="sum" table="main" />
        <fact column="vr_rb_fact_test_wp_out_fdr" as="wp_out" group="sum" table="main" />
        <call function="case" as="neb" group="outer" nullif="0">
          <call function="when">
            <call function="=0">
              <column column="wp_in" table="this" />
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="/">
                <call function="-">
                  <column column="wp_in" table="this" />
                  <call function="nvl0">
                    <column column="wp_out" table="this" />
                  </call>
                </call>
                <column column="wp_in" table="this" />
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <fact table="stage2" column="vr_rb_fact_test_count_tp" group="sum" as="tp_st2" nullif="0" />
        <fact table="main" column="vr_rb_fact_count_tp" group="sum" as="tp" nullif="0" exclude="1" />
        <fact table="main" column="vr_rb_fact_test_count_tp_le" group="sum" as="tp_le" nullif="0" />
        <fact table="main" column="vr_rb_fact_test_count_tp_potr" group="sum" as="tp_potr" nullif="0" />
        <call group="sum" as="tp_dif_1w" function="-" nullif="0">
          <fact table="main" column="vr_rb_fact_test_count_tp" />
          <fact table="prev_week" column="vr_rb_fact_test_count_tp" />
        </call>
        <call as="tp_0null_st2" function="+" group="sum" nullif="0">
          <fact column="vr_rb_fact_test_count_tp_0" table="stage2" />
          <fact column="vr_rb_fact_test_count_tp_null" table="stage2" />
        </call>
        <fact column="vr_rb_fact_test_count_tp_le_0null" group="sum" as="tp_le_0null" table="main" nullif="0" />
        <fact column="vr_rb_fact_test_count_tp_potr_0" group="sum" as="tp_potr_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_test_count_tp_potr_null" group="sum" as="tp_potr_null" table="main" nullif="0" />
        <call function="-" group="sum" as="tp_0null_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_test_count_tp_le_0null" table="main" />
            <fact column="vr_rb_fact_test_count_tp_potr_0" table="main" />
            <fact column="vr_rb_fact_test_count_tp_potr_null" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_test_count_tp_le_0null" table="prev_week" />
            <fact column="vr_rb_fact_test_count_tp_potr_0" table="prev_week" />
            <fact column="vr_rb_fact_test_count_tp_potr_null" table="prev_week" />
          </call>
        </call>
        <fact column="vr_rb_fact_test_count_tu_ul" group="sum" as="tu_ul_st2" table="stage2" nullif="0" />
        <fact column="vr_rb_fact_test_count_tu_nas" group="sum" as="tu_nas_st2" table="stage2" nullif="0" />
        <fact column="vr_rb_fact_count_tu" group="sum" as="tu" table="main" nullif="0" exclude="1" />
        <fact column="vr_rb_fact_test_count_tu_ul" group="sum" as="tu_ul" table="main" nullif="0" />
        <call group="sum" as="tu_dif_ul_1w" function="-" nullif="0">
          <fact table="main" column="vr_rb_fact_test_count_tu_ul" />
          <fact table="prev_week" column="vr_rb_fact_test_count_tu_ul" />
        </call>
        <fact column="vr_rb_fact_test_count_tu_nas" group="sum" as="tu_nas" table="main" nullif="0" />
        <call group="sum" as="tu_dif_nas_1w" function="-" nullif="0">
          <fact table="main" column="vr_rb_fact_test_count_tu_nas" />
          <fact table="prev_week" column="vr_rb_fact_test_count_tu_nas" />
        </call>
        <call group="sum" as="tu_dif_1w" function="-" nullif="0">
          <fact table="main" column="vr_rb_fact_test_count_tu" />
          <fact table="prev_week" column="vr_rb_fact_test_count_tu" />
        </call>
        <call as="tu_0null_st2" function="+" group="sum" nullif="0">
          <fact column="vr_rb_fact_test_count_tu_0" table="stage2" />
          <fact column="vr_rb_fact_test_count_tu_null" table="stage2" />
        </call>
        <fact column="vr_rb_fact_test_count_tu_ul_0" group="sum" as="tu_ul_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_test_count_tu_ul_null" group="sum" as="tu_ul_null" table="main" nullif="0" />
        <fact column="vr_rb_fact_test_count_tu_nas_0" group="sum" as="tu_nas_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_test_count_tu_nas_null" group="sum" as="tu_nas_null" table="main" nullif="0" />
        <call function="-" group="sum" as="tu_0null_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_test_count_tu_ul_0" table="main" />
            <fact column="vr_rb_fact_test_count_tu_ul_null" table="main" />
            <fact column="vr_rb_fact_test_count_tu_nas_0" table="main" />
            <fact column="vr_rb_fact_test_count_tu_nas_null" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_test_count_tu_ul_0" table="prev_week" />
            <fact column="vr_rb_fact_test_count_tu_ul_null" table="prev_week" />
            <fact column="vr_rb_fact_test_count_tu_nas_0" table="prev_week" />
            <fact column="vr_rb_fact_test_count_tu_nas_null" table="prev_week" />
          </call>
        </call>
      </select>
      <from>
        <qube star-scheme="1">
          <link name="d49277_kod_fl" exclude="1" />
          <link name="d49277_kod_fl_real" as="d49277_kod_fl" />
          <link name="d49277_pwrc" />
          <link name="d49277_fdrid" />
          <link name="kg_name" />
          <where>
            <call function="and">
              <call function="in">
                <column table="d49277_pwrc" column="pwrc_id" />
                <const>(8871, 56215, 342, 78784, 34026, 6665, 59071, 208972)</const>
              </call>
              <call function="in">
                <column table="d49277_fdrid" column="pwrc_fdrid" />
                <const>(8873, 8874, 8875, 8876, 8872, 56264, 56274, 56276, 56266, 56268, 56269, 56270, 56271, 56272, 56273, 1865, 1866, 1867, 1868, 79387, 79388, 79491, 59181, 59180, 59179, 59177, 59182, 59183, 59184, 382276, 472188, 1229, 6670, 6667, 85354, 85355)</const>
              </call>
            </call>
          </where>
          <dimset as="main">
            <link name="dat" only-for-cond="1" />
            <where exclude="1">
              <call function="gt">
                <column table="dat" column="val" />
                <const>to_date('20180102', 'YYYY.MM.DD')</const>
              </call>
            </where>
          </dimset>
          <dimset as="prev_week">
            <link name="dat" only-for-cond="1" />
            <where>
              <call function="le">
                <call function="trunc">
                  <column table="dat" column="val" />
                </call>
                <call function="-">
                  <call function="trunc">
                    <call function="sysdate" />
                  </call>
                  <const>7</const>
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="stage1">
            <link name="dat" only-for-cond="1" />
            <where>
              <call function="=">
                <call function="trunc">
                  <column table="dat" column="val" />
                </call>
                <const>to_date('20180515', 'YYYY.MM.DD')</const>
              </call>
            </where>
          </dimset>
          <dimset as="stage2">
            <link name="dat" only-for-cond="1" />
            <where>
              <call function="le">
                <call function="trunc">
                  <column table="dat" column="val" />
                </call>
                <const>DATE'2018-05-31'</const>
              </call>
            </where>
          </dimset>
        </qube>
      </from>
      <grouping>
        <grset as="all" title="Всего" />
        <grset as="fl" title="По филиалам" order="upper(fskname)">
          <group>
            <sourcelink table="d49277_kod_fl" />
          </group>
          <grset as="ps" title="По сетям" order="pwrcname">
            <group>
              <sourcelink table="d49277_pwrc" />
            </group>
            <grset as="fdr" title="По фидерам" order="pwrc_fdrname nulls first">
              <group>
                <sourcelink table="kg_name" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="49277-yms" timestamp="27.12.2018 18:58:24">
      <select>
        <column table="a" column="ym" type="number" key="1" group="min" />
        <column table="a" column="ym" type="number" group="min" as="name" />
      </select>
      <from>
        <query name="vr_rb_filial" as="a" />
      </from>
    </query>
    <query name="49277-ym_po" timestamp="27.12.2018 18:58:46">
      <select>
        <column table="a" column="ym" type="number" key="1" group="max" />
        <column table="a" column="ym" type="number" group="max" as="name" />
      </select>
      <from>
        <query name="vr_rb_filial" as="a" />
      </from>
    </query>
    <query name="main_49277_32" timestamp="29.05.2021 01:52:32" order="ym_start_analyz, pwrcn, pwrc_fdrname">
      <params>
        <usepart part="49277-params_test2" />
      </params>
      <select>
        <column table="d49277_pwrc" column="pwrcn" group="max" title="ДИСП №ПС" />
        <column table="def_pwrc" column="ym_start_analyz" group="max" />
        <call as="count_fdr" group="count_dist" function="()" type="number">
          <column table="kg_name" column="k_kg_name" />1</call>
        <call as="count_fdr" group="count_dist" function="()" type="number" exclude="1">
          <const exclude="1">1</const>
          <column table="kg_name" column="val" />1</call>
        <column table="d49277_kod_fl_real" column="kod_fl" />
        <column table="d49277_pwrc" column="pwrc_id" />
        <call function="||-" as="hv_eopwrc_id" exclude="1">
          <column table="this" column="pwrc_id" />
          <column table="this" column="kod_fl" />
        </call>
        <column table="kg_name" column="kg_name_w_real_fdr" title="ДИСП №ФИД" as="pwrc_fdrname" />
        <column table="kg_name" column="k_kg_name" />
        <column table="kg_name" column="val" title="ДИСП №ФИД" as="pwrc_fdrname" exclude="1" />
        <column table="def_pwrc" column="kod_id" group="max" />
        <column table="d49277_fdrid" column="pwrc_fdr_explname" group="stragg_dist" />
        <column table="d49277_kod_fl_real" column="name" as="fskname" group="max" title="ы" />
        <column table="d49277_kod_fl_real" column="ym" as="ym" group="max" title="Отчетный период" />
        <column table="d49277_pwrc" column="pwrcname" group="max" title="ДИСП №ПС" />
        <call as="pwrcname" title="ДИСП №ПС" function="if" group="max" exclude="1">
          <call function="=">
            <column table="d49277_kod_fl_real" column="kod_fl" />
            <const comment="Кабельная сеть">13082</const>
          </call>
          <column table="d49277_pwrc" column="pwrcn" />
          <column table="d49277_pwrc" column="pwrcname" />
        </call>
        <fact column="vr_rb_fact_test2_wp_in_fdr" as="wp_in_st1" group="sum" table="stage1" />
        <fact column="vr_rb_fact_test2_wp_out_fdr" as="wp_out_st1" group="sum" table="stage1" />
        <call function="case" as="neb_st1" group="outer" nullif="0">
          <call function="when">
            <call function="=0">
              <column column="wp_in_st1" table="this" />
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="round">
                <call function="/">
                  <call function="-">
                    <column column="wp_in_st1" table="this" />
                    <column column="wp_out_st1" table="this" />
                  </call>
                  <column column="wp_in_st1" table="this" />
                </call>
                <const>6</const>
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <call function="-" as="neb_st1_kwh" group="outer" nullif="0">
          <column column="wp_in_st1" table="this" />
          <column column="wp_out_st1" table="this" />
        </call>
        <fact column="vr_rb_fact_test2_wp_in_fdr" as="wp_in_st2" group="sum" table="stage2" />
        <fact column="vr_rb_fact_test2_wp_out_fdr" as="wp_out_st2" group="sum" table="stage2" />
        <call function="case" as="neb_st2" group="outer" nullif="0">
          <call function="when">
            <call function="=0">
              <column column="wp_in_st2" table="this" />
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="round">
                <call function="/">
                  <call function="-">
                    <column column="wp_in_st2" table="this" />
                    <call function="nvl0">
                      <column column="wp_out_st2" table="this" />
                    </call>
                  </call>
                  <column column="wp_in_st2" table="this" />
                </call>
                <const>6</const>
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <call function="-" as="neb_st2_kwh" group="outer" nullif="0">
          <column column="wp_in_st2" table="this" />
          <column column="wp_out_st2" table="this" />
        </call>
        <fact column="vr_rb_fact_test2_wp_in_fdr" as="wp_in" group="sum" table="main" nullif="0" exclude="1" />
        <fact column="vr_rb_fact_test2_wp_out_fdr" as="wp_out" group="sum" table="main" nullif="0" exclude="1" />
        <call function="if" as="wp_in" group="sum">
          <call function="and">
            <call function="is null">
              <fact table="main_check_data" column="vr_rb_fact_test2_wp_in_raw_fdr" />
            </call>
            <call function="=0">
              <fact table="main" column="vr_rb_fact_test2_wp_in_fdr" />
            </call>
          </call>
          <call function="null" />
          <fact table="main" column="vr_rb_fact_test2_wp_in_fdr" />
        </call>
        <call function="if" as="wp_out" group="sum">
          <call function="and">
            <call function="is null">
              <fact table="main_check_data" column="vr_rb_fact_test2_wp_out_raw_fdr" />
            </call>
            <call function="=0">
              <fact table="main" column="vr_rb_fact_test2_wp_out_fdr" />
            </call>
          </call>
          <call function="null" />
          <fact table="main" column="vr_rb_fact_test2_wp_out_fdr" />
        </call>
        <call function="case" as="neb" group="outer" nullif="0" exclude="1">
          <call function="when">
            <call function="=0">
              <column column="wp_in" table="this" />
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="/">
                <call function="-">
                  <column column="wp_in" table="this" />
                  <call function="nvl0">
                    <column column="wp_out" table="this" />
                  </call>
                </call>
                <column column="wp_in" table="this" />
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <call function="-" as="neb_kwh" group="outer" nullif="0" exclude="1">
          <column table="this" column="wp_in" />
          <column column="wp_out" table="this" />
        </call>
        <call function="case" as="neb" group="outer">
          <call function="when">
            <call function="or">
              <call function="is null">
                <column column="wp_in" table="this" />
              </call>
              <call function="is null">
                <column column="wp_out" table="this" />
              </call>
              <call function="=0">
                <column column="wp_in" table="this" />
              </call>
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="/">
                <call function="-">
                  <column column="wp_in" table="this" />
                  <call function="nvl0">
                    <column column="wp_out" table="this" />
                  </call>
                </call>
                <column column="wp_in" table="this" />
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <call function="case" as="neb_kwh" group="outer">
          <call function="when">
            <call function="or">
              <call function="is null">
                <column column="wp_in" table="this" />
              </call>
              <call function="is null">
                <column column="wp_out" table="this" />
              </call>
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="-">
              <column table="this" column="wp_in" />
              <column column="wp_out" table="this" />
            </call>
          </call>
        </call>
        <fact table="stage2" column="vr_rb_fact_test2_count_tp" group="sum" as="tp_st2" nullif="0" />
        <fact table="main" column="vr_rb_fact_test2_count_tp_le" group="sum" as="tp_le" nullif="0" />
        <fact table="main" column="vr_rb_fact_test2_count_tp_potr" group="sum" as="tp_potr" nullif="0" />
        <call group="sum" as="tp_dif_1w" function="-nvl" nullif="0">
          <fact table="main" column="vr_rb_fact_test2_count_tp" />
          <fact table="prev_week" column="vr_rb_fact_test2_count_tp" />
        </call>
        <call as="tp_0null_st2" function="+" group="sum" nullif="0">
          <fact column="vr_rb_fact_test2_count_tp_0" table="stage2" />
          <fact column="vr_rb_fact_test2_count_tp_null" table="stage2" />
        </call>
        <fact column="vr_rb_fact_test2_count_tp_le_0null" group="sum" as="tp_le_0null" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tp_potr_0" group="sum" as="tp_potr_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tp_potr_null" group="sum" as="tp_potr_null" table="main" nullif="0" />
        <call function="-" group="sum" as="tp_0null_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_test2_count_tp_le_0null" table="main" />
            <fact column="vr_rb_fact_test2_count_tp_potr_0" table="main" />
            <fact column="vr_rb_fact_test2_count_tp_potr_null" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_test2_count_tp_le_0null" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tp_potr_0" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tp_potr_null" table="prev_week" />
          </call>
        </call>
        <fact column="vr_rb_fact_test2_count_tu_ul" group="sum" as="tu_ul_st2" table="stage2" nullif="0" />
        <call group="sum" as="tu_dif_1w" function="-nvl" nullif="0">
          <fact table="main" column="vr_rb_fact_test2_count_tu" />
          <fact table="prev_week" column="vr_rb_fact_test2_count_tu" />
        </call>
        <fact column="vr_rb_fact_test2_count_tu_nas" group="sum" as="tu_nas_st2" table="stage2" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_ul" group="sum" as="tu_ul" table="main" nullif="0" />
        <call group="sum" as="tu_dif_ul_1w" function="-nvl" nullif="0">
          <fact table="main" column="vr_rb_fact_test2_count_tu_ul" />
          <fact table="prev_week" column="vr_rb_fact_test2_count_tu_ul" />
        </call>
        <fact column="vr_rb_fact_test2_count_tu_mkd" group="sum" as="tu_mkd" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_izs" group="sum" as="tu_izs" table="main" nullif="0" />
        <call group="sum" as="tu_dif_nas_1w" function="-nvl" nullif="0">
          <fact table="main" column="vr_rb_fact_test2_count_tu_nas" />
          <fact table="prev_week" column="vr_rb_fact_test2_count_tu_nas" />
        </call>
        <call as="tu_0null_st2" function="+" group="sum" nullif="0">
          <fact column="vr_rb_fact_test2_count_tu_0" table="stage2" />
          <fact column="vr_rb_fact_test2_count_tu_null" table="stage2" />
        </call>
        <fact column="vr_rb_fact_test2_count_tu_ul_0" group="sum" as="tu_ul_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_ul_null" group="sum" as="tu_ul_null" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_mkd_0" group="sum" as="tu_mkd_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_izs_0" group="sum" as="tu_izs_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_mkd_null" group="sum" as="tu_mkd_null" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_izs_null" group="sum" as="tu_izs_null" table="main" nullif="0" />
        <call function="-" group="sum" as="tu_0null_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_test2_count_tu_ul_0" table="main" />
            <fact column="vr_rb_fact_test2_count_tu_ul_null" table="main" />
            <fact column="vr_rb_fact_test2_count_tu_mkd_0" table="main" />
            <fact column="vr_rb_fact_test2_count_tu_izs_0" table="main" />
            <fact column="vr_rb_fact_test2_count_tu_mkd_null" table="main" />
            <fact column="vr_rb_fact_test2_count_tu_izs_null" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_test2_count_tu_ul_0" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tu_ul_null" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tu_mkd_0" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tu_izs_0" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tu_mkd_null" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tu_izs_null" table="prev_week" />
          </call>
        </call>
        <fact column="vr_rb_fact_test2_count_tu_ul_auto" group="sum" as="tu_ul_auto" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_mkd_auto" group="sum" as="tu_mkd_auto" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_izs_auto" group="sum" as="tu_izs_auto" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_ul_hand" group="sum" as="tu_ul_hand" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_mkd_hand" group="sum" as="tu_mkd_hand" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_izs_hand" group="sum" as="tu_izs_hand" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_ul_no" group="sum" as="tu_ul_no" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_mkd_no" group="sum" as="tu_mkd_no" table="main" nullif="0" />
        <fact column="vr_rb_fact_test2_count_tu_izs_no" group="sum" as="tu_izs_no" table="main" nullif="0" />
        <call function="-" group="sum" as="tu_auto_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_test2_count_tu_ul_auto" table="main" />
            <fact column="vr_rb_fact_test2_count_tu_mkd_auto" table="main" />
            <fact column="vr_rb_fact_test2_count_tu_izs_auto" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_test2_count_tu_ul_auto" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tu_mkd_auto" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tu_izs_auto" table="prev_week" />
          </call>
        </call>
        <call function="-" group="sum" as="tu_hand_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_test2_count_tu_ul_hand" table="main" />
            <fact column="vr_rb_fact_test2_count_tu_mkd_hand" table="main" />
            <fact column="vr_rb_fact_test2_count_tu_izs_hand" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_test2_count_tu_ul_hand" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tu_mkd_hand" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tu_izs_hand" table="prev_week" />
          </call>
        </call>
        <call function="-" group="sum" as="tu_no_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_test2_count_tu_ul_no" table="main" />
            <fact column="vr_rb_fact_test2_count_tu_mkd_no" table="main" />
            <fact column="vr_rb_fact_test2_count_tu_izs_no" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_test2_count_tu_ul_no" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tu_mkd_no" table="prev_week" />
            <fact column="vr_rb_fact_test2_count_tu_izs_no" table="prev_week" />
          </call>
        </call>
      </select>
      <from>
        <qube star-scheme="1">
          <link name="d49277_kod_fl_real" />
          <link name="d49277_pwrc" />
          <link name="d49277_bal_id" only-for-cond="1" />
          <link name="d49277_fdrid" />
          <link name="kg_name" />
          <link name="def_pwrc" />
          <where>
            <call function="and">
              <call function="in">
                <column table="d49277_kod_fl_real" column="kod_fl" />
                <useparam name="kod_fl" />
              </call>
              <call function="in" exclude="1">
                <column table="d49277_pwrc" column="pwrc_id" />
                <useparam name="pwrc_id" />
              </call>
              <call function="in" exclude="1">
                <column table="this" column="hv_eopwrc_id" />
                <useparam name="hv_eopwrc_id" />
              </call>
              <call function="in">
                <column table="d49277_bal_id" column="hv_eopwrc_id" />
                <useparam name="hv_eopwrc_id" />
              </call>
              <call function="in">
                <column table="d49277_fdrid" column="pwrc_fdrid" />
                <useparam name="pwrc_fdrid" />
              </call>
              <call function="in" exclude="1">
                <column table="d49277_pwrc" column="pwrc_id" />
                <const>(8871, 56215, 342, 78784, 34026, 6665, 59071, 208972)</const>
              </call>
              <call function="in" exclude="1">
                <column table="d49277_fdrid" column="pwrc_fdrid" />
                <const>(8873, 8874, 8875, 8876, 8872, 56264, 56274, 56276, 56266, 56268, 56269, 56270, 56271, 56272, 56273, 1865, 1866, 1867, 1868, 79387, 79388, 79491, 59181, 59180, 59179, 59177, 59182, 59183, 59184, 382276, 472188, 1229, 6670, 6667, 85354, 85355)</const>
              </call>
            </call>
          </where>
          <dimset as="main">
            <link name="id_dat" only-for-cond="1" />
            <where>
              <call function="le">
                <call function="nvl0">
                  <column table="id_dat" column="id_dat" />
                </call>
                <useparam name="id_dat" />
              </call>
            </where>
          </dimset>
          <dimset as="main_check_data">
            <link name="ym" only-for-cond="1" />
            <link name="id_dat" only-for-cond="1" />
            <where>
              <call function="and">
                <call function="=">
                  <column table="ym" column="val" />
                  <column table="d49277_kod_fl_real" column="ym" />
                </call>
                <call function="le">
                  <call function="nvl0">
                    <column table="id_dat" column="id_dat" />
                  </call>
                  <useparam name="id_dat" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="prev_week">
            <link name="dat" only-for-cond="1" />
            <where>
              <call function="le">
                <call function="trunc">
                  <column table="dat" column="val" />
                </call>
                <call function="trunc">
                  <useparam name="prev_slice_dat" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="stage1">
            <link only-for-cond="1" name="ym" />
            <where>
              <call function="le">
                <column table="ym" column="val" />
                <column table="def_pwrc" column="stage1" />
              </call>
            </where>
          </dimset>
          <dimset as="stage2">
            <link only-for-cond="1" name="ym" />
            <where>
              <call function="le">
                <column table="ym" column="val" />
                <column table="def_pwrc" column="stage2" />
              </call>
            </where>
          </dimset>
        </qube>
      </from>
      <grouping>
        <grset as="all" title="Всего" />
        <grset as="fl" title="По филиалам" order="upper(fskname)">
          <group>
            <sourcelink table="d49277_kod_fl_real" />
          </group>
          <grset as="ps" title="По сетям" order="kod_id">
            <group>
              <sourcelink table="d49277_pwrc" />
            </group>
            <grset as="fdr" title="По фидерам" order="(case when (SUBSTR( k_kg_name, 1 , 1) != '-') then 1 end) nulls last, pwrc_fdrname nulls first">
              <group>
                <sourcelink table="kg_name" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="49277-dats" timestamp="06.03.2019 13:15:04" order="dat desc">
      <select>
        <column table="a" column="id_dat" key="1" as="id" />
        <call function="to_char" as="num_week" title="Номер недели" is-name="1" vid="1">
          <column table="a" column="dat" />
          <const>'ww'</const>
        </call>
        <column table="a" column="dat" as="name" title="Дата снимка данных" vid="1" is-name="1" format="dd.MM.yyyy HH:mm" />
      </select>
      <from>
        <query name="vr_rb_dat" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="is_result" />
          <const>0</const>
        </call>
      </where>
    </query>
    <query name="49277_51730-dat_by_id" timestamp="28.04.2022 15:20:16" order="a.ym desc">
      <select>
        <column table="a" column="ym" group="1" key="1" />
        <call as="name" function="to_char" group="1">
          <column table="a" column="ym" />
          <const>'9999.99'</const>
        </call>
      </select>
      <from>
        <query name="vr_rb_fact_mv" as="a" />
      </from>
      <where>
        <call function="!=">
          <column table="a" column="ym" />
          <const>0</const>
        </call>
      </where>
    </query>
    <query name="main_49277_31" order="ym_start_analyz, pwrcn, pwrc_fdrname" timestamp="25.01.2023 22:42:13">
      <params>
        <param name="stage3" type="number">
          <const exclude="1">2020.12</const>
        </param>
        <param name="kod_fl" type="array">
          <array exclude="1">
            <const>12966</const>
          </array>
        </param>
        <param name="hv_eopwrc_id" type="array">
          <array exclude="1">
            <const>'56215-12966'</const>
          </array>
        </param>
        <param name="pwrc_id" type="array">
          <array exclude="1">
            <const>56215</const>
          </array>
        </param>
        <param name="k_kg_name" type="array">
          <array exclude="1">
            <const>'-220294-'</const>
          </array>
        </param>
        <param name="pwrc_fdrid" type="array">
          <array exclude="1">
            <const>56271</const>
            <const>56268</const>
          </array>
        </param>
      </params>
      <select>
        <column as="count_fdr" group="count_dist" function="()" type="number" table="a" column="count_fdr">1</column>
        <column table="a" column="kod_fl" />
        <column table="a" column="pwrc_id" />
        <column table="a" column="pwrc_fdrname" title="ДИСП №ФИД" as="pwrc_fdrname" />
        <column table="a" column="k_kg_name" />
        <column table="a" column="kod_id" group="max" />
        <column table="a" column="ym_start_analyz" group="max" />
        <column table="a" column="pwrc_fdr_explname" group="stragg_dist" />
        <column table="a" column="fskname" as="fskname" group="max" />
        <column table="a" column="ym" as="ym" group="max" title="Отчетный период" />
        <column table="a" column="pwrcname" group="max" title="ДИСП №ПС" />
        <column table="a" column="pwrcn" group="max" title="ДИСП №ПС" />
        <column column="wp_in_st1" as="wp_in_st1" group="sum" table="a" />
        <column column="wp_out_st1" as="wp_out_st1" group="sum" table="a" />
        <call function="case" as="neb_st1" group="outer" nullif="0">
          <call function="when">
            <call function="=0">
              <column column="wp_in_st1" table="this" />
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="round">
                <call function="/">
                  <call function="-">
                    <column column="wp_in_st1" table="this" />
                    <column column="wp_out_st1" table="this" />
                  </call>
                  <column column="wp_in_st1" table="this" />
                </call>
                <const>6</const>
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <call function="-" as="neb_st1_kwh" group="outer" nullif="0">
          <column column="wp_in_st1" table="this" />
          <column column="wp_out_st1" table="this" />
        </call>
        <column column="wp_in_st2" as="wp_in_st2" group="sum" table="a" />
        <column column="wp_out_st2" as="wp_out_st2" group="sum" table="a" />
        <call function="case" as="neb_st2" group="outer" nullif="0">
          <call function="when">
            <call function="=0">
              <column column="wp_in_st2" table="this" />
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="round">
                <call function="/">
                  <call function="-">
                    <column column="wp_in_st2" table="this" />
                    <call function="nvl0">
                      <column column="wp_out_st2" table="this" />
                    </call>
                  </call>
                  <column column="wp_in_st2" table="this" />
                </call>
                <const>6</const>
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <call function="-" as="neb_st2_kwh" group="outer" nullif="0">
          <column column="wp_in_st2" table="this" />
          <column column="wp_out_st2" table="this" />
        </call>
        <column function="if" as="wp_in" group="sum" table="a" column="wp_in" />
        <column function="if" as="wp_out" group="sum" table="a" column="wp_out" />
        <call function="case" as="neb" group="outer">
          <call function="when">
            <call function="or">
              <call function="is null">
                <column column="wp_in" table="this" />
              </call>
              <call function="is null">
                <column column="wp_out" table="this" />
              </call>
              <call function="=0">
                <column column="wp_in" table="this" />
              </call>
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="*">
              <call function="/">
                <call function="-">
                  <column column="wp_in" table="this" />
                  <call function="nvl0">
                    <column column="wp_out" table="this" />
                  </call>
                </call>
                <column column="wp_in" table="this" />
              </call>
              <const>100</const>
            </call>
          </call>
        </call>
        <call function="case" as="neb_kwh" group="outer">
          <call function="when">
            <call function="or">
              <call function="is null">
                <column column="wp_in" table="this" />
              </call>
              <call function="is null">
                <column column="wp_out" table="this" />
              </call>
            </call>
            <call function="null" />
          </call>
          <call function="else">
            <call function="-">
              <column table="this" column="wp_in" />
              <column column="wp_out" table="this" />
            </call>
          </call>
        </call>
        <column table="a" column="tp_st2" group="sum" as="tp_st2" nullif="0" />
        <column table="a" column="tp_le" group="sum" as="tp_le" nullif="0" />
        <column table="a" column="tp_potr" group="sum" as="tp_potr" nullif="0" />
        <column group="sum" as="tp_dif_1w" function="-nvl" nullif="0" table="a" column="tp_dif_1w" />
        <column as="tp_0null_st2" function="+" group="sum" nullif="0" table="a" column="tp_0null_st2" />
        <column column="tp_le_0null" group="sum" as="tp_le_0null" table="a" nullif="0" />
        <column column="tp_potr_0" group="sum" as="tp_potr_0" table="a" nullif="0" />
        <column column="tp_potr_null" group="sum" as="tp_potr_null" table="a" nullif="0" />
        <column function="-" group="sum" as="tp_0null_dif_1w" nullif="0" table="a" column="tp_0null_dif_1w" />
        <column column="tu_ul_st2" group="sum" as="tu_ul_st2" table="a" nullif="0" />
        <column group="sum" as="tu_dif_1w" function="-nvl" nullif="0" table="a" column="tu_dif_1w" />
        <column column="tu_nas_st2" group="sum" as="tu_nas_st2" table="a" nullif="0" />
        <column column="tu_ul" group="sum" as="tu_ul" table="a" nullif="0" />
        <column group="sum" as="tu_dif_ul_1w" function="-nvl" nullif="0" table="a" column="tu_dif_ul_1w" />
        <column column="tu_mkd" group="sum" as="tu_mkd" table="a" nullif="0" />
        <column column="tu_izs" group="sum" as="tu_izs" table="a" nullif="0" />
        <column group="sum" as="tu_dif_nas_1w" function="-nvl" nullif="0" table="a" column="tu_dif_nas_1w" />
        <column as="tu_0null_st2" function="+" group="sum" nullif="0" table="a" column="tu_0null_st2" />
        <column column="tu_ul_0" group="sum" as="tu_ul_0" table="a" nullif="0" />
        <column column="tu_ul_null" group="sum" as="tu_ul_null" table="a" nullif="0" />
        <column column="tu_mkd_0" group="sum" as="tu_mkd_0" table="a" nullif="0" />
        <column column="tu_izs_0" group="sum" as="tu_izs_0" table="a" nullif="0" />
        <column column="tu_mkd_null" group="sum" as="tu_mkd_null" table="a" nullif="0" />
        <column column="tu_izs_null" group="sum" as="tu_izs_null" table="a" nullif="0" />
        <column function="-" group="sum" as="tu_0null_dif_1w" nullif="0" table="a" column="tu_0null_dif_1w" />
        <column column="tu_ul_auto" group="sum" as="tu_ul_auto" table="a" nullif="0" />
        <column column="tu_mkd_auto" group="sum" as="tu_mkd_auto" table="a" nullif="0" />
        <column column="tu_izs_auto" group="sum" as="tu_izs_auto" table="a" nullif="0" />
        <column column="tu_ul_hand" group="sum" as="tu_ul_hand" table="a" nullif="0" />
        <column column="tu_mkd_hand" group="sum" as="tu_mkd_hand" table="a" nullif="0" />
        <column column="tu_izs_hand" group="sum" as="tu_izs_hand" table="a" nullif="0" />
        <column column="tu_ul_no" group="sum" as="tu_ul_no" table="a" nullif="0" />
        <column column="tu_mkd_no" group="sum" as="tu_mkd_no" table="a" nullif="0" />
        <column column="tu_izs_no" group="sum" as="tu_izs_no" table="a" nullif="0" />
        <column function="-" group="sum" as="tu_auto_dif_1w" nullif="0" table="a" column="tu_auto_dif_1w" />
        <column function="-" group="sum" as="tu_hand_dif_1w" nullif="0" table="a" column="tu_hand_dif_1w" />
        <column function="-" group="sum" as="tu_no_dif_1w" nullif="0" table="a" column="tu_no_dif_1w" />
      </select>
      <from>
        <query name="hv_report_31_main" as="a" />
        <qube star-scheme="1" exclude="1">
          <link name="d49277_kod_fl_real" />
          <link name="d49277_pwrc" />
          <link name="d49277_bal_id" only-for-cond="1" />
          <link name="d49277_fdrid" />
          <link name="kg_name" />
          <link name="def_pwrc" />
          <link name="def_fdr" />
          <where>
            <call function="and">
              <call function="in">
                <column table="def_fdr" column="pwrc_fdrid" />
                <useparam name="pwrc_fdrid" />
              </call>
              <call function="in">
                <column table="d49277_kod_fl_real" column="kod_fl" />
                <useparam name="kod_fl" />
              </call>
              <call function="in">
                <column table="d49277_bal_id" column="hv_eopwrc_id" />
                <useparam name="hv_eopwrc_id" />
              </call>
              <call function="in">
                <column table="d49277_fdrid" column="pwrc_fdrid" />
                <useparam name="pwrc_fdrid" />
              </call>
            </call>
          </where>
          <dimset as="main">
            <link name="ym" only-for-cond="1" />
            <where>
              <call function="=">
                <column table="ym" column="val" />
                <useparam name="stage3" />
              </call>
            </where>
          </dimset>
          <dimset as="main_check_data">
            <link name="ym" only-for-cond="1" />
            <where>
              <call function="=">
                <column table="ym" column="val" />
                <useparam name="stage3" />
              </call>
            </where>
          </dimset>
          <dimset as="prev_week">
            <link name="ym" only-for-cond="1" />
            <where>
              <call function="=">
                <column table="ym" column="val" />
                <call function="ym add month">
                  <useparam name="stage3" />
                  <const>-1</const>
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="stage1">
            <link only-for-cond="1" name="ym" />
            <where>
              <call function="=">
                <column table="ym" column="val" />
                <column table="def_pwrc" column="stage1" />
              </call>
            </where>
          </dimset>
          <dimset as="stage2">
            <link only-for-cond="1" name="ym" />
            <where>
              <call function="=">
                <column table="ym" column="val" />
                <column table="def_pwrc" column="stage2" />
              </call>
            </where>
          </dimset>
        </qube>
      </from>
      <grouping>
        <grset as="all" title="Всего" />
        <grset as="fl" title="По филиалам" order="upper(fskname)">
          <group>
            <column table="a" column="kod_fl" />
          </group>
          <grset as="ps" title="По сетям" order="kod_id">
            <group>
              <column table="a" column="pwrc_id" />
            </group>
            <grset as="fdr" title="По фидерам" order="(case when (SUBSTR( k_kg_name, 1 , 1) != '-') then 1 end) nulls last, pwrc_fdrname nulls first">
              <group>
                <column table="a" column="k_kg_name" />
                <column table="a" column="pwrc_fdrname" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="title_49277_test3" timestamp="13.12.2022 18:30:00">
      <params>
        <param name="stage3" type="number">
          <const exclude="1">2020.12</const>
        </param>
        <param name="kod_fl" type="array">
          <array exclude="1">
            <const>12966</const>
          </array>
        </param>
        <param name="hv_eopwrc_id" type="array">
          <array exclude="1">
            <const>'56215-12966'</const>
          </array>
        </param>
        <param name="pwrc_id" type="array">
          <array exclude="1">
            <const>56215</const>
          </array>
        </param>
        <param name="k_kg_name" type="array">
          <array exclude="1">
            <const>'-220294-'</const>
          </array>
        </param>
        <param name="pwrc_fdrid" type="array">
          <array exclude="1">
            <const>56271</const>
            <const>56268</const>
          </array>
        </param>
      </params>
      <select>
        <call function="trunc" as="dat_otch" type="date">
          <call function="sysdate" />
        </call>
        <call function="to_char" as="num_week">
          <call function="-">
            <call function="sysdate" />
            <const>7</const>
          </call>
          <const>'ww'</const>
        </call>
        <call as="ym" function="()" type="number">
          <useparam name="stage3" />
        </call>
      </select>
      <from>
        <table name="dual" as="a" />
      </from>
    </query>
    <query name="49277_pwrc_def_test2" class="1" timestamp="11.04.2019 17:58:10">
      <params>
        <param name="kod_fl" type="array" />
        <param name="id_dat" type="number" />
      </params>
      <procedure>
        <text>
        BEGIN
            sqlb_d45862_fdr_kg.fill_table_fl_ym(greatest(0{,:id_dat}));
        END;
</text>
      </procedure>
      <select>
        <column table="pwrc_id" column="hv_eopwrc_id" />
        <column table="pwrc_id" column="pwrcn" />
        <column table="a" column="pwrc_id" type="number" title="" />
      </select>
      <from>
        <query name="vb_rb_default_pwrc" as="a">
          <link name="pwrc_id" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in">
            <column table="a" column="kod_fl" />
            <useparam name="kod_fl" />
          </call>
          <call function="=">
            <column table="a" column="kod_fl" />
            <column table="pwrc_id" column="bal_id" />
          </call>
        </call>
      </where>
    </query>
    <query name="49277_init_filial_test2" class="1" timestamp="25.02.2019 21:34:21">
      <params>
        <param name="kod_fl" type="array" />
        <param name="id_dat" type="number" />
      </params>
      <procedure>
        <text>
        BEGIN
            sqlb_d45862_fdr_kg.fill_table_fl_ym(:id_dat);
        END;
    </text>
      </procedure>
      <select>
        <call function="()" type="number" as="val">
          <const>1</const>
        </call>
      </select>
      <from>
        <query name="dual" />
      </from>
      <where>
        <call function="and">
          <call function="is not null">
            <useparam name="kod_fl" />
          </call>
          <call function="is not null">
            <useparam name="id_dat" />
          </call>
        </call>
      </where>
    </query>
    <query name="49277_pwrc_def_test3" class="1" timestamp="11.04.2019 18:03:14">
      <params>
        <param name="kod_fl" type="array" />
        <param name="stage3" type="number" />
      </params>
      <procedure>
        <text>
    BEGIN
        sqlb_d45862_fdr_kg.fill_table_fl_ym_by_ym(greatest(0{,:stage3}));
    END;
</text>
      </procedure>
      <select>
        <column table="pwrc_id" column="hv_eopwrc_id" />
        <column table="pwrc_id" column="pwrcn" />
        <column table="a" column="pwrc_id" type="number" />
      </select>
      <from>
        <query name="vb_rb_default_pwrc" as="a">
          <link name="pwrc_id" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="in">
            <column table="a" column="kod_fl" />
            <useparam name="kod_fl" />
          </call>
          <call function="=">
            <column table="a" column="kod_fl" />
            <column table="pwrc_id" column="bal_id" />
          </call>
        </call>
      </where>
    </query>
    <query name="49277-week_num" timestamp="06.03.2019 11:45:09" order="dat desc">
      <params>
        <param name="id_dat" type="number" />
      </params>
      <select>
        <call function="to_char" as="num_week" title="Номер недели">
          <column table="a" column="dat" />
          <const>'ww'</const>
        </call>
      </select>
      <from>
        <query name="vr_rb_dat" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="id_dat" />
          <useparam name="id_dat" />
        </call>
      </where>
    </query>
    <query name="49277-dat_slice_week_before" timestamp="01.10.2020 18:16:00">
      <params>
        <param name="id_dat" type="number" />
      </params>
      <select>
        <call function="nvl" as="prev_slice_dat">
          <call function="max">
            <column table="vr_rb_dat_prev" column="dat" />
          </call>
          <call function="nativity" />
        </call>
      </select>
      <from>
        <query name="vr_rb_dat" as="vr_rb_dat_cur" />
        <query name="vr_rb_dat" as="vr_rb_dat_prev" join="left outer">
          <call function="and">
            <call function="le">
              <call function="trunc">
                <column table="vr_rb_dat_prev" column="dat" />
              </call>
              <call function="-">
                <call function="trunc">
                  <column table="vr_rb_dat_cur" column="dat" />
                </call>
                <const>7</const>
              </call>
            </call>
            <call function="=">
              <column table="vr_rb_dat_prev" column="is_result" />
              <const>0</const>
            </call>
          </call>
        </query>
      </from>
      <where>
        <call function="=">
          <column table="vr_rb_dat_cur" column="id_dat" />
          <useparam name="id_dat" />
        </call>
      </where>
    </query>
    <query name="main_49277_32_without_kg" timestamp="13.10.2020 23:37:15" order="ym_start_analyz, pwrcn, pwrc_fdrname">
      <params>
        <usepart part="49277-params_test2" />
      </params>
      <select>
        <column table="d49277_kod_fl_real" column="kod_fl" />
        <column table="d49277_pwrc" column="pwrc_id" />
        <column table="d49277_kod_fl_real" column="ym" />
        <column table="d49277_pwrc" column="pwrcname" />
        <column table="d49277_fdrid" column="pwrc_fdrid" />
        <column table="d49277_fdrid" column="pwrc_fdr_explname" />
        <column table="d49277_fdrid" column="pwrc_fdrname" />
        <column table="d49277_kod_fl_real" column="name" as="fskname" />
        <column table="d49277_pwrc" column="pwrcn" group="max" title="ДИСП №ПС" />
        <column table="def_pwrc" column="ym_start_analyz" group="max" />
        <column table="def_pwrc" column="kod_id" group="max" />
        <fact column="vr_rb_fact_count_tu_ul" group="sum" as="tu_ul_st2" table="stage2" nullif="0" />
        <fact column="vr_rb_fact_count_tu_nas" group="sum" as="tu_nas_st2" table="stage2" nullif="0" />
        <fact column="vr_rb_fact_count_tu_ul" group="sum" as="tu_ul" table="main" nullif="0" />
        <call group="sum" as="tu_dif_ul_1w" function="-nvl" nullif="0">
          <fact table="main" column="vr_rb_fact_count_tu_ul" />
          <fact table="prev_week" column="vr_rb_fact_count_tu_ul" />
        </call>
        <fact column="vr_rb_fact_count_tu_nas" group="sum" as="tu_nas" table="main" nullif="0" />
        <call group="sum" as="tu_dif_nas_1w" function="-nvl" nullif="0">
          <fact table="main" column="vr_rb_fact_count_tu_nas" />
          <fact table="prev_week" column="vr_rb_fact_count_tu_nas" />
        </call>
        <call group="sum" as="tu_dif_1w" function="-nvl" nullif="0">
          <fact table="main" column="vr_rb_fact_count_tu" />
          <fact table="prev_week" column="vr_rb_fact_count_tu" />
        </call>
        <call as="tu_0null_st2" function="+" group="sum" nullif="0">
          <fact column="vr_rb_fact_count_tu_0" table="stage2" />
          <fact column="vr_rb_fact_count_tu_null" table="stage2" />
        </call>
        <fact column="vr_rb_fact_count_tu_ul_0" group="sum" as="tu_ul_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_ul_null" group="sum" as="tu_ul_null" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_nas_0" group="sum" as="tu_nas_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_nas_null" group="sum" as="tu_nas_null" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_mkd" group="sum" as="tu_mkd" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_mkd_0" group="sum" as="tu_mkd_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_mkd_null" group="sum" as="tu_mkd_null" table="main" nullif="0" />
        <call function="-nvl" group="sum" as="tu_0null_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_0" table="main" />
            <fact column="vr_rb_fact_count_tu_ul_null" table="main" />
            <fact column="vr_rb_fact_count_tu_mkd_0" table="main" />
            <fact column="vr_rb_fact_count_tu_izs_0" table="main" />
            <fact column="vr_rb_fact_count_tu_mkd_null" table="main" />
            <fact column="vr_rb_fact_count_tu_izs_null" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_0" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_ul_null" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_mkd_0" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_izs_0" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_mkd_null" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_izs_null" table="prev_week" />
          </call>
        </call>
        <fact column="vr_rb_fact_count_tu_mkd_auto" group="sum" as="tu_mkd_auto" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_mkd_hand" group="sum" as="tu_mkd_hand" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_mkd_no" group="sum" as="tu_mkd_no" table="main" nullif="0" />
        <call function="-nvl" group="sum" as="tu_auto_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_auto" table="main" />
            <fact column="vr_rb_fact_count_tu_mkd_auto" table="main" />
            <fact column="vr_rb_fact_count_tu_izs_auto" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_auto" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_mkd_auto" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_izs_auto" table="prev_week" />
          </call>
        </call>
        <call function="-nvl" group="sum" as="tu_hand_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_hand" table="main" />
            <fact column="vr_rb_fact_count_tu_mkd_hand" table="main" />
            <fact column="vr_rb_fact_count_tu_izs_hand" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_hand" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_mkd_hand" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_izs_hand" table="prev_week" />
          </call>
        </call>
        <call function="-nvl" group="sum" as="tu_no_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_no" table="main" />
            <fact column="vr_rb_fact_count_tu_mkd_no" table="main" />
            <fact column="vr_rb_fact_count_tu_izs_no" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_no" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_mkd_no" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_izs_no" table="prev_week" />
          </call>
        </call>
        <fact column="vr_rb_fact_count_tu_izs" group="sum" as="tu_izs" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_izs_0" group="sum" as="tu_izs_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_izs_null" group="sum" as="tu_izs_null" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_izs_auto" group="sum" as="tu_izs_auto" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_izs_hand" group="sum" as="tu_izs_hand" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_izs_no" group="sum" as="tu_izs_no" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_ul_auto" group="sum" as="tu_ul_auto" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_ul_hand" group="sum" as="tu_ul_hand" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_ul_no" group="sum" as="tu_ul_no" table="main" nullif="0" />
      </select>
      <from>
        <qube star-scheme="1">
          <link name="d49277_pwrc" />
          <link name="d49277_fdrid" />
          <link name="def_pwrc" />
          <link name="d49277_kod_fl_real" />
          <link name="d49277_bal_id" only-for-cond="1" />
          <where>
            <call function="and">
              <call function="in">
                <column table="d49277_kod_fl_real" column="kod_fl" />
                <useparam name="kod_fl" />
              </call>
              <call function="in" exclude="1">
                <column table="d49277_pwrc" column="pwrc_id" />
                <useparam name="hv_eopwrc_id" />
              </call>
              <call function="in">
                <column table="d49277_bal_id" column="hv_eopwrc_id" />
                <useparam name="hv_eopwrc_id" />
              </call>
              <call function="in">
                <column table="d49277_fdrid" column="pwrc_fdrid" />
                <useparam name="pwrc_fdrid" />
              </call>
            </call>
          </where>
          <dimset as="main">
            <link name="id_dat" only-for-cond="1" />
            <where>
              <call function="le">
                <call function="nvl0">
                  <column table="id_dat" column="id_dat" />
                </call>
                <useparam name="id_dat" />
              </call>
            </where>
          </dimset>
          <dimset as="prev_week">
            <link name="dat" only-for-cond="1" />
            <where>
              <call function="le">
                <call function="trunc">
                  <column table="dat" column="val" />
                </call>
                <call function="trunc">
                  <useparam name="prev_slice_dat" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="stage1">
            <link only-for-cond="1" name="ym" />
            <where>
              <call function="le">
                <column table="ym" column="val" />
                <column table="def_pwrc" column="stage1" />
              </call>
            </where>
          </dimset>
          <dimset as="stage2">
            <link only-for-cond="1" name="ym" />
            <where>
              <call function="le">
                <column table="ym" column="val" />
                <column table="def_pwrc" column="stage2" />
              </call>
            </where>
          </dimset>
        </qube>
      </from>
      <grouping>
        <grset as="all" title="Всего" />
        <grset as="fl" title="По филиалам" order="upper(fskname)">
          <group>
            <sourcelink table="d49277_kod_fl_real" />
          </group>
          <grset as="ps" title="По сетям" order="kod_id">
            <group>
              <sourcelink table="d49277_pwrc" />
            </group>
            <grset as="fdr" title="По фидерам" order="pwrc_fdrname nulls first">
              <group>
                <sourcelink table="d49277_fdrid" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="main_49277_31_without_kg" order="ym_start_analyz, pwrcn, pwrc_fdrname" timestamp="25.01.2023 14:20:02">
      <params>
        <param name="stage3" type="number">
          <const exclude="1">2020.12</const>
        </param>
        <param name="kod_fl" type="array">
          <array exclude="1">
            <const>12966</const>
          </array>
        </param>
        <param name="hv_eopwrc_id" type="array">
          <array exclude="1">
            <const>'56215-12966'</const>
          </array>
        </param>
        <param name="pwrc_id" type="array">
          <array exclude="1">
            <const>56215</const>
          </array>
        </param>
        <param name="k_kg_name" type="array">
          <array exclude="1">
            <const>'-220294-'</const>
          </array>
        </param>
        <param name="pwrc_fdrid" type="array">
          <array exclude="1">
            <const>56271</const>
            <const>56268</const>
          </array>
        </param>
      </params>
      <select>
        <column table="d49277_kod_fl_real" column="kod_fl" />
        <column table="d49277_pwrc" column="pwrc_id" />
        <column table="d49277_kod_fl_real" column="ym" />
        <column table="d49277_pwrc" column="pwrcname" />
        <column table="d49277_fdrid" column="pwrc_fdrid" />
        <column table="d49277_fdrid" column="pwrc_fdr_explname" />
        <column table="d49277_fdrid" column="pwrc_fdrname" />
        <column table="d49277_kod_fl_real" column="name" as="fskname" />
        <column table="d49277_pwrc" column="pwrcn" group="max" title="ДИСП №ПС" />
        <column table="def_pwrc" column="ym_start_analyz" group="max" />
        <column table="def_pwrc" column="kod_id" group="max" />
        <fact column="vr_rb_fact_count_tu_ul" group="sum" as="tu_ul_st2" table="stage2" nullif="0" />
        <fact column="vr_rb_fact_count_tu_nas" group="sum" as="tu_nas_st2" table="stage2" nullif="0" />
        <fact column="vr_rb_fact_count_tu_ul" group="sum" as="tu_ul" table="main" nullif="0" />
        <call group="sum" as="tu_dif_ul_1w" function="-nvl" nullif="0">
          <fact table="main" column="vr_rb_fact_count_tu_ul" />
          <fact table="prev_week" column="vr_rb_fact_count_tu_ul" />
        </call>
        <fact column="vr_rb_fact_count_tu_nas" group="sum" as="tu_nas" table="main" nullif="0" />
        <call group="sum" as="tu_dif_nas_1w" function="-nvl" nullif="0">
          <fact table="main" column="vr_rb_fact_count_tu_nas" />
          <fact table="prev_week" column="vr_rb_fact_count_tu_nas" />
        </call>
        <call group="sum" as="tu_dif_1w" function="-nvl" nullif="0">
          <fact table="main" column="vr_rb_fact_count_tu" />
          <fact table="prev_week" column="vr_rb_fact_count_tu" />
        </call>
        <call as="tu_0null_st2" function="+" group="sum" nullif="0">
          <fact column="vr_rb_fact_count_tu_0" table="stage2" />
          <fact column="vr_rb_fact_count_tu_null" table="stage2" />
        </call>
        <fact column="vr_rb_fact_count_tu_ul_0" group="sum" as="tu_ul_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_ul_null" group="sum" as="tu_ul_null" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_nas_0" group="sum" as="tu_nas_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_nas_null" group="sum" as="tu_nas_null" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_mkd" group="sum" as="tu_mkd" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_mkd_0" group="sum" as="tu_mkd_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_mkd_null" group="sum" as="tu_mkd_null" table="main" nullif="0" />
        <call function="-nvl" group="sum" as="tu_0null_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_0" table="main" />
            <fact column="vr_rb_fact_count_tu_ul_null" table="main" />
            <fact column="vr_rb_fact_count_tu_mkd_0" table="main" />
            <fact column="vr_rb_fact_count_tu_izs_0" table="main" />
            <fact column="vr_rb_fact_count_tu_mkd_null" table="main" />
            <fact column="vr_rb_fact_count_tu_izs_null" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_0" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_ul_null" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_mkd_0" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_izs_0" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_mkd_null" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_izs_null" table="prev_week" />
          </call>
        </call>
        <fact column="vr_rb_fact_count_tu_mkd_auto" group="sum" as="tu_mkd_auto" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_mkd_hand" group="sum" as="tu_mkd_hand" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_mkd_no" group="sum" as="tu_mkd_no" table="main" nullif="0" />
        <call function="-nvl" group="sum" as="tu_auto_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_auto" table="main" />
            <fact column="vr_rb_fact_count_tu_mkd_auto" table="main" />
            <fact column="vr_rb_fact_count_tu_izs_auto" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_auto" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_mkd_auto" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_izs_auto" table="prev_week" />
          </call>
        </call>
        <call function="-nvl" group="sum" as="tu_hand_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_hand" table="main" />
            <fact column="vr_rb_fact_count_tu_mkd_hand" table="main" />
            <fact column="vr_rb_fact_count_tu_izs_hand" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_hand" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_mkd_hand" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_izs_hand" table="prev_week" />
          </call>
        </call>
        <call function="-nvl" group="sum" as="tu_no_dif_1w" nullif="0">
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_no" table="main" />
            <fact column="vr_rb_fact_count_tu_mkd_no" table="main" />
            <fact column="vr_rb_fact_count_tu_izs_no" table="main" />
          </call>
          <call function="+nvl">
            <fact column="vr_rb_fact_count_tu_ul_no" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_mkd_no" table="prev_week" />
            <fact column="vr_rb_fact_count_tu_izs_no" table="prev_week" />
          </call>
        </call>
        <fact column="vr_rb_fact_count_tu_izs" group="sum" as="tu_izs" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_izs_0" group="sum" as="tu_izs_0" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_izs_null" group="sum" as="tu_izs_null" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_izs_auto" group="sum" as="tu_izs_auto" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_izs_hand" group="sum" as="tu_izs_hand" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_izs_no" group="sum" as="tu_izs_no" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_ul_auto" group="sum" as="tu_ul_auto" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_ul_hand" group="sum" as="tu_ul_hand" table="main" nullif="0" />
        <fact column="vr_rb_fact_count_tu_ul_no" group="sum" as="tu_ul_no" table="main" nullif="0" />
      </select>
      <from>
        <qube star-scheme="1">
          <link name="d49277_pwrc" />
          <link name="d49277_fdrid" />
          <link name="def_pwrc" />
          <link name="d49277_kod_fl_real" />
          <link name="d49277_bal_id" only-for-cond="1" />
          <link name="def_fdr" />
          <where>
            <call function="and">
              <call function="in">
                <column table="d49277_kod_fl_real" column="kod_fl" />
                <useparam name="kod_fl" />
              </call>
              <call function="in">
                <column table="d49277_bal_id" column="hv_eopwrc_id" />
                <useparam name="hv_eopwrc_id" />
              </call>
              <call function="in">
                <column table="d49277_fdrid" column="pwrc_fdrid" />
                <useparam name="pwrc_fdrid" />
              </call>
              <call function="in">
                <column table="def_fdr" column="pwrc_fdrid" />
                <useparam name="pwrc_fdrid" />
              </call>
            </call>
          </where>
          <dimset as="main" exclude="1">
            <link name="id_dat" only-for-cond="1" />
            <where>
              <call function="le">
                <call function="nvl0">
                  <column table="id_dat" column="id_dat" />
                </call>
                <useparam name="id_dat" />
              </call>
            </where>
          </dimset>
          <dimset as="main">
            <link name="ym" only-for-cond="1" />
            <where>
              <call function="le">
                <column table="ym" column="val" />
                <useparam name="stage3" />
              </call>
            </where>
          </dimset>
          <dimset as="prev_week" exclude="1">
            <link name="dat" only-for-cond="1" />
            <where>
              <call function="le">
                <call function="trunc">
                  <column table="dat" column="val" />
                </call>
                <call function="trunc">
                  <useparam name="prev_slice_dat" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="prev_week">
            <link name="ym" only-for-cond="1" />
            <where>
              <call function="le">
                <column table="ym" column="val" />
                <call function="ym add month">
                  <useparam name="stage3" />
                  <const>-1</const>
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="stage1">
            <link only-for-cond="1" name="ym" />
            <where>
              <call function="le">
                <column table="ym" column="val" />
                <column table="def_pwrc" column="stage1" />
              </call>
            </where>
          </dimset>
          <dimset as="stage2">
            <link only-for-cond="1" name="ym" />
            <where>
              <call function="le">
                <column table="ym" column="val" />
                <column table="def_pwrc" column="stage2" />
              </call>
            </where>
          </dimset>
        </qube>
      </from>
      <grouping>
        <grset as="all" title="Всего" />
        <grset as="fl" title="По филиалам" order="upper(fskname)">
          <group>
            <sourcelink table="d49277_kod_fl_real" />
          </group>
          <grset as="ps" title="По сетям" order="kod_id">
            <group>
              <sourcelink table="d49277_pwrc" />
            </group>
            <grset as="fdr" title="По фидерам" order="pwrc_fdrname nulls first">
              <group>
                <sourcelink table="d49277_fdrid" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
  </queries>
  <reports>
    <report name="49277" title="Отчет о выполненных работах по устранению пофидерных небалансов" mode="excel" timestamp="26.02.2019 16:52:13" form="empty" nogrid="1" visible="0">
      <print-templates>
        <excel>
          <template name="49277.xlsx" title="Отчет о выполненных работах по устранению пофидерных небалансов" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="title_49277" as="t" />
        <query name="main_49277" as="a" />
      </queries>
    </report>
    <report name="49277_test" title="Отчет о выполненных работах по устранению пофидерных небалансов ТЕСТ" mode="excel" timestamp="26.02.2019 16:53:42" form="49277_test" nogrid="1" visible="0">
      <params>
        <param name="ym_s" type="number" />
        <param name="ym_po" type="number" />
      </params>
      <procedure>
        <text>
    DECLARE
        id_dat__ number;
    BEGIN
        select max(id_dat)
        into id_dat__
        from vr_rb_dat;
    
        sqlb_d45862_fdr_kg.fill_table_fl_ym(id_dat__);
        
        delete from rr_temp where skod = '45862_fdr_lst';
        insert into rr_temp (skod, n1)
        select distinct '45862_fdr_lst' as skod, a.pwrc_fdrid
        from vr_rb_fider a
        where a.pwrc_fdrid in (8873, 8874, 8875, 8876, 8872, 56264, 56274, 56276, 56266, 56268, 56269, 56270, 56271,
                                56272, 56273, 1865, 1866, 1867, 1868, 79387, 79388, 79491, 59181, 59180, 59179, 59177,
                                59182, 59183, 59184, 382276, 472188, 1229, 6670, 6667, 85354, 85355);
                                
        jg_reports_ise.jr_rep_blns_pwrc_sx_init(0, 1);
        --sqlb_d45862_fdr_kg.fill_table(:ym_s, :ym_po);
        sqlb_d45862_fdr_kg.FILL_TEMP(:ym_s, :ym_po);
        asuse.sqlb_d45862_fdr_kg.fill_table_by_dat(0);
    END;
</text>
      </procedure>
      <print-templates>
        <excel>
          <template name="49277_test.xlsx" title="Отчет о выполненных работах по устранению пофидерных небалансов" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="title_49277" as="t" />
        <query name="main_49277_test" as="a" />
      </queries>
    </report>
    <report name="49277_test2" form="49277_test2" nogrid="1" mode="excel" title="3.2. Отчет о выполненных работах по устранению небалансов за неделю" timestamp="15.12.2022 19:00:00">
      <customers>
        <customer id="17" />
      </customers>
      <params>
        <param name="id_dat" type="number" />
        <param name="w_num" type="string" />
        <param name="kod_fl" type="array" mode="store" />
        <param name="hv_eopwrc_id" type="array" />
        <param name="pwrc_id" type="array" />
        <param name="k_kg_name" type="array" />
        <param name="pwrc_fdrid" type="array" mode="store" />
        <param name="prev_slice_dat" type="date" />
      </params>
      <procedure><![CDATA[DECLARE
  p_id_dat   vr_rb_fact.id_dat%type;
  n_ym_s     NUMBER(6, 2);
  n_ym_po    NUMBER(6, 2);
BEGIN
  p_id_dat := :id_dat;
  -- Определяем ym
  select case when min(a.ym)=0 then kg.ym_add(max(a.ym), -1) else min(a.ym) end,
         max(a.ym)
  into   n_ym_s, n_ym_po
  from   vr_rb_fact a
  where  a.id_dat <= :id_dat;
  --
  DELETE FROM vr_array_storage WHERE array_id = 'fl_id';
  INSERT INTO vr_array_storage (array_id, nval)
    SELECT 'fl_id', nval FROM vr_array_storage WHERE array_id = 'kod_fl';
  jg_reports_ise.jr_rep_blns_pwrc_sx_init(0, 1);
  --
  -- sqlb_d45862_fdr_kg.FILL_TEMP(ym_s__, ym_po__);
  DELETE FROM rr_temp WHERE skod IN ('{8AF26E4F-7324-4724-8038-724EF07A3B09}', '45862_tp_kg', 'd45862_fdr_kg');
  INSERT INTO rr_temp (skod, n1, n2, s1, s2)
    SELECT '{8AF26E4F-7324-4724-8038-724EF07A3B09}', pwrc_fdrid, src_id, srcname, srcbalname
    FROM   hv_eopwrc_grid
    WHERE  pwrc_fdrid IN (SELECT nval FROM vr_array_storage WHERE array_id = 'pwrc_fdrid')
    UNION
    SELECT '{8AF26E4F-7324-4724-8038-724EF07A3B09}', a.pwrc_fdrid, a.src_id, NVL(b.srcname, a.srcname) AS srcname, NVL(b.srcbalname, a.srcbalname) AS srcbalname
    FROM   vr_rb_tp a LEFT OUTER JOIN hv_eopwrc_grid b on a.pwrc_fdrid = b.pwrc_fdrid and a.src_id = b.src_id
    WHERE  a.pwrc_fdrid IN (SELECT nval FROM vr_array_storage WHERE array_id = 'pwrc_fdrid');
  --
  -- 45862_tp_kg
  INSERT INTO rr_temp (skod, s1, -- id
                     s2, --k_gr_f_tp
                     s3, --k_f_tp
                     n1, --is_tp_gr
                     s4, --name
                     n2, --kod_kol_gr
                     n3--ym
                     )
    SELECT '45862_tp_kg' as skod,
           kod_kol_gr.kod_kol_gr||'-'||a.pwrc_fdrid||'-'||tpn.src_id||ym as id,
           kod_kol_gr.kod_kol_gr||'-'||a.pwrc_fdrid||'-'||tpn.src_id as k_gr_f_tp,
           a.pwrc_fdrid||'-'||tpn.src_id as k_f_tp,
           case when tp.src_id is not null or tpsel.kod_kol_gr_fdr is null or tpn.src_id is null then 1 else 0 end as is_tp_gr,
           kod_kol_gr.name||case when kod_kol_gr.kol_gr_comment is not null then ' ['||kod_kol_gr.kol_gr_comment||']' end as name,
           kod_kol_gr.kod_kol_gr, ym.ym
    FROM   vb_kol_gr_fdr a
           left outer join (select kod_kol_gr_fdr from vb_kol_gr_tp group by kod_kol_gr_fdr) tpsel on a.kod_kol_gr_fdr = tpsel.kod_kol_gr_fdr
           left outer join vb_kol_gr_pwrc kod_kol_gr_pwrc on a.kod_kol_gr_pwrc = kod_kol_gr_pwrc.kod_kol_gr_pwrc
           left outer join vb_kol_gr_nastr kod_kol_gr_nastr on kod_kol_gr_pwrc.kod_kol_gr_nastr = kod_kol_gr_nastr.kod_kol_gr_nastr
           left outer join (SELECT t.column_value as ym FROM TABLE(kg.ym_numerator(n_ym_s, n_ym_po)) t) ym on ym.ym between kod_kol_gr_nastr.s and nvl(kod_kol_gr_nastr.po, n_ym_po)
           left outer join vb_kol_gr kod_kol_gr on kod_kol_gr_nastr.kod_kol_gr = kod_kol_gr.kod_kol_gr
           left outer join (SELECT n1 as pwrc_fdrid, n2 as src_id FROM rr_temp WHERE skod = '{8AF26E4F-7324-4724-8038-724EF07A3B09}') tpn on a.pwrc_fdrid = tpn.pwrc_fdrid
           left outer join vb_kol_gr_tp tp on a.kod_kol_gr_fdr = tp.kod_kol_gr_fdr and (tpn.src_id = tp.src_id);
  -- d45862_fdr_kg
  INSERT INTO rr_temp (skod, --skod
                     sid, --sid
                     rn, --rn
                     s1, --id
                     s2, --k_gr_f_tp
                     s3, --k_f_tp
                     s4, --k_kg_name
                     n1, --pwrc_id
                     s5, --kg_name
                     n2, --kod_kol_gr
                     n3, --pwrc_fdrid
                     s6, --real_fdr
                     s7, --isprm_fdr
                     s8, --pwrc_fdr_explname
                     n4, --src_id
                     s9, --srcname
                     s10, --srcbalname
                     n5, --ym
                     s11 --kg_name_w_real_fdr
                     )
     select 'd45862_fdr_kg' as skod, 'd45862_fdr_kg|#'||mtr.id as sid, row_number() over (order by 1) as rn, mtr.*
     from  (select case when (tp_kg.is_tp_gr = 1) then tp_kg.id else ('' || '-' || hv_eopwrc_grid.hv_eopwrc_grid_id || '-' || ym.ym ) end as id,
                   case when (tp_kg.is_tp_gr = 1) then tp_kg.k_gr_f_tp else ('' || '-' || hv_eopwrc_grid.hv_eopwrc_grid_id) end as k_gr_f_tp,
                   hv_eopwrc_grid.hv_eopwrc_grid_id as k_f_tp,
                   case when (tp_kg.is_tp_gr = 1) then (tp_kg.kod_kol_gr || '-') else ('-' || a.pwrc_fdrid || '-') end as k_kg_name,
                   a.pwrc_id as pwrc_id,
                   case when (tp_kg.is_tp_gr = 1) then tp_kg.name else a.pwrc_fdrname end as kg_name,
                   case when (tp_kg.is_tp_gr = 1) then tp_kg.kod_kol_gr end as kod_kol_gr,
                   a.pwrc_fdrid as pwrc_fdrid,
                   ( SUBSTR( a.pwrcname , ( nvl( ( instr( a.pwrcname , '(' ) ) ,0) +nvl( 1 ,0) ) , (( instr( a.pwrcname , ')' ) ) - ( instr( a.pwrcname , '(' ) ) - 1) ) ) || ' (' || a.pwrc_fdrname || ')' as real_fdr,
                   a.isprm_fdr as isprm_fdr,
                   a.pwrc_fdr_explname as pwrc_fdr_explname,
                   hv_eopwrc_grid.src_id as src_id,
                   hv_eopwrc_grid.srcname as srcname,
                   hv_eopwrc_grid.srcbalname as srcbalname,
                   ym.ym as ym,
                   case when (tp_kg.is_tp_gr = 1) then tp_kg.name else ( SUBSTR( a.pwrcname , ( nvl( ( instr( a.pwrcname , '(' ) ) ,0) +nvl( 1 ,0) ) , (( instr( a.pwrcname , ')' ) ) - ( instr( a.pwrcname , '(' ) ) - 1) ) ) || ' (' || a.pwrc_fdrname || ')' end as kg_name_w_real_fdr
            from  (select a.pwrc_fdrid, a.pwrc_fdrname, a.isprm_fdr, a.pwrc_id, a.pwrcname, a.pwrc_fdr_explname
                   from   hv_eopwrc_fdrs a
                   WHERE  a.pwrc_fdrid IN (SELECT nval FROM vr_array_storage WHERE array_id = 'pwrc_fdrid')) a
                   cross join (SELECT t.column_value as ym FROM TABLE(kg.ym_numerator(n_ym_s, n_ym_po)) t) ym
                   left outer join (SELECT TO_CHAR(n1)||'-'||TO_CHAR(n2) as hv_eopwrc_grid_id,  n1 as pwrc_fdrid, n2 AS src_id, s1 AS srcname, s2 AS srcbalname FROM rr_temp WHERE skod = '{8AF26E4F-7324-4724-8038-724EF07A3B09}') hv_eopwrc_grid on hv_eopwrc_grid.pwrc_fdrid = a.pwrc_fdrid
                   left outer join (select /*+ dynamic_sampling(rr_temp 10)*/ s1 as id, s2 as k_gr_f_tp, s3 as k_f_tp, n1 as is_tp_gr, s4 as name, n2 as kod_kol_gr, n3 as ym from rr_temp where skod = '45862_tp_kg') tp_kg on tp_kg.k_f_tp = hv_eopwrc_grid.hv_eopwrc_grid_id and tp_kg.ym = ym.ym
            where  nvl(tp_kg.is_tp_gr, 1) = 1
               and a.pwrc_fdrid in (SELECT nval FROM vr_array_storage WHERE array_id = 'pwrc_fdrid')) mtr;
  --
  sqlb_d45862_fdr_kg.fill_table_by_dat(p_id_dat);
  DELETE FROM rr_temp WHERE skod IN ('{8AF26E4F-7324-4724-8038-724EF07A3B09}', '45862_tp_kg');
END;]]></procedure>
      <print-templates>
        <excel>
          <template name="49277_test2.xlsx" title="Отчет о выполненных работах по устранению пофидерных небалансов за неделю" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="title_49277" as="t">
          <withparams>
            <usepart part="49277-useparams_test2" />
          </withparams>
        </query>
        <query name="main_49277_32" as="a">
          <withparams>
            <usepart part="49277-useparams_test2" />
          </withparams>
        </query>
        <query name="main_49277_32_without_kg" as="b">
          <withparams>
            <usepart part="49277-useparams_test2" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="49277_test3" form="49277_test3" nogrid="1" mode="excel" title="3.1. Отчет о выполненных работах по устранению небалансов за период" timestamp="15.12.2022 17:30:00">
      <customers>
        <customer id="17" />
      </customers>
      <params>
        <param name="stage3" type="number" />
        <param name="kod_fl" type="array" mode="store" />
        <param name="hv_eopwrc_id" type="array" mode="store" />
        <param name="pwrc_id" type="array" mode="store" />
        <param name="k_kg_name" type="array" mode="store" />
        <param name="pwrc_fdrid" type="array" mode="store" />
      </params>
      <procedure><![CDATA[DECLARE
  p_ym  NUMBER(6,2);
BEGIN
  p_ym := :stage3;
  --
  DELETE FROM vr_array_storage WHERE array_id = 'fl_id';
  INSERT INTO vr_array_storage (array_id, nval)
    SELECT 'fl_id', nval FROM vr_array_storage WHERE array_id = 'kod_fl';
  jg_reports_ise.jr_rep_blns_pwrc_sx_init(0, 1);
  --
  -- sqlb_d45862_fdr_kg.FILL_TEMP(p_ym, p_ym);
  DELETE FROM rr_temp WHERE skod IN ('{D1DEC229-CEA9-4E18-B269-14ACE3A371BA}', '45862_tp_kg', 'd45862_fdr_kg');
  INSERT INTO rr_temp (skod, n1, n2, s1, s2)
    SELECT '{D1DEC229-CEA9-4E18-B269-14ACE3A371BA}', pwrc_fdrid, src_id, srcname, srcbalname
    FROM   hv_eopwrc_grid
    WHERE  pwrc_fdrid IN (SELECT nval FROM vr_array_storage WHERE array_id = 'pwrc_fdrid')
    UNION
    SELECT '{D1DEC229-CEA9-4E18-B269-14ACE3A371BA}', a.pwrc_fdrid, a.src_id, NVL(b.srcname, a.srcname) AS srcname, NVL(b.srcbalname, a.srcbalname) AS srcbalname
    FROM   vr_rb_tp a LEFT OUTER JOIN hv_eopwrc_grid b on a.pwrc_fdrid = b.pwrc_fdrid and a.src_id = b.src_id
    WHERE  a.pwrc_fdrid IN (SELECT nval FROM vr_array_storage WHERE array_id = 'pwrc_fdrid');
  -- 45862_tp_kg
  INSERT INTO rr_temp (skod, s1, -- id
                     s2, --k_gr_f_tp
                     s3, --k_f_tp
                     n1, --is_tp_gr
                     s4, --name
                     n2, --kod_kol_gr
                     n3--ym
                     )
    SELECT '45862_tp_kg' as skod,
           kod_kol_gr.kod_kol_gr||'-'||a.pwrc_fdrid||'-'||tpn.src_id||ym as id,
           kod_kol_gr.kod_kol_gr||'-'||a.pwrc_fdrid||'-'||tpn.src_id as k_gr_f_tp,
           a.pwrc_fdrid||'-'||tpn.src_id as k_f_tp,
           case when tp.src_id is not null or tpsel.kod_kol_gr_fdr is null or tpn.src_id is null then 1 else 0 end as is_tp_gr,
           kod_kol_gr.name||case when kod_kol_gr.kol_gr_comment is not null then ' ['||kod_kol_gr.kol_gr_comment||']' end as name,
           kod_kol_gr.kod_kol_gr, ym.ym
    FROM   vb_kol_gr_fdr a
           left outer join (select kod_kol_gr_fdr from vb_kol_gr_tp group by kod_kol_gr_fdr) tpsel on a.kod_kol_gr_fdr = tpsel.kod_kol_gr_fdr
           left outer join vb_kol_gr_pwrc kod_kol_gr_pwrc on a.kod_kol_gr_pwrc = kod_kol_gr_pwrc.kod_kol_gr_pwrc
           left outer join vb_kol_gr_nastr kod_kol_gr_nastr on kod_kol_gr_pwrc.kod_kol_gr_nastr = kod_kol_gr_nastr.kod_kol_gr_nastr
           left outer join (SELECT p_ym as ym FROM dual) ym on ym.ym between kod_kol_gr_nastr.s and nvl(kod_kol_gr_nastr.po, p_ym)
           left outer join vb_kol_gr kod_kol_gr on kod_kol_gr_nastr.kod_kol_gr = kod_kol_gr.kod_kol_gr
           left outer join (SELECT n1 as pwrc_fdrid, n2 as src_id FROM rr_temp WHERE skod = '{D1DEC229-CEA9-4E18-B269-14ACE3A371BA}') tpn on a.pwrc_fdrid = tpn.pwrc_fdrid
           left outer join vb_kol_gr_tp tp on a.kod_kol_gr_fdr = tp.kod_kol_gr_fdr and (tpn.src_id = tp.src_id);
  -- d45862_fdr_kg
  INSERT INTO rr_temp (skod, --skod
                     sid, --sid
                     rn, --rn
                     s1, --id
                     s2, --k_gr_f_tp
                     s3, --k_f_tp
                     s4, --k_kg_name
                     n1, --pwrc_id
                     s5, --kg_name
                     n2, --kod_kol_gr
                     n3, --pwrc_fdrid
                     s6, --real_fdr
                     s7, --isprm_fdr
                     s8, --pwrc_fdr_explname
                     n4, --src_id
                     s9, --srcname
                     s10, --srcbalname
                     n5, --ym
                     s11 --kg_name_w_real_fdr
                     )
     select 'd45862_fdr_kg' as skod, 'd45862_fdr_kg|#'||mtr.id as sid, row_number() over (order by 1) as rn, mtr.*
     from  (select case when (tp_kg.is_tp_gr = 1) then tp_kg.id else ('' || '-' || hv_eopwrc_grid.hv_eopwrc_grid_id || '-' || ym.ym ) end as id,
                   case when (tp_kg.is_tp_gr = 1) then tp_kg.k_gr_f_tp else ('' || '-' || hv_eopwrc_grid.hv_eopwrc_grid_id) end as k_gr_f_tp,
                   hv_eopwrc_grid.hv_eopwrc_grid_id as k_f_tp,
                   case when (tp_kg.is_tp_gr = 1) then (tp_kg.kod_kol_gr || '-') else ('-' || a.pwrc_fdrid || '-') end as k_kg_name,
                   a.pwrc_id as pwrc_id,
                   case when (tp_kg.is_tp_gr = 1) then tp_kg.name else a.pwrc_fdrname end as kg_name,
                   case when (tp_kg.is_tp_gr = 1) then tp_kg.kod_kol_gr end as kod_kol_gr,
                   a.pwrc_fdrid as pwrc_fdrid,
                   ( SUBSTR( a.pwrcname , ( nvl( ( instr( a.pwrcname , '(' ) ) ,0) +nvl( 1 ,0) ) , (( instr( a.pwrcname , ')' ) ) - ( instr( a.pwrcname , '(' ) ) - 1) ) ) || ' (' || a.pwrc_fdrname || ')' as real_fdr,
                   a.isprm_fdr as isprm_fdr,
                   a.pwrc_fdr_explname as pwrc_fdr_explname,
                   hv_eopwrc_grid.src_id as src_id,
                   hv_eopwrc_grid.srcname as srcname,
                   hv_eopwrc_grid.srcbalname as srcbalname,
                   ym.ym as ym,
                   case when (tp_kg.is_tp_gr = 1) then tp_kg.name else ( SUBSTR( a.pwrcname , ( nvl( ( instr( a.pwrcname , '(' ) ) ,0) +nvl( 1 ,0) ) , (( instr( a.pwrcname , ')' ) ) - ( instr( a.pwrcname , '(' ) ) - 1) ) ) || ' (' || a.pwrc_fdrname || ')' end as kg_name_w_real_fdr
            from  (select a.pwrc_fdrid, a.pwrc_fdrname, a.isprm_fdr, a.pwrc_id, a.pwrcname, a.pwrc_fdr_explname
                   from   hv_eopwrc_fdrs a
                   WHERE  a.pwrc_fdrid IN (SELECT nval FROM vr_array_storage WHERE array_id = 'pwrc_fdrid')) a
                   cross join (SELECT p_ym as ym FROM dual) ym
                   left outer join (SELECT TO_CHAR(n1)||'-'||TO_CHAR(n2) as hv_eopwrc_grid_id,  n1 as pwrc_fdrid, n2 AS src_id, s1 AS srcname, s2 AS srcbalname FROM rr_temp WHERE skod = '{D1DEC229-CEA9-4E18-B269-14ACE3A371BA}') hv_eopwrc_grid on hv_eopwrc_grid.pwrc_fdrid = a.pwrc_fdrid
                   left outer join (select /*+ dynamic_sampling(rr_temp 10)*/ s1 as id, s2 as k_gr_f_tp, s3 as k_f_tp, n1 as is_tp_gr, s4 as name, n2 as kod_kol_gr, n3 as ym from rr_temp where skod = '45862_tp_kg') tp_kg on tp_kg.k_f_tp = hv_eopwrc_grid.hv_eopwrc_grid_id and tp_kg.ym = ym.ym
            where  nvl(tp_kg.is_tp_gr, 1) = 1
               and a.pwrc_fdrid in (SELECT nval FROM vr_array_storage WHERE array_id = 'pwrc_fdrid')) mtr;
  sqlb_d45862_fdr_kg.fill_table_by_dat(0);
  DELETE FROM rr_temp WHERE skod IN ('{D1DEC229-CEA9-4E18-B269-14ACE3A371BA}', '45862_tp_kg');
END;]]></procedure>
      <print-templates>
        <excel>
          <template name="49277_test3.xlsx" title="Отчет о выполненных работах по устранению пофидерных небалансов за отчетный период" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="title_49277_test3" as="t">
          <withparams>
            <useparam name="stage3" />
            <useparam name="kod_fl" />
            <useparam name="hv_eopwrc_id" />
            <useparam name="pwrc_id" />
            <useparam name="k_kg_name" />
            <useparam name="pwrc_fdrid" />
          </withparams>
        </query>
        <query name="main_49277_31" as="a">
          <withparams>
            <useparam name="stage3" />
            <useparam name="kod_fl" />
            <useparam name="hv_eopwrc_id" />
            <useparam name="pwrc_id" />
            <useparam name="k_kg_name" />
            <useparam name="pwrc_fdrid" />
          </withparams>
        </query>
        <query name="main_49277_31_without_kg" as="b">
          <withparams>
            <useparam name="stage3" />
            <useparam name="kod_fl" />
            <useparam name="hv_eopwrc_id" />
            <useparam name="pwrc_id" />
            <useparam name="k_kg_name" />
            <useparam name="pwrc_fdrid" />
          </withparams>
        </query>
      </queries>
    </report>
  </reports>
  <forms>
    <form name="49277_test" timestamp="01.02.2019 18:31:48">
      <usefield field="cmn_combo_num" name="ym_s" column-mandatory="1" column-visible="0">
        <listquery>
          <query name="49277-yms" />
        </listquery>
        <defaultquery>
          <query name="49277-yms" />
        </defaultquery>
      </usefield>
      <usefield field="cmn_combo_num" name="ym_po" column-mandatory="1" column-visible="0">
        <listquery>
          <query name="49277-ym_po" />
        </listquery>
        <defaultquery>
          <query name="49277-ym_po" />
        </defaultquery>
      </usefield>
    </form>
    <form name="49277_test2" timestamp="01.10.2020 18:27:31">
      <usefield field="cmn_combo_num" name="id_dat" column-mandatory="1" title="Номер недели">
        <listquery>
          <query name="49277-dats" />
        </listquery>
      </usefield>
      <usefield field="cmn_string" name="w_num" column-visible="0">
        <defaultquery>
          <query name="49277-week_num" />
        </defaultquery>
      </usefield>
      <usefield field="cmn_list" title="Филиал" name="kod_fl" column-mandatory="1" type="number">
        <listquery>
          <query name="jv_rep_cons_d_fl" />
        </listquery>
        <defaultquery>
          <query name="45862-kod_fl-def" />
        </defaultquery>
      </usefield>
      <usefield field="cmn_list" title="Подстанции" name="hv_eopwrc_id" type="string" column-mandatory="1">
        <listquery>
          <query name="hv_eopwrc_list_test2" />
        </listquery>
        <defaultquery>
          <query name="49277_pwrc_def_test2" />
        </defaultquery>
      </usefield>
      <usefield field="cmn_list" title="Подстанции" name="pwrc_id" type="number" column-mandatory="1" visible="0">
        <listquery>
          <query name="vr_rb_pwrc_list_by_hv_eopwrc_id" />
        </listquery>
        <defaultquery>
          <query name="vr_rb_pwrc_list_by_hv_eopwrc_id" />
        </defaultquery>
      </usefield>
      <usefield field="cmn_list" title="Фидеры" name="k_kg_name" type="string" column-mandatory="1">
        <listquery>
          <query name="45862_kg_name_list_test2" />
        </listquery>
        <defaultquery>
          <query name="45862_kg_name_default_test2" />
        </defaultquery>
      </usefield>
      <usefield field="cmn_list" title="Фидеры без КГ" name="pwrc_fdrid" type="number" column-visible="0">
        <listquery>
          <query name="45862_fdr_by_kn_name_list_test2" />
        </listquery>
        <defaultquery>
          <query name="45862_fdr_by_kn_name_list_test2" />
        </defaultquery>
      </usefield>
      <usefield field="cmn_date" name="prev_slice_dat" title="Динамика относительно даты" column-editable="0">
        <defaultquery>
          <query name="49277-dat_slice_week_before" />
        </defaultquery>
      </usefield>
    </form>
    <form name="49277_test3" timestamp="31.05.2022 10:37:48">
      <usefield field="cmn_combo_num" name="stage3" title="Отчетный период" column-mandatory="1">
        <listquery>
          <query name="49277_51730-dat_by_id" />
        </listquery>
      </usefield>
      <usefield field="cmn_list" title="Филиал" name="kod_fl" column-mandatory="1" type="number">
        <listquery>
          <query name="jv_rep_cons_d_fl" />
        </listquery>
        <defaultquery>
          <query name="45862-kod_fl-def" />
        </defaultquery>
      </usefield>
      <usefield field="cmn_list" title="Подстанции" name="hv_eopwrc_id" type="string" column-mandatory="1">
        <listquery>
          <query name="hv_eopwrc_list_test2" />
        </listquery>
        <defaultquery exclude="1">
          <query name="49277_pwrc_def_test3" exclude="1" />
        </defaultquery>
      </usefield>
      <usefield field="cmn_list" title="Подстанции" name="pwrc_id" type="number" column-mandatory="1" visible="0">
        <listquery>
          <query name="vr_rb_pwrc_list_by_hv_eopwrc_id" />
        </listquery>
        <defaultquery exclude="1">
          <query name="vr_rb_pwrc_list_by_hv_eopwrc_id" exclude="1" />
        </defaultquery>
      </usefield>
      <usefield field="cmn_list" title="Фидеры" name="k_kg_name" type="string" column-mandatory="1">
        <listquery>
          <query name="45862_kg_name_list_test2" />
        </listquery>
        <defaultquery>
          <query name="45862_kg_name_default_test2" />
        </defaultquery>
      </usefield>
      <usefield field="cmn_list" title="Фидеры без КГ" name="pwrc_fdrid" type="number" column-visible="0">
        <listquery>
          <query name="45862_fdr_by_kn_name_list_test2" />
        </listquery>
        <defaultquery>
          <query name="45862_fdr_by_kn_name_list_test2" />
        </defaultquery>
      </usefield>
    </form>
  </forms>
  <parts>
    <part id="49277-params_test2" timestamp="13.10.2020 18:41:02">
      <param name="id_dat" type="number">
        <const>4041</const>
      </param>
      <param name="w_num" type="string" />
      <param name="kod_fl" type="array">
        <const>12968</const>
      </param>
      <param name="hv_eopwrc_id" type="array" />
      <param name="pwrc_id" type="array" />
      <param name="k_kg_name" type="array" />
      <param name="pwrc_fdrid" type="array" />
      <param name="prev_slice_dat" type="date" />
    </part>
    <part id="49277-useparams_test2" timestamp="01.10.2020 18:21:46">
      <useparam name="id_dat" />
      <useparam name="w_num" />
      <useparam name="kod_fl" />
      <useparam name="hv_eopwrc_id" />
      <useparam name="pwrc_id" />
      <useparam name="k_kg_name" />
      <useparam name="pwrc_fdrid" />
      <useparam name="prev_slice_dat" />
    </part>
  </parts>
</root>