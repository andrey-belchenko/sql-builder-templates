<?xml version="1.0" encoding="utf-8"?>
<root>
  <form name="49277_vb_rb_default" timestamp="30.01.2023 11:53:02" title="3.3. Настройка формы отчета о выполненных работах (фиксация параметров)" file="sql.builder.templates\sql.builder\projects\49277\form\forms.xml" elid="85" ord="85" leaf="0" lvl="2" pelid="">
    <field id="11651187" controlType="UIList" title="Филиал" name="kod_fl" column-mandatory="1" type="number" show-checkbox="0">
      <listquery>
        <query name="jv_rep_cons_d_fl" />
      </listquery>
    </field>
    <splitcontainer id="20146264">
      <fieldgroup title="ПС" id="50080089">
        <grid table="def_pwrc" show-toolbar="1" show-checkbox="1" auto-filter="1" id="50328821">
          <toolbar id="40798516">
            <uicommand button-type="grid-add" visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" title="" id="30322684" />
            <uicommand button-type="grid-delete" column-visible="0" name="grid-delete" control-name="ButtonDeleteRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" title="" id="14364352" />
            <uicommand title="Добавить" action-type="custom" editable="kod_fl" button-type="custom-add-form" name="custom-add-form" icon="AddForm_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" id="3362450">
              <useaction action-type="save" id="3358927" />
              <useaction action-type="dynamic-form-create-multiple" call="49277_vb_rb_default_pwrc" modal="1" title="Добавить" id="30953099">
                <useparam name="kod_fl" id="30509074" />
              </useaction>
            </uicommand>
            <uicommand action-type="custom" prompt="Вы уверены, что хотите удалить отмеченные ПС?" title="Удалить отмеченные" button-type="custom-delete" editable="kod_fl" name="custom-delete" icon="Delete_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" id="66059209">
              <useaction action-type="client-remove-row" id="30822681" />
              <useaction action-type="save" object="def_pwrc" id="58864104" />
              <useaction action-type="refresh-table" object="def_pwrc" id="4413921" />
              <useaction action-type="refresh-table" object="def_fdrid" id="57294651" />
            </uicommand>
          </toolbar>
          <columns id="57117905">
            <field table="def_pwrc" name="name" title="Филиал" width="316" controlType="UIText" rows-limit="100" id="7189308" />
            <field table="def_pwrc" name="pwrcn" title="ПС" width="316" controlType="UIText" rows-limit="100" id="43886902" />
            <field table="def_pwrc" name="stage1" title="1 этап (до актуализации ИСЭ)" width="101" controlType="UIText" edit-mask="N2" rows-limit="100" id="9438510" />
            <field table="def_pwrc" name="stage2" title="2 этап (после актуализации ИСЭ)" width="107" controlType="UIText" edit-mask="N2" rows-limit="100" id="29124699" />
            <field table="def_pwrc" name="tm_start_an_str" title="Начало анализа" controlType="UIText" rows-limit="100" id="53616519" />
          </columns>
        </grid>
      </fieldgroup>
      <fieldgroup title="Фидеры" id="49238454">
        <grid table="def_fdrid" show-toolbar="1" show-checkbox="1" auto-filter="1" id="36746785">
          <toolbar id="14720554">
            <uicommand button-type="grid-add" visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" title="" id="27942942" />
            <uicommand button-type="grid-delete" column-visible="0" name="grid-delete" control-name="ButtonDeleteRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" title="" id="3893950" />
            <uicommand button-type="grid-save" column-visible="0" name="grid-save" control-name="ButtonCommit" file="sql.builder.templates\sql.builder\projects\common\main.xml" title="" id="11017289" />
            <uicommand title="Добавить" action-type="custom" editable="kod_fl" button-type="custom-add-form" name="custom-add-form" icon="AddForm_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" id="34779844">
              <useaction action-type="save" id="41014697" />
              <useaction action-type="dynamic-form-create-multiple" call="49277_vb_rb_default_fdr" modal="1" title="Добавить" id="3406913">
                <useparam name="kod_fl" id="26429406" />
              </useaction>
            </uicommand>
            <uicommand action-type="custom" prompt="Вы уверены, что хотите удалить отмеченные фидеры?" title="Удалить отмеченные" button-type="custom-delete" editable="kod_fl" name="custom-delete" icon="Delete_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" id="54455716">
              <useaction action-type="client-remove-row" id="8398383" />
              <useaction action-type="save" object="def_fdrid" id="9258595" />
              <useaction action-type="refresh-table" object="def_fdrid" id="18708634" />
            </uicommand>
          </toolbar>
          <columns id="18509657">
            <field table="def_pwrc" name="name" title="Филиал" width="316" controlType="UIText" rows-limit="100" id="35060974" />
            <field table="def_fdrid" name="pwrcname" title="ПС" width="316" controlType="UIText" rows-limit="100" id="21502506" />
            <field table="def_fdrid" name="pwrc_fdrname" title="Фидер" width="124" controlType="UIText" rows-limit="100" id="24168836" />
            <field table="def_fdrid" name="pwrc_fdr_explname" title="Экспл. отв." width="154" controlType="UIText" rows-limit="100" id="11072809" />
          </columns>
        </grid>
      </fieldgroup>
    </splitcontainer>
  </form>
  <dataset>
    <fields>
      <field type="number" name="kod_fl" parname="kod_fl" title="Филиал" ColumnMandatory="1" />
      <field type="string" name="is_form_valid" parname="is_form_valid" />
      <field type="string" name="is_form_valid_not" parname="is_form_valid_not" />
      <field type="string" name="def_pwrc_has_changes" parname="def_pwrc_has_changes" />
      <field type="string" name="def_fdrid_has_changes" parname="def_fdrid_has_changes" />
    </fields>
    <table name="def_pwrc" auto-refresh="1" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multiselect-column="" multiselect-target="" update-target="vb_rb_default_pwrc" column-editable="0" key="kod_id" is-ms-upd="1" is-top="1" key-dimension="def_pwrc">
      <select-text>
--
select kod_fl.name as name, /*Филиал*//*string*/
pwrc_id.pwrcn as pwrcn, /*ПС*//*string*/
def_pwrc.stage1 as stage1, /*1 этап (до актуализации ИСЭ)*//*number*/
def_pwrc.stage2 as stage2, /*2 этап (после актуализации ИСЭ)*//*number*/
def_pwrc.tm_start_an_str as tm_start_an_str, /*Начало анализа*//*string*/
def_pwrc.is_new as is_new, /*number*/
def_pwrc.is_not_new as is_not_new, /*number*/
def_pwrc.kod_id as kod_id/*number*//*key*/

from (
--vb_rb_default_pwrc
select a.kod_id as kod_id, /*number*//*key*/
a.kod_fl as kod_fl, /*number*/
a.pwrc_id as pwrc_id, /**//*number*/
a.stage1 as stage1, /**//*number*/
a.stage2 as stage2, /**//*number*/
 to_char( a.ym_start_analyz )  as tm_start_an_str, /*string*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from vb_rb_default_pwrc
a
--\vb_rb_default_pwrc
)
def_pwrc
--\vb_rb_default_pwrc
left outer join
(
--jv_rep_cons_d_fl
select a.kod_fl as kod_fl, /*number*//*key*/
a.name as name/*Филиал*//*string*/

from jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
)
kod_fl on def_pwrc.kod_fl = kod_fl.kod_fl--\jv_rep_cons_d_fl
left outer join
(
--vr_rb_pwrc
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcn, /**//*string*/
a.bal_id as bal_id/**//*number*/

from vr_rb_pwrc
a
--\vr_rb_pwrc
)
pwrc_id on (def_pwrc.pwrc_id = pwrc_id.pwrc_id)  and (def_pwrc.kod_fl = pwrc_id.bal_id) --\vr_rb_pwrc
where
def_pwrc.kod_fl in :kod_fl 
order by name, pwrcn--\
</select-text>
      <columns>
        <column name="name" table="kod_fl" type="string" title="Филиал" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_id_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_id_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kod_fl.name as name, /*Филиал*//*string*/
def_pwrc.kod_id as kod_id/*number*//*key*/

from (
--vb_rb_default_pwrc
select a.kod_id as kod_id, /*number*//*key*/
a.kod_fl as kod_fl/*number*/

from (select a.kod_id as kod_id,a.kod_fl as kod_fl  from vb_rb_default_pwrc a where not exists (select * from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n3 as kod_id,t.n4 as kod_fl  from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
a
--\(select a.kod_id as kod_id,a.kod_fl as kod_fl  from vb_rb_default_pwrc a where not exists (select * from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n3 as kod_id,t.n4 as kod_fl  from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
)
def_pwrc
--\vb_rb_default_pwrc
left outer join
(
--jv_rep_cons_d_fl
select a.kod_fl as kod_fl, /*number*//*key*/
a.name as name/*Филиал*//*string*/

from jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
)
kod_fl on def_pwrc.kod_fl = kod_fl.kod_fl--\jv_rep_cons_d_fl
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="pwrcn" table="pwrc_id" type="string" title="ПС" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_id_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_id_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select pwrc_id.pwrcn as pwrcn, /*ПС*//*string*/
def_pwrc.kod_id as kod_id/*number*//*key*/

from (
--vb_rb_default_pwrc
select a.kod_id as kod_id, /*number*//*key*/
a.kod_fl as kod_fl, /*number*/
a.pwrc_id as pwrc_id/**//*number*/

from (select a.kod_id as kod_id,a.kod_fl as kod_fl,a.pwrc_id as pwrc_id  from vb_rb_default_pwrc a where not exists (select * from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n3 as kod_id,t.n4 as kod_fl,t.n5 as pwrc_id  from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
a
--\(select a.kod_id as kod_id,a.kod_fl as kod_fl,a.pwrc_id as pwrc_id  from vb_rb_default_pwrc a where not exists (select * from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n3 as kod_id,t.n4 as kod_fl,t.n5 as pwrc_id  from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
)
def_pwrc
--\vb_rb_default_pwrc
left outer join
(
--vr_rb_pwrc
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcn, /**//*string*/
a.bal_id as bal_id/**//*number*/

from vr_rb_pwrc
a
--\vr_rb_pwrc
)
pwrc_id on (def_pwrc.pwrc_id = pwrc_id.pwrc_id)  and (def_pwrc.kod_fl = pwrc_id.bal_id) --\vr_rb_pwrc
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="stage1" table="def_pwrc" type="number" title="1 этап (до актуализации ИСЭ)" ColumnEditable="1" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="stage1" temp-col-name="n1" />
        <column name="stage2" table="def_pwrc" type="number" title="2 этап (после актуализации ИСЭ)" ColumnEditable="1" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="stage2" temp-col-name="n2" />
        <column name="tm_start_an_str" table="def_pwrc" type="string" title="Начало анализа" ColumnEditable="0" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_id_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_id_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select def_pwrc.tm_start_an_str as tm_start_an_str, /*Начало анализа*//*string*/
def_pwrc.kod_id as kod_id/*number*//*key*/

from (
--vb_rb_default_pwrc
select a.kod_id as kod_id, /*number*//*key*/
 to_char( a.ym_start_analyz )  as tm_start_an_str/*string*/

from (select a.kod_id as kod_id,a.ym_start_analyz as ym_start_analyz  from vb_rb_default_pwrc a where not exists (select * from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n3 as kod_id,t.n6 as ym_start_analyz  from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
a
--\(select a.kod_id as kod_id,a.ym_start_analyz as ym_start_analyz  from vb_rb_default_pwrc a where not exists (select * from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n3 as kod_id,t.n6 as ym_start_analyz  from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
)
def_pwrc
--\vb_rb_default_pwrc
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="is_new" table="def_pwrc" type="number" title="" is-user-editable="1" />
        <column name="is_not_new" table="def_pwrc" type="number" title="" is-user-editable="1" />
        <column name="kod_id" table="def_pwrc" type="number" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kod_id" temp-col-name="n3" />
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:stage1 as stage1 
,:stage2 as stage2 
,:kod_id as kod_id 
 
from dual ) 
 
loop 
insert into vb_rb_default_pwrc 
(stage1 
,stage2 
,kod_id 
) 
 values  
(r.stage1 
,r.stage2 
,r.kod_id 
) 
 returning  
kod_id into :kod_id; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from vb_rb_default_pwrc where kod_id=:kod_id</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='def_pwrc' 
and 
names=:form_id 
and 
f2=:kod_id; 
if :row_state_id=1  then 
for r in  
 ( select  
:stage1 as stage1 
,:stage2 as stage2 
,:kod_id as kod_id 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,n2 
,n3 
) 
 values  
('def_pwrc' 
,:form_id 
,:kod_id 
,:row_state_id 
,r.stage1 
,r.stage2 
,r.kod_id 
); 
end loop; 
else 
for r in  
 ( select  
:stage1 as stage1 
,:stage2 as stage2 
,:kod_id as kod_id 
,a.kod_fl 
,a.pwrc_id 
,a.u_m 
,a.d_m 
,a.ym_start_analyz 
 
from vb_rb_default_pwrc a  where kod_id=:kod_id) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,n2 
,n3 
,n4 
,n5 
,s1 
,d1 
,n6 
) 
 values  
('def_pwrc' 
,:form_id 
,:kod_id 
,:row_state_id 
,r.stage1 
,r.stage2 
,r.kod_id 
,r.kod_fl 
,r.pwrc_id 
,r.u_m 
,r.d_m 
,r.ym_start_analyz 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='def_pwrc' and names=:form_id</clear-temp-text>
      <update-text>begin
update vb_rb_default_pwrc set  
(stage1 
,stage2 
,kod_id 
) 
= 
 ( select  
:stage1 as stage1 
,:stage2 as stage2 
,:kod_id as kod_id 
 
from dual ) 
 
where 
kod_id=:kod_id 
;
end;
</update-text>
      <scheme>
        <table name="vb_rb_default_pwrc" as="def_pwrc">
          <columns>
            <column name="name" type="string" title="Филиал" />
            <column name="pwrcn" type="string" title="ПС" />
            <column name="stage1" type="number" title="1 этап (до актуализации ИСЭ)" />
            <column name="stage2" type="number" title="2 этап (после актуализации ИСЭ)" />
            <column name="tm_start_an_str" type="string" title="Начало анализа" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_id" type="number" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <column name="name" type="string" title="Филиал" />
            <column name="pwrcn" type="string" title="ПС" />
            <column name="stage1" type="number" title="1 этап (до актуализации ИСЭ)" />
            <column name="stage2" type="number" title="2 этап (после актуализации ИСЭ)" />
            <column name="tm_start_an_str" type="string" title="Начало анализа" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_id" type="number" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="kod_id_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="kod_id_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select kod_fl.name as name, /*Филиал*//*string*/
pwrc_id.pwrcn as pwrcn, /*ПС*//*string*/
def_pwrc.stage1 as stage1, /*1 этап (до актуализации ИСЭ)*//*number*/
def_pwrc.stage2 as stage2, /*2 этап (после актуализации ИСЭ)*//*number*/
def_pwrc.tm_start_an_str as tm_start_an_str, /*Начало анализа*//*string*/
def_pwrc.is_new as is_new, /*number*/
def_pwrc.is_not_new as is_not_new, /*number*/
def_pwrc.kod_id as kod_id/*number*//*key*/

from (
--vb_rb_default_pwrc
select a.kod_id as kod_id, /*number*//*key*/
a.kod_fl as kod_fl, /*number*/
a.pwrc_id as pwrc_id, /**//*number*/
a.stage1 as stage1, /**//*number*/
a.stage2 as stage2, /**//*number*/
 to_char( a.ym_start_analyz )  as tm_start_an_str, /*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.kod_id as kod_id,a.kod_fl as kod_fl,a.pwrc_id as pwrc_id,a.stage1 as stage1,a.stage2 as stage2,a.ym_start_analyz as ym_start_analyz,0 as is_new,1 as is_not_new  from vb_rb_default_pwrc a where not exists (select * from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n3 as kod_id,t.n4 as kod_fl,t.n5 as pwrc_id,t.n1 as stage1,t.n2 as stage2,t.n6 as ym_start_analyz,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
a
--\(select a.kod_id as kod_id,a.kod_fl as kod_fl,a.pwrc_id as pwrc_id,a.stage1 as stage1,a.stage2 as stage2,a.ym_start_analyz as ym_start_analyz,0 as is_new,1 as is_not_new  from vb_rb_default_pwrc a where not exists (select * from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n3 as kod_id,t.n4 as kod_fl,t.n5 as pwrc_id,t.n1 as stage1,t.n2 as stage2,t.n6 as ym_start_analyz,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='def_pwrc' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
)
def_pwrc
--\vb_rb_default_pwrc
left outer join
(
--jv_rep_cons_d_fl
select a.kod_fl as kod_fl, /*number*//*key*/
a.name as name/*Филиал*//*string*/

from jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
)
kod_fl on def_pwrc.kod_fl = kod_fl.kod_fl--\jv_rep_cons_d_fl
left outer join
(
--vr_rb_pwrc
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcn, /**//*string*/
a.bal_id as bal_id/**//*number*/

from vr_rb_pwrc
a
--\vr_rb_pwrc
)
pwrc_id on (def_pwrc.pwrc_id = pwrc_id.pwrc_id)  and (def_pwrc.kod_fl = pwrc_id.bal_id) --\vr_rb_pwrc

order by name, pwrcn--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
    <table name="def_fdrid" auto-refresh="1" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multiselect-column="" multiselect-target="" update-target="vb_rb_default_fdr" key="kod_id" is-ms-upd="1" is-top="1" key-dimension="def_fdr">
      <select-text>
--
select kod_fl.name as name, /*Филиал*//*string*/
pwrc_fdrid.pwrcname as pwrcname, /*ПС*//*string*/
pwrc_fdrid.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
pwrc_fdrid.pwrc_fdr_explname as pwrc_fdr_explname, /*Экспл. отв.*//*string*/
def_fdrid.is_new as is_new, /*number*/
def_fdrid.is_not_new as is_not_new, /*number*/
def_fdrid.kod_id as kod_id/*number*//*key*/

from (
--vb_rb_default_fdr
select a.kod_id as kod_id, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid, /**//*number*/
pwrc_id.kod_fl as kod_fl, /*number*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from vb_rb_default_fdr
a
--\vb_rb_default_fdr
left outer join
(
--vb_rb_default_pwrc
select a.kod_id as kod_id, /*number*//*key*/
a.kod_fl as kod_fl/*number*/

from vb_rb_default_pwrc
a
--\vb_rb_default_pwrc
)
pwrc_id on a.kod_id_pwrc = pwrc_id.kod_id--\vb_rb_default_pwrc
)
def_fdrid
--\vb_rb_default_fdr
left outer join
(
--jv_rep_cons_d_fl
select a.kod_fl as kod_fl, /*number*//*key*/
a.name as name/*Филиал*//*string*/

from jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
)
kod_fl on def_fdrid.kod_fl = kod_fl.kod_fl--\jv_rep_cons_d_fl
inner join
(
--vr_rb_fider
select a.pwrc_fdrid as pwrc_fdrid, /**//*number*//*key*/
a.pwrc_fdrname as pwrc_fdrname, /**//*string*/
a.pwrcname as pwrcname, /**//*string*/
a.pwrc_fdr_explname as pwrc_fdr_explname/**//*string*/

from vr_rb_fider
a
--\vr_rb_fider
)
pwrc_fdrid on def_fdrid.pwrc_fdrid = pwrc_fdrid.pwrc_fdrid--\vr_rb_fider
where
kod_fl.kod_fl in :kod_fl 
order by name, pwrcname, pwrc_fdrname--\
</select-text>
      <columns>
        <column name="name" table="kod_fl" type="string" title="Филиал" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params />
              <select>
                <params />
                <query>
--
select kod_fl.name as name, /*Филиал*//*string*/
def_fdrid.kod_id as kod_id

from (
--vb_rb_default_pwrc
select a.kod_id as kod_id, /*number*//*key*/
a.kod_fl as kod_fl/*number*/

from vb_rb_default_pwrc
a
--\vb_rb_default_pwrc
)
def_pwrc
--\vb_rb_default_pwrc
left outer join
(
--jv_rep_cons_d_fl
select a.kod_fl as kod_fl, /*number*//*key*/
a.name as name/*Филиал*//*string*/

from jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
)
kod_fl on def_pwrc.kod_fl = kod_fl.kod_fl--\jv_rep_cons_d_fl
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="pwrcname" table="pwrc_fdrid" type="string" title="ПС" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_id_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_id_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select pwrc_fdrid.pwrcname as pwrcname, /*ПС*//*string*/
def_fdrid.kod_id as kod_id/*number*//*key*/

from (
--vb_rb_default_fdr
select a.kod_id as kod_id, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid/**//*number*/

from (select a.kod_id as kod_id,a.pwrc_fdrid as pwrc_fdrid  from vb_rb_default_fdr a where not exists (select * from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n1 as kod_id,t.n3 as pwrc_fdrid  from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
a
--\(select a.kod_id as kod_id,a.pwrc_fdrid as pwrc_fdrid  from vb_rb_default_fdr a where not exists (select * from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n1 as kod_id,t.n3 as pwrc_fdrid  from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
)
def_fdrid
--\vb_rb_default_fdr
inner join
(
--vr_rb_fider
select a.pwrc_fdrid as pwrc_fdrid, /**//*number*//*key*/
a.pwrcname as pwrcname/**//*string*/

from vr_rb_fider
a
--\vr_rb_fider
)
pwrc_fdrid on def_fdrid.pwrc_fdrid = pwrc_fdrid.pwrc_fdrid--\vr_rb_fider
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="pwrc_fdrname" table="pwrc_fdrid" type="string" title="Фидер" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_id_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_id_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select pwrc_fdrid.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
def_fdrid.kod_id as kod_id/*number*//*key*/

from (
--vb_rb_default_fdr
select a.kod_id as kod_id, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid/**//*number*/

from (select a.kod_id as kod_id,a.pwrc_fdrid as pwrc_fdrid  from vb_rb_default_fdr a where not exists (select * from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n1 as kod_id,t.n3 as pwrc_fdrid  from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
a
--\(select a.kod_id as kod_id,a.pwrc_fdrid as pwrc_fdrid  from vb_rb_default_fdr a where not exists (select * from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n1 as kod_id,t.n3 as pwrc_fdrid  from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
)
def_fdrid
--\vb_rb_default_fdr
inner join
(
--vr_rb_fider
select a.pwrc_fdrid as pwrc_fdrid, /**//*number*//*key*/
a.pwrc_fdrname as pwrc_fdrname/**//*string*/

from vr_rb_fider
a
--\vr_rb_fider
)
pwrc_fdrid on def_fdrid.pwrc_fdrid = pwrc_fdrid.pwrc_fdrid--\vr_rb_fider
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="pwrc_fdr_explname" table="pwrc_fdrid" type="string" title="Экспл. отв." is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_id_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_id_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select pwrc_fdrid.pwrc_fdr_explname as pwrc_fdr_explname, /*Экспл. отв.*//*string*/
def_fdrid.kod_id as kod_id/*number*//*key*/

from (
--vb_rb_default_fdr
select a.kod_id as kod_id, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid/**//*number*/

from (select a.kod_id as kod_id,a.pwrc_fdrid as pwrc_fdrid  from vb_rb_default_fdr a where not exists (select * from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n1 as kod_id,t.n3 as pwrc_fdrid  from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
a
--\(select a.kod_id as kod_id,a.pwrc_fdrid as pwrc_fdrid  from vb_rb_default_fdr a where not exists (select * from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n1 as kod_id,t.n3 as pwrc_fdrid  from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
)
def_fdrid
--\vb_rb_default_fdr
inner join
(
--vr_rb_fider
select a.pwrc_fdrid as pwrc_fdrid, /**//*number*//*key*/
a.pwrc_fdr_explname as pwrc_fdr_explname/**//*string*/

from vr_rb_fider
a
--\vr_rb_fider
)
pwrc_fdrid on def_fdrid.pwrc_fdrid = pwrc_fdrid.pwrc_fdrid--\vr_rb_fider
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="is_new" table="def_fdrid" type="number" title="" is-user-editable="1" />
        <column name="is_not_new" table="def_fdrid" type="number" title="" is-user-editable="1" />
        <column name="kod_id" table="def_fdrid" type="number" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kod_id" temp-col-name="n1" />
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:kod_id as kod_id 
 
from dual ) 
 
loop 
insert into vb_rb_default_fdr 
(kod_id 
) 
 values  
(r.kod_id 
) 
 returning  
kod_id into :kod_id; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from vb_rb_default_fdr where kod_id=:kod_id</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='def_fdrid' 
and 
names=:form_id 
and 
f2=:kod_id; 
if :row_state_id=1  then 
for r in  
 ( select  
:kod_id as kod_id 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
) 
 values  
('def_fdrid' 
,:form_id 
,:kod_id 
,:row_state_id 
,r.kod_id 
); 
end loop; 
else 
for r in  
 ( select  
:kod_id as kod_id 
,a.pwrc_id 
,a.pwrc_fdrid 
,a.u_m 
,a.d_m 
,a.kod_id_pwrc 
 
from vb_rb_default_fdr a  where kod_id=:kod_id) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,n2 
,n3 
,s1 
,d1 
,n4 
) 
 values  
('def_fdrid' 
,:form_id 
,:kod_id 
,:row_state_id 
,r.kod_id 
,r.pwrc_id 
,r.pwrc_fdrid 
,r.u_m 
,r.d_m 
,r.kod_id_pwrc 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='def_fdrid' and names=:form_id</clear-temp-text>
      <update-text>begin
update vb_rb_default_fdr set  
(kod_id 
) 
= 
 ( select  
:kod_id as kod_id 
 
from dual ) 
 
where 
kod_id=:kod_id 
;
end;
</update-text>
      <scheme>
        <table name="vb_rb_default_fdr" as="def_fdrid">
          <columns>
            <column name="name" type="string" title="Филиал" />
            <column name="pwrcname" type="string" title="ПС" />
            <column name="pwrc_fdrname" type="string" title="Фидер" />
            <column name="pwrc_fdr_explname" type="string" title="Экспл. отв." />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_id" type="number" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <column name="name" type="string" title="Филиал" />
            <column name="pwrcname" type="string" title="ПС" />
            <column name="pwrc_fdrname" type="string" title="Фидер" />
            <column name="pwrc_fdr_explname" type="string" title="Экспл. отв." />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_id" type="number" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="kod_id_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="kod_id_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select kod_fl.name as name, /*Филиал*//*string*/
pwrc_fdrid.pwrcname as pwrcname, /*ПС*//*string*/
pwrc_fdrid.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
pwrc_fdrid.pwrc_fdr_explname as pwrc_fdr_explname, /*Экспл. отв.*//*string*/
def_fdrid.is_new as is_new, /*number*/
def_fdrid.is_not_new as is_not_new, /*number*/
def_fdrid.kod_id as kod_id/*number*//*key*/

from (
--vb_rb_default_fdr
select a.kod_id as kod_id, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid, /**//*number*/
pwrc_id.kod_fl as kod_fl, /*number*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.kod_id as kod_id,a.pwrc_fdrid as pwrc_fdrid,0 as is_new,1 as is_not_new,a.kod_id_pwrc as kod_id_pwrc  from vb_rb_default_fdr a where not exists (select * from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n1 as kod_id,t.n3 as pwrc_fdrid,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new,t.n4 as kod_id_pwrc  from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
a
--\(select a.kod_id as kod_id,a.pwrc_fdrid as pwrc_fdrid,0 as is_new,1 as is_not_new,a.kod_id_pwrc as kod_id_pwrc  from vb_rb_default_fdr a where not exists (select * from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and a.kod_id=t.f2 ) and   a.kod_id in :kod_id_prm   union all  select t.n1 as kod_id,t.n3 as pwrc_fdrid,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new,t.n4 as kod_id_pwrc  from rr_temp t where t.skod ='def_fdrid' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_id_prm )
left outer join
(
--vb_rb_default_pwrc
select a.kod_id as kod_id, /*number*//*key*/
a.kod_fl as kod_fl/*number*/

from vb_rb_default_pwrc
a
--\vb_rb_default_pwrc
)
pwrc_id on a.kod_id_pwrc = pwrc_id.kod_id--\vb_rb_default_pwrc
)
def_fdrid
--\vb_rb_default_fdr
left outer join
(
--jv_rep_cons_d_fl
select a.kod_fl as kod_fl, /*number*//*key*/
a.name as name/*Филиал*//*string*/

from jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
)
kod_fl on def_fdrid.kod_fl = kod_fl.kod_fl--\jv_rep_cons_d_fl
inner join
(
--vr_rb_fider
select a.pwrc_fdrid as pwrc_fdrid, /**//*number*//*key*/
a.pwrc_fdrname as pwrc_fdrname, /**//*string*/
a.pwrcname as pwrcname, /**//*string*/
a.pwrc_fdr_explname as pwrc_fdr_explname/**//*string*/

from vr_rb_fider
a
--\vr_rb_fider
)
pwrc_fdrid on def_fdrid.pwrc_fdrid = pwrc_fdrid.pwrc_fdrid--\vr_rb_fider

order by name, pwrcname, pwrc_fdrname--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
  </dataset>
</root>