<?xml version="1.0" encoding="utf-8"?>
<root>
  <form name="49277_vb_rb_default_pwrc" timestamp="30.01.2023 11:53:06" title="Изменить список ПС" file="sql.builder.templates\sql.builder\projects\49277\form\forms.xml" elid="87" ord="87" leaf="0" lvl="2" pelid="">
    <grid table="a" show-toolbar="1" show-checkbox="1" auto-filter="1" id="8320223">
      <toolbar id="49494126">
        <uicommand button-type="grid-save" column-visible="0" name="grid-save" control-name="ButtonCommit" file="sql.builder.templates\sql.builder\projects\common\main.xml" title="" id="13561768" />
        <uicommand button-type="grid-add" column-visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" title="" id="66146744" />
        <uicommand button-type="grid-delete" column-visible="0" name="grid-delete" control-name="ButtonDeleteRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" title="" id="48589107" />
        <uicommand action-type="custom" title="Добавить выбранные" button-type="custom-ok" name="custom-ok" icon="Ok_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" id="41273851">
          <useaction action-type="save" id="29463299" />
          <useaction action-type="close" id="4987944" />
        </uicommand>
      </toolbar>
      <columns id="9665392">
        <field table="a" name="bal_id_pwrc_id" title="" controlType="UIText" rows-limit="100" id="60098413" />
        <field table="a" name="pwrc_id" title="" controlType="UIText" edit-mask="N2" rows-limit="100" id="15968574" />
        <field table="a" name="pwrcname" title="ПС" width="322" controlType="UIText" rows-limit="100" id="33464610" />
        <field table="a" name="bal_id" title="" controlType="UIText" edit-mask="N2" rows-limit="100" id="62662746" />
        <field table="a" name="name" title="Филиал" controlType="UIText" rows-limit="100" id="61973529" />
      </columns>
      <events id="16682193">
        <useaction event-name="checked-row-save" action-type="custom" id="46183403">
          <useaction action-type="execute-add" call="vb_rb_default_pwrc_add" id="37466491">
            <useparam name="pwrc_id" id="54913522" />
            <useparam name="bal_id" id="55465320" />
          </useaction>
        </useaction>
      </events>
    </grid>
  </form>
  <params>
    <param name="kod_fl" type="array" />
  </params>
  <dataset>
    <params>
      <param name="kod_fl" type="array" />
    </params>
    <fields>
      <field type="string" name="is_form_valid" parname="is_form_valid" />
      <field type="string" name="is_form_valid_not" parname="is_form_valid_not" />
      <field type="string" name="a_has_changes" parname="a_has_changes" />
    </fields>
    <table name="a" auto-refresh="1" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multiselect-column="" multiselect-target="" update-target="vb_rb_default_pwrc_list_from_HV_EOPWRC" column-editable="0" key="bal_id_pwrc_id" is-ms-upd="0" is-top="1">
      <select-text>
--
select a.bal_id_pwrc_id as bal_id_pwrc_id, /*string*//*key*/
a.pwrc_id as pwrc_id, /*number*/
a.pwrcname as pwrcname, /*ПС*//*string*/
a.bal_id as bal_id, /*number*/
a.name as name/*Филиал*//*string*/

from (
--vb_rb_default_pwrc_list_from_HV_EOPWRC
select a.bal_id || '-' || a.pwrc_id as bal_id_pwrc_id, /*string*//*key*/
a.pwrc_id as pwrc_id, /*number*/
a.pwrcname as pwrcname, /*ПС*//*string*/
a.bal_id as bal_id, /*number*/
kod_fl.name as name/*Филиал*//*string*/

from (
--hv_eopwrc
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcname, /**//*string*/
a.bal_id as bal_id/**//*number*/

from (
--hv_eopwrc_istest_0
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcname, /**//*string*/
a.bal_id as bal_id/**//*number*/

from (
--hv_eopwrc_full
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcname, /**//*string*/
a.bal_id as bal_id, /**//*number*/
a.is_test as is_test/**//*number*/

from hv_eopwrc
a
--\hv_eopwrc
)
a
--\hv_eopwrc_full
where
a.is_test = 0)
a
--\hv_eopwrc_istest_0
)
a
--\hv_eopwrc
left outer join
(
--jv_rep_cons_d_fl
select a.kod_fl as kod_fl, /*number*//*key*/
a.name as name/*Филиал*//*string*/

from jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
)
kod_fl on a.bal_id = kod_fl.kod_fl--\jv_rep_cons_d_fl
left outer join
(
--vb_rb_default_pwrc
select a.kod_id as kod_id, /*number*//*key*/
a.kod_fl as kod_fl, /*number*/
a.pwrc_id as pwrc_id/**//*number*/

from vb_rb_default_pwrc
a
--\vb_rb_default_pwrc
)
def_pwrc on (a.pwrc_id = def_pwrc.pwrc_id)  and (a.bal_id = def_pwrc.kod_fl) --\vb_rb_default_pwrc
where
(def_pwrc.pwrc_id is null )  and (a.bal_id in :kod_fl ) 
order by name, pwrcname)
a
--\vb_rb_default_pwrc_list_from_HV_EOPWRC
--\
</select-text>
      <columns>
        <column name="bal_id_pwrc_id" table="a" type="string" title="" ColumnVisible="0" />
        <column name="pwrc_id" table="a" type="number" title="" parname="pwrc_id" ColumnVisible="0" ColumnMandatory="1" is-refreshed="1" />
        <column name="pwrcname" table="a" type="string" title="ПС" is-user-editable="1" is-refreshed="1" />
        <column name="bal_id" table="a" type="number" title="" parname="bal_id" ColumnVisible="0" is-refreshed="1" />
        <column name="name" table="a" type="string" title="Филиал" is-user-editable="1" is-refreshed="1" />
      </columns>
      <scheme>
        <table name="vb_rb_default_pwrc_list_from_HV_EOPWRC" as="a">
          <columns>
            <column name="bal_id_pwrc_id" type="string" title="" visible="0" />
            <column name="pwrc_id" type="number" title="" visible="0" />
            <column name="pwrcname" type="string" title="ПС" />
            <column name="bal_id" type="number" title="" visible="0" />
            <column name="name" type="string" title="Филиал" />
          </columns>
          <viewcolumns>
            <column name="bal_id_pwrc_id" type="string" title="" visible="0" />
            <column name="pwrc_id" type="number" title="" visible="0" />
            <column name="pwrcname" type="string" title="ПС" />
            <column name="bal_id" type="number" title="" visible="0" />
            <column name="name" type="string" title="Филиал" />
          </viewcolumns>
        </table>
      </scheme>
    </table>
  </dataset>
</root>