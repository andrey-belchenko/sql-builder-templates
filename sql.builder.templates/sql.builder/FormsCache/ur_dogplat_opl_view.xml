<?xml version="1.0" encoding="utf-8"?>
<root>
  <form name="ur_dogplat_opl_view" title="Оплаты по документу" timestamp="28.12.2023 14:44:18" form-size="1033;627" with-behavior="0" file="sql.builder.templates\sql.builder\projects\asuse2\reports\arbitrage\forms\ur_dogplat_select.xml" elid="197" ord="197" leaf="0" lvl="2" pelid="">
    <grid table="opl" show-toolbar="1" multi-select="0" show-footer="1" id="61496785">
      <toolbar id="35192881">
        <uicommand button-type="grid-delete" column-visible="0" name="grid-delete" control-name="ButtonDeleteRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="367" ord="367" leaf="1" lvl="2" pelid="" title="" id="14536576" />
        <uicommand button-type="grid-save" column-visible="0" name="grid-save" control-name="ButtonCommit" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="365" ord="365" leaf="1" lvl="2" pelid="" title="" id="32241028" />
        <uicommand button-type="grid-add" column-visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="363" ord="363" leaf="1" lvl="2" pelid="" title="" id="31052936" />
      </toolbar>
      <columns id="32815441">
        <field table="opl" name="kod_opl" title="" controlType="UIText" edit-mask="N2" rows-limit="100" id="5448735" />
        <field table="opl" name="num_opl" title="Номер платежного документа" controlType="UIText" rows-limit="100" id="60251422" />
        <field table="opl" name="opl" title="Оплачено с налогом, руб." controlType="UIText" edit-mask="N2" rows-limit="100" id="24523226" />
        <field table="opl" name="dat_opl" title="Дата платежного документа" controlType="UIDate" rows-limit="100" id="20893733" />
        <field table="opl" name="vid_real_name" title="Вид реализации" controlType="UIText" rows-limit="100" id="28022941" />
        <field table="opl" name="vid_opl_name" title="Вид оплаты" controlType="UIText" rows-limit="100" id="14662275" />
        <field table="opl" name="type_opl_name" title="Тип оплаты" controlType="UIText" rows-limit="100" id="15146131" />
        <field table="opl" name="prim_bank" title="Примечания к банк. оплате" controlType="UIText" rows-limit="100" id="45982132" />
        <field table="opl" name="prim_raznos" title="Примечания к разносу оплаты" controlType="UIText" rows-limit="100" id="30655364" />
      </columns>
    </grid>
    <toolbar id="38104156" />
  </form>
  <params>
    <param name="p_kod_dogplat" type="number">
      <const>1000000908</const>
    </param>
  </params>
  <dataset>
    <params>
      <param name="p_kod_dogplat" type="number">
        <const>1000000908</const>
      </param>
    </params>
    <fields>
      <field type="string" name="is_form_valid" parname="is_form_valid" />
      <field type="string" name="is_form_valid_not" parname="is_form_valid_not" />
      <field type="string" name="opl_has_changes" parname="opl_has_changes" />
    </fields>
    <table name="opl" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multi-select-column="" multi-select-target="" update-target="sr_opl_sf_dp" key="kod_opl" is-ms-upd="0" is-top="1">
      <select-text>
--
select opl.kod_opl as kod_opl, /*number*//*key*/
opl.num_opl as num_opl, /*Номер платежного документа*//*string*/
nvl(opl.opl,0)  as opl, /*Оплачено с налогом, руб.*//*number*/
opl.dat_opl as dat_opl, /*Дата платежного документа*//*date*/
opl.vid_real_name as vid_real_name, /*Вид реализации*//*string*/
opl.vid_opl_name as vid_opl_name, /*Вид оплаты*//*string*/
opl.type_opl_name as type_opl_name, /*Тип оплаты*//*string*/
opl.prim_bank as prim_bank, /*Примечания к банк. оплате*//*string*/
opl.prim_raznos as prim_raznos/*Примечания к разносу оплаты*//*string*/

from (
--sr_opl_sf_dp
select kod_opl_sf.kod_opl as kod_opl, /*number*//*key*/
kod_opl_sf.num_opl as num_opl, /*Номер платежного документа*//*string*/
qube.sr_opl_opl_sf1 as opl, /*Оплачено с налогом, руб.*//*number*/
kod_opl_sf.dat_opl as dat_opl, /*Дата платежного документа*//*date*/
vid_real.sname as vid_real_name, /*Вид реализации*//*string*/
kod_vidopl.full_name as vid_opl_name, /*Вид оплаты*//*string*/
kod_type_opl.name as type_opl_name, /*Тип оплаты*//*string*/
kod_link.remark as prim_bank, /*Примечания к банк. оплате*//*string*/
sr_opl_text.prim_raznos as prim_raznos/*Примечания к разносу оплаты*//*string*/

from (
--
select qube.kod_opl_sf as kod_opl_sf, /*number*//*key*/
sum(qube.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплачено с налогом, руб.*//*number*/

from (
--
select qube.kod_opl_sf as kod_opl_sf, /*number*//*key*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select qube.kod_opl_sf as kod_opl_sf, /*number*//*key*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select un.kod_opl_sf as kod_opl_sf, /*number*//*key*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.kod_opl_sf as kod_opl_sf, /*number*//*key*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select kod_opl_sf.kod_opl as kod_opl_sf, /*number*//*key*/
kod_opl_sf.kod_opl as kod_opl_prm/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
kod_opl_sf
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on kod_opl_sf.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vv_all_deb_sf
select a.kod_deb_sf as kod_deb_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from vv_all_deb_sf
a
--\vv_all_deb_sf
)
vv_all_deb_sf_a_d1 on vv_all_deb_sf_a_d1.kod_sf = kod_sf_a_d.kod_sf--\vv_all_deb_sf
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_deb_sf as kod_deb_sf/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_deb_sf = vv_all_deb_sf_a_d1.kod_deb_sf--\ur_dogplat
where
(kod_dogplat.kod_dogplat = :p_kod_dogplat )  group by
kod_opl_sf.kod_opl/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
)
--\
)
un
--\
 group by
un.kod_opl_sf/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
 group by
qube.kod_opl_sf/*number*//*key*/
)
qube
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.num_opl as num_opl, /*Номер платежного документа*//*string*/
a.dat_opl as dat_opl/*Дата платежного документа*//*date*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
kod_opl_sf on kod_opl_sf.kod_opl = qube.kod_opl_sf--\sr_opl_sf
left outer join
(
--sr_opl
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_vidopl as kod_vidopl, /*number*/
a.vid_real as vid_real, /**//*number*/
a.kod_type_opl as kod_type_opl, /*number*/
a.kod_link as kod_link/*number*/

from sr_opl
a
--\sr_opl
)
kod_opl on kod_opl_sf.kod_opl = kod_opl.kod_opl--\sr_opl
left outer join
(
--
select sr_opl_text.kod_opl as kod_opl, /*number*//*key*/
max(sr_opl_text.prim)  as prim_raznos/*Примечания к разносу оплаты*//*string*/

from (
--sr_opl_text
select a.kod_opl as kod_opl, /*number*//*key*/
a.prim as prim/*Примечания к разносу оплаты*//*string*/

from sr_opl_text
a
--\sr_opl_text
)
sr_opl_text
--\sr_opl_text
 group by
sr_opl_text.kod_opl/*number*//*key*/
)
sr_opl_text on sr_opl_text.kod_opl = kod_opl.kod_opl--\
left outer join
(
--sr_opl_bank
select a.kod_link as kod_link, /*number*//*key*/
a.remark as remark/*Назначение платежа*//*string*/

from sr_opl_bank
a
--\sr_opl_bank
)
kod_link on kod_opl.kod_link = kod_link.kod_link--\sr_opl_bank
left outer join
(
--sk_type_opl
select a.kod_type_opl as kod_type_opl, /*number*//*key*/
a.name as name/*Наименование*//*string*/

from sk_type_opl
a
--\sk_type_opl
)
kod_type_opl on kod_opl.kod_type_opl = kod_type_opl.kod_type_opl--\sk_type_opl
left outer join
(
--ss_vidopl
select a.kod_vidopl as kod_vidopl, /*number*//*key*/
a.abbr || ' ' || a.sname as full_name/*Виды оплат*//*string*/

from ss_vidopl
a
--\ss_vidopl
)
kod_vidopl on kod_opl.kod_vidopl = kod_vidopl.kod_vidopl--\ss_vidopl
left outer join
(
--sk_vid_real
select a.vid_real as vid_real, /**//*number*//*key*/
a.sname as sname/**//*string*/

from sk_vid_real
a
--\sk_vid_real
)
vid_real on kod_opl.vid_real = vid_real.vid_real--\sk_vid_real

order by dat_opl, num_opl)
opl
--\sr_opl_sf_dp
--\
</select-text>
      <columns>
        <column name="kod_opl" table="opl" type="number" title="" parname="cur_kod_opl" ColumnVisible="0" is-refreshed="1" />
        <column name="num_opl" table="opl" type="string" title="Номер платежного документа" ColumnEditable="0" is-refreshed="1" />
        <column name="opl" table="opl" type="number" title="Оплачено с налогом, руб." is-user-editable="1" is-refreshed="1" />
        <column name="dat_opl" table="opl" type="date" title="Дата платежного документа" ColumnEditable="0" is-refreshed="1" />
        <column name="vid_real_name" table="opl" type="string" title="Вид реализации" ColumnEditable="0" is-refreshed="1" />
        <column name="vid_opl_name" table="opl" type="string" title="Вид оплаты" ColumnEditable="0" is-refreshed="1" />
        <column name="type_opl_name" table="opl" type="string" title="Тип оплаты" ColumnEditable="0" is-refreshed="1" />
        <column name="prim_bank" table="opl" type="string" title="Примечания к банк. оплате" ColumnEditable="0" is-refreshed="1" />
        <column name="prim_raznos" table="opl" type="string" title="Примечания к разносу оплаты" ColumnEditable="0" is-refreshed="1" />
      </columns>
      <scheme>
        <table name="sr_opl_sf_dp" as="opl">
          <columns>
            <column name="kod_opl" type="number" title="" visible="0" />
            <column name="num_opl" type="string" title="Номер платежного документа" />
            <column name="opl" type="number" title="Оплачено с налогом, руб." />
            <column name="dat_opl" type="date" title="Дата платежного документа" />
            <column name="vid_real_name" type="string" title="Вид реализации" />
            <column name="vid_opl_name" type="string" title="Вид оплаты" />
            <column name="type_opl_name" type="string" title="Тип оплаты" />
            <column name="prim_bank" type="string" title="Примечания к банк. оплате" />
            <column name="prim_raznos" type="string" title="Примечания к разносу оплаты" />
          </columns>
          <viewcolumns>
            <column name="kod_opl" type="number" title="" visible="0" />
            <column name="num_opl" type="string" title="Номер платежного документа" />
            <column name="opl" type="number" title="Оплачено с налогом, руб." />
            <column name="dat_opl" type="date" title="Дата платежного документа" />
            <column name="vid_real_name" type="string" title="Вид реализации" />
            <column name="vid_opl_name" type="string" title="Вид оплаты" />
            <column name="type_opl_name" type="string" title="Тип оплаты" />
            <column name="prim_bank" type="string" title="Примечания к банк. оплате" />
            <column name="prim_raznos" type="string" title="Примечания к разносу оплаты" />
          </viewcolumns>
        </table>
      </scheme>
    </table>
  </dataset>
</root>