<?xml version="1.0" encoding="utf-8"?>
<root>
  <form name="45862_vb_tp_change" timestamp="28.12.2023 14:39:10" title="Изменить список ТП" form-size="800;500" file="sql.builder.templates\sql.builder\projects\45862\form\forms.xml" elid="67" ord="67" leaf="0" lvl="2" pelid="">
    <grid table="a" show-toolbar="1" show-checkbox="1" auto-filter="1" id="30564948">
      <toolbar id="17792204">
        <uicommand button-type="grid-save" column-visible="0" name="grid-save" control-name="ButtonCommit" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="365" ord="365" leaf="1" lvl="2" pelid="" title="" id="25403988" />
        <uicommand button-type="grid-add" column-visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="363" ord="363" leaf="1" lvl="2" pelid="" title="" id="4234104" />
        <uicommand button-type="grid-delete" column-visible="0" name="grid-delete" control-name="ButtonDeleteRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="367" ord="367" leaf="1" lvl="2" pelid="" title="" id="23080958" />
        <uicommand action-type="custom" title="Привязать выбранные" button-type="custom-ok" name="custom-ok" icon="Ok_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="381" ord="381" leaf="1" lvl="2" pelid="" id="33257031">
          <useaction action-type="save" id="15331227" />
          <useaction title="Обновить настройки КГ" name="vb_kol_gr_pack.upd_kg_nastr" id="27629582">
            <useparam name="kod_nastr" id="7248706" />
            <useparam name="ym" id="48637102" />
          </useaction>
          <useaction title="Обновить имя КГ" name="vb_kol_gr_pack.upd_kg_name" id="33649888">
            <useparam name="kod_nastr" id="55081717" />
          </useaction>
          <useaction action-type="close" id="38613640" />
        </uicommand>
      </toolbar>
      <columns id="17761619">
        <field table="a" name="src_id" title="" controlType="UIText" edit-mask="N2" rows-limit="100" id="49308152" />
        <field table="a" name="srcname" title="ТП" width="241" controlType="UIText" rows-limit="100" id="10148546" />
        <field table="a" name="pwrc_fdrname" title="Фидер" width="121" controlType="UIText" rows-limit="100" id="2156805" />
        <field table="a" name="pwrcname" title="ПС" width="339" controlType="UIText" rows-limit="100" id="29013481" />
        <field table="a" name="kod_kol_gr_fdr" title="" controlType="UIText" edit-mask="N2" rows-limit="100" id="42476957" />
      </columns>
      <events id="4375312">
        <useaction event-name="checked-row-save" action-type="custom" id="53263162">
          <useaction action-type="execute-add" call="vb_add_tp" id="6069785">
            <useparam name="src_id" id="1841741" />
            <useparam name="kod_kol_gr_fdr" id="30503443" />
          </useaction>
        </useaction>
      </events>
    </grid>
  </form>
  <params>
    <param name="kod_nastr" type="number" />
    <param name="ym" type="number" />
  </params>
  <dataset>
    <params>
      <param name="kod_nastr" type="number" />
      <param name="ym" type="number" />
    </params>
    <fields>
      <field type="string" name="is_form_valid" parname="is_form_valid" />
      <field type="string" name="is_form_valid_not" parname="is_form_valid_not" />
      <field type="string" name="a_has_changes" parname="a_has_changes" />
    </fields>
    <table name="a" auto-refresh="1" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multi-select-column="" multi-select-target="" update-target="vb_nastr_tp_list" column-editable="0" key="pk" is-ms-upd="0" is-top="1">
      <select-text>
--
select a.src_id as src_id, /*number*/
a.srcname as srcname, /*ТП*//*string*/
a.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
a.pwrcname as pwrcname, /*ПС*//*string*/
a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*/
src_id_x_n.kod_kol_gr_fdr as src_id_x_n, /*Код настройки фидеров*//*number*/
a.pk as pk/*string*//*key*/

from (
--vb_nastr_tp_list
select pwrc_id.kod_kol_gr_pwrc || '-' || pwrc_fdrid.kod_kol_gr_fdr || '-' || a.pwrc_fdrid || '-' || a.src_id as pk, /*string*//*key*/
a.src_id as src_id, /*number*/
a.srcname as srcname, /*ТП*//*string*/
a.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
a.pwrcname as pwrcname, /*ПС*//*string*/
pwrc_fdrid.kod_kol_gr_fdr as kod_kol_gr_fdr/*number*/

from (
--hv_eopwrc_grid
select a.pwrcname as pwrcname, /*ПС*//*string*/
a.pwrc_fdrid as pwrc_fdrid, /**//*number*/
a.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
a.src_id as src_id, /**//*number*/
a.srcname as srcname/*ТП*//*string*/

from hv_eopwrc_grid
a
--\hv_eopwrc_grid
)
a
--\hv_eopwrc_grid
left outer join
(
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*Код настройки ПС*//*number*/
a.pwrc_fdrid as pwrc_fdrid, /*Код фидера*//*number*/
a.entire_fdr as entire_fdr/**//*number*/

from vb_kol_gr_fdr
a
--\vb_kol_gr_fdr
)
pwrc_fdrid on a.pwrc_fdrid = pwrc_fdrid.pwrc_fdrid--\vb_kol_gr_fdr
left outer join
(
--vb_kol_gr_pwrc
select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from vb_kol_gr_pwrc
a
--\vb_kol_gr_pwrc
)
pwrc_id on pwrc_fdrid.kod_kol_gr_pwrc = pwrc_id.kod_kol_gr_pwrc--\vb_kol_gr_pwrc
left outer join
(
--vb_kol_gr_tp
select a.kod_kol_gr_tp as kod_kol_gr_tp, /*number*//*key*/
a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*Код настройки фидеров*//*number*/
a.src_id as src_id/*Код ТП*//*number*/

from vb_kol_gr_tp
a
--\vb_kol_gr_tp
)
src_id on (a.src_id = src_id.src_id)  and (pwrc_fdrid.kod_kol_gr_fdr = src_id.kod_kol_gr_fdr) --\vb_kol_gr_tp
left outer join
(
--vb_nastr_tp_list_exclude
select vb_kol_gr_tp.src_id as src_id/*Код ТП*//*number*//*key*/

from (
--vb_kol_gr_tp
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*Код настройки фидеров*//*number*/
a.src_id as src_id/*Код ТП*//*number*/

from vb_kol_gr_tp
a
--\vb_kol_gr_tp
)
vb_kol_gr_tp
--\vb_kol_gr_tp
left outer join
(
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.kod_kol_gr_pwrc as kod_kol_gr_pwrc/*Код настройки ПС*//*number*/

from vb_kol_gr_fdr
a
--\vb_kol_gr_fdr
)
kod_kol_gr_fdr on vb_kol_gr_tp.kod_kol_gr_fdr = kod_kol_gr_fdr.kod_kol_gr_fdr--\vb_kol_gr_fdr
left outer join
(
--vb_kol_gr_pwrc
select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from vb_kol_gr_pwrc
a
--\vb_kol_gr_pwrc
)
kod_kol_gr_pwrc on kod_kol_gr_fdr.kod_kol_gr_pwrc = kod_kol_gr_pwrc.kod_kol_gr_pwrc--\vb_kol_gr_pwrc
left outer join
(
--vb_kol_gr_nastr
select a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
a.s as s, /*Период с*//*number*/
a.po as po/*Период по*//*number*/

from vb_kol_gr_nastr
a
--\vb_kol_gr_nastr
)
kod_kol_gr_nastr on kod_kol_gr_pwrc.kod_kol_gr_nastr = kod_kol_gr_nastr.kod_kol_gr_nastr--\vb_kol_gr_nastr
where
((kod_kol_gr_nastr.po is null )  or (kod_kol_gr_nastr.po &gt;= :ym ) )  and (kod_kol_gr_nastr.s &lt;= :ym )  group by
vb_kol_gr_tp.src_id/*Код ТП*//*number*//*key*/
)
src_id_exclude on a.src_id = src_id_exclude.src_id--\vb_nastr_tp_list_exclude
where
(pwrc_id.kod_kol_gr_nastr = :kod_nastr )  and (pwrc_id.kod_kol_gr_pwrc is not null )  and (pwrc_fdrid.kod_kol_gr_fdr is not null )  and (( nvl( pwrc_fdrid.entire_fdr ,0) )  != 1)  and (a.src_id is not null )  and (src_id.kod_kol_gr_tp is null )  and (src_id_exclude.src_id is null ) )
a
--\vb_nastr_tp_list
left outer join
(
--vb_kol_gr_tp
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*Код настройки фидеров*//*number*/
a.src_id as src_id/*Код ТП*//*number*/

from vb_kol_gr_tp
a
--\vb_kol_gr_tp
)
src_id_x_n on (a.src_id = src_id_x_n.src_id)  and (a.kod_kol_gr_fdr = src_id_x_n.kod_kol_gr_fdr) --\vb_kol_gr_tp

order by pwrcname, pwrc_fdrname, srcname--\
</select-text>
      <columns>
        <column name="src_id" table="a" type="number" title="" parname="src_id" ColumnVisible="0" is-refreshed="1" />
        <column name="srcname" table="a" type="string" title="ТП" is-user-editable="1" is-refreshed="1" />
        <column name="pwrc_fdrname" table="a" type="string" title="Фидер" is-user-editable="1" is-refreshed="1" />
        <column name="pwrcname" table="a" type="string" title="ПС" is-user-editable="1" is-refreshed="1" />
        <column name="kod_kol_gr_fdr" table="a" type="number" title="" parname="kod_kol_gr_fdr" ColumnVisible="0" is-refreshed="1" />
        <column name="src_id_x_n" table="a.src_id" type="number" title="" text-source-for="src_id" is-refreshed="1" />
        <column name="pk" table="a" type="string" title="" is-user-editable="1" />
      </columns>
      <scheme>
        <table name="vb_nastr_tp_list" as="a">
          <columns>
            <column name="src_id" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="srcname" type="string" title="ТП" />
            <column name="pwrc_fdrname" type="string" title="Фидер" />
            <column name="pwrcname" type="string" title="ПС" />
            <column name="kod_kol_gr_fdr" type="number" title="" visible="0" />
            <column name="src_id_x_n" type="number" title="" visible="0" />
            <column name="pk" type="string" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <column name="src_id_x_n" type="number" title="" visible="0" />
            <column name="src_id" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="srcname" type="string" title="ТП" />
            <column name="pwrc_fdrname" type="string" title="Фидер" />
            <column name="pwrcname" type="string" title="ПС" />
            <column name="kod_kol_gr_fdr" type="number" title="" visible="0" />
            <column name="pk" type="string" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
    </table>
  </dataset>
</root>