<?xml version="1.0" encoding="utf-8"?>
<root>
  <form name="va_sp_calc_ke30" timestamp="05.09.2019 18:02:10" title="Просмотр КЕ30" file="sql.builder.templates\sql.builder\projects\mped\forms\va_sp_calc.xml" elid="683" ord="683" leaf="0" lvl="2" pelid="">
    <fieldgroup title="Фильтры" id="28301791">
      <field id="49825352" controlType="UIList" elid="383" ord="383" leaf="1" lvl="2" pelid="" show-checkbox="0" column-mandatory="1" name="p_ym" title="Периоды" type="number">
        <listquery>
          <query name="mped_spr_time_ym" />
        </listquery>
        <defaultquery>
          <query name="mped_spr_time_ym_prev" />
        </defaultquery>
      </field>
      <field id="31598715" controlType="UIList" elid="383" ord="383" leaf="1" lvl="2" pelid="" show-checkbox="0" column-mandatory="1" name="p_od_nd" title="ОД - НД" type="number">
        <listquery>
          <query name="vb_spr_od_nd_plus_null" />
        </listquery>
        <defaultquery>
          <query name="vb_spr_od_nd_plus_null" />
        </defaultquery>
      </field>
    </fieldgroup>
    <fieldgroup title="Данные" id="1176355">
      <grid show-toolbar="1" table="a" title="Калькуляция" show-footer="1" id="7286805">
        <toolbar id="58219962">
          <uicommand button-type="grid-add" column-visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="361" ord="361" leaf="1" lvl="2" pelid="" title="" id="40533339" />
          <uicommand button-type="grid-delete" column-visible="0" name="grid-delete" control-name="ButtonDeleteRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="365" ord="365" leaf="1" lvl="2" pelid="" title="" id="23338549" />
        </toolbar>
        <columns id="43727014">
          <band title="Вид деятельности" id="23615301">
            <field table="a" name="vid_dey_kod" title="Код" width="39" controlType="UIText" format="F0" edit-mask="F0" rows-limit="100" id="6654959" />
            <field table="a" name="vid_dey_name" title="Наименование" width="120" controlType="UIText" rows-limit="100" id="5830206" />
            <field table="a" name="vid_energ_name" title="Вид энергии" width="94" controlType="UIText" rows-limit="100" id="38425314" />
            <field table="a" name="od_nd_name" title="ОД -  НД" width="63" controlType="UIText" rows-limit="100" id="12424883" />
          </band>
          <band title="Объект генерации" id="53137928">
            <field table="a" name="ob_gen_kod" title="Код" width="64" controlType="UIText" rows-limit="100" id="1350917" />
            <field table="a" name="ob_gen_name" title="Наименование" width="133" controlType="UIText" rows-limit="100" id="44074321" />
          </band>
          <field table="a" name="period" title="Период" width="67" controlType="UIText" format="F2" edit-mask="F2" rows-limit="100" id="19946314" />
          <band title="Субъект РФ" id="46130372">
            <field table="a" name="subject_fed_kod" title="Код" width="39" controlType="UICombo" format="F0" edit-mask="F0" rows-limit="100" id="16731159" />
            <field table="a" name="subject_fed_name" title="Наименование" width="110" controlType="UICombo" rows-limit="100" id="20834560" />
          </band>
          <band title="Заказ" id="20620600">
            <field table="a" name="zakaz_kod" title="Код" width="39" controlType="UIText" rows-limit="100" id="29102166" />
            <field table="a" name="zakaz_name" title="Наименование" width="92" controlType="UIText" rows-limit="100" id="65862564" />
          </band>
          <band title="МВЗ" id="42208786">
            <field table="a" name="mb3_kod" title="Код" width="94" controlType="UIText" rows-limit="100" id="24764721" />
            <field table="a" name="mb3_name" title="Наименование" width="133" controlType="UIText" rows-limit="100" id="8549899" />
            <field table="a" name="kod_schet_mb3" title="Код счета МВЗ" width="133" controlType="UIText" format="F0" edit-mask="F0" rows-limit="100" id="24541008" />
          </band>
          <band title="МВП: Партнер" id="11727352">
            <field table="a" name="mvp_partner_kod" title="Код" width="53" controlType="UIText" rows-limit="100" id="18221240" />
            <field table="a" name="mvp_partner_name" title="Наименование" width="129" controlType="UIText" rows-limit="100" id="12296391" />
          </band>
          <band title="Элемент затрат" id="31703401">
            <field table="a" name="el_zatr_kod" title="Код" width="87" controlType="UIText" format="F0" edit-mask="F0" rows-limit="100" id="31258856" />
            <field table="a" name="el_zatr_name" title="Наименование" width="103" controlType="UIText" rows-limit="100" id="55414926" />
            <field table="a" name="full_kod_smet" title="Список статей сметы по коду SAP" width="113" controlType="UIText" rows-limit="100" id="36945357" />
          </band>
          <band title="МВП" id="36955168">
            <field table="a" name="mvp_kod" title="Код" width="60" controlType="UIText" rows-limit="100" id="32175176" />
            <field table="a" name="mvp_name" title="Наименование" width="129" controlType="UIText" rows-limit="100" id="30437207" />
            <field table="a" name="name" title="Подразделение МПЭД" width="131" controlType="UIText" rows-limit="100" id="43934890" />
          </band>
          <field table="a" name="vyruchka" title="Выручка" width="63" controlType="UIText" edit-mask="N2" rows-limit="100" id="25163948" />
          <field table="a" name="vol_sbyt" title="ОбъемСбыта" width="85" controlType="UIText" edit-mask="N2" rows-limit="100" id="30812028" />
          <field table="a" name="zatr" title="Затраты" width="91" controlType="UIText" edit-mask="N2" rows-limit="100" id="37939239" />
          <field table="a" name="tut" title="ТУТ" width="85" controlType="UIText" edit-mask="N2" rows-limit="100" id="6891072" />
          <field table="a" name="rash_vod_m3" title="РасхВод М3" width="78" controlType="UIText" edit-mask="N2" rows-limit="100" id="20277079" />
          <field table="a" name="rash_vod_t" title="РасхВод Т" width="70" controlType="UIText" edit-mask="N2" rows-limit="100" id="60877023" />
          <field table="a" name="rez_tepl_nag" title="РезТеплНаг" width="78" controlType="UIText" edit-mask="N2" rows-limit="100" id="18658062" />
          <field table="a" name="pris_tep_nag" title="ПрисТепНаг" width="79" controlType="UIText" edit-mask="N2" rows-limit="100" id="59804323" />
          <field table="a" name="color" title="Цвет" controlType="UIText" rows-limit="100" id="41372716" />
        </columns>
      </grid>
    </fieldgroup>
  </form>
  <dataset>
    <fields>
      <field type="number" name="p_ym" parname="p_ym" title="Периоды" ColumnMandatory="1" />
      <field type="number" name="p_od_nd" parname="p_od_nd" title="ОД - НД" ColumnMandatory="1" />
      <field type="string" name="is_form_valid" parname="is_form_valid" />
      <field type="string" name="is_form_valid_not" parname="is_form_valid_not" />
      <field type="string" name="a_has_changes" parname="a_has_changes" />
    </fields>
    <table name="a" auto-refresh="1" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multiselect-column="" multiselect-target="" update-target="va_sp_calc" column-editable="0" key="kod_sp_calc" is-ms-upd="1" is-top="1">
      <select-text>
--
select a.vid_dey_kod as vid_dey_kod, /*Код*//*number*/
a.vid_dey_name as vid_dey_name, /*Наименование*//*string*/
kod_spr_vid_energ.vid_energ_name as vid_energ_name, /*Вид энергии*//*string*/
kod_spr_od_nd.od_nd_name as od_nd_name, /*ОД -  НД*//*string*/
a.ob_gen_kod as ob_gen_kod, /*Код*//*string*/
a.ob_gen_name as ob_gen_name, /*Наименование*//*string*/
a.period as period, /*Период*//*number*/
a.subject_fed_kod as subject_fed_kod, /*Код*//*number*/
a.subject_fed_name as subject_fed_name, /*Наименование*//*string*/
a.zakaz_kod as zakaz_kod, /*Код*//*string*/
a.zakaz_name as zakaz_name, /*Наименование*//*string*/
a.mb3_kod as mb3_kod, /*Код*//*string*/
a.mb3_name as mb3_name, /*Наименование*//*string*/
a.kod_schet_mb3 as kod_schet_mb3, /*Код счета МВЗ*//*number*/
a.mvp_partner_kod as mvp_partner_kod, /*Код*//*string*/
a.mvp_partner_name as mvp_partner_name, /*Наименование*//*string*/
a.el_zatr_kod as el_zatr_kod, /*Код*//*number*/
a.el_zatr_name as el_zatr_name, /*Наименование*//*string*/
sap_code_agg.full_kod_smet as full_kod_smet, /*Список статей сметы по коду SAP*//*string*/
a.mvp_kod as mvp_kod, /*Код*//*string*/
a.mvp_name as mvp_name, /*Наименование*//*string*/
kod_direct.name as name, /*Подразделение МПЭД*//*string*/
a.vyruchka as vyruchka, /*Выручка*//*number*/
a.vol_sbyt as vol_sbyt, /*ОбъемСбыта*//*number*/
a.zatr as zatr, /*Затраты*//*number*/
a.tut as tut, /*ТУТ*//*number*/
a.rash_vod_m3 as rash_vod_m3, /*РасхВод М3*//*number*/
a.rash_vod_t as rash_vod_t, /*РасхВод Т*//*number*/
a.rez_tepl_nag as rez_tepl_nag, /*РезТеплНаг*//*number*/
a.pris_tep_nag as pris_tep_nag, /*ПрисТепНаг*//*number*/
a.color as color, /*Цвет*//*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new, /*number*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
a.vid_dey_kod as vid_dey_kod, /**//*number*/
a.vid_dey_name as vid_dey_name, /**//*string*/
a.ob_gen_kod as ob_gen_kod, /**//*string*/
a.ob_gen_name as ob_gen_name, /**//*string*/
a.period as period, /**//*number*/
a.subject_fed_kod as subject_fed_kod, /**//*number*/
a.subject_fed_name as subject_fed_name, /**//*string*/
a.zakaz_kod as zakaz_kod, /**//*string*/
a.zakaz_name as zakaz_name, /**//*string*/
a.mb3_kod as mb3_kod, /**//*string*/
a.mb3_name as mb3_name, /**//*string*/
a.mvp_partner_kod as mvp_partner_kod, /**//*string*/
a.mvp_partner_name as mvp_partner_name, /**//*string*/
a.el_zatr_kod as el_zatr_kod, /**//*number*/
a.el_zatr_name as el_zatr_name, /**//*string*/
a.mvp_kod as mvp_kod, /**//*string*/
a.mvp_name as mvp_name, /**//*string*/
a.vyruchka as vyruchka, /**//*number*/
a.vol_sbyt as vol_sbyt, /**//*number*/
a.zatr as zatr, /**//*number*/
a.tut as tut, /**//*number*/
a.rash_vod_m3 as rash_vod_m3, /**//*number*/
a.rash_vod_t as rash_vod_t, /**//*number*/
a.rez_tepl_nag as rez_tepl_nag, /**//*number*/
a.pris_tep_nag as pris_tep_nag, /**//*number*/
a.kod_direct as kod_direct, /*number*/
 nvl( ( to_number( ( SUBSTR( a.mb3_kod , 5 , 1 ) )  ) )  , kod_spr_smet_calc.schet_no_mb3 )  as kod_schet_mb3, /*number*/
 case  when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) )  and (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null ) )  then '102,51,99' when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) ) )  then '139,0,0' when (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null )  then '204,204,0' end  as color, /*Цвет*//*string*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from va_sp_calc
a
--\va_sp_calc
left outer join
(
--vb_spr_smet_zatr_calc
select a.kod_spr_smet_zatr as kod_spr_smet_zatr, /*number*//*key*/
a.smet_code as smet_code, /**//*number*/
a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*/
a.period_s as period_s, /*number*/
a.period_po as period_po/*number*/

from vb_spr_smet_zatr_calc
a
--\vb_spr_smet_zatr_calc
)
vb_spr_smet_zatr_calc on (a.el_zatr_kod = vb_spr_smet_zatr_calc.smet_code)  and (a.period between vb_spr_smet_zatr_calc.period_s and ( nvl( vb_spr_smet_zatr_calc.period_po , 9999.99 ) ) ) --\vb_spr_smet_zatr_calc
left outer join
(
--vb_spr_smet_calc
select a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*//*key*/
a.schet_no_mb3 as schet_no_mb3/**//*number*/

from vb_spr_smet_calc
a
--\vb_spr_smet_calc
)
kod_spr_smet_calc on vb_spr_smet_zatr_calc.kod_spr_smet_calc = kod_spr_smet_calc.kod_spr_smet_calc--\vb_spr_smet_calc
)
a
--\va_sp_calc
left outer join
(
--vb_spr_smet_to_sap_agg
select a.sap_code as sap_code, /*string*//*key*/
stragg_dist(a.full_kod_smet)  as full_kod_smet/*Список статей сметы по коду SAP*//*string*/

from (
--vb_spr_smet_to_sap_agg_pre
select a.kod_spr_smet_to_sap as kod_spr_smet_to_sap, /*number*//*key*/
a.sap_code as sap_code, /*string*/
kod_spr_smet.full_kod_smet as full_kod_smet/*string*/

from (
--vb_spr_smet_to_sap
select a.kod_spr_smet_to_sap as kod_spr_smet_to_sap, /*number*//*key*/
a.kod_spr_smet as kod_spr_smet, /*number*/
a.sap_code as sap_code/*string*/

from vb_spr_smet_to_sap
a
--\vb_spr_smet_to_sap
where
a.period_po is null 
order by kod_spr_smet)
a
--\vb_spr_smet_to_sap
inner join
(
--is_spr_smet
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
is_spr_smet_tree.root_kod_smet || a.kod_smet as full_kod_smet/*string*/

from is_spr_smet
a
--\is_spr_smet
left outer join
(
--is_spr_smet_tree
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
 case  when (a.kod_parent is not null )  then a.root_kod_smet end  as root_kod_smet/*string*/

from (
--is_spr_smet_tree_pre
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
 connect_by_root a.kod_smet as root_kod_smet, /*string*/
a.kod_parent as kod_parent/*number*/

from (
--is_spr_smet
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
a.kod_smet as kod_smet, /*string*/
a.kod_parent as kod_parent/*number*/

from is_spr_smet
a
--\is_spr_smet
)
a
--\is_spr_smet
connect by nocycle
(a.kod_parent = prior a.kod_spr_smet) 
start with a.kod_parent is null )
a
--\is_spr_smet_tree_pre
)
is_spr_smet_tree on a.kod_spr_smet = is_spr_smet_tree.kod_spr_smet--\is_spr_smet_tree
)
kod_spr_smet on a.kod_spr_smet = kod_spr_smet.kod_spr_smet--\is_spr_smet

order by full_kod_smet)
a
--\vb_spr_smet_to_sap_agg_pre
 group by
a.sap_code/*string*//*key*/
)
sap_code_agg on ( to_char( a.el_zatr_kod ) )  = sap_code_agg.sap_code--\vb_spr_smet_to_sap_agg
left outer join
(
--is_spr_direct
select a.kod_direct as kod_direct, /*number*//*key*/
a.name as name/*Наименование*//*string*/

from is_spr_direct
a
--\is_spr_direct
)
kod_direct on a.kod_direct = kod_direct.kod_direct--\is_spr_direct
left outer join
(
--vb_spr_vid_dey
select a.vid_dey_sap_code as vid_dey_sap_code, /*Код вида деятельности*//*string*/
a.kod_spr_vid_energ as kod_spr_vid_energ/*number*/

from vb_spr_vid_dey
a
--\vb_spr_vid_dey
)
vd on a.vid_dey_kod = vd.vid_dey_sap_code--\vb_spr_vid_dey
left outer join
(
--vb_spr_vid_energ
select a.kod_spr_vid_energ as kod_spr_vid_energ, /*number*//*key*/
a.vid_energ_name as vid_energ_name, /*Вид энергии*//*string*/
a.kod_spr_od_nd as kod_spr_od_nd/*number*/

from vb_spr_vid_energ
a
--\vb_spr_vid_energ
)
kod_spr_vid_energ on vd.kod_spr_vid_energ = kod_spr_vid_energ.kod_spr_vid_energ--\vb_spr_vid_energ
left outer join
(
--vb_spr_od_nd
select a.kod_spr_od_nd as kod_spr_od_nd, /*number*//*key*/
a.od_nd_name as od_nd_name/*ОД -  НД*//*string*/

from vb_spr_od_nd
a
--\vb_spr_od_nd
)
kod_spr_od_nd on kod_spr_vid_energ.kod_spr_od_nd = kod_spr_od_nd.kod_spr_od_nd--\vb_spr_od_nd
where
(a.period in :p_ym )  and (( nvl( kod_spr_od_nd.kod_spr_od_nd , -1 ) )  in :p_od_nd ) 
order by period--\
</select-text>
      <columns>
        <column name="vid_dey_kod" table="a" type="number" title="Код" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="vid_dey_kod" temp-col-name="n1">
          <dep-refresh-cmd>
            <root table="a">
              <params>
                <param name="kod_sp_calc_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_sp_calc_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kod_spr_vid_energ.vid_energ_name as vid_energ_name, /*Вид энергии*//*string*/
kod_spr_od_nd.od_nd_name as od_nd_name, /*ОД -  НД*//*string*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
a.vid_dey_kod as vid_dey_kod/**//*number*/

from (select a.kod_sp_calc as kod_sp_calc,a.vid_dey_kod as vid_dey_kod  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n1 as vid_dey_kod  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
a
--\(select a.kod_sp_calc as kod_sp_calc,a.vid_dey_kod as vid_dey_kod  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n1 as vid_dey_kod  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
)
a
--\va_sp_calc
left outer join
(
--vb_spr_vid_dey
select a.vid_dey_sap_code as vid_dey_sap_code, /*Код вида деятельности*//*string*/
a.kod_spr_vid_energ as kod_spr_vid_energ/*number*/

from vb_spr_vid_dey
a
--\vb_spr_vid_dey
)
vd on a.vid_dey_kod = vd.vid_dey_sap_code--\vb_spr_vid_dey
left outer join
(
--vb_spr_vid_energ
select a.kod_spr_vid_energ as kod_spr_vid_energ, /*number*//*key*/
a.vid_energ_name as vid_energ_name, /*Вид энергии*//*string*/
a.kod_spr_od_nd as kod_spr_od_nd/*number*/

from vb_spr_vid_energ
a
--\vb_spr_vid_energ
)
kod_spr_vid_energ on vd.kod_spr_vid_energ = kod_spr_vid_energ.kod_spr_vid_energ--\vb_spr_vid_energ
left outer join
(
--vb_spr_od_nd
select a.kod_spr_od_nd as kod_spr_od_nd, /*number*//*key*/
a.od_nd_name as od_nd_name/*ОД -  НД*//*string*/

from vb_spr_od_nd
a
--\vb_spr_od_nd
)
kod_spr_od_nd on kod_spr_vid_energ.kod_spr_od_nd = kod_spr_od_nd.kod_spr_od_nd--\vb_spr_od_nd
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </dep-refresh-cmd>
          <dependants>
            <dependant name="vid_energ_name" table="a" />
            <dependant name="od_nd_name" table="a" />
          </dependants>
        </column>
        <column name="vid_dey_name" table="a" type="string" title="Наименование" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="vid_dey_name" temp-col-name="s1" />
        <column name="vid_energ_name" table="kod_spr_vid_energ" type="string" title="Вид энергии" ClientBackColor="color" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_sp_calc_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_sp_calc_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kod_spr_vid_energ.vid_energ_name as vid_energ_name, /*Вид энергии*//*string*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
a.vid_dey_kod as vid_dey_kod/**//*number*/

from (select a.kod_sp_calc as kod_sp_calc,a.vid_dey_kod as vid_dey_kod  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n1 as vid_dey_kod  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
a
--\(select a.kod_sp_calc as kod_sp_calc,a.vid_dey_kod as vid_dey_kod  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n1 as vid_dey_kod  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
)
a
--\va_sp_calc
left outer join
(
--vb_spr_vid_dey
select a.vid_dey_sap_code as vid_dey_sap_code, /*Код вида деятельности*//*string*/
a.kod_spr_vid_energ as kod_spr_vid_energ/*number*/

from vb_spr_vid_dey
a
--\vb_spr_vid_dey
)
vd on a.vid_dey_kod = vd.vid_dey_sap_code--\vb_spr_vid_dey
left outer join
(
--vb_spr_vid_energ
select a.kod_spr_vid_energ as kod_spr_vid_energ, /*number*//*key*/
a.vid_energ_name as vid_energ_name/*Вид энергии*//*string*/

from vb_spr_vid_energ
a
--\vb_spr_vid_energ
)
kod_spr_vid_energ on vd.kod_spr_vid_energ = kod_spr_vid_energ.kod_spr_vid_energ--\vb_spr_vid_energ
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="od_nd_name" table="kod_spr_od_nd" type="string" title="ОД -  НД" ClientBackColor="color" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_sp_calc_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_sp_calc_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kod_spr_od_nd.od_nd_name as od_nd_name, /*ОД -  НД*//*string*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
a.vid_dey_kod as vid_dey_kod/**//*number*/

from (select a.kod_sp_calc as kod_sp_calc,a.vid_dey_kod as vid_dey_kod  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n1 as vid_dey_kod  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
a
--\(select a.kod_sp_calc as kod_sp_calc,a.vid_dey_kod as vid_dey_kod  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n1 as vid_dey_kod  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
)
a
--\va_sp_calc
left outer join
(
--vb_spr_vid_dey
select a.vid_dey_sap_code as vid_dey_sap_code, /*Код вида деятельности*//*string*/
a.kod_spr_vid_energ as kod_spr_vid_energ/*number*/

from vb_spr_vid_dey
a
--\vb_spr_vid_dey
)
vd on a.vid_dey_kod = vd.vid_dey_sap_code--\vb_spr_vid_dey
left outer join
(
--vb_spr_vid_energ
select a.kod_spr_vid_energ as kod_spr_vid_energ, /*number*//*key*/
a.kod_spr_od_nd as kod_spr_od_nd/*number*/

from vb_spr_vid_energ
a
--\vb_spr_vid_energ
)
kod_spr_vid_energ on vd.kod_spr_vid_energ = kod_spr_vid_energ.kod_spr_vid_energ--\vb_spr_vid_energ
left outer join
(
--vb_spr_od_nd
select a.kod_spr_od_nd as kod_spr_od_nd, /*number*//*key*/
a.od_nd_name as od_nd_name/*ОД -  НД*//*string*/

from vb_spr_od_nd
a
--\vb_spr_od_nd
)
kod_spr_od_nd on kod_spr_vid_energ.kod_spr_od_nd = kod_spr_od_nd.kod_spr_od_nd--\vb_spr_od_nd
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="ob_gen_kod" table="a" type="string" title="Код" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="ob_gen_kod" temp-col-name="s2" />
        <column name="ob_gen_name" table="a" type="string" title="Наименование" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="ob_gen_name" temp-col-name="s3" />
        <column name="period" table="a" type="number" title="Период" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="period" temp-col-name="n2">
          <dep-refresh-cmd>
            <root table="a">
              <params>
                <param name="kod_sp_calc_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_sp_calc_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select a.kod_schet_mb3 as kod_schet_mb3, /*Код счета МВЗ*//*number*/
a.color as color, /*Цвет*//*string*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
 nvl( ( to_number( ( SUBSTR( a.mb3_kod , 5 , 1 ) )  ) )  , kod_spr_smet_calc.schet_no_mb3 )  as kod_schet_mb3, /*number*/
 case  when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) )  and (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null ) )  then '102,51,99' when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) ) )  then '139,0,0' when (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null )  then '204,204,0' end  as color/*Цвет*//*string*/

from (select a.kod_sp_calc as kod_sp_calc,a.mb3_kod as mb3_kod,a.mvp_kod as mvp_kod,a.el_zatr_kod as el_zatr_kod,a.period as period  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.s7 as mb3_kod,t.s12 as mvp_kod,t.n4 as el_zatr_kod,t.n2 as period  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
a
--\(select a.kod_sp_calc as kod_sp_calc,a.mb3_kod as mb3_kod,a.mvp_kod as mvp_kod,a.el_zatr_kod as el_zatr_kod,a.period as period  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.s7 as mb3_kod,t.s12 as mvp_kod,t.n4 as el_zatr_kod,t.n2 as period  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
left outer join
(
--vb_spr_smet_zatr_calc
select a.kod_spr_smet_zatr as kod_spr_smet_zatr, /*number*//*key*/
a.smet_code as smet_code, /**//*number*/
a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*/
a.period_s as period_s, /*number*/
a.period_po as period_po/*number*/

from vb_spr_smet_zatr_calc
a
--\vb_spr_smet_zatr_calc
)
vb_spr_smet_zatr_calc on (a.el_zatr_kod = vb_spr_smet_zatr_calc.smet_code)  and (a.period between vb_spr_smet_zatr_calc.period_s and ( nvl( vb_spr_smet_zatr_calc.period_po , 9999.99 ) ) ) --\vb_spr_smet_zatr_calc
left outer join
(
--vb_spr_smet_calc
select a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*//*key*/
a.schet_no_mb3 as schet_no_mb3/**//*number*/

from vb_spr_smet_calc
a
--\vb_spr_smet_calc
)
kod_spr_smet_calc on vb_spr_smet_zatr_calc.kod_spr_smet_calc = kod_spr_smet_calc.kod_spr_smet_calc--\vb_spr_smet_calc
)
a
--\va_sp_calc
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </dep-refresh-cmd>
          <dependants>
            <dependant name="kod_schet_mb3" table="a" />
            <dependant name="color" table="a" />
          </dependants>
        </column>
        <column name="subject_fed_kod" table="a" type="number" title="Код" ColumnEditable="1" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="subject_fed_kod" temp-col-name="n3">
          <sel-list-compiled>
            <root>
              <query class="1" timestamp="05.09.2019 18:01:14" order="subject_name" file="sql.builder.templates\sql.builder\projects\mped\scheme\original\vb_spr_fed_subject.xml" haskeys="1" name="a" as="a" noname="1" path="./a" used="1">
                <order notext="1">
                  <column column="subject_name">subject_name</column>
                </order>
                <select>--a
select <column table="a" column="kod_subj" group="1" vid="1" is-name="1" key="1" as="kod_subj" used="1" type="number" title="Код субъекта" format="F0" sourcetable="./a/a" sourcecolumn="kod_subj" into="n1">a.kod_subj as kod_subj, /*Код субъекта*//*number*//*key*/
</column><column table="a" column="subject_name" group="1" vid="1" as="subject_name" key="0" used="1" type="string" title="Субъект РФ" sourcetable="./a/a" sourcecolumn="subject_name" into="s1">a.subject_name as subject_name/*Субъект РФ*//*string*/
</column></select>
                <from>
from <query name="vb_spr_fed_subject" as="a" path="./a/a" order="subject_name" haskeys="1" used="1">(
<order notext="1"><column column="subject_name">subject_name</column></order><select>--vb_spr_fed_subject
select <column table="a" column="kod_spr_subj" type="number" column-mandatory="1" as="kod_spr_subj" key="1" fixed="1" used="1" sourcetable="./a/a" sourcecolumn="kod_spr_subj">a.kod_spr_subj as kod_spr_subj, /*number*//*key*/
</column><column table="a" column="subject_name" type="string" data-size="300" title="Субъект РФ" vid="1" is-name="1" as="subject_name" key="0" used="1" sourcetable="./a/a" sourcecolumn="subject_name">a.subject_name as subject_name, /*Субъект РФ*//*string*/
</column><column table="a" column="kod_subj" type="number" title="Код субъекта" vid="1" is-name="1" format="F0" as="kod_subj" key="0" used="1" sourcetable="./a/a" sourcecolumn="kod_subj">a.kod_subj as kod_subj/*Код субъекта*//*number*/
</column></select><from>
from <table name="vb_spr_fed_subject" as="a" used="1">vb_spr_fed_subject
a
--\vb_spr_fed_subject
</table></from><order>
order by subject_name</order>)
a
--\vb_spr_fed_subject
</query></from>
                <where>where
<call function="and" pth="" type="bool"><call function="le" pth="" type="bool">(<call function="rownum" pth="0" type="number"><text txtype="func"> rownum </text></call><text txtype="func"> &lt;= </text><const><text>:p_rows_limit </text></const>) </call><text txtype="func"> { </text><text txtype="func"> and </text><call function="in" pth="" optional="1" type="bool">(<column table="a" column="kod_subj" group="1" vid="1" is-name="1" key="1" as="kod_subj" thissrc="kod_subj">a.kod_subj</column><text txtype="func"> in </text><const><text>:pk_prm </text></const>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="in" pth="" optional="1" type="bool">(<column table="a" column="kod_subj" group="1" vid="1" is-name="1" key="1" as="kod_subj" thissrc="kod_subj">a.kod_subj</column><text txtype="func"> in </text><const><text>:obj_name </text></const>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kod_subj" group="1" vid="1" is-name="1" key="1" as="kod_subj" thissrc="kod_subj">a.kod_subj</column><text txtype="func"> ) like lower( </text><const><text>:kod_subj_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="subject_name" group="1" vid="1" as="subject_name" thissrc="subject_name">a.subject_name</column><text txtype="func"> ) like lower( </text><const><text>:subject_name_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text></call></where>
                <group> group by
<column table="a" column="kod_subj" group="1" vid="1" is-name="1" key="1" as="kod_subj" used="1" type="number" title="Код субъекта" format="F0" sourcetable="./a/a" sourcecolumn="kod_subj" into="n1">a.kod_subj, /*Код субъекта*//*number*//*key*/
</column><column table="a" column="subject_name" group="1" vid="1" as="subject_name" key="0" used="1" type="string" title="Субъект РФ" sourcetable="./a/a" sourcecolumn="subject_name" into="s1">a.subject_name/*Субъект РФ*//*string*/
</column></group>
                <order>
order by subject_name</order>--\a
</query>
            </root>
          </sel-list-compiled>
          <sel-list-report>
            <report name="a" class="1" timestamp="05.09.2019 18:01:14" order="subject_name" file="sql.builder.templates\sql.builder\projects\mped\scheme\original\vb_spr_fed_subject.xml" haskeys="1" as="a">
              <queries>
                <query class="1" timestamp="05.09.2019 18:01:14" order="subject_name" file="sql.builder.templates\sql.builder\projects\mped\scheme\original\vb_spr_fed_subject.xml" haskeys="1" name="a" as="a">
                  <params>
                    <param name="pk_prm" type="array" />
                    <param name="obj_name" type="array" />
                    <param name="kod_subj_filter" type="string" />
                    <param name="subject_name_filter" type="string" />
                    <param name="p_rows_limit" type="number" />
                  </params>
                  <select>
                    <column table="a" column="kod_subj" group="1" vid="1" is-name="1" key="1" as="kod_subj" />
                    <column table="a" column="subject_name" group="1" vid="1" as="subject_name" />
                  </select>
                  <from>
                    <query name="vb_spr_fed_subject" as="a" />
                  </from>
                  <where>
                    <call function="and">
                      <call function="le">
                        <call function="rownum" />
                        <useparam name="p_rows_limit" />
                      </call>
                      <call function="in" optional="1">
                        <column table="this" column="kod_subj" />
                        <useparam name="pk_prm" />
                      </call>
                      <call function="in" optional="1">
                        <column table="this" column="kod_subj" />
                        <useparam name="obj_name" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_subj" />
                        <useparam name="kod_subj_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="subject_name" />
                        <useparam name="subject_name_filter" />
                      </call>
                    </call>
                  </where>
                  <order>
                    <column column="subject_name" />
                  </order>
                  <order>
                    <column column="subject_name" />
                  </order>
                  <withparams>
                    <useparam name="pk_prm" />
                    <useparam name="obj_name" />
                    <useparam name="kod_subj_filter" />
                    <useparam name="subject_name_filter" />
                    <useparam name="p_rows_limit" />
                  </withparams>
                </query>
              </queries>
              <params>
                <param name="pk_prm" type="array">
                  <const>:pk_prm </const>
                </param>
                <param name="obj_name" type="array">
                  <const>:obj_name </const>
                </param>
                <param name="kod_subj_filter" type="string">
                  <const>:kod_subj_filter </const>
                </param>
                <param name="subject_name_filter" type="string">
                  <const>:subject_name_filter </const>
                </param>
                <param name="p_rows_limit" type="number">
                  <const>:p_rows_limit </const>
                </param>
              </params>
            </report>
          </sel-list-report>
          <sel-list-pars>
            <params />
          </sel-list-pars>
        </column>
        <column name="subject_fed_name" table="a" type="string" title="Наименование" ColumnEditable="1" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="subject_fed_name" temp-col-name="s4">
          <sel-list-compiled>
            <root>
              <query class="1" timestamp="05.09.2019 18:00:20" order="subject_name" file="sql.builder.templates\sql.builder\projects\mped\scheme\original\vb_spr_fed_subject.xml" haskeys="1" name="a" as="a" noname="1" path="./a" used="1">
                <order notext="1">
                  <column column="subject_name">subject_name</column>
                </order>
                <select>--a
select <column table="a" column="subject_name" group="1" vid="1" is-name="1" key="1" as="subject_name" used="1" type="string" title="Субъект РФ" sourcetable="./a/a" sourcecolumn="subject_name" into="s1">a.subject_name as subject_name, /*Субъект РФ*//*string*//*key*/
</column><column table="a" column="kod_subj" group="1" vid="1" as="kod_subj" key="0" used="1" type="number" title="Код субъекта" format="F0" sourcetable="./a/a" sourcecolumn="kod_subj" into="n1">a.kod_subj as kod_subj/*Код субъекта*//*number*/
</column></select>
                <from>
from <query name="vb_spr_fed_subject" as="a" path="./a/a" order="subject_name" haskeys="1" used="1">(
<order notext="1"><column column="subject_name">subject_name</column></order><select>--vb_spr_fed_subject
select <column table="a" column="kod_spr_subj" type="number" column-mandatory="1" as="kod_spr_subj" key="1" fixed="1" used="1" sourcetable="./a/a" sourcecolumn="kod_spr_subj">a.kod_spr_subj as kod_spr_subj, /*number*//*key*/
</column><column table="a" column="subject_name" type="string" data-size="300" title="Субъект РФ" vid="1" is-name="1" as="subject_name" key="0" used="1" sourcetable="./a/a" sourcecolumn="subject_name">a.subject_name as subject_name, /*Субъект РФ*//*string*/
</column><column table="a" column="kod_subj" type="number" title="Код субъекта" vid="1" is-name="1" format="F0" as="kod_subj" key="0" used="1" sourcetable="./a/a" sourcecolumn="kod_subj">a.kod_subj as kod_subj/*Код субъекта*//*number*/
</column></select><from>
from <table name="vb_spr_fed_subject" as="a" used="1">vb_spr_fed_subject
a
--\vb_spr_fed_subject
</table></from><order>
order by subject_name</order>)
a
--\vb_spr_fed_subject
</query></from>
                <where>where
<call function="and" pth="" type="bool"><call function="le" pth="" type="bool">(<call function="rownum" pth="0" type="number"><text txtype="func"> rownum </text></call><text txtype="func"> &lt;= </text><const><text>:p_rows_limit </text></const>) </call><text txtype="func"> { </text><text txtype="func"> and </text><call function="in" pth="" optional="1" type="bool">(<column table="a" column="subject_name" group="1" vid="1" is-name="1" key="1" as="subject_name" thissrc="subject_name">a.subject_name</column><text txtype="func"> in </text><const><text>:pk_prm </text></const>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="in" pth="" optional="1" type="bool">(<column table="a" column="subject_name" group="1" vid="1" is-name="1" key="1" as="subject_name" thissrc="subject_name">a.subject_name</column><text txtype="func"> in </text><const><text>:obj_name </text></const>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="subject_name" group="1" vid="1" is-name="1" key="1" as="subject_name" thissrc="subject_name">a.subject_name</column><text txtype="func"> ) like lower( </text><const><text>:subject_name_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kod_subj" group="1" vid="1" as="kod_subj" thissrc="kod_subj">a.kod_subj</column><text txtype="func"> ) like lower( </text><const><text>:kod_subj_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text></call></where>
                <group> group by
<column table="a" column="subject_name" group="1" vid="1" is-name="1" key="1" as="subject_name" used="1" type="string" title="Субъект РФ" sourcetable="./a/a" sourcecolumn="subject_name" into="s1">a.subject_name, /*Субъект РФ*//*string*//*key*/
</column><column table="a" column="kod_subj" group="1" vid="1" as="kod_subj" key="0" used="1" type="number" title="Код субъекта" format="F0" sourcetable="./a/a" sourcecolumn="kod_subj" into="n1">a.kod_subj/*Код субъекта*//*number*/
</column></group>
                <order>
order by subject_name</order>--\a
</query>
            </root>
          </sel-list-compiled>
          <sel-list-report>
            <report name="a" class="1" timestamp="05.09.2019 18:00:20" order="subject_name" file="sql.builder.templates\sql.builder\projects\mped\scheme\original\vb_spr_fed_subject.xml" haskeys="1" as="a">
              <queries>
                <query class="1" timestamp="05.09.2019 18:00:20" order="subject_name" file="sql.builder.templates\sql.builder\projects\mped\scheme\original\vb_spr_fed_subject.xml" haskeys="1" name="a" as="a">
                  <params>
                    <param name="pk_prm" type="array" />
                    <param name="obj_name" type="array" />
                    <param name="subject_name_filter" type="string" />
                    <param name="kod_subj_filter" type="string" />
                    <param name="p_rows_limit" type="number" />
                  </params>
                  <select>
                    <column table="a" column="subject_name" group="1" vid="1" is-name="1" key="1" as="subject_name" />
                    <column table="a" column="kod_subj" group="1" vid="1" as="kod_subj" />
                  </select>
                  <from>
                    <query name="vb_spr_fed_subject" as="a" />
                  </from>
                  <where>
                    <call function="and">
                      <call function="le">
                        <call function="rownum" />
                        <useparam name="p_rows_limit" />
                      </call>
                      <call function="in" optional="1">
                        <column table="this" column="subject_name" />
                        <useparam name="pk_prm" />
                      </call>
                      <call function="in" optional="1">
                        <column table="this" column="subject_name" />
                        <useparam name="obj_name" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="subject_name" />
                        <useparam name="subject_name_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_subj" />
                        <useparam name="kod_subj_filter" />
                      </call>
                    </call>
                  </where>
                  <order>
                    <column column="subject_name" />
                  </order>
                  <order>
                    <column column="subject_name" />
                  </order>
                  <withparams>
                    <useparam name="pk_prm" />
                    <useparam name="obj_name" />
                    <useparam name="subject_name_filter" />
                    <useparam name="kod_subj_filter" />
                    <useparam name="p_rows_limit" />
                  </withparams>
                </query>
              </queries>
              <params>
                <param name="pk_prm" type="array">
                  <const>:pk_prm </const>
                </param>
                <param name="obj_name" type="array">
                  <const>:obj_name </const>
                </param>
                <param name="subject_name_filter" type="string">
                  <const>:subject_name_filter </const>
                </param>
                <param name="kod_subj_filter" type="string">
                  <const>:kod_subj_filter </const>
                </param>
                <param name="p_rows_limit" type="number">
                  <const>:p_rows_limit </const>
                </param>
              </params>
            </report>
          </sel-list-report>
          <sel-list-pars>
            <params />
          </sel-list-pars>
        </column>
        <column name="zakaz_kod" table="a" type="string" title="Код" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="zakaz_kod" temp-col-name="s5" />
        <column name="zakaz_name" table="a" type="string" title="Наименование" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="zakaz_name" temp-col-name="s6" />
        <column name="mb3_kod" table="a" type="string" title="Код" ColumnEditable="1" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="mb3_kod" temp-col-name="s7">
          <dep-refresh-cmd>
            <root table="a">
              <params>
                <param name="kod_sp_calc_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_sp_calc_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select a.kod_schet_mb3 as kod_schet_mb3, /*Код счета МВЗ*//*number*/
a.color as color, /*Цвет*//*string*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
 nvl( ( to_number( ( SUBSTR( a.mb3_kod , 5 , 1 ) )  ) )  , kod_spr_smet_calc.schet_no_mb3 )  as kod_schet_mb3, /*number*/
 case  when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) )  and (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null ) )  then '102,51,99' when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) ) )  then '139,0,0' when (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null )  then '204,204,0' end  as color/*Цвет*//*string*/

from (select a.kod_sp_calc as kod_sp_calc,a.mb3_kod as mb3_kod,a.mvp_kod as mvp_kod,a.el_zatr_kod as el_zatr_kod,a.period as period  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.s7 as mb3_kod,t.s12 as mvp_kod,t.n4 as el_zatr_kod,t.n2 as period  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
a
--\(select a.kod_sp_calc as kod_sp_calc,a.mb3_kod as mb3_kod,a.mvp_kod as mvp_kod,a.el_zatr_kod as el_zatr_kod,a.period as period  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.s7 as mb3_kod,t.s12 as mvp_kod,t.n4 as el_zatr_kod,t.n2 as period  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
left outer join
(
--vb_spr_smet_zatr_calc
select a.kod_spr_smet_zatr as kod_spr_smet_zatr, /*number*//*key*/
a.smet_code as smet_code, /**//*number*/
a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*/
a.period_s as period_s, /*number*/
a.period_po as period_po/*number*/

from vb_spr_smet_zatr_calc
a
--\vb_spr_smet_zatr_calc
)
vb_spr_smet_zatr_calc on (a.el_zatr_kod = vb_spr_smet_zatr_calc.smet_code)  and (a.period between vb_spr_smet_zatr_calc.period_s and ( nvl( vb_spr_smet_zatr_calc.period_po , 9999.99 ) ) ) --\vb_spr_smet_zatr_calc
left outer join
(
--vb_spr_smet_calc
select a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*//*key*/
a.schet_no_mb3 as schet_no_mb3/**//*number*/

from vb_spr_smet_calc
a
--\vb_spr_smet_calc
)
kod_spr_smet_calc on vb_spr_smet_zatr_calc.kod_spr_smet_calc = kod_spr_smet_calc.kod_spr_smet_calc--\vb_spr_smet_calc
)
a
--\va_sp_calc
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </dep-refresh-cmd>
          <dependants>
            <dependant name="kod_schet_mb3" table="a" />
            <dependant name="color" table="a" />
          </dependants>
        </column>
        <column name="mb3_name" table="a" type="string" title="Наименование" ColumnEditable="1" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="mb3_name" temp-col-name="s8" />
        <column name="kod_schet_mb3" table="a" type="number" title="Код счета МВЗ" is-user-editable="1" ClientBackColor="color" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_sp_calc_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_sp_calc_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select a.kod_schet_mb3 as kod_schet_mb3, /*Код счета МВЗ*//*number*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
 nvl( ( to_number( ( SUBSTR( a.mb3_kod , 5 , 1 ) )  ) )  , kod_spr_smet_calc.schet_no_mb3 )  as kod_schet_mb3/*number*/

from (select a.kod_sp_calc as kod_sp_calc,a.mb3_kod as mb3_kod,a.el_zatr_kod as el_zatr_kod,a.period as period  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.s7 as mb3_kod,t.n4 as el_zatr_kod,t.n2 as period  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
a
--\(select a.kod_sp_calc as kod_sp_calc,a.mb3_kod as mb3_kod,a.el_zatr_kod as el_zatr_kod,a.period as period  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.s7 as mb3_kod,t.n4 as el_zatr_kod,t.n2 as period  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
left outer join
(
--vb_spr_smet_zatr_calc
select a.kod_spr_smet_zatr as kod_spr_smet_zatr, /*number*//*key*/
a.smet_code as smet_code, /**//*number*/
a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*/
a.period_s as period_s, /*number*/
a.period_po as period_po/*number*/

from vb_spr_smet_zatr_calc
a
--\vb_spr_smet_zatr_calc
)
vb_spr_smet_zatr_calc on (a.el_zatr_kod = vb_spr_smet_zatr_calc.smet_code)  and (a.period between vb_spr_smet_zatr_calc.period_s and ( nvl( vb_spr_smet_zatr_calc.period_po , 9999.99 ) ) ) --\vb_spr_smet_zatr_calc
left outer join
(
--vb_spr_smet_calc
select a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*//*key*/
a.schet_no_mb3 as schet_no_mb3/**//*number*/

from vb_spr_smet_calc
a
--\vb_spr_smet_calc
)
kod_spr_smet_calc on vb_spr_smet_zatr_calc.kod_spr_smet_calc = kod_spr_smet_calc.kod_spr_smet_calc--\vb_spr_smet_calc
)
a
--\va_sp_calc
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="mvp_partner_kod" table="a" type="string" title="Код" ColumnEditable="1" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="mvp_partner_kod" temp-col-name="s9" />
        <column name="mvp_partner_name" table="a" type="string" title="Наименование" ColumnEditable="1" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="mvp_partner_name" temp-col-name="s10" />
        <column name="el_zatr_kod" table="a" type="number" title="Код" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="el_zatr_kod" temp-col-name="n4">
          <dep-refresh-cmd>
            <root table="a">
              <params>
                <param name="kod_sp_calc_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_sp_calc_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select a.kod_schet_mb3 as kod_schet_mb3, /*Код счета МВЗ*//*number*/
sap_code_agg.full_kod_smet as full_kod_smet, /*Список статей сметы по коду SAP*//*string*/
a.color as color, /*Цвет*//*string*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
a.el_zatr_kod as el_zatr_kod, /**//*number*/
 nvl( ( to_number( ( SUBSTR( a.mb3_kod , 5 , 1 ) )  ) )  , kod_spr_smet_calc.schet_no_mb3 )  as kod_schet_mb3, /*number*/
 case  when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) )  and (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null ) )  then '102,51,99' when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) ) )  then '139,0,0' when (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null )  then '204,204,0' end  as color/*Цвет*//*string*/

from (select a.kod_sp_calc as kod_sp_calc,a.el_zatr_kod as el_zatr_kod,a.mb3_kod as mb3_kod,a.mvp_kod as mvp_kod,a.period as period  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n4 as el_zatr_kod,t.s7 as mb3_kod,t.s12 as mvp_kod,t.n2 as period  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
a
--\(select a.kod_sp_calc as kod_sp_calc,a.el_zatr_kod as el_zatr_kod,a.mb3_kod as mb3_kod,a.mvp_kod as mvp_kod,a.period as period  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n4 as el_zatr_kod,t.s7 as mb3_kod,t.s12 as mvp_kod,t.n2 as period  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
left outer join
(
--vb_spr_smet_zatr_calc
select a.kod_spr_smet_zatr as kod_spr_smet_zatr, /*number*//*key*/
a.smet_code as smet_code, /**//*number*/
a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*/
a.period_s as period_s, /*number*/
a.period_po as period_po/*number*/

from vb_spr_smet_zatr_calc
a
--\vb_spr_smet_zatr_calc
)
vb_spr_smet_zatr_calc on (a.el_zatr_kod = vb_spr_smet_zatr_calc.smet_code)  and (a.period between vb_spr_smet_zatr_calc.period_s and ( nvl( vb_spr_smet_zatr_calc.period_po , 9999.99 ) ) ) --\vb_spr_smet_zatr_calc
left outer join
(
--vb_spr_smet_calc
select a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*//*key*/
a.schet_no_mb3 as schet_no_mb3/**//*number*/

from vb_spr_smet_calc
a
--\vb_spr_smet_calc
)
kod_spr_smet_calc on vb_spr_smet_zatr_calc.kod_spr_smet_calc = kod_spr_smet_calc.kod_spr_smet_calc--\vb_spr_smet_calc
)
a
--\va_sp_calc
left outer join
(
--vb_spr_smet_to_sap_agg
select a.sap_code as sap_code, /*string*//*key*/
stragg_dist(a.full_kod_smet)  as full_kod_smet/*Список статей сметы по коду SAP*//*string*/

from (
--vb_spr_smet_to_sap_agg_pre
select a.kod_spr_smet_to_sap as kod_spr_smet_to_sap, /*number*//*key*/
a.sap_code as sap_code, /*string*/
kod_spr_smet.full_kod_smet as full_kod_smet/*string*/

from (
--vb_spr_smet_to_sap
select a.kod_spr_smet_to_sap as kod_spr_smet_to_sap, /*number*//*key*/
a.kod_spr_smet as kod_spr_smet, /*number*/
a.sap_code as sap_code/*string*/

from vb_spr_smet_to_sap
a
--\vb_spr_smet_to_sap
where
a.period_po is null 
order by kod_spr_smet)
a
--\vb_spr_smet_to_sap
inner join
(
--is_spr_smet
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
is_spr_smet_tree.root_kod_smet || a.kod_smet as full_kod_smet/*string*/

from is_spr_smet
a
--\is_spr_smet
left outer join
(
--is_spr_smet_tree
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
 case  when (a.kod_parent is not null )  then a.root_kod_smet end  as root_kod_smet/*string*/

from (
--is_spr_smet_tree_pre
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
 connect_by_root a.kod_smet as root_kod_smet, /*string*/
a.kod_parent as kod_parent/*number*/

from (
--is_spr_smet
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
a.kod_smet as kod_smet, /*string*/
a.kod_parent as kod_parent/*number*/

from is_spr_smet
a
--\is_spr_smet
)
a
--\is_spr_smet
connect by nocycle
(a.kod_parent = prior a.kod_spr_smet) 
start with a.kod_parent is null )
a
--\is_spr_smet_tree_pre
)
is_spr_smet_tree on a.kod_spr_smet = is_spr_smet_tree.kod_spr_smet--\is_spr_smet_tree
)
kod_spr_smet on a.kod_spr_smet = kod_spr_smet.kod_spr_smet--\is_spr_smet

order by full_kod_smet)
a
--\vb_spr_smet_to_sap_agg_pre
 group by
a.sap_code/*string*//*key*/
)
sap_code_agg on ( to_char( a.el_zatr_kod ) )  = sap_code_agg.sap_code--\vb_spr_smet_to_sap_agg
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </dep-refresh-cmd>
          <dependants>
            <dependant name="kod_schet_mb3" table="a" />
            <dependant name="full_kod_smet" table="a" />
            <dependant name="color" table="a" />
          </dependants>
        </column>
        <column name="el_zatr_name" table="a" type="string" title="Наименование" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="el_zatr_name" temp-col-name="s11" />
        <column name="full_kod_smet" table="sap_code_agg" type="string" title="Список статей сметы по коду SAP" ClientBackColor="color" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_sp_calc_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_sp_calc_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select sap_code_agg.full_kod_smet as full_kod_smet, /*Список статей сметы по коду SAP*//*string*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
a.el_zatr_kod as el_zatr_kod/**//*number*/

from (select a.kod_sp_calc as kod_sp_calc,a.el_zatr_kod as el_zatr_kod  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n4 as el_zatr_kod  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
a
--\(select a.kod_sp_calc as kod_sp_calc,a.el_zatr_kod as el_zatr_kod  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n4 as el_zatr_kod  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
)
a
--\va_sp_calc
left outer join
(
--vb_spr_smet_to_sap_agg
select a.sap_code as sap_code, /*string*//*key*/
stragg_dist(a.full_kod_smet)  as full_kod_smet/*Список статей сметы по коду SAP*//*string*/

from (
--vb_spr_smet_to_sap_agg_pre
select a.kod_spr_smet_to_sap as kod_spr_smet_to_sap, /*number*//*key*/
a.sap_code as sap_code, /*string*/
kod_spr_smet.full_kod_smet as full_kod_smet/*string*/

from (
--vb_spr_smet_to_sap
select a.kod_spr_smet_to_sap as kod_spr_smet_to_sap, /*number*//*key*/
a.kod_spr_smet as kod_spr_smet, /*number*/
a.sap_code as sap_code/*string*/

from vb_spr_smet_to_sap
a
--\vb_spr_smet_to_sap
where
a.period_po is null 
order by kod_spr_smet)
a
--\vb_spr_smet_to_sap
inner join
(
--is_spr_smet
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
is_spr_smet_tree.root_kod_smet || a.kod_smet as full_kod_smet/*string*/

from is_spr_smet
a
--\is_spr_smet
left outer join
(
--is_spr_smet_tree
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
 case  when (a.kod_parent is not null )  then a.root_kod_smet end  as root_kod_smet/*string*/

from (
--is_spr_smet_tree_pre
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
 connect_by_root a.kod_smet as root_kod_smet, /*string*/
a.kod_parent as kod_parent/*number*/

from (
--is_spr_smet
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
a.kod_smet as kod_smet, /*string*/
a.kod_parent as kod_parent/*number*/

from is_spr_smet
a
--\is_spr_smet
)
a
--\is_spr_smet
connect by nocycle
(a.kod_parent = prior a.kod_spr_smet) 
start with a.kod_parent is null )
a
--\is_spr_smet_tree_pre
)
is_spr_smet_tree on a.kod_spr_smet = is_spr_smet_tree.kod_spr_smet--\is_spr_smet_tree
)
kod_spr_smet on a.kod_spr_smet = kod_spr_smet.kod_spr_smet--\is_spr_smet

order by full_kod_smet)
a
--\vb_spr_smet_to_sap_agg_pre
 group by
a.sap_code/*string*//*key*/
)
sap_code_agg on ( to_char( a.el_zatr_kod ) )  = sap_code_agg.sap_code--\vb_spr_smet_to_sap_agg
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="mvp_kod" table="a" type="string" title="Код" ColumnEditable="1" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="mvp_kod" temp-col-name="s12">
          <dep-refresh-cmd>
            <root table="a">
              <params>
                <param name="kod_sp_calc_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_sp_calc_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select a.color as color, /*Цвет*//*string*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
 case  when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) )  and (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null ) )  then '102,51,99' when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) ) )  then '139,0,0' when (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null )  then '204,204,0' end  as color/*Цвет*//*string*/

from (select a.kod_sp_calc as kod_sp_calc,a.mb3_kod as mb3_kod,a.mvp_kod as mvp_kod,a.el_zatr_kod as el_zatr_kod,a.period as period  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.s7 as mb3_kod,t.s12 as mvp_kod,t.n4 as el_zatr_kod,t.n2 as period  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
a
--\(select a.kod_sp_calc as kod_sp_calc,a.mb3_kod as mb3_kod,a.mvp_kod as mvp_kod,a.el_zatr_kod as el_zatr_kod,a.period as period  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.s7 as mb3_kod,t.s12 as mvp_kod,t.n4 as el_zatr_kod,t.n2 as period  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
left outer join
(
--vb_spr_smet_zatr_calc
select a.kod_spr_smet_zatr as kod_spr_smet_zatr, /*number*//*key*/
a.smet_code as smet_code, /**//*number*/
a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*/
a.period_s as period_s, /*number*/
a.period_po as period_po/*number*/

from vb_spr_smet_zatr_calc
a
--\vb_spr_smet_zatr_calc
)
vb_spr_smet_zatr_calc on (a.el_zatr_kod = vb_spr_smet_zatr_calc.smet_code)  and (a.period between vb_spr_smet_zatr_calc.period_s and ( nvl( vb_spr_smet_zatr_calc.period_po , 9999.99 ) ) ) --\vb_spr_smet_zatr_calc
left outer join
(
--vb_spr_smet_calc
select a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*//*key*/
a.schet_no_mb3 as schet_no_mb3/**//*number*/

from vb_spr_smet_calc
a
--\vb_spr_smet_calc
)
kod_spr_smet_calc on vb_spr_smet_zatr_calc.kod_spr_smet_calc = kod_spr_smet_calc.kod_spr_smet_calc--\vb_spr_smet_calc
)
a
--\va_sp_calc
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </dep-refresh-cmd>
          <dependants>
            <dependant name="color" table="a" />
          </dependants>
        </column>
        <column name="mvp_name" table="a" type="string" title="Наименование" ColumnEditable="1" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="mvp_name" temp-col-name="s13" />
        <column name="name" table="kod_direct" type="string" title="Подразделение МПЭД" ClientBackColor="color" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_sp_calc_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_sp_calc_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kod_direct.name as name, /*Подразделение МПЭД*//*string*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
a.kod_direct as kod_direct/*number*/

from (select a.kod_sp_calc as kod_sp_calc,a.kod_direct as kod_direct  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n14 as kod_direct  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
a
--\(select a.kod_sp_calc as kod_sp_calc,a.kod_direct as kod_direct  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n14 as kod_direct  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
)
a
--\va_sp_calc
left outer join
(
--is_spr_direct
select a.kod_direct as kod_direct, /*number*//*key*/
a.name as name/*Наименование*//*string*/

from is_spr_direct
a
--\is_spr_direct
)
kod_direct on a.kod_direct = kod_direct.kod_direct--\is_spr_direct
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="vyruchka" table="a" type="number" title="Выручка" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="vyruchka" temp-col-name="n5" />
        <column name="vol_sbyt" table="a" type="number" title="ОбъемСбыта" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="vol_sbyt" temp-col-name="n6" />
        <column name="zatr" table="a" type="number" title="Затраты" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="zatr" temp-col-name="n7" />
        <column name="tut" table="a" type="number" title="ТУТ" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="tut" temp-col-name="n8" />
        <column name="rash_vod_m3" table="a" type="number" title="РасхВод М3" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="rash_vod_m3" temp-col-name="n9" />
        <column name="rash_vod_t" table="a" type="number" title="РасхВод Т" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="rash_vod_t" temp-col-name="n10" />
        <column name="rez_tepl_nag" table="a" type="number" title="РезТеплНаг" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="rez_tepl_nag" temp-col-name="n11" />
        <column name="pris_tep_nag" table="a" type="number" title="ПрисТепНаг" is-user-editable="1" ClientBackColor="color" is-updateable="1" is-updateable-ext="1" update-target="pris_tep_nag" temp-col-name="n12" />
        <column name="color" table="a" type="string" title="Цвет" parname="color" ColumnVisible="0" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_sp_calc_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_sp_calc_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select a.color as color, /*Цвет*//*string*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
 case  when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) )  and (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null ) )  then '102,51,99' when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) ) )  then '139,0,0' when (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null )  then '204,204,0' end  as color/*Цвет*//*string*/

from (select a.kod_sp_calc as kod_sp_calc,a.mb3_kod as mb3_kod,a.mvp_kod as mvp_kod,a.el_zatr_kod as el_zatr_kod,a.period as period  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.s7 as mb3_kod,t.s12 as mvp_kod,t.n4 as el_zatr_kod,t.n2 as period  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
a
--\(select a.kod_sp_calc as kod_sp_calc,a.mb3_kod as mb3_kod,a.mvp_kod as mvp_kod,a.el_zatr_kod as el_zatr_kod,a.period as period  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.s7 as mb3_kod,t.s12 as mvp_kod,t.n4 as el_zatr_kod,t.n2 as period  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
left outer join
(
--vb_spr_smet_zatr_calc
select a.kod_spr_smet_zatr as kod_spr_smet_zatr, /*number*//*key*/
a.smet_code as smet_code, /**//*number*/
a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*/
a.period_s as period_s, /*number*/
a.period_po as period_po/*number*/

from vb_spr_smet_zatr_calc
a
--\vb_spr_smet_zatr_calc
)
vb_spr_smet_zatr_calc on (a.el_zatr_kod = vb_spr_smet_zatr_calc.smet_code)  and (a.period between vb_spr_smet_zatr_calc.period_s and ( nvl( vb_spr_smet_zatr_calc.period_po , 9999.99 ) ) ) --\vb_spr_smet_zatr_calc
left outer join
(
--vb_spr_smet_calc
select a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*//*key*/
a.schet_no_mb3 as schet_no_mb3/**//*number*/

from vb_spr_smet_calc
a
--\vb_spr_smet_calc
)
kod_spr_smet_calc on vb_spr_smet_zatr_calc.kod_spr_smet_calc = kod_spr_smet_calc.kod_spr_smet_calc--\vb_spr_smet_calc
)
a
--\va_sp_calc
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="is_new" table="a" type="number" title="" is-user-editable="1" />
        <column name="is_not_new" table="a" type="number" title="" is-user-editable="1" />
        <column name="kod_sp_calc" table="a" type="number" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kod_sp_calc" temp-col-name="n13" />
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:vid_dey_kod as vid_dey_kod 
,:vid_dey_name as vid_dey_name 
,:ob_gen_kod as ob_gen_kod 
,:ob_gen_name as ob_gen_name 
,:period as period 
,:subject_fed_kod as subject_fed_kod 
,:subject_fed_name as subject_fed_name 
,:zakaz_kod as zakaz_kod 
,:zakaz_name as zakaz_name 
,:mb3_kod as mb3_kod 
,:mb3_name as mb3_name 
,:mvp_partner_kod as mvp_partner_kod 
,:mvp_partner_name as mvp_partner_name 
,:el_zatr_kod as el_zatr_kod 
,:el_zatr_name as el_zatr_name 
,:mvp_kod as mvp_kod 
,:mvp_name as mvp_name 
,:vyruchka as vyruchka 
,:vol_sbyt as vol_sbyt 
,:zatr as zatr 
,:tut as tut 
,:rash_vod_m3 as rash_vod_m3 
,:rash_vod_t as rash_vod_t 
,:rez_tepl_nag as rez_tepl_nag 
,:pris_tep_nag as pris_tep_nag 
,:kod_sp_calc as kod_sp_calc 
 
from dual ) 
 
loop 
insert into va_sp_calc 
(vid_dey_kod 
,vid_dey_name 
,ob_gen_kod 
,ob_gen_name 
,period 
,subject_fed_kod 
,subject_fed_name 
,zakaz_kod 
,zakaz_name 
,mb3_kod 
,mb3_name 
,mvp_partner_kod 
,mvp_partner_name 
,el_zatr_kod 
,el_zatr_name 
,mvp_kod 
,mvp_name 
,vyruchka 
,vol_sbyt 
,zatr 
,tut 
,rash_vod_m3 
,rash_vod_t 
,rez_tepl_nag 
,pris_tep_nag 
,kod_sp_calc 
) 
 values  
(r.vid_dey_kod 
,r.vid_dey_name 
,r.ob_gen_kod 
,r.ob_gen_name 
,r.period 
,r.subject_fed_kod 
,r.subject_fed_name 
,r.zakaz_kod 
,r.zakaz_name 
,r.mb3_kod 
,r.mb3_name 
,r.mvp_partner_kod 
,r.mvp_partner_name 
,r.el_zatr_kod 
,r.el_zatr_name 
,r.mvp_kod 
,r.mvp_name 
,r.vyruchka 
,r.vol_sbyt 
,r.zatr 
,r.tut 
,r.rash_vod_m3 
,r.rash_vod_t 
,r.rez_tepl_nag 
,r.pris_tep_nag 
,r.kod_sp_calc 
) 
 returning  
kod_sp_calc into :kod_sp_calc; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from va_sp_calc where kod_sp_calc=:kod_sp_calc</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='a' 
and 
names=:form_id 
and 
f2=:kod_sp_calc; 
if :row_state_id=1  then 
for r in  
 ( select  
:vid_dey_kod as vid_dey_kod 
,:vid_dey_name as vid_dey_name 
,:ob_gen_kod as ob_gen_kod 
,:ob_gen_name as ob_gen_name 
,:period as period 
,:subject_fed_kod as subject_fed_kod 
,:subject_fed_name as subject_fed_name 
,:zakaz_kod as zakaz_kod 
,:zakaz_name as zakaz_name 
,:mb3_kod as mb3_kod 
,:mb3_name as mb3_name 
,:mvp_partner_kod as mvp_partner_kod 
,:mvp_partner_name as mvp_partner_name 
,:el_zatr_kod as el_zatr_kod 
,:el_zatr_name as el_zatr_name 
,:mvp_kod as mvp_kod 
,:mvp_name as mvp_name 
,:vyruchka as vyruchka 
,:vol_sbyt as vol_sbyt 
,:zatr as zatr 
,:tut as tut 
,:rash_vod_m3 as rash_vod_m3 
,:rash_vod_t as rash_vod_t 
,:rez_tepl_nag as rez_tepl_nag 
,:pris_tep_nag as pris_tep_nag 
,:kod_sp_calc as kod_sp_calc 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,s1 
,s2 
,s3 
,n2 
,n3 
,s4 
,s5 
,s6 
,s7 
,s8 
,s9 
,s10 
,n4 
,s11 
,s12 
,s13 
,n5 
,n6 
,n7 
,n8 
,n9 
,n10 
,n11 
,n12 
,n13 
) 
 values  
('a' 
,:form_id 
,:kod_sp_calc 
,:row_state_id 
,r.vid_dey_kod 
,r.vid_dey_name 
,r.ob_gen_kod 
,r.ob_gen_name 
,r.period 
,r.subject_fed_kod 
,r.subject_fed_name 
,r.zakaz_kod 
,r.zakaz_name 
,r.mb3_kod 
,r.mb3_name 
,r.mvp_partner_kod 
,r.mvp_partner_name 
,r.el_zatr_kod 
,r.el_zatr_name 
,r.mvp_kod 
,r.mvp_name 
,r.vyruchka 
,r.vol_sbyt 
,r.zatr 
,r.tut 
,r.rash_vod_m3 
,r.rash_vod_t 
,r.rez_tepl_nag 
,r.pris_tep_nag 
,r.kod_sp_calc 
); 
end loop; 
else 
for r in  
 ( select  
:vid_dey_kod as vid_dey_kod 
,:vid_dey_name as vid_dey_name 
,:ob_gen_kod as ob_gen_kod 
,:ob_gen_name as ob_gen_name 
,:period as period 
,:subject_fed_kod as subject_fed_kod 
,:subject_fed_name as subject_fed_name 
,:zakaz_kod as zakaz_kod 
,:zakaz_name as zakaz_name 
,:mb3_kod as mb3_kod 
,:mb3_name as mb3_name 
,:mvp_partner_kod as mvp_partner_kod 
,:mvp_partner_name as mvp_partner_name 
,:el_zatr_kod as el_zatr_kod 
,:el_zatr_name as el_zatr_name 
,:mvp_kod as mvp_kod 
,:mvp_name as mvp_name 
,:vyruchka as vyruchka 
,:vol_sbyt as vol_sbyt 
,:zatr as zatr 
,:tut as tut 
,:rash_vod_m3 as rash_vod_m3 
,:rash_vod_t as rash_vod_t 
,:rez_tepl_nag as rez_tepl_nag 
,:pris_tep_nag as pris_tep_nag 
,:kod_sp_calc as kod_sp_calc 
,a.kod_direct 
,a.tip_bud_kod 
,a.tip_bud_name 
 
from va_sp_calc a  where kod_sp_calc=:kod_sp_calc) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,s1 
,s2 
,s3 
,n2 
,n3 
,s4 
,s5 
,s6 
,s7 
,s8 
,s9 
,s10 
,n4 
,s11 
,s12 
,s13 
,n5 
,n6 
,n7 
,n8 
,n9 
,n10 
,n11 
,n12 
,n13 
,n14 
,n15 
,s14 
) 
 values  
('a' 
,:form_id 
,:kod_sp_calc 
,:row_state_id 
,r.vid_dey_kod 
,r.vid_dey_name 
,r.ob_gen_kod 
,r.ob_gen_name 
,r.period 
,r.subject_fed_kod 
,r.subject_fed_name 
,r.zakaz_kod 
,r.zakaz_name 
,r.mb3_kod 
,r.mb3_name 
,r.mvp_partner_kod 
,r.mvp_partner_name 
,r.el_zatr_kod 
,r.el_zatr_name 
,r.mvp_kod 
,r.mvp_name 
,r.vyruchka 
,r.vol_sbyt 
,r.zatr 
,r.tut 
,r.rash_vod_m3 
,r.rash_vod_t 
,r.rez_tepl_nag 
,r.pris_tep_nag 
,r.kod_sp_calc 
,r.kod_direct 
,r.tip_bud_kod 
,r.tip_bud_name 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='a' and names=:form_id</clear-temp-text>
      <update-text>begin
update va_sp_calc set  
(vid_dey_kod 
,vid_dey_name 
,ob_gen_kod 
,ob_gen_name 
,period 
,subject_fed_kod 
,subject_fed_name 
,zakaz_kod 
,zakaz_name 
,mb3_kod 
,mb3_name 
,mvp_partner_kod 
,mvp_partner_name 
,el_zatr_kod 
,el_zatr_name 
,mvp_kod 
,mvp_name 
,vyruchka 
,vol_sbyt 
,zatr 
,tut 
,rash_vod_m3 
,rash_vod_t 
,rez_tepl_nag 
,pris_tep_nag 
,kod_sp_calc 
) 
= 
 ( select  
:vid_dey_kod as vid_dey_kod 
,:vid_dey_name as vid_dey_name 
,:ob_gen_kod as ob_gen_kod 
,:ob_gen_name as ob_gen_name 
,:period as period 
,:subject_fed_kod as subject_fed_kod 
,:subject_fed_name as subject_fed_name 
,:zakaz_kod as zakaz_kod 
,:zakaz_name as zakaz_name 
,:mb3_kod as mb3_kod 
,:mb3_name as mb3_name 
,:mvp_partner_kod as mvp_partner_kod 
,:mvp_partner_name as mvp_partner_name 
,:el_zatr_kod as el_zatr_kod 
,:el_zatr_name as el_zatr_name 
,:mvp_kod as mvp_kod 
,:mvp_name as mvp_name 
,:vyruchka as vyruchka 
,:vol_sbyt as vol_sbyt 
,:zatr as zatr 
,:tut as tut 
,:rash_vod_m3 as rash_vod_m3 
,:rash_vod_t as rash_vod_t 
,:rez_tepl_nag as rez_tepl_nag 
,:pris_tep_nag as pris_tep_nag 
,:kod_sp_calc as kod_sp_calc 
 
from dual ) 
 
where 
kod_sp_calc=:kod_sp_calc 
;
end;
</update-text>
      <scheme>
        <table name="va_sp_calc" as="a">
          <columns>
            <column name="vid_dey_kod" type="number" format="F0" edit-mask="F0" title="Код" />
            <column name="vid_dey_name" type="string" title="Наименование" />
            <column name="vid_energ_name" type="string" title="Вид энергии" />
            <column name="od_nd_name" type="string" title="ОД -  НД" />
            <column name="ob_gen_kod" type="string" title="Код" />
            <column name="ob_gen_name" type="string" title="Наименование" />
            <column name="period" type="number" format="F2" edit-mask="F2" title="Период" />
            <column name="subject_fed_kod" type="number" format="F0" edit-mask="F0" title="Код" />
            <column name="subject_fed_name" type="string" title="Наименование" />
            <column name="zakaz_kod" type="string" title="Код" />
            <column name="zakaz_name" type="string" title="Наименование" />
            <column name="mb3_kod" type="string" title="Код" />
            <column name="mb3_name" type="string" title="Наименование" />
            <column name="kod_schet_mb3" type="number" format="F0" edit-mask="F0" title="Код счета МВЗ" />
            <column name="mvp_partner_kod" type="string" title="Код" />
            <column name="mvp_partner_name" type="string" title="Наименование" />
            <column name="el_zatr_kod" type="number" format="F0" edit-mask="F0" title="Код" />
            <column name="el_zatr_name" type="string" title="Наименование" />
            <column name="full_kod_smet" type="string" title="Список статей сметы по коду SAP" />
            <column name="mvp_kod" type="string" title="Код" />
            <column name="mvp_name" type="string" title="Наименование" />
            <column name="name" type="string" title="Подразделение МПЭД" />
            <column name="vyruchka" type="number" title="Выручка" />
            <column name="vol_sbyt" type="number" title="ОбъемСбыта" />
            <column name="zatr" type="number" title="Затраты" />
            <column name="tut" type="number" title="ТУТ" />
            <column name="rash_vod_m3" type="number" title="РасхВод М3" />
            <column name="rash_vod_t" type="number" title="РасхВод Т" />
            <column name="rez_tepl_nag" type="number" title="РезТеплНаг" />
            <column name="pris_tep_nag" type="number" title="ПрисТепНаг" />
            <column name="color" type="string" title="Цвет" visible="0" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_sp_calc" type="number" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <band title="Вид деятельности">
              <column name="vid_dey_kod" type="number" format="F0" edit-mask="F0" title="Код" />
              <column name="vid_dey_name" type="string" title="Наименование" />
              <column name="vid_energ_name" type="string" title="Вид энергии" />
              <column name="od_nd_name" type="string" title="ОД -  НД" />
            </band>
            <band title="Объект генерации">
              <column name="ob_gen_kod" type="string" title="Код" />
              <column name="ob_gen_name" type="string" title="Наименование" />
            </band>
            <column name="period" type="number" format="F2" edit-mask="F2" title="Период" />
            <band title="Субъект РФ">
              <column name="subject_fed_kod" type="number" format="F0" edit-mask="F0" title="Код" />
              <column name="subject_fed_name" type="string" title="Наименование" />
            </band>
            <band title="Заказ">
              <column name="zakaz_kod" type="string" title="Код" />
              <column name="zakaz_name" type="string" title="Наименование" />
            </band>
            <band title="МВЗ">
              <column name="mb3_kod" type="string" title="Код" />
              <column name="mb3_name" type="string" title="Наименование" />
              <column name="kod_schet_mb3" type="number" format="F0" edit-mask="F0" title="Код счета МВЗ" />
            </band>
            <band title="МВП: Партнер">
              <column name="mvp_partner_kod" type="string" title="Код" />
              <column name="mvp_partner_name" type="string" title="Наименование" />
            </band>
            <band title="Элемент затрат">
              <column name="el_zatr_kod" type="number" format="F0" edit-mask="F0" title="Код" />
              <column name="el_zatr_name" type="string" title="Наименование" />
              <column name="full_kod_smet" type="string" title="Список статей сметы по коду SAP" />
            </band>
            <band title="МВП">
              <column name="mvp_kod" type="string" title="Код" />
              <column name="mvp_name" type="string" title="Наименование" />
              <column name="name" type="string" title="Подразделение МПЭД" />
            </band>
            <column name="vyruchka" type="number" title="Выручка" />
            <column name="vol_sbyt" type="number" title="ОбъемСбыта" />
            <column name="zatr" type="number" title="Затраты" />
            <column name="tut" type="number" title="ТУТ" />
            <column name="rash_vod_m3" type="number" title="РасхВод М3" />
            <column name="rash_vod_t" type="number" title="РасхВод Т" />
            <column name="rez_tepl_nag" type="number" title="РезТеплНаг" />
            <column name="pris_tep_nag" type="number" title="ПрисТепНаг" />
            <column name="color" type="string" title="Цвет" visible="0" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_sp_calc" type="number" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="kod_sp_calc_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="kod_sp_calc_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select a.vid_dey_kod as vid_dey_kod, /*Код*//*number*/
a.vid_dey_name as vid_dey_name, /*Наименование*//*string*/
kod_spr_vid_energ.vid_energ_name as vid_energ_name, /*Вид энергии*//*string*/
kod_spr_od_nd.od_nd_name as od_nd_name, /*ОД -  НД*//*string*/
a.ob_gen_kod as ob_gen_kod, /*Код*//*string*/
a.ob_gen_name as ob_gen_name, /*Наименование*//*string*/
a.period as period, /*Период*//*number*/
a.subject_fed_kod as subject_fed_kod, /*Код*//*number*/
a.subject_fed_name as subject_fed_name, /*Наименование*//*string*/
a.zakaz_kod as zakaz_kod, /*Код*//*string*/
a.zakaz_name as zakaz_name, /*Наименование*//*string*/
a.mb3_kod as mb3_kod, /*Код*//*string*/
a.mb3_name as mb3_name, /*Наименование*//*string*/
a.kod_schet_mb3 as kod_schet_mb3, /*Код счета МВЗ*//*number*/
a.mvp_partner_kod as mvp_partner_kod, /*Код*//*string*/
a.mvp_partner_name as mvp_partner_name, /*Наименование*//*string*/
a.el_zatr_kod as el_zatr_kod, /*Код*//*number*/
a.el_zatr_name as el_zatr_name, /*Наименование*//*string*/
sap_code_agg.full_kod_smet as full_kod_smet, /*Список статей сметы по коду SAP*//*string*/
a.mvp_kod as mvp_kod, /*Код*//*string*/
a.mvp_name as mvp_name, /*Наименование*//*string*/
kod_direct.name as name, /*Подразделение МПЭД*//*string*/
a.vyruchka as vyruchka, /*Выручка*//*number*/
a.vol_sbyt as vol_sbyt, /*ОбъемСбыта*//*number*/
a.zatr as zatr, /*Затраты*//*number*/
a.tut as tut, /*ТУТ*//*number*/
a.rash_vod_m3 as rash_vod_m3, /*РасхВод М3*//*number*/
a.rash_vod_t as rash_vod_t, /*РасхВод Т*//*number*/
a.rez_tepl_nag as rez_tepl_nag, /*РезТеплНаг*//*number*/
a.pris_tep_nag as pris_tep_nag, /*ПрисТепНаг*//*number*/
a.color as color, /*Цвет*//*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new, /*number*/
a.kod_sp_calc as kod_sp_calc/*number*//*key*/

from (
--va_sp_calc
select a.kod_sp_calc as kod_sp_calc, /*number*//*key*/
a.vid_dey_kod as vid_dey_kod, /**//*number*/
a.vid_dey_name as vid_dey_name, /**//*string*/
a.ob_gen_kod as ob_gen_kod, /**//*string*/
a.ob_gen_name as ob_gen_name, /**//*string*/
a.period as period, /**//*number*/
a.subject_fed_kod as subject_fed_kod, /**//*number*/
a.subject_fed_name as subject_fed_name, /**//*string*/
a.zakaz_kod as zakaz_kod, /**//*string*/
a.zakaz_name as zakaz_name, /**//*string*/
a.mb3_kod as mb3_kod, /**//*string*/
a.mb3_name as mb3_name, /**//*string*/
a.mvp_partner_kod as mvp_partner_kod, /**//*string*/
a.mvp_partner_name as mvp_partner_name, /**//*string*/
a.el_zatr_kod as el_zatr_kod, /**//*number*/
a.el_zatr_name as el_zatr_name, /**//*string*/
a.mvp_kod as mvp_kod, /**//*string*/
a.mvp_name as mvp_name, /**//*string*/
a.vyruchka as vyruchka, /**//*number*/
a.vol_sbyt as vol_sbyt, /**//*number*/
a.zatr as zatr, /**//*number*/
a.tut as tut, /**//*number*/
a.rash_vod_m3 as rash_vod_m3, /**//*number*/
a.rash_vod_t as rash_vod_t, /**//*number*/
a.rez_tepl_nag as rez_tepl_nag, /**//*number*/
a.pris_tep_nag as pris_tep_nag, /**//*number*/
a.kod_direct as kod_direct, /*number*/
 nvl( ( to_number( ( SUBSTR( a.mb3_kod , 5 , 1 ) )  ) )  , kod_spr_smet_calc.schet_no_mb3 )  as kod_schet_mb3, /*number*/
 case  when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) )  and (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null ) )  then '102,51,99' when ((a.mb3_kod is null )  and ((kod_spr_smet_calc.schet_no_mb3 is null )  or (a.mvp_kod is null ) ) )  then '139,0,0' when (vb_spr_smet_zatr_calc.kod_spr_smet_zatr is null )  then '204,204,0' end  as color, /*Цвет*//*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.kod_sp_calc as kod_sp_calc,a.vid_dey_kod as vid_dey_kod,a.vid_dey_name as vid_dey_name,a.ob_gen_kod as ob_gen_kod,a.ob_gen_name as ob_gen_name,a.period as period,a.subject_fed_kod as subject_fed_kod,a.subject_fed_name as subject_fed_name,a.zakaz_kod as zakaz_kod,a.zakaz_name as zakaz_name,a.mb3_kod as mb3_kod,a.mb3_name as mb3_name,a.mvp_partner_kod as mvp_partner_kod,a.mvp_partner_name as mvp_partner_name,a.el_zatr_kod as el_zatr_kod,a.el_zatr_name as el_zatr_name,a.mvp_kod as mvp_kod,a.mvp_name as mvp_name,a.vyruchka as vyruchka,a.vol_sbyt as vol_sbyt,a.zatr as zatr,a.tut as tut,a.rash_vod_m3 as rash_vod_m3,a.rash_vod_t as rash_vod_t,a.rez_tepl_nag as rez_tepl_nag,a.pris_tep_nag as pris_tep_nag,a.kod_direct as kod_direct,0 as is_new,1 as is_not_new  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n1 as vid_dey_kod,t.s1 as vid_dey_name,t.s2 as ob_gen_kod,t.s3 as ob_gen_name,t.n2 as period,t.n3 as subject_fed_kod,t.s4 as subject_fed_name,t.s5 as zakaz_kod,t.s6 as zakaz_name,t.s7 as mb3_kod,t.s8 as mb3_name,t.s9 as mvp_partner_kod,t.s10 as mvp_partner_name,t.n4 as el_zatr_kod,t.s11 as el_zatr_name,t.s12 as mvp_kod,t.s13 as mvp_name,t.n5 as vyruchka,t.n6 as vol_sbyt,t.n7 as zatr,t.n8 as tut,t.n9 as rash_vod_m3,t.n10 as rash_vod_t,t.n11 as rez_tepl_nag,t.n12 as pris_tep_nag,t.n14 as kod_direct,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
a
--\(select a.kod_sp_calc as kod_sp_calc,a.vid_dey_kod as vid_dey_kod,a.vid_dey_name as vid_dey_name,a.ob_gen_kod as ob_gen_kod,a.ob_gen_name as ob_gen_name,a.period as period,a.subject_fed_kod as subject_fed_kod,a.subject_fed_name as subject_fed_name,a.zakaz_kod as zakaz_kod,a.zakaz_name as zakaz_name,a.mb3_kod as mb3_kod,a.mb3_name as mb3_name,a.mvp_partner_kod as mvp_partner_kod,a.mvp_partner_name as mvp_partner_name,a.el_zatr_kod as el_zatr_kod,a.el_zatr_name as el_zatr_name,a.mvp_kod as mvp_kod,a.mvp_name as mvp_name,a.vyruchka as vyruchka,a.vol_sbyt as vol_sbyt,a.zatr as zatr,a.tut as tut,a.rash_vod_m3 as rash_vod_m3,a.rash_vod_t as rash_vod_t,a.rez_tepl_nag as rez_tepl_nag,a.pris_tep_nag as pris_tep_nag,a.kod_direct as kod_direct,0 as is_new,1 as is_not_new  from va_sp_calc a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_sp_calc=t.f2 ) and   a.kod_sp_calc in :kod_sp_calc_prm   union all  select t.n13 as kod_sp_calc,t.n1 as vid_dey_kod,t.s1 as vid_dey_name,t.s2 as ob_gen_kod,t.s3 as ob_gen_name,t.n2 as period,t.n3 as subject_fed_kod,t.s4 as subject_fed_name,t.s5 as zakaz_kod,t.s6 as zakaz_name,t.s7 as mb3_kod,t.s8 as mb3_name,t.s9 as mvp_partner_kod,t.s10 as mvp_partner_name,t.n4 as el_zatr_kod,t.s11 as el_zatr_name,t.s12 as mvp_kod,t.s13 as mvp_name,t.n5 as vyruchka,t.n6 as vol_sbyt,t.n7 as zatr,t.n8 as tut,t.n9 as rash_vod_m3,t.n10 as rash_vod_t,t.n11 as rez_tepl_nag,t.n12 as pris_tep_nag,t.n14 as kod_direct,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_sp_calc_prm )
left outer join
(
--vb_spr_smet_zatr_calc
select a.kod_spr_smet_zatr as kod_spr_smet_zatr, /*number*//*key*/
a.smet_code as smet_code, /**//*number*/
a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*/
a.period_s as period_s, /*number*/
a.period_po as period_po/*number*/

from vb_spr_smet_zatr_calc
a
--\vb_spr_smet_zatr_calc
)
vb_spr_smet_zatr_calc on (a.el_zatr_kod = vb_spr_smet_zatr_calc.smet_code)  and (a.period between vb_spr_smet_zatr_calc.period_s and ( nvl( vb_spr_smet_zatr_calc.period_po , 9999.99 ) ) ) --\vb_spr_smet_zatr_calc
left outer join
(
--vb_spr_smet_calc
select a.kod_spr_smet_calc as kod_spr_smet_calc, /*number*//*key*/
a.schet_no_mb3 as schet_no_mb3/**//*number*/

from vb_spr_smet_calc
a
--\vb_spr_smet_calc
)
kod_spr_smet_calc on vb_spr_smet_zatr_calc.kod_spr_smet_calc = kod_spr_smet_calc.kod_spr_smet_calc--\vb_spr_smet_calc
)
a
--\va_sp_calc
left outer join
(
--vb_spr_smet_to_sap_agg
select a.sap_code as sap_code, /*string*//*key*/
stragg_dist(a.full_kod_smet)  as full_kod_smet/*Список статей сметы по коду SAP*//*string*/

from (
--vb_spr_smet_to_sap_agg_pre
select a.kod_spr_smet_to_sap as kod_spr_smet_to_sap, /*number*//*key*/
a.sap_code as sap_code, /*string*/
kod_spr_smet.full_kod_smet as full_kod_smet/*string*/

from (
--vb_spr_smet_to_sap
select a.kod_spr_smet_to_sap as kod_spr_smet_to_sap, /*number*//*key*/
a.kod_spr_smet as kod_spr_smet, /*number*/
a.sap_code as sap_code/*string*/

from vb_spr_smet_to_sap
a
--\vb_spr_smet_to_sap
where
a.period_po is null 
order by kod_spr_smet)
a
--\vb_spr_smet_to_sap
inner join
(
--is_spr_smet
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
is_spr_smet_tree.root_kod_smet || a.kod_smet as full_kod_smet/*string*/

from is_spr_smet
a
--\is_spr_smet
left outer join
(
--is_spr_smet_tree
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
 case  when (a.kod_parent is not null )  then a.root_kod_smet end  as root_kod_smet/*string*/

from (
--is_spr_smet_tree_pre
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
 connect_by_root a.kod_smet as root_kod_smet, /*string*/
a.kod_parent as kod_parent/*number*/

from (
--is_spr_smet
select a.kod_spr_smet as kod_spr_smet, /*number*//*key*/
a.kod_smet as kod_smet, /*string*/
a.kod_parent as kod_parent/*number*/

from is_spr_smet
a
--\is_spr_smet
)
a
--\is_spr_smet
connect by nocycle
(a.kod_parent = prior a.kod_spr_smet) 
start with a.kod_parent is null )
a
--\is_spr_smet_tree_pre
)
is_spr_smet_tree on a.kod_spr_smet = is_spr_smet_tree.kod_spr_smet--\is_spr_smet_tree
)
kod_spr_smet on a.kod_spr_smet = kod_spr_smet.kod_spr_smet--\is_spr_smet

order by full_kod_smet)
a
--\vb_spr_smet_to_sap_agg_pre
 group by
a.sap_code/*string*//*key*/
)
sap_code_agg on ( to_char( a.el_zatr_kod ) )  = sap_code_agg.sap_code--\vb_spr_smet_to_sap_agg
left outer join
(
--is_spr_direct
select a.kod_direct as kod_direct, /*number*//*key*/
a.name as name/*Наименование*//*string*/

from is_spr_direct
a
--\is_spr_direct
)
kod_direct on a.kod_direct = kod_direct.kod_direct--\is_spr_direct
left outer join
(
--vb_spr_vid_dey
select a.vid_dey_sap_code as vid_dey_sap_code, /*Код вида деятельности*//*string*/
a.kod_spr_vid_energ as kod_spr_vid_energ/*number*/

from vb_spr_vid_dey
a
--\vb_spr_vid_dey
)
vd on a.vid_dey_kod = vd.vid_dey_sap_code--\vb_spr_vid_dey
left outer join
(
--vb_spr_vid_energ
select a.kod_spr_vid_energ as kod_spr_vid_energ, /*number*//*key*/
a.vid_energ_name as vid_energ_name, /*Вид энергии*//*string*/
a.kod_spr_od_nd as kod_spr_od_nd/*number*/

from vb_spr_vid_energ
a
--\vb_spr_vid_energ
)
kod_spr_vid_energ on vd.kod_spr_vid_energ = kod_spr_vid_energ.kod_spr_vid_energ--\vb_spr_vid_energ
left outer join
(
--vb_spr_od_nd
select a.kod_spr_od_nd as kod_spr_od_nd, /*number*//*key*/
a.od_nd_name as od_nd_name/*ОД -  НД*//*string*/

from vb_spr_od_nd
a
--\vb_spr_od_nd
)
kod_spr_od_nd on kod_spr_vid_energ.kod_spr_od_nd = kod_spr_od_nd.kod_spr_od_nd--\vb_spr_od_nd

order by period--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
  </dataset>
</root>