<?xml version="1.0" encoding="utf-8"?>
<root>
  <form name="pret_dolg_sf_view" title="Суммы по претензии" form-size="1180;468" with-behavior="0" timestamp="28.04.2025 18:45:15" file="sql.builder.templates\sql.builder\projects\asuse2\forms\Арбитраж\pret_dolg_sf_view.xml" elid="78" ord="78" leaf="0" lvl="2" pelid="">
    <grid table="vr_pret_dolg_sf" show-toolbar="1" show-footer="1" column-editable="false" id="22937496">
      <toolbar id="37733832">
        <uicommand button-type="grid-add" column-visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="364" ord="364" leaf="1" lvl="2" pelid="" title="" id="54850703" />
        <uicommand button-type="grid-delete" column-visible="0" name="grid-delete" control-name="ButtonDeleteRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="368" ord="368" leaf="1" lvl="2" pelid="" title="" id="23894279" />
        <uicommand button-type="grid-copy" column-visible="0" name="grid-copy" control-name="ButtonCoppyRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="365" ord="365" leaf="1" lvl="2" pelid="" title="" id="13721921" />
        <uicommand button-type="grid-save" column-visible="0" name="grid-save" control-name="ButtonCommit" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="366" ord="366" leaf="1" lvl="2" pelid="" title="" id="56388431" />
      </toolbar>
      <columns id="62200934">
        <field table="vr_pret_dolg_sf" name="ndog" title="Номер договора" width="104" controlType="UIText" rows-limit="100" id="12358762" />
        <field table="vr_pret_dolg_sf" name="ym" title="Отчетный период начисления" width="111" controlType="UIText" format="F2" edit-mask="F2" rows-limit="100" id="32887983" />
        <field table="vr_pret_dolg_sf" name="vid_real" title="Вид реализации" width="111" controlType="UICombo" rows-limit="100" id="6221225" />
        <field table="vr_pret_dolg_sf" name="num_sf" title="Номер документа начисления" width="114" controlType="UIText" format="F0" edit-mask="F0" rows-limit="100" id="38979707" />
        <field table="vr_pret_dolg_sf" name="dat_sf" title="Дата документа начисления" width="99" controlType="UIDate" rows-limit="100" id="61092053" />
        <field table="vr_pret_dolg_sf" name="sr_facras_nachisl" title="Начислено" controlType="UIText" edit-mask="N2" rows-limit="100" id="50825680" />
        <field table="vr_pret_dolg_sf" name="sr_opl_opl_sf" title="Оплата" controlType="UIText" edit-mask="N2" rows-limit="100" id="30105629" />
        <field table="vr_pret_dolg_sf" name="dolg_tek" title="Текущая задолженность" controlType="UIText" edit-mask="N2" rows-limit="100" id="2405037" />
        <field table="vr_pret_dolg_sf" name="total_dolg" title="Задолженность по претензии" width="122" controlType="UIText" edit-mask="N2" rows-limit="100" id="8441658" />
        <field table="vr_pret_dolg_sf" name="pk_ur_pass" title="ПК &quot;Юрист&quot;" width="122" controlType="UIText" rows-limit="100" id="1810620" />
      </columns>
    </grid>
  </form>
  <params>
    <param name="kod_pret_dolg_dog" type="number" />
  </params>
  <dataset>
    <params>
      <param name="kod_pret_dolg_dog" type="number" />
    </params>
    <fields>
      <field type="string" name="is_form_valid" parname="is_form_valid" />
      <field type="string" name="is_form_valid_not" parname="is_form_valid_not" />
      <field type="string" name="vr_pret_dolg_sf_has_changes" parname="vr_pret_dolg_sf_has_changes" />
    </fields>
    <table name="vr_pret_dolg_sf" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multi-select-column="" multi-select-target="" update-target="vr_pret_dolg_sf" key="kod_pret_dolg_sf" is-ms-upd="1" is-top="1" key-dimension="vr_pret_dolg_sf">
      <select-text>
--
select kod_dog.ndog as ndog, /*Номер договора*//*string*/
kod_sf.ym as ym, /*Отчетный период начисления*//*number*/
vr_pret_dolg_sf.vid_real as vid_real, /*Вид реализации*//*number*/
kod_sf.num_sf as num_sf, /*Номер документа начисления*//*string*/
kod_sf.dat_sf as dat_sf, /*Дата документа начисления*//*date*/
qube.sr_facras_nachisl1 as sr_facras_nachisl, /*Начислено*//*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf, /*Оплата*//*number*/
qube.fin_ul_ob1 as dolg_tek, /*Текущая задолженность*//*number*/
vr_pret_dolg_sf.total_dolg as total_dolg, /*Задолженность по претензии*//*number*/
vr_pret_dolg_sf.pk_ur_pass as pk_ur_pass, /*ПК "Юрист"*//*string*/
vid_real_x_n.name as vid_real_x_n, /*Вид реализации*//*string*/
vr_pret_dolg_sf.is_new as is_new, /*number*/
vr_pret_dolg_sf.is_not_new as is_not_new, /*number*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sum(qube.sr_facras_nachisl1)  as sr_facras_nachisl1, /*Начислено*//*number*/
sum(qube.sr_opl_opl_sf1)  as sr_opl_opl_sf1, /*Оплата*//*number*/
sum( nvl( qube.sr_facras_nachisl1 ,0)  -nvl( qube.sr_opl_opl_sf1 ,0) )  as fin_ul_ob1/*Оборот*//*number*/

from (
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1, /*Начислено*//*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1, /*Начислено*//*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select un.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sum(un.sr_facras_nachisl1)  as sr_facras_nachisl1, /*Начислено*//*number*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sr_facras.nachisl as sr_facras_nachisl1, /*Начислено*//*number*/
null as sr_opl_opl_sf1/*number*/

from (
--
select sr_facras_a_d.kod_ras as kod_ras_prm, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf/*number*//*key*/

from (
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras_a_d
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_facras_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_pret_dolg_dog as kod_pret_dolg_dog, /*number*/
a.kod_sf as kod_sf, /*number*/
 nvl( a.dolg_osn_real ,0)  +nvl( a.dolg_gp ,0)  +nvl( a.dolg_peni ,0)  +nvl( a.dolg_sud_peni ,0)  +nvl( a.dolg_astr ,0)  +nvl( a.dolg_othr ,0)  as total_dolg/*Сальдо*//*number*/

from vr_pret_dolg_sf
a
--\vr_pret_dolg_sf
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_sf = kod_sf_a_d.kod_sf--\vr_pret_dolg_sf
where
(vr_pret_dolg_sf.kod_pret_dolg_dog = :kod_pret_dolg_dog )  and ( nvl( vr_pret_dolg_sf.total_dolg ,0)!=0 )  and (vr_pret_dolg_sf.kod_pret_dolg_sf is not null )  group by
sr_facras_a_d.kod_ras, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf/*number*//*key*/
)
dims
--\
left outer join
(
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.nachisl as nachisl/*Начислено*//*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras on sr_facras.kod_ras = dims.kod_ras_prm--\sr_facras
)
--\
union all
(
--
select dims.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
null as sr_facras_nachisl1, /*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select sr_opl_sf_a_d.kod_opl as kod_opl_prm, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf_a_d
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_opl_sf_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_pret_dolg_dog as kod_pret_dolg_dog, /*number*/
a.kod_sf as kod_sf, /*number*/
 nvl( a.dolg_osn_real ,0)  +nvl( a.dolg_gp ,0)  +nvl( a.dolg_peni ,0)  +nvl( a.dolg_sud_peni ,0)  +nvl( a.dolg_astr ,0)  +nvl( a.dolg_othr ,0)  as total_dolg/*Сальдо*//*number*/

from vr_pret_dolg_sf
a
--\vr_pret_dolg_sf
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_sf = kod_sf_a_d.kod_sf--\vr_pret_dolg_sf
where
(vr_pret_dolg_sf.kod_pret_dolg_dog = :kod_pret_dolg_dog )  and ( nvl( vr_pret_dolg_sf.total_dolg ,0)!=0 )  and (vr_pret_dolg_sf.kod_pret_dolg_sf is not null )  group by
sr_opl_sf_a_d.kod_opl, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
union all
(
--
select vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
null as sr_facras_nachisl1, /*number*/
null as sr_opl_opl_sf1/*number*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_pret_dolg_dog as kod_pret_dolg_dog, /*number*/
 nvl( a.dolg_osn_real ,0)  +nvl( a.dolg_gp ,0)  +nvl( a.dolg_peni ,0)  +nvl( a.dolg_sud_peni ,0)  +nvl( a.dolg_astr ,0)  +nvl( a.dolg_othr ,0)  as total_dolg/*Сальдо*//*number*/

from vr_pret_dolg_sf
a
--\vr_pret_dolg_sf
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
where
(vr_pret_dolg_sf.kod_pret_dolg_dog = :kod_pret_dolg_dog )  and ( nvl( vr_pret_dolg_sf.total_dolg ,0)!=0 )  and (vr_pret_dolg_sf.kod_pret_dolg_sf is not null ) )
--\
)
--\
)
un
--\
 group by
un.vr_pret_dolg_sf/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
 group by
qube.vr_pret_dolg_sf/*number*//*key*/
)
qube
--\
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_sf as kod_sf, /*number*/
 nvl( a.dolg_osn_real ,0)  +nvl( a.dolg_gp ,0)  +nvl( a.dolg_peni ,0)  +nvl( a.dolg_sud_peni ,0)  +nvl( a.dolg_astr ,0)  +nvl( a.dolg_othr ,0)  as total_dolg, /*Сальдо*//*number*/
 nvl( kod_sf.vid_real , ( case  when ( nvl( a.dolg_peni ,0)!=0 )  then 7 end )  )  as vid_real, /*Начисленные_пени*//*number*/
 case  when ( nvl( a.pr_sud ,0)=1 )  then 'Нет' else 'Да' end  as pk_ur_pass, /*ПК "Юрист"*//*string*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from vr_pret_dolg_sf
a
--\vr_pret_dolg_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_real as vid_real/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_pret_dolg_sf = qube.vr_pret_dolg_sf--\vr_pret_dolg_sf
left outer join
(
--sk_vid_real
select a.vid_real as vid_real, /**//*number*//*key*/
a.name as name/*Вид реализации*//*string*/

from sk_vid_real
a
--\sk_vid_real
)
vid_real_x_n on vr_pret_dolg_sf.vid_real = vid_real_x_n.vid_real--\sk_vid_real
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.kod_dog as kod_dog, /*number*/
a.num_sf as num_sf, /*Номер документа начисления*//*number*/
a.dat_sf as dat_sf, /*Дата документа начисления*//*date*/
a.ym as ym/*Отчетный период начисления*//*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on vr_pret_dolg_sf.kod_sf = kod_sf.kod_sf--\sr_facvip
left outer join
(
--kr_dogovor
select a.kod_dog as kod_dog, /*number*//*key*/
a.ndog as ndog/*Номер договора*//*string*/

from kr_dogovor
a
--\kr_dogovor
)
kod_dog on kod_sf.kod_dog = kod_dog.kod_dog--\kr_dogovor

order by dat_sf--\
</select-text>
      <columns>
        <column name="ndog" table="kod_dog" type="string" title="Номер договора" ColumnEditable="0" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kod_dog.ndog as ndog, /*Номер договора*//*string*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.kod_dog as kod_dog/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on vr_pret_dolg_sf.kod_sf = kod_sf.kod_sf--\sr_facvip
left outer join
(
--kr_dogovor
select a.kod_dog as kod_dog, /*number*//*key*/
a.ndog as ndog/*Номер договора*//*string*/

from kr_dogovor
a
--\kr_dogovor
)
kod_dog on kod_sf.kod_dog = kod_dog.kod_dog--\kr_dogovor
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="ym" table="kod_sf" type="number" title="Отчетный период начисления" ColumnEditable="0" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kod_sf.ym as ym, /*Отчетный период начисления*//*number*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.ym as ym/*Отчетный период начисления*//*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on vr_pret_dolg_sf.kod_sf = kod_sf.kod_sf--\sr_facvip
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="vid_real" table="vr_pret_dolg_sf" type="number" title="Вид реализации" ColumnEditable="0" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select vr_pret_dolg_sf.vid_real as vid_real, /*Вид реализации*//*number*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
 nvl( kod_sf.vid_real , ( case  when ( nvl( a.dolg_peni ,0)!=0 )  then 7 end )  )  as vid_real/*Начисленные_пени*//*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.dolg_peni as dolg_peni,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n7 as dolg_peni,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.dolg_peni as dolg_peni,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n7 as dolg_peni,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_real as vid_real/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="num_sf" table="kod_sf" type="string" title="Номер документа начисления" ColumnEditable="0" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kod_sf.num_sf as num_sf, /*Номер документа начисления*//*string*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.num_sf as num_sf/*Номер документа начисления*//*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on vr_pret_dolg_sf.kod_sf = kod_sf.kod_sf--\sr_facvip
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="dat_sf" table="kod_sf" type="date" title="Дата документа начисления" ColumnEditable="0" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kod_sf.dat_sf as dat_sf, /*Дата документа начисления*//*date*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.dat_sf as dat_sf/*Дата документа начисления*//*date*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on vr_pret_dolg_sf.kod_sf = kod_sf.kod_sf--\sr_facvip
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="sr_facras_nachisl" table="vr_pret_dolg_sf" type="number" title="Начислено" is-user-editable="1" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.sr_facras_nachisl1 as sr_facras_nachisl, /*Начислено*//*number*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sum(qube.sr_facras_nachisl1)  as sr_facras_nachisl1/*Начислено*//*number*/

from (
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1/*Начислено*//*number*/

from (
(
(
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1/*Начислено*//*number*/

from (
--
select un.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sum(un.sr_facras_nachisl1)  as sr_facras_nachisl1/*Начислено*//*number*/

from (
(
(
--
select dims.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sr_facras.nachisl as sr_facras_nachisl1/*Начислено*//*number*/

from (
--
select sr_facras_a_d.kod_ras as kod_ras_prm, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf/*number*//*key*/

from (
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras_a_d
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_facras_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_sf = kod_sf_a_d.kod_sf--\vr_pret_dolg_sf
where
vr_pret_dolg_sf.kod_pret_dolg_sf is not null  group by
sr_facras_a_d.kod_ras, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf/*number*//*key*/
)
dims
--\
left outer join
(
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.nachisl as nachisl/*Начислено*//*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras on sr_facras.kod_ras = dims.kod_ras_prm--\sr_facras
)
--\
union all
(
--
select vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
null as sr_facras_nachisl1/*number*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
where
vr_pret_dolg_sf.kod_pret_dolg_sf is not null )
--\
)
--\
)
un
--\
 group by
un.vr_pret_dolg_sf/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
 group by
qube.vr_pret_dolg_sf/*number*//*key*/
)
qube
--\
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_pret_dolg_sf = qube.vr_pret_dolg_sf--\vr_pret_dolg_sf
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="sr_opl_opl_sf" table="vr_pret_dolg_sf" type="number" title="Оплата" is-user-editable="1" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.sr_opl_opl_sf1 as sr_opl_opl_sf, /*Оплата*//*number*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sum(qube.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата*//*number*/

from (
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select un.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select sr_opl_sf_a_d.kod_opl as kod_opl_prm, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf_a_d
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_opl_sf_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_sf = kod_sf_a_d.kod_sf--\vr_pret_dolg_sf
where
vr_pret_dolg_sf.kod_pret_dolg_sf is not null  group by
sr_opl_sf_a_d.kod_opl, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
union all
(
--
select vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
null as sr_opl_opl_sf1/*number*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
where
vr_pret_dolg_sf.kod_pret_dolg_sf is not null )
--\
)
--\
)
un
--\
 group by
un.vr_pret_dolg_sf/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
 group by
qube.vr_pret_dolg_sf/*number*//*key*/
)
qube
--\
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_pret_dolg_sf = qube.vr_pret_dolg_sf--\vr_pret_dolg_sf
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="dolg_tek" table="vr_pret_dolg_sf" type="number" title="Текущая задолженность" is-user-editable="1" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.fin_ul_ob1 as dolg_tek, /*Текущая задолженность*//*number*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sum( nvl( qube.sr_facras_nachisl1 ,0)  -nvl( qube.sr_opl_opl_sf1 ,0) )  as fin_ul_ob1/*Оборот*//*number*/

from (
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1, /*Начислено*//*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1, /*Начислено*//*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select un.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sum(un.sr_facras_nachisl1)  as sr_facras_nachisl1, /*Начислено*//*number*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sr_facras.nachisl as sr_facras_nachisl1, /*Начислено*//*number*/
null as sr_opl_opl_sf1/*number*/

from (
--
select sr_facras_a_d.kod_ras as kod_ras_prm, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf/*number*//*key*/

from (
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras_a_d
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_facras_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_sf = kod_sf_a_d.kod_sf--\vr_pret_dolg_sf
where
vr_pret_dolg_sf.kod_pret_dolg_sf is not null  group by
sr_facras_a_d.kod_ras, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf/*number*//*key*/
)
dims
--\
left outer join
(
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.nachisl as nachisl/*Начислено*//*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras on sr_facras.kod_ras = dims.kod_ras_prm--\sr_facras
)
--\
union all
(
--
select dims.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
null as sr_facras_nachisl1, /*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select sr_opl_sf_a_d.kod_opl as kod_opl_prm, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf_a_d
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_opl_sf_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_sf = kod_sf_a_d.kod_sf--\vr_pret_dolg_sf
where
vr_pret_dolg_sf.kod_pret_dolg_sf is not null  group by
sr_opl_sf_a_d.kod_opl, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
union all
(
--
select vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
null as sr_facras_nachisl1, /*number*/
null as sr_opl_opl_sf1/*number*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
where
vr_pret_dolg_sf.kod_pret_dolg_sf is not null )
--\
)
--\
)
un
--\
 group by
un.vr_pret_dolg_sf/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
 group by
qube.vr_pret_dolg_sf/*number*//*key*/
)
qube
--\
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_pret_dolg_sf = qube.vr_pret_dolg_sf--\vr_pret_dolg_sf
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="total_dolg" table="vr_pret_dolg_sf" type="number" title="Задолженность по претензии" ColumnEditable="0" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select vr_pret_dolg_sf.total_dolg as total_dolg, /*Задолженность по претензии*//*number*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
 nvl( a.dolg_osn_real ,0)  +nvl( a.dolg_gp ,0)  +nvl( a.dolg_peni ,0)  +nvl( a.dolg_sud_peni ,0)  +nvl( a.dolg_astr ,0)  +nvl( a.dolg_othr ,0)  as total_dolg/*Сальдо*//*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.dolg_osn_real as dolg_osn_real,a.dolg_gp as dolg_gp,a.dolg_peni as dolg_peni,a.dolg_sud_peni as dolg_sud_peni,a.dolg_astr as dolg_astr,a.dolg_othr as dolg_othr  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n5 as dolg_osn_real,t.n6 as dolg_gp,t.n7 as dolg_peni,t.n8 as dolg_sud_peni,t.n9 as dolg_astr,t.n10 as dolg_othr  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.dolg_osn_real as dolg_osn_real,a.dolg_gp as dolg_gp,a.dolg_peni as dolg_peni,a.dolg_sud_peni as dolg_sud_peni,a.dolg_astr as dolg_astr,a.dolg_othr as dolg_othr  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n5 as dolg_osn_real,t.n6 as dolg_gp,t.n7 as dolg_peni,t.n8 as dolg_sud_peni,t.n9 as dolg_astr,t.n10 as dolg_othr  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="pk_ur_pass" table="vr_pret_dolg_sf" type="string" title="ПК &quot;Юрист&quot;" ColumnEditable="0" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select vr_pret_dolg_sf.pk_ur_pass as pk_ur_pass, /*ПК "Юрист"*//*string*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
 case  when ( nvl( a.pr_sud ,0)=1 )  then 'Нет' else 'Да' end  as pk_ur_pass/*ПК "Юрист"*//*string*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.pr_sud as pr_sud  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n11 as pr_sud  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.pr_sud as pr_sud  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n11 as pr_sud  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="vid_real_x_n" table="vr_pret_dolg_sf.vid_real" type="string" title="Вид реализации" text-source-for="vid_real" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_pret_dolg_sf_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select vid_real_x_n.name as vid_real_x_n, /*Вид реализации*//*string*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
 nvl( kod_sf.vid_real , ( case  when ( nvl( a.dolg_peni ,0)!=0 )  then 7 end )  )  as vid_real/*Начисленные_пени*//*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.dolg_peni as dolg_peni,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n7 as dolg_peni,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.dolg_peni as dolg_peni,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n7 as dolg_peni,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_real as vid_real/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
left outer join
(
--sk_vid_real
select a.vid_real as vid_real, /**//*number*//*key*/
a.name as name/*Вид реализации*//*string*/

from sk_vid_real
a
--\sk_vid_real
)
vid_real_x_n on vr_pret_dolg_sf.vid_real = vid_real_x_n.vid_real--\sk_vid_real
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="is_new" table="vr_pret_dolg_sf" type="number" title="" is-user-editable="1" />
        <column name="is_not_new" table="vr_pret_dolg_sf" type="number" title="" is-user-editable="1" />
        <column name="kod_pret_dolg_sf" table="vr_pret_dolg_sf" type="number" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kod_pret_dolg_sf" temp-col-name="n1" />
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:kod_pret_dolg_sf as kod_pret_dolg_sf 
 
from dual ) 
 
loop 
insert into vr_pret_dolg_sf 
(kod_pret_dolg_sf 
) 
 values  
(r.kod_pret_dolg_sf 
) 
 returning  
kod_pret_dolg_sf into :kod_pret_dolg_sf; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from vr_pret_dolg_sf where kod_pret_dolg_sf=:kod_pret_dolg_sf</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='vr_pret_dolg_sf' 
and 
names=:form_id 
and 
f2=:kod_pret_dolg_sf; 
if :row_state_id=1  then 
for r in  
 ( select  
:kod_pret_dolg_sf as kod_pret_dolg_sf 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
) 
 values  
('vr_pret_dolg_sf' 
,:form_id 
,:kod_pret_dolg_sf 
,:row_state_id 
,r.kod_pret_dolg_sf 
); 
end loop; 
else 
for r in  
 ( select  
:kod_pret_dolg_sf as kod_pret_dolg_sf 
,a.kod_pret_dolg_dog 
,a.kod_dog 
,a.kod_sf 
,a.dolg_osn_real 
,a.dolg_gp 
,a.dolg_peni 
,a.dolg_sud_peni 
,a.dolg_astr 
,a.num_delo 
,a.dolg_othr 
,a.dat_calc_peni 
,a.dat_sud 
,a.u_m 
,a.d_m 
,a.pr_sud 
 
from vr_pret_dolg_sf a  where kod_pret_dolg_sf=:kod_pret_dolg_sf) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,n2 
,n3 
,n4 
,n5 
,n6 
,n7 
,n8 
,n9 
,s1 
,n10 
,d1 
,d2 
,s2 
,d3 
,n11 
) 
 values  
('vr_pret_dolg_sf' 
,:form_id 
,:kod_pret_dolg_sf 
,:row_state_id 
,r.kod_pret_dolg_sf 
,r.kod_pret_dolg_dog 
,r.kod_dog 
,r.kod_sf 
,r.dolg_osn_real 
,r.dolg_gp 
,r.dolg_peni 
,r.dolg_sud_peni 
,r.dolg_astr 
,r.num_delo 
,r.dolg_othr 
,r.dat_calc_peni 
,r.dat_sud 
,r.u_m 
,r.d_m 
,r.pr_sud 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='vr_pret_dolg_sf' and names=:form_id</clear-temp-text>
      <update-text>begin
update vr_pret_dolg_sf set  
(kod_pret_dolg_sf 
) 
= 
 ( select  
:kod_pret_dolg_sf as kod_pret_dolg_sf 
 
from dual ) 
 
where 
kod_pret_dolg_sf=:kod_pret_dolg_sf 
;
end;
</update-text>
      <scheme>
        <table name="vr_pret_dolg_sf" as="vr_pret_dolg_sf">
          <columns>
            <column name="ndog" type="string" title="Номер договора" />
            <column name="ym" type="number" format="F2" edit-mask="F2" title="Отчетный период начисления" />
            <column name="vid_real" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="num_sf" type="string" format="F0" edit-mask="F0" title="Номер документа начисления" />
            <column name="dat_sf" type="date" title="Дата документа начисления" />
            <column name="sr_facras_nachisl" type="number" title="Начислено" />
            <column name="sr_opl_opl_sf" type="number" title="Оплата" />
            <column name="dolg_tek" type="number" title="Текущая задолженность" />
            <column name="total_dolg" type="number" title="Задолженность по претензии" />
            <column name="pk_ur_pass" type="string" title="ПК &quot;Юрист&quot;" />
            <column name="vid_real_x_n" type="string" title="Вид реализации" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_pret_dolg_sf" type="number" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <column name="ndog" type="string" title="Номер договора" />
            <column name="ym" type="number" format="F2" edit-mask="F2" title="Отчетный период начисления" />
            <column name="vid_real_x_n" type="string" title="Вид реализации" />
            <column name="vid_real" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="num_sf" type="string" format="F0" edit-mask="F0" title="Номер документа начисления" />
            <column name="dat_sf" type="date" title="Дата документа начисления" />
            <column name="sr_facras_nachisl" type="number" title="Начислено" />
            <column name="sr_opl_opl_sf" type="number" title="Оплата" />
            <column name="dolg_tek" type="number" title="Текущая задолженность" />
            <column name="total_dolg" type="number" title="Задолженность по претензии" />
            <column name="pk_ur_pass" type="string" title="ПК &quot;Юрист&quot;" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_pret_dolg_sf" type="number" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="kod_pret_dolg_sf_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="kod_pret_dolg_sf_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select kod_dog.ndog as ndog, /*Номер договора*//*string*/
kod_sf.ym as ym, /*Отчетный период начисления*//*number*/
vr_pret_dolg_sf.vid_real as vid_real, /*Вид реализации*//*number*/
kod_sf.num_sf as num_sf, /*Номер документа начисления*//*string*/
kod_sf.dat_sf as dat_sf, /*Дата документа начисления*//*date*/
qube.sr_facras_nachisl1 as sr_facras_nachisl, /*Начислено*//*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf, /*Оплата*//*number*/
qube.fin_ul_ob1 as dolg_tek, /*Текущая задолженность*//*number*/
vr_pret_dolg_sf.total_dolg as total_dolg, /*Задолженность по претензии*//*number*/
vr_pret_dolg_sf.pk_ur_pass as pk_ur_pass, /*ПК "Юрист"*//*string*/
vid_real_x_n.name as vid_real_x_n, /*Вид реализации*//*string*/
vr_pret_dolg_sf.is_new as is_new, /*number*/
vr_pret_dolg_sf.is_not_new as is_not_new, /*number*/
vr_pret_dolg_sf.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sum(qube.sr_facras_nachisl1)  as sr_facras_nachisl1, /*Начислено*//*number*/
sum(qube.sr_opl_opl_sf1)  as sr_opl_opl_sf1, /*Оплата*//*number*/
sum( nvl( qube.sr_facras_nachisl1 ,0)  -nvl( qube.sr_opl_opl_sf1 ,0) )  as fin_ul_ob1/*Оборот*//*number*/

from (
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1, /*Начислено*//*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select qube.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1, /*Начислено*//*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select un.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sum(un.sr_facras_nachisl1)  as sr_facras_nachisl1, /*Начислено*//*number*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
sr_facras.nachisl as sr_facras_nachisl1, /*Начислено*//*number*/
null as sr_opl_opl_sf1/*number*/

from (
--
select sr_facras_a_d.kod_ras as kod_ras_prm, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf/*number*//*key*/

from (
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras_a_d
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_facras_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_sf = kod_sf_a_d.kod_sf--\vr_pret_dolg_sf
where
vr_pret_dolg_sf.kod_pret_dolg_sf is not null  group by
sr_facras_a_d.kod_ras, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf/*number*//*key*/
)
dims
--\
left outer join
(
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.nachisl as nachisl/*Начислено*//*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras on sr_facras.kod_ras = dims.kod_ras_prm--\sr_facras
)
--\
union all
(
--
select dims.vr_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
null as sr_facras_nachisl1, /*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select sr_opl_sf_a_d.kod_opl as kod_opl_prm, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf_a_d
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_opl_sf_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_sf = kod_sf_a_d.kod_sf--\vr_pret_dolg_sf
where
vr_pret_dolg_sf.kod_pret_dolg_sf is not null  group by
sr_opl_sf_a_d.kod_opl, /*number*//*key*/
vr_pret_dolg_sf.kod_pret_dolg_sf/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
union all
(
--
select vr_pret_dolg_sf.kod_pret_dolg_sf as vr_pret_dolg_sf, /*number*//*key*/
null as sr_facras_nachisl1, /*number*/
null as sr_opl_opl_sf1/*number*/

from (
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf/*number*//*key*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
)
vr_pret_dolg_sf
--\vr_pret_dolg_sf
where
vr_pret_dolg_sf.kod_pret_dolg_sf is not null )
--\
)
--\
)
un
--\
 group by
un.vr_pret_dolg_sf/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
 group by
qube.vr_pret_dolg_sf/*number*//*key*/
)
qube
--\
left outer join
(
--vr_pret_dolg_sf
select a.kod_pret_dolg_sf as kod_pret_dolg_sf, /*number*//*key*/
a.kod_sf as kod_sf, /*number*/
 nvl( a.dolg_osn_real ,0)  +nvl( a.dolg_gp ,0)  +nvl( a.dolg_peni ,0)  +nvl( a.dolg_sud_peni ,0)  +nvl( a.dolg_astr ,0)  +nvl( a.dolg_othr ,0)  as total_dolg, /*Сальдо*//*number*/
 nvl( kod_sf.vid_real , ( case  when ( nvl( a.dolg_peni ,0)!=0 )  then 7 end )  )  as vid_real, /*Начисленные_пени*//*number*/
 case  when ( nvl( a.pr_sud ,0)=1 )  then 'Нет' else 'Да' end  as pk_ur_pass, /*ПК "Юрист"*//*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf,a.dolg_osn_real as dolg_osn_real,a.dolg_gp as dolg_gp,a.dolg_peni as dolg_peni,a.dolg_sud_peni as dolg_sud_peni,a.dolg_astr as dolg_astr,a.dolg_othr as dolg_othr,a.pr_sud as pr_sud,0 as is_new,1 as is_not_new  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf,t.n5 as dolg_osn_real,t.n6 as dolg_gp,t.n7 as dolg_peni,t.n8 as dolg_sud_peni,t.n9 as dolg_astr,t.n10 as dolg_othr,t.n11 as pr_sud,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
a
--\(select a.kod_pret_dolg_sf as kod_pret_dolg_sf,a.kod_sf as kod_sf,a.dolg_osn_real as dolg_osn_real,a.dolg_gp as dolg_gp,a.dolg_peni as dolg_peni,a.dolg_sud_peni as dolg_sud_peni,a.dolg_astr as dolg_astr,a.dolg_othr as dolg_othr,a.pr_sud as pr_sud,0 as is_new,1 as is_not_new  from vr_pret_dolg_sf a where not exists (select * from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and a.kod_pret_dolg_sf=t.f2 ) and   a.kod_pret_dolg_sf in :kod_pret_dolg_sf_prm   union all  select t.n1 as kod_pret_dolg_sf,t.n4 as kod_sf,t.n5 as dolg_osn_real,t.n6 as dolg_gp,t.n7 as dolg_peni,t.n8 as dolg_sud_peni,t.n9 as dolg_astr,t.n10 as dolg_othr,t.n11 as pr_sud,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='vr_pret_dolg_sf' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_pret_dolg_sf_prm )
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_real as vid_real/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
)
vr_pret_dolg_sf on vr_pret_dolg_sf.kod_pret_dolg_sf = qube.vr_pret_dolg_sf--\vr_pret_dolg_sf
left outer join
(
--sk_vid_real
select a.vid_real as vid_real, /**//*number*//*key*/
a.name as name/*Вид реализации*//*string*/

from sk_vid_real
a
--\sk_vid_real
)
vid_real_x_n on vr_pret_dolg_sf.vid_real = vid_real_x_n.vid_real--\sk_vid_real
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.kod_dog as kod_dog, /*number*/
a.num_sf as num_sf, /*Номер документа начисления*//*number*/
a.dat_sf as dat_sf, /*Дата документа начисления*//*date*/
a.ym as ym/*Отчетный период начисления*//*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on vr_pret_dolg_sf.kod_sf = kod_sf.kod_sf--\sr_facvip
left outer join
(
--kr_dogovor
select a.kod_dog as kod_dog, /*number*//*key*/
a.ndog as ndog/*Номер договора*//*string*/

from kr_dogovor
a
--\kr_dogovor
)
kod_dog on kod_sf.kod_dog = kod_dog.kod_dog--\kr_dogovor

order by dat_sf--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
  </dataset>
</root>