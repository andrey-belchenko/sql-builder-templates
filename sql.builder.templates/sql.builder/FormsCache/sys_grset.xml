<?xml version="1.0" encoding="utf-8"?>
<root>
  <form name="sys_grset" timestamp="07.08.2017 20:18:04" title="Группировка" form-size="1308;758" file="sql.builder.templates\sql.builder\projects\system\forms\sys_grset.xml">
    <splitcontainer id="43480301">
      <fieldgroup title="Уровни группировки" noborder="1" id="21237710">
        <grid table="a" show-toolbar="1" parent-field-name="parent_id" id="26706817">
          <toolbar id="53844028">
            <uicommand button-type="grid-refresh" visible="0" name="grid-refresh" control-name="ButtonRefresh" file="sql.builder.templates\sql.builder\projects\common\main.xml" title="" id="60350833" />
            <uicommand button-type="grid-save" visible="0" name="grid-save" control-name="ButtonCommit" file="sql.builder.templates\sql.builder\projects\common\main.xml" title="" id="58465074" />
            <uicommand action-type="close" title="Готово" button-type="custom-ok" name="apply" icon="Ok_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" id="48257794" />
            <uicommand action-type="close" title="Отмена" id="32412498" />
          </toolbar>
          <columns id="39934623">
            <field table="a" name="parent_id" title="" controlType="UIText" rows-limit="100" id="60121537" />
            <field table="a" name="title" title="Уровень группировки" controlType="UIText" rows-limit="100" id="32440188" />
            <field table="a" name="info" title="Группировка" controlType="UIText" rows-limit="100" id="61807256" />
          </columns>
        </grid>
      </fieldgroup>
      <fieldgroup title=" " show-toolbar="1" noborder="1" id="22338915">
        <toolbar id="12790078">
          <uicommand action-type="add-selected" title="Добавить выделенные" id="65439749" />
          <uicommand action-type="remove-selected" title="Убрать выдленные" id="65784015" />
        </toolbar>
        <splitcontainer is-vertical="1" id="36554485">
          <fieldgroup title="Доступные" id="42718180">
            <grid table="b" title="Доступные" id="55056358">
              <columns id="60267694">
                <field table="b" name="check1" title="Выбор" controlType="UICheck" rows-limit="100" id="54631179" />
                <field table="b" name="title" title="Измерение" controlType="UIText" rows-limit="100" id="30086761" />
              </columns>
            </grid>
          </fieldgroup>
          <fieldgroup title="Выбранные" id="33627604">
            <grid table="c" title="Выбранные" id="63018644">
              <columns id="42457079">
                <field table="c" name="query_link_id" title="" controlType="UICombo" rows-limit="100" id="6614920" />
                <field table="c" name="title" title="Измерение" controlType="UIText" rows-limit="100" id="11667573" />
              </columns>
            </grid>
          </fieldgroup>
        </splitcontainer>
      </fieldgroup>
    </splitcontainer>
  </form>
  <dataset>
    <fields>
      <field type="string" name="is_form_valid" parname="is_form_valid" />
      <field type="string" name="is_form_valid_not" parname="is_form_valid_not" />
      <field type="string" name="a_has_changes" parname="a_has_changes" />
      <field type="string" name="c_has_changes" parname="c_has_changes" />
      <field type="string" name="b_has_changes" parname="b_has_changes" />
    </fields>
    <table name="a" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" non-db="1" ref-column="" multiselect-column="" multiselect-target="" update-target="sys_grset" key="grset_id" is-ms-upd="1" is-top="1">
      <select-text>
--
select a.parent_id as parent_id, /*string*/
a.title as title, /*Уровень группировки*//*string*/
a.info as info, /*Группировка*//*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new, /*number*/
a.grset_id as grset_id/*string*//*key*/

from (
--sys_grset
select a.grset_id as grset_id, /*string*//*key*/
a.parent_id as parent_id, /*string*/
a.title as title, /*Уровень группировки*//*string*/
a.info as info, /*Группировка*//*string*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from sys_grset
a
--\sys_grset
)
a
--\sys_grset
--\
</select-text>
      <columns>
        <column name="parent_id" table="a" type="string" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="parent_id" temp-col-name="s1" />
        <column name="title" table="a" type="string" title="Уровень группировки" ColumnEditable="0" is-updateable="1" is-updateable-ext="1" update-target="title" temp-col-name="s2" />
        <column name="info" table="a" type="string" title="Группировка" ColumnEditable="0" is-updateable="1" is-updateable-ext="1" update-target="info" temp-col-name="s3" />
        <column name="is_new" table="a" type="number" title="" is-user-editable="1" />
        <column name="is_not_new" table="a" type="number" title="" is-user-editable="1" />
        <column name="grset_id" table="a" type="string" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="grset_id" temp-col-name="s4" />
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:parent_id as parent_id 
,:title as title 
,:info as info 
,:grset_id as grset_id 
 
from dual ) 
 
loop 
insert into sys_grset 
(parent_id 
,title 
,info 
,grset_id 
) 
 values  
(r.parent_id 
,r.title 
,r.info 
,r.grset_id 
) 
 returning  
grset_id into :grset_id; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from sys_grset where grset_id=:grset_id</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='a' 
and 
names=:form_id 
and 
f2=:grset_id; 
if :row_state_id=1  then 
for r in  
 ( select  
:parent_id as parent_id 
,:title as title 
,:info as info 
,:grset_id as grset_id 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,s1 
,s2 
,s3 
,s4 
) 
 values  
('a' 
,:form_id 
,:grset_id 
,:row_state_id 
,r.parent_id 
,r.title 
,r.info 
,r.grset_id 
); 
end loop; 
else 
for r in  
 ( select  
:parent_id as parent_id 
,:title as title 
,:info as info 
,:grset_id as grset_id 
 
from sys_grset a  where grset_id=:grset_id) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,s1 
,s2 
,s3 
,s4 
) 
 values  
('a' 
,:form_id 
,:grset_id 
,:row_state_id 
,r.parent_id 
,r.title 
,r.info 
,r.grset_id 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='a' and names=:form_id</clear-temp-text>
      <update-text>begin
update sys_grset set  
(parent_id 
,title 
,info 
,grset_id 
) 
= 
 ( select  
:parent_id as parent_id 
,:title as title 
,:info as info 
,:grset_id as grset_id 
 
from dual ) 
 
where 
grset_id=:grset_id 
;
end;
</update-text>
      <scheme>
        <table name="sys_grset" as="a">
          <columns>
            <column name="parent_id" type="string" title="" />
            <column name="title" type="string" title="Уровень группировки" />
            <column name="info" type="string" title="Группировка" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="grset_id" type="string" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <column name="parent_id" type="string" title="" />
            <column name="title" type="string" title="Уровень группировки" />
            <column name="info" type="string" title="Группировка" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="grset_id" type="string" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="grset_id_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="grset_id_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select a.parent_id as parent_id, /*string*/
a.title as title, /*Уровень группировки*//*string*/
a.info as info, /*Группировка*//*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new, /*number*/
a.grset_id as grset_id/*string*//*key*/

from (
--sys_grset
select a.grset_id as grset_id, /*string*//*key*/
a.parent_id as parent_id, /*string*/
a.title as title, /*Уровень группировки*//*string*/
a.info as info, /*Группировка*//*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.grset_id as grset_id,a.parent_id as parent_id,a.title as title,a.info as info,0 as is_new,1 as is_not_new  from sys_grset a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.grset_id=t.f2 ) and   a.grset_id in :grset_id_prm   union all  select t.s4 as grset_id,t.s1 as parent_id,t.s2 as title,t.s3 as info,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_id_prm )
a
--\(select a.grset_id as grset_id,a.parent_id as parent_id,a.title as title,a.info as info,0 as is_new,1 as is_not_new  from sys_grset a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.grset_id=t.f2 ) and   a.grset_id in :grset_id_prm   union all  select t.s4 as grset_id,t.s1 as parent_id,t.s2 as title,t.s3 as info,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_id_prm )
)
a
--\sys_grset
--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
    <table name="c" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" non-db="1" ref-column="query_link_id" multiselect-column="" multiselect-target="" update-target="sys_grset_link" column-editable="0" key="grset_link_id" parent-table="a" parent-key="grset_id" is-ms-upd="1">
      <select-text>
--
select c.query_link_id as query_link_id, /*string*/
c.title as title, /*Измерение*//*string*/
query_link_id_x_n.query_link_id as query_link_id_x_n, /*string*/
c.is_new as is_new, /*number*/
c.is_not_new as is_not_new, /*number*/
c.grset_link_id as grset_link_id, /*string*//*key*/
c.grset_id as grset_id/*string*/

from (
--sys_grset_link
select a.grset_link_id as grset_link_id, /*string*//*key*/
a.grset_id as grset_id, /*string*/
a.query_link_id as query_link_id, /*string*/
a.title as title, /*string*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from sys_query_link
a
--\sys_query_link
)
c
--\sys_grset_link
left outer join
(
--sys_query_link
select a.query_link_id as query_link_id/*string*//*key*/

from sys_query_link
a
--\sys_query_link
)
query_link_id_x_n on query_link_id_x_n.query_link_id = c.query_link_id--\sys_query_link
where
c.grset_id = :fk_grset_id --\
</select-text>
      <columns>
        <column name="query_link_id" table="c" type="string" title="" ColumnVisible="0" is-updateable="1" is-updateable-ext="1" update-target="query_link_id" temp-col-name="s1">
          <dep-refresh-cmd>
            <root table="c">
              <params>
                <param name="grset_link_id_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="grset_link_id_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select query_link_id_x_n.query_link_id as query_link_id_x_n, /*string*/
c.grset_link_id as grset_link_id/*string*//*key*/

from (
--sys_grset_link
select a.grset_link_id as grset_link_id, /*string*//*key*/
a.query_link_id as query_link_id/*string*/

from (select a.grset_link_id as grset_link_id,a.query_link_id as query_link_id  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='c' and t.names=:form_id  and a.grset_link_id=t.f2 ) and   a.grset_link_id in :grset_link_id_prm   union all  select t.s3 as grset_link_id,t.s1 as query_link_id  from rr_temp t where t.skod ='c' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_link_id_prm )
a
--\(select a.grset_link_id as grset_link_id,a.query_link_id as query_link_id  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='c' and t.names=:form_id  and a.grset_link_id=t.f2 ) and   a.grset_link_id in :grset_link_id_prm   union all  select t.s3 as grset_link_id,t.s1 as query_link_id  from rr_temp t where t.skod ='c' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_link_id_prm )
)
c
--\sys_grset_link
left outer join
(
--sys_query_link
select a.query_link_id as query_link_id/*string*//*key*/

from (select a.query_link_id as query_link_id  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='c' and t.names=:form_id  and a.grset_link_id=t.f2 ) and   a.grset_link_id in :grset_link_id_prm   union all  select t.s1 as query_link_id  from rr_temp t where t.skod ='c' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_link_id_prm )
a
--\(select a.query_link_id as query_link_id  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='c' and t.names=:form_id  and a.grset_link_id=t.f2 ) and   a.grset_link_id in :grset_link_id_prm   union all  select t.s1 as query_link_id  from rr_temp t where t.skod ='c' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_link_id_prm )
)
query_link_id_x_n on query_link_id_x_n.query_link_id = c.query_link_id--\sys_query_link
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </dep-refresh-cmd>
          <dependants>
            <dependant name="query_link_id_x_n" table="c" />
          </dependants>
        </column>
        <column name="title" table="c" type="string" title="Измерение" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="title" temp-col-name="s2" />
        <column name="query_link_id_x_n" table="c.query_link_id" type="string" title="" text-source-for="query_link_id" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="grset_link_id_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="grset_link_id_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select query_link_id_x_n.query_link_id as query_link_id_x_n, /*string*/
c.grset_link_id as grset_link_id/*string*//*key*/

from (
--sys_grset_link
select a.grset_link_id as grset_link_id, /*string*//*key*/
a.query_link_id as query_link_id/*string*/

from (select a.grset_link_id as grset_link_id,a.query_link_id as query_link_id  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='c' and t.names=:form_id  and a.grset_link_id=t.f2 ) and   a.grset_link_id in :grset_link_id_prm   union all  select t.s3 as grset_link_id,t.s1 as query_link_id  from rr_temp t where t.skod ='c' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_link_id_prm )
a
--\(select a.grset_link_id as grset_link_id,a.query_link_id as query_link_id  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='c' and t.names=:form_id  and a.grset_link_id=t.f2 ) and   a.grset_link_id in :grset_link_id_prm   union all  select t.s3 as grset_link_id,t.s1 as query_link_id  from rr_temp t where t.skod ='c' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_link_id_prm )
)
c
--\sys_grset_link
left outer join
(
--sys_query_link
select a.query_link_id as query_link_id/*string*//*key*/

from (select a.query_link_id as query_link_id  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='c' and t.names=:form_id  and a.grset_link_id=t.f2 ) and   a.grset_link_id in :grset_link_id_prm   union all  select t.s1 as query_link_id  from rr_temp t where t.skod ='c' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_link_id_prm )
a
--\(select a.query_link_id as query_link_id  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='c' and t.names=:form_id  and a.grset_link_id=t.f2 ) and   a.grset_link_id in :grset_link_id_prm   union all  select t.s1 as query_link_id  from rr_temp t where t.skod ='c' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_link_id_prm )
)
query_link_id_x_n on query_link_id_x_n.query_link_id = c.query_link_id--\sys_query_link
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="is_new" table="c" type="number" title="" is-user-editable="1" />
        <column name="is_not_new" table="c" type="number" title="" is-user-editable="1" />
        <column name="grset_link_id" table="c" type="string" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="grset_link_id" temp-col-name="s3" />
        <column name="grset_id" table="c" type="string" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="grset_id" temp-col-name="s4">
          <sel-list-compiled>
            <root>
              <query timestamp="04.08.2017 14:38:31" class="1" file="sql.builder.templates\sql.builder\projects\system\scheme\original\sys_grset.xml" haskeys="1" name="a" as="a" noname="1" path="./a" used="1">
                <select>--a
select <column table="a" column="grset_id" as="grset_id" title="" key="1" used="1" type="string" sourcetable="./a/a" sourcecolumn="grset_id" into="s1">a.grset_id as grset_id, /**//*string*//*key*/
</column><column table="a" column="title" as="title" title="Уровень группировки" key="0" used="1" type="string" sourcetable="./a/a" sourcecolumn="title" into="s2">a.title as title, /*Уровень группировки*//*string*/
</column><column table="a" column="info" as="info" title="Группировка" key="0" used="1" type="string" sourcetable="./a/a" sourcecolumn="info" into="s3">a.info as info/*Группировка*//*string*/
</column></select>
                <from>
from <query name="sys_grset" as="a" path="./a/a" haskeys="1" used="1">(
<select>--sys_grset
select <column table="a" column="grset_id" key="1" type="string" as="grset_id" used="1" sourcetable="./a/a" sourcecolumn="grset_id">a.grset_id as grset_id, /*string*//*key*/
</column><column table="a" column="title" type="string" title="Уровень группировки" column-editable="0" as="title" used="1" sourcetable="./a/a" sourcecolumn="title" key="0">a.title as title, /*Уровень группировки*//*string*/
</column><column table="a" column="info" type="string" title="Группировка" column-editable="0" as="info" used="1" sourcetable="./a/a" sourcecolumn="info" key="0">a.info as info/*Группировка*//*string*/
</column></select><from>
from <table name="sys_grset" as="a" client-calc="1" used="1">sys_grset
a
--\sys_grset
</table></from>)
a
--\sys_grset
</query></from>
                <where>where
<call function="and" pth="" type="bool"><call function="le" pth="" type="bool">(<call function="rownum" pth="0" type="number"><text txtype="func"> rownum </text></call><text txtype="func"> &lt;= </text><const><text>:p_rows_limit </text></const>) </call><text txtype="func"> { </text><text txtype="func"> and </text><call function="in" pth="" optional="1" type="bool">(<column table="a" column="grset_id" as="grset_id" title="" key="1" thissrc="grset_id">a.grset_id</column><text txtype="func"> in </text><const><text>:pk_prm </text></const>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="grset_id" as="grset_id" title="" key="1" thissrc="grset_id">a.grset_id</column><text txtype="func"> ) like lower( </text><const><text>:grset_id_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="title" as="title" title="Уровень группировки" thissrc="title">a.title</column><text txtype="func"> ) like lower( </text><const><text>:title_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="info" as="info" title="Группировка" thissrc="info">a.info</column><text txtype="func"> ) like lower( </text><const><text>:info_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text></call></where>--\a
</query>
            </root>
          </sel-list-compiled>
          <sel-list-report>
            <report name="a" timestamp="04.08.2017 14:38:31" class="1" file="sql.builder.templates\sql.builder\projects\system\scheme\original\sys_grset.xml" haskeys="1" as="a">
              <queries>
                <query timestamp="04.08.2017 14:38:31" class="1" file="sql.builder.templates\sql.builder\projects\system\scheme\original\sys_grset.xml" haskeys="1" name="a" as="a">
                  <params>
                    <param name="pk_prm" type="array" />
                    <param name="grset_id_filter" type="string" />
                    <param name="title_filter" type="string" />
                    <param name="info_filter" type="string" />
                    <param name="p_rows_limit" type="number" />
                  </params>
                  <select>
                    <column table="a" column="grset_id" as="grset_id" title="" key="1" />
                    <column table="a" column="title" as="title" title="Уровень группировки" />
                    <column table="a" column="info" as="info" title="Группировка" />
                  </select>
                  <from>
                    <query name="sys_grset" as="a" />
                  </from>
                  <where>
                    <call function="and">
                      <call function="le">
                        <call function="rownum" />
                        <useparam name="p_rows_limit" />
                      </call>
                      <call function="in" optional="1">
                        <column table="this" column="grset_id" />
                        <useparam name="pk_prm" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="grset_id" />
                        <useparam name="grset_id_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="title" />
                        <useparam name="title_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="info" />
                        <useparam name="info_filter" />
                      </call>
                    </call>
                  </where>
                  <withparams>
                    <useparam name="pk_prm" />
                    <useparam name="grset_id_filter" />
                    <useparam name="title_filter" />
                    <useparam name="info_filter" />
                    <useparam name="p_rows_limit" />
                  </withparams>
                </query>
              </queries>
              <params>
                <param name="pk_prm" type="array">
                  <const>:pk_prm </const>
                </param>
                <param name="grset_id_filter" type="string">
                  <const>:grset_id_filter </const>
                </param>
                <param name="title_filter" type="string">
                  <const>:title_filter </const>
                </param>
                <param name="info_filter" type="string">
                  <const>:info_filter </const>
                </param>
                <param name="p_rows_limit" type="number">
                  <const>:p_rows_limit </const>
                </param>
              </params>
            </report>
          </sel-list-report>
          <sel-list-pars>
            <params />
          </sel-list-pars>
        </column>
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:query_link_id as query_link_id 
,:title as title 
,:grset_link_id as grset_link_id 
,:grset_id as grset_id 
 
from dual ) 
 
loop 
insert into sys_grset_link 
(query_link_id 
,title 
,grset_link_id 
,grset_id 
) 
 values  
(r.query_link_id 
,r.title 
,r.grset_link_id 
,r.grset_id 
) 
 returning  
grset_link_id into :grset_link_id; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from sys_grset_link where grset_link_id=:grset_link_id</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='c' 
and 
names=:form_id 
and 
f2=:grset_link_id; 
if :row_state_id=1  then 
for r in  
 ( select  
:query_link_id as query_link_id 
,:title as title 
,:grset_link_id as grset_link_id 
,:grset_id as grset_id 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,s1 
,s2 
,s3 
,s4 
) 
 values  
('c' 
,:form_id 
,:grset_link_id 
,:row_state_id 
,r.query_link_id 
,r.title 
,r.grset_link_id 
,r.grset_id 
); 
end loop; 
else 
for r in  
 ( select  
:query_link_id as query_link_id 
,:title as title 
,:grset_link_id as grset_link_id 
,:grset_id as grset_id 
 
from sys_grset_link a  where grset_link_id=:grset_link_id) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,s1 
,s2 
,s3 
,s4 
) 
 values  
('c' 
,:form_id 
,:grset_link_id 
,:row_state_id 
,r.query_link_id 
,r.title 
,r.grset_link_id 
,r.grset_id 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='c' and names=:form_id</clear-temp-text>
      <update-text>begin
update sys_grset_link set  
(query_link_id 
,title 
,grset_link_id 
,grset_id 
) 
= 
 ( select  
:query_link_id as query_link_id 
,:title as title 
,:grset_link_id as grset_link_id 
,:grset_id as grset_id 
 
from dual ) 
 
where 
grset_link_id=:grset_link_id 
;
end;
</update-text>
      <scheme>
        <table name="sys_grset_link" as="c">
          <columns>
            <column name="query_link_id" type="string" invisible-in-column-chooser="1" visible="0" />
            <column name="title" type="string" title="Измерение" />
            <column name="query_link_id_x_n" type="string" title="" visible="0" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="grset_link_id" type="string" invisible-in-column-chooser="1" visible="0" />
            <column name="grset_id" type="string" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <column name="query_link_id_x_n" type="string" title="" visible="0" />
            <column name="query_link_id" type="string" invisible-in-column-chooser="1" visible="0" />
            <column name="title" type="string" title="Измерение" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="grset_link_id" type="string" invisible-in-column-chooser="1" visible="0" />
            <column name="grset_id" type="string" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="grset_link_id_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="grset_link_id_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select c.query_link_id as query_link_id, /*string*/
c.title as title, /*Измерение*//*string*/
query_link_id_x_n.query_link_id as query_link_id_x_n, /*string*/
c.is_new as is_new, /*number*/
c.is_not_new as is_not_new, /*number*/
c.grset_link_id as grset_link_id, /*string*//*key*/
c.grset_id as grset_id/*string*/

from (
--sys_grset_link
select a.grset_link_id as grset_link_id, /*string*//*key*/
a.grset_id as grset_id, /*string*/
a.query_link_id as query_link_id, /*string*/
a.title as title, /*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.grset_link_id as grset_link_id,a.grset_id as grset_id,a.query_link_id as query_link_id,a.title as title,0 as is_new,1 as is_not_new  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='c' and t.names=:form_id  and a.grset_link_id=t.f2 ) and   a.grset_link_id in :grset_link_id_prm   union all  select t.s3 as grset_link_id,t.s4 as grset_id,t.s1 as query_link_id,t.s2 as title,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='c' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_link_id_prm )
a
--\(select a.grset_link_id as grset_link_id,a.grset_id as grset_id,a.query_link_id as query_link_id,a.title as title,0 as is_new,1 as is_not_new  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='c' and t.names=:form_id  and a.grset_link_id=t.f2 ) and   a.grset_link_id in :grset_link_id_prm   union all  select t.s3 as grset_link_id,t.s4 as grset_id,t.s1 as query_link_id,t.s2 as title,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='c' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_link_id_prm )
)
c
--\sys_grset_link
left outer join
(
--sys_query_link
select a.query_link_id as query_link_id/*string*//*key*/

from (select a.query_link_id as query_link_id  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='c' and t.names=:form_id  and a.grset_link_id=t.f2 ) and   a.grset_link_id in :grset_link_id_prm   union all  select t.s1 as query_link_id  from rr_temp t where t.skod ='c' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_link_id_prm )
a
--\(select a.query_link_id as query_link_id  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='c' and t.names=:form_id  and a.grset_link_id=t.f2 ) and   a.grset_link_id in :grset_link_id_prm   union all  select t.s1 as query_link_id  from rr_temp t where t.skod ='c' and t.names=:form_id  and t.f3!=3  and t.f2 in :grset_link_id_prm )
)
query_link_id_x_n on query_link_id_x_n.query_link_id = c.query_link_id--\sys_query_link
--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
    <table name="b" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" non-db="1" ref-column="" multiselect-column="" multiselect-target="" update-target="sys_query_link" column-editable="0" key="query_link_id" is-ms-upd="1" is-top="1">
      <select-text>
--
select null as check1, /*number*/
b.title as title, /*Измерение*//*string*/
b.is_new as is_new, /*number*/
b.is_not_new as is_not_new, /*number*/
b.query_link_id as query_link_id/*string*//*key*/

from (
--sys_query_link
select a.query_link_id as query_link_id, /*string*//*key*/
a.title as title, /*string*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from sys_query_link
a
--\sys_query_link
)
b
--\sys_query_link
--\
</select-text>
      <columns>
        <column name="check1" table="b" type="number" title="Выбор" ColumnEditable="1" is-user-editable="1" is-updateable-ext="1" is-refreshed="1" update-target="check1" temp-col-name="n1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="query_link_id_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="query_link_id_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select null as check1, /*number*/
b.query_link_id as query_link_id/*string*//*key*/

from (
--sys_query_link
select a.query_link_id as query_link_id/*string*//*key*/

from (select a.query_link_id as query_link_id,a.title as title,0 as is_new,1 as is_not_new  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='b' and t.names=:form_id  and a.query_link_id=t.f2 ) and   a.query_link_id in :query_link_id_prm   union all  select t.s2 as query_link_id,t.s1 as title,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='b' and t.names=:form_id  and t.f3!=3  and t.f2 in :query_link_id_prm )
a
--\(select a.query_link_id as query_link_id,a.title as title,0 as is_new,1 as is_not_new  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='b' and t.names=:form_id  and a.query_link_id=t.f2 ) and   a.query_link_id in :query_link_id_prm   union all  select t.s2 as query_link_id,t.s1 as title,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='b' and t.names=:form_id  and t.f3!=3  and t.f2 in :query_link_id_prm )
)
b
--\sys_query_link
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="title" table="b" type="string" title="Измерение" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="title" temp-col-name="s1">
          <dep-refresh-cmd>
            <root table="b">
              <params>
                <param name="query_link_id_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="query_link_id_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select null as check1, /*number*/
b.query_link_id as query_link_id/*string*//*key*/

from (
--sys_query_link
select a.query_link_id as query_link_id/*string*//*key*/

from (select a.query_link_id as query_link_id,a.title as title,0 as is_new,1 as is_not_new  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='b' and t.names=:form_id  and a.query_link_id=t.f2 ) and   a.query_link_id in :query_link_id_prm   union all  select t.s2 as query_link_id,t.s1 as title,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='b' and t.names=:form_id  and t.f3!=3  and t.f2 in :query_link_id_prm )
a
--\(select a.query_link_id as query_link_id,a.title as title,0 as is_new,1 as is_not_new  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='b' and t.names=:form_id  and a.query_link_id=t.f2 ) and   a.query_link_id in :query_link_id_prm   union all  select t.s2 as query_link_id,t.s1 as title,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='b' and t.names=:form_id  and t.f3!=3  and t.f2 in :query_link_id_prm )
)
b
--\sys_query_link
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </dep-refresh-cmd>
          <dependants>
            <dependant name="check1" table="b" />
          </dependants>
        </column>
        <column name="is_new" table="b" type="number" title="" is-user-editable="1">
          <dep-refresh-cmd>
            <root table="b">
              <params>
                <param name="query_link_id_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="query_link_id_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select null as check1, /*number*/
b.query_link_id as query_link_id/*string*//*key*/

from (
--sys_query_link
select a.query_link_id as query_link_id/*string*//*key*/

from (select a.query_link_id as query_link_id,a.title as title,0 as is_new,1 as is_not_new  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='b' and t.names=:form_id  and a.query_link_id=t.f2 ) and   a.query_link_id in :query_link_id_prm   union all  select t.s2 as query_link_id,t.s1 as title,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='b' and t.names=:form_id  and t.f3!=3  and t.f2 in :query_link_id_prm )
a
--\(select a.query_link_id as query_link_id,a.title as title,0 as is_new,1 as is_not_new  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='b' and t.names=:form_id  and a.query_link_id=t.f2 ) and   a.query_link_id in :query_link_id_prm   union all  select t.s2 as query_link_id,t.s1 as title,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='b' and t.names=:form_id  and t.f3!=3  and t.f2 in :query_link_id_prm )
)
b
--\sys_query_link
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </dep-refresh-cmd>
          <dependants>
            <dependant name="check1" table="b" />
          </dependants>
        </column>
        <column name="is_not_new" table="b" type="number" title="" is-user-editable="1">
          <dep-refresh-cmd>
            <root table="b">
              <params>
                <param name="query_link_id_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="query_link_id_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select null as check1, /*number*/
b.query_link_id as query_link_id/*string*//*key*/

from (
--sys_query_link
select a.query_link_id as query_link_id/*string*//*key*/

from (select a.query_link_id as query_link_id,a.title as title,0 as is_new,1 as is_not_new  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='b' and t.names=:form_id  and a.query_link_id=t.f2 ) and   a.query_link_id in :query_link_id_prm   union all  select t.s2 as query_link_id,t.s1 as title,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='b' and t.names=:form_id  and t.f3!=3  and t.f2 in :query_link_id_prm )
a
--\(select a.query_link_id as query_link_id,a.title as title,0 as is_new,1 as is_not_new  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='b' and t.names=:form_id  and a.query_link_id=t.f2 ) and   a.query_link_id in :query_link_id_prm   union all  select t.s2 as query_link_id,t.s1 as title,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='b' and t.names=:form_id  and t.f3!=3  and t.f2 in :query_link_id_prm )
)
b
--\sys_query_link
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </dep-refresh-cmd>
          <dependants>
            <dependant name="check1" table="b" />
          </dependants>
        </column>
        <column name="query_link_id" table="b" type="string" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="query_link_id" temp-col-name="s2" />
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:title as title 
,:query_link_id as query_link_id 
 
from dual ) 
 
loop 
insert into sys_query_link 
(title 
,query_link_id 
) 
 values  
(r.title 
,r.query_link_id 
) 
 returning  
query_link_id into :query_link_id; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from sys_query_link where query_link_id=:query_link_id</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='b' 
and 
names=:form_id 
and 
f2=:query_link_id; 
if :row_state_id=1  then 
for r in  
 ( select  
:check1 as check1 
,:title as title 
,:query_link_id as query_link_id 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,s1 
,s2 
) 
 values  
('b' 
,:form_id 
,:query_link_id 
,:row_state_id 
,r.check1 
,r.title 
,r.query_link_id 
); 
end loop; 
else 
for r in  
 ( select  
:check1 as check1 
,:title as title 
,:query_link_id as query_link_id 
 
from sys_query_link a  where query_link_id=:query_link_id) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,s1 
,s2 
) 
 values  
('b' 
,:form_id 
,:query_link_id 
,:row_state_id 
,r.check1 
,r.title 
,r.query_link_id 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='b' and names=:form_id</clear-temp-text>
      <update-text>begin
update sys_query_link set  
(title 
,query_link_id 
) 
= 
 ( select  
:title as title 
,:query_link_id as query_link_id 
 
from dual ) 
 
where 
query_link_id=:query_link_id 
;
end;
</update-text>
      <scheme>
        <table name="sys_query_link" as="b">
          <columns>
            <column name="check1" type="number" title="Выбор" />
            <column name="title" type="string" title="Измерение" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="query_link_id" type="string" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <column name="check1" type="number" title="Выбор" />
            <column name="title" type="string" title="Измерение" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="query_link_id" type="string" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="query_link_id_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="query_link_id_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select null as check1, /*number*/
b.title as title, /*Измерение*//*string*/
b.is_new as is_new, /*number*/
b.is_not_new as is_not_new, /*number*/
b.query_link_id as query_link_id/*string*//*key*/

from (
--sys_query_link
select a.query_link_id as query_link_id, /*string*//*key*/
a.title as title, /*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.query_link_id as query_link_id,a.title as title,0 as is_new,1 as is_not_new  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='b' and t.names=:form_id  and a.query_link_id=t.f2 ) and   a.query_link_id in :query_link_id_prm   union all  select t.s2 as query_link_id,t.s1 as title,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='b' and t.names=:form_id  and t.f3!=3  and t.f2 in :query_link_id_prm )
a
--\(select a.query_link_id as query_link_id,a.title as title,0 as is_new,1 as is_not_new  from sys_query_link a where not exists (select * from rr_temp t where t.skod ='b' and t.names=:form_id  and a.query_link_id=t.f2 ) and   a.query_link_id in :query_link_id_prm   union all  select t.s2 as query_link_id,t.s1 as title,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='b' and t.names=:form_id  and t.f3!=3  and t.f2 in :query_link_id_prm )
)
b
--\sys_query_link
--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
  </dataset>
</root>