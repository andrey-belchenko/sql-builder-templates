<?xml version="1.0" encoding="utf-8"?>
<root>
  <form name="ur_folders_g_plat_all" timestamp="28.12.2023 14:48:20" class="1" title="Платежи ГП из КИСУ «Парус»" file="sql.builder.templates\sql.builder\projects\asuse2\reports\arbitrage\forms\ur_folders_g_plat_all.xml" elid="233" ord="233" leaf="0" lvl="2" pelid="">
    <grid table="a" show-toolbar="1" id="51982072">
      <toolbar id="6917033">
        <uicommand button-type="grid-save" column-visible="0" name="grid-save" control-name="ButtonCommit" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="365" ord="365" leaf="1" lvl="2" pelid="" title="" id="51171559" />
        <uicommand button-type="grid-add" column-visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="363" ord="363" leaf="1" lvl="2" pelid="" title="" id="27738116" />
        <uicommand button-type="grid-delete" column-visible="0" name="grid-delete" control-name="ButtonDeleteRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="367" ord="367" leaf="1" lvl="2" pelid="" title="" id="60834041" />
        <uicommand action-type="custom" title="Обновить из  КИСУ «Парус»" id="45713889">
          <useaction name="update_ur_gp_opl_info" id="2978715" />
          <useaction action-type="refresh-table" object="a" id="23654215" />
        </uicommand>
      </toolbar>
      <columns id="66823452">
        <band title="Данные из КИСУ Парус" id="17258023">
          <field table="a" name="nrn" title="ID записи из КИСУ Парус" controlType="UIText" edit-mask="N2" rows-limit="100" id="31058467" />
          <field table="a" name="sfinoper" title="Вид финансовой операции" controlType="UIText" rows-limit="100" id="1710911" />
          <field table="a" name="snum" title="Номер платежного документа" controlType="UIText" rows-limit="100" id="41219875" />
          <field table="a" name="ddate" title="Дата платежного документа" controlType="UIDate" rows-limit="100" id="23839309" />
          <field table="a" name="npay_sum" title="Сумма платежного документа" controlType="UIText" edit-mask="N2" rows-limit="100" id="57083724" />
          <field table="a" name="ndog" title="Номер Договора в ПК АСУСЭ" controlType="UIText" rows-limit="100" id="25105981" />
          <field table="a" name="inn" title="ИНН Контрагента" controlType="UIText" rows-limit="100" id="58394702" />
          <field table="a" name="indebfrom" title="Период задолженности С" controlType="UIDate" rows-limit="100" id="16656190" />
          <field table="a" name="indebto" title="Период задолженности ПО" controlType="UIDate" rows-limit="100" id="12359897" />
          <field table="a" name="kodfil" title="Код филиала Татэнергосбыта" controlType="UIText" rows-limit="100" id="23670399" />
          <field table="a" name="namefil" title="Полное наименование филиала Татэнергосбыт" controlType="UIText" rows-limit="100" id="52377758" />
          <field table="a" name="prsud" title="Признак привязки к судебному делу (не используется)" controlType="UIText" rows-limit="100" id="26492466" />
          <field table="a" name="nsud" title="Номер судебного дела" controlType="UIText" rows-limit="100" id="60717131" />
          <field table="a" name="svdoc_type" title="Документ основание: тип" controlType="UIText" rows-limit="100" id="30798214" />
          <field table="a" name="svdoc_numb" title="Документ основание: номер документа" controlType="UIText" rows-limit="100" id="8858001" />
          <field table="a" name="dvdoc_date" title="Документ основание: дата" controlType="UIDate" rows-limit="100" id="51846314" />
          <field table="a" name="sfdoc_type" title="Документ-подтверждение: тип" controlType="UIText" rows-limit="100" id="10063648" />
          <field table="a" name="sfdoc_numb" title="Документ-подтверждение: номер документа" controlType="UIText" rows-limit="100" id="15957200" />
          <field table="a" name="dfdoc_date" title="Документ-подтверждение: дата" controlType="UIDate" rows-limit="100" id="62164136" />
          <field table="a" name="sescort_doctype" title="Документ-сопровождение: тип" controlType="UIText" rows-limit="100" id="1796135" />
          <field table="a" name="sescort_docnumb" title="Документ-сопровождение: номер документа" controlType="UIText" rows-limit="100" id="12179161" />
          <field table="a" name="descort_docdate" title="Документ-сопровождение: дата" controlType="UIDate" rows-limit="100" id="52854238" />
          <field table="a" name="deleted" title="Удален в КИСУ «Парус»" controlType="UICheck" rows-limit="100" id="22750052" />
        </band>
        <band title="Привязка" id="58240044">
          <field table="a" name="num_delo" title="Номер дела" controlType="UIText" rows-limit="100" id="42260020" />
          <field table="a" name="nump" title="Код абонента" controlType="UIText" rows-limit="100" id="22032945" />
          <field table="a" name="name" title="Наименование абонента" controlType="UIText" rows-limit="100" id="16170819" />
        </band>
      </columns>
    </grid>
  </form>
  <dataset>
    <fields>
      <field type="string" name="is_form_valid" parname="is_form_valid" />
      <field type="string" name="is_form_valid_not" parname="is_form_valid_not" />
      <field type="string" name="a_has_changes" parname="a_has_changes" />
    </fields>
    <table name="a" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multi-select-column="" multi-select-target="" update-target="ur_gp_opl_info" column-editable="0" key="nrn" is-ms-upd="1" is-top="1">
      <select-text>
--
select a.nrn as nrn, /**//*number*//*key*/
a.sfinoper as sfinoper, /**//*string*/
a.snum as snum, /**//*string*/
a.ddate as ddate, /**//*date*/
a.npay_sum as npay_sum, /**//*number*/
a.ndog as ndog, /**//*string*/
a.inn as inn, /**//*string*/
a.indebfrom as indebfrom, /**//*date*/
a.indebto as indebto, /**//*date*/
a.kodfil as kodfil, /**//*string*/
a.namefil as namefil, /**//*string*/
a.prsud as prsud, /**//*string*/
a.nsud as nsud, /**//*string*/
a.svdoc_type as svdoc_type, /**//*string*/
a.svdoc_numb as svdoc_numb, /**//*string*/
a.dvdoc_date as dvdoc_date, /**//*date*/
a.sfdoc_type as sfdoc_type, /**//*string*/
a.sfdoc_numb as sfdoc_numb, /**//*string*/
a.dfdoc_date as dfdoc_date, /**//*date*/
a.sescort_doctype as sescort_doctype, /**//*string*/
a.sescort_docnumb as sescort_docnumb, /**//*string*/
a.descort_docdate as descort_docdate, /**//*date*/
a.deleted as deleted, /**//*number*/
kod_mat.num_delo as num_delo, /*Номер дела*//*string*/
kodp.nump as nump, /*Код абонента*//*string*/
kodp.name as name, /*Наименование абонента*//*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (
--ur_gp_opl_info
select a.nrn as nrn, /*ID записи из КИСУ Парус*//*number*//*key*/
a.sfinoper as sfinoper, /*Вид финансовой операции*//*string*/
a.snum as snum, /*Номер платежного документа*//*string*/
a.ddate as ddate, /*Дата платежного документа*//*date*/
a.npay_sum as npay_sum, /*Сумма платежного документа*//*number*/
a.ndog as ndog, /*Номер Договора в ПК АСУСЭ*//*string*/
a.inn as inn, /*ИНН Контрагента*//*string*/
a.indebfrom as indebfrom, /*Период задолженности С*//*date*/
a.indebto as indebto, /*Период задолженности ПО*//*date*/
a.kodfil as kodfil, /*Код филиала Татэнергосбыта*//*string*/
a.namefil as namefil, /*Полное наименование филиала Татэнергосбыт*//*string*/
a.prsud as prsud, /*Признак привязки к судебному делу (не используется)*//*string*/
a.nsud as nsud, /*Номер судебного дела*//*string*/
a.svdoc_type as svdoc_type, /*Документ основание: тип*//*string*/
a.svdoc_numb as svdoc_numb, /*Документ основание: номер документа*//*string*/
a.dvdoc_date as dvdoc_date, /*Документ основание: дата*//*date*/
a.sfdoc_type as sfdoc_type, /*Документ-подтверждение: тип*//*string*/
a.sfdoc_numb as sfdoc_numb, /*Документ-подтверждение: номер документа*//*string*/
a.dfdoc_date as dfdoc_date, /*Документ-подтверждение: дата*//*date*/
a.sescort_doctype as sescort_doctype, /*Документ-сопровождение: тип*//*string*/
a.sescort_docnumb as sescort_docnumb, /*Документ-сопровождение: номер документа*//*string*/
a.descort_docdate as descort_docdate, /*Документ-сопровождение: дата*//*date*/
a.deleted as deleted, /*Удален в КИСУ «Парус»*//*number*/
a.kod_mat as kod_mat, /*number*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from ur_gp_opl_info
a
--\ur_gp_opl_info
)
a
--\ur_gp_opl_info
left outer join
(
--ur_mat
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_folders as kod_folders, /*number*/
a.num_delo as num_delo/*Номер дела*//*string*/

from ur_mat
a
--\ur_mat
)
kod_mat on a.kod_mat = kod_mat.kod_mat--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kodp as kodp/**//*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on kod_mat.kod_folders = kod_folders.kod_folders--\ur_folders
left outer join
(
--kr_payer
select a.kodp as kodp, /**//*number*//*key*/
a.nump as nump, /*Код абонента*//*string*/
a.name as name/*Наименование абонента*//*string*/

from kr_payer
a
--\kr_payer
)
kodp on kod_folders.kodp = kodp.kodp--\kr_payer
--\
</select-text>
      <columns>
        <column name="nrn" table="a" type="number" title="ID записи из КИСУ Парус" is-user-editable="1" ColumnMandatory="1" is-updateable="1" is-updateable-ext="1" update-target="nrn" temp-col-name="n1" />
        <column name="sfinoper" table="a" type="string" title="Вид финансовой операции" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="sfinoper" temp-col-name="s1" />
        <column name="snum" table="a" type="string" title="Номер платежного документа" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="snum" temp-col-name="s2" />
        <column name="ddate" table="a" type="date" title="Дата платежного документа" is-user-editable="1" ColumnMandatory="1" is-updateable="1" is-updateable-ext="1" update-target="ddate" temp-col-name="d1" />
        <column name="npay_sum" table="a" type="number" title="Сумма платежного документа" is-user-editable="1" ColumnMandatory="1" is-updateable="1" is-updateable-ext="1" update-target="npay_sum" temp-col-name="n2" />
        <column name="ndog" table="a" type="string" title="Номер Договора в ПК АСУСЭ" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="ndog" temp-col-name="s3" />
        <column name="inn" table="a" type="string" title="ИНН Контрагента" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="inn" temp-col-name="s4" />
        <column name="indebfrom" table="a" type="date" title="Период задолженности С" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="indebfrom" temp-col-name="d2" />
        <column name="indebto" table="a" type="date" title="Период задолженности ПО" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="indebto" temp-col-name="d3" />
        <column name="kodfil" table="a" type="string" title="Код филиала Татэнергосбыта" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kodfil" temp-col-name="s5" />
        <column name="namefil" table="a" type="string" title="Полное наименование филиала Татэнергосбыт" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="namefil" temp-col-name="s6" />
        <column name="prsud" table="a" type="string" title="Признак привязки к судебному делу (не используется)" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="prsud" temp-col-name="s7" />
        <column name="nsud" table="a" type="string" title="Номер судебного дела" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="nsud" temp-col-name="s8" />
        <column name="svdoc_type" table="a" type="string" title="Документ основание: тип" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="svdoc_type" temp-col-name="s9" />
        <column name="svdoc_numb" table="a" type="string" title="Документ основание: номер документа" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="svdoc_numb" temp-col-name="s10" />
        <column name="dvdoc_date" table="a" type="date" title="Документ основание: дата" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="dvdoc_date" temp-col-name="d4" />
        <column name="sfdoc_type" table="a" type="string" title="Документ-подтверждение: тип" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="sfdoc_type" temp-col-name="s11" />
        <column name="sfdoc_numb" table="a" type="string" title="Документ-подтверждение: номер документа" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="sfdoc_numb" temp-col-name="s12" />
        <column name="dfdoc_date" table="a" type="date" title="Документ-подтверждение: дата" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="dfdoc_date" temp-col-name="d5" />
        <column name="sescort_doctype" table="a" type="string" title="Документ-сопровождение: тип" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="sescort_doctype" temp-col-name="s13" />
        <column name="sescort_docnumb" table="a" type="string" title="Документ-сопровождение: номер документа" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="sescort_docnumb" temp-col-name="s14" />
        <column name="descort_docdate" table="a" type="date" title="Документ-сопровождение: дата" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="descort_docdate" temp-col-name="d6" />
        <column name="deleted" table="a" type="number" title="Удален в КИСУ «Парус»" is-user-editable="1" ColumnMandatory="1" is-updateable="1" is-updateable-ext="1" update-target="deleted" temp-col-name="n3" />
        <column name="num_delo" table="kod_mat" type="string" title="Номер дела" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="nrn_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="nrn_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kod_mat.num_delo as num_delo, /*Номер дела*//*string*/
a.nrn as nrn/**//*number*//*key*/

from (
--ur_gp_opl_info
select a.nrn as nrn, /*ID записи из КИСУ Парус*//*number*//*key*/
a.kod_mat as kod_mat/*number*/

from (select a.nrn as nrn,a.kod_mat as kod_mat  from ur_gp_opl_info a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.nrn=t.f2 ) and   a.nrn in :nrn_prm   union all  select t.n1 as nrn,t.n4 as kod_mat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :nrn_prm )
a
--\(select a.nrn as nrn,a.kod_mat as kod_mat  from ur_gp_opl_info a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.nrn=t.f2 ) and   a.nrn in :nrn_prm   union all  select t.n1 as nrn,t.n4 as kod_mat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :nrn_prm )
)
a
--\ur_gp_opl_info
left outer join
(
--ur_mat
select a.kod_mat as kod_mat, /*number*//*key*/
a.num_delo as num_delo/*Номер дела*//*string*/

from ur_mat
a
--\ur_mat
)
kod_mat on a.kod_mat = kod_mat.kod_mat--\ur_mat
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="nump" table="kodp" type="string" title="Код абонента" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="nrn_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="nrn_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kodp.nump as nump, /*Код абонента*//*string*/
a.nrn as nrn/**//*number*//*key*/

from (
--ur_gp_opl_info
select a.nrn as nrn, /*ID записи из КИСУ Парус*//*number*//*key*/
a.kod_mat as kod_mat/*number*/

from (select a.nrn as nrn,a.kod_mat as kod_mat  from ur_gp_opl_info a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.nrn=t.f2 ) and   a.nrn in :nrn_prm   union all  select t.n1 as nrn,t.n4 as kod_mat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :nrn_prm )
a
--\(select a.nrn as nrn,a.kod_mat as kod_mat  from ur_gp_opl_info a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.nrn=t.f2 ) and   a.nrn in :nrn_prm   union all  select t.n1 as nrn,t.n4 as kod_mat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :nrn_prm )
)
a
--\ur_gp_opl_info
left outer join
(
--ur_mat
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_folders as kod_folders/*number*/

from ur_mat
a
--\ur_mat
)
kod_mat on a.kod_mat = kod_mat.kod_mat--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kodp as kodp/**//*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on kod_mat.kod_folders = kod_folders.kod_folders--\ur_folders
left outer join
(
--kr_payer
select a.kodp as kodp, /**//*number*//*key*/
a.nump as nump/*Код абонента*//*string*/

from kr_payer
a
--\kr_payer
)
kodp on kod_folders.kodp = kodp.kodp--\kr_payer
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="name" table="kodp" type="string" title="Наименование абонента" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="nrn_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="nrn_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kodp.name as name, /*Наименование абонента*//*string*/
a.nrn as nrn/**//*number*//*key*/

from (
--ur_gp_opl_info
select a.nrn as nrn, /*ID записи из КИСУ Парус*//*number*//*key*/
a.kod_mat as kod_mat/*number*/

from (select a.nrn as nrn,a.kod_mat as kod_mat  from ur_gp_opl_info a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.nrn=t.f2 ) and   a.nrn in :nrn_prm   union all  select t.n1 as nrn,t.n4 as kod_mat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :nrn_prm )
a
--\(select a.nrn as nrn,a.kod_mat as kod_mat  from ur_gp_opl_info a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.nrn=t.f2 ) and   a.nrn in :nrn_prm   union all  select t.n1 as nrn,t.n4 as kod_mat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :nrn_prm )
)
a
--\ur_gp_opl_info
left outer join
(
--ur_mat
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_folders as kod_folders/*number*/

from ur_mat
a
--\ur_mat
)
kod_mat on a.kod_mat = kod_mat.kod_mat--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kodp as kodp/**//*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on kod_mat.kod_folders = kod_folders.kod_folders--\ur_folders
left outer join
(
--kr_payer
select a.kodp as kodp, /**//*number*//*key*/
a.name as name/*Наименование абонента*//*string*/

from kr_payer
a
--\kr_payer
)
kodp on kod_folders.kodp = kodp.kodp--\kr_payer
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="is_new" table="a" type="number" title="" is-user-editable="1" />
        <column name="is_not_new" table="a" type="number" title="" is-user-editable="1" />
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:nrn as nrn 
,:sfinoper as sfinoper 
,:snum as snum 
,:ddate as ddate 
,:npay_sum as npay_sum 
,:ndog as ndog 
,:inn as inn 
,:indebfrom as indebfrom 
,:indebto as indebto 
,:kodfil as kodfil 
,:namefil as namefil 
,:prsud as prsud 
,:nsud as nsud 
,:svdoc_type as svdoc_type 
,:svdoc_numb as svdoc_numb 
,:dvdoc_date as dvdoc_date 
,:sfdoc_type as sfdoc_type 
,:sfdoc_numb as sfdoc_numb 
,:dfdoc_date as dfdoc_date 
,:sescort_doctype as sescort_doctype 
,:sescort_docnumb as sescort_docnumb 
,:descort_docdate as descort_docdate 
,:deleted as deleted 
 
from dual ) 
 
loop 
insert into ur_gp_opl_info 
(nrn 
,sfinoper 
,snum 
,ddate 
,npay_sum 
,ndog 
,inn 
,indebfrom 
,indebto 
,kodfil 
,namefil 
,prsud 
,nsud 
,svdoc_type 
,svdoc_numb 
,dvdoc_date 
,sfdoc_type 
,sfdoc_numb 
,dfdoc_date 
,sescort_doctype 
,sescort_docnumb 
,descort_docdate 
,deleted 
) 
 values  
(r.nrn 
,r.sfinoper 
,r.snum 
,r.ddate 
,r.npay_sum 
,r.ndog 
,r.inn 
,r.indebfrom 
,r.indebto 
,r.kodfil 
,r.namefil 
,r.prsud 
,r.nsud 
,r.svdoc_type 
,r.svdoc_numb 
,r.dvdoc_date 
,r.sfdoc_type 
,r.sfdoc_numb 
,r.dfdoc_date 
,r.sescort_doctype 
,r.sescort_docnumb 
,r.descort_docdate 
,r.deleted 
) 
 returning  
nrn into :nrn; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from ur_gp_opl_info where nrn=:nrn</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='a' 
and 
names=:form_id 
and 
f2=:nrn; 
if :row_state_id=1  then 
for r in  
 ( select  
:nrn as nrn 
,:sfinoper as sfinoper 
,:snum as snum 
,:ddate as ddate 
,:npay_sum as npay_sum 
,:ndog as ndog 
,:inn as inn 
,:indebfrom as indebfrom 
,:indebto as indebto 
,:kodfil as kodfil 
,:namefil as namefil 
,:prsud as prsud 
,:nsud as nsud 
,:svdoc_type as svdoc_type 
,:svdoc_numb as svdoc_numb 
,:dvdoc_date as dvdoc_date 
,:sfdoc_type as sfdoc_type 
,:sfdoc_numb as sfdoc_numb 
,:dfdoc_date as dfdoc_date 
,:sescort_doctype as sescort_doctype 
,:sescort_docnumb as sescort_docnumb 
,:descort_docdate as descort_docdate 
,:deleted as deleted 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,s1 
,s2 
,d1 
,n2 
,s3 
,s4 
,d2 
,d3 
,s5 
,s6 
,s7 
,s8 
,s9 
,s10 
,d4 
,s11 
,s12 
,d5 
,s13 
,s14 
,d6 
,n3 
) 
 values  
('a' 
,:form_id 
,:nrn 
,:row_state_id 
,r.nrn 
,r.sfinoper 
,r.snum 
,r.ddate 
,r.npay_sum 
,r.ndog 
,r.inn 
,r.indebfrom 
,r.indebto 
,r.kodfil 
,r.namefil 
,r.prsud 
,r.nsud 
,r.svdoc_type 
,r.svdoc_numb 
,r.dvdoc_date 
,r.sfdoc_type 
,r.sfdoc_numb 
,r.dfdoc_date 
,r.sescort_doctype 
,r.sescort_docnumb 
,r.descort_docdate 
,r.deleted 
); 
end loop; 
else 
for r in  
 ( select  
:nrn as nrn 
,:sfinoper as sfinoper 
,:snum as snum 
,:ddate as ddate 
,:npay_sum as npay_sum 
,:ndog as ndog 
,:inn as inn 
,:indebfrom as indebfrom 
,:indebto as indebto 
,:kodfil as kodfil 
,:namefil as namefil 
,:prsud as prsud 
,:nsud as nsud 
,:svdoc_type as svdoc_type 
,:svdoc_numb as svdoc_numb 
,:dvdoc_date as dvdoc_date 
,:sfdoc_type as sfdoc_type 
,:sfdoc_numb as sfdoc_numb 
,:dfdoc_date as dfdoc_date 
,:sescort_doctype as sescort_doctype 
,:sescort_docnumb as sescort_docnumb 
,:descort_docdate as descort_docdate 
,:deleted as deleted 
,a.kod_mat 
 
from ur_gp_opl_info a  where nrn=:nrn) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,s1 
,s2 
,d1 
,n2 
,s3 
,s4 
,d2 
,d3 
,s5 
,s6 
,s7 
,s8 
,s9 
,s10 
,d4 
,s11 
,s12 
,d5 
,s13 
,s14 
,d6 
,n3 
,n4 
) 
 values  
('a' 
,:form_id 
,:nrn 
,:row_state_id 
,r.nrn 
,r.sfinoper 
,r.snum 
,r.ddate 
,r.npay_sum 
,r.ndog 
,r.inn 
,r.indebfrom 
,r.indebto 
,r.kodfil 
,r.namefil 
,r.prsud 
,r.nsud 
,r.svdoc_type 
,r.svdoc_numb 
,r.dvdoc_date 
,r.sfdoc_type 
,r.sfdoc_numb 
,r.dfdoc_date 
,r.sescort_doctype 
,r.sescort_docnumb 
,r.descort_docdate 
,r.deleted 
,r.kod_mat 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='a' and names=:form_id</clear-temp-text>
      <update-text>begin
update ur_gp_opl_info set  
(nrn 
,sfinoper 
,snum 
,ddate 
,npay_sum 
,ndog 
,inn 
,indebfrom 
,indebto 
,kodfil 
,namefil 
,prsud 
,nsud 
,svdoc_type 
,svdoc_numb 
,dvdoc_date 
,sfdoc_type 
,sfdoc_numb 
,dfdoc_date 
,sescort_doctype 
,sescort_docnumb 
,descort_docdate 
,deleted 
) 
= 
 ( select  
:nrn as nrn 
,:sfinoper as sfinoper 
,:snum as snum 
,:ddate as ddate 
,:npay_sum as npay_sum 
,:ndog as ndog 
,:inn as inn 
,:indebfrom as indebfrom 
,:indebto as indebto 
,:kodfil as kodfil 
,:namefil as namefil 
,:prsud as prsud 
,:nsud as nsud 
,:svdoc_type as svdoc_type 
,:svdoc_numb as svdoc_numb 
,:dvdoc_date as dvdoc_date 
,:sfdoc_type as sfdoc_type 
,:sfdoc_numb as sfdoc_numb 
,:dfdoc_date as dfdoc_date 
,:sescort_doctype as sescort_doctype 
,:sescort_docnumb as sescort_docnumb 
,:descort_docdate as descort_docdate 
,:deleted as deleted 
 
from dual ) 
 
where 
nrn=:nrn 
;
end;
</update-text>
      <events>
        <useaction action-type="execute-update" call="ur_folders_g_update_plat" event-name="instead-object-delete">
          <column table="this" column="nrn" />
          <const>null</const>
        </useaction>
      </events>
      <scheme>
        <table name="ur_gp_opl_info" as="a">
          <columns>
            <column name="nrn" type="number" title="ID записи из КИСУ Парус" />
            <column name="sfinoper" type="string" title="Вид финансовой операции" />
            <column name="snum" type="string" title="Номер платежного документа" />
            <column name="ddate" type="date" title="Дата платежного документа" />
            <column name="npay_sum" type="number" title="Сумма платежного документа" />
            <column name="ndog" type="string" title="Номер Договора в ПК АСУСЭ" />
            <column name="inn" type="string" title="ИНН Контрагента" />
            <column name="indebfrom" type="date" title="Период задолженности С" />
            <column name="indebto" type="date" title="Период задолженности ПО" />
            <column name="kodfil" type="string" title="Код филиала Татэнергосбыта" />
            <column name="namefil" type="string" title="Полное наименование филиала Татэнергосбыт" />
            <column name="prsud" type="string" title="Признак привязки к судебному делу (не используется)" />
            <column name="nsud" type="string" title="Номер судебного дела" />
            <column name="svdoc_type" type="string" title="Документ основание: тип" />
            <column name="svdoc_numb" type="string" title="Документ основание: номер документа" />
            <column name="dvdoc_date" type="date" title="Документ основание: дата" />
            <column name="sfdoc_type" type="string" title="Документ-подтверждение: тип" />
            <column name="sfdoc_numb" type="string" title="Документ-подтверждение: номер документа" />
            <column name="dfdoc_date" type="date" title="Документ-подтверждение: дата" />
            <column name="sescort_doctype" type="string" title="Документ-сопровождение: тип" />
            <column name="sescort_docnumb" type="string" title="Документ-сопровождение: номер документа" />
            <column name="descort_docdate" type="date" title="Документ-сопровождение: дата" />
            <column name="deleted" type="number" title="Удален в КИСУ «Парус»" />
            <column name="num_delo" type="string" title="Номер дела" />
            <column name="nump" type="string" title="Код абонента" />
            <column name="name" type="string" title="Наименование абонента" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <band title="Данные из КИСУ Парус">
              <column name="nrn" type="number" title="ID записи из КИСУ Парус" />
              <column name="sfinoper" type="string" title="Вид финансовой операции" />
              <column name="snum" type="string" title="Номер платежного документа" />
              <column name="ddate" type="date" title="Дата платежного документа" />
              <column name="npay_sum" type="number" title="Сумма платежного документа" />
              <column name="ndog" type="string" title="Номер Договора в ПК АСУСЭ" />
              <column name="inn" type="string" title="ИНН Контрагента" />
              <column name="indebfrom" type="date" title="Период задолженности С" />
              <column name="indebto" type="date" title="Период задолженности ПО" />
              <column name="kodfil" type="string" title="Код филиала Татэнергосбыта" />
              <column name="namefil" type="string" title="Полное наименование филиала Татэнергосбыт" />
              <column name="prsud" type="string" title="Признак привязки к судебному делу (не используется)" />
              <column name="nsud" type="string" title="Номер судебного дела" />
              <column name="svdoc_type" type="string" title="Документ основание: тип" />
              <column name="svdoc_numb" type="string" title="Документ основание: номер документа" />
              <column name="dvdoc_date" type="date" title="Документ основание: дата" />
              <column name="sfdoc_type" type="string" title="Документ-подтверждение: тип" />
              <column name="sfdoc_numb" type="string" title="Документ-подтверждение: номер документа" />
              <column name="dfdoc_date" type="date" title="Документ-подтверждение: дата" />
              <column name="sescort_doctype" type="string" title="Документ-сопровождение: тип" />
              <column name="sescort_docnumb" type="string" title="Документ-сопровождение: номер документа" />
              <column name="descort_docdate" type="date" title="Документ-сопровождение: дата" />
              <column name="deleted" type="number" title="Удален в КИСУ «Парус»" />
            </band>
            <band title="Привязка">
              <column name="num_delo" type="string" title="Номер дела" />
              <column name="nump" type="string" title="Код абонента" />
              <column name="name" type="string" title="Наименование абонента" />
            </band>
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="nrn_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="nrn_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select a.nrn as nrn, /**//*number*//*key*/
a.sfinoper as sfinoper, /**//*string*/
a.snum as snum, /**//*string*/
a.ddate as ddate, /**//*date*/
a.npay_sum as npay_sum, /**//*number*/
a.ndog as ndog, /**//*string*/
a.inn as inn, /**//*string*/
a.indebfrom as indebfrom, /**//*date*/
a.indebto as indebto, /**//*date*/
a.kodfil as kodfil, /**//*string*/
a.namefil as namefil, /**//*string*/
a.prsud as prsud, /**//*string*/
a.nsud as nsud, /**//*string*/
a.svdoc_type as svdoc_type, /**//*string*/
a.svdoc_numb as svdoc_numb, /**//*string*/
a.dvdoc_date as dvdoc_date, /**//*date*/
a.sfdoc_type as sfdoc_type, /**//*string*/
a.sfdoc_numb as sfdoc_numb, /**//*string*/
a.dfdoc_date as dfdoc_date, /**//*date*/
a.sescort_doctype as sescort_doctype, /**//*string*/
a.sescort_docnumb as sescort_docnumb, /**//*string*/
a.descort_docdate as descort_docdate, /**//*date*/
a.deleted as deleted, /**//*number*/
kod_mat.num_delo as num_delo, /*Номер дела*//*string*/
kodp.nump as nump, /*Код абонента*//*string*/
kodp.name as name, /*Наименование абонента*//*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (
--ur_gp_opl_info
select a.nrn as nrn, /*ID записи из КИСУ Парус*//*number*//*key*/
a.sfinoper as sfinoper, /*Вид финансовой операции*//*string*/
a.snum as snum, /*Номер платежного документа*//*string*/
a.ddate as ddate, /*Дата платежного документа*//*date*/
a.npay_sum as npay_sum, /*Сумма платежного документа*//*number*/
a.ndog as ndog, /*Номер Договора в ПК АСУСЭ*//*string*/
a.inn as inn, /*ИНН Контрагента*//*string*/
a.indebfrom as indebfrom, /*Период задолженности С*//*date*/
a.indebto as indebto, /*Период задолженности ПО*//*date*/
a.kodfil as kodfil, /*Код филиала Татэнергосбыта*//*string*/
a.namefil as namefil, /*Полное наименование филиала Татэнергосбыт*//*string*/
a.prsud as prsud, /*Признак привязки к судебному делу (не используется)*//*string*/
a.nsud as nsud, /*Номер судебного дела*//*string*/
a.svdoc_type as svdoc_type, /*Документ основание: тип*//*string*/
a.svdoc_numb as svdoc_numb, /*Документ основание: номер документа*//*string*/
a.dvdoc_date as dvdoc_date, /*Документ основание: дата*//*date*/
a.sfdoc_type as sfdoc_type, /*Документ-подтверждение: тип*//*string*/
a.sfdoc_numb as sfdoc_numb, /*Документ-подтверждение: номер документа*//*string*/
a.dfdoc_date as dfdoc_date, /*Документ-подтверждение: дата*//*date*/
a.sescort_doctype as sescort_doctype, /*Документ-сопровождение: тип*//*string*/
a.sescort_docnumb as sescort_docnumb, /*Документ-сопровождение: номер документа*//*string*/
a.descort_docdate as descort_docdate, /*Документ-сопровождение: дата*//*date*/
a.deleted as deleted, /*Удален в КИСУ «Парус»*//*number*/
a.kod_mat as kod_mat, /*number*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.nrn as nrn,a.sfinoper as sfinoper,a.snum as snum,a.ddate as ddate,a.npay_sum as npay_sum,a.ndog as ndog,a.inn as inn,a.indebfrom as indebfrom,a.indebto as indebto,a.kodfil as kodfil,a.namefil as namefil,a.prsud as prsud,a.nsud as nsud,a.svdoc_type as svdoc_type,a.svdoc_numb as svdoc_numb,a.dvdoc_date as dvdoc_date,a.sfdoc_type as sfdoc_type,a.sfdoc_numb as sfdoc_numb,a.dfdoc_date as dfdoc_date,a.sescort_doctype as sescort_doctype,a.sescort_docnumb as sescort_docnumb,a.descort_docdate as descort_docdate,a.deleted as deleted,a.kod_mat as kod_mat,0 as is_new,1 as is_not_new  from ur_gp_opl_info a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.nrn=t.f2 ) and   a.nrn in :nrn_prm   union all  select t.n1 as nrn,t.s1 as sfinoper,t.s2 as snum,t.d1 as ddate,t.n2 as npay_sum,t.s3 as ndog,t.s4 as inn,t.d2 as indebfrom,t.d3 as indebto,t.s5 as kodfil,t.s6 as namefil,t.s7 as prsud,t.s8 as nsud,t.s9 as svdoc_type,t.s10 as svdoc_numb,t.d4 as dvdoc_date,t.s11 as sfdoc_type,t.s12 as sfdoc_numb,t.d5 as dfdoc_date,t.s13 as sescort_doctype,t.s14 as sescort_docnumb,t.d6 as descort_docdate,t.n3 as deleted,t.n4 as kod_mat,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :nrn_prm )
a
--\(select a.nrn as nrn,a.sfinoper as sfinoper,a.snum as snum,a.ddate as ddate,a.npay_sum as npay_sum,a.ndog as ndog,a.inn as inn,a.indebfrom as indebfrom,a.indebto as indebto,a.kodfil as kodfil,a.namefil as namefil,a.prsud as prsud,a.nsud as nsud,a.svdoc_type as svdoc_type,a.svdoc_numb as svdoc_numb,a.dvdoc_date as dvdoc_date,a.sfdoc_type as sfdoc_type,a.sfdoc_numb as sfdoc_numb,a.dfdoc_date as dfdoc_date,a.sescort_doctype as sescort_doctype,a.sescort_docnumb as sescort_docnumb,a.descort_docdate as descort_docdate,a.deleted as deleted,a.kod_mat as kod_mat,0 as is_new,1 as is_not_new  from ur_gp_opl_info a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.nrn=t.f2 ) and   a.nrn in :nrn_prm   union all  select t.n1 as nrn,t.s1 as sfinoper,t.s2 as snum,t.d1 as ddate,t.n2 as npay_sum,t.s3 as ndog,t.s4 as inn,t.d2 as indebfrom,t.d3 as indebto,t.s5 as kodfil,t.s6 as namefil,t.s7 as prsud,t.s8 as nsud,t.s9 as svdoc_type,t.s10 as svdoc_numb,t.d4 as dvdoc_date,t.s11 as sfdoc_type,t.s12 as sfdoc_numb,t.d5 as dfdoc_date,t.s13 as sescort_doctype,t.s14 as sescort_docnumb,t.d6 as descort_docdate,t.n3 as deleted,t.n4 as kod_mat,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :nrn_prm )
)
a
--\ur_gp_opl_info
left outer join
(
--ur_mat
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_folders as kod_folders, /*number*/
a.num_delo as num_delo/*Номер дела*//*string*/

from ur_mat
a
--\ur_mat
)
kod_mat on a.kod_mat = kod_mat.kod_mat--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kodp as kodp/**//*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on kod_mat.kod_folders = kod_folders.kod_folders--\ur_folders
left outer join
(
--kr_payer
select a.kodp as kodp, /**//*number*//*key*/
a.nump as nump, /*Код абонента*//*string*/
a.name as name/*Наименование абонента*//*string*/

from kr_payer
a
--\kr_payer
)
kodp on kod_folders.kodp = kodp.kodp--\kr_payer
--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
  </dataset>
</root>