<?xml version="1.0" encoding="utf-8"?>
<root>
  <form name="45862_vb_kol_gr" timestamp="28.12.2023 14:39:00" title="Кольцевая группа" form-size="1050;800" show-toolbar="1" file="sql.builder.templates\sql.builder\projects\45862\form\forms.xml" elid="63" ord="63" leaf="0" lvl="2" pelid="">
    <field table="kg_edit_allow_flag" name="save_active" title="ym_editable" controlType="UIText" edit-mask="N2" rows-limit="100" id="15036180" />
    <field table="a" name="name_exp" title="Наименование" controlType="UIText" rows-limit="100" id="58241892" />
    <field table="a" name="kol_gr_comment" title="Дополнение" controlType="UIText" rows-limit="100" id="11136046" />
    <field table="a" name="kod_fl" title="Код филиала" controlType="UICombo" rows-limit="100" id="42778702" />
    <field table="a" name="s" title="Период с" controlType="UICombo" rows-limit="100" id="39221887" />
    <field table="a" name="is_not_new" title="" controlType="UIText" edit-mask="N2" rows-limit="100" id="49611760" />
    <splitcontainer id="66378284">
      <fieldgroup title="ПС" id="20163149">
        <grid table="pwrc" show-toolbar="1" show-checkbox="1" auto-filter="1" id="52294841">
          <toolbar id="26824846">
            <uicommand button-type="grid-add" visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="363" ord="363" leaf="1" lvl="2" pelid="" title="" id="22748883" />
            <uicommand button-type="grid-refresh" column-visible="0" name="grid-refresh" control-name="ButtonRefresh" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="366" ord="366" leaf="1" lvl="2" pelid="" title="" id="64840138" />
            <uicommand button-type="grid-delete" column-visible="0" name="grid-delete" control-name="ButtonDeleteRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="367" ord="367" leaf="1" lvl="2" pelid="" title="" id="13975268" />
            <uicommand button-type="grid-save" column-visible="0" name="grid-save" control-name="ButtonCommit" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="365" ord="365" leaf="1" lvl="2" pelid="" title="" id="2491712" />
            <uicommand title="Привязать" action-type="custom" button-type="custom-add-form" editable="save_active" name="custom-add-form" icon="AddForm_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="376" ord="376" leaf="1" lvl="2" pelid="" id="39381398">
              <useaction action-type="save" id="64951895" />
              <useaction action-type="dynamic-form-create-multiple" call="45862_vb_pwrc_change" modal="1" title="Привязать" id="24800939">
                <useparam name="kod_fl" id="19898381" />
                <useparam name="kod_nastr" id="47981274" />
                <useparam name="ym" id="59979576" />
              </useaction>
            </uicommand>
            <uicommand action-type="custom" prompt="Вы уверены, что хотите отвязать выделенные ПС?" title="Отвязать отмеченные" editable="save_active" button-type="custom-delete" name="custom-delete" icon="Delete_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="379" ord="379" leaf="1" lvl="2" pelid="" id="13168178">
              <useaction action-type="client-remove-row" id="6839321" />
              <useaction action-type="save" object="pwrc" id="26939725" />
              <useaction title="Обновить настройки КГ" name="vb_kol_gr_pack.upd_kg_nastr" id="11337297">
                <useparam name="kod_nastr" id="18519297" />
                <useparam name="ym" id="41998675" />
              </useaction>
              <useaction title="Обновить имя КГ" name="vb_kol_gr_pack.upd_kg_name" id="36867976">
                <useparam name="kod_nastr" id="64005871" />
              </useaction>
              <useaction action-type="refresh-table" object="a" id="7845686" />
            </uicommand>
          </toolbar>
          <columns id="38972844">
            <field table="pwrc" name="pwrcname" title="ПС" width="316" controlType="UIText" rows-limit="100" id="12430703" />
          </columns>
        </grid>
      </fieldgroup>
      <fieldgroup title="Фидеры" id="51555260">
        <grid table="fdr" show-toolbar="1" show-checkbox="1" auto-filter="1" id="49088530">
          <toolbar id="55533053">
            <uicommand button-type="grid-add" visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="363" ord="363" leaf="1" lvl="2" pelid="" title="" id="62013937" />
            <uicommand button-type="grid-refresh" column-visible="0" name="grid-refresh" control-name="ButtonRefresh" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="366" ord="366" leaf="1" lvl="2" pelid="" title="" id="65513233" />
            <uicommand button-type="grid-delete" column-visible="0" name="grid-delete" control-name="ButtonDeleteRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="367" ord="367" leaf="1" lvl="2" pelid="" title="" id="49649323" />
            <uicommand button-type="grid-save" column-visible="0" name="grid-save" control-name="ButtonCommit" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="365" ord="365" leaf="1" lvl="2" pelid="" title="" id="14168472" />
            <uicommand action-type="dynamic-form-create-multiple" call="45862_vb_fdr_change" modal="1" title="Привязать" editable="save_active" button-type="custom-add-form" name="custom-add-form" icon="AddForm_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="376" ord="376" leaf="1" lvl="2" pelid="" id="61006283">
              <useparam name="kod_nastr" id="12731549" />
              <useparam name="ym" id="3683471" />
            </uicommand>
            <uicommand action-type="custom" prompt="Вы уверены, что хотите отвязать выделенные фидеры?" title="Отвязать отмеченные" editable="save_active" button-type="custom-delete" name="custom-delete" icon="Delete_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="379" ord="379" leaf="1" lvl="2" pelid="" id="47897377">
              <useaction action-type="client-remove-row" id="12107573" />
              <useaction action-type="save" object="fdr" id="37721613" />
              <useaction title="Обновить настройки КГ" name="vb_kol_gr_pack.upd_kg_nastr" id="9619539">
                <useparam name="kod_nastr" id="53088471" />
                <useparam name="ym" id="62225544" />
              </useaction>
              <useaction title="Обновить имя КГ" name="vb_kol_gr_pack.upd_kg_name" id="43521943">
                <useparam name="kod_nastr" id="40073523" />
              </useaction>
              <useaction action-type="refresh-table" object="a" id="24961618" />
            </uicommand>
          </toolbar>
          <columns id="52840602">
            <field table="fdr" name="pwrc_fdrname" title="Фидер" width="124" controlType="UIText" rows-limit="100" id="57570688" />
            <field table="fdr" name="entire_fdr" title="Фидер включен целиком" width="154" controlType="UICheck" rows-limit="100" id="8606045" />
            <field table="fdr" name="pwrcname" title="ПС" width="316" controlType="UIText" rows-limit="100" id="15189453" />
            <field table="fdr" name="pwrc_fdr_explname" title="Экспл.отв" width="154" controlType="UIText" rows-limit="100" id="53046593" />
          </columns>
        </grid>
      </fieldgroup>
      <fieldgroup title="ТП" id="43037184">
        <grid table="tp" show-toolbar="1" show-checkbox="1" auto-filter="1" id="23603712">
          <toolbar id="15347451">
            <uicommand button-type="grid-add" visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="363" ord="363" leaf="1" lvl="2" pelid="" title="" id="48074246" />
            <uicommand button-type="grid-refresh" column-visible="0" name="grid-refresh" control-name="ButtonRefresh" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="366" ord="366" leaf="1" lvl="2" pelid="" title="" id="64907097" />
            <uicommand button-type="grid-delete" column-visible="0" name="grid-delete" control-name="ButtonDeleteRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="367" ord="367" leaf="1" lvl="2" pelid="" title="" id="17524095" />
            <uicommand button-type="grid-save" column-visible="0" name="grid-save" control-name="ButtonCommit" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="365" ord="365" leaf="1" lvl="2" pelid="" title="" id="56361815" />
            <uicommand action-type="dynamic-form-create-multiple" call="45862_vb_tp_change" modal="1" title="Привязать" editable="save_active" button-type="custom-add-form" name="custom-add-form" icon="AddForm_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="376" ord="376" leaf="1" lvl="2" pelid="" id="21186693">
              <useparam name="kod_nastr" id="34386202" />
              <useparam name="ym" id="10529388" />
            </uicommand>
            <uicommand action-type="custom" prompt="Вы уверены, что хотите отвязать выделенные ТП?" title="Отвязать отмеченные" editable="save_active" button-type="custom-delete" name="custom-delete" icon="Delete_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="379" ord="379" leaf="1" lvl="2" pelid="" id="20548854">
              <useaction action-type="client-remove-row" id="49152927" />
              <useaction action-type="save" object="tp" id="54968318" />
              <useaction title="Обновить настройки КГ" name="vb_kol_gr_pack.upd_kg_nastr" id="62208772">
                <useparam name="kod_nastr" id="27639749" />
                <useparam name="ym" id="55620564" />
              </useaction>
              <useaction title="Обновить имя КГ" name="vb_kol_gr_pack.upd_kg_name" id="60068434">
                <useparam name="kod_nastr" id="8730596" />
              </useaction>
              <useaction action-type="refresh-table" object="a" id="29510428" />
            </uicommand>
          </toolbar>
          <columns id="4243968">
            <field table="tp" name="srcname" title="ТП" width="232" controlType="UIText" rows-limit="100" id="8108549" />
            <field table="tp" name="pwrc_fdrname" title="Фидер" width="128" controlType="UIText" rows-limit="100" id="64116545" />
            <field table="tp" name="pwrcname" title="ПС" width="318" controlType="UIText" rows-limit="100" id="9285498" />
          </columns>
        </grid>
      </fieldgroup>
    </splitcontainer>
    <toolbar id="1352978">
      <uicommand button-type="form-save" visible="0" name="form-save" control-name="ButtonSave" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="371" ord="371" leaf="1" lvl="2" pelid="" title="" id="28388162" />
      <uicommand button-type="form-save-and-close" visible="0" name="form-save-and-close" control-name="ButtonSaveAndClose" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="372" ord="372" leaf="1" lvl="2" pelid="" title="" id="28177627" />
      <uicommand action-type="custom" button-type="custom-commit" editable="save_active" name="custom-commit" icon="Commit_24" title="Сохранить" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="378" ord="378" leaf="1" lvl="2" pelid="" id="11421372">
        <useaction action-type="save" id="17019260" />
        <useaction title="Обновить имя КГ" name="vb_kol_gr_pack.upd_kg_name" id="25590962">
          <useparam name="kod_nastr" id="29605562" />
        </useaction>
        <useaction action-type="close" id="14143752" />
      </uicommand>
    </toolbar>
  </form>
  <params>
    <param type="number" name="kod_nastr" />
    <param type="number" name="kod_fl" />
    <param type="number" name="ym" />
  </params>
  <dataset>
    <params>
      <param type="number" name="kod_nastr" />
      <param type="number" name="kod_fl" />
      <param type="number" name="ym" />
    </params>
    <fields>
      <field type="string" name="is_form_valid" parname="is_form_valid" />
      <field type="string" name="is_form_valid_not" parname="is_form_valid_not" />
      <field type="string" name="a_has_changes" parname="a_has_changes" />
      <field type="string" name="pwrc_has_changes" parname="pwrc_has_changes" />
      <field type="string" name="fdr_has_changes" parname="fdr_has_changes" />
      <field type="string" name="tp_has_changes" parname="tp_has_changes" />
      <field type="string" name="kg_edit_allow_flag_has_changes" parname="kg_edit_allow_flag_has_changes" />
    </fields>
    <table name="a" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multi-select-column="" multi-select-target="" update-target="vb_kol_gr_nastr" key="kod_kol_gr_nastr" is-ms-upd="1" is-top="1">
      <select-text>
--
select a.name_exp as name_exp, /*Наименование*//*string*/
a.kol_gr_comment as kol_gr_comment, /*Дополнение*//*string*/
a.kod_fl as kod_fl, /*Код филиала*//*number*/
a.s as s, /*Период с*//*number*/
a.is_not_new as is_not_new, /*number*/
kod_fl_x_n.name as kod_fl_x_n, /*Код филиала*//*string*/
s_x_n.name as s_x_n, /*Период с*//*string*/
a.is_new as is_new, /*number*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*number*//*key*/

from (
--vb_kol_gr_nastr
select a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
 case  when (a.name is null )  then '' else a.name end  as name_exp, /*Наименование*//*string*/
a.s as s, /*Период с*//*number*/
a.kod_fl as kod_fl, /*Код филиала*//*number*/
a.kol_gr_comment as kol_gr_comment, /*Дополнение*//*string*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from vb_kol_gr_nastr
a
--\vb_kol_gr_nastr
)
a
--\vb_kol_gr_nastr
left outer join
(
--spr_time_ym
select a.ym as ym, /*number*//*key*/
a.name as name/*Период*//*string*/

from (
--spr_time_ym_pre
select  to_number(to_char( a.dat_day ,'YYYYMM'))/100  as ym, /*number*//*key*/
max( trim(to_char( ( to_number(to_char( a.dat_day ,'YYYYMM'))/100 )  ,'9999.99')) )  as name/*Период*//*string*/

from vv_day
a
--\vv_day
 group by
 to_number(to_char( a.dat_day ,'YYYYMM'))/100 /*number*//*key*/

order by ym)
a
--\spr_time_ym_pre
)
s_x_n on a.s = s_x_n.ym--\spr_time_ym
left outer join
(
--jv_rep_cons_d_fl
select a.kod_fl as kod_fl, /*number*//*key*/
a.name as name/*Филиал*//*string*/

from jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
)
kod_fl_x_n on a.kod_fl = kod_fl_x_n.kod_fl--\jv_rep_cons_d_fl
where
a.kod_kol_gr_nastr = :kod_nastr --\
</select-text>
      <columns>
        <column name="name_exp" table="a" type="string" title="Наименование" ColumnEditable="0" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_kol_gr_nastr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_nastr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select a.name_exp as name_exp, /*Наименование*//*string*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*number*//*key*/

from (
--vb_kol_gr_nastr
select a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
 case  when (a.name is null )  then '' else a.name end  as name_exp/*Наименование*//*string*/

from (select a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.name as name  from vb_kol_gr_nastr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_kol_gr_nastr=t.f2 ) and   a.kod_kol_gr_nastr in :kod_kol_gr_nastr_prm   union all  select t.n3 as kod_kol_gr_nastr,t.s2 as name  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_nastr_prm )
a
--\(select a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.name as name  from vb_kol_gr_nastr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_kol_gr_nastr=t.f2 ) and   a.kod_kol_gr_nastr in :kod_kol_gr_nastr_prm   union all  select t.n3 as kod_kol_gr_nastr,t.s2 as name  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_nastr_prm )
)
a
--\vb_kol_gr_nastr
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="kol_gr_comment" table="a" type="string" title="Дополнение" ClientEditable="save_active" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kol_gr_comment" temp-col-name="s1" />
        <column name="kod_fl" table="a" type="number" title="Код филиала" ColumnVisible="0" ClientDefault="kod_fl" is-updateable="1" is-updateable-ext="1" update-target="kod_fl" temp-col-name="n1">
          <dep-refresh-cmd>
            <root table="a">
              <params>
                <param name="kod_kol_gr_nastr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_nastr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kod_fl_x_n.name as kod_fl_x_n, /*Код филиала*//*string*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*number*//*key*/

from (
--vb_kol_gr_nastr
select a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
a.kod_fl as kod_fl/*Код филиала*//*number*/

from (select a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.kod_fl as kod_fl  from vb_kol_gr_nastr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_kol_gr_nastr=t.f2 ) and   a.kod_kol_gr_nastr in :kod_kol_gr_nastr_prm   union all  select t.n3 as kod_kol_gr_nastr,t.n1 as kod_fl  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_nastr_prm )
a
--\(select a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.kod_fl as kod_fl  from vb_kol_gr_nastr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_kol_gr_nastr=t.f2 ) and   a.kod_kol_gr_nastr in :kod_kol_gr_nastr_prm   union all  select t.n3 as kod_kol_gr_nastr,t.n1 as kod_fl  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_nastr_prm )
)
a
--\vb_kol_gr_nastr
left outer join
(
--jv_rep_cons_d_fl
select a.kod_fl as kod_fl, /*number*//*key*/
a.name as name/*Филиал*//*string*/

from jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
)
kod_fl_x_n on a.kod_fl = kod_fl_x_n.kod_fl--\jv_rep_cons_d_fl
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </dep-refresh-cmd>
          <dependants>
            <dependant name="kod_fl_x_n" table="a" />
          </dependants>
        </column>
        <column name="s" table="a" type="number" title="Период с" ColumnVisible="0" ClientDefault="ym" is-updateable="1" is-updateable-ext="1" update-target="s" temp-col-name="n2">
          <dep-refresh-cmd>
            <root table="a">
              <params>
                <param name="kod_kol_gr_nastr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_nastr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select s_x_n.name as s_x_n, /*Период с*//*string*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*number*//*key*/

from (
--vb_kol_gr_nastr
select a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
a.s as s/*Период с*//*number*/

from (select a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.s as s  from vb_kol_gr_nastr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_kol_gr_nastr=t.f2 ) and   a.kod_kol_gr_nastr in :kod_kol_gr_nastr_prm   union all  select t.n3 as kod_kol_gr_nastr,t.n2 as s  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_nastr_prm )
a
--\(select a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.s as s  from vb_kol_gr_nastr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_kol_gr_nastr=t.f2 ) and   a.kod_kol_gr_nastr in :kod_kol_gr_nastr_prm   union all  select t.n3 as kod_kol_gr_nastr,t.n2 as s  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_nastr_prm )
)
a
--\vb_kol_gr_nastr
left outer join
(
--spr_time_ym
select a.ym as ym, /*number*//*key*/
a.name as name/*Период*//*string*/

from (
--spr_time_ym_pre
select  to_number(to_char( a.dat_day ,'YYYYMM'))/100  as ym, /*number*//*key*/
max( trim(to_char( ( to_number(to_char( a.dat_day ,'YYYYMM'))/100 )  ,'9999.99')) )  as name/*Период*//*string*/

from vv_day
a
--\vv_day
 group by
 to_number(to_char( a.dat_day ,'YYYYMM'))/100 /*number*//*key*/

order by ym)
a
--\spr_time_ym_pre
)
s_x_n on a.s = s_x_n.ym--\spr_time_ym
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </dep-refresh-cmd>
          <dependants>
            <dependant name="s_x_n" table="a" />
          </dependants>
        </column>
        <column name="is_not_new" table="a" type="number" title="" parname="is_not_new" ColumnVisible="0" />
        <column name="kod_fl_x_n" table="a.kod_fl" type="string" title="Код филиала" text-source-for="kod_fl" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_kol_gr_nastr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_nastr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select kod_fl_x_n.name as kod_fl_x_n, /*Код филиала*//*string*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*number*//*key*/

from (
--vb_kol_gr_nastr
select a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
a.kod_fl as kod_fl/*Код филиала*//*number*/

from (select a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.kod_fl as kod_fl  from vb_kol_gr_nastr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_kol_gr_nastr=t.f2 ) and   a.kod_kol_gr_nastr in :kod_kol_gr_nastr_prm   union all  select t.n3 as kod_kol_gr_nastr,t.n1 as kod_fl  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_nastr_prm )
a
--\(select a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.kod_fl as kod_fl  from vb_kol_gr_nastr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_kol_gr_nastr=t.f2 ) and   a.kod_kol_gr_nastr in :kod_kol_gr_nastr_prm   union all  select t.n3 as kod_kol_gr_nastr,t.n1 as kod_fl  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_nastr_prm )
)
a
--\vb_kol_gr_nastr
left outer join
(
--jv_rep_cons_d_fl
select a.kod_fl as kod_fl, /*number*//*key*/
a.name as name/*Филиал*//*string*/

from jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
)
kod_fl_x_n on a.kod_fl = kod_fl_x_n.kod_fl--\jv_rep_cons_d_fl
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="s_x_n" table="a.s" type="string" title="Период с" text-source-for="s" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_kol_gr_nastr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_nastr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select s_x_n.name as s_x_n, /*Период с*//*string*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*number*//*key*/

from (
--vb_kol_gr_nastr
select a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
a.s as s/*Период с*//*number*/

from (select a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.s as s  from vb_kol_gr_nastr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_kol_gr_nastr=t.f2 ) and   a.kod_kol_gr_nastr in :kod_kol_gr_nastr_prm   union all  select t.n3 as kod_kol_gr_nastr,t.n2 as s  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_nastr_prm )
a
--\(select a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.s as s  from vb_kol_gr_nastr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_kol_gr_nastr=t.f2 ) and   a.kod_kol_gr_nastr in :kod_kol_gr_nastr_prm   union all  select t.n3 as kod_kol_gr_nastr,t.n2 as s  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_nastr_prm )
)
a
--\vb_kol_gr_nastr
left outer join
(
--spr_time_ym
select a.ym as ym, /*number*//*key*/
a.name as name/*Период*//*string*/

from (
--spr_time_ym_pre
select  to_number(to_char( a.dat_day ,'YYYYMM'))/100  as ym, /*number*//*key*/
max( trim(to_char( ( to_number(to_char( a.dat_day ,'YYYYMM'))/100 )  ,'9999.99')) )  as name/*Период*//*string*/

from vv_day
a
--\vv_day
 group by
 to_number(to_char( a.dat_day ,'YYYYMM'))/100 /*number*//*key*/

order by ym)
a
--\spr_time_ym_pre
)
s_x_n on a.s = s_x_n.ym--\spr_time_ym
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="is_new" table="a" type="number" title="" is-user-editable="1" />
        <column name="kod_kol_gr_nastr" table="a" type="number" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kod_kol_gr_nastr" temp-col-name="n3" />
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:kol_gr_comment as kol_gr_comment 
,:kod_fl as kod_fl 
,:s as s 
,:kod_kol_gr_nastr as kod_kol_gr_nastr 
 
from dual ) 
 
loop 
insert into vb_kol_gr_nastr 
(kol_gr_comment 
,kod_fl 
,s 
,kod_kol_gr_nastr 
) 
 values  
(r.kol_gr_comment 
,r.kod_fl 
,r.s 
,r.kod_kol_gr_nastr 
) 
 returning  
kod_kol_gr_nastr into :kod_kol_gr_nastr; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from vb_kol_gr_nastr where kod_kol_gr_nastr=:kod_kol_gr_nastr</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='a' 
and 
names=:form_id 
and 
f2=:kod_kol_gr_nastr; 
if :row_state_id=1  then 
for r in  
 ( select  
:kol_gr_comment as kol_gr_comment 
,:kod_fl as kod_fl 
,:s as s 
,:kod_kol_gr_nastr as kod_kol_gr_nastr 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,s1 
,n1 
,n2 
,n3 
) 
 values  
('a' 
,:form_id 
,:kod_kol_gr_nastr 
,:row_state_id 
,r.kol_gr_comment 
,r.kod_fl 
,r.s 
,r.kod_kol_gr_nastr 
); 
end loop; 
else 
for r in  
 ( select  
:kol_gr_comment as kol_gr_comment 
,:kod_fl as kod_fl 
,:s as s 
,:kod_kol_gr_nastr as kod_kol_gr_nastr 
,a.kod_kol_gr 
,a.name 
,a.po 
,a.u_m 
,a.d_m 
,a.is_auto_kg 
 
from vb_kol_gr_nastr a  where kod_kol_gr_nastr=:kod_kol_gr_nastr) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,s1 
,n1 
,n2 
,n3 
,n4 
,s2 
,n5 
,s3 
,d1 
,n6 
) 
 values  
('a' 
,:form_id 
,:kod_kol_gr_nastr 
,:row_state_id 
,r.kol_gr_comment 
,r.kod_fl 
,r.s 
,r.kod_kol_gr_nastr 
,r.kod_kol_gr 
,r.name 
,r.po 
,r.u_m 
,r.d_m 
,r.is_auto_kg 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='a' and names=:form_id</clear-temp-text>
      <update-text>begin
update vb_kol_gr_nastr set  
(kol_gr_comment 
,kod_fl 
,s 
,kod_kol_gr_nastr 
) 
= 
 ( select  
:kol_gr_comment as kol_gr_comment 
,:kod_fl as kod_fl 
,:s as s 
,:kod_kol_gr_nastr as kod_kol_gr_nastr 
 
from dual ) 
 
where 
kod_kol_gr_nastr=:kod_kol_gr_nastr 
;
end;
</update-text>
      <scheme>
        <table name="vb_kol_gr_nastr" as="a">
          <columns>
            <column name="name_exp" type="string" title="Наименование" />
            <column name="kol_gr_comment" type="string" title="Дополнение" />
            <column name="kod_fl" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="s" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" title="" visible="0" />
            <column name="kod_fl_x_n" type="string" title="Код филиала" visible="0" />
            <column name="s_x_n" type="string" title="Период с" visible="0" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_nastr" type="number" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns />
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="kod_kol_gr_nastr_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="kod_kol_gr_nastr_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select a.name_exp as name_exp, /*Наименование*//*string*/
a.kol_gr_comment as kol_gr_comment, /*Дополнение*//*string*/
a.kod_fl as kod_fl, /*Код филиала*//*number*/
a.s as s, /*Период с*//*number*/
a.is_not_new as is_not_new, /*number*/
kod_fl_x_n.name as kod_fl_x_n, /*Код филиала*//*string*/
s_x_n.name as s_x_n, /*Период с*//*string*/
a.is_new as is_new, /*number*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*number*//*key*/

from (
--vb_kol_gr_nastr
select a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
 case  when (a.name is null )  then '' else a.name end  as name_exp, /*Наименование*//*string*/
a.s as s, /*Период с*//*number*/
a.kod_fl as kod_fl, /*Код филиала*//*number*/
a.kol_gr_comment as kol_gr_comment, /*Дополнение*//*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.name as name,a.s as s,a.kod_fl as kod_fl,a.kol_gr_comment as kol_gr_comment,0 as is_new,1 as is_not_new  from vb_kol_gr_nastr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_kol_gr_nastr=t.f2 ) and   a.kod_kol_gr_nastr in :kod_kol_gr_nastr_prm   union all  select t.n3 as kod_kol_gr_nastr,t.s2 as name,t.n2 as s,t.n1 as kod_fl,t.s1 as kol_gr_comment,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_nastr_prm )
a
--\(select a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.name as name,a.s as s,a.kod_fl as kod_fl,a.kol_gr_comment as kol_gr_comment,0 as is_new,1 as is_not_new  from vb_kol_gr_nastr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_kol_gr_nastr=t.f2 ) and   a.kod_kol_gr_nastr in :kod_kol_gr_nastr_prm   union all  select t.n3 as kod_kol_gr_nastr,t.s2 as name,t.n2 as s,t.n1 as kod_fl,t.s1 as kol_gr_comment,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_nastr_prm )
)
a
--\vb_kol_gr_nastr
left outer join
(
--spr_time_ym
select a.ym as ym, /*number*//*key*/
a.name as name/*Период*//*string*/

from (
--spr_time_ym_pre
select  to_number(to_char( a.dat_day ,'YYYYMM'))/100  as ym, /*number*//*key*/
max( trim(to_char( ( to_number(to_char( a.dat_day ,'YYYYMM'))/100 )  ,'9999.99')) )  as name/*Период*//*string*/

from vv_day
a
--\vv_day
 group by
 to_number(to_char( a.dat_day ,'YYYYMM'))/100 /*number*//*key*/

order by ym)
a
--\spr_time_ym_pre
)
s_x_n on a.s = s_x_n.ym--\spr_time_ym
left outer join
(
--jv_rep_cons_d_fl
select a.kod_fl as kod_fl, /*number*//*key*/
a.name as name/*Филиал*//*string*/

from jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
)
kod_fl_x_n on a.kod_fl = kod_fl_x_n.kod_fl--\jv_rep_cons_d_fl
--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
    <table name="pwrc" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multi-select-column="" multi-select-target="" update-target="vb_kol_gr_pwrc" column-editable="0" key="kod_kol_gr_pwrc" parent-table="a" parent-key="kod_kol_gr_nastr" is-ms-upd="1">
      <select-text>
--
select pwrc_id.pwrcname as pwrcname, /*ПС*//*string*/
pwrc.is_new as is_new, /*number*/
pwrc.is_not_new as is_not_new, /*number*/
pwrc.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
pwrc.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from (
--vb_kol_gr_pwrc
select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*Код настройки кольцевой группы*//*number*/
a.pwrc_id as pwrc_id, /*Код ПС*//*number*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from vb_kol_gr_pwrc
a
--\vb_kol_gr_pwrc
)
pwrc
--\vb_kol_gr_pwrc
left outer join
(
--hv_eopwrc_g
select a.pwrc_id as pwrc_id, /**//*number*//*key*/
max(a.pwrcname)  as pwrcname/*string*/

from (
--hv_eopwrc
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcname/**//*string*/

from (
--hv_eopwrc_istest_0
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcname/**//*string*/

from (
--hv_eopwrc_full
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcname, /**//*string*/
a.is_test as is_test/**//*number*/

from hv_eopwrc
a
--\hv_eopwrc
)
a
--\hv_eopwrc_full
where
a.is_test = 0)
a
--\hv_eopwrc_istest_0
)
a
--\hv_eopwrc
 group by
a.pwrc_id/**//*number*//*key*/
)
pwrc_id on pwrc.pwrc_id = pwrc_id.pwrc_id--\hv_eopwrc_g
where
pwrc.kod_kol_gr_nastr = :fk_kod_kol_gr_nastr 
order by pwrcname--\
</select-text>
      <columns>
        <column name="pwrcname" table="pwrc_id" type="string" title="ПС" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_kol_gr_pwrc_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_pwrc_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select pwrc_id.pwrcname as pwrcname, /*ПС*//*string*/
pwrc.kod_kol_gr_pwrc as kod_kol_gr_pwrc/*number*//*key*/

from (
--vb_kol_gr_pwrc
select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
a.pwrc_id as pwrc_id/*Код ПС*//*number*/

from (select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc,a.pwrc_id as pwrc_id  from vb_kol_gr_pwrc a where not exists (select * from rr_temp t where t.skod ='pwrc' and t.names=:form_id  and a.kod_kol_gr_pwrc=t.f2 ) and   a.kod_kol_gr_pwrc in :kod_kol_gr_pwrc_prm   union all  select t.n1 as kod_kol_gr_pwrc,t.n3 as pwrc_id  from rr_temp t where t.skod ='pwrc' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_pwrc_prm )
a
--\(select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc,a.pwrc_id as pwrc_id  from vb_kol_gr_pwrc a where not exists (select * from rr_temp t where t.skod ='pwrc' and t.names=:form_id  and a.kod_kol_gr_pwrc=t.f2 ) and   a.kod_kol_gr_pwrc in :kod_kol_gr_pwrc_prm   union all  select t.n1 as kod_kol_gr_pwrc,t.n3 as pwrc_id  from rr_temp t where t.skod ='pwrc' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_pwrc_prm )
)
pwrc
--\vb_kol_gr_pwrc
left outer join
(
--hv_eopwrc_g
select a.pwrc_id as pwrc_id, /**//*number*//*key*/
max(a.pwrcname)  as pwrcname/*string*/

from (
--hv_eopwrc
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcname/**//*string*/

from (
--hv_eopwrc_istest_0
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcname/**//*string*/

from (
--hv_eopwrc_full
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcname, /**//*string*/
a.is_test as is_test/**//*number*/

from hv_eopwrc
a
--\hv_eopwrc
)
a
--\hv_eopwrc_full
where
a.is_test = 0)
a
--\hv_eopwrc_istest_0
)
a
--\hv_eopwrc
 group by
a.pwrc_id/**//*number*//*key*/
)
pwrc_id on pwrc.pwrc_id = pwrc_id.pwrc_id--\hv_eopwrc_g
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="is_new" table="pwrc" type="number" title="" is-user-editable="1" />
        <column name="is_not_new" table="pwrc" type="number" title="" is-user-editable="1" />
        <column name="kod_kol_gr_pwrc" table="pwrc" type="number" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kod_kol_gr_pwrc" temp-col-name="n1" />
        <column name="kod_kol_gr_nastr" table="pwrc" type="number" title="Код настройки кольцевой группы" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kod_kol_gr_nastr" temp-col-name="n2">
          <sel-list-compiled>
            <root>
              <query class="1" timestamp="03.10.2022 13:41:40" file="sql.builder.templates\sql.builder\projects\asuse2_scheme\scheme\original\vb_kol_gr_nastr.xml" elid="3033" ord="3033" leaf="0" lvl="2" pelid="" haskeys="1" name="a" as="a" noname="1" path="./a" used="1">
                <select>--a
select <column table="a" column="kod_kol_gr_nastr" as="kod_kol_gr_nastr" title="" key="1" used="1" type="number" sourcetable="./a/a" sourcecolumn="kod_kol_gr_nastr" into="n1">a.kod_kol_gr_nastr as kod_kol_gr_nastr, /**//*number*//*key*/
</column><column table="a" column="kod_kol_gr" as="kod_kol_gr" title="Код кольцевой группы" key="0" used="1" type="number" sourcetable="./a/a" sourcecolumn="kod_kol_gr" reference="vb_kol_gr" refcol="kod_kol_gr" into="n2">a.kod_kol_gr as kod_kol_gr, /*Код кольцевой группы*//*number*/
</column><column table="kod_kol_gr" column="name" as="kod_kol_gr_x_n" title="Код кольцевой группы" key="0" used="1" type="string" sourcetable="./a/kod_kol_gr" sourcecolumn="name" into="s1">kod_kol_gr.name as kod_kol_gr_x_n, /*Код кольцевой группы*//*string*/
</column><column table="a" column="name" as="name" title="Наименование" key="0" used="1" type="string" sourcetable="./a/a" sourcecolumn="name" into="s2">a.name as name, /*Наименование*//*string*/
</column><column table="a" column="name_exp" as="name_exp" title="Наименование" key="0" used="1" type="string" into="s3">a.name_exp as name_exp, /*Наименование*//*string*/
</column><column table="a" column="s" as="s" title="Период с" key="0" used="1" type="number" sourcetable="./a/a" sourcecolumn="s" into="n3">a.s as s, /*Период с*//*number*/
</column><column table="s" column="name" as="s_x_n" title="Период с" key="0" used="1" type="string" into="s4">s.name as s_x_n, /*Период с*//*string*/
</column><column table="a" column="po" as="po" title="Период по" key="0" used="1" type="number" sourcetable="./a/a" sourcecolumn="po" into="n4">a.po as po, /*Период по*//*number*/
</column><column table="po" column="name" as="po_x_n" title="Период по" key="0" used="1" type="string" into="s5">po.name as po_x_n, /*Период по*//*string*/
</column><column table="a" column="kod_fl" as="kod_fl" title="Код филиала" key="0" used="1" type="number" sourcetable="./a/a" sourcecolumn="kod_fl" reference="jv_rep_cons_d_fl" refcol="kod_fl" into="n5">a.kod_fl as kod_fl, /*Код филиала*//*number*/
</column><column table="kod_fl" column="name" as="kod_fl_x_n" title="Код филиала" key="0" used="1" type="string" sourcetable="./a/kod_fl" sourcecolumn="name" into="s6">kod_fl.name as kod_fl_x_n, /*Код филиала*//*string*/
</column><column table="a" column="kol_gr_comment" as="kol_gr_comment" title="Дополнение" key="0" used="1" type="string" sourcetable="./a/a" sourcecolumn="kol_gr_comment" into="s7">a.kol_gr_comment as kol_gr_comment/*Дополнение*//*string*/
</column></select>
                <from>
from <query name="vb_kol_gr_nastr" as="a" path="./a/a" haskeys="1" used="1">(
<select>--vb_kol_gr_nastr
select <column type="number" table="a" column="kod_kol_gr_nastr" key="1" as="kod_kol_gr_nastr" sourcetable="./a/a" sourcecolumn="kod_kol_gr_nastr" used="1">a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
</column><column type="number" table="a" column="kod_kol_gr" title="Код кольцевой группы" as="kod_kol_gr" reference="vb_kol_gr" refcol="kod_kol_gr" key="0" sourcetable="./a/a" sourcecolumn="kod_kol_gr" used="1">a.kod_kol_gr as kod_kol_gr, /*Код кольцевой группы*//*number*/
</column><column type="string" table="a" column="name" data-size="4000" title="Наименование" as="name" key="0" sourcetable="./a/a" sourcecolumn="name" used="1">a.name as name, /*Наименование*//*string*/
</column><call function="if" type="string" as="name_exp" pth="" key="0" used="1" title="Наименование"><text txtype="func"> case </text><text txtype="func"> when </text><call function="is null" pth="" type="bool">(<column type="string" table="a" column="name" data-size="4000" title="Наименование" as="name" thissrc="name">a.name</column><text txtype="func"> is null </text>) </call><text txtype="func"> then </text><const comment="хотел поставит замещающий текст но передумал"><text>''</text></const><text txtype="func"> else </text><column type="string" table="a" column="name" data-size="4000" title="Наименование" as="name" thissrc="name">a.name</column><text txtype="func"> end </text> as name_exp, /*Наименование*//*string*/
</call><column type="number" table="a" column="s" title="Период с" as="s" key="0" sourcetable="./a/a" sourcecolumn="s" used="1">a.s as s, /*Период с*//*number*/
</column><column type="number" table="a" column="po" title="Период по" as="po" key="0" sourcetable="./a/a" sourcecolumn="po" used="1">a.po as po, /*Период по*//*number*/
</column><column type="number" table="a" column="kod_fl" title="Код филиала" as="kod_fl" reference="jv_rep_cons_d_fl" refcol="kod_fl" key="0" sourcetable="./a/a" sourcecolumn="kod_fl" used="1">a.kod_fl as kod_fl, /*Код филиала*//*number*/
</column><column table="a" column="kol_gr_comment" type="string" title="Дополнение" as="kol_gr_comment" key="0" sourcetable="./a/a" sourcecolumn="kol_gr_comment" used="1">a.kol_gr_comment as kol_gr_comment/*Дополнение*//*string*/
</column></select><from>
from <table name="vb_kol_gr_nastr" as="a" used="1">vb_kol_gr_nastr
a
--\vb_kol_gr_nastr
</table></from>)
a
--\vb_kol_gr_nastr
</query><query name="jv_rep_cons_d_fl" as="kod_fl" join="left outer" path="./a/kod_fl" order="a.name" haskeys="1" used="1">left outer join
(
<order notext="1"><column column="a.name">a.name</column></order><select>--jv_rep_cons_d_fl
select <column table="a" column="kod_fl" type="number" as="kod_fl" key="1" fixed="1" sourcetable="./a/kod_fl" sourcecolumn="kod_fl" used="1">a.kod_fl as kod_fl, /*number*//*key*/
</column><column table="a" column="name" type="string" title="Филиал" is-name="1" vid="1" as="name" key="0" sourcetable="./a/kod_fl" sourcecolumn="name" used="1">a.name as name/*Филиал*//*string*/
</column></select><from>
from <table name="jv_rep_cons_d_fl" as="a" title="изм1: Код филиала" used="1">jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
</table></from><call function="=" type="bool">)
kod_fl on <column table="a" column="kod_fl">a.kod_fl</column><text txtype="func"> = </text><column table="kod_fl" column="kod_fl">kod_fl.kod_fl</column></call>--\jv_rep_cons_d_fl
</query><query name="spr_time_ym" as="po" join="left outer" path="./a/po" order="ym desc" haskeys="1" used="1">left outer join
(
<order notext="1"><column column="ym">ym</column></order><select>--spr_time_ym
select <column table="a" column="ym" key="1" as="ym" used="1" type="number">a.ym as ym, /*number*//*key*/
</column><column table="a" column="name" vid="1" is-name="1" as="name" key="0" used="1" type="string" title="Период">a.name as name/*Период*//*string*/
</column></select><from>
from <query name="spr_time_ym_pre" as="a" path="./a/po/a" order="ym" haskeys="1" used="1">(
<order notext="1"><column column="ym">ym</column></order><select>--spr_time_ym_pre
select <call function="date to ym" as="ym" key="1" group="1" pth="" type="number" used="1"><text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text> as ym, /*number*//*key*/
</call><call function="ym to char" as="name" title="Период" key="0" group="max" pth="" type="string" used="1">max(<text txtype="func"> trim(to_char( </text><call function="date to ym" as="ym" key="1" pth="" type="number" thissrc="ym">(<text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text>) </call><text txtype="func"> ,'9999.99')) </text>)  as name/*Период*//*string*/
</call></select><from>
from <table name="vv_day" as="a" used="1">vv_day
a
--\vv_day
</table></from><group> group by
<call function="date to ym" as="ym" key="1" group="1" pth="" type="number" used="1"><text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text>/*number*//*key*/
</call></group><order>
order by ym</order>)
a
--\spr_time_ym_pre
</query></from><call function="=" type="bool">)
po on <column table="po" column="ym">po.ym</column><text txtype="func"> = </text><column table="a" column="po">a.po</column></call>--\spr_time_ym
</query><query name="spr_time_ym" as="s" join="left outer" path="./a/s" order="ym desc" haskeys="1" used="1">left outer join
(
<order notext="1"><column column="ym">ym</column></order><select>--spr_time_ym
select <column table="a" column="ym" key="1" as="ym" used="1" type="number">a.ym as ym, /*number*//*key*/
</column><column table="a" column="name" vid="1" is-name="1" as="name" key="0" used="1" type="string" title="Период">a.name as name/*Период*//*string*/
</column></select><from>
from <query name="spr_time_ym_pre" as="a" path="./a/s/a" order="ym" haskeys="1" used="1">(
<order notext="1"><column column="ym">ym</column></order><select>--spr_time_ym_pre
select <call function="date to ym" as="ym" key="1" group="1" pth="" type="number" used="1"><text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text> as ym, /*number*//*key*/
</call><call function="ym to char" as="name" title="Период" key="0" group="max" pth="" type="string" used="1">max(<text txtype="func"> trim(to_char( </text><call function="date to ym" as="ym" key="1" pth="" type="number" thissrc="ym">(<text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text>) </call><text txtype="func"> ,'9999.99')) </text>)  as name/*Период*//*string*/
</call></select><from>
from <table name="vv_day" as="a" used="1">vv_day
a
--\vv_day
</table></from><group> group by
<call function="date to ym" as="ym" key="1" group="1" pth="" type="number" used="1"><text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text>/*number*//*key*/
</call></group><order>
order by ym</order>)
a
--\spr_time_ym_pre
</query></from><call function="=" type="bool">)
s on <column table="a" column="s">a.s</column><text txtype="func"> = </text><column table="s" column="ym">s.ym</column></call>--\spr_time_ym
</query><query name="vb_kol_gr" as="kod_kol_gr" join="left outer" path="./a/kod_kol_gr" order="kod_kol_gr" haskeys="1" used="1">left outer join
(
<order notext="1"><column column="kod_kol_gr">kod_kol_gr</column></order><select>--vb_kol_gr
select <column type="number" table="a" column="kod_kol_gr" key="1" as="kod_kol_gr" sourcetable="./a/kod_kol_gr" sourcecolumn="kod_kol_gr" used="1">a.kod_kol_gr as kod_kol_gr, /*number*//*key*/
</column><column type="string" table="a" column="name" data-size="4000" title="Наименование" as="name" key="0" sourcetable="./a/kod_kol_gr" sourcecolumn="name" used="1">a.name as name/*Наименование*//*string*/
</column></select><from>
from <table name="vb_kol_gr" as="a" used="1">vb_kol_gr
a
--\vb_kol_gr
</table></from><call function="=" type="bool">)
kod_kol_gr on <column table="a" column="kod_kol_gr">a.kod_kol_gr</column><text txtype="func"> = </text><column table="kod_kol_gr" column="kod_kol_gr">kod_kol_gr.kod_kol_gr</column></call>--\vb_kol_gr
</query></from>
                <where>where
<call function="and" pth="" type="bool"><call function="le" pth="" type="bool">(<call function="rownum" pth="0" type="number"><text txtype="func"> rownum </text></call><text txtype="func"> &lt;= </text><const><text>:p_rows_limit </text></const>) </call><text txtype="func"> { </text><text txtype="func"> and </text><call function="in" pth="" optional="1" type="bool">(<column table="a" column="kod_kol_gr_nastr" as="kod_kol_gr_nastr" title="" key="1" thissrc="kod_kol_gr_nastr">a.kod_kol_gr_nastr</column><text txtype="func"> in </text><const><text>:pk_prm </text></const>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kod_kol_gr_nastr" as="kod_kol_gr_nastr" title="" key="1" thissrc="kod_kol_gr_nastr">a.kod_kol_gr_nastr</column><text txtype="func"> ) like lower( </text><const><text>:kod_kol_gr_nastr_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kod_kol_gr" as="kod_kol_gr" title="Код кольцевой группы" thissrc="kod_kol_gr">a.kod_kol_gr</column><text txtype="func"> ) like lower( </text><const><text>:kod_kol_gr_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="kod_kol_gr" column="name" as="kod_kol_gr_x_n" title="Код кольцевой группы" thissrc="kod_kol_gr_x_n">kod_kol_gr.name</column><text txtype="func"> ) like lower( </text><const><text>:kod_kol_gr_x_n_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="name" as="name" title="Наименование" thissrc="name">a.name</column><text txtype="func"> ) like lower( </text><const><text>:name_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="name_exp" as="name_exp" title="Наименование" thissrc="name_exp">a.name_exp</column><text txtype="func"> ) like lower( </text><const><text>:name_exp_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="s" as="s" title="Период с" thissrc="s">a.s</column><text txtype="func"> ) like lower( </text><const><text>:s_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="s" column="name" as="s_x_n" title="Период с" thissrc="s_x_n">s.name</column><text txtype="func"> ) like lower( </text><const><text>:s_x_n_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="po" as="po" title="Период по" thissrc="po">a.po</column><text txtype="func"> ) like lower( </text><const><text>:po_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="po" column="name" as="po_x_n" title="Период по" thissrc="po_x_n">po.name</column><text txtype="func"> ) like lower( </text><const><text>:po_x_n_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kod_fl" as="kod_fl" title="Код филиала" thissrc="kod_fl">a.kod_fl</column><text txtype="func"> ) like lower( </text><const><text>:kod_fl_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="kod_fl" column="name" as="kod_fl_x_n" title="Код филиала" thissrc="kod_fl_x_n">kod_fl.name</column><text txtype="func"> ) like lower( </text><const><text>:kod_fl_x_n_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kol_gr_comment" as="kol_gr_comment" title="Дополнение" thissrc="kol_gr_comment">a.kol_gr_comment</column><text txtype="func"> ) like lower( </text><const><text>:kol_gr_comment_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text></call></where>--\a
</query>
            </root>
          </sel-list-compiled>
          <sel-list-report>
            <report name="a" class="1" timestamp="03.10.2022 13:41:40" file="sql.builder.templates\sql.builder\projects\asuse2_scheme\scheme\original\vb_kol_gr_nastr.xml" elid="3033" ord="3033" leaf="0" lvl="2" pelid="" haskeys="1" as="a">
              <queries>
                <query class="1" timestamp="03.10.2022 13:41:40" file="sql.builder.templates\sql.builder\projects\asuse2_scheme\scheme\original\vb_kol_gr_nastr.xml" elid="3033" ord="3033" leaf="0" lvl="2" pelid="" haskeys="1" name="a" as="a">
                  <params>
                    <param name="pk_prm" type="array" />
                    <param name="kod_kol_gr_nastr_filter" type="string" />
                    <param name="kod_kol_gr_filter" type="string" />
                    <param name="kod_kol_gr_x_n_filter" type="string" />
                    <param name="name_filter" type="string" />
                    <param name="name_exp_filter" type="string" />
                    <param name="s_filter" type="string" />
                    <param name="s_x_n_filter" type="string" />
                    <param name="po_filter" type="string" />
                    <param name="po_x_n_filter" type="string" />
                    <param name="kod_fl_filter" type="string" />
                    <param name="kod_fl_x_n_filter" type="string" />
                    <param name="kol_gr_comment_filter" type="string" />
                    <param name="p_rows_limit" type="number" />
                  </params>
                  <select>
                    <column table="a" column="kod_kol_gr_nastr" as="kod_kol_gr_nastr" title="" key="1" />
                    <column table="a" column="kod_kol_gr" as="kod_kol_gr" title="Код кольцевой группы" />
                    <column table="kod_kol_gr" column="name" as="kod_kol_gr_x_n" title="Код кольцевой группы" />
                    <column table="a" column="name" as="name" title="Наименование" />
                    <column table="a" column="name_exp" as="name_exp" title="Наименование" />
                    <column table="a" column="s" as="s" title="Период с" />
                    <column table="s" column="name" as="s_x_n" title="Период с" />
                    <column table="a" column="po" as="po" title="Период по" />
                    <column table="po" column="name" as="po_x_n" title="Период по" />
                    <column table="a" column="kod_fl" as="kod_fl" title="Код филиала" />
                    <column table="kod_fl" column="name" as="kod_fl_x_n" title="Код филиала" />
                    <column table="a" column="kol_gr_comment" as="kol_gr_comment" title="Дополнение" />
                  </select>
                  <from>
                    <query name="vb_kol_gr_nastr" as="a">
                      <link name="kod_kol_gr" as="kod_kol_gr" table="vb_kol_gr" child="vb_kol_gr_nastr" field="kod_kol_gr" parent="vb_kol_gr" back="vb_kol_gr_nastr" />
                      <link name="s" as="s" table="spr_time_ym" child="vb_kol_gr_nastr" field="s" parent="spr_time_ym" back="vb_kol_gr_nastr" />
                      <link name="po" as="po" table="spr_time_ym" child="vb_kol_gr_nastr" field="po" parent="spr_time_ym" back="vb_kol_gr_nastr" />
                      <link name="kod_fl" as="kod_fl" table="jv_rep_cons_d_fl" child="vb_kol_gr_nastr" field="kod_fl" parent="jv_rep_cons_d_fl" back="vb_kol_gr_nastr" title="изм1: Код филиала" />
                    </query>
                  </from>
                  <where>
                    <call function="and">
                      <call function="le">
                        <call function="rownum" />
                        <useparam name="p_rows_limit" />
                      </call>
                      <call function="in" optional="1">
                        <column table="this" column="kod_kol_gr_nastr" />
                        <useparam name="pk_prm" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_kol_gr_nastr" />
                        <useparam name="kod_kol_gr_nastr_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_kol_gr" />
                        <useparam name="kod_kol_gr_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_kol_gr_x_n" />
                        <useparam name="kod_kol_gr_x_n_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="name" />
                        <useparam name="name_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="name_exp" />
                        <useparam name="name_exp_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="s" />
                        <useparam name="s_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="s_x_n" />
                        <useparam name="s_x_n_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="po" />
                        <useparam name="po_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="po_x_n" />
                        <useparam name="po_x_n_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_fl" />
                        <useparam name="kod_fl_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_fl_x_n" />
                        <useparam name="kod_fl_x_n_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kol_gr_comment" />
                        <useparam name="kol_gr_comment_filter" />
                      </call>
                    </call>
                  </where>
                  <withparams>
                    <useparam name="pk_prm" />
                    <useparam name="kod_kol_gr_nastr_filter" />
                    <useparam name="kod_kol_gr_filter" />
                    <useparam name="kod_kol_gr_x_n_filter" />
                    <useparam name="name_filter" />
                    <useparam name="name_exp_filter" />
                    <useparam name="s_filter" />
                    <useparam name="s_x_n_filter" />
                    <useparam name="po_filter" />
                    <useparam name="po_x_n_filter" />
                    <useparam name="kod_fl_filter" />
                    <useparam name="kod_fl_x_n_filter" />
                    <useparam name="kol_gr_comment_filter" />
                    <useparam name="p_rows_limit" />
                  </withparams>
                </query>
              </queries>
              <params>
                <param name="pk_prm" type="array">
                  <const>:pk_prm </const>
                </param>
                <param name="kod_kol_gr_nastr_filter" type="string">
                  <const>:kod_kol_gr_nastr_filter </const>
                </param>
                <param name="kod_kol_gr_filter" type="string">
                  <const>:kod_kol_gr_filter </const>
                </param>
                <param name="kod_kol_gr_x_n_filter" type="string">
                  <const>:kod_kol_gr_x_n_filter </const>
                </param>
                <param name="name_filter" type="string">
                  <const>:name_filter </const>
                </param>
                <param name="name_exp_filter" type="string">
                  <const>:name_exp_filter </const>
                </param>
                <param name="s_filter" type="string">
                  <const>:s_filter </const>
                </param>
                <param name="s_x_n_filter" type="string">
                  <const>:s_x_n_filter </const>
                </param>
                <param name="po_filter" type="string">
                  <const>:po_filter </const>
                </param>
                <param name="po_x_n_filter" type="string">
                  <const>:po_x_n_filter </const>
                </param>
                <param name="kod_fl_filter" type="string">
                  <const>:kod_fl_filter </const>
                </param>
                <param name="kod_fl_x_n_filter" type="string">
                  <const>:kod_fl_x_n_filter </const>
                </param>
                <param name="kol_gr_comment_filter" type="string">
                  <const>:kol_gr_comment_filter </const>
                </param>
                <param name="p_rows_limit" type="number">
                  <const>:p_rows_limit </const>
                </param>
              </params>
            </report>
          </sel-list-report>
          <sel-list-pars>
            <params />
          </sel-list-pars>
        </column>
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:kod_kol_gr_pwrc as kod_kol_gr_pwrc 
,:kod_kol_gr_nastr as kod_kol_gr_nastr 
 
from dual ) 
 
loop 
insert into vb_kol_gr_pwrc 
(kod_kol_gr_pwrc 
,kod_kol_gr_nastr 
) 
 values  
(r.kod_kol_gr_pwrc 
,r.kod_kol_gr_nastr 
) 
 returning  
kod_kol_gr_pwrc into :kod_kol_gr_pwrc; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from vb_kol_gr_pwrc where kod_kol_gr_pwrc=:kod_kol_gr_pwrc</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='pwrc' 
and 
names=:form_id 
and 
f2=:kod_kol_gr_pwrc; 
if :row_state_id=1  then 
for r in  
 ( select  
:kod_kol_gr_pwrc as kod_kol_gr_pwrc 
,:kod_kol_gr_nastr as kod_kol_gr_nastr 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,n2 
) 
 values  
('pwrc' 
,:form_id 
,:kod_kol_gr_pwrc 
,:row_state_id 
,r.kod_kol_gr_pwrc 
,r.kod_kol_gr_nastr 
); 
end loop; 
else 
for r in  
 ( select  
:kod_kol_gr_pwrc as kod_kol_gr_pwrc 
,:kod_kol_gr_nastr as kod_kol_gr_nastr 
,a.pwrc_id 
,a.u_m 
,a.d_m 
 
from vb_kol_gr_pwrc a  where kod_kol_gr_pwrc=:kod_kol_gr_pwrc) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,n2 
,n3 
,s1 
,d1 
) 
 values  
('pwrc' 
,:form_id 
,:kod_kol_gr_pwrc 
,:row_state_id 
,r.kod_kol_gr_pwrc 
,r.kod_kol_gr_nastr 
,r.pwrc_id 
,r.u_m 
,r.d_m 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='pwrc' and names=:form_id</clear-temp-text>
      <update-text>begin
update vb_kol_gr_pwrc set  
(kod_kol_gr_pwrc 
,kod_kol_gr_nastr 
) 
= 
 ( select  
:kod_kol_gr_pwrc as kod_kol_gr_pwrc 
,:kod_kol_gr_nastr as kod_kol_gr_nastr 
 
from dual ) 
 
where 
kod_kol_gr_pwrc=:kod_kol_gr_pwrc 
;
end;
</update-text>
      <scheme>
        <table name="vb_kol_gr_pwrc" as="pwrc">
          <columns>
            <column name="pwrcname" type="string" title="ПС" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_pwrc" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_nastr" type="number" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <column name="pwrcname" type="string" title="ПС" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_pwrc" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_nastr" type="number" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="kod_kol_gr_pwrc_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="kod_kol_gr_pwrc_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select pwrc_id.pwrcname as pwrcname, /*ПС*//*string*/
pwrc.is_new as is_new, /*number*/
pwrc.is_not_new as is_not_new, /*number*/
pwrc.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
pwrc.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from (
--vb_kol_gr_pwrc
select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*Код настройки кольцевой группы*//*number*/
a.pwrc_id as pwrc_id, /*Код ПС*//*number*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc,a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.pwrc_id as pwrc_id,0 as is_new,1 as is_not_new  from vb_kol_gr_pwrc a where not exists (select * from rr_temp t where t.skod ='pwrc' and t.names=:form_id  and a.kod_kol_gr_pwrc=t.f2 ) and   a.kod_kol_gr_pwrc in :kod_kol_gr_pwrc_prm   union all  select t.n1 as kod_kol_gr_pwrc,t.n2 as kod_kol_gr_nastr,t.n3 as pwrc_id,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='pwrc' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_pwrc_prm )
a
--\(select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc,a.kod_kol_gr_nastr as kod_kol_gr_nastr,a.pwrc_id as pwrc_id,0 as is_new,1 as is_not_new  from vb_kol_gr_pwrc a where not exists (select * from rr_temp t where t.skod ='pwrc' and t.names=:form_id  and a.kod_kol_gr_pwrc=t.f2 ) and   a.kod_kol_gr_pwrc in :kod_kol_gr_pwrc_prm   union all  select t.n1 as kod_kol_gr_pwrc,t.n2 as kod_kol_gr_nastr,t.n3 as pwrc_id,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='pwrc' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_pwrc_prm )
)
pwrc
--\vb_kol_gr_pwrc
left outer join
(
--hv_eopwrc_g
select a.pwrc_id as pwrc_id, /**//*number*//*key*/
max(a.pwrcname)  as pwrcname/*string*/

from (
--hv_eopwrc
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcname/**//*string*/

from (
--hv_eopwrc_istest_0
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcname/**//*string*/

from (
--hv_eopwrc_full
select a.pwrc_id as pwrc_id, /**//*number*/
a.pwrcname as pwrcname, /**//*string*/
a.is_test as is_test/**//*number*/

from hv_eopwrc
a
--\hv_eopwrc
)
a
--\hv_eopwrc_full
where
a.is_test = 0)
a
--\hv_eopwrc_istest_0
)
a
--\hv_eopwrc
 group by
a.pwrc_id/**//*number*//*key*/
)
pwrc_id on pwrc.pwrc_id = pwrc_id.pwrc_id--\hv_eopwrc_g

order by pwrcname--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
    <table name="fdr" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multi-select-column="" multi-select-target="" update-target="vb_kol_gr_fdr" column-editable="0" key="kod_kol_gr_fdr" parent-table="a" parent-key="kod_kol_gr_nastr" is-ms-upd="1">
      <select-text>
--
select pwrc_fdrid.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
fdr.entire_fdr as entire_fdr, /*Фидер включен целиком*//*number*/
pwrc_fdrid.pwrcname as pwrcname, /*ПС*//*string*/
pwrc_fdrid.pwrc_fdr_explname as pwrc_fdr_explname, /*Экспл.отв*//*string*/
fdr.is_new as is_new, /*number*/
fdr.is_not_new as is_not_new, /*number*/
fdr.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
fdr.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from (
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid, /*Код фидера*//*number*/
kod_kol_gr_pwrc.kod_kol_gr_nastr as kod_kol_gr_nastr, /*Код настройки кольцевой группы*//*number*/
a.entire_fdr as entire_fdr, /**//*number*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from vb_kol_gr_fdr
a
--\vb_kol_gr_fdr
left outer join
(
--vb_kol_gr_pwrc
select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from vb_kol_gr_pwrc
a
--\vb_kol_gr_pwrc
)
kod_kol_gr_pwrc on a.kod_kol_gr_pwrc = kod_kol_gr_pwrc.kod_kol_gr_pwrc--\vb_kol_gr_pwrc
)
fdr
--\vb_kol_gr_fdr
left outer join
(
--hv_eopwrc_fdrs
select a.pwrc_fdrid as pwrc_fdrid, /**//*number*//*key*/
a.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
a.pwrcname as pwrcname, /*ПС*//*string*/
a.pwrc_fdr_explname as pwrc_fdr_explname/*Экспл.отв*//*string*/

from hv_eopwrc_fdrs
a
--\hv_eopwrc_fdrs
)
pwrc_fdrid on fdr.pwrc_fdrid = pwrc_fdrid.pwrc_fdrid--\hv_eopwrc_fdrs
where
fdr.kod_kol_gr_nastr = :fk_kod_kol_gr_nastr 
order by pwrcname, pwrc_fdrname--\
</select-text>
      <columns>
        <column name="pwrc_fdrname" table="pwrc_fdrid" type="string" title="Фидер" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_kol_gr_fdr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_fdr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select pwrc_fdrid.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
fdr.kod_kol_gr_fdr as kod_kol_gr_fdr/*number*//*key*/

from (
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid/*Код фидера*//*number*/

from (select a.kod_kol_gr_fdr as kod_kol_gr_fdr,a.pwrc_fdrid as pwrc_fdrid  from vb_kol_gr_fdr a where not exists (select * from rr_temp t where t.skod ='fdr' and t.names=:form_id  and a.kod_kol_gr_fdr=t.f2 ) and   a.kod_kol_gr_fdr in :kod_kol_gr_fdr_prm   union all  select t.n2 as kod_kol_gr_fdr,t.n4 as pwrc_fdrid  from rr_temp t where t.skod ='fdr' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_fdr_prm )
a
--\(select a.kod_kol_gr_fdr as kod_kol_gr_fdr,a.pwrc_fdrid as pwrc_fdrid  from vb_kol_gr_fdr a where not exists (select * from rr_temp t where t.skod ='fdr' and t.names=:form_id  and a.kod_kol_gr_fdr=t.f2 ) and   a.kod_kol_gr_fdr in :kod_kol_gr_fdr_prm   union all  select t.n2 as kod_kol_gr_fdr,t.n4 as pwrc_fdrid  from rr_temp t where t.skod ='fdr' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_fdr_prm )
)
fdr
--\vb_kol_gr_fdr
left outer join
(
--hv_eopwrc_fdrs
select a.pwrc_fdrid as pwrc_fdrid, /**//*number*//*key*/
a.pwrc_fdrname as pwrc_fdrname/*Фидер*//*string*/

from hv_eopwrc_fdrs
a
--\hv_eopwrc_fdrs
)
pwrc_fdrid on fdr.pwrc_fdrid = pwrc_fdrid.pwrc_fdrid--\hv_eopwrc_fdrs
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="entire_fdr" table="fdr" type="number" title="Фидер включен целиком" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="entire_fdr" temp-col-name="n1" />
        <column name="pwrcname" table="pwrc_fdrid" type="string" title="ПС" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_kol_gr_fdr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_fdr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select pwrc_fdrid.pwrcname as pwrcname, /*ПС*//*string*/
fdr.kod_kol_gr_fdr as kod_kol_gr_fdr/*number*//*key*/

from (
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid/*Код фидера*//*number*/

from (select a.kod_kol_gr_fdr as kod_kol_gr_fdr,a.pwrc_fdrid as pwrc_fdrid  from vb_kol_gr_fdr a where not exists (select * from rr_temp t where t.skod ='fdr' and t.names=:form_id  and a.kod_kol_gr_fdr=t.f2 ) and   a.kod_kol_gr_fdr in :kod_kol_gr_fdr_prm   union all  select t.n2 as kod_kol_gr_fdr,t.n4 as pwrc_fdrid  from rr_temp t where t.skod ='fdr' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_fdr_prm )
a
--\(select a.kod_kol_gr_fdr as kod_kol_gr_fdr,a.pwrc_fdrid as pwrc_fdrid  from vb_kol_gr_fdr a where not exists (select * from rr_temp t where t.skod ='fdr' and t.names=:form_id  and a.kod_kol_gr_fdr=t.f2 ) and   a.kod_kol_gr_fdr in :kod_kol_gr_fdr_prm   union all  select t.n2 as kod_kol_gr_fdr,t.n4 as pwrc_fdrid  from rr_temp t where t.skod ='fdr' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_fdr_prm )
)
fdr
--\vb_kol_gr_fdr
left outer join
(
--hv_eopwrc_fdrs
select a.pwrc_fdrid as pwrc_fdrid, /**//*number*//*key*/
a.pwrcname as pwrcname/*ПС*//*string*/

from hv_eopwrc_fdrs
a
--\hv_eopwrc_fdrs
)
pwrc_fdrid on fdr.pwrc_fdrid = pwrc_fdrid.pwrc_fdrid--\hv_eopwrc_fdrs
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="pwrc_fdr_explname" table="pwrc_fdrid" type="string" title="Экспл.отв" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_kol_gr_fdr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_fdr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select pwrc_fdrid.pwrc_fdr_explname as pwrc_fdr_explname, /*Экспл.отв*//*string*/
fdr.kod_kol_gr_fdr as kod_kol_gr_fdr/*number*//*key*/

from (
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid/*Код фидера*//*number*/

from (select a.kod_kol_gr_fdr as kod_kol_gr_fdr,a.pwrc_fdrid as pwrc_fdrid  from vb_kol_gr_fdr a where not exists (select * from rr_temp t where t.skod ='fdr' and t.names=:form_id  and a.kod_kol_gr_fdr=t.f2 ) and   a.kod_kol_gr_fdr in :kod_kol_gr_fdr_prm   union all  select t.n2 as kod_kol_gr_fdr,t.n4 as pwrc_fdrid  from rr_temp t where t.skod ='fdr' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_fdr_prm )
a
--\(select a.kod_kol_gr_fdr as kod_kol_gr_fdr,a.pwrc_fdrid as pwrc_fdrid  from vb_kol_gr_fdr a where not exists (select * from rr_temp t where t.skod ='fdr' and t.names=:form_id  and a.kod_kol_gr_fdr=t.f2 ) and   a.kod_kol_gr_fdr in :kod_kol_gr_fdr_prm   union all  select t.n2 as kod_kol_gr_fdr,t.n4 as pwrc_fdrid  from rr_temp t where t.skod ='fdr' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_fdr_prm )
)
fdr
--\vb_kol_gr_fdr
left outer join
(
--hv_eopwrc_fdrs
select a.pwrc_fdrid as pwrc_fdrid, /**//*number*//*key*/
a.pwrc_fdr_explname as pwrc_fdr_explname/*Экспл.отв*//*string*/

from hv_eopwrc_fdrs
a
--\hv_eopwrc_fdrs
)
pwrc_fdrid on fdr.pwrc_fdrid = pwrc_fdrid.pwrc_fdrid--\hv_eopwrc_fdrs
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="is_new" table="fdr" type="number" title="" is-user-editable="1" />
        <column name="is_not_new" table="fdr" type="number" title="" is-user-editable="1" />
        <column name="kod_kol_gr_fdr" table="fdr" type="number" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kod_kol_gr_fdr" temp-col-name="n2" />
        <column name="kod_kol_gr_nastr" table="fdr" type="number" title="Код настройки кольцевой группы" is-user-editable="1" is-refreshed="1">
          <sel-list-compiled>
            <root>
              <query class="1" timestamp="03.10.2022 13:41:40" file="sql.builder.templates\sql.builder\projects\asuse2_scheme\scheme\original\vb_kol_gr_nastr.xml" elid="3033" ord="3033" leaf="0" lvl="2" pelid="" haskeys="1" name="a" as="a" noname="1" path="./a" used="1">
                <select>--a
select <column table="a" column="kod_kol_gr_nastr" as="kod_kol_gr_nastr" title="" key="1" used="1" type="number" sourcetable="./a/a" sourcecolumn="kod_kol_gr_nastr" into="n1">a.kod_kol_gr_nastr as kod_kol_gr_nastr, /**//*number*//*key*/
</column><column table="a" column="kod_kol_gr" as="kod_kol_gr" title="Код кольцевой группы" key="0" used="1" type="number" sourcetable="./a/a" sourcecolumn="kod_kol_gr" reference="vb_kol_gr" refcol="kod_kol_gr" into="n2">a.kod_kol_gr as kod_kol_gr, /*Код кольцевой группы*//*number*/
</column><column table="kod_kol_gr" column="name" as="kod_kol_gr_x_n" title="Код кольцевой группы" key="0" used="1" type="string" sourcetable="./a/kod_kol_gr" sourcecolumn="name" into="s1">kod_kol_gr.name as kod_kol_gr_x_n, /*Код кольцевой группы*//*string*/
</column><column table="a" column="name" as="name" title="Наименование" key="0" used="1" type="string" sourcetable="./a/a" sourcecolumn="name" into="s2">a.name as name, /*Наименование*//*string*/
</column><column table="a" column="name_exp" as="name_exp" title="Наименование" key="0" used="1" type="string" into="s3">a.name_exp as name_exp, /*Наименование*//*string*/
</column><column table="a" column="s" as="s" title="Период с" key="0" used="1" type="number" sourcetable="./a/a" sourcecolumn="s" into="n3">a.s as s, /*Период с*//*number*/
</column><column table="s" column="name" as="s_x_n" title="Период с" key="0" used="1" type="string" into="s4">s.name as s_x_n, /*Период с*//*string*/
</column><column table="a" column="po" as="po" title="Период по" key="0" used="1" type="number" sourcetable="./a/a" sourcecolumn="po" into="n4">a.po as po, /*Период по*//*number*/
</column><column table="po" column="name" as="po_x_n" title="Период по" key="0" used="1" type="string" into="s5">po.name as po_x_n, /*Период по*//*string*/
</column><column table="a" column="kod_fl" as="kod_fl" title="Код филиала" key="0" used="1" type="number" sourcetable="./a/a" sourcecolumn="kod_fl" reference="jv_rep_cons_d_fl" refcol="kod_fl" into="n5">a.kod_fl as kod_fl, /*Код филиала*//*number*/
</column><column table="kod_fl" column="name" as="kod_fl_x_n" title="Код филиала" key="0" used="1" type="string" sourcetable="./a/kod_fl" sourcecolumn="name" into="s6">kod_fl.name as kod_fl_x_n, /*Код филиала*//*string*/
</column><column table="a" column="kol_gr_comment" as="kol_gr_comment" title="Дополнение" key="0" used="1" type="string" sourcetable="./a/a" sourcecolumn="kol_gr_comment" into="s7">a.kol_gr_comment as kol_gr_comment/*Дополнение*//*string*/
</column></select>
                <from>
from <query name="vb_kol_gr_nastr" as="a" path="./a/a" haskeys="1" used="1">(
<select>--vb_kol_gr_nastr
select <column type="number" table="a" column="kod_kol_gr_nastr" key="1" as="kod_kol_gr_nastr" sourcetable="./a/a" sourcecolumn="kod_kol_gr_nastr" used="1">a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
</column><column type="number" table="a" column="kod_kol_gr" title="Код кольцевой группы" as="kod_kol_gr" reference="vb_kol_gr" refcol="kod_kol_gr" key="0" sourcetable="./a/a" sourcecolumn="kod_kol_gr" used="1">a.kod_kol_gr as kod_kol_gr, /*Код кольцевой группы*//*number*/
</column><column type="string" table="a" column="name" data-size="4000" title="Наименование" as="name" key="0" sourcetable="./a/a" sourcecolumn="name" used="1">a.name as name, /*Наименование*//*string*/
</column><call function="if" type="string" as="name_exp" pth="" key="0" used="1" title="Наименование"><text txtype="func"> case </text><text txtype="func"> when </text><call function="is null" pth="" type="bool">(<column type="string" table="a" column="name" data-size="4000" title="Наименование" as="name" thissrc="name">a.name</column><text txtype="func"> is null </text>) </call><text txtype="func"> then </text><const comment="хотел поставит замещающий текст но передумал"><text>''</text></const><text txtype="func"> else </text><column type="string" table="a" column="name" data-size="4000" title="Наименование" as="name" thissrc="name">a.name</column><text txtype="func"> end </text> as name_exp, /*Наименование*//*string*/
</call><column type="number" table="a" column="s" title="Период с" as="s" key="0" sourcetable="./a/a" sourcecolumn="s" used="1">a.s as s, /*Период с*//*number*/
</column><column type="number" table="a" column="po" title="Период по" as="po" key="0" sourcetable="./a/a" sourcecolumn="po" used="1">a.po as po, /*Период по*//*number*/
</column><column type="number" table="a" column="kod_fl" title="Код филиала" as="kod_fl" reference="jv_rep_cons_d_fl" refcol="kod_fl" key="0" sourcetable="./a/a" sourcecolumn="kod_fl" used="1">a.kod_fl as kod_fl, /*Код филиала*//*number*/
</column><column table="a" column="kol_gr_comment" type="string" title="Дополнение" as="kol_gr_comment" key="0" sourcetable="./a/a" sourcecolumn="kol_gr_comment" used="1">a.kol_gr_comment as kol_gr_comment/*Дополнение*//*string*/
</column></select><from>
from <table name="vb_kol_gr_nastr" as="a" used="1">vb_kol_gr_nastr
a
--\vb_kol_gr_nastr
</table></from>)
a
--\vb_kol_gr_nastr
</query><query name="jv_rep_cons_d_fl" as="kod_fl" join="left outer" path="./a/kod_fl" order="a.name" haskeys="1" used="1">left outer join
(
<order notext="1"><column column="a.name">a.name</column></order><select>--jv_rep_cons_d_fl
select <column table="a" column="kod_fl" type="number" as="kod_fl" key="1" fixed="1" sourcetable="./a/kod_fl" sourcecolumn="kod_fl" used="1">a.kod_fl as kod_fl, /*number*//*key*/
</column><column table="a" column="name" type="string" title="Филиал" is-name="1" vid="1" as="name" key="0" sourcetable="./a/kod_fl" sourcecolumn="name" used="1">a.name as name/*Филиал*//*string*/
</column></select><from>
from <table name="jv_rep_cons_d_fl" as="a" title="изм1: Код филиала" used="1">jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
</table></from><call function="=" type="bool">)
kod_fl on <column table="a" column="kod_fl">a.kod_fl</column><text txtype="func"> = </text><column table="kod_fl" column="kod_fl">kod_fl.kod_fl</column></call>--\jv_rep_cons_d_fl
</query><query name="spr_time_ym" as="po" join="left outer" path="./a/po" order="ym desc" haskeys="1" used="1">left outer join
(
<order notext="1"><column column="ym">ym</column></order><select>--spr_time_ym
select <column table="a" column="ym" key="1" as="ym" used="1" type="number">a.ym as ym, /*number*//*key*/
</column><column table="a" column="name" vid="1" is-name="1" as="name" key="0" used="1" type="string" title="Период">a.name as name/*Период*//*string*/
</column></select><from>
from <query name="spr_time_ym_pre" as="a" path="./a/po/a" order="ym" haskeys="1" used="1">(
<order notext="1"><column column="ym">ym</column></order><select>--spr_time_ym_pre
select <call function="date to ym" as="ym" key="1" group="1" pth="" type="number" used="1"><text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text> as ym, /*number*//*key*/
</call><call function="ym to char" as="name" title="Период" key="0" group="max" pth="" type="string" used="1">max(<text txtype="func"> trim(to_char( </text><call function="date to ym" as="ym" key="1" pth="" type="number" thissrc="ym">(<text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text>) </call><text txtype="func"> ,'9999.99')) </text>)  as name/*Период*//*string*/
</call></select><from>
from <table name="vv_day" as="a" used="1">vv_day
a
--\vv_day
</table></from><group> group by
<call function="date to ym" as="ym" key="1" group="1" pth="" type="number" used="1"><text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text>/*number*//*key*/
</call></group><order>
order by ym</order>)
a
--\spr_time_ym_pre
</query></from><call function="=" type="bool">)
po on <column table="po" column="ym">po.ym</column><text txtype="func"> = </text><column table="a" column="po">a.po</column></call>--\spr_time_ym
</query><query name="spr_time_ym" as="s" join="left outer" path="./a/s" order="ym desc" haskeys="1" used="1">left outer join
(
<order notext="1"><column column="ym">ym</column></order><select>--spr_time_ym
select <column table="a" column="ym" key="1" as="ym" used="1" type="number">a.ym as ym, /*number*//*key*/
</column><column table="a" column="name" vid="1" is-name="1" as="name" key="0" used="1" type="string" title="Период">a.name as name/*Период*//*string*/
</column></select><from>
from <query name="spr_time_ym_pre" as="a" path="./a/s/a" order="ym" haskeys="1" used="1">(
<order notext="1"><column column="ym">ym</column></order><select>--spr_time_ym_pre
select <call function="date to ym" as="ym" key="1" group="1" pth="" type="number" used="1"><text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text> as ym, /*number*//*key*/
</call><call function="ym to char" as="name" title="Период" key="0" group="max" pth="" type="string" used="1">max(<text txtype="func"> trim(to_char( </text><call function="date to ym" as="ym" key="1" pth="" type="number" thissrc="ym">(<text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text>) </call><text txtype="func"> ,'9999.99')) </text>)  as name/*Период*//*string*/
</call></select><from>
from <table name="vv_day" as="a" used="1">vv_day
a
--\vv_day
</table></from><group> group by
<call function="date to ym" as="ym" key="1" group="1" pth="" type="number" used="1"><text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text>/*number*//*key*/
</call></group><order>
order by ym</order>)
a
--\spr_time_ym_pre
</query></from><call function="=" type="bool">)
s on <column table="a" column="s">a.s</column><text txtype="func"> = </text><column table="s" column="ym">s.ym</column></call>--\spr_time_ym
</query><query name="vb_kol_gr" as="kod_kol_gr" join="left outer" path="./a/kod_kol_gr" order="kod_kol_gr" haskeys="1" used="1">left outer join
(
<order notext="1"><column column="kod_kol_gr">kod_kol_gr</column></order><select>--vb_kol_gr
select <column type="number" table="a" column="kod_kol_gr" key="1" as="kod_kol_gr" sourcetable="./a/kod_kol_gr" sourcecolumn="kod_kol_gr" used="1">a.kod_kol_gr as kod_kol_gr, /*number*//*key*/
</column><column type="string" table="a" column="name" data-size="4000" title="Наименование" as="name" key="0" sourcetable="./a/kod_kol_gr" sourcecolumn="name" used="1">a.name as name/*Наименование*//*string*/
</column></select><from>
from <table name="vb_kol_gr" as="a" used="1">vb_kol_gr
a
--\vb_kol_gr
</table></from><call function="=" type="bool">)
kod_kol_gr on <column table="a" column="kod_kol_gr">a.kod_kol_gr</column><text txtype="func"> = </text><column table="kod_kol_gr" column="kod_kol_gr">kod_kol_gr.kod_kol_gr</column></call>--\vb_kol_gr
</query></from>
                <where>where
<call function="and" pth="" type="bool"><call function="le" pth="" type="bool">(<call function="rownum" pth="0" type="number"><text txtype="func"> rownum </text></call><text txtype="func"> &lt;= </text><const><text>:p_rows_limit </text></const>) </call><text txtype="func"> { </text><text txtype="func"> and </text><call function="in" pth="" optional="1" type="bool">(<column table="a" column="kod_kol_gr_nastr" as="kod_kol_gr_nastr" title="" key="1" thissrc="kod_kol_gr_nastr">a.kod_kol_gr_nastr</column><text txtype="func"> in </text><const><text>:pk_prm </text></const>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kod_kol_gr_nastr" as="kod_kol_gr_nastr" title="" key="1" thissrc="kod_kol_gr_nastr">a.kod_kol_gr_nastr</column><text txtype="func"> ) like lower( </text><const><text>:kod_kol_gr_nastr_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kod_kol_gr" as="kod_kol_gr" title="Код кольцевой группы" thissrc="kod_kol_gr">a.kod_kol_gr</column><text txtype="func"> ) like lower( </text><const><text>:kod_kol_gr_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="kod_kol_gr" column="name" as="kod_kol_gr_x_n" title="Код кольцевой группы" thissrc="kod_kol_gr_x_n">kod_kol_gr.name</column><text txtype="func"> ) like lower( </text><const><text>:kod_kol_gr_x_n_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="name" as="name" title="Наименование" thissrc="name">a.name</column><text txtype="func"> ) like lower( </text><const><text>:name_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="name_exp" as="name_exp" title="Наименование" thissrc="name_exp">a.name_exp</column><text txtype="func"> ) like lower( </text><const><text>:name_exp_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="s" as="s" title="Период с" thissrc="s">a.s</column><text txtype="func"> ) like lower( </text><const><text>:s_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="s" column="name" as="s_x_n" title="Период с" thissrc="s_x_n">s.name</column><text txtype="func"> ) like lower( </text><const><text>:s_x_n_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="po" as="po" title="Период по" thissrc="po">a.po</column><text txtype="func"> ) like lower( </text><const><text>:po_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="po" column="name" as="po_x_n" title="Период по" thissrc="po_x_n">po.name</column><text txtype="func"> ) like lower( </text><const><text>:po_x_n_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kod_fl" as="kod_fl" title="Код филиала" thissrc="kod_fl">a.kod_fl</column><text txtype="func"> ) like lower( </text><const><text>:kod_fl_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="kod_fl" column="name" as="kod_fl_x_n" title="Код филиала" thissrc="kod_fl_x_n">kod_fl.name</column><text txtype="func"> ) like lower( </text><const><text>:kod_fl_x_n_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kol_gr_comment" as="kol_gr_comment" title="Дополнение" thissrc="kol_gr_comment">a.kol_gr_comment</column><text txtype="func"> ) like lower( </text><const><text>:kol_gr_comment_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text></call></where>--\a
</query>
            </root>
          </sel-list-compiled>
          <sel-list-report>
            <report name="a" class="1" timestamp="03.10.2022 13:41:40" file="sql.builder.templates\sql.builder\projects\asuse2_scheme\scheme\original\vb_kol_gr_nastr.xml" elid="3033" ord="3033" leaf="0" lvl="2" pelid="" haskeys="1" as="a">
              <queries>
                <query class="1" timestamp="03.10.2022 13:41:40" file="sql.builder.templates\sql.builder\projects\asuse2_scheme\scheme\original\vb_kol_gr_nastr.xml" elid="3033" ord="3033" leaf="0" lvl="2" pelid="" haskeys="1" name="a" as="a">
                  <params>
                    <param name="pk_prm" type="array" />
                    <param name="kod_kol_gr_nastr_filter" type="string" />
                    <param name="kod_kol_gr_filter" type="string" />
                    <param name="kod_kol_gr_x_n_filter" type="string" />
                    <param name="name_filter" type="string" />
                    <param name="name_exp_filter" type="string" />
                    <param name="s_filter" type="string" />
                    <param name="s_x_n_filter" type="string" />
                    <param name="po_filter" type="string" />
                    <param name="po_x_n_filter" type="string" />
                    <param name="kod_fl_filter" type="string" />
                    <param name="kod_fl_x_n_filter" type="string" />
                    <param name="kol_gr_comment_filter" type="string" />
                    <param name="p_rows_limit" type="number" />
                  </params>
                  <select>
                    <column table="a" column="kod_kol_gr_nastr" as="kod_kol_gr_nastr" title="" key="1" />
                    <column table="a" column="kod_kol_gr" as="kod_kol_gr" title="Код кольцевой группы" />
                    <column table="kod_kol_gr" column="name" as="kod_kol_gr_x_n" title="Код кольцевой группы" />
                    <column table="a" column="name" as="name" title="Наименование" />
                    <column table="a" column="name_exp" as="name_exp" title="Наименование" />
                    <column table="a" column="s" as="s" title="Период с" />
                    <column table="s" column="name" as="s_x_n" title="Период с" />
                    <column table="a" column="po" as="po" title="Период по" />
                    <column table="po" column="name" as="po_x_n" title="Период по" />
                    <column table="a" column="kod_fl" as="kod_fl" title="Код филиала" />
                    <column table="kod_fl" column="name" as="kod_fl_x_n" title="Код филиала" />
                    <column table="a" column="kol_gr_comment" as="kol_gr_comment" title="Дополнение" />
                  </select>
                  <from>
                    <query name="vb_kol_gr_nastr" as="a">
                      <link name="kod_kol_gr" as="kod_kol_gr" table="vb_kol_gr" child="vb_kol_gr_nastr" field="kod_kol_gr" parent="vb_kol_gr" back="vb_kol_gr_nastr" />
                      <link name="s" as="s" table="spr_time_ym" child="vb_kol_gr_nastr" field="s" parent="spr_time_ym" back="vb_kol_gr_nastr" />
                      <link name="po" as="po" table="spr_time_ym" child="vb_kol_gr_nastr" field="po" parent="spr_time_ym" back="vb_kol_gr_nastr" />
                      <link name="kod_fl" as="kod_fl" table="jv_rep_cons_d_fl" child="vb_kol_gr_nastr" field="kod_fl" parent="jv_rep_cons_d_fl" back="vb_kol_gr_nastr" title="изм1: Код филиала" />
                    </query>
                  </from>
                  <where>
                    <call function="and">
                      <call function="le">
                        <call function="rownum" />
                        <useparam name="p_rows_limit" />
                      </call>
                      <call function="in" optional="1">
                        <column table="this" column="kod_kol_gr_nastr" />
                        <useparam name="pk_prm" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_kol_gr_nastr" />
                        <useparam name="kod_kol_gr_nastr_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_kol_gr" />
                        <useparam name="kod_kol_gr_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_kol_gr_x_n" />
                        <useparam name="kod_kol_gr_x_n_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="name" />
                        <useparam name="name_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="name_exp" />
                        <useparam name="name_exp_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="s" />
                        <useparam name="s_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="s_x_n" />
                        <useparam name="s_x_n_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="po" />
                        <useparam name="po_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="po_x_n" />
                        <useparam name="po_x_n_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_fl" />
                        <useparam name="kod_fl_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_fl_x_n" />
                        <useparam name="kod_fl_x_n_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kol_gr_comment" />
                        <useparam name="kol_gr_comment_filter" />
                      </call>
                    </call>
                  </where>
                  <withparams>
                    <useparam name="pk_prm" />
                    <useparam name="kod_kol_gr_nastr_filter" />
                    <useparam name="kod_kol_gr_filter" />
                    <useparam name="kod_kol_gr_x_n_filter" />
                    <useparam name="name_filter" />
                    <useparam name="name_exp_filter" />
                    <useparam name="s_filter" />
                    <useparam name="s_x_n_filter" />
                    <useparam name="po_filter" />
                    <useparam name="po_x_n_filter" />
                    <useparam name="kod_fl_filter" />
                    <useparam name="kod_fl_x_n_filter" />
                    <useparam name="kol_gr_comment_filter" />
                    <useparam name="p_rows_limit" />
                  </withparams>
                </query>
              </queries>
              <params>
                <param name="pk_prm" type="array">
                  <const>:pk_prm </const>
                </param>
                <param name="kod_kol_gr_nastr_filter" type="string">
                  <const>:kod_kol_gr_nastr_filter </const>
                </param>
                <param name="kod_kol_gr_filter" type="string">
                  <const>:kod_kol_gr_filter </const>
                </param>
                <param name="kod_kol_gr_x_n_filter" type="string">
                  <const>:kod_kol_gr_x_n_filter </const>
                </param>
                <param name="name_filter" type="string">
                  <const>:name_filter </const>
                </param>
                <param name="name_exp_filter" type="string">
                  <const>:name_exp_filter </const>
                </param>
                <param name="s_filter" type="string">
                  <const>:s_filter </const>
                </param>
                <param name="s_x_n_filter" type="string">
                  <const>:s_x_n_filter </const>
                </param>
                <param name="po_filter" type="string">
                  <const>:po_filter </const>
                </param>
                <param name="po_x_n_filter" type="string">
                  <const>:po_x_n_filter </const>
                </param>
                <param name="kod_fl_filter" type="string">
                  <const>:kod_fl_filter </const>
                </param>
                <param name="kod_fl_x_n_filter" type="string">
                  <const>:kod_fl_x_n_filter </const>
                </param>
                <param name="kol_gr_comment_filter" type="string">
                  <const>:kol_gr_comment_filter </const>
                </param>
                <param name="p_rows_limit" type="number">
                  <const>:p_rows_limit </const>
                </param>
              </params>
            </report>
          </sel-list-report>
          <sel-list-pars>
            <params />
          </sel-list-pars>
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_kol_gr_fdr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_fdr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select fdr.kod_kol_gr_nastr as kod_kol_gr_nastr, /*Код настройки кольцевой группы*//*number*/
fdr.kod_kol_gr_fdr as kod_kol_gr_fdr/*number*//*key*/

from (
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
kod_kol_gr_pwrc.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from (select a.kod_kol_gr_fdr as kod_kol_gr_fdr,a.kod_kol_gr_pwrc as kod_kol_gr_pwrc  from vb_kol_gr_fdr a where not exists (select * from rr_temp t where t.skod ='fdr' and t.names=:form_id  and a.kod_kol_gr_fdr=t.f2 ) and   a.kod_kol_gr_fdr in :kod_kol_gr_fdr_prm   union all  select t.n2 as kod_kol_gr_fdr,t.n3 as kod_kol_gr_pwrc  from rr_temp t where t.skod ='fdr' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_fdr_prm )
a
--\(select a.kod_kol_gr_fdr as kod_kol_gr_fdr,a.kod_kol_gr_pwrc as kod_kol_gr_pwrc  from vb_kol_gr_fdr a where not exists (select * from rr_temp t where t.skod ='fdr' and t.names=:form_id  and a.kod_kol_gr_fdr=t.f2 ) and   a.kod_kol_gr_fdr in :kod_kol_gr_fdr_prm   union all  select t.n2 as kod_kol_gr_fdr,t.n3 as kod_kol_gr_pwrc  from rr_temp t where t.skod ='fdr' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_fdr_prm )
left outer join
(
--vb_kol_gr_pwrc
select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from vb_kol_gr_pwrc
a
--\vb_kol_gr_pwrc
)
kod_kol_gr_pwrc on a.kod_kol_gr_pwrc = kod_kol_gr_pwrc.kod_kol_gr_pwrc--\vb_kol_gr_pwrc
)
fdr
--\vb_kol_gr_fdr
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:entire_fdr as entire_fdr 
,:kod_kol_gr_fdr as kod_kol_gr_fdr 
 
from dual ) 
 
loop 
insert into vb_kol_gr_fdr 
(entire_fdr 
,kod_kol_gr_fdr 
) 
 values  
(r.entire_fdr 
,r.kod_kol_gr_fdr 
) 
 returning  
kod_kol_gr_fdr into :kod_kol_gr_fdr; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from vb_kol_gr_fdr where kod_kol_gr_fdr=:kod_kol_gr_fdr</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='fdr' 
and 
names=:form_id 
and 
f2=:kod_kol_gr_fdr; 
if :row_state_id=1  then 
for r in  
 ( select  
:entire_fdr as entire_fdr 
,:kod_kol_gr_fdr as kod_kol_gr_fdr 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,n2 
) 
 values  
('fdr' 
,:form_id 
,:kod_kol_gr_fdr 
,:row_state_id 
,r.entire_fdr 
,r.kod_kol_gr_fdr 
); 
end loop; 
else 
for r in  
 ( select  
:entire_fdr as entire_fdr 
,:kod_kol_gr_fdr as kod_kol_gr_fdr 
,a.kod_kol_gr_pwrc 
,a.pwrc_fdrid 
,a.u_m 
,a.d_m 
 
from vb_kol_gr_fdr a  where kod_kol_gr_fdr=:kod_kol_gr_fdr) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,n2 
,n3 
,n4 
,s1 
,d1 
) 
 values  
('fdr' 
,:form_id 
,:kod_kol_gr_fdr 
,:row_state_id 
,r.entire_fdr 
,r.kod_kol_gr_fdr 
,r.kod_kol_gr_pwrc 
,r.pwrc_fdrid 
,r.u_m 
,r.d_m 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='fdr' and names=:form_id</clear-temp-text>
      <update-text>begin
update vb_kol_gr_fdr set  
(entire_fdr 
,kod_kol_gr_fdr 
) 
= 
 ( select  
:entire_fdr as entire_fdr 
,:kod_kol_gr_fdr as kod_kol_gr_fdr 
 
from dual ) 
 
where 
kod_kol_gr_fdr=:kod_kol_gr_fdr 
;
end;
</update-text>
      <scheme>
        <table name="vb_kol_gr_fdr" as="fdr">
          <columns>
            <column name="pwrc_fdrname" type="string" title="Фидер" />
            <column name="entire_fdr" type="number" title="Фидер включен целиком" />
            <column name="pwrcname" type="string" title="ПС" />
            <column name="pwrc_fdr_explname" type="string" title="Экспл.отв" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_fdr" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_nastr" type="number" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <column name="pwrc_fdrname" type="string" title="Фидер" />
            <column name="entire_fdr" type="number" title="Фидер включен целиком" />
            <column name="pwrcname" type="string" title="ПС" />
            <column name="pwrc_fdr_explname" type="string" title="Экспл.отв" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_fdr" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_nastr" type="number" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="kod_kol_gr_fdr_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="kod_kol_gr_fdr_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select pwrc_fdrid.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
fdr.entire_fdr as entire_fdr, /*Фидер включен целиком*//*number*/
pwrc_fdrid.pwrcname as pwrcname, /*ПС*//*string*/
pwrc_fdrid.pwrc_fdr_explname as pwrc_fdr_explname, /*Экспл.отв*//*string*/
fdr.is_new as is_new, /*number*/
fdr.is_not_new as is_not_new, /*number*/
fdr.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
fdr.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from (
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid, /*Код фидера*//*number*/
kod_kol_gr_pwrc.kod_kol_gr_nastr as kod_kol_gr_nastr, /*Код настройки кольцевой группы*//*number*/
a.entire_fdr as entire_fdr, /**//*number*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.kod_kol_gr_fdr as kod_kol_gr_fdr,a.pwrc_fdrid as pwrc_fdrid,a.entire_fdr as entire_fdr,0 as is_new,1 as is_not_new,a.kod_kol_gr_pwrc as kod_kol_gr_pwrc  from vb_kol_gr_fdr a where not exists (select * from rr_temp t where t.skod ='fdr' and t.names=:form_id  and a.kod_kol_gr_fdr=t.f2 ) and   a.kod_kol_gr_fdr in :kod_kol_gr_fdr_prm   union all  select t.n2 as kod_kol_gr_fdr,t.n4 as pwrc_fdrid,t.n1 as entire_fdr,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new,t.n3 as kod_kol_gr_pwrc  from rr_temp t where t.skod ='fdr' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_fdr_prm )
a
--\(select a.kod_kol_gr_fdr as kod_kol_gr_fdr,a.pwrc_fdrid as pwrc_fdrid,a.entire_fdr as entire_fdr,0 as is_new,1 as is_not_new,a.kod_kol_gr_pwrc as kod_kol_gr_pwrc  from vb_kol_gr_fdr a where not exists (select * from rr_temp t where t.skod ='fdr' and t.names=:form_id  and a.kod_kol_gr_fdr=t.f2 ) and   a.kod_kol_gr_fdr in :kod_kol_gr_fdr_prm   union all  select t.n2 as kod_kol_gr_fdr,t.n4 as pwrc_fdrid,t.n1 as entire_fdr,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new,t.n3 as kod_kol_gr_pwrc  from rr_temp t where t.skod ='fdr' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_fdr_prm )
left outer join
(
--vb_kol_gr_pwrc
select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from vb_kol_gr_pwrc
a
--\vb_kol_gr_pwrc
)
kod_kol_gr_pwrc on a.kod_kol_gr_pwrc = kod_kol_gr_pwrc.kod_kol_gr_pwrc--\vb_kol_gr_pwrc
)
fdr
--\vb_kol_gr_fdr
left outer join
(
--hv_eopwrc_fdrs
select a.pwrc_fdrid as pwrc_fdrid, /**//*number*//*key*/
a.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
a.pwrcname as pwrcname, /*ПС*//*string*/
a.pwrc_fdr_explname as pwrc_fdr_explname/*Экспл.отв*//*string*/

from hv_eopwrc_fdrs
a
--\hv_eopwrc_fdrs
)
pwrc_fdrid on fdr.pwrc_fdrid = pwrc_fdrid.pwrc_fdrid--\hv_eopwrc_fdrs

order by pwrcname, pwrc_fdrname--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
    <table name="tp" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multi-select-column="" multi-select-target="" update-target="vb_kol_gr_tp" column-editable="0" key="kod_kol_gr_tp" parent-table="a" parent-key="kod_kol_gr_nastr" is-ms-upd="1">
      <select-text>
--
select hv_eopwrc_grid_id.srcname as srcname, /*ТП*//*string*/
hv_eopwrc_grid_id.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
hv_eopwrc_grid_id.pwrcname as pwrcname, /*ПС*//*string*/
tp.is_new as is_new, /*number*/
tp.is_not_new as is_not_new, /*number*/
tp.kod_kol_gr_tp as kod_kol_gr_tp, /*number*//*key*/
tp.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from (
--vb_kol_gr_tp
select a.kod_kol_gr_tp as kod_kol_gr_tp, /*number*//*key*/
a.src_id as src_id, /*Код ТП*//*number*/
kod_kol_gr_fdr.pwrc_fdrid as pwrc_fdrid, /*Код фидера*//*number*/
kod_kol_gr_pwrc.kod_kol_gr_nastr as kod_kol_gr_nastr, /*Код настройки кольцевой группы*//*number*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from vb_kol_gr_tp
a
--\vb_kol_gr_tp
left outer join
(
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*Код настройки ПС*//*number*/
a.pwrc_fdrid as pwrc_fdrid/*Код фидера*//*number*/

from vb_kol_gr_fdr
a
--\vb_kol_gr_fdr
)
kod_kol_gr_fdr on a.kod_kol_gr_fdr = kod_kol_gr_fdr.kod_kol_gr_fdr--\vb_kol_gr_fdr
left outer join
(
--vb_kol_gr_pwrc
select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from vb_kol_gr_pwrc
a
--\vb_kol_gr_pwrc
)
kod_kol_gr_pwrc on kod_kol_gr_fdr.kod_kol_gr_pwrc = kod_kol_gr_pwrc.kod_kol_gr_pwrc--\vb_kol_gr_pwrc
)
tp
--\vb_kol_gr_tp
left outer join
(
--hv_eopwrc_grid
select a.pwrcname as pwrcname, /*ПС*//*string*/
a.pwrc_fdrid as pwrc_fdrid, /**//*number*/
a.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
a.src_id as src_id, /**//*number*/
a.srcname as srcname/*ТП*//*string*/

from hv_eopwrc_grid
a
--\hv_eopwrc_grid
)
hv_eopwrc_grid_id on (tp.src_id = hv_eopwrc_grid_id.src_id)  and (tp.pwrc_fdrid = hv_eopwrc_grid_id.pwrc_fdrid) --\hv_eopwrc_grid
where
tp.kod_kol_gr_nastr = :fk_kod_kol_gr_nastr 
order by pwrcname, pwrc_fdrname, srcname--\
</select-text>
      <columns>
        <column name="srcname" table="hv_eopwrc_grid_id" type="string" title="ТП" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_kol_gr_tp_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_tp_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select hv_eopwrc_grid_id.srcname as srcname, /*ТП*//*string*/
tp.kod_kol_gr_tp as kod_kol_gr_tp/*number*//*key*/

from (
--vb_kol_gr_tp
select a.kod_kol_gr_tp as kod_kol_gr_tp, /*number*//*key*/
a.src_id as src_id, /*Код ТП*//*number*/
kod_kol_gr_fdr.pwrc_fdrid as pwrc_fdrid/*Код фидера*//*number*/

from (select a.kod_kol_gr_tp as kod_kol_gr_tp,a.src_id as src_id,a.kod_kol_gr_fdr as kod_kol_gr_fdr  from vb_kol_gr_tp a where not exists (select * from rr_temp t where t.skod ='tp' and t.names=:form_id  and a.kod_kol_gr_tp=t.f2 ) and   a.kod_kol_gr_tp in :kod_kol_gr_tp_prm   union all  select t.n1 as kod_kol_gr_tp,t.n3 as src_id,t.n2 as kod_kol_gr_fdr  from rr_temp t where t.skod ='tp' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_tp_prm )
a
--\(select a.kod_kol_gr_tp as kod_kol_gr_tp,a.src_id as src_id,a.kod_kol_gr_fdr as kod_kol_gr_fdr  from vb_kol_gr_tp a where not exists (select * from rr_temp t where t.skod ='tp' and t.names=:form_id  and a.kod_kol_gr_tp=t.f2 ) and   a.kod_kol_gr_tp in :kod_kol_gr_tp_prm   union all  select t.n1 as kod_kol_gr_tp,t.n3 as src_id,t.n2 as kod_kol_gr_fdr  from rr_temp t where t.skod ='tp' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_tp_prm )
left outer join
(
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid/*Код фидера*//*number*/

from vb_kol_gr_fdr
a
--\vb_kol_gr_fdr
)
kod_kol_gr_fdr on a.kod_kol_gr_fdr = kod_kol_gr_fdr.kod_kol_gr_fdr--\vb_kol_gr_fdr
)
tp
--\vb_kol_gr_tp
left outer join
(
--hv_eopwrc_grid
select a.pwrc_fdrid as pwrc_fdrid, /**//*number*/
a.src_id as src_id, /**//*number*/
a.srcname as srcname/*ТП*//*string*/

from hv_eopwrc_grid
a
--\hv_eopwrc_grid
)
hv_eopwrc_grid_id on (tp.src_id = hv_eopwrc_grid_id.src_id)  and (tp.pwrc_fdrid = hv_eopwrc_grid_id.pwrc_fdrid) --\hv_eopwrc_grid
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="pwrc_fdrname" table="hv_eopwrc_grid_id" type="string" title="Фидер" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_kol_gr_tp_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_tp_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select hv_eopwrc_grid_id.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
tp.kod_kol_gr_tp as kod_kol_gr_tp/*number*//*key*/

from (
--vb_kol_gr_tp
select a.kod_kol_gr_tp as kod_kol_gr_tp, /*number*//*key*/
a.src_id as src_id, /*Код ТП*//*number*/
kod_kol_gr_fdr.pwrc_fdrid as pwrc_fdrid/*Код фидера*//*number*/

from (select a.kod_kol_gr_tp as kod_kol_gr_tp,a.src_id as src_id,a.kod_kol_gr_fdr as kod_kol_gr_fdr  from vb_kol_gr_tp a where not exists (select * from rr_temp t where t.skod ='tp' and t.names=:form_id  and a.kod_kol_gr_tp=t.f2 ) and   a.kod_kol_gr_tp in :kod_kol_gr_tp_prm   union all  select t.n1 as kod_kol_gr_tp,t.n3 as src_id,t.n2 as kod_kol_gr_fdr  from rr_temp t where t.skod ='tp' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_tp_prm )
a
--\(select a.kod_kol_gr_tp as kod_kol_gr_tp,a.src_id as src_id,a.kod_kol_gr_fdr as kod_kol_gr_fdr  from vb_kol_gr_tp a where not exists (select * from rr_temp t where t.skod ='tp' and t.names=:form_id  and a.kod_kol_gr_tp=t.f2 ) and   a.kod_kol_gr_tp in :kod_kol_gr_tp_prm   union all  select t.n1 as kod_kol_gr_tp,t.n3 as src_id,t.n2 as kod_kol_gr_fdr  from rr_temp t where t.skod ='tp' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_tp_prm )
left outer join
(
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid/*Код фидера*//*number*/

from vb_kol_gr_fdr
a
--\vb_kol_gr_fdr
)
kod_kol_gr_fdr on a.kod_kol_gr_fdr = kod_kol_gr_fdr.kod_kol_gr_fdr--\vb_kol_gr_fdr
)
tp
--\vb_kol_gr_tp
left outer join
(
--hv_eopwrc_grid
select a.pwrc_fdrid as pwrc_fdrid, /**//*number*/
a.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
a.src_id as src_id/**//*number*/

from hv_eopwrc_grid
a
--\hv_eopwrc_grid
)
hv_eopwrc_grid_id on (tp.src_id = hv_eopwrc_grid_id.src_id)  and (tp.pwrc_fdrid = hv_eopwrc_grid_id.pwrc_fdrid) --\hv_eopwrc_grid
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="pwrcname" table="hv_eopwrc_grid_id" type="string" title="ПС" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_kol_gr_tp_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_tp_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select hv_eopwrc_grid_id.pwrcname as pwrcname, /*ПС*//*string*/
tp.kod_kol_gr_tp as kod_kol_gr_tp/*number*//*key*/

from (
--vb_kol_gr_tp
select a.kod_kol_gr_tp as kod_kol_gr_tp, /*number*//*key*/
a.src_id as src_id, /*Код ТП*//*number*/
kod_kol_gr_fdr.pwrc_fdrid as pwrc_fdrid/*Код фидера*//*number*/

from (select a.kod_kol_gr_tp as kod_kol_gr_tp,a.src_id as src_id,a.kod_kol_gr_fdr as kod_kol_gr_fdr  from vb_kol_gr_tp a where not exists (select * from rr_temp t where t.skod ='tp' and t.names=:form_id  and a.kod_kol_gr_tp=t.f2 ) and   a.kod_kol_gr_tp in :kod_kol_gr_tp_prm   union all  select t.n1 as kod_kol_gr_tp,t.n3 as src_id,t.n2 as kod_kol_gr_fdr  from rr_temp t where t.skod ='tp' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_tp_prm )
a
--\(select a.kod_kol_gr_tp as kod_kol_gr_tp,a.src_id as src_id,a.kod_kol_gr_fdr as kod_kol_gr_fdr  from vb_kol_gr_tp a where not exists (select * from rr_temp t where t.skod ='tp' and t.names=:form_id  and a.kod_kol_gr_tp=t.f2 ) and   a.kod_kol_gr_tp in :kod_kol_gr_tp_prm   union all  select t.n1 as kod_kol_gr_tp,t.n3 as src_id,t.n2 as kod_kol_gr_fdr  from rr_temp t where t.skod ='tp' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_tp_prm )
left outer join
(
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.pwrc_fdrid as pwrc_fdrid/*Код фидера*//*number*/

from vb_kol_gr_fdr
a
--\vb_kol_gr_fdr
)
kod_kol_gr_fdr on a.kod_kol_gr_fdr = kod_kol_gr_fdr.kod_kol_gr_fdr--\vb_kol_gr_fdr
)
tp
--\vb_kol_gr_tp
left outer join
(
--hv_eopwrc_grid
select a.pwrcname as pwrcname, /*ПС*//*string*/
a.pwrc_fdrid as pwrc_fdrid, /**//*number*/
a.src_id as src_id/**//*number*/

from hv_eopwrc_grid
a
--\hv_eopwrc_grid
)
hv_eopwrc_grid_id on (tp.src_id = hv_eopwrc_grid_id.src_id)  and (tp.pwrc_fdrid = hv_eopwrc_grid_id.pwrc_fdrid) --\hv_eopwrc_grid
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="is_new" table="tp" type="number" title="" is-user-editable="1" />
        <column name="is_not_new" table="tp" type="number" title="" is-user-editable="1" />
        <column name="kod_kol_gr_tp" table="tp" type="number" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kod_kol_gr_tp" temp-col-name="n1" />
        <column name="kod_kol_gr_nastr" table="tp" type="number" title="Код настройки кольцевой группы" is-user-editable="1" is-refreshed="1">
          <sel-list-compiled>
            <root>
              <query class="1" timestamp="03.10.2022 13:41:40" file="sql.builder.templates\sql.builder\projects\asuse2_scheme\scheme\original\vb_kol_gr_nastr.xml" elid="3033" ord="3033" leaf="0" lvl="2" pelid="" haskeys="1" name="a" as="a" noname="1" path="./a" used="1">
                <select>--a
select <column table="a" column="kod_kol_gr_nastr" as="kod_kol_gr_nastr" title="" key="1" used="1" type="number" sourcetable="./a/a" sourcecolumn="kod_kol_gr_nastr" into="n1">a.kod_kol_gr_nastr as kod_kol_gr_nastr, /**//*number*//*key*/
</column><column table="a" column="kod_kol_gr" as="kod_kol_gr" title="Код кольцевой группы" key="0" used="1" type="number" sourcetable="./a/a" sourcecolumn="kod_kol_gr" reference="vb_kol_gr" refcol="kod_kol_gr" into="n2">a.kod_kol_gr as kod_kol_gr, /*Код кольцевой группы*//*number*/
</column><column table="kod_kol_gr" column="name" as="kod_kol_gr_x_n" title="Код кольцевой группы" key="0" used="1" type="string" sourcetable="./a/kod_kol_gr" sourcecolumn="name" into="s1">kod_kol_gr.name as kod_kol_gr_x_n, /*Код кольцевой группы*//*string*/
</column><column table="a" column="name" as="name" title="Наименование" key="0" used="1" type="string" sourcetable="./a/a" sourcecolumn="name" into="s2">a.name as name, /*Наименование*//*string*/
</column><column table="a" column="name_exp" as="name_exp" title="Наименование" key="0" used="1" type="string" into="s3">a.name_exp as name_exp, /*Наименование*//*string*/
</column><column table="a" column="s" as="s" title="Период с" key="0" used="1" type="number" sourcetable="./a/a" sourcecolumn="s" into="n3">a.s as s, /*Период с*//*number*/
</column><column table="s" column="name" as="s_x_n" title="Период с" key="0" used="1" type="string" into="s4">s.name as s_x_n, /*Период с*//*string*/
</column><column table="a" column="po" as="po" title="Период по" key="0" used="1" type="number" sourcetable="./a/a" sourcecolumn="po" into="n4">a.po as po, /*Период по*//*number*/
</column><column table="po" column="name" as="po_x_n" title="Период по" key="0" used="1" type="string" into="s5">po.name as po_x_n, /*Период по*//*string*/
</column><column table="a" column="kod_fl" as="kod_fl" title="Код филиала" key="0" used="1" type="number" sourcetable="./a/a" sourcecolumn="kod_fl" reference="jv_rep_cons_d_fl" refcol="kod_fl" into="n5">a.kod_fl as kod_fl, /*Код филиала*//*number*/
</column><column table="kod_fl" column="name" as="kod_fl_x_n" title="Код филиала" key="0" used="1" type="string" sourcetable="./a/kod_fl" sourcecolumn="name" into="s6">kod_fl.name as kod_fl_x_n, /*Код филиала*//*string*/
</column><column table="a" column="kol_gr_comment" as="kol_gr_comment" title="Дополнение" key="0" used="1" type="string" sourcetable="./a/a" sourcecolumn="kol_gr_comment" into="s7">a.kol_gr_comment as kol_gr_comment/*Дополнение*//*string*/
</column></select>
                <from>
from <query name="vb_kol_gr_nastr" as="a" path="./a/a" haskeys="1" used="1">(
<select>--vb_kol_gr_nastr
select <column type="number" table="a" column="kod_kol_gr_nastr" key="1" as="kod_kol_gr_nastr" sourcetable="./a/a" sourcecolumn="kod_kol_gr_nastr" used="1">a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
</column><column type="number" table="a" column="kod_kol_gr" title="Код кольцевой группы" as="kod_kol_gr" reference="vb_kol_gr" refcol="kod_kol_gr" key="0" sourcetable="./a/a" sourcecolumn="kod_kol_gr" used="1">a.kod_kol_gr as kod_kol_gr, /*Код кольцевой группы*//*number*/
</column><column type="string" table="a" column="name" data-size="4000" title="Наименование" as="name" key="0" sourcetable="./a/a" sourcecolumn="name" used="1">a.name as name, /*Наименование*//*string*/
</column><call function="if" type="string" as="name_exp" pth="" key="0" used="1" title="Наименование"><text txtype="func"> case </text><text txtype="func"> when </text><call function="is null" pth="" type="bool">(<column type="string" table="a" column="name" data-size="4000" title="Наименование" as="name" thissrc="name">a.name</column><text txtype="func"> is null </text>) </call><text txtype="func"> then </text><const comment="хотел поставит замещающий текст но передумал"><text>''</text></const><text txtype="func"> else </text><column type="string" table="a" column="name" data-size="4000" title="Наименование" as="name" thissrc="name">a.name</column><text txtype="func"> end </text> as name_exp, /*Наименование*//*string*/
</call><column type="number" table="a" column="s" title="Период с" as="s" key="0" sourcetable="./a/a" sourcecolumn="s" used="1">a.s as s, /*Период с*//*number*/
</column><column type="number" table="a" column="po" title="Период по" as="po" key="0" sourcetable="./a/a" sourcecolumn="po" used="1">a.po as po, /*Период по*//*number*/
</column><column type="number" table="a" column="kod_fl" title="Код филиала" as="kod_fl" reference="jv_rep_cons_d_fl" refcol="kod_fl" key="0" sourcetable="./a/a" sourcecolumn="kod_fl" used="1">a.kod_fl as kod_fl, /*Код филиала*//*number*/
</column><column table="a" column="kol_gr_comment" type="string" title="Дополнение" as="kol_gr_comment" key="0" sourcetable="./a/a" sourcecolumn="kol_gr_comment" used="1">a.kol_gr_comment as kol_gr_comment/*Дополнение*//*string*/
</column></select><from>
from <table name="vb_kol_gr_nastr" as="a" used="1">vb_kol_gr_nastr
a
--\vb_kol_gr_nastr
</table></from>)
a
--\vb_kol_gr_nastr
</query><query name="jv_rep_cons_d_fl" as="kod_fl" join="left outer" path="./a/kod_fl" order="a.name" haskeys="1" used="1">left outer join
(
<order notext="1"><column column="a.name">a.name</column></order><select>--jv_rep_cons_d_fl
select <column table="a" column="kod_fl" type="number" as="kod_fl" key="1" fixed="1" sourcetable="./a/kod_fl" sourcecolumn="kod_fl" used="1">a.kod_fl as kod_fl, /*number*//*key*/
</column><column table="a" column="name" type="string" title="Филиал" is-name="1" vid="1" as="name" key="0" sourcetable="./a/kod_fl" sourcecolumn="name" used="1">a.name as name/*Филиал*//*string*/
</column></select><from>
from <table name="jv_rep_cons_d_fl" as="a" title="изм1: Код филиала" used="1">jv_rep_cons_d_fl
a
--\jv_rep_cons_d_fl
</table></from><call function="=" type="bool">)
kod_fl on <column table="a" column="kod_fl">a.kod_fl</column><text txtype="func"> = </text><column table="kod_fl" column="kod_fl">kod_fl.kod_fl</column></call>--\jv_rep_cons_d_fl
</query><query name="spr_time_ym" as="po" join="left outer" path="./a/po" order="ym desc" haskeys="1" used="1">left outer join
(
<order notext="1"><column column="ym">ym</column></order><select>--spr_time_ym
select <column table="a" column="ym" key="1" as="ym" used="1" type="number">a.ym as ym, /*number*//*key*/
</column><column table="a" column="name" vid="1" is-name="1" as="name" key="0" used="1" type="string" title="Период">a.name as name/*Период*//*string*/
</column></select><from>
from <query name="spr_time_ym_pre" as="a" path="./a/po/a" order="ym" haskeys="1" used="1">(
<order notext="1"><column column="ym">ym</column></order><select>--spr_time_ym_pre
select <call function="date to ym" as="ym" key="1" group="1" pth="" type="number" used="1"><text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text> as ym, /*number*//*key*/
</call><call function="ym to char" as="name" title="Период" key="0" group="max" pth="" type="string" used="1">max(<text txtype="func"> trim(to_char( </text><call function="date to ym" as="ym" key="1" pth="" type="number" thissrc="ym">(<text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text>) </call><text txtype="func"> ,'9999.99')) </text>)  as name/*Период*//*string*/
</call></select><from>
from <table name="vv_day" as="a" used="1">vv_day
a
--\vv_day
</table></from><group> group by
<call function="date to ym" as="ym" key="1" group="1" pth="" type="number" used="1"><text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text>/*number*//*key*/
</call></group><order>
order by ym</order>)
a
--\spr_time_ym_pre
</query></from><call function="=" type="bool">)
po on <column table="po" column="ym">po.ym</column><text txtype="func"> = </text><column table="a" column="po">a.po</column></call>--\spr_time_ym
</query><query name="spr_time_ym" as="s" join="left outer" path="./a/s" order="ym desc" haskeys="1" used="1">left outer join
(
<order notext="1"><column column="ym">ym</column></order><select>--spr_time_ym
select <column table="a" column="ym" key="1" as="ym" used="1" type="number">a.ym as ym, /*number*//*key*/
</column><column table="a" column="name" vid="1" is-name="1" as="name" key="0" used="1" type="string" title="Период">a.name as name/*Период*//*string*/
</column></select><from>
from <query name="spr_time_ym_pre" as="a" path="./a/s/a" order="ym" haskeys="1" used="1">(
<order notext="1"><column column="ym">ym</column></order><select>--spr_time_ym_pre
select <call function="date to ym" as="ym" key="1" group="1" pth="" type="number" used="1"><text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text> as ym, /*number*//*key*/
</call><call function="ym to char" as="name" title="Период" key="0" group="max" pth="" type="string" used="1">max(<text txtype="func"> trim(to_char( </text><call function="date to ym" as="ym" key="1" pth="" type="number" thissrc="ym">(<text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text>) </call><text txtype="func"> ,'9999.99')) </text>)  as name/*Период*//*string*/
</call></select><from>
from <table name="vv_day" as="a" used="1">vv_day
a
--\vv_day
</table></from><group> group by
<call function="date to ym" as="ym" key="1" group="1" pth="" type="number" used="1"><text txtype="func"> to_number(to_char( </text><column table="a" column="dat_day">a.dat_day</column><text txtype="func"> ,'YYYYMM'))/100 </text>/*number*//*key*/
</call></group><order>
order by ym</order>)
a
--\spr_time_ym_pre
</query></from><call function="=" type="bool">)
s on <column table="a" column="s">a.s</column><text txtype="func"> = </text><column table="s" column="ym">s.ym</column></call>--\spr_time_ym
</query><query name="vb_kol_gr" as="kod_kol_gr" join="left outer" path="./a/kod_kol_gr" order="kod_kol_gr" haskeys="1" used="1">left outer join
(
<order notext="1"><column column="kod_kol_gr">kod_kol_gr</column></order><select>--vb_kol_gr
select <column type="number" table="a" column="kod_kol_gr" key="1" as="kod_kol_gr" sourcetable="./a/kod_kol_gr" sourcecolumn="kod_kol_gr" used="1">a.kod_kol_gr as kod_kol_gr, /*number*//*key*/
</column><column type="string" table="a" column="name" data-size="4000" title="Наименование" as="name" key="0" sourcetable="./a/kod_kol_gr" sourcecolumn="name" used="1">a.name as name/*Наименование*//*string*/
</column></select><from>
from <table name="vb_kol_gr" as="a" used="1">vb_kol_gr
a
--\vb_kol_gr
</table></from><call function="=" type="bool">)
kod_kol_gr on <column table="a" column="kod_kol_gr">a.kod_kol_gr</column><text txtype="func"> = </text><column table="kod_kol_gr" column="kod_kol_gr">kod_kol_gr.kod_kol_gr</column></call>--\vb_kol_gr
</query></from>
                <where>where
<call function="and" pth="" type="bool"><call function="le" pth="" type="bool">(<call function="rownum" pth="0" type="number"><text txtype="func"> rownum </text></call><text txtype="func"> &lt;= </text><const><text>:p_rows_limit </text></const>) </call><text txtype="func"> { </text><text txtype="func"> and </text><call function="in" pth="" optional="1" type="bool">(<column table="a" column="kod_kol_gr_nastr" as="kod_kol_gr_nastr" title="" key="1" thissrc="kod_kol_gr_nastr">a.kod_kol_gr_nastr</column><text txtype="func"> in </text><const><text>:pk_prm </text></const>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kod_kol_gr_nastr" as="kod_kol_gr_nastr" title="" key="1" thissrc="kod_kol_gr_nastr">a.kod_kol_gr_nastr</column><text txtype="func"> ) like lower( </text><const><text>:kod_kol_gr_nastr_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kod_kol_gr" as="kod_kol_gr" title="Код кольцевой группы" thissrc="kod_kol_gr">a.kod_kol_gr</column><text txtype="func"> ) like lower( </text><const><text>:kod_kol_gr_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="kod_kol_gr" column="name" as="kod_kol_gr_x_n" title="Код кольцевой группы" thissrc="kod_kol_gr_x_n">kod_kol_gr.name</column><text txtype="func"> ) like lower( </text><const><text>:kod_kol_gr_x_n_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="name" as="name" title="Наименование" thissrc="name">a.name</column><text txtype="func"> ) like lower( </text><const><text>:name_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="name_exp" as="name_exp" title="Наименование" thissrc="name_exp">a.name_exp</column><text txtype="func"> ) like lower( </text><const><text>:name_exp_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="s" as="s" title="Период с" thissrc="s">a.s</column><text txtype="func"> ) like lower( </text><const><text>:s_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="s" column="name" as="s_x_n" title="Период с" thissrc="s_x_n">s.name</column><text txtype="func"> ) like lower( </text><const><text>:s_x_n_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="po" as="po" title="Период по" thissrc="po">a.po</column><text txtype="func"> ) like lower( </text><const><text>:po_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="po" column="name" as="po_x_n" title="Период по" thissrc="po_x_n">po.name</column><text txtype="func"> ) like lower( </text><const><text>:po_x_n_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kod_fl" as="kod_fl" title="Код филиала" thissrc="kod_fl">a.kod_fl</column><text txtype="func"> ) like lower( </text><const><text>:kod_fl_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="kod_fl" column="name" as="kod_fl_x_n" title="Код филиала" thissrc="kod_fl_x_n">kod_fl.name</column><text txtype="func"> ) like lower( </text><const><text>:kod_fl_x_n_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="kol_gr_comment" as="kol_gr_comment" title="Дополнение" thissrc="kol_gr_comment">a.kol_gr_comment</column><text txtype="func"> ) like lower( </text><const><text>:kol_gr_comment_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text></call></where>--\a
</query>
            </root>
          </sel-list-compiled>
          <sel-list-report>
            <report name="a" class="1" timestamp="03.10.2022 13:41:40" file="sql.builder.templates\sql.builder\projects\asuse2_scheme\scheme\original\vb_kol_gr_nastr.xml" elid="3033" ord="3033" leaf="0" lvl="2" pelid="" haskeys="1" as="a">
              <queries>
                <query class="1" timestamp="03.10.2022 13:41:40" file="sql.builder.templates\sql.builder\projects\asuse2_scheme\scheme\original\vb_kol_gr_nastr.xml" elid="3033" ord="3033" leaf="0" lvl="2" pelid="" haskeys="1" name="a" as="a">
                  <params>
                    <param name="pk_prm" type="array" />
                    <param name="kod_kol_gr_nastr_filter" type="string" />
                    <param name="kod_kol_gr_filter" type="string" />
                    <param name="kod_kol_gr_x_n_filter" type="string" />
                    <param name="name_filter" type="string" />
                    <param name="name_exp_filter" type="string" />
                    <param name="s_filter" type="string" />
                    <param name="s_x_n_filter" type="string" />
                    <param name="po_filter" type="string" />
                    <param name="po_x_n_filter" type="string" />
                    <param name="kod_fl_filter" type="string" />
                    <param name="kod_fl_x_n_filter" type="string" />
                    <param name="kol_gr_comment_filter" type="string" />
                    <param name="p_rows_limit" type="number" />
                  </params>
                  <select>
                    <column table="a" column="kod_kol_gr_nastr" as="kod_kol_gr_nastr" title="" key="1" />
                    <column table="a" column="kod_kol_gr" as="kod_kol_gr" title="Код кольцевой группы" />
                    <column table="kod_kol_gr" column="name" as="kod_kol_gr_x_n" title="Код кольцевой группы" />
                    <column table="a" column="name" as="name" title="Наименование" />
                    <column table="a" column="name_exp" as="name_exp" title="Наименование" />
                    <column table="a" column="s" as="s" title="Период с" />
                    <column table="s" column="name" as="s_x_n" title="Период с" />
                    <column table="a" column="po" as="po" title="Период по" />
                    <column table="po" column="name" as="po_x_n" title="Период по" />
                    <column table="a" column="kod_fl" as="kod_fl" title="Код филиала" />
                    <column table="kod_fl" column="name" as="kod_fl_x_n" title="Код филиала" />
                    <column table="a" column="kol_gr_comment" as="kol_gr_comment" title="Дополнение" />
                  </select>
                  <from>
                    <query name="vb_kol_gr_nastr" as="a">
                      <link name="kod_kol_gr" as="kod_kol_gr" table="vb_kol_gr" child="vb_kol_gr_nastr" field="kod_kol_gr" parent="vb_kol_gr" back="vb_kol_gr_nastr" />
                      <link name="s" as="s" table="spr_time_ym" child="vb_kol_gr_nastr" field="s" parent="spr_time_ym" back="vb_kol_gr_nastr" />
                      <link name="po" as="po" table="spr_time_ym" child="vb_kol_gr_nastr" field="po" parent="spr_time_ym" back="vb_kol_gr_nastr" />
                      <link name="kod_fl" as="kod_fl" table="jv_rep_cons_d_fl" child="vb_kol_gr_nastr" field="kod_fl" parent="jv_rep_cons_d_fl" back="vb_kol_gr_nastr" title="изм1: Код филиала" />
                    </query>
                  </from>
                  <where>
                    <call function="and">
                      <call function="le">
                        <call function="rownum" />
                        <useparam name="p_rows_limit" />
                      </call>
                      <call function="in" optional="1">
                        <column table="this" column="kod_kol_gr_nastr" />
                        <useparam name="pk_prm" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_kol_gr_nastr" />
                        <useparam name="kod_kol_gr_nastr_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_kol_gr" />
                        <useparam name="kod_kol_gr_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_kol_gr_x_n" />
                        <useparam name="kod_kol_gr_x_n_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="name" />
                        <useparam name="name_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="name_exp" />
                        <useparam name="name_exp_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="s" />
                        <useparam name="s_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="s_x_n" />
                        <useparam name="s_x_n_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="po" />
                        <useparam name="po_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="po_x_n" />
                        <useparam name="po_x_n_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_fl" />
                        <useparam name="kod_fl_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kod_fl_x_n" />
                        <useparam name="kod_fl_x_n_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="kol_gr_comment" />
                        <useparam name="kol_gr_comment_filter" />
                      </call>
                    </call>
                  </where>
                  <withparams>
                    <useparam name="pk_prm" />
                    <useparam name="kod_kol_gr_nastr_filter" />
                    <useparam name="kod_kol_gr_filter" />
                    <useparam name="kod_kol_gr_x_n_filter" />
                    <useparam name="name_filter" />
                    <useparam name="name_exp_filter" />
                    <useparam name="s_filter" />
                    <useparam name="s_x_n_filter" />
                    <useparam name="po_filter" />
                    <useparam name="po_x_n_filter" />
                    <useparam name="kod_fl_filter" />
                    <useparam name="kod_fl_x_n_filter" />
                    <useparam name="kol_gr_comment_filter" />
                    <useparam name="p_rows_limit" />
                  </withparams>
                </query>
              </queries>
              <params>
                <param name="pk_prm" type="array">
                  <const>:pk_prm </const>
                </param>
                <param name="kod_kol_gr_nastr_filter" type="string">
                  <const>:kod_kol_gr_nastr_filter </const>
                </param>
                <param name="kod_kol_gr_filter" type="string">
                  <const>:kod_kol_gr_filter </const>
                </param>
                <param name="kod_kol_gr_x_n_filter" type="string">
                  <const>:kod_kol_gr_x_n_filter </const>
                </param>
                <param name="name_filter" type="string">
                  <const>:name_filter </const>
                </param>
                <param name="name_exp_filter" type="string">
                  <const>:name_exp_filter </const>
                </param>
                <param name="s_filter" type="string">
                  <const>:s_filter </const>
                </param>
                <param name="s_x_n_filter" type="string">
                  <const>:s_x_n_filter </const>
                </param>
                <param name="po_filter" type="string">
                  <const>:po_filter </const>
                </param>
                <param name="po_x_n_filter" type="string">
                  <const>:po_x_n_filter </const>
                </param>
                <param name="kod_fl_filter" type="string">
                  <const>:kod_fl_filter </const>
                </param>
                <param name="kod_fl_x_n_filter" type="string">
                  <const>:kod_fl_x_n_filter </const>
                </param>
                <param name="kol_gr_comment_filter" type="string">
                  <const>:kol_gr_comment_filter </const>
                </param>
                <param name="p_rows_limit" type="number">
                  <const>:p_rows_limit </const>
                </param>
              </params>
            </report>
          </sel-list-report>
          <sel-list-pars>
            <params />
          </sel-list-pars>
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_kol_gr_tp_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_kol_gr_tp_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select tp.kod_kol_gr_nastr as kod_kol_gr_nastr, /*Код настройки кольцевой группы*//*number*/
tp.kod_kol_gr_tp as kod_kol_gr_tp/*number*//*key*/

from (
--vb_kol_gr_tp
select a.kod_kol_gr_tp as kod_kol_gr_tp, /*number*//*key*/
kod_kol_gr_pwrc.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from (select a.kod_kol_gr_tp as kod_kol_gr_tp,a.kod_kol_gr_fdr as kod_kol_gr_fdr  from vb_kol_gr_tp a where not exists (select * from rr_temp t where t.skod ='tp' and t.names=:form_id  and a.kod_kol_gr_tp=t.f2 ) and   a.kod_kol_gr_tp in :kod_kol_gr_tp_prm   union all  select t.n1 as kod_kol_gr_tp,t.n2 as kod_kol_gr_fdr  from rr_temp t where t.skod ='tp' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_tp_prm )
a
--\(select a.kod_kol_gr_tp as kod_kol_gr_tp,a.kod_kol_gr_fdr as kod_kol_gr_fdr  from vb_kol_gr_tp a where not exists (select * from rr_temp t where t.skod ='tp' and t.names=:form_id  and a.kod_kol_gr_tp=t.f2 ) and   a.kod_kol_gr_tp in :kod_kol_gr_tp_prm   union all  select t.n1 as kod_kol_gr_tp,t.n2 as kod_kol_gr_fdr  from rr_temp t where t.skod ='tp' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_tp_prm )
left outer join
(
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.kod_kol_gr_pwrc as kod_kol_gr_pwrc/*Код настройки ПС*//*number*/

from vb_kol_gr_fdr
a
--\vb_kol_gr_fdr
)
kod_kol_gr_fdr on a.kod_kol_gr_fdr = kod_kol_gr_fdr.kod_kol_gr_fdr--\vb_kol_gr_fdr
left outer join
(
--vb_kol_gr_pwrc
select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from vb_kol_gr_pwrc
a
--\vb_kol_gr_pwrc
)
kod_kol_gr_pwrc on kod_kol_gr_fdr.kod_kol_gr_pwrc = kod_kol_gr_pwrc.kod_kol_gr_pwrc--\vb_kol_gr_pwrc
)
tp
--\vb_kol_gr_tp
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:kod_kol_gr_tp as kod_kol_gr_tp 
 
from dual ) 
 
loop 
insert into vb_kol_gr_tp 
(kod_kol_gr_tp 
) 
 values  
(r.kod_kol_gr_tp 
) 
 returning  
kod_kol_gr_tp into :kod_kol_gr_tp; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from vb_kol_gr_tp where kod_kol_gr_tp=:kod_kol_gr_tp</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='tp' 
and 
names=:form_id 
and 
f2=:kod_kol_gr_tp; 
if :row_state_id=1  then 
for r in  
 ( select  
:kod_kol_gr_tp as kod_kol_gr_tp 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
) 
 values  
('tp' 
,:form_id 
,:kod_kol_gr_tp 
,:row_state_id 
,r.kod_kol_gr_tp 
); 
end loop; 
else 
for r in  
 ( select  
:kod_kol_gr_tp as kod_kol_gr_tp 
,a.kod_kol_gr_fdr 
,a.src_id 
,a.u_m 
,a.d_m 
 
from vb_kol_gr_tp a  where kod_kol_gr_tp=:kod_kol_gr_tp) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,n2 
,n3 
,s1 
,d1 
) 
 values  
('tp' 
,:form_id 
,:kod_kol_gr_tp 
,:row_state_id 
,r.kod_kol_gr_tp 
,r.kod_kol_gr_fdr 
,r.src_id 
,r.u_m 
,r.d_m 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='tp' and names=:form_id</clear-temp-text>
      <update-text>begin
update vb_kol_gr_tp set  
(kod_kol_gr_tp 
) 
= 
 ( select  
:kod_kol_gr_tp as kod_kol_gr_tp 
 
from dual ) 
 
where 
kod_kol_gr_tp=:kod_kol_gr_tp 
;
end;
</update-text>
      <scheme>
        <table name="vb_kol_gr_tp" as="tp">
          <columns>
            <column name="srcname" type="string" title="ТП" />
            <column name="pwrc_fdrname" type="string" title="Фидер" />
            <column name="pwrcname" type="string" title="ПС" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_tp" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_nastr" type="number" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <column name="srcname" type="string" title="ТП" />
            <column name="pwrc_fdrname" type="string" title="Фидер" />
            <column name="pwrcname" type="string" title="ПС" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_tp" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_kol_gr_nastr" type="number" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="kod_kol_gr_tp_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="kod_kol_gr_tp_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select hv_eopwrc_grid_id.srcname as srcname, /*ТП*//*string*/
hv_eopwrc_grid_id.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
hv_eopwrc_grid_id.pwrcname as pwrcname, /*ПС*//*string*/
tp.is_new as is_new, /*number*/
tp.is_not_new as is_not_new, /*number*/
tp.kod_kol_gr_tp as kod_kol_gr_tp, /*number*//*key*/
tp.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from (
--vb_kol_gr_tp
select a.kod_kol_gr_tp as kod_kol_gr_tp, /*number*//*key*/
a.src_id as src_id, /*Код ТП*//*number*/
kod_kol_gr_fdr.pwrc_fdrid as pwrc_fdrid, /*Код фидера*//*number*/
kod_kol_gr_pwrc.kod_kol_gr_nastr as kod_kol_gr_nastr, /*Код настройки кольцевой группы*//*number*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.kod_kol_gr_tp as kod_kol_gr_tp,a.src_id as src_id,0 as is_new,1 as is_not_new,a.kod_kol_gr_fdr as kod_kol_gr_fdr  from vb_kol_gr_tp a where not exists (select * from rr_temp t where t.skod ='tp' and t.names=:form_id  and a.kod_kol_gr_tp=t.f2 ) and   a.kod_kol_gr_tp in :kod_kol_gr_tp_prm   union all  select t.n1 as kod_kol_gr_tp,t.n3 as src_id,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new,t.n2 as kod_kol_gr_fdr  from rr_temp t where t.skod ='tp' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_tp_prm )
a
--\(select a.kod_kol_gr_tp as kod_kol_gr_tp,a.src_id as src_id,0 as is_new,1 as is_not_new,a.kod_kol_gr_fdr as kod_kol_gr_fdr  from vb_kol_gr_tp a where not exists (select * from rr_temp t where t.skod ='tp' and t.names=:form_id  and a.kod_kol_gr_tp=t.f2 ) and   a.kod_kol_gr_tp in :kod_kol_gr_tp_prm   union all  select t.n1 as kod_kol_gr_tp,t.n3 as src_id,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new,t.n2 as kod_kol_gr_fdr  from rr_temp t where t.skod ='tp' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_kol_gr_tp_prm )
left outer join
(
--vb_kol_gr_fdr
select a.kod_kol_gr_fdr as kod_kol_gr_fdr, /*number*//*key*/
a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*Код настройки ПС*//*number*/
a.pwrc_fdrid as pwrc_fdrid/*Код фидера*//*number*/

from vb_kol_gr_fdr
a
--\vb_kol_gr_fdr
)
kod_kol_gr_fdr on a.kod_kol_gr_fdr = kod_kol_gr_fdr.kod_kol_gr_fdr--\vb_kol_gr_fdr
left outer join
(
--vb_kol_gr_pwrc
select a.kod_kol_gr_pwrc as kod_kol_gr_pwrc, /*number*//*key*/
a.kod_kol_gr_nastr as kod_kol_gr_nastr/*Код настройки кольцевой группы*//*number*/

from vb_kol_gr_pwrc
a
--\vb_kol_gr_pwrc
)
kod_kol_gr_pwrc on kod_kol_gr_fdr.kod_kol_gr_pwrc = kod_kol_gr_pwrc.kod_kol_gr_pwrc--\vb_kol_gr_pwrc
)
tp
--\vb_kol_gr_tp
left outer join
(
--hv_eopwrc_grid
select a.pwrcname as pwrcname, /*ПС*//*string*/
a.pwrc_fdrid as pwrc_fdrid, /**//*number*/
a.pwrc_fdrname as pwrc_fdrname, /*Фидер*//*string*/
a.src_id as src_id, /**//*number*/
a.srcname as srcname/*ТП*//*string*/

from hv_eopwrc_grid
a
--\hv_eopwrc_grid
)
hv_eopwrc_grid_id on (tp.src_id = hv_eopwrc_grid_id.src_id)  and (tp.pwrc_fdrid = hv_eopwrc_grid_id.pwrc_fdrid) --\hv_eopwrc_grid

order by pwrcname, pwrc_fdrname, srcname--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
    <table name="kg_edit_allow_flag" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multi-select-column="" multi-select-target="" update-target="45862_vb_kol_gr_allow_edit" key="save_active" is-ms-upd="0" is-top="1">
      <select-text>
--
select kg_edit_allow_flag.save_active as save_active/*ym_editable*//*number*/

from (
--45862_vb_kol_gr_allow_edit
select  case  when (( nvl( ( nvl( (
--
select vb_kol_gr_nastr_sq.is_auto_kg as is_auto_kg/*number*/

from (
--vb_kol_gr_nastr
select a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
a.is_auto_kg as is_auto_kg/*number*/

from vb_kol_gr_nastr
a
--\vb_kol_gr_nastr
)
vb_kol_gr_nastr_sq
--\vb_kol_gr_nastr
where
vb_kol_gr_nastr_sq.kod_kol_gr_nastr = :kod_nastr )
--\
 ,0) )  ,0)=0 )  and (:ym  &gt;= (
--
select  max( vr_rb_filial_for_param_sq.ym )  as max_ym/*Отчетный период*//*aggregate*/

from (
--vr_rb_filial_for_param
select a.kod_fl as kod_fl, /*number*//*key*/
a.ym as ym/*Отчетный период*//*number*/

from vr_rb_filial
a
--\vr_rb_filial
)
vr_rb_filial_for_param_sq
--\vr_rb_filial_for_param
where
vr_rb_filial_for_param_sq.kod_fl = :kod_fl )
--\
)  and (:ym  = ( nvl( (
--
select  min( vb_kol_gr_nastr_sq.s ) /*Период с*//*aggregate*/

from (
--vb_kol_gr_nastr
select a.kod_kol_gr_nastr as kod_kol_gr_nastr, /*number*//*key*/
a.s as s/*Период с*//*number*/

from vb_kol_gr_nastr
a
--\vb_kol_gr_nastr
)
vb_kol_gr_nastr_sq
--\vb_kol_gr_nastr
where
vb_kol_gr_nastr_sq.kod_kol_gr_nastr = :kod_nastr )
--\
 , :ym  ) ) ) )  then 1 else 0 end  as save_active/*number*/

from (
--dual
select dual.dummy as dummy/*string*//*key*/

from dual
dual
--\dual
)
dual
--\dual
)
kg_edit_allow_flag
--\45862_vb_kol_gr_allow_edit
--\
</select-text>
      <columns>
        <column name="save_active" table="kg_edit_allow_flag" type="number" title="ym_editable" parname="save_active" ColumnVisible="0" is-refreshed="1" />
      </columns>
      <scheme>
        <table name="45862_vb_kol_gr_allow_edit" as="kg_edit_allow_flag">
          <columns>
            <column name="save_active" type="number" title="ym_editable" visible="0" />
          </columns>
          <viewcolumns />
        </table>
      </scheme>
    </table>
  </dataset>
</root>