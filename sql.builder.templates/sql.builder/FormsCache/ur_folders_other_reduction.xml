<?xml version="1.0" encoding="utf-8"?>
<root>
  <form name="ur_folders_other_reduction" form-size="932;732" security-id="asuse_ur_hist_mat" with-behavior="0" title="Исполнительные действия (оплаты)" timestamp="24.04.2025 16:27:37" file="sql.builder.templates\sql.builder\projects\asuse2\forms\Арбитраж\ur_folders_other_reduction.xml" elid="145" ord="145" leaf="0" lvl="2" pelid="">
    <grid table="deb_red" show-toolbar="1" id="62561513">
      <toolbar column-visible="true" id="24190448">
        <uicommand button-type="grid-save" column-visible="1" name="grid-save" control-name="ButtonCommit" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="366" ord="366" leaf="1" lvl="2" pelid="" title="" id="3531313" />
        <uicommand button-type="grid-add" column-visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="364" ord="364" leaf="1" lvl="2" pelid="" title="" id="31781818" />
        <uicommand button-type="grid-delete" column-visible="0" name="grid-delete" control-name="ButtonDeleteRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="368" ord="368" leaf="1" lvl="2" pelid="" title="" id="17600908" />
      </toolbar>
      <columns id="21864360">
        <field table="deb_red" name="prim" title="Исполнительные действия" width="177" controlType="UITextEx" rows-limit="100" id="13269308" />
        <field table="deb_red" name="num_opl" title="Платежный документ" width="106" controlType="UIText" rows-limit="100" width-perc="50" id="1072131" />
        <field table="deb_red" name="dat_opl" title="Дата уменьшения долга по ИП" width="150" controlType="UIDate" rows-limit="100" id="19733807" />
        <field table="deb_red" name="opl" title="Сумма уменьшения долга по ИП" width="125" controlType="UINumber" rows-limit="100" id="54934568" />
        <field table="deb_red" name="reason" title="Основание уменьшения долга по ИП" width="153" controlType="UICombo" rows-limit="100" id="20515029">
          <listquery id="57288858">
            <query name="uv_isp_other_reason_list" id="51104671" />
          </listquery>
        </field>
        <field table="deb_red" name="prim2" title="Комментарий" width="334" controlType="UITextEx" rows-limit="100" id="45837677" />
      </columns>
    </grid>
    <events>
      <useaction event-name="form-loaded" action-type="custom">
        <useaction name="ug_isp.fill_isp_deb_reduction">
          <useparam name="p_kod_isp_other" />
        </useaction>
        <useaction action-type="refresh-table" object="deb_red" />
      </useaction>
    </events>
  </form>
  <params>
    <param name="p_kod_isp_other" type="number">
      <const>2000000071</const>
    </param>
  </params>
  <dataset>
    <params>
      <param name="p_kod_isp_other" type="number">
        <const>2000000071</const>
      </param>
    </params>
    <fields>
      <field type="string" name="is_form_valid" parname="is_form_valid" />
      <field type="string" name="is_form_valid_not" parname="is_form_valid_not" />
      <field type="string" name="deb_red_has_changes" parname="deb_red_has_changes" />
    </fields>
    <table name="deb_red" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multi-select-column="" multi-select-target="" update-target="ur_deb_reduction" key="kod_deb_reduction" is-ms-upd="1" is-top="1">
      <select-text>
--
select deb_red.prim as prim, /*Исполнительные действия*//*string*/
deb_red.num_opl as num_opl, /*Платежный документ*//*string*/
deb_red.dat_opl as dat_opl, /*Дата уменьшения долга по ИП*//*date*/
deb_red.opl as opl, /*Сумма уменьшения долга по ИП*//*number*/
deb_red.reason as reason, /*Основание уменьшения долга по ИП*//*number*/
deb_red.prim2 as prim2, /*Комментарий*//*string*/
reason_x_n.name as reason_x_n, /*Основание уменьшения долга по ИП*//*string*/
deb_red.is_new as is_new, /*number*/
deb_red.is_not_new as is_not_new, /*number*/
deb_red.kod_deb_reduction as kod_deb_reduction/*number*//*key*/

from (
--ur_deb_reduction
select a.kod_deb_reduction as kod_deb_reduction, /*number*//*key*/
a.reduction_type as reduction_type, /**//*string*/
a.kod_pir_entity as kod_pir_entity, /*number*/
a.reason as reason, /**//*number*/
a.prim as prim, /**//*string*/
a.prim2 as prim2, /**//*string*/
kod_opl.opl as opl, /**//*number*/
kod_link.num_opl as num_opl, /**//*string*/
kod_link.dat_opl as dat_opl, /**//*date*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from ur_deb_reduction
a
--\ur_deb_reduction
left outer join
(
--sr_opl_bank
select a.kod_link as kod_link, /*number*//*key*/
a.dat_opl as dat_opl, /*Дата оплаты*//*date*/
a.num_opl as num_opl/*Номер документа оплаты*//*string*/

from sr_opl_bank
a
--\sr_opl_bank
)
kod_link on a.kod_link = kod_link.kod_link--\sr_opl_bank
left outer join
(
--sr_opl
select a.kod_opl as kod_opl, /*number*//*key*/
a.opl as opl/**//*number*/

from sr_opl
a
--\sr_opl
)
kod_opl on a.kod_opl = kod_opl.kod_opl--\sr_opl
)
deb_red
--\ur_deb_reduction
left outer join
(
--ur_isp_other_reason
select a.id as id, /*number*//*key*/
a.name as name/*Наименование*//*string*/

from ur_isp_other_reason
a
--\ur_isp_other_reason
)
reason_x_n on deb_red.reason = reason_x_n.id--\ur_isp_other_reason
where
(deb_red.kod_pir_entity = :p_kod_isp_other )  and (deb_red.reduction_type = 'ISP') --\
</select-text>
      <columns>
        <column name="prim" table="deb_red" type="string" title="Исполнительные действия" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="prim" temp-col-name="s1" />
        <column name="num_opl" table="deb_red" type="string" title="Платежный документ" is-user-editable="1" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_deb_reduction_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_deb_reduction_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select deb_red.num_opl as num_opl, /*Платежный документ*//*string*/
deb_red.kod_deb_reduction as kod_deb_reduction/*number*//*key*/

from (
--ur_deb_reduction
select a.kod_deb_reduction as kod_deb_reduction, /*number*//*key*/
kod_link.num_opl as num_opl/**//*string*/

from (select a.kod_deb_reduction as kod_deb_reduction,a.kod_link as kod_link  from ur_deb_reduction a where not exists (select * from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and a.kod_deb_reduction=t.f2 ) and   a.kod_deb_reduction in :kod_deb_reduction_prm   union all  select t.n2 as kod_deb_reduction,t.n5 as kod_link  from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_deb_reduction_prm )
a
--\(select a.kod_deb_reduction as kod_deb_reduction,a.kod_link as kod_link  from ur_deb_reduction a where not exists (select * from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and a.kod_deb_reduction=t.f2 ) and   a.kod_deb_reduction in :kod_deb_reduction_prm   union all  select t.n2 as kod_deb_reduction,t.n5 as kod_link  from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_deb_reduction_prm )
left outer join
(
--sr_opl_bank
select a.kod_link as kod_link, /*number*//*key*/
a.num_opl as num_opl/*Номер документа оплаты*//*string*/

from sr_opl_bank
a
--\sr_opl_bank
)
kod_link on a.kod_link = kod_link.kod_link--\sr_opl_bank
)
deb_red
--\ur_deb_reduction
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="dat_opl" table="deb_red" type="date" title="Дата уменьшения долга по ИП" is-user-editable="1" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_deb_reduction_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_deb_reduction_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select deb_red.dat_opl as dat_opl, /*Дата уменьшения долга по ИП*//*date*/
deb_red.kod_deb_reduction as kod_deb_reduction/*number*//*key*/

from (
--ur_deb_reduction
select a.kod_deb_reduction as kod_deb_reduction, /*number*//*key*/
kod_link.dat_opl as dat_opl/**//*date*/

from (select a.kod_deb_reduction as kod_deb_reduction,a.kod_link as kod_link  from ur_deb_reduction a where not exists (select * from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and a.kod_deb_reduction=t.f2 ) and   a.kod_deb_reduction in :kod_deb_reduction_prm   union all  select t.n2 as kod_deb_reduction,t.n5 as kod_link  from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_deb_reduction_prm )
a
--\(select a.kod_deb_reduction as kod_deb_reduction,a.kod_link as kod_link  from ur_deb_reduction a where not exists (select * from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and a.kod_deb_reduction=t.f2 ) and   a.kod_deb_reduction in :kod_deb_reduction_prm   union all  select t.n2 as kod_deb_reduction,t.n5 as kod_link  from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_deb_reduction_prm )
left outer join
(
--sr_opl_bank
select a.kod_link as kod_link, /*number*//*key*/
a.dat_opl as dat_opl/*Дата оплаты*//*date*/

from sr_opl_bank
a
--\sr_opl_bank
)
kod_link on a.kod_link = kod_link.kod_link--\sr_opl_bank
)
deb_red
--\ur_deb_reduction
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="opl" table="deb_red" type="number" title="Сумма уменьшения долга по ИП" is-user-editable="1" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_deb_reduction_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_deb_reduction_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select deb_red.opl as opl, /*Сумма уменьшения долга по ИП*//*number*/
deb_red.kod_deb_reduction as kod_deb_reduction/*number*//*key*/

from (
--ur_deb_reduction
select a.kod_deb_reduction as kod_deb_reduction, /*number*//*key*/
kod_opl.opl as opl/**//*number*/

from (select a.kod_deb_reduction as kod_deb_reduction,a.kod_opl as kod_opl  from ur_deb_reduction a where not exists (select * from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and a.kod_deb_reduction=t.f2 ) and   a.kod_deb_reduction in :kod_deb_reduction_prm   union all  select t.n2 as kod_deb_reduction,t.n6 as kod_opl  from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_deb_reduction_prm )
a
--\(select a.kod_deb_reduction as kod_deb_reduction,a.kod_opl as kod_opl  from ur_deb_reduction a where not exists (select * from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and a.kod_deb_reduction=t.f2 ) and   a.kod_deb_reduction in :kod_deb_reduction_prm   union all  select t.n2 as kod_deb_reduction,t.n6 as kod_opl  from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_deb_reduction_prm )
left outer join
(
--sr_opl
select a.kod_opl as kod_opl, /*number*//*key*/
a.opl as opl/**//*number*/

from sr_opl
a
--\sr_opl
)
kod_opl on a.kod_opl = kod_opl.kod_opl--\sr_opl
)
deb_red
--\ur_deb_reduction
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="reason" table="deb_red" type="number" title="Основание уменьшения долга по ИП" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="reason" temp-col-name="n1">
          <sel-list-compiled>
            <root>
              <query order="name" class="1" file="sql.builder.templates\sql.builder\projects\asuse2_scheme\scheme\original\ur_isp_other_reason.xml" haskeys="1" name="a" as="a" noname="1" path="./a" used="1">
                <order notext="1">
                  <column column="name">name</column>
                </order>
                <select>--a
select <column table="a" column="id" type="number" column-mandatory="1" as="id" key="1" fixed="1" sourcetable="./a" sourcecolumn="id" used="1" into="n1">a.id as id, /*number*//*key*/
</column><column table="a" column="name" type="string" data-size="250" title="Наименование" as="name" key="0" sourcetable="./a" sourcecolumn="name" used="1" into="s1">a.name as name, /*Наименование*//*string*/
</column><column table="a" column="is_new" type="number" sys="1" as="is_new" key="0" sourcetable="./a" sourcecolumn="is_new" used="1" into="n2">0 as is_new, /*number*/
</column><column table="a" column="is_not_new" type="number" sys="1" as="is_not_new" key="0" sourcetable="./a" sourcecolumn="is_not_new" used="1" into="n3">1 as is_not_new/*number*/
</column></select>
                <from>
from <table name="ur_isp_other_reason" as="a" used="1">ur_isp_other_reason
a
--\ur_isp_other_reason
</table></from>
                <where>where
<call function="and" pth="" type="bool"><call function="le" pth="" type="bool">(<call function="rownum" pth="0" type="number"><text txtype="func"> rownum </text></call><text txtype="func"> &lt;= </text><const><text>:p_rows_limit </text></const>) </call><text txtype="func"> and </text><call function="gt" pth="" type="bool">(<column table="a" column="id">a.id</column><text txtype="func"> &gt; </text><const><text>0</text></const>) </call><text txtype="func"> { </text><text txtype="func"> and </text><call function="in" pth="" optional="1" type="bool">(<column table="a" column="id" type="number" column-mandatory="1" as="id" key="1" fixed="1" sourcetable="./a" sourcecolumn="id" thissrc="id">a.id</column><text txtype="func"> in </text><const><text>:pk_prm </text></const>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="id" type="number" column-mandatory="1" as="id" key="1" fixed="1" sourcetable="./a" sourcecolumn="id" thissrc="id">a.id</column><text txtype="func"> ) like lower( </text><const><text>:id_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="name" type="string" data-size="250" title="Наименование" as="name" key="0" sourcetable="./a" sourcecolumn="name" thissrc="name">a.name</column><text txtype="func"> ) like lower( </text><const><text>:name_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="is_new" type="number" sys="1" as="is_new" key="0" sourcetable="./a" sourcecolumn="is_new" thissrc="is_new">0</column><text txtype="func"> ) like lower( </text><const><text>:is_new_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text><text txtype="func"> { </text><text txtype="func"> and </text><call function="like" pth="" optional="1" type="bool">(<text txtype="func"> lower( </text><column table="a" column="is_not_new" type="number" sys="1" as="is_not_new" key="0" sourcetable="./a" sourcecolumn="is_not_new" thissrc="is_not_new">1</column><text txtype="func"> ) like lower( </text><const><text>:is_not_new_filter </text></const><text txtype="func"> ) </text>) </call><text txtype="func"> } </text></call></where>
                <order>
order by name</order>--\a
</query>
            </root>
          </sel-list-compiled>
          <sel-list-report>
            <report name="a" order="name" class="1" file="sql.builder.templates\sql.builder\projects\asuse2_scheme\scheme\original\ur_isp_other_reason.xml" haskeys="1" as="a">
              <queries>
                <query order="name" class="1" file="sql.builder.templates\sql.builder\projects\asuse2_scheme\scheme\original\ur_isp_other_reason.xml" haskeys="1" name="a" as="a">
                  <params>
                    <param name="pk_prm" type="array" />
                    <param name="id_filter" type="string" />
                    <param name="name_filter" type="string" />
                    <param name="is_new_filter" type="string" />
                    <param name="is_not_new_filter" type="string" />
                    <param name="p_rows_limit" type="number" />
                  </params>
                  <select>
                    <column table="a" column="id" type="number" column-mandatory="1" as="id" key="1" fixed="1" />
                    <column table="a" column="name" type="string" data-size="250" title="Наименование" as="name" key="0" />
                    <column table="a" column="is_new" type="number" sys="1" as="is_new" key="0" />
                    <column table="a" column="is_not_new" type="number" sys="1" as="is_not_new" key="0" />
                  </select>
                  <from>
                    <table name="ur_isp_other_reason" as="a" />
                  </from>
                  <where>
                    <call function="and">
                      <call function="le">
                        <call function="rownum" />
                        <useparam name="p_rows_limit" />
                      </call>
                      <call function="gt">
                        <column table="a" column="id" />
                        <const>0</const>
                      </call>
                      <call function="in" optional="1">
                        <column table="this" column="id" />
                        <useparam name="pk_prm" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="id" />
                        <useparam name="id_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="name" />
                        <useparam name="name_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="is_new" />
                        <useparam name="is_new_filter" />
                      </call>
                      <call function="like" optional="1">
                        <column table="this" column="is_not_new" />
                        <useparam name="is_not_new_filter" />
                      </call>
                    </call>
                  </where>
                  <order>
                    <column column="name" />
                  </order>
                  <order>
                    <column column="name" />
                  </order>
                  <withparams>
                    <useparam name="pk_prm" />
                    <useparam name="id_filter" />
                    <useparam name="name_filter" />
                    <useparam name="is_new_filter" />
                    <useparam name="is_not_new_filter" />
                    <useparam name="p_rows_limit" />
                  </withparams>
                </query>
              </queries>
              <params>
                <param name="pk_prm" type="array">
                  <const>:pk_prm </const>
                </param>
                <param name="id_filter" type="string">
                  <const>:id_filter </const>
                </param>
                <param name="name_filter" type="string">
                  <const>:name_filter </const>
                </param>
                <param name="is_new_filter" type="string">
                  <const>:is_new_filter </const>
                </param>
                <param name="is_not_new_filter" type="string">
                  <const>:is_not_new_filter </const>
                </param>
                <param name="p_rows_limit" type="number">
                  <const>:p_rows_limit </const>
                </param>
              </params>
            </report>
          </sel-list-report>
          <sel-list-cl-fact-pars />
          <dep-refresh-cmd>
            <root table="deb_red">
              <params>
                <param name="kod_deb_reduction_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_deb_reduction_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select reason_x_n.name as reason_x_n, /*Основание уменьшения долга по ИП*//*string*/
deb_red.kod_deb_reduction as kod_deb_reduction/*number*//*key*/

from (
--ur_deb_reduction
select a.kod_deb_reduction as kod_deb_reduction, /*number*//*key*/
a.reason as reason/**//*number*/

from (select a.kod_deb_reduction as kod_deb_reduction,a.reason as reason  from ur_deb_reduction a where not exists (select * from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and a.kod_deb_reduction=t.f2 ) and   a.kod_deb_reduction in :kod_deb_reduction_prm   union all  select t.n2 as kod_deb_reduction,t.n1 as reason  from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_deb_reduction_prm )
a
--\(select a.kod_deb_reduction as kod_deb_reduction,a.reason as reason  from ur_deb_reduction a where not exists (select * from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and a.kod_deb_reduction=t.f2 ) and   a.kod_deb_reduction in :kod_deb_reduction_prm   union all  select t.n2 as kod_deb_reduction,t.n1 as reason  from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_deb_reduction_prm )
)
deb_red
--\ur_deb_reduction
left outer join
(
--ur_isp_other_reason
select a.id as id, /*number*//*key*/
a.name as name/*Наименование*//*string*/

from ur_isp_other_reason
a
--\ur_isp_other_reason
)
reason_x_n on deb_red.reason = reason_x_n.id--\ur_isp_other_reason
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </dep-refresh-cmd>
          <dependants>
            <dependant name="reason_x_n" table="deb_red" />
          </dependants>
        </column>
        <column name="prim2" table="deb_red" type="string" title="Комментарий" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="prim2" temp-col-name="s3" />
        <column name="reason_x_n" table="deb_red.reason" type="string" title="Основание уменьшения долга по ИП" text-source-for="reason" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_deb_reduction_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_deb_reduction_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select reason_x_n.name as reason_x_n, /*Основание уменьшения долга по ИП*//*string*/
deb_red.kod_deb_reduction as kod_deb_reduction/*number*//*key*/

from (
--ur_deb_reduction
select a.kod_deb_reduction as kod_deb_reduction, /*number*//*key*/
a.reason as reason/**//*number*/

from (select a.kod_deb_reduction as kod_deb_reduction,a.reason as reason  from ur_deb_reduction a where not exists (select * from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and a.kod_deb_reduction=t.f2 ) and   a.kod_deb_reduction in :kod_deb_reduction_prm   union all  select t.n2 as kod_deb_reduction,t.n1 as reason  from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_deb_reduction_prm )
a
--\(select a.kod_deb_reduction as kod_deb_reduction,a.reason as reason  from ur_deb_reduction a where not exists (select * from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and a.kod_deb_reduction=t.f2 ) and   a.kod_deb_reduction in :kod_deb_reduction_prm   union all  select t.n2 as kod_deb_reduction,t.n1 as reason  from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_deb_reduction_prm )
)
deb_red
--\ur_deb_reduction
left outer join
(
--ur_isp_other_reason
select a.id as id, /*number*//*key*/
a.name as name/*Наименование*//*string*/

from ur_isp_other_reason
a
--\ur_isp_other_reason
)
reason_x_n on deb_red.reason = reason_x_n.id--\ur_isp_other_reason
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="is_new" table="deb_red" type="number" title="" is-user-editable="1" />
        <column name="is_not_new" table="deb_red" type="number" title="" is-user-editable="1" />
        <column name="kod_deb_reduction" table="deb_red" type="number" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kod_deb_reduction" temp-col-name="n2" />
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:prim as prim 
,:reason as reason 
,:prim2 as prim2 
,:kod_deb_reduction as kod_deb_reduction 
 
from dual ) 
 
loop 
insert into ur_deb_reduction 
(prim 
,reason 
,prim2 
,kod_deb_reduction 
) 
 values  
(r.prim 
,r.reason 
,r.prim2 
,r.kod_deb_reduction 
) 
 returning  
kod_deb_reduction into :kod_deb_reduction; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from ur_deb_reduction where kod_deb_reduction=:kod_deb_reduction</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='deb_red' 
and 
names=:form_id 
and 
f2=:kod_deb_reduction; 
if :row_state_id=1  then 
for r in  
 ( select  
:prim as prim 
,:reason as reason 
,:prim2 as prim2 
,:kod_deb_reduction as kod_deb_reduction 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,s1 
,n1 
,s3 
,n2 
) 
 values  
('deb_red' 
,:form_id 
,:kod_deb_reduction 
,:row_state_id 
,r.prim 
,r.reason 
,r.prim2 
,r.kod_deb_reduction 
); 
end loop; 
else 
for r in  
 ( select  
:prim as prim 
,:reason as reason 
,:prim2 as prim2 
,:kod_deb_reduction as kod_deb_reduction 
,a.reduction_type 
,a.kod_pir_entity 
,a.kod_dogplat 
,a.kod_link 
,a.kod_opl 
,a.u_m 
,a.d_m 
 
from ur_deb_reduction a  where kod_deb_reduction=:kod_deb_reduction) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,s1 
,n1 
,s3 
,n2 
,s2 
,n3 
,n4 
,n5 
,n6 
,s4 
,d1 
) 
 values  
('deb_red' 
,:form_id 
,:kod_deb_reduction 
,:row_state_id 
,r.prim 
,r.reason 
,r.prim2 
,r.kod_deb_reduction 
,r.reduction_type 
,r.kod_pir_entity 
,r.kod_dogplat 
,r.kod_link 
,r.kod_opl 
,r.u_m 
,r.d_m 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='deb_red' and names=:form_id</clear-temp-text>
      <update-text>begin
update ur_deb_reduction set  
(prim 
,reason 
,prim2 
,kod_deb_reduction 
) 
= 
 ( select  
:prim as prim 
,:reason as reason 
,:prim2 as prim2 
,:kod_deb_reduction as kod_deb_reduction 
 
from dual ) 
 
where 
kod_deb_reduction=:kod_deb_reduction 
;
end;
</update-text>
      <scheme>
        <table name="ur_deb_reduction" as="deb_red">
          <columns>
            <column name="prim" type="string" title="Исполнительные действия" />
            <column name="num_opl" type="string" title="Платежный документ" />
            <column name="dat_opl" type="date" title="Дата уменьшения долга по ИП" />
            <column name="opl" type="number" title="Сумма уменьшения долга по ИП" />
            <column name="reason" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="prim2" type="string" title="Комментарий" />
            <column name="reason_x_n" type="string" title="Основание уменьшения долга по ИП" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_deb_reduction" type="number" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <column name="prim" type="string" title="Исполнительные действия" />
            <column name="num_opl" type="string" title="Платежный документ" />
            <column name="dat_opl" type="date" title="Дата уменьшения долга по ИП" />
            <column name="opl" type="number" title="Сумма уменьшения долга по ИП" />
            <column name="reason_x_n" type="string" title="Основание уменьшения долга по ИП" />
            <column name="reason" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="prim2" type="string" title="Комментарий" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_deb_reduction" type="number" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="kod_deb_reduction_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="kod_deb_reduction_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select deb_red.prim as prim, /*Исполнительные действия*//*string*/
deb_red.num_opl as num_opl, /*Платежный документ*//*string*/
deb_red.dat_opl as dat_opl, /*Дата уменьшения долга по ИП*//*date*/
deb_red.opl as opl, /*Сумма уменьшения долга по ИП*//*number*/
deb_red.reason as reason, /*Основание уменьшения долга по ИП*//*number*/
deb_red.prim2 as prim2, /*Комментарий*//*string*/
reason_x_n.name as reason_x_n, /*Основание уменьшения долга по ИП*//*string*/
deb_red.is_new as is_new, /*number*/
deb_red.is_not_new as is_not_new, /*number*/
deb_red.kod_deb_reduction as kod_deb_reduction/*number*//*key*/

from (
--ur_deb_reduction
select a.kod_deb_reduction as kod_deb_reduction, /*number*//*key*/
a.reason as reason, /**//*number*/
a.prim as prim, /**//*string*/
a.prim2 as prim2, /**//*string*/
kod_opl.opl as opl, /**//*number*/
kod_link.num_opl as num_opl, /**//*string*/
kod_link.dat_opl as dat_opl, /**//*date*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.kod_deb_reduction as kod_deb_reduction,a.reason as reason,a.prim as prim,a.prim2 as prim2,0 as is_new,1 as is_not_new,a.kod_link as kod_link,a.kod_opl as kod_opl  from ur_deb_reduction a where not exists (select * from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and a.kod_deb_reduction=t.f2 ) and   a.kod_deb_reduction in :kod_deb_reduction_prm   union all  select t.n2 as kod_deb_reduction,t.n1 as reason,t.s1 as prim,t.s3 as prim2,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new,t.n5 as kod_link,t.n6 as kod_opl  from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_deb_reduction_prm )
a
--\(select a.kod_deb_reduction as kod_deb_reduction,a.reason as reason,a.prim as prim,a.prim2 as prim2,0 as is_new,1 as is_not_new,a.kod_link as kod_link,a.kod_opl as kod_opl  from ur_deb_reduction a where not exists (select * from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and a.kod_deb_reduction=t.f2 ) and   a.kod_deb_reduction in :kod_deb_reduction_prm   union all  select t.n2 as kod_deb_reduction,t.n1 as reason,t.s1 as prim,t.s3 as prim2,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new,t.n5 as kod_link,t.n6 as kod_opl  from rr_temp t where t.skod ='deb_red' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_deb_reduction_prm )
left outer join
(
--sr_opl_bank
select a.kod_link as kod_link, /*number*//*key*/
a.dat_opl as dat_opl, /*Дата оплаты*//*date*/
a.num_opl as num_opl/*Номер документа оплаты*//*string*/

from sr_opl_bank
a
--\sr_opl_bank
)
kod_link on a.kod_link = kod_link.kod_link--\sr_opl_bank
left outer join
(
--sr_opl
select a.kod_opl as kod_opl, /*number*//*key*/
a.opl as opl/**//*number*/

from sr_opl
a
--\sr_opl
)
kod_opl on a.kod_opl = kod_opl.kod_opl--\sr_opl
)
deb_red
--\ur_deb_reduction
left outer join
(
--ur_isp_other_reason
select a.id as id, /*number*//*key*/
a.name as name/*Наименование*//*string*/

from ur_isp_other_reason
a
--\ur_isp_other_reason
)
reason_x_n on deb_red.reason = reason_x_n.id--\ur_isp_other_reason
--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
  </dataset>
</root>