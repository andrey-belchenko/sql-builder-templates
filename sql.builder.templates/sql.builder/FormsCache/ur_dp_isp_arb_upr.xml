<?xml version="1.0" encoding="utf-8"?>
<root>
  <form name="ur_dp_isp_arb_upr" title="Суммы по юр. документу" with-behavior="0" timestamp="22.04.2025 23:23:54" file="sql.builder.templates\sql.builder\projects\asuse2\forms\Арбитраж\ur_folders_isp_arb_upr.xml" elid="1978" ord="1978" leaf="0" lvl="2" pelid="">
    <grid table="a" show-toolbar="1" show-footer="1" id="19562533">
      <toolbar id="11931620">
        <uicommand action-type="save-and-close" title="Сохранить и закрыть" button-type="custom-save-and-close" name="custom-save-and-close" icon="CommitAndClose_24" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="381" ord="381" leaf="1" lvl="2" pelid="" id="53216882" />
        <uicommand action-type="dynamic-form-create-multiple" call="ur_dp_isp_arb_upr_select" modal="1" title="Добавить" id="6184122">
          <useparam name="kod_isp_arb_upr" id="9189896" />
          <useparam name="kod_mat" id="15600205" />
        </uicommand>
        <uicommand button-type="grid-copy" column-visible="0" name="grid-copy" control-name="ButtonCoppyRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="365" ord="365" leaf="1" lvl="2" pelid="" title="" id="55657105" />
        <uicommand button-type="grid-add" column-visible="0" name="grid-add" control-name="ButtonAddRow" file="sql.builder.templates\sql.builder\projects\common\main.xml" elid="364" ord="364" leaf="1" lvl="2" pelid="" title="" id="31151897" />
      </toolbar>
      <columns part-id="ur_dp_isp-columns" id="24543236">
        <field table="a" name="kr_dog_ndog" title="Номер договора" controlType="UIText" rows-limit="100" id="26937201" />
        <field table="a" name="name_doc" title="Документ начисления" controlType="UIText" rows-limit="100" id="41431504" />
        <field table="a" name="ym" title="Отчетный период" controlType="UIText" format="F2" edit-mask="F2" rows-limit="100" id="23522655" />
        <field table="a" name="vid_real" title="Вид реализации" controlType="UICombo" rows-limit="100" id="48862362" />
        <field table="a" name="sr_facras_nachisl" title="Начислено" controlType="UIText" edit-mask="N2" rows-limit="100" id="6913766" />
        <field table="a" name="ur_opl_do_ur" title="Оплата до включения в юр. документ" controlType="UIText" edit-mask="N2" rows-limit="100" id="6971207" />
        <field table="a" name="summa" title="Выставленно по юр. документу" controlType="UIText" edit-mask="N2" rows-limit="100" id="48845639" />
        <field table="a" name="dat_form" title="Дата расч. задолж." controlType="UIDate" rows-limit="100" id="31417017" />
        <field table="a" name="ur_opl_do_resh" title="Оплата по юр. док. до  вынес. реш. суда" controlType="UIText" edit-mask="N2" rows-limit="100" id="35731101" />
        <field table="a" name="sum_v" title="Признано по юр. документу" controlType="UIText" edit-mask="N2" rows-limit="100" id="8538062" />
        <field table="a" name="ur_hist_mat_dec_dat_resh" title="Дата принятия решения" controlType="UIDate" rows-limit="100" id="50231756" />
        <field table="a" name="ur_opl_deb_do_il" title="Оплата по. реш. суда до выдачи исп. листа" controlType="UIText" edit-mask="N2" rows-limit="100" id="42240475" />
        <field table="a" name="dolg_deb_on_il" title="Задолженность на дату выдачи исп. листа" controlType="UIText" edit-mask="N2" rows-limit="100" id="57447213" />
        <field table="a" name="ur_isp_dat_doc" title="Дата выдачи исп. листа" controlType="UIDate" rows-limit="100" id="22712692" />
        <field table="a" name="ur_opl_deb_posl_il" title="Оплата по исп. листу" controlType="UIText" edit-mask="N2" rows-limit="100" id="36299680" />
        <field table="a" name="dolg_tek" title="Текущая задолженность" controlType="UIText" edit-mask="N2" rows-limit="100" id="21574783" />
      </columns>
    </grid>
  </form>
  <params>
    <param name="kod_isp_arb_upr" type="number">
      <const>148</const>
    </param>
    <param name="kod_mat" type="number" />
  </params>
  <dataset>
    <params>
      <param name="kod_isp_arb_upr" type="number">
        <const>148</const>
      </param>
      <param name="kod_mat" type="number" />
    </params>
    <fields>
      <field type="string" name="is_form_valid" parname="is_form_valid" />
      <field type="string" name="is_form_valid_not" parname="is_form_valid_not" />
      <field type="string" name="a_has_changes" parname="a_has_changes" />
    </fields>
    <table name="a" auto-refresh="" async="" only-visible-refresh="" only-force-refresh="" ref-column="" multi-select-column="" multi-select-target="" update-target="ur_dp_isp_arb_upr" column-editable="0" key="kod_dp_isp_arb_upr" is-ms-upd="1" is-top="1" key-dimension="kod_dp_isp_arb_upr">
      <select-text>
--
select qube.kr_dog_ndog1 as kr_dog_ndog, /*Номер договора*//*string*/
ur_dogplat.name_doc as name_doc, /*Документ начисления*//*string*/
ur_dogplat.ym as ym, /*Отчетный период*//*number*/
ur_dogplat.vid_real as vid_real, /*number*/
qube.sr_facras_nachisl1 as sr_facras_nachisl, /*Начислено*//*number*/
qube.ur_opl_do_ur1 as ur_opl_do_ur, /*Оплата до включения в юр. документ*//*number*/
ur_dogplat.summa as summa, /*Выставленно по юр. документу*//*number*/
ur_dogplat.dat_form as dat_form, /*Дата расч. задолж.*//*date*/
qube.ur_opl_do_resh1 as ur_opl_do_resh, /*Оплата по юр. док. до  вынес. реш. суда*//*number*/
ur_dogplat.sum_v as sum_v, /*Признано по юр. документу*//*number*/
qube.ur_hist_mat_dec_dat_resh1 as ur_hist_mat_dec_dat_resh, /*Дата принятия решения*//*date*/
qube.ur_opl_deb_do_il1 as ur_opl_deb_do_il, /*Оплата по. реш. суда до выдачи исп. листа*//*number*/
qube.dolg_deb_on_il1 as dolg_deb_on_il, /*Задолженность на дату выдачи исп. листа*//*number*/
qube.ur_isp_dat_doc1 as ur_isp_dat_doc, /*Дата выдачи исп. листа*//*date*/
qube.ur_opl_deb_posl_il1 as ur_opl_deb_posl_il, /*Оплата по исп. листу*//*number*/
qube.ur_dp_dolg_vist_or_priz1 as dolg_tek, /*Текущая задолженность*//*number*/
vid_real_x_n.name as vid_real_x_n, /*Вид реализации*//*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new, /*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
stragg_dist(qube.kr_dog_ndog1)  as kr_dog_ndog1, /*Номер договора*//*string*/
sum(qube.sr_facras_nachisl1)  as sr_facras_nachisl1, /*Начислено*//*number*/
sum( case  when (kod_opl.dat_uch &lt;= ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) )  then (qube.sr_opl_opl_sf1)  end )  as ur_opl_do_ur1, /*Оплата до включения в юр. документ*//*number*/
sum( case  when (kod_opl.dat_uch &lt; ( nvl( kod_hist_mat_dec.dat_post ,  DATE'8999-12-31'  ) ) )  then ( case  when (( nvl( kod_dogplat.prizn_konv ,0)=1 )  or (kod_opl.dat_uch &gt; ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) ) )  then (qube.sr_opl_opl_sf1)  end )  end )  as ur_opl_do_resh1, /*Оплата до вынес. реш. суда*//*number*/
max(qube.ur_hist_mat_dec_dat_resh1)  as ur_hist_mat_dec_dat_resh1, /*Дата принятия решения*//*date*/
sum( case  when ((kod_opl.dat_uch &lt; ( nvl( kod_isp.dat_doc ,  DATE'8999-12-31'  ) ) ) )  then ( case  when (kod_opl.dat_uch &gt;= kod_hist_mat_dec.dat_post)  then ( case  when (( nvl( kod_dogplat.prizn_konv ,0)=1 )  or (kod_opl.dat_uch &gt; ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) ) )  then (qube.sr_opl_opl_sf2)  end )  end )  end )  as ur_opl_deb_do_il1, /*Оплата по. реш. суда до выдачи исп. листа*//*number*/
sum( case  when ( 1=1 )  then ( nvl( qube.ur_dp_sum_v1 ,0)  -nvl( ( case  when ((kod_opl.dat_uch &lt; ( nvl( kod_isp.dat_doc ,  DATE'8999-12-31'  ) ) ) )  then ( case  when (kod_opl.dat_uch &gt;= kod_hist_mat_dec.dat_post)  then ( case  when (( nvl( kod_dogplat.prizn_konv ,0)=1 )  or (kod_opl.dat_uch &gt; ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) ) )  then (qube.sr_opl_opl_sf2)  end )  end )  end )  ,0) )  end )  as dolg_deb_on_il1, /*Задолженность на дату выдачи исп. листа*//*number*/
max(qube.ur_isp_dat_doc1)  as ur_isp_dat_doc1, /*Дата выдачи исп. листа*//*date*/
sum( case  when (kod_opl.dat_uch &gt;= kod_isp.dat_doc)  then ( case  when (kod_opl.dat_uch &gt;= kod_hist_mat_dec.dat_post)  then ( case  when (( nvl( kod_dogplat.prizn_konv ,0)=1 )  or (kod_opl.dat_uch &gt; ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) ) )  then (qube.sr_opl_opl_sf2)  end )  end )  end )  as ur_opl_deb_posl_il1, /*Оплата по исп. листу*//*number*/
sum( nvl( ( case  when (kod_hist_mat_dec.dat_post is null )  then qube.ur_dp_summa1 else qube.ur_dp_sum_v2 end )  ,0)  -nvl( ( case  when (kod_opl.dat_uch &gt; ( nvl( kod_hist_mat_dec.dat_post , kod_dogplat.dat_form ) ) )  then (qube.sr_opl_opl_sf1)  end )  ,0) )  as ur_dp_dolg_vist_or_priz1/*Долг по юр. документу*//*number*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_isp as kod_isp, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.kr_dog_ndog1 as kr_dog_ndog1, /*Номер договора*//*string*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1, /*Начислено*//*number*/
qube.sr_opl_opl_sf2 as sr_opl_opl_sf2, /*Оплата начислений*//*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1, /*Оплата начислений*//*number*/
qube.ur_dp_sum_v1 as ur_dp_sum_v1, /*Признано по юр. документу*//*number*/
qube.ur_dp_sum_v2 as ur_dp_sum_v2, /*Признано по юр. документу*//*number*/
qube.ur_dp_summa1 as ur_dp_summa1, /*Выставленно по юр. документу*//*number*/
qube.ur_hist_mat_dec_dat_resh1 as ur_hist_mat_dec_dat_resh1, /*Дата принятия решения*//*date*/
qube.ur_isp_dat_doc1 as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
(
(
--
select null as kod_dogplat, /*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
null as kod_hist_mat_dec, 
null as kod_isp, 
null as kod_opl, 
qube.kr_dog_ndog1 as kr_dog_ndog1, /*Номер договора*//*string*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1, /*Начислено*//*number*/
null as sr_opl_opl_sf2, /*number*/
null as sr_opl_opl_sf1, /*number*/
null as ur_dp_sum_v1, /*number*/
null as ur_dp_sum_v2, /*number*/
null as ur_dp_summa1, /*number*/
qube.ur_hist_mat_dec_dat_resh1 as ur_hist_mat_dec_dat_resh1, /*Дата принятия решения*//*date*/
qube.ur_isp_dat_doc1 as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
stragg_dist(un.kr_dog_ndog1)  as kr_dog_ndog1, /*Номер договора*//*string*/
sum(un.sr_facras_nachisl1)  as sr_facras_nachisl1, /*Начислено*//*number*/
max(un.ur_hist_mat_dec_dat_resh1)  as ur_hist_mat_dec_dat_resh1, /*Дата принятия решения*//*date*/
max(un.ur_isp_dat_doc1)  as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
(
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kr_dogovor.ndog as kr_dog_ndog1, /*Номер договора*//*string*/
null as sr_facras_nachisl1, /*number*/
null as ur_hist_mat_dec_dat_resh1, /*date*/
null as ur_isp_dat_doc1/*date*/

from (
--
select kr_dogovor_a_d.kod_dog as kod_dog_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--kr_dogovor
select a.kod_dog as kod_dog/*number*//*key*/

from kr_dogovor
a
--\kr_dogovor
)
kr_dogovor_a_d
--\kr_dogovor
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_dog as kod_dog/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat_a_d on kod_dogplat_a_d.kod_dog = kr_dogovor_a_d.kod_dog--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_isp_arb_upr as kod_isp_arb_upr, /*number*/
a.kod_dogplat as kod_dogplat/*number*/

from ur_dp_isp_arb_upr
a
--\ur_dp_isp_arb_upr
)
a on a.kod_dogplat = kod_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
(a.kod_isp_arb_upr = :kod_isp_arb_upr )  and (a.kod_dp_isp_arb_upr is not null )  group by
kr_dogovor_a_d.kod_dog, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--kr_dogovor
select a.kod_dog as kod_dog, /*number*//*key*/
a.ndog as ndog/*Номер договора*//*string*/

from kr_dogovor
a
--\kr_dogovor
)
kr_dogovor on kr_dogovor.kod_dog = dims.kod_dog_prm--\kr_dogovor
)
--\
union all
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as kr_dog_ndog1, /*string*/
sr_facras.nachisl as sr_facras_nachisl1, /*Начислено*//*number*/
null as ur_hist_mat_dec_dat_resh1, /*date*/
null as ur_isp_dat_doc1/*date*/

from (
--
select sr_facras_a_d.kod_ras as kod_ras_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras_a_d
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_facras_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vv_all_deb_sf
select a.kod_deb_sf as kod_deb_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from vv_all_deb_sf
a
--\vv_all_deb_sf
)
vv_all_deb_sf_a_d1 on vv_all_deb_sf_a_d1.kod_sf = kod_sf_a_d.kod_sf--\vv_all_deb_sf
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_deb_sf as kod_deb_sf/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat_a_d on kod_dogplat_a_d.kod_deb_sf = vv_all_deb_sf_a_d1.kod_deb_sf--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_isp_arb_upr as kod_isp_arb_upr, /*number*/
a.kod_dogplat as kod_dogplat/*number*/

from ur_dp_isp_arb_upr
a
--\ur_dp_isp_arb_upr
)
a on a.kod_dogplat = kod_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
(a.kod_isp_arb_upr = :kod_isp_arb_upr )  and (a.kod_dp_isp_arb_upr is not null )  group by
sr_facras_a_d.kod_ras, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.nachisl as nachisl/*Начислено*//*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras on sr_facras.kod_ras = dims.kod_ras_prm--\sr_facras
)
--\
union all
(
--
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as kr_dog_ndog1, /*string*/
null as sr_facras_nachisl1, /*number*/
null as ur_hist_mat_dec_dat_resh1, /*date*/
null as ur_isp_dat_doc1/*date*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_isp_arb_upr as kod_isp_arb_upr/*number*/

from ur_dp_isp_arb_upr
a
--\ur_dp_isp_arb_upr
)
a
--\ur_dp_isp_arb_upr
where
(a.kod_isp_arb_upr = :kod_isp_arb_upr )  and (a.kod_dp_isp_arb_upr is not null ) )
--\
union all
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as kr_dog_ndog1, /*string*/
null as sr_facras_nachisl1, /*number*/
ur_hist_mat_dec.dat_resh as ur_hist_mat_dec_dat_resh1, /*Дата принятия решения*/
null as ur_isp_dat_doc1/*date*/

from (
--
select ur_hist_mat_dec_a_d.kod_hist_mat as kod_hist_mat_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
ur_hist_mat_dec_a_d
--\ur_hist_mat_dec
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on ur_hist_mat_dec_a_d.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_mat_pp
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat_a_d on kod_dogplat_a_d.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_isp_arb_upr as kod_isp_arb_upr, /*number*/
a.kod_dogplat as kod_dogplat/*number*/

from ur_dp_isp_arb_upr
a
--\ur_dp_isp_arb_upr
)
a on a.kod_dogplat = kod_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
(a.kod_isp_arb_upr = :kod_isp_arb_upr )  and (a.kod_dp_isp_arb_upr is not null )  group by
ur_hist_mat_dec_a_d.kod_hist_mat, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_hist_mat as kod_hist_mat_desc, /*number*//*key*/
a.dat_post as dat_resh/*Дата принятия решения*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
ur_hist_mat_dec on ur_hist_mat_dec.kod_hist_mat = dims.kod_hist_mat_prm--\ur_hist_mat_dec
)
--\
union all
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as kr_dog_ndog1, /*string*/
null as sr_facras_nachisl1, /*number*/
null as ur_hist_mat_dec_dat_resh1, /*date*/
ur_isp.dat_doc as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
--
select ur_isp_a_d.kod_isp as kod_isp_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.kod_hist_mat as kod_hist_mat/*number*/

from ur_isp
a
--\ur_isp
)
ur_isp_a_d
--\ur_isp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec_a_d on ur_isp_a_d.kod_hist_mat = kod_hist_mat_dec_a_d.kod_hist_mat--\ur_hist_mat_dec
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_hist_mat_dec_a_d.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_mat_pp
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat_a_d on kod_dogplat_a_d.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_isp_arb_upr as kod_isp_arb_upr, /*number*/
a.kod_dogplat as kod_dogplat/*number*/

from ur_dp_isp_arb_upr
a
--\ur_dp_isp_arb_upr
)
a on a.kod_dogplat = kod_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
(a.kod_isp_arb_upr = :kod_isp_arb_upr )  and (a.kod_dp_isp_arb_upr is not null )  group by
ur_isp_a_d.kod_isp, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.dat_doc as dat_doc/*Дата выдачи исп. листа*//*date*/

from ur_isp
a
--\ur_isp
)
ur_isp on ur_isp.kod_isp = dims.kod_isp_prm--\ur_isp
)
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
)
--\
union all
(
--
select qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_isp as kod_isp, /*number*/
qube.kod_opl as kod_opl, /*number*/
null as kr_dog_ndog1, /*string*/
null as sr_facras_nachisl1, /*number*/
qube.sr_opl_opl_sf2 as sr_opl_opl_sf2, /*Оплата начислений*//*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1, /*Оплата начислений*//*number*/
null as ur_dp_sum_v1, /*number*/
null as ur_dp_sum_v2, /*number*/
null as ur_dp_summa1, /*number*/
null as ur_hist_mat_dec_dat_resh1, /*date*/
null as ur_isp_dat_doc1/*date*/

from (
--
select un.kod_dogplat as kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec as kod_hist_mat_dec, /*number*//*key*/
un.kod_isp as kod_isp, /*number*//*key*/
un.kod_opl as kod_opl, /*number*//*key*/
sum(un.sr_opl_opl_sf2)  as sr_opl_opl_sf2, /*Оплата начислений*//*number*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.kod_dogplat as kod_dogplat, /*number*//*key*/
dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
dims.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
dims.kod_isp as kod_isp, /*number*/
dims.kod_opl as kod_opl, /*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf2, /*Оплата начислений*//*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select sr_opl_sf_a_d.kod_opl as kod_opl_prm, /*number*//*key*/
kod_dogplat.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat as kod_hist_mat_dec, /*number*//*key*/
kod_isp.kod_isp as kod_isp, /*number*//*key*/
sr_opl_sf_a_d.kod_opl as kod_opl/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf_a_d
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_opl_sf_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vv_all_deb_sf
select a.kod_deb_sf as kod_deb_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from vv_all_deb_sf
a
--\vv_all_deb_sf
)
vv_all_deb_sf_a_d1 on vv_all_deb_sf_a_d1.kod_sf = kod_sf_a_d.kod_sf--\vv_all_deb_sf
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_deb_sf as kod_deb_sf/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_deb_sf = vv_all_deb_sf_a_d1.kod_deb_sf--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_isp_arb_upr as kod_isp_arb_upr, /*number*/
a.kod_dogplat as kod_dogplat/*number*/

from ur_dp_isp_arb_upr
a
--\ur_dp_isp_arb_upr
)
a on a.kod_dogplat = kod_dogplat.kod_dogplat--\ur_dp_isp_arb_upr
left outer join
(
--ur_mat
select a.kod_mat as kod_mat/*number*//*key*/

from ur_mat
a
--\ur_mat
)
kod_mat1_a_d1 on kod_dogplat.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_mat_pp_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat_pp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_hist_mat_dec
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.kod_hist_mat as kod_hist_mat/*number*/

from ur_isp
a
--\ur_isp
)
kod_isp on kod_isp.kod_hist_mat = kod_hist_mat_dec.kod_hist_mat--\ur_isp
where
(a.kod_isp_arb_upr = :kod_isp_arb_upr )  and (a.kod_dp_isp_arb_upr is not null )  group by
sr_opl_sf_a_d.kod_opl, /*number*//*key*/
kod_dogplat.kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat, /*number*//*key*/
kod_isp.kod_isp/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
)
--\
)
un
--\
 group by
un.kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec, /*number*//*key*/
un.kod_isp, /*number*//*key*/
un.kod_opl/*number*//*key*/
)
qube
--\
)
--\
union all
(
--
select null as kod_dogplat, /*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
null as kod_isp, 
null as kod_opl, 
null as kr_dog_ndog1, /*string*/
null as sr_facras_nachisl1, /*number*/
null as sr_opl_opl_sf2, /*number*/
null as sr_opl_opl_sf1, /*number*/
qube.ur_dp_sum_v1 as ur_dp_sum_v1, /*Признано по юр. документу*//*number*/
qube.ur_dp_sum_v2 as ur_dp_sum_v2, /*Признано по юр. документу*//*number*/
qube.ur_dp_summa1 as ur_dp_summa1, /*Выставленно по юр. документу*//*number*/
null as ur_hist_mat_dec_dat_resh1, /*date*/
null as ur_isp_dat_doc1/*date*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec as kod_hist_mat_dec, /*number*//*key*/
sum(un.ur_dp_sum_v1)  as ur_dp_sum_v1, /*Признано по юр. документу*//*number*/
sum(un.ur_dp_sum_v2)  as ur_dp_sum_v2, /*Признано по юр. документу*//*number*/
sum(un.ur_dp_summa1)  as ur_dp_summa1/*Выставленно по юр. документу*//*number*/

from (
(
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
dims.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
ur_dogplat.sum_v as ur_dp_sum_v1, /*Признано по юр. документу*//*number*/
ur_dogplat.sum_v as ur_dp_sum_v2, /*Признано по юр. документу*//*number*/
ur_dogplat.summa as ur_dp_summa1/*Выставленно по юр. документу*//*number*/

from (
--
select ur_dogplat_a_d.kod_dogplat as kod_dogplat_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat as kod_hist_mat_dec/*number*//*key*/

from (
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat/*number*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat_a_d
--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_isp_arb_upr as kod_isp_arb_upr, /*number*/
a.kod_dogplat as kod_dogplat/*number*/

from ur_dp_isp_arb_upr
a
--\ur_dp_isp_arb_upr
)
a on a.kod_dogplat = ur_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
left outer join
(
--ur_mat
select a.kod_mat as kod_mat/*number*//*key*/

from ur_mat
a
--\ur_mat
)
kod_mat1_a_d1 on ur_dogplat_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_mat_pp_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat_pp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_hist_mat_dec
where
(a.kod_isp_arb_upr = :kod_isp_arb_upr )  and (a.kod_dp_isp_arb_upr is not null )  group by
ur_dogplat_a_d.kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat/*number*//*key*/
)
dims
--\
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.summa as summa, /*Выставленно по юр. документу*//*number*/
a.sum_v as sum_v/*Признано по юр. документу*//*number*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat on ur_dogplat.kod_dogplat = dims.kod_dogplat_prm--\ur_dogplat
)
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
left outer join
(
--sr_opl
select a.kod_opl as kod_opl, /*number*//*key*/
a.dat_uch as dat_uch/**//*date*/

from sr_opl
a
--\sr_opl
)
kod_opl on kod_opl.kod_opl = qube.kod_opl--\sr_opl
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.dat_doc as dat_doc/*Дата выдачи исп. листа*//*date*/

from ur_isp
a
--\ur_isp
)
kod_isp on kod_isp.kod_isp = qube.kod_isp--\ur_isp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.dat_post as dat_post, /*Дата прин. суд. акта*//*date*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_hist_mat = qube.kod_hist_mat_dec--\ur_hist_mat_dec
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.dat_form as dat_form, /*Дата расч. задолж.*//*date*/
a.prizn_konv as prizn_konv/**//*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_dogplat = qube.kod_dogplat--\ur_dogplat
 group by
qube.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat, /*number*/
0 as is_new, /*number*/
1 as is_not_new/*number*/

from ur_dp_isp_arb_upr
a
--\ur_dp_isp_arb_upr
)
a on a.kod_dp_isp_arb_upr = qube.kod_dp_isp_arb_upr--\ur_dp_isp_arb_upr
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.dat_form as dat_form, /*Дата расч. задолж.*//*date*/
a.summa as summa, /*Выставленно по юр. документу*//*number*/
a.vid_real as vid_real, /**//*number*/
a.sum_v as sum_v, /*Признано по юр. документу*//*number*/
a.ym as ym, /*Отчетный период*//*number*/
 case  when (a.kod_sf is not null )  then kod_sf.name when (a.kod_deb is not null )  then kod_deb.name when (a.kod_izv is not null )  then kod_izv.name end  as name_doc/*Документ начисления*//*string*/

from ur_dogplat
a
--\ur_dogplat
left outer join
(
--sr_debet
select a.kod_deb as kod_deb, /*number*//*key*/
'п/д ' || ' № ' || a.num_pl || ' от ' || ( to_char( a.dat_deb ,'DD.MM.YYYY') )  as name/*Документ на оплату*//*string*/

from sr_debet
a
--\sr_debet
)
kod_deb on a.kod_deb = kod_deb.kod_deb--\sr_debet
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
vid_sf.abbr || ' № ' || a.num_sf || ' от ' || ( to_char( a.dat_sf ,'DD.MM.YYYY') )  as name/*Документ начисления*//*string*/

from sr_facvip
a
--\sr_facvip
left outer join
(
--sk_vid_sf
select a.vid_sf as vid_sf, /**//*number*//*key*/
a.abbr as abbr/*Аббревиатура*//*string*/

from sk_vid_sf
a
--\sk_vid_sf
)
vid_sf on a.vid_sf = vid_sf.vid_sf--\sk_vid_sf
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
left outer join
(
--tnr_izv
select a.kod_izv as kod_izv, /*number*//*key*/
type_izv.abbr || ' №' || a.num_izv || ' от  ' || ( to_char( a.date_izv ,'DD.MM.YYYY') )  as name/*Аббревиатура*//*string*/

from tnr_izv
a
--\tnr_izv
left outer join
(
--tk_vidizv
select a.kod_vidizv as kod_vidizv, /*number*//*key*/
a.abbr as abbr/*Аббревиатура*//*string*/

from tk_vidizv
a
--\tk_vidizv
)
type_izv on a.type_izv = type_izv.kod_vidizv--\tk_vidizv
)
kod_izv on a.kod_izv = kod_izv.kod_izv--\tnr_izv
)
ur_dogplat on a.kod_dogplat = ur_dogplat.kod_dogplat--\ur_dogplat
left outer join
(
--sk_vid_real
select a.vid_real as vid_real, /**//*number*//*key*/
a.name as name/*Вид реализации*//*string*/

from sk_vid_real
a
--\sk_vid_real
)
vid_real_x_n on ur_dogplat.vid_real = vid_real_x_n.vid_real--\sk_vid_real
--\
</select-text>
      <columns>
        <column name="kr_dog_ndog" table="ur_dogplat" type="string" title="Номер договора" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.kr_dog_ndog1 as kr_dog_ndog, /*Номер договора*//*string*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
stragg_dist(qube.kr_dog_ndog1)  as kr_dog_ndog1/*Номер договора*//*string*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
qube.kr_dog_ndog1 as kr_dog_ndog1/*Номер договора*//*string*/

from (
(
(
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
qube.kr_dog_ndog1 as kr_dog_ndog1/*Номер договора*//*string*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
stragg_dist(un.kr_dog_ndog1)  as kr_dog_ndog1/*Номер договора*//*string*/

from (
(
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kr_dogovor.ndog as kr_dog_ndog1/*Номер договора*//*string*/

from (
--
select kr_dogovor_a_d.kod_dog as kod_dog_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--kr_dogovor
select a.kod_dog as kod_dog/*number*//*key*/

from kr_dogovor
a
--\kr_dogovor
)
kr_dogovor_a_d
--\kr_dogovor
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_dog as kod_dog/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat_a_d on kod_dogplat_a_d.kod_dog = kr_dogovor_a_d.kod_dog--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null  group by
kr_dogovor_a_d.kod_dog, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--kr_dogovor
select a.kod_dog as kod_dog, /*number*//*key*/
a.ndog as ndog/*Номер договора*//*string*/

from kr_dogovor
a
--\kr_dogovor
)
kr_dogovor on kr_dogovor.kod_dog = dims.kod_dog_prm--\kr_dogovor
)
--\
union all
(
--
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as kr_dog_ndog1/*string*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null )
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
 group by
qube.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dp_isp_arb_upr = qube.kod_dp_isp_arb_upr--\ur_dp_isp_arb_upr
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="name_doc" table="ur_dogplat" type="string" title="Документ начисления" ColumnEditable="0" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select ur_dogplat.name_doc as name_doc, /*Документ начисления*//*string*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
 case  when (a.kod_sf is not null )  then kod_sf.name when (a.kod_deb is not null )  then kod_deb.name when (a.kod_izv is not null )  then kod_izv.name end  as name_doc/*Документ начисления*//*string*/

from ur_dogplat
a
--\ur_dogplat
left outer join
(
--sr_debet
select a.kod_deb as kod_deb, /*number*//*key*/
'п/д ' || ' № ' || a.num_pl || ' от ' || ( to_char( a.dat_deb ,'DD.MM.YYYY') )  as name/*Документ на оплату*//*string*/

from sr_debet
a
--\sr_debet
)
kod_deb on a.kod_deb = kod_deb.kod_deb--\sr_debet
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
vid_sf.abbr || ' № ' || a.num_sf || ' от ' || ( to_char( a.dat_sf ,'DD.MM.YYYY') )  as name/*Документ начисления*//*string*/

from sr_facvip
a
--\sr_facvip
left outer join
(
--sk_vid_sf
select a.vid_sf as vid_sf, /**//*number*//*key*/
a.abbr as abbr/*Аббревиатура*//*string*/

from sk_vid_sf
a
--\sk_vid_sf
)
vid_sf on a.vid_sf = vid_sf.vid_sf--\sk_vid_sf
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
left outer join
(
--tnr_izv
select a.kod_izv as kod_izv, /*number*//*key*/
type_izv.abbr || ' №' || a.num_izv || ' от  ' || ( to_char( a.date_izv ,'DD.MM.YYYY') )  as name/*Аббревиатура*//*string*/

from tnr_izv
a
--\tnr_izv
left outer join
(
--tk_vidizv
select a.kod_vidizv as kod_vidizv, /*number*//*key*/
a.abbr as abbr/*Аббревиатура*//*string*/

from tk_vidizv
a
--\tk_vidizv
)
type_izv on a.type_izv = type_izv.kod_vidizv--\tk_vidizv
)
kod_izv on a.kod_izv = kod_izv.kod_izv--\tnr_izv
)
ur_dogplat on a.kod_dogplat = ur_dogplat.kod_dogplat--\ur_dogplat
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="ym" table="ur_dogplat" type="number" title="Отчетный период" ColumnEditable="0" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select ur_dogplat.ym as ym, /*Отчетный период*//*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.ym as ym/*Отчетный период*//*number*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat on a.kod_dogplat = ur_dogplat.kod_dogplat--\ur_dogplat
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="vid_real" table="ur_dogplat" type="number" title="Вид реализации" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select ur_dogplat.vid_real as vid_real, /*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.vid_real as vid_real/**//*number*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat on a.kod_dogplat = ur_dogplat.kod_dogplat--\ur_dogplat
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="sr_facras_nachisl" table="ur_dogplat" type="number" title="Начислено" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.sr_facras_nachisl1 as sr_facras_nachisl, /*Начислено*//*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
sum(qube.sr_facras_nachisl1)  as sr_facras_nachisl1/*Начислено*//*number*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1/*Начислено*//*number*/

from (
(
(
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1/*Начислено*//*number*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
sum(un.sr_facras_nachisl1)  as sr_facras_nachisl1/*Начислено*//*number*/

from (
(
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
sr_facras.nachisl as sr_facras_nachisl1/*Начислено*//*number*/

from (
--
select sr_facras_a_d.kod_ras as kod_ras_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras_a_d
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_facras_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vv_all_deb_sf
select a.kod_deb_sf as kod_deb_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from vv_all_deb_sf
a
--\vv_all_deb_sf
)
vv_all_deb_sf_a_d1 on vv_all_deb_sf_a_d1.kod_sf = kod_sf_a_d.kod_sf--\vv_all_deb_sf
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_deb_sf as kod_deb_sf/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat_a_d on kod_dogplat_a_d.kod_deb_sf = vv_all_deb_sf_a_d1.kod_deb_sf--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null  group by
sr_facras_a_d.kod_ras, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.nachisl as nachisl/*Начислено*//*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras on sr_facras.kod_ras = dims.kod_ras_prm--\sr_facras
)
--\
union all
(
--
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as sr_facras_nachisl1/*number*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null )
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
 group by
qube.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dp_isp_arb_upr = qube.kod_dp_isp_arb_upr--\ur_dp_isp_arb_upr
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="ur_opl_do_ur" table="ur_dogplat" type="number" title="Оплата до включения в юр. документ" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.ur_opl_do_ur1 as ur_opl_do_ur, /*Оплата до включения в юр. документ*//*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
sum( case  when (kod_opl.dat_uch &lt;= ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) )  then (qube.sr_opl_opl_sf1)  end )  as ur_opl_do_ur1/*Оплата до включения в юр. документ*//*number*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select un.kod_dogplat as kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec as kod_hist_mat_dec, /*number*//*key*/
un.kod_opl as kod_opl, /*number*//*key*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.kod_dogplat as kod_dogplat, /*number*//*key*/
dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
dims.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
dims.kod_opl as kod_opl, /*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select sr_opl_sf_a_d.kod_opl as kod_opl_prm, /*number*//*key*/
kod_dogplat.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat as kod_hist_mat_dec, /*number*//*key*/
sr_opl_sf_a_d.kod_opl as kod_opl/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf_a_d
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_opl_sf_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vv_all_deb_sf
select a.kod_deb_sf as kod_deb_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from vv_all_deb_sf
a
--\vv_all_deb_sf
)
vv_all_deb_sf_a_d1 on vv_all_deb_sf_a_d1.kod_sf = kod_sf_a_d.kod_sf--\vv_all_deb_sf
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_deb_sf as kod_deb_sf/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_deb_sf = vv_all_deb_sf_a_d1.kod_deb_sf--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat.kod_dogplat--\ur_dp_isp_arb_upr
left outer join
(
--ur_mat
select a.kod_mat as kod_mat/*number*//*key*/

from ur_mat
a
--\ur_mat
)
kod_mat1_a_d1 on kod_dogplat.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_mat_pp_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat_pp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_hist_mat_dec
where
a.kod_dp_isp_arb_upr is not null  group by
sr_opl_sf_a_d.kod_opl, /*number*//*key*/
kod_dogplat.kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
)
--\
)
un
--\
 group by
un.kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec, /*number*//*key*/
un.kod_opl/*number*//*key*/
)
qube
--\
)
--\
union all
(
--
select null as kod_dogplat, /*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
null as kod_hist_mat_dec, 
null as kod_opl, 
null as sr_opl_opl_sf1/*number*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
(
(
--
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null )
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
left outer join
(
--sr_opl
select a.kod_opl as kod_opl, /*number*//*key*/
a.dat_uch as dat_uch/**//*date*/

from sr_opl
a
--\sr_opl
)
kod_opl on kod_opl.kod_opl = qube.kod_opl--\sr_opl
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.dat_post as dat_post, /*Дата прин. суд. акта*//*date*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_hist_mat = qube.kod_hist_mat_dec--\ur_hist_mat_dec
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.dat_form as dat_form/*Дата расч. задолж.*//*date*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_dogplat = qube.kod_dogplat--\ur_dogplat
 group by
qube.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dp_isp_arb_upr = qube.kod_dp_isp_arb_upr--\ur_dp_isp_arb_upr
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="summa" table="ur_dogplat" type="number" title="Выставленно по юр. документу" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select ur_dogplat.summa as summa, /*Выставленно по юр. документу*//*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.summa as summa/*Выставленно по юр. документу*//*number*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat on a.kod_dogplat = ur_dogplat.kod_dogplat--\ur_dogplat
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="dat_form" table="ur_dogplat" type="date" title="Дата расч. задолж." is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select ur_dogplat.dat_form as dat_form, /*Дата расч. задолж.*//*date*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.dat_form as dat_form/*Дата расч. задолж.*//*date*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat on a.kod_dogplat = ur_dogplat.kod_dogplat--\ur_dogplat
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="ur_opl_do_resh" table="ur_dogplat" type="number" title="Оплата по юр. док. до  вынес. реш. суда" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.ur_opl_do_resh1 as ur_opl_do_resh, /*Оплата по юр. док. до  вынес. реш. суда*//*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
sum( case  when (kod_opl.dat_uch &lt; ( nvl( kod_hist_mat_dec.dat_post ,  DATE'8999-12-31'  ) ) )  then ( case  when (( nvl( kod_dogplat.prizn_konv ,0)=1 )  or (kod_opl.dat_uch &gt; ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) ) )  then (qube.sr_opl_opl_sf1)  end )  end )  as ur_opl_do_resh1/*Оплата до вынес. реш. суда*//*number*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select un.kod_dogplat as kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec as kod_hist_mat_dec, /*number*//*key*/
un.kod_opl as kod_opl, /*number*//*key*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.kod_dogplat as kod_dogplat, /*number*//*key*/
dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
dims.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
dims.kod_opl as kod_opl, /*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select sr_opl_sf_a_d.kod_opl as kod_opl_prm, /*number*//*key*/
kod_dogplat.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat as kod_hist_mat_dec, /*number*//*key*/
sr_opl_sf_a_d.kod_opl as kod_opl/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf_a_d
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_opl_sf_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vv_all_deb_sf
select a.kod_deb_sf as kod_deb_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from vv_all_deb_sf
a
--\vv_all_deb_sf
)
vv_all_deb_sf_a_d1 on vv_all_deb_sf_a_d1.kod_sf = kod_sf_a_d.kod_sf--\vv_all_deb_sf
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_deb_sf as kod_deb_sf/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_deb_sf = vv_all_deb_sf_a_d1.kod_deb_sf--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat.kod_dogplat--\ur_dp_isp_arb_upr
left outer join
(
--ur_mat
select a.kod_mat as kod_mat/*number*//*key*/

from ur_mat
a
--\ur_mat
)
kod_mat1_a_d1 on kod_dogplat.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_mat_pp_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat_pp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_hist_mat_dec
where
a.kod_dp_isp_arb_upr is not null  group by
sr_opl_sf_a_d.kod_opl, /*number*//*key*/
kod_dogplat.kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
)
--\
)
un
--\
 group by
un.kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec, /*number*//*key*/
un.kod_opl/*number*//*key*/
)
qube
--\
)
--\
union all
(
--
select null as kod_dogplat, /*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
null as kod_hist_mat_dec, 
null as kod_opl, 
null as sr_opl_opl_sf1/*number*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
(
(
--
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null )
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
left outer join
(
--sr_opl
select a.kod_opl as kod_opl, /*number*//*key*/
a.dat_uch as dat_uch/**//*date*/

from sr_opl
a
--\sr_opl
)
kod_opl on kod_opl.kod_opl = qube.kod_opl--\sr_opl
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.dat_post as dat_post, /*Дата прин. суд. акта*//*date*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_hist_mat = qube.kod_hist_mat_dec--\ur_hist_mat_dec
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.dat_form as dat_form, /*Дата расч. задолж.*//*date*/
a.prizn_konv as prizn_konv/**//*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_dogplat = qube.kod_dogplat--\ur_dogplat
 group by
qube.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dp_isp_arb_upr = qube.kod_dp_isp_arb_upr--\ur_dp_isp_arb_upr
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="sum_v" table="ur_dogplat" type="number" title="Признано по юр. документу" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select ur_dogplat.sum_v as sum_v, /*Признано по юр. документу*//*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.sum_v as sum_v/*Признано по юр. документу*//*number*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat on a.kod_dogplat = ur_dogplat.kod_dogplat--\ur_dogplat
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="ur_hist_mat_dec_dat_resh" table="ur_dogplat" type="date" title="Дата принятия решения" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.ur_hist_mat_dec_dat_resh1 as ur_hist_mat_dec_dat_resh, /*Дата принятия решения*//*date*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
max(qube.ur_hist_mat_dec_dat_resh1)  as ur_hist_mat_dec_dat_resh1/*Дата принятия решения*//*date*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
qube.ur_hist_mat_dec_dat_resh1 as ur_hist_mat_dec_dat_resh1/*Дата принятия решения*//*date*/

from (
(
(
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
qube.ur_hist_mat_dec_dat_resh1 as ur_hist_mat_dec_dat_resh1/*Дата принятия решения*//*date*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
max(un.ur_hist_mat_dec_dat_resh1)  as ur_hist_mat_dec_dat_resh1/*Дата принятия решения*//*date*/

from (
(
(
--
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as ur_hist_mat_dec_dat_resh1/*date*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null )
--\
union all
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
ur_hist_mat_dec.dat_resh as ur_hist_mat_dec_dat_resh1/*Дата принятия решения*/

from (
--
select ur_hist_mat_dec_a_d.kod_hist_mat as kod_hist_mat_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
ur_hist_mat_dec_a_d
--\ur_hist_mat_dec
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on ur_hist_mat_dec_a_d.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_mat_pp
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat_a_d on kod_dogplat_a_d.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null  group by
ur_hist_mat_dec_a_d.kod_hist_mat, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_hist_mat as kod_hist_mat_desc, /*number*//*key*/
a.dat_post as dat_resh/*Дата принятия решения*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
ur_hist_mat_dec on ur_hist_mat_dec.kod_hist_mat = dims.kod_hist_mat_prm--\ur_hist_mat_dec
)
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
 group by
qube.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dp_isp_arb_upr = qube.kod_dp_isp_arb_upr--\ur_dp_isp_arb_upr
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="ur_opl_deb_do_il" table="ur_dogplat" type="number" title="Оплата по. реш. суда до выдачи исп. листа" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.ur_opl_deb_do_il1 as ur_opl_deb_do_il, /*Оплата по. реш. суда до выдачи исп. листа*//*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
sum( case  when ((kod_opl.dat_uch &lt; ( nvl( kod_isp.dat_doc ,  DATE'8999-12-31'  ) ) ) )  then ( case  when (kod_opl.dat_uch &gt;= kod_hist_mat_dec.dat_post)  then ( case  when (( nvl( kod_dogplat.prizn_konv ,0)=1 )  or (kod_opl.dat_uch &gt; ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) ) )  then (qube.sr_opl_opl_sf1)  end )  end )  end )  as ur_opl_deb_do_il1/*Оплата по. реш. суда до выдачи исп. листа*//*number*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_isp as kod_isp, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_isp as kod_isp, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select un.kod_dogplat as kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec as kod_hist_mat_dec, /*number*//*key*/
un.kod_isp as kod_isp, /*number*//*key*/
un.kod_opl as kod_opl, /*number*//*key*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.kod_dogplat as kod_dogplat, /*number*//*key*/
dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
dims.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
dims.kod_isp as kod_isp, /*number*/
dims.kod_opl as kod_opl, /*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select sr_opl_sf_a_d.kod_opl as kod_opl_prm, /*number*//*key*/
kod_dogplat.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat as kod_hist_mat_dec, /*number*//*key*/
kod_isp.kod_isp as kod_isp, /*number*//*key*/
sr_opl_sf_a_d.kod_opl as kod_opl/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf_a_d
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_opl_sf_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vv_all_deb_sf
select a.kod_deb_sf as kod_deb_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from vv_all_deb_sf
a
--\vv_all_deb_sf
)
vv_all_deb_sf_a_d1 on vv_all_deb_sf_a_d1.kod_sf = kod_sf_a_d.kod_sf--\vv_all_deb_sf
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_deb_sf as kod_deb_sf/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_deb_sf = vv_all_deb_sf_a_d1.kod_deb_sf--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat.kod_dogplat--\ur_dp_isp_arb_upr
left outer join
(
--ur_mat
select a.kod_mat as kod_mat/*number*//*key*/

from ur_mat
a
--\ur_mat
)
kod_mat1_a_d1 on kod_dogplat.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_mat_pp_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat_pp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_hist_mat_dec
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.kod_hist_mat as kod_hist_mat/*number*/

from ur_isp
a
--\ur_isp
)
kod_isp on kod_isp.kod_hist_mat = kod_hist_mat_dec.kod_hist_mat--\ur_isp
where
a.kod_dp_isp_arb_upr is not null  group by
sr_opl_sf_a_d.kod_opl, /*number*//*key*/
kod_dogplat.kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat, /*number*//*key*/
kod_isp.kod_isp/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
)
--\
)
un
--\
 group by
un.kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec, /*number*//*key*/
un.kod_isp, /*number*//*key*/
un.kod_opl/*number*//*key*/
)
qube
--\
)
--\
union all
(
--
select null as kod_dogplat, /*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
null as kod_hist_mat_dec, 
null as kod_isp, 
null as kod_opl, 
null as sr_opl_opl_sf1/*number*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
(
(
--
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null )
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
left outer join
(
--sr_opl
select a.kod_opl as kod_opl, /*number*//*key*/
a.dat_uch as dat_uch/**//*date*/

from sr_opl
a
--\sr_opl
)
kod_opl on kod_opl.kod_opl = qube.kod_opl--\sr_opl
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.dat_doc as dat_doc/*Дата выдачи исп. листа*//*date*/

from ur_isp
a
--\ur_isp
)
kod_isp on kod_isp.kod_isp = qube.kod_isp--\ur_isp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.dat_post as dat_post, /*Дата прин. суд. акта*//*date*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_hist_mat = qube.kod_hist_mat_dec--\ur_hist_mat_dec
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.dat_form as dat_form, /*Дата расч. задолж.*//*date*/
a.prizn_konv as prizn_konv/**//*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_dogplat = qube.kod_dogplat--\ur_dogplat
 group by
qube.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dp_isp_arb_upr = qube.kod_dp_isp_arb_upr--\ur_dp_isp_arb_upr
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="dolg_deb_on_il" table="ur_dogplat" type="number" title="Задолженность на дату выдачи исп. листа" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.dolg_deb_on_il1 as dolg_deb_on_il, /*Задолженность на дату выдачи исп. листа*//*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
sum( case  when ( 1=1 )  then ( nvl( qube.ur_dp_sum_v1 ,0)  -nvl( ( case  when ((kod_opl.dat_uch &lt; ( nvl( kod_isp.dat_doc ,  DATE'8999-12-31'  ) ) ) )  then ( case  when (kod_opl.dat_uch &gt;= kod_hist_mat_dec.dat_post)  then ( case  when (( nvl( kod_dogplat.prizn_konv ,0)=1 )  or (kod_opl.dat_uch &gt; ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) ) )  then (qube.sr_opl_opl_sf1)  end )  end )  end )  ,0) )  end )  as dolg_deb_on_il1/*Задолженность на дату выдачи исп. листа*//*number*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_isp as kod_isp, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1, /*Оплата начислений*//*number*/
qube.ur_dp_sum_v1 as ur_dp_sum_v1/*Признано по юр. документу*//*number*/

from (
(
(
--
select qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_isp as kod_isp, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1, /*Оплата начислений*//*number*/
null as ur_dp_sum_v1/*number*/

from (
--
select un.kod_dogplat as kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec as kod_hist_mat_dec, /*number*//*key*/
un.kod_isp as kod_isp, /*number*//*key*/
un.kod_opl as kod_opl, /*number*//*key*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.kod_dogplat as kod_dogplat, /*number*//*key*/
dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
dims.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
dims.kod_isp as kod_isp, /*number*/
dims.kod_opl as kod_opl, /*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select sr_opl_sf_a_d.kod_opl as kod_opl_prm, /*number*//*key*/
kod_dogplat.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat as kod_hist_mat_dec, /*number*//*key*/
kod_isp.kod_isp as kod_isp, /*number*//*key*/
sr_opl_sf_a_d.kod_opl as kod_opl/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf_a_d
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_opl_sf_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vv_all_deb_sf
select a.kod_deb_sf as kod_deb_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from vv_all_deb_sf
a
--\vv_all_deb_sf
)
vv_all_deb_sf_a_d1 on vv_all_deb_sf_a_d1.kod_sf = kod_sf_a_d.kod_sf--\vv_all_deb_sf
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_deb_sf as kod_deb_sf/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_deb_sf = vv_all_deb_sf_a_d1.kod_deb_sf--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat.kod_dogplat--\ur_dp_isp_arb_upr
left outer join
(
--ur_mat
select a.kod_mat as kod_mat/*number*//*key*/

from ur_mat
a
--\ur_mat
)
kod_mat1_a_d1 on kod_dogplat.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_mat_pp_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat_pp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_hist_mat_dec
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.kod_hist_mat as kod_hist_mat/*number*/

from ur_isp
a
--\ur_isp
)
kod_isp on kod_isp.kod_hist_mat = kod_hist_mat_dec.kod_hist_mat--\ur_isp
where
a.kod_dp_isp_arb_upr is not null  group by
sr_opl_sf_a_d.kod_opl, /*number*//*key*/
kod_dogplat.kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat, /*number*//*key*/
kod_isp.kod_isp/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
)
--\
)
un
--\
 group by
un.kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec, /*number*//*key*/
un.kod_isp, /*number*//*key*/
un.kod_opl/*number*//*key*/
)
qube
--\
)
--\
union all
(
--
select null as kod_dogplat, /*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
null as kod_hist_mat_dec, 
null as kod_isp, 
null as kod_opl, 
null as sr_opl_opl_sf1, /*number*/
qube.ur_dp_sum_v1 as ur_dp_sum_v1/*Признано по юр. документу*//*number*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
sum(un.ur_dp_sum_v1)  as ur_dp_sum_v1/*Признано по юр. документу*//*number*/

from (
(
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
ur_dogplat.sum_v as ur_dp_sum_v1/*Признано по юр. документу*//*number*/

from (
--
select ur_dogplat_a_d.kod_dogplat as kod_dogplat_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dogplat
select a.kod_dogplat as kod_dogplat/*number*//*key*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat_a_d
--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = ur_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null  group by
ur_dogplat_a_d.kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.sum_v as sum_v/*Признано по юр. документу*//*number*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat on ur_dogplat.kod_dogplat = dims.kod_dogplat_prm--\ur_dogplat
)
--\
union all
(
--
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as ur_dp_sum_v1/*number*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null )
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
left outer join
(
--sr_opl
select a.kod_opl as kod_opl, /*number*//*key*/
a.dat_uch as dat_uch/**//*date*/

from sr_opl
a
--\sr_opl
)
kod_opl on kod_opl.kod_opl = qube.kod_opl--\sr_opl
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.dat_doc as dat_doc/*Дата выдачи исп. листа*//*date*/

from ur_isp
a
--\ur_isp
)
kod_isp on kod_isp.kod_isp = qube.kod_isp--\ur_isp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.dat_post as dat_post, /*Дата прин. суд. акта*//*date*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_hist_mat = qube.kod_hist_mat_dec--\ur_hist_mat_dec
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.dat_form as dat_form, /*Дата расч. задолж.*//*date*/
a.prizn_konv as prizn_konv/**//*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_dogplat = qube.kod_dogplat--\ur_dogplat
 group by
qube.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dp_isp_arb_upr = qube.kod_dp_isp_arb_upr--\ur_dp_isp_arb_upr
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="ur_isp_dat_doc" table="ur_dogplat" type="date" title="Дата выдачи исп. листа" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.ur_isp_dat_doc1 as ur_isp_dat_doc, /*Дата выдачи исп. листа*//*date*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
max(qube.ur_isp_dat_doc1)  as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
qube.ur_isp_dat_doc1 as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
(
(
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
qube.ur_isp_dat_doc1 as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
max(un.ur_isp_dat_doc1)  as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
(
(
--
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as ur_isp_dat_doc1/*date*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null )
--\
union all
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
ur_isp.dat_doc as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
--
select ur_isp_a_d.kod_isp as kod_isp_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.kod_hist_mat as kod_hist_mat/*number*/

from ur_isp
a
--\ur_isp
)
ur_isp_a_d
--\ur_isp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec_a_d on ur_isp_a_d.kod_hist_mat = kod_hist_mat_dec_a_d.kod_hist_mat--\ur_hist_mat_dec
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_hist_mat_dec_a_d.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_mat_pp
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat_a_d on kod_dogplat_a_d.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null  group by
ur_isp_a_d.kod_isp, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.dat_doc as dat_doc/*Дата выдачи исп. листа*//*date*/

from ur_isp
a
--\ur_isp
)
ur_isp on ur_isp.kod_isp = dims.kod_isp_prm--\ur_isp
)
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
 group by
qube.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dp_isp_arb_upr = qube.kod_dp_isp_arb_upr--\ur_dp_isp_arb_upr
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="ur_opl_deb_posl_il" table="ur_dogplat" type="number" title="Оплата по исп. листу" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.ur_opl_deb_posl_il1 as ur_opl_deb_posl_il, /*Оплата по исп. листу*//*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
sum( case  when (kod_opl.dat_uch &gt;= kod_isp.dat_doc)  then ( case  when (kod_opl.dat_uch &gt;= kod_hist_mat_dec.dat_post)  then ( case  when (( nvl( kod_dogplat.prizn_konv ,0)=1 )  or (kod_opl.dat_uch &gt; ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) ) )  then (qube.sr_opl_opl_sf1)  end )  end )  end )  as ur_opl_deb_posl_il1/*Оплата по исп. листу*//*number*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_isp as kod_isp, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_isp as kod_isp, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select un.kod_dogplat as kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec as kod_hist_mat_dec, /*number*//*key*/
un.kod_isp as kod_isp, /*number*//*key*/
un.kod_opl as kod_opl, /*number*//*key*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.kod_dogplat as kod_dogplat, /*number*//*key*/
dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
dims.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
dims.kod_isp as kod_isp, /*number*/
dims.kod_opl as kod_opl, /*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select sr_opl_sf_a_d.kod_opl as kod_opl_prm, /*number*//*key*/
kod_dogplat.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat as kod_hist_mat_dec, /*number*//*key*/
kod_isp.kod_isp as kod_isp, /*number*//*key*/
sr_opl_sf_a_d.kod_opl as kod_opl/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf_a_d
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_opl_sf_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vv_all_deb_sf
select a.kod_deb_sf as kod_deb_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from vv_all_deb_sf
a
--\vv_all_deb_sf
)
vv_all_deb_sf_a_d1 on vv_all_deb_sf_a_d1.kod_sf = kod_sf_a_d.kod_sf--\vv_all_deb_sf
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_deb_sf as kod_deb_sf/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_deb_sf = vv_all_deb_sf_a_d1.kod_deb_sf--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat.kod_dogplat--\ur_dp_isp_arb_upr
left outer join
(
--ur_mat
select a.kod_mat as kod_mat/*number*//*key*/

from ur_mat
a
--\ur_mat
)
kod_mat1_a_d1 on kod_dogplat.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_mat_pp_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat_pp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_hist_mat_dec
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.kod_hist_mat as kod_hist_mat/*number*/

from ur_isp
a
--\ur_isp
)
kod_isp on kod_isp.kod_hist_mat = kod_hist_mat_dec.kod_hist_mat--\ur_isp
where
a.kod_dp_isp_arb_upr is not null  group by
sr_opl_sf_a_d.kod_opl, /*number*//*key*/
kod_dogplat.kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat, /*number*//*key*/
kod_isp.kod_isp/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
)
--\
)
un
--\
 group by
un.kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec, /*number*//*key*/
un.kod_isp, /*number*//*key*/
un.kod_opl/*number*//*key*/
)
qube
--\
)
--\
union all
(
--
select null as kod_dogplat, /*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
null as kod_hist_mat_dec, 
null as kod_isp, 
null as kod_opl, 
null as sr_opl_opl_sf1/*number*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
(
(
--
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null )
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
left outer join
(
--sr_opl
select a.kod_opl as kod_opl, /*number*//*key*/
a.dat_uch as dat_uch/**//*date*/

from sr_opl
a
--\sr_opl
)
kod_opl on kod_opl.kod_opl = qube.kod_opl--\sr_opl
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.dat_doc as dat_doc/*Дата выдачи исп. листа*//*date*/

from ur_isp
a
--\ur_isp
)
kod_isp on kod_isp.kod_isp = qube.kod_isp--\ur_isp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.dat_post as dat_post, /*Дата прин. суд. акта*//*date*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_hist_mat = qube.kod_hist_mat_dec--\ur_hist_mat_dec
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.dat_form as dat_form, /*Дата расч. задолж.*//*date*/
a.prizn_konv as prizn_konv/**//*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_dogplat = qube.kod_dogplat--\ur_dogplat
 group by
qube.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dp_isp_arb_upr = qube.kod_dp_isp_arb_upr--\ur_dp_isp_arb_upr
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="dolg_tek" table="ur_dogplat" type="number" title="Текущая задолженность" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select qube.ur_dp_dolg_vist_or_priz1 as dolg_tek, /*Текущая задолженность*//*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
sum( nvl( ( case  when (kod_hist_mat_dec.dat_post is null )  then qube.ur_dp_summa1 else qube.ur_dp_sum_v1 end )  ,0)  -nvl( ( case  when (kod_opl.dat_uch &gt; ( nvl( kod_hist_mat_dec.dat_post , kod_dogplat.dat_form ) ) )  then (qube.sr_opl_opl_sf1)  end )  ,0) )  as ur_dp_dolg_vist_or_priz1/*Долг по юр. документу*//*number*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1, /*Оплата начислений*//*number*/
qube.ur_dp_sum_v1 as ur_dp_sum_v1, /*Признано по юр. документу*//*number*/
qube.ur_dp_summa1 as ur_dp_summa1/*Выставленно по юр. документу*//*number*/

from (
(
(
--
select qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1, /*Оплата начислений*//*number*/
null as ur_dp_sum_v1, /*number*/
null as ur_dp_summa1/*number*/

from (
--
select un.kod_dogplat as kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec as kod_hist_mat_dec, /*number*//*key*/
un.kod_opl as kod_opl, /*number*//*key*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.kod_dogplat as kod_dogplat, /*number*//*key*/
dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
dims.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
dims.kod_opl as kod_opl, /*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select sr_opl_sf_a_d.kod_opl as kod_opl_prm, /*number*//*key*/
kod_dogplat.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat as kod_hist_mat_dec, /*number*//*key*/
sr_opl_sf_a_d.kod_opl as kod_opl/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf_a_d
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_opl_sf_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vv_all_deb_sf
select a.kod_deb_sf as kod_deb_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from vv_all_deb_sf
a
--\vv_all_deb_sf
)
vv_all_deb_sf_a_d1 on vv_all_deb_sf_a_d1.kod_sf = kod_sf_a_d.kod_sf--\vv_all_deb_sf
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_deb_sf as kod_deb_sf/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_deb_sf = vv_all_deb_sf_a_d1.kod_deb_sf--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat.kod_dogplat--\ur_dp_isp_arb_upr
left outer join
(
--ur_mat
select a.kod_mat as kod_mat/*number*//*key*/

from ur_mat
a
--\ur_mat
)
kod_mat1_a_d1 on kod_dogplat.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_mat_pp_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat_pp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_hist_mat_dec
where
a.kod_dp_isp_arb_upr is not null  group by
sr_opl_sf_a_d.kod_opl, /*number*//*key*/
kod_dogplat.kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
)
--\
)
un
--\
 group by
un.kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec, /*number*//*key*/
un.kod_opl/*number*//*key*/
)
qube
--\
)
--\
union all
(
--
select null as kod_dogplat, /*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
null as kod_opl, 
null as sr_opl_opl_sf1, /*number*/
qube.ur_dp_sum_v1 as ur_dp_sum_v1, /*Признано по юр. документу*//*number*/
qube.ur_dp_summa1 as ur_dp_summa1/*Выставленно по юр. документу*//*number*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec as kod_hist_mat_dec, /*number*//*key*/
sum(un.ur_dp_sum_v1)  as ur_dp_sum_v1, /*Признано по юр. документу*//*number*/
sum(un.ur_dp_summa1)  as ur_dp_summa1/*Выставленно по юр. документу*//*number*/

from (
(
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
dims.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
ur_dogplat.sum_v as ur_dp_sum_v1, /*Признано по юр. документу*//*number*/
ur_dogplat.summa as ur_dp_summa1/*Выставленно по юр. документу*//*number*/

from (
--
select ur_dogplat_a_d.kod_dogplat as kod_dogplat_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat as kod_hist_mat_dec/*number*//*key*/

from (
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat/*number*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat_a_d
--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = ur_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
left outer join
(
--ur_mat
select a.kod_mat as kod_mat/*number*//*key*/

from ur_mat
a
--\ur_mat
)
kod_mat1_a_d1 on ur_dogplat_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_mat_pp_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat_pp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_hist_mat_dec
where
a.kod_dp_isp_arb_upr is not null  group by
ur_dogplat_a_d.kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat/*number*//*key*/
)
dims
--\
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.summa as summa, /*Выставленно по юр. документу*//*number*/
a.sum_v as sum_v/*Признано по юр. документу*//*number*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat on ur_dogplat.kod_dogplat = dims.kod_dogplat_prm--\ur_dogplat
)
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec/*number*//*key*/
)
qube
--\
)
--\
union all
(
--
select null as kod_dogplat, /*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
null as kod_hist_mat_dec, 
null as kod_opl, 
null as sr_opl_opl_sf1, /*number*/
null as ur_dp_sum_v1, /*number*/
null as ur_dp_summa1/*number*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
(
(
--
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null )
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
left outer join
(
--sr_opl
select a.kod_opl as kod_opl, /*number*//*key*/
a.dat_uch as dat_uch/**//*date*/

from sr_opl
a
--\sr_opl
)
kod_opl on kod_opl.kod_opl = qube.kod_opl--\sr_opl
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.dat_post as dat_post, /*Дата прин. суд. акта*//*date*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_hist_mat = qube.kod_hist_mat_dec--\ur_hist_mat_dec
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.dat_form as dat_form/*Дата расч. задолж.*//*date*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_dogplat = qube.kod_dogplat--\ur_dogplat
 group by
qube.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dp_isp_arb_upr = qube.kod_dp_isp_arb_upr--\ur_dp_isp_arb_upr
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="vid_real_x_n" table="ur_dogplat.vid_real" type="string" title="Вид реализации" text-source-for="vid_real" is-refreshed="1">
          <value-refresh-cmd>
            <root>
              <params>
                <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                <param name="form_id" type="number" column="" />
              </params>
              <select>
                <params>
                  <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
                  <param name="form_id" type="number" column="" />
                </params>
                <query>
--
select vid_real_x_n.name as vid_real_x_n, /*Вид реализации*//*string*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.vid_real as vid_real/**//*number*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat on a.kod_dogplat = ur_dogplat.kod_dogplat--\ur_dogplat
left outer join
(
--sk_vid_real
select a.vid_real as vid_real, /**//*number*//*key*/
a.name as name/*Вид реализации*//*string*/

from sk_vid_real
a
--\sk_vid_real
)
vid_real_x_n on ur_dogplat.vid_real = vid_real_x_n.vid_real--\sk_vid_real
--\
</query>
              </select>
              <procedure>
                <params />
              </procedure>
            </root>
          </value-refresh-cmd>
        </column>
        <column name="is_new" table="a" type="number" title="" is-user-editable="1" />
        <column name="is_not_new" table="a" type="number" title="" is-user-editable="1" />
        <column name="kod_dp_isp_arb_upr" table="a" type="number" title="" is-user-editable="1" is-updateable="1" is-updateable-ext="1" update-target="kod_dp_isp_arb_upr" temp-col-name="n1" />
      </columns>
      <insert-text>begin 
for r in  
 ( select  
:kod_dp_isp_arb_upr as kod_dp_isp_arb_upr 
 
from dual ) 
 
loop 
insert into ur_dp_isp_arb_upr 
(kod_dp_isp_arb_upr 
) 
 values  
(r.kod_dp_isp_arb_upr 
) 
 returning  
kod_dp_isp_arb_upr into :kod_dp_isp_arb_upr; 
end loop; 
end; 
</insert-text>
      <delete-text>delete from ur_dp_isp_arb_upr where kod_dp_isp_arb_upr=:kod_dp_isp_arb_upr</delete-text>
      <update-temp-text>begin 
delete from rr_temp 
where 
skod='a' 
and 
names=:form_id 
and 
f2=:kod_dp_isp_arb_upr; 
if :row_state_id=1  then 
for r in  
 ( select  
:kod_dp_isp_arb_upr as kod_dp_isp_arb_upr 
 
from dual ) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
) 
 values  
('a' 
,:form_id 
,:kod_dp_isp_arb_upr 
,:row_state_id 
,r.kod_dp_isp_arb_upr 
); 
end loop; 
else 
for r in  
 ( select  
:kod_dp_isp_arb_upr as kod_dp_isp_arb_upr 
,a.kod_isp_arb_upr 
,a.kod_dogplat 
,a.u_m 
,a.d_m 
 
from ur_dp_isp_arb_upr a  where kod_dp_isp_arb_upr=:kod_dp_isp_arb_upr) 
 
loop 
insert into rr_temp 
(skod 
,names 
,f2 
,f3 
,n1 
,n2 
,n3 
,s1 
,d1 
) 
 values  
('a' 
,:form_id 
,:kod_dp_isp_arb_upr 
,:row_state_id 
,r.kod_dp_isp_arb_upr 
,r.kod_isp_arb_upr 
,r.kod_dogplat 
,r.u_m 
,r.d_m 
); 
end loop; 
end if; 
end; 
</update-temp-text>
      <clear-temp-text>delete from rr_temp where skod='a' and names=:form_id</clear-temp-text>
      <update-text>begin
update ur_dp_isp_arb_upr set  
(kod_dp_isp_arb_upr 
) 
= 
 ( select  
:kod_dp_isp_arb_upr as kod_dp_isp_arb_upr 
 
from dual ) 
 
where 
kod_dp_isp_arb_upr=:kod_dp_isp_arb_upr 
;
end;
</update-text>
      <scheme>
        <table name="ur_dp_isp_arb_upr" as="a">
          <columns>
            <column name="kr_dog_ndog" type="string" title="Номер договора" />
            <column name="name_doc" type="string" title="Документ начисления" />
            <column name="ym" type="number" format="F2" edit-mask="F2" title="Отчетный период" />
            <column name="vid_real" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="sr_facras_nachisl" type="number" title="Начислено" />
            <column name="ur_opl_do_ur" type="number" title="Оплата до включения в юр. документ" />
            <column name="summa" type="number" title="Выставленно по юр. документу" />
            <column name="dat_form" type="date" title="Дата расч. задолж." />
            <column name="ur_opl_do_resh" type="number" title="Оплата по юр. док. до  вынес. реш. суда" />
            <column name="sum_v" type="number" title="Признано по юр. документу" />
            <column name="ur_hist_mat_dec_dat_resh" type="date" title="Дата принятия решения" />
            <column name="ur_opl_deb_do_il" type="number" title="Оплата по. реш. суда до выдачи исп. листа" />
            <column name="dolg_deb_on_il" type="number" title="Задолженность на дату выдачи исп. листа" />
            <column name="ur_isp_dat_doc" type="date" title="Дата выдачи исп. листа" />
            <column name="ur_opl_deb_posl_il" type="number" title="Оплата по исп. листу" />
            <column name="dolg_tek" type="number" title="Текущая задолженность" />
            <column name="vid_real_x_n" type="string" title="Вид реализации" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_dp_isp_arb_upr" type="number" invisible-in-column-chooser="1" visible="0" />
          </columns>
          <viewcolumns>
            <column name="kr_dog_ndog" type="string" title="Номер договора" />
            <column name="name_doc" type="string" title="Документ начисления" />
            <column name="ym" type="number" format="F2" edit-mask="F2" title="Отчетный период" />
            <column name="vid_real_x_n" type="string" title="Вид реализации" />
            <column name="vid_real" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="sr_facras_nachisl" type="number" title="Начислено" />
            <column name="ur_opl_do_ur" type="number" title="Оплата до включения в юр. документ" />
            <column name="summa" type="number" title="Выставленно по юр. документу" />
            <column name="dat_form" type="date" title="Дата расч. задолж." />
            <column name="ur_opl_do_resh" type="number" title="Оплата по юр. док. до  вынес. реш. суда" />
            <column name="sum_v" type="number" title="Признано по юр. документу" />
            <column name="ur_hist_mat_dec_dat_resh" type="date" title="Дата принятия решения" />
            <column name="ur_opl_deb_do_il" type="number" title="Оплата по. реш. суда до выдачи исп. листа" />
            <column name="dolg_deb_on_il" type="number" title="Задолженность на дату выдачи исп. листа" />
            <column name="ur_isp_dat_doc" type="date" title="Дата выдачи исп. листа" />
            <column name="ur_opl_deb_posl_il" type="number" title="Оплата по исп. листу" />
            <column name="dolg_tek" type="number" title="Текущая задолженность" />
            <column name="is_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="is_not_new" type="number" invisible-in-column-chooser="1" visible="0" />
            <column name="kod_dp_isp_arb_upr" type="number" invisible-in-column-chooser="1" visible="0" />
          </viewcolumns>
        </table>
      </scheme>
      <single-row-refresh-cmd>
        <root>
          <params>
            <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
            <param name="form_id" type="number" column="" />
          </params>
          <select>
            <params>
              <param name="kod_dp_isp_arb_upr_prm" type="number" column="" />
              <param name="form_id" type="number" column="" />
            </params>
            <query>
--
select qube.kr_dog_ndog1 as kr_dog_ndog, /*Номер договора*//*string*/
ur_dogplat.name_doc as name_doc, /*Документ начисления*//*string*/
ur_dogplat.ym as ym, /*Отчетный период*//*number*/
ur_dogplat.vid_real as vid_real, /*number*/
qube.sr_facras_nachisl1 as sr_facras_nachisl, /*Начислено*//*number*/
qube.ur_opl_do_ur1 as ur_opl_do_ur, /*Оплата до включения в юр. документ*//*number*/
ur_dogplat.summa as summa, /*Выставленно по юр. документу*//*number*/
ur_dogplat.dat_form as dat_form, /*Дата расч. задолж.*//*date*/
qube.ur_opl_do_resh1 as ur_opl_do_resh, /*Оплата по юр. док. до  вынес. реш. суда*//*number*/
ur_dogplat.sum_v as sum_v, /*Признано по юр. документу*//*number*/
qube.ur_hist_mat_dec_dat_resh1 as ur_hist_mat_dec_dat_resh, /*Дата принятия решения*//*date*/
qube.ur_opl_deb_do_il1 as ur_opl_deb_do_il, /*Оплата по. реш. суда до выдачи исп. листа*//*number*/
qube.dolg_deb_on_il1 as dolg_deb_on_il, /*Задолженность на дату выдачи исп. листа*//*number*/
qube.ur_isp_dat_doc1 as ur_isp_dat_doc, /*Дата выдачи исп. листа*//*date*/
qube.ur_opl_deb_posl_il1 as ur_opl_deb_posl_il, /*Оплата по исп. листу*//*number*/
qube.ur_dp_dolg_vist_or_priz1 as dolg_tek, /*Текущая задолженность*//*number*/
vid_real_x_n.name as vid_real_x_n, /*Вид реализации*//*string*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new, /*number*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
stragg_dist(qube.kr_dog_ndog1)  as kr_dog_ndog1, /*Номер договора*//*string*/
sum(qube.sr_facras_nachisl1)  as sr_facras_nachisl1, /*Начислено*//*number*/
sum( case  when (kod_opl.dat_uch &lt;= ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) )  then (qube.sr_opl_opl_sf1)  end )  as ur_opl_do_ur1, /*Оплата до включения в юр. документ*//*number*/
sum( case  when (kod_opl.dat_uch &lt; ( nvl( kod_hist_mat_dec.dat_post ,  DATE'8999-12-31'  ) ) )  then ( case  when (( nvl( kod_dogplat.prizn_konv ,0)=1 )  or (kod_opl.dat_uch &gt; ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) ) )  then (qube.sr_opl_opl_sf1)  end )  end )  as ur_opl_do_resh1, /*Оплата до вынес. реш. суда*//*number*/
max(qube.ur_hist_mat_dec_dat_resh1)  as ur_hist_mat_dec_dat_resh1, /*Дата принятия решения*//*date*/
sum( case  when ((kod_opl.dat_uch &lt; ( nvl( kod_isp.dat_doc ,  DATE'8999-12-31'  ) ) ) )  then ( case  when (kod_opl.dat_uch &gt;= kod_hist_mat_dec.dat_post)  then ( case  when (( nvl( kod_dogplat.prizn_konv ,0)=1 )  or (kod_opl.dat_uch &gt; ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) ) )  then (qube.sr_opl_opl_sf2)  end )  end )  end )  as ur_opl_deb_do_il1, /*Оплата по. реш. суда до выдачи исп. листа*//*number*/
sum( case  when ( 1=1 )  then ( nvl( qube.ur_dp_sum_v1 ,0)  -nvl( ( case  when ((kod_opl.dat_uch &lt; ( nvl( kod_isp.dat_doc ,  DATE'8999-12-31'  ) ) ) )  then ( case  when (kod_opl.dat_uch &gt;= kod_hist_mat_dec.dat_post)  then ( case  when (( nvl( kod_dogplat.prizn_konv ,0)=1 )  or (kod_opl.dat_uch &gt; ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) ) )  then (qube.sr_opl_opl_sf2)  end )  end )  end )  ,0) )  end )  as dolg_deb_on_il1, /*Задолженность на дату выдачи исп. листа*//*number*/
max(qube.ur_isp_dat_doc1)  as ur_isp_dat_doc1, /*Дата выдачи исп. листа*//*date*/
sum( case  when (kod_opl.dat_uch &gt;= kod_isp.dat_doc)  then ( case  when (kod_opl.dat_uch &gt;= kod_hist_mat_dec.dat_post)  then ( case  when (( nvl( kod_dogplat.prizn_konv ,0)=1 )  or (kod_opl.dat_uch &gt; ( nullif(least (  nvl( kod_dogplat.dat_form , to_date('01.01.9999','DD.MM.YYYY'))  , nvl( kod_hist_mat_dec.dat_post , to_date('01.01.9999','DD.MM.YYYY'))  ), to_date('01.01.9999','DD.MM.YYYY')) ) ) )  then (qube.sr_opl_opl_sf2)  end )  end )  end )  as ur_opl_deb_posl_il1, /*Оплата по исп. листу*//*number*/
sum( nvl( ( case  when (kod_hist_mat_dec.dat_post is null )  then qube.ur_dp_summa1 else qube.ur_dp_sum_v2 end )  ,0)  -nvl( ( case  when (kod_opl.dat_uch &gt; ( nvl( kod_hist_mat_dec.dat_post , kod_dogplat.dat_form ) ) )  then (qube.sr_opl_opl_sf1)  end )  ,0) )  as ur_dp_dolg_vist_or_priz1/*Долг по юр. документу*//*number*/

from (
--
select qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_isp as kod_isp, /*number*/
qube.kod_opl as kod_opl, /*number*/
qube.kr_dog_ndog1 as kr_dog_ndog1, /*Номер договора*//*string*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1, /*Начислено*//*number*/
qube.sr_opl_opl_sf2 as sr_opl_opl_sf2, /*Оплата начислений*//*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1, /*Оплата начислений*//*number*/
qube.ur_dp_sum_v1 as ur_dp_sum_v1, /*Признано по юр. документу*//*number*/
qube.ur_dp_sum_v2 as ur_dp_sum_v2, /*Признано по юр. документу*//*number*/
qube.ur_dp_summa1 as ur_dp_summa1, /*Выставленно по юр. документу*//*number*/
qube.ur_hist_mat_dec_dat_resh1 as ur_hist_mat_dec_dat_resh1, /*Дата принятия решения*//*date*/
qube.ur_isp_dat_doc1 as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
(
(
--
select null as kod_dogplat, /*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
null as kod_hist_mat_dec, 
null as kod_isp, 
null as kod_opl, 
qube.kr_dog_ndog1 as kr_dog_ndog1, /*Номер договора*//*string*/
qube.sr_facras_nachisl1 as sr_facras_nachisl1, /*Начислено*//*number*/
null as sr_opl_opl_sf2, /*number*/
null as sr_opl_opl_sf1, /*number*/
null as ur_dp_sum_v1, /*number*/
null as ur_dp_sum_v2, /*number*/
null as ur_dp_summa1, /*number*/
qube.ur_hist_mat_dec_dat_resh1 as ur_hist_mat_dec_dat_resh1, /*Дата принятия решения*//*date*/
qube.ur_isp_dat_doc1 as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
stragg_dist(un.kr_dog_ndog1)  as kr_dog_ndog1, /*Номер договора*//*string*/
sum(un.sr_facras_nachisl1)  as sr_facras_nachisl1, /*Начислено*//*number*/
max(un.ur_hist_mat_dec_dat_resh1)  as ur_hist_mat_dec_dat_resh1, /*Дата принятия решения*//*date*/
max(un.ur_isp_dat_doc1)  as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
(
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kr_dogovor.ndog as kr_dog_ndog1, /*Номер договора*//*string*/
null as sr_facras_nachisl1, /*number*/
null as ur_hist_mat_dec_dat_resh1, /*date*/
null as ur_isp_dat_doc1/*date*/

from (
--
select kr_dogovor_a_d.kod_dog as kod_dog_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--kr_dogovor
select a.kod_dog as kod_dog/*number*//*key*/

from kr_dogovor
a
--\kr_dogovor
)
kr_dogovor_a_d
--\kr_dogovor
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_dog as kod_dog/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat_a_d on kod_dogplat_a_d.kod_dog = kr_dogovor_a_d.kod_dog--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null  group by
kr_dogovor_a_d.kod_dog, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--kr_dogovor
select a.kod_dog as kod_dog, /*number*//*key*/
a.ndog as ndog/*Номер договора*//*string*/

from kr_dogovor
a
--\kr_dogovor
)
kr_dogovor on kr_dogovor.kod_dog = dims.kod_dog_prm--\kr_dogovor
)
--\
union all
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as kr_dog_ndog1, /*string*/
sr_facras.nachisl as sr_facras_nachisl1, /*Начислено*//*number*/
null as ur_hist_mat_dec_dat_resh1, /*date*/
null as ur_isp_dat_doc1/*date*/

from (
--
select sr_facras_a_d.kod_ras as kod_ras_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras_a_d
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_facras_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vv_all_deb_sf
select a.kod_deb_sf as kod_deb_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from vv_all_deb_sf
a
--\vv_all_deb_sf
)
vv_all_deb_sf_a_d1 on vv_all_deb_sf_a_d1.kod_sf = kod_sf_a_d.kod_sf--\vv_all_deb_sf
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_deb_sf as kod_deb_sf/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat_a_d on kod_dogplat_a_d.kod_deb_sf = vv_all_deb_sf_a_d1.kod_deb_sf--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null  group by
sr_facras_a_d.kod_ras, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--sr_facras
select a.kod_ras as kod_ras, /*number*//*key*/
a.nachisl as nachisl/*Начислено*//*number*/

from sr_facras
a
--\sr_facras
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
a.vid_sf as vid_sf/*number*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
where
kod_sf.vid_sf not in (2 , 9) )
sr_facras on sr_facras.kod_ras = dims.kod_ras_prm--\sr_facras
)
--\
union all
(
--
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as kr_dog_ndog1, /*string*/
null as sr_facras_nachisl1, /*number*/
null as ur_hist_mat_dec_dat_resh1, /*date*/
null as ur_isp_dat_doc1/*date*/

from (
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a
--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null )
--\
union all
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as kr_dog_ndog1, /*string*/
null as sr_facras_nachisl1, /*number*/
ur_hist_mat_dec.dat_resh as ur_hist_mat_dec_dat_resh1, /*Дата принятия решения*/
null as ur_isp_dat_doc1/*date*/

from (
--
select ur_hist_mat_dec_a_d.kod_hist_mat as kod_hist_mat_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
ur_hist_mat_dec_a_d
--\ur_hist_mat_dec
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on ur_hist_mat_dec_a_d.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_mat_pp
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat_a_d on kod_dogplat_a_d.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null  group by
ur_hist_mat_dec_a_d.kod_hist_mat, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_hist_mat as kod_hist_mat_desc, /*number*//*key*/
a.dat_post as dat_resh/*Дата принятия решения*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
ur_hist_mat_dec on ur_hist_mat_dec.kod_hist_mat = dims.kod_hist_mat_prm--\ur_hist_mat_dec
)
--\
union all
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
null as kr_dog_ndog1, /*string*/
null as sr_facras_nachisl1, /*number*/
null as ur_hist_mat_dec_dat_resh1, /*date*/
ur_isp.dat_doc as ur_isp_dat_doc1/*Дата выдачи исп. листа*//*date*/

from (
--
select ur_isp_a_d.kod_isp as kod_isp_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr/*number*//*key*/

from (
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.kod_hist_mat as kod_hist_mat/*number*/

from ur_isp
a
--\ur_isp
)
ur_isp_a_d
--\ur_isp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec_a_d on ur_isp_a_d.kod_hist_mat = kod_hist_mat_dec_a_d.kod_hist_mat--\ur_hist_mat_dec
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_hist_mat_dec_a_d.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_mat_pp
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat_a_d on kod_dogplat_a_d.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
where
a.kod_dp_isp_arb_upr is not null  group by
ur_isp_a_d.kod_isp, /*number*//*key*/
a.kod_dp_isp_arb_upr/*number*//*key*/
)
dims
--\
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.dat_doc as dat_doc/*Дата выдачи исп. листа*//*date*/

from ur_isp
a
--\ur_isp
)
ur_isp on ur_isp.kod_isp = dims.kod_isp_prm--\ur_isp
)
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
)
--\
union all
(
--
select qube.kod_dogplat as kod_dogplat, /*number*//*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
qube.kod_isp as kod_isp, /*number*/
qube.kod_opl as kod_opl, /*number*/
null as kr_dog_ndog1, /*string*/
null as sr_facras_nachisl1, /*number*/
qube.sr_opl_opl_sf2 as sr_opl_opl_sf2, /*Оплата начислений*//*number*/
qube.sr_opl_opl_sf1 as sr_opl_opl_sf1, /*Оплата начислений*//*number*/
null as ur_dp_sum_v1, /*number*/
null as ur_dp_sum_v2, /*number*/
null as ur_dp_summa1, /*number*/
null as ur_hist_mat_dec_dat_resh1, /*date*/
null as ur_isp_dat_doc1/*date*/

from (
--
select un.kod_dogplat as kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec as kod_hist_mat_dec, /*number*//*key*/
un.kod_isp as kod_isp, /*number*//*key*/
un.kod_opl as kod_opl, /*number*//*key*/
sum(un.sr_opl_opl_sf2)  as sr_opl_opl_sf2, /*Оплата начислений*//*number*/
sum(un.sr_opl_opl_sf1)  as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
(
(
--
select dims.kod_dogplat as kod_dogplat, /*number*//*key*/
dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
dims.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
dims.kod_isp as kod_isp, /*number*/
dims.kod_opl as kod_opl, /*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf2, /*Оплата начислений*//*number*/
sr_opl_sf.opl_sf as sr_opl_opl_sf1/*Оплата начислений*//*number*/

from (
--
select sr_opl_sf_a_d.kod_opl as kod_opl_prm, /*number*//*key*/
kod_dogplat.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat as kod_hist_mat_dec, /*number*//*key*/
kod_isp.kod_isp as kod_isp, /*number*//*key*/
sr_opl_sf_a_d.kod_opl as kod_opl/*number*//*key*/

from (
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf_a_d
--\sr_opl_sf
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf/*number*//*key*/

from sr_facvip
a
--\sr_facvip
where
a.vid_sf not in (2 , 9) )
kod_sf_a_d on sr_opl_sf_a_d.kod_sf = kod_sf_a_d.kod_sf--\sr_facvip
left outer join
(
--vv_all_deb_sf
select a.kod_deb_sf as kod_deb_sf, /*number*//*key*/
a.kod_sf as kod_sf/*number*/

from vv_all_deb_sf
a
--\vv_all_deb_sf
)
vv_all_deb_sf_a_d1 on vv_all_deb_sf_a_d1.kod_sf = kod_sf_a_d.kod_sf--\vv_all_deb_sf
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_deb_sf as kod_deb_sf/*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_deb_sf = vv_all_deb_sf_a_d1.kod_deb_sf--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = kod_dogplat.kod_dogplat--\ur_dp_isp_arb_upr
left outer join
(
--ur_mat
select a.kod_mat as kod_mat/*number*//*key*/

from ur_mat
a
--\ur_mat
)
kod_mat1_a_d1 on kod_dogplat.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_mat_pp_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat_pp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_hist_mat_dec
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.kod_hist_mat as kod_hist_mat/*number*/

from ur_isp
a
--\ur_isp
)
kod_isp on kod_isp.kod_hist_mat = kod_hist_mat_dec.kod_hist_mat--\ur_isp
where
a.kod_dp_isp_arb_upr is not null  group by
sr_opl_sf_a_d.kod_opl, /*number*//*key*/
kod_dogplat.kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat, /*number*//*key*/
kod_isp.kod_isp/*number*//*key*/
)
dims
--\
left outer join
(
--sr_opl_sf
select a.kod_opl as kod_opl, /*number*//*key*/
 nvl( a.opl ,0)  +nvl( a.opls ,0)  as opl_sf/*Оплата начислений*//*number*/

from sr_opl
a
--\sr_opl
where
a.kod_type_opl in (0 , 2 , 3 , 4) )
sr_opl_sf on sr_opl_sf.kod_opl = dims.kod_opl_prm--\sr_opl_sf
)
--\
)
--\
)
un
--\
 group by
un.kod_dogplat, /*number*//*key*/
un.kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec, /*number*//*key*/
un.kod_isp, /*number*//*key*/
un.kod_opl/*number*//*key*/
)
qube
--\
)
--\
union all
(
--
select null as kod_dogplat, /*key*/
qube.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*/
qube.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
null as kod_isp, 
null as kod_opl, 
null as kr_dog_ndog1, /*string*/
null as sr_facras_nachisl1, /*number*/
null as sr_opl_opl_sf2, /*number*/
null as sr_opl_opl_sf1, /*number*/
qube.ur_dp_sum_v1 as ur_dp_sum_v1, /*Признано по юр. документу*//*number*/
qube.ur_dp_sum_v2 as ur_dp_sum_v2, /*Признано по юр. документу*//*number*/
qube.ur_dp_summa1 as ur_dp_summa1, /*Выставленно по юр. документу*//*number*/
null as ur_hist_mat_dec_dat_resh1, /*date*/
null as ur_isp_dat_doc1/*date*/

from (
--
select un.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec as kod_hist_mat_dec, /*number*//*key*/
sum(un.ur_dp_sum_v1)  as ur_dp_sum_v1, /*Признано по юр. документу*//*number*/
sum(un.ur_dp_sum_v2)  as ur_dp_sum_v2, /*Признано по юр. документу*//*number*/
sum(un.ur_dp_summa1)  as ur_dp_summa1/*Выставленно по юр. документу*//*number*/

from (
(
(
--
select dims.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
dims.kod_hist_mat_dec as kod_hist_mat_dec, /*number*/
ur_dogplat.sum_v as ur_dp_sum_v1, /*Признано по юр. документу*//*number*/
ur_dogplat.sum_v as ur_dp_sum_v2, /*Признано по юр. документу*//*number*/
ur_dogplat.summa as ur_dp_summa1/*Выставленно по юр. документу*//*number*/

from (
--
select ur_dogplat_a_d.kod_dogplat as kod_dogplat_prm, /*number*//*key*/
a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat as kod_hist_mat_dec/*number*//*key*/

from (
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.kod_mat as kod_mat/*number*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat_a_d
--\ur_dogplat
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dogplat = ur_dogplat_a_d.kod_dogplat--\ur_dp_isp_arb_upr
left outer join
(
--ur_mat
select a.kod_mat as kod_mat/*number*//*key*/

from ur_mat
a
--\ur_mat
)
kod_mat1_a_d1 on ur_dogplat_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat
left outer join
(
--ur_mat_pp
select a.kod_mat as kod_mat, /*number*//*key*/
a.kod_mat as kod_mat_pp/*number*//*key*/

from ur_mat
a
--\ur_mat
left outer join
(
--ur_folders
select a.kod_folders as kod_folders, /*number*//*key*/
a.kod_sdp as kod_sdp/*number*/

from ur_folders
a
--\ur_folders
)
kod_folders on a.kod_folders = kod_folders.kod_folders--\ur_folders
where
kod_folders.kod_sdp = 1)
kod_mat_pp_a_d on kod_mat_pp_a_d.kod_mat = kod_mat1_a_d1.kod_mat--\ur_mat_pp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.kod_mat as kod_mat, /*number*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_mat = kod_mat_pp_a_d.kod_mat--\ur_hist_mat_dec
where
a.kod_dp_isp_arb_upr is not null  group by
ur_dogplat_a_d.kod_dogplat, /*number*//*key*/
a.kod_dp_isp_arb_upr, /*number*//*key*/
kod_hist_mat_dec.kod_hist_mat/*number*//*key*/
)
dims
--\
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.summa as summa, /*Выставленно по юр. документу*//*number*/
a.sum_v as sum_v/*Признано по юр. документу*//*number*/

from ur_dogplat
a
--\ur_dogplat
)
ur_dogplat on ur_dogplat.kod_dogplat = dims.kod_dogplat_prm--\ur_dogplat
)
--\
)
--\
)
un
--\
 group by
un.kod_dp_isp_arb_upr, /*number*//*key*/
un.kod_hist_mat_dec/*number*//*key*/
)
qube
--\
)
--\
)
--\
)
qube
--\
)
qube
--\
left outer join
(
--sr_opl
select a.kod_opl as kod_opl, /*number*//*key*/
a.dat_uch as dat_uch/**//*date*/

from sr_opl
a
--\sr_opl
)
kod_opl on kod_opl.kod_opl = qube.kod_opl--\sr_opl
left outer join
(
--ur_isp
select a.kod_isp as kod_isp, /*number*//*key*/
a.dat_doc as dat_doc/*Дата выдачи исп. листа*//*date*/

from ur_isp
a
--\ur_isp
)
kod_isp on kod_isp.kod_isp = qube.kod_isp--\ur_isp
left outer join
(
--ur_hist_mat_dec
select a.kod_hist_mat as kod_hist_mat, /*number*//*key*/
a.dat_post as dat_post, /*Дата прин. суд. акта*//*date*/
a.kod_hist_mat as kod_hist_mat_desc/*number*//*key*/

from ur_hist_mat
a
--\ur_hist_mat
left outer join
(
--us_result
select a.kod_result as kod_result, /*number*//*key*/
a.decision as decision/**//*number*/

from us_result
a
--\us_result
)
kod_result on a.kod_result = kod_result.kod_result--\us_result
where
kod_result.decision = 1)
kod_hist_mat_dec on kod_hist_mat_dec.kod_hist_mat = qube.kod_hist_mat_dec--\ur_hist_mat_dec
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.dat_form as dat_form, /*Дата расч. задолж.*//*date*/
a.prizn_konv as prizn_konv/**//*number*/

from ur_dogplat
a
--\ur_dogplat
)
kod_dogplat on kod_dogplat.kod_dogplat = qube.kod_dogplat--\ur_dogplat
 group by
qube.kod_dp_isp_arb_upr/*number*//*key*/
)
qube
--\
left outer join
(
--ur_dp_isp_arb_upr
select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr, /*number*//*key*/
a.kod_dogplat as kod_dogplat, /*number*/
a.is_new as is_new, /*number*/
a.is_not_new as is_not_new/*number*/

from (select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat,0 as is_new,1 as is_not_new  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
a
--\(select a.kod_dp_isp_arb_upr as kod_dp_isp_arb_upr,a.kod_dogplat as kod_dogplat,0 as is_new,1 as is_not_new  from ur_dp_isp_arb_upr a where not exists (select * from rr_temp t where t.skod ='a' and t.names=:form_id  and a.kod_dp_isp_arb_upr=t.f2 ) and   a.kod_dp_isp_arb_upr in :kod_dp_isp_arb_upr_prm   union all  select t.n1 as kod_dp_isp_arb_upr,t.n3 as kod_dogplat,decode (f3,1,1,0) as is_new,decode (f3,1,0,1) as is_not_new  from rr_temp t where t.skod ='a' and t.names=:form_id  and t.f3!=3  and t.f2 in :kod_dp_isp_arb_upr_prm )
)
a on a.kod_dp_isp_arb_upr = qube.kod_dp_isp_arb_upr--\ur_dp_isp_arb_upr
left outer join
(
--ur_dogplat
select a.kod_dogplat as kod_dogplat, /*number*//*key*/
a.dat_form as dat_form, /*Дата расч. задолж.*//*date*/
a.summa as summa, /*Выставленно по юр. документу*//*number*/
a.vid_real as vid_real, /**//*number*/
a.sum_v as sum_v, /*Признано по юр. документу*//*number*/
a.ym as ym, /*Отчетный период*//*number*/
 case  when (a.kod_sf is not null )  then kod_sf.name when (a.kod_deb is not null )  then kod_deb.name when (a.kod_izv is not null )  then kod_izv.name end  as name_doc/*Документ начисления*//*string*/

from ur_dogplat
a
--\ur_dogplat
left outer join
(
--sr_debet
select a.kod_deb as kod_deb, /*number*//*key*/
'п/д ' || ' № ' || a.num_pl || ' от ' || ( to_char( a.dat_deb ,'DD.MM.YYYY') )  as name/*Документ на оплату*//*string*/

from sr_debet
a
--\sr_debet
)
kod_deb on a.kod_deb = kod_deb.kod_deb--\sr_debet
left outer join
(
--sr_facvip
select a.kod_sf as kod_sf, /*number*//*key*/
vid_sf.abbr || ' № ' || a.num_sf || ' от ' || ( to_char( a.dat_sf ,'DD.MM.YYYY') )  as name/*Документ начисления*//*string*/

from sr_facvip
a
--\sr_facvip
left outer join
(
--sk_vid_sf
select a.vid_sf as vid_sf, /**//*number*//*key*/
a.abbr as abbr/*Аббревиатура*//*string*/

from sk_vid_sf
a
--\sk_vid_sf
)
vid_sf on a.vid_sf = vid_sf.vid_sf--\sk_vid_sf
where
a.vid_sf not in (2 , 9) )
kod_sf on a.kod_sf = kod_sf.kod_sf--\sr_facvip
left outer join
(
--tnr_izv
select a.kod_izv as kod_izv, /*number*//*key*/
type_izv.abbr || ' №' || a.num_izv || ' от  ' || ( to_char( a.date_izv ,'DD.MM.YYYY') )  as name/*Аббревиатура*//*string*/

from tnr_izv
a
--\tnr_izv
left outer join
(
--tk_vidizv
select a.kod_vidizv as kod_vidizv, /*number*//*key*/
a.abbr as abbr/*Аббревиатура*//*string*/

from tk_vidizv
a
--\tk_vidizv
)
type_izv on a.type_izv = type_izv.kod_vidizv--\tk_vidizv
)
kod_izv on a.kod_izv = kod_izv.kod_izv--\tnr_izv
)
ur_dogplat on a.kod_dogplat = ur_dogplat.kod_dogplat--\ur_dogplat
left outer join
(
--sk_vid_real
select a.vid_real as vid_real, /**//*number*//*key*/
a.name as name/*Вид реализации*//*string*/

from sk_vid_real
a
--\sk_vid_real
)
vid_real_x_n on ur_dogplat.vid_real = vid_real_x_n.vid_real--\sk_vid_real
--\
</query>
          </select>
          <procedure>
            <params />
          </procedure>
        </root>
      </single-row-refresh-cmd>
    </table>
  </dataset>
</root>