<?xml version="1.0" encoding="utf-8"?>
<root>
  <queries>
    <query name="61880_9_v3_I" timestamp="18.12.2024 14:34:44">
      <params>
        <param type="string" as="podrazdel" name="podrazdel" />
      </params>
      <select>
        <column table="a" column="kod_f46" group="1" as="kod_f46" />
        <column group="sum" table="a" column="cust" as="cust_1k" mp="-3">
          <if>
            <call function="and">
              <call function="=">
                <column table="a" column="edizm" />
                <const>4</const>
              </call>
              <call function="=">
                <column table="a" column="category" />
                <const>1</const>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_1k" group="sum" as="cust_1k_by" dimname="volt">
          <pivot>
            <column table="a" column="voltage" />
            <query>
              <select>
                <column table="a1" column="voltage" />
                <column table="a1" column="abbr" />
              </select>
              <from>
                <query name="61880_9_v3_voltage" as="a1" />
              </from>
            </query>
          </pivot>
        </column>
        <column group="sum" table="a" column="nach" as="nach_1k" mp="-3">
          <if>
            <call function="=">
              <column table="a" column="category" />
              <const>1</const>
            </call>
          </if>
        </column>
        <column group="sum" table="this" column="nach_1k" as="nach_1k_by" dimname="volt" />
        <column group="sum" table="a" column="cust" as="cust_2k" mp="-3">
          <if>
            <call function="and">
              <call function="=">
                <column table="a" column="edizm" />
                <const>4</const>
              </call>
              <call function="=">
                <column table="a" column="category" />
                <const>2</const>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_2k" group="sum" as="cust_2k_by" dimname="volt" />
        <column group="sum" table="a" column="nach" as="nach_2k" mp="-3">
          <if>
            <call function="=">
              <column table="a" column="category" />
              <const>2</const>
            </call>
          </if>
        </column>
        <column group="sum" table="this" column="nach_2k" as="nach_2k_by" dimname="volt" />
        <column group="sum" table="a" column="cust" as="cust_35k" mp="-3">
          <if>
            <call function="and">
              <call function="=">
                <column table="a" column="edizm" />
                <const>4</const>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>3,5</array>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_35k" group="sum" as="cust_35k_by" dimname="volt" />
        <column group="sum" table="a" column="nach" as="nach_35k" mp="-3">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="edizm" />
                <array>4,23</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>3,5</array>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="this" column="nach_35k" as="nach_35k_by" dimname="volt" />
        <column group="sum" table="a" column="cust" as="cust_35m" mp="-3">
          <if>
            <call function="and">
              <call function="=">
                <column table="a" column="edizm" />
                <const>3</const>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>3,5</array>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_35m" group="sum" as="cust_35m_by" dimname="volt" />
        <column group="sum" table="a" column="nach" as="nach_35m" mp="-3">
          <if>
            <call function="and">
              <call function="=">
                <column table="a" column="edizm" />
                <const>3</const>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>3,5</array>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="this" column="nach_35m" as="nach_35m_by" dimname="volt" />
        <column group="sum" table="a" column="cust" as="cust_46k" mp="-3">
          <if>
            <call function="and">
              <call function="=">
                <column table="a" column="edizm" />
                <const>4</const>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>4,6</array>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_46k" group="sum" as="cust_46k_by" dimname="volt" />
        <column group="sum" table="a" column="nach" as="nach_46k" mp="-3">
          <if>
            <call function="and">
              <call function="!=">
                <column table="a" column="edizm" />
                <array>3</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>4,6</array>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="this" column="nach_46k" as="nach_46k_by" dimname="volt" />
        <column group="sum" table="a" column="cust" as="cust_46m" mp="-3">
          <if>
            <call function="and">
              <call function="!=">
                <column table="a" column="vid_t" />
                <array>22</array>
              </call>
              <call function="in">
                <column table="a" column="edizm" />
                <array>3</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>4,6</array>
              </call>
            </call>
            <call function="or" exclude="1">
              <call function="and">
                <call function="!=">
                  <column table="e" column="kod_esys" />
                  <const>31</const>
                </call>
                <call function="=">
                  <column table="a" column="edizm" />
                  <const>4</const>
                </call>
                <call function="in">
                  <column table="a" column="category" />
                  <array>4,6</array>
                </call>
                <call function="!=">
                  <column table="a" column="vid_t" />
                  <array>22</array>
                </call>
              </call>
              <call function="and">
                <call function="=">
                  <column table="e" column="kod_esys" />
                  <const>31</const>
                </call>
                <call function="=">
                  <column table="a" column="edizm" />
                  <const>4</const>
                </call>
                <call function="in">
                  <column table="a" column="category" />
                  <array>4,6</array>
                </call>
                <call function="!=">
                  <column table="a" column="vid_t" />
                  <array>22</array>
                </call>
                <call function="!=">
                  <column table="a" column="size_doc" />
                  <const>2</const>
                </call>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_46m" group="sum" as="cust_46m_by" dimname="volt" />
        <column group="sum" table="a" column="nach" as="nach_46m" mp="-3">
          <if>
            <call function="and">
              <call function="!=">
                <column table="a" column="vid_t" />
                <array>22</array>
              </call>
              <call function="in">
                <column table="a" column="edizm" />
                <array>3</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>4,6</array>
              </call>
            </call>
            <call function="or" exclude="1">
              <call function="and">
                <call function="=">
                  <column table="a" column="edizm" />
                  <const>3</const>
                </call>
                <call function="!=">
                  <column table="a" column="vid_t" />
                  <array>22</array>
                </call>
                <call function="in">
                  <column table="a" column="category" />
                  <array>4,6</array>
                </call>
                <call function="!=">
                  <column table="e" column="kod_esys" />
                  <const>31</const>
                </call>
              </call>
              <call function="and">
                <call function="=">
                  <column table="e" column="kod_esys" />
                  <const>31</const>
                </call>
                <call function="=">
                  <column table="a" column="edizm" />
                  <const>3</const>
                </call>
                <call function="!=">
                  <column table="a" column="vid_t" />
                  <array>22</array>
                </call>
                <call function="in">
                  <column table="a" column="category" />
                  <array>4,6</array>
                </call>
                <call function="!=">
                  <column table="a" column="size_doc" />
                  <const>2</const>
                </call>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="this" column="nach_46m" as="nach_46m_by" dimname="volt" />
        <column group="sum" table="a" column="cust" as="cust_46mp" mp="-3">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="vid_t" />
                <array>22</array>
              </call>
              <call function="in">
                <column table="a" column="edizm" />
                <array>3</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>4,6</array>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_46mp" group="sum" as="cust_46mp_by" dimname="volt" />
        <column group="sum" table="a" column="nach" as="nach_46mp" mp="-3">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="vid_t" />
                <array>22</array>
              </call>
              <call function="in">
                <column table="a" column="edizm" />
                <array>3</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>4,6</array>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="this" column="nach_46mp" as="nach_46mp_by" dimname="volt" />
        <column group="sum" table="a" column="cust" as="cust_34k" mp="-3">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="edizm" />
                <array>4</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>3,4</array>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_34k" group="sum" as="cust_34k_by" dimname="volt" />
        <column group="sum" table="a" column="nach" as="nach_34k" mp="-3">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="edizm" />
                <array>4,23</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>3,4</array>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="this" column="nach_34k" as="nach_34k_by" dimname="volt" />
        <column group="sum" table="a" column="cust" as="cust_34m" mp="-3">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="edizm" />
                <array>3</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>3,4</array>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_34m" group="sum" as="cust_34m_by" dimname="volt" />
        <column group="sum" table="a" column="nach" as="nach_34m" mp="-3">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="edizm" />
                <array>3</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>3,4</array>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="this" column="nach_34m" as="nach_34m_by" dimname="volt" />
        <column group="sum" table="a" column="cust" as="cust_56k" mp="-3">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="edizm" />
                <array>4</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>5,6</array>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_56k" group="sum" as="cust_56k_by" dimname="volt" />
        <column group="sum" table="a" column="nach" as="nach_56k" mp="-3">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="edizm" />
                <array>4,23</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>5,6</array>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="this" column="nach_56k" as="nach_56k_by" dimname="volt" />
        <column group="sum" table="a" column="cust" as="cust_56m" mp="-3">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="edizm" />
                <array>3</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>5,6</array>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_56m" group="sum" as="cust_56m_by" dimname="volt" />
        <column group="sum" table="a" column="nach" as="nach_56m" mp="-3">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="edizm" />
                <array>3</array>
              </call>
              <call function="in">
                <column table="a" column="category" />
                <array>5,6</array>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="this" column="nach_56m" as="nach_56m_by" dimname="volt" />
      </select>
      <from>
        <query name="sqlb_rep_61880_9_tbl" as="a" join="left outer" />
        <query name="rs_esys" as="e" join="cross" />
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="f46_razdel" />
            <const>'I'</const>
          </call>
          <call function="=">
            <column table="a" column="f46_podrazdel" />
            <useparam name="podrazdel" />
          </call>
        </call>
      </where>
      <grouping>
        <grset as="itog">
          <grset as="hs23">
            <group>
              <column table="this" column="kod_f46" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="61880_9_v3_voltage" order="kod_sort" timestamp="01.07.2024 10:14:15">
      <select>
        <column table="a" column="voltage" type="number" />
        <call function="if" as="abbr" type="string" title="Уровень напряжения">
          <call function="=">
            <column table="a" column="voltage" />
            <const type="number">6</const>
          </call>
          <const type="string">'ГН'</const>
          <column table="a" column="abbr" />
        </call>
        <column table="a" column="kod_sort" />
      </select>
      <from>
        <query name="hk_voltage" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="gt">
            <column table="a" column="voltage" />
            <const type="number">-2</const>
          </call>
          <call function="lt">
            <column table="a" column="voltage" />
            <const type="number">7</const>
          </call>
        </call>
      </where>
    </query>
    <query name="61880_9_v3_voltage_1" order="kod_sort" timestamp="08.08.2024 16:22:42">
      <select>
        <column table="a" column="voltage" />
        <call function="if" as="abbr" type="string" title="Уровень напряжения">
          <call function="=">
            <column table="a" column="voltage" />
            <const type="number">6</const>
          </call>
          <const type="string">'ГН'</const>
          <column table="a" column="abbr" />
        </call>
        <column table="a" column="kod_sort" />
      </select>
      <from>
        <query name="hk_voltage" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="ge">
            <column table="a" column="voltage" />
            <const type="number">0</const>
          </call>
          <call function="lt">
            <column table="a" column="voltage" />
            <const type="number">7</const>
          </call>
        </call>
      </where>
    </query>
    <query name="61880_9_v3_II" timestamp="06.12.2023 16:21:34">
      <params>
        <param type="string" as="podrazdel" name="podrazdel" />
      </params>
      <select>
        <column table="a" column="kod_f46" group="1" as="kod_f46" />
        <column group="sum" table="a" column="cust" as="cust_1st" mp="-3" if="1st">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="vid_t" />
                <array>77,78,79</array>
              </call>
              <call function="=">
                <column table="a" column="pr_2rate" />
                <const>0</const>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_1st" group="sum" as="cust_1st_by" dimname="volt1">
          <pivot>
            <column table="a" column="voltage" />
            <query>
              <select>
                <column table="a1" column="voltage" />
                <column table="a1" column="abbr" />
              </select>
              <from>
                <query name="61880_9_v3_voltage_1" as="a1" />
              </from>
            </query>
          </pivot>
        </column>
        <column group="sum" table="a" column="nach" as="nach_1st" mp="-3" if="1st" />
        <column group="sum" table="this" column="nach_1st" as="nach_1st_by" dimname="volt1" />
        <column group="sum" table="a" column="cust" as="cust_zon" mp="-3" if="zon">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="vid_t" />
                <array>77,78,79</array>
              </call>
              <call function="in">
                <column table="a" column="kodinterval" />
                <array>-24, -25,-23, 26, 21, 22, 23,27,28</array>
              </call>
              <call function="!=">
                <column table="a" column="pr_2rate" />
                <const>0</const>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_zon" group="sum" as="cust_zon_by" dimname="volt1" />
        <column group="sum" table="a" column="nach" as="nach_zon" mp="-3" if="zon" />
        <column group="sum" table="this" column="nach_zon" as="nach_zon_by" dimname="volt1" />
        <column group="sum" table="a" column="cust" as="cust_3st" mp="-3" if="3st">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="vid_t" />
                <array>77,78,79</array>
              </call>
              <call function="=">
                <column table="a" column="pr_2rate" />
                <const>1</const>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_3st" group="sum" as="cust_3st_by" dimname="volt1" />
        <column group="sum" table="a" column="nach" as="nach_3st" mp="-3" if="3st" />
        <column group="sum" table="this" column="nach_3st" as="nach_3st_by" dimname="volt1" />
        <column group="sum" table="a" column="cust" as="cust_3st_m" mp="-3" if="3st_m">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="edizm" />
                <array>3</array>
              </call>
              <call function="=">
                <column table="a" column="pr_2rate" />
                <const>1</const>
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="cust_3st_m" group="sum" as="cust_3st_m_by" dimname="volt1" />
        <column group="sum" table="a" column="nach" as="nach_3st_m" mp="-3" if="3st_m" />
        <column group="sum" table="this" column="nach_3st_m" as="nach_3st_m_by" dimname="volt1" />
        <column group="sum" table="a" column="cust" as="cust_kvtch_all" mp="-3">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="edizm" />
                <array>4</array>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="this" column="cust_kvtch_all" as="cust_kvtch_all_by" dimname="volt1" />
        <column group="sum" table="a" column="nach" as="nach_all" mp="-3" />
        <column group="sum" table="this" column="nach_all" as="nach_all_by" dimname="volt1" />
      </select>
      <from>
        <query name="sqlb_rep_61880_9_tbl" as="a" join="left outer" />
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="f46_razdel" />
            <const>'II'</const>
          </call>
          <call function="=">
            <column table="a" column="f46_podrazdel" />
            <useparam name="podrazdel" />
          </call>
        </call>
      </where>
      <grouping>
        <grset as="itog">
          <grset as="hs23">
            <group>
              <column table="this" column="kod_f46" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="61880_9_v3_IA" timestamp="30.11.2023 18:04:54">
      <select>
        <column table="hs_23" column="gr" group="1" />
        <column table="hs_23" column="kod_f23" as="kod_f46" group="max" />
        <column table="hs_23" column="name" as="f46_name" group="max" />
        <column table="a" column="cust_1k" group="sum" />
        <column table="a" column="cust_1k_by" group="sum" />
        <column table="a" column="nach_1k" group="sum" />
        <column table="a" column="nach_1k_by" group="sum" />
        <column table="a" column="cust_2k" group="sum" />
        <column table="a" column="cust_2k_by" group="sum" />
        <column table="a" column="nach_2k" group="sum" />
        <column table="a" column="nach_2k_by" group="sum" />
        <column table="a" column="cust_35k" group="sum" />
        <column table="a" column="cust_35k_by" group="sum" />
        <column table="a" column="nach_35k" group="sum" />
        <column table="a" column="nach_35k_by" group="sum" />
        <column table="a" column="cust_35m" group="sum" />
        <column table="a" column="cust_35m_by" group="sum" />
        <column table="a" column="nach_35m" group="sum" />
        <column table="a" column="nach_35m_by" group="sum" />
        <column table="a" column="cust_46k" group="sum" />
        <column table="a" column="cust_46k_by" group="sum" />
        <column table="a" column="nach_46k" group="sum" />
        <column table="a" column="nach_46k_by" group="sum" />
        <column table="a" column="cust_46m" group="sum" />
        <column table="a" column="cust_46m_by" group="sum" />
        <column table="a" column="nach_46m" group="sum" />
        <column table="a" column="nach_46m_by" group="sum" />
        <column table="a" column="cust_46mp" group="sum" />
        <column table="a" column="cust_46mp_by" group="sum" />
        <column table="a" column="nach_46mp" group="sum" />
        <column table="a" column="nach_46mp_by" group="sum" />
        <column table="a" column="cust_34k" group="sum" />
        <column table="a" column="cust_34k_by" group="sum" />
        <column table="a" column="nach_34k" group="sum" />
        <column table="a" column="nach_34k_by" group="sum" />
        <column table="a" column="cust_34m" group="sum" />
        <column table="a" column="cust_34m_by" group="sum" />
        <column table="a" column="nach_34m" group="sum" />
        <column table="a" column="nach_34m_by" group="sum" />
        <column table="a" column="cust_56k" group="sum" />
        <column table="a" column="cust_56k_by" group="sum" />
        <column table="a" column="nach_56k" group="sum" />
        <column table="a" column="nach_56k_by" group="sum" />
        <column table="a" column="cust_56m" group="sum" />
        <column table="a" column="cust_56m_by" group="sum" />
        <column table="a" column="nach_56m" group="sum" />
        <column table="a" column="nach_56m_by" group="sum" />
      </select>
      <from>
        <query name="hs_23" />
        <query name="61880_9_v3_I" as="a" join="left outer">
          <withparams>
            <const type="string">'А'</const>
          </withparams>
          <call function="=">
            <column table="hs_23" column="kod_f23" />
            <column table="a" column="kod_f46" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="gt">
            <column table="hs_23" column="kod_f23" />
            <const>0</const>
          </call>
          <call function="lt">
            <column table="hs_23" column="kod_f23" />
            <const>38</const>
          </call>
        </call>
      </where>
      <grouping>
        <grset as="itog">
          <grset as="hs23">
            <group>
              <column table="this" column="gr" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="61880_9_v3_IB" timestamp="30.11.2023 18:06:23">
      <select>
        <column table="hs_23" column="gr" group="1" />
        <column table="hs_23" column="name" as="f46_name" group="max" />
        <column table="hs_23" column="kod_f23" as="kod_f46" group="max" />
        <column table="a" column="cust_1k" group="sum" />
        <column table="a" column="cust_1k_by" group="sum" />
        <column table="a" column="nach_1k" group="sum" />
        <column table="a" column="nach_1k_by" group="sum" />
        <column table="a" column="cust_2k" group="sum" />
        <column table="a" column="cust_2k_by" group="sum" />
        <column table="a" column="nach_2k" group="sum" />
        <column table="a" column="nach_2k_by" group="sum" />
        <column table="a" column="cust_35k" group="sum" />
        <column table="a" column="cust_35k_by" group="sum" />
        <column table="a" column="nach_35k" group="sum" />
        <column table="a" column="nach_35k_by" group="sum" />
        <column table="a" column="cust_35m" group="sum" />
        <column table="a" column="cust_35m_by" group="sum" />
        <column table="a" column="nach_35m" group="sum" />
        <column table="a" column="nach_35m_by" group="sum" />
        <column table="a" column="cust_46k" group="sum" />
        <column table="a" column="cust_46k_by" group="sum" />
        <column table="a" column="nach_46k" group="sum" />
        <column table="a" column="nach_46k_by" group="sum" />
        <column table="a" column="cust_46m" group="sum" />
        <column table="a" column="cust_46m_by" group="sum" />
        <column table="a" column="nach_46m" group="sum" />
        <column table="a" column="nach_46m_by" group="sum" />
        <column table="a" column="cust_46mp" group="sum" />
        <column table="a" column="cust_46mp_by" group="sum" />
        <column table="a" column="nach_46mp" group="sum" />
        <column table="a" column="nach_46mp_by" group="sum" />
        <column table="a" column="cust_34k" group="sum" />
        <column table="a" column="cust_34k_by" group="sum" />
        <column table="a" column="nach_34k" group="sum" />
        <column table="a" column="nach_34k_by" group="sum" />
        <column table="a" column="cust_34m" group="sum" />
        <column table="a" column="cust_34m_by" group="sum" />
        <column table="a" column="nach_34m" group="sum" />
        <column table="a" column="nach_34m_by" group="sum" />
        <column table="a" column="cust_56k" group="sum" />
        <column table="a" column="cust_56k_by" group="sum" />
        <column table="a" column="nach_56k" group="sum" />
        <column table="a" column="nach_56k_by" group="sum" />
        <column table="a" column="cust_56m" group="sum" />
        <column table="a" column="cust_56m_by" group="sum" />
        <column table="a" column="nach_56m" group="sum" />
        <column table="a" column="nach_56m_by" group="sum" />
      </select>
      <from>
        <query name="hs_23" />
        <query name="61880_9_v3_I" as="a" join="left outer">
          <withparams>
            <const type="string">'Б'</const>
          </withparams>
          <call function="=">
            <column table="hs_23" column="kod_f23" />
            <column table="a" column="kod_f46" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="gt">
            <column table="hs_23" column="kod_f23" />
            <const>0</const>
          </call>
          <call function="lt">
            <column table="hs_23" column="kod_f23" />
            <const>38</const>
          </call>
        </call>
      </where>
      <grouping>
        <grset as="itog">
          <grset as="hs23">
            <group>
              <column table="this" column="gr" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="61880_9_v3_IIA" timestamp="06.12.2023 16:47:37">
      <select>
        <column table="hs_23" column="gr" group="1" />
        <column table="hs_23" column="kod_f23" as="kod_f46" group="max" />
        <column table="hs_23" column="name" as="f46_name" group="max" />
        <column table="a" column="cust_1st" group="sum" />
        <column table="a" column="cust_1st_by" group="sum" />
        <column table="a" column="nach_1st" group="sum" />
        <column table="a" column="nach_1st_by" group="sum" />
        <column table="a" column="cust_zon" group="sum" />
        <column table="a" column="cust_zon_by" group="sum" />
        <column table="a" column="nach_zon" group="sum" />
        <column table="a" column="nach_zon_by" group="sum" />
        <column table="a" column="cust_3st" group="sum" />
        <column table="a" column="cust_3st_by" group="sum" />
        <column table="a" column="nach_3st" group="sum" />
        <column table="a" column="nach_3st_by" group="sum" />
        <column table="a" column="cust_3st_m" group="sum" />
        <column table="a" column="cust_3st_m_by" group="sum" />
        <column table="a" column="nach_3st_m" group="sum" />
        <column table="a" column="nach_3st_m_by" group="sum" />
        <column table="a" column="cust_kvtch_all" group="sum" />
        <column table="a" column="cust_kvtch_all_by" group="sum" />
        <column table="a" column="nach_all" group="sum" />
        <column table="a" column="nach_all_by" group="sum" />
      </select>
      <from>
        <query name="hs_23" />
        <query name="61880_9_v3_II" as="a" join="left outer">
          <withparams>
            <const type="string">'А'</const>
          </withparams>
          <call function="=">
            <column table="hs_23" column="kod_f23" />
            <column table="a" column="kod_f46" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="gt">
            <column table="hs_23" column="kod_f23" />
            <const>0</const>
          </call>
          <call function="lt">
            <column table="hs_23" column="kod_f23" />
            <const>38</const>
          </call>
        </call>
      </where>
      <grouping>
        <grset as="itog">
          <grset as="hs23">
            <group>
              <column table="this" column="gr" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="61880_9_v3_IIB" timestamp="06.12.2023 16:48:40">
      <select>
        <column table="hs_23" column="gr" group="1" />
        <column table="hs_23" column="kod_f23" as="kod_f46" group="max" />
        <column table="hs_23" column="name" as="f46_name" group="max" />
        <column table="a" column="cust_1st" group="sum" />
        <column table="a" column="cust_1st_by" group="sum" />
        <column table="a" column="nach_1st" group="sum" />
        <column table="a" column="nach_1st_by" group="sum" />
        <column table="a" column="cust_zon" group="sum" />
        <column table="a" column="cust_zon_by" group="sum" />
        <column table="a" column="nach_zon" group="sum" />
        <column table="a" column="nach_zon_by" group="sum" />
        <column table="a" column="cust_3st" group="sum" />
        <column table="a" column="cust_3st_by" group="sum" />
        <column table="a" column="nach_3st" group="sum" />
        <column table="a" column="nach_3st_by" group="sum" />
        <column table="a" column="cust_3st_m" group="sum" />
        <column table="a" column="cust_3st_m_by" group="sum" />
        <column table="a" column="nach_3st_m" group="sum" />
        <column table="a" column="nach_3st_m_by" group="sum" />
        <column table="a" column="cust_kvtch_all" group="sum" />
        <column table="a" column="cust_kvtch_all_by" group="sum" />
        <column table="a" column="nach_all" group="sum" />
        <column table="a" column="nach_all_by" group="sum" />
      </select>
      <from>
        <query name="hs_23" />
        <query name="61880_9_v3_II" as="a" join="left outer">
          <withparams>
            <const type="string">'Б'</const>
          </withparams>
          <call function="=">
            <column table="hs_23" column="kod_f23" />
            <column table="a" column="kod_f46" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="gt">
            <column table="hs_23" column="kod_f23" />
            <const>0</const>
          </call>
          <call function="lt">
            <column table="hs_23" column="kod_f23" />
            <const>38</const>
          </call>
        </call>
      </where>
      <grouping>
        <grset as="itog">
          <grset as="hs23">
            <group>
              <column table="this" column="gr" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="61880_9_v3_ats" timestamp="10.07.2023 15:51:56">
      <params>
        <param name="p_dep" type="array" />
        <param name="ym1" type="number" />
        <param name="ym2" type="number" />
        <param name="kod_adr_m" type="array" />
      </params>
      <select>
        <column table="u" column="sell_rsv_value" as="sell_rsv_value" type="number" mp="-3" />
        <column table="u" column="sell_rsv_money" as="sell_rsv_money" type="number" mp="-3" />
        <column table="u" column="sell_br_value" as="sell_br_value" type="number" mp="-3" />
        <column table="u" column="sell_br_money" as="sell_br_money" type="number" mp="-3" />
        <column table="u" column="rd_value_e" as="rd_value_e" type="number" mp="-3" />
        <column table="u" column="rd_money_e" as="rd_money_e" type="number" mp="-3" />
        <column table="u" column="rd_value_p" as="rd_value_p" type="number" mp="-3" />
        <column table="u" column="rd_money_p" as="rd_money_p" type="number" mp="-3" />
        <column table="u" column="buy_pwr_dpm_value" as="buy_pwr_dpm_value" type="number" />
        <column table="u" column="buy_pwr_dpm_money" as="buy_pwr_dpm_money" type="number" mp="-3" />
        <column table="u" column="buy_pwr_dpmga_value" as="buy_pwr_dpmga_value" type="number" />
        <column table="u" column="buy_pwr_dpmga_money" as="buy_pwr_dpmga_money" type="number" mp="-3" />
        <column table="u" column="buy_rsv_value" as="buy_rsv_value" type="number" mp="-3" />
        <column table="u" column="buy_rsv_money" as="buy_rsv_money" type="number" mp="-3" />
        <column table="u" column="buy_br_value" as="buy_br_value" type="number" mp="-3" />
        <column table="u" column="buy_br_money" as="buy_br_money" type="number" mp="-3" />
        <column table="u" column="buy_pwr_frsvr_value" as="buy_pwr_frsvr_value" type="number" />
        <column table="u" column="buy_pwr_frsvr_money" as="buy_pwr_frsvr_money" type="number" mp="-3" />
        <column table="u" column="buy_pwr_kom_value" as="buy_pwr_kom_value" type="number" />
        <column table="u" column="buy_pwr_kom_money" as="buy_pwr_kom_money" type="number" mp="-3" />
        <column table="u" column="buy_pwr_kommod_value" as="buy_pwr_kommod_value" type="number" />
        <column table="u" column="buy_pwr_kommod_money" as="buy_pwr_kommod_money" type="number" mp="-3" />
        <column table="u" column="buy_pwr_con_value" as="buy_pwr_con_value" type="number" />
        <column table="u" column="buy_pwr_con_money" as="buy_pwr_con_money" type="number" mp="-3" />
        <column table="u" column="upz_sell_energy_value" as="upz_sell_energy_value" type="number" mp="-3" />
        <column table="u" column="upz_sell_energy_money" as="upz_sell_energy_money" type="number" mp="-3" />
        <column table="u" column="upz_sell_power_value" as="upz_sell_power_value" type="number" />
        <column table="u" column="upz_sell_power_money" as="upz_sell_power_money" type="number" mp="-3" />
      </select>
      <from>
        <table name="61880_9_v3_ats" view="1" as="u">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="kod_adr_m" />
          </withparams>
        </table>
      </from>
    </query>
    <query name="61880_9_v3_4R" timestamp="10.07.2023 15:51:56">
      <params>
        <param name="p_dep" type="array" />
        <param name="ym1" type="number" />
        <param name="ym2" type="number" />
        <param name="kod_adr_m" type="array" />
      </params>
      <select>
        <column table="u" column="tr_cust_fsk_kvth" as="tr_cust_fsk_kvth" type="number" mp="-3" />
        <column table="u" column="tr_cust_tso_kvth" as="tr_cust_tso_kvth" type="number" mp="-3" />
        <column table="u" column="tr_cust_fsk_kvt" as="tr_cust_fsk_kvt" type="number" mp="-3" />
        <column table="u" column="tr_cust_tso_kvt" as="tr_cust_tso_kvt" type="number" mp="-3" />
        <column table="u" column="tr_money_fsk_kvth" as="tr_money_fsk_kvth" type="number" mp="-3" />
        <column table="u" column="tr_money_tso_kvth" as="tr_money_tso_kvth" type="number" mp="-3" />
        <column table="u" column="tr_money_fsk_kvt" as="tr_money_fsk_kvt" type="number" mp="-3" />
        <column table="u" column="tr_money_tso_kvt" as="tr_money_tso_kvt" type="number" mp="-3" />
      </select>
      <from>
        <table name="61880_9_v3_4R" view="1" as="u">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="kod_adr_m" />
          </withparams>
        </table>
      </from>
    </query>
    <query name="61880_9_v3_info" timestamp="09.12.2024 14:37:33">
      <params>
        <param name="p_dep" type="array">
          <const exclude="1">21626</const>
        </param>
        <param name="p_ym_beg" type="number">
          <const exclude="1">2022.11</const>
        </param>
        <param name="p_ym_end" type="number">
          <const exclude="1">2022.11</const>
        </param>
        <param name="p_kod_adr_m" type="array">
          <const exclude="1">11818</const>
        </param>
      </params>
      <select>
        <call function="mes-name-pp" as="mes" exclude="1">
          <call function="mes">
            <useparam name="ym1" />
          </call>
        </call>
        <call function="mes-name-lowercase" as="mes" type="string">
          <call function="mes">
            <useparam name="p_ym_beg" />
          </call>
        </call>
        <call function="trunc" as="year">
          <useparam name="p_ym_beg" />
        </call>
        <call function="()" as="ym_beg" type="string">
          <call function="ym to char">
            <useparam name="p_ym_beg" />
          </call>
        </call>
        <call function="()" as="ym_end" type="string" title=" " optional="1">
          <call function="ym to char">
            <useparam name="p_ym_end" />
          </call>
        </call>
        <call function="trunc" as="year" exclude="1">
          <useparam name="ym1" />
        </call>
        <call function="||" group="stragg_dist" as="dep_name">
          <column table="kr_dep" column="name" />
        </call>
        <call function="||" group="stragg_dist" as="adr_name">
          <column table="a" column="name_p" />
        </call>
        <call function="sysdate" as="dat" />
        <call type="string" function="if" as="per_or_from_to">
          <call function="=">
            <call function="nvlu">
              <useparam name="p_ym_end" />
              <useparam name="p_ym_beg" />
            </call>
            <useparam name="p_ym_beg" />
          </call>
          <call function="||">
            <const type="string">'за '</const>
            <column table="this" column="mes" />
            <const table="this" column="mes" type="string">' '</const>
            <column table="this" column="year" />
            <const table="this" column="mes" type="string">' г.'</const>
          </call>
          <call function="||">
            <const type="string">'c  '</const>
            <column table="this" column="ym_beg" />
            <const type="string">' по  '</const>
            <column table="this" column="ym_end" />
          </call>
        </call>
      </select>
      <from>
        <query name="adr_m_obj_list_dep" as="a">
          <withparams>
            <useparam name="p_dep" />
          </withparams>
        </query>
        <query name="kr_dep" join="cross" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in" optional="1">
            <column table="a" column="kod_m" />
            <useparam name="p_kod_adr_m" />
          </call>
          <call function="in" optional="1">
            <column table="kr_dep" column="kodp" />
            <useparam name="p_dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="61880_9_v3_IV_nas" comment="Запрос для раздела IВ для строк &quot;население&quot;" timestamp="29.11.2023 18:50:13">
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="61880_9_v3_IV" as="a">
          <withparams>
            <const type="number">1</const>
          </withparams>
        </query>
      </from>
    </query>
    <query name="61880_9_v3_IV_nas_pr" comment="Запрос для раздела IВ для строк &quot;приравненные к населению&quot;" timestamp="29.11.2023 18:50:15">
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="61880_9_v3_IV" as="a">
          <withparams>
            <const type="number">0</const>
          </withparams>
        </query>
      </from>
    </query>
    <query name="61880_9_v3_IV" timestamp="26.10.2024 12:09:30">
      <params>
        <param type="number" as="is_nas" name="is_nas" />
      </params>
      <select>
        <column group="1" table="a" column="is_iku" as="is_iku" type="number" />
        <call table="hs_23" column="gr" group="2" as="kod_social" function="()" type="number">
          <const>1</const>
        </call>
        <call table="hs_23" column="name" group="max" as="name_social" function="()" type="string">
          <const type="string">'в пределах социальной нормы'</const>
        </call>
        <column group="sum" table="a" column="cust" as="cust" mp="-3" if="kvtch">
          <if>
            <call function="=">
              <column table="a" column="edizm" />
              <const>4</const>
            </call>
          </if>
        </column>
        <column group="sum" table="a" column="nachisl" as="nachisl" mp="-3" if="kvtch" />
        <column group="sum" table="a" column="nach" as="nach" mp="-3" if="kvtch" />
        <column group="sum" table="a" column="cust" as="cust1" mp="-3" if="kvtch1">
          <if>
            <call function="and">
              <call function="=">
                <column table="a" column="pr_2rate" />
                <const>0</const>
              </call>
              <call function="=">
                <column table="a" column="edizm" />
                <const>4</const>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="a" column="nachisl" as="nachisl1" mp="-3" if="kvtch1" />
        <column group="sum" table="a" column="nach" as="nach1" mp="-3" if="kvtch1" />
        <column group="sum" table="a" column="cust" as="cust2n" mp="-3" if="kvtch2n">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="kodinterval" />
                <array>-25,-23</array>
              </call>
              <call function="!=">
                <column table="a" column="pr_2rate" />
                <const>0</const>
              </call>
              <call function="=" exclude="1">
                <column table="a" column="edizm" />
                <const>4</const>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="a" column="nachisl" as="nachisl2n" mp="-3" if="kvtch2n" />
        <column group="sum" table="a" column="nach" as="nach2n" mp="-3" if="kvtch2n" />
        <column group="sum" table="a" column="cust" as="cust2d" mp="-3" if="kvtch2d">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="kodinterval" />
                <array>-24,26</array>
              </call>
              <call function="!=">
                <column table="a" column="pr_2rate" />
                <const>0</const>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="a" column="nachisl" as="nachisl2d" mp="-3" if="kvtch2d" />
        <column group="sum" table="a" column="nach" as="nach2d" mp="-3" if="kvtch2d" />
        <column group="sum" table="a" column="cust" as="cust3n" mp="-3" if="kvtch3n">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="kodinterval" />
                <array>23</array>
              </call>
              <call function="!=">
                <column table="a" column="pr_2rate" />
                <const>0</const>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="a" column="nachisl" as="nachisl3n" mp="-3" if="kvtch3n" />
        <column group="sum" table="a" column="nach" as="nach3n" mp="-3" if="kvtch3n" />
        <column group="sum" table="a" column="cust" as="cust3p" mp="-3" if="kvtch3p">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="kodinterval" />
                <array>21,27</array>
              </call>
              <call function="!=">
                <column table="a" column="pr_2rate" />
                <const>0</const>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="a" column="nachisl" as="nachisl3p" mp="-3" if="kvtch3p" />
        <column group="sum" table="a" column="nach" as="nach3p" mp="-3" if="kvtch3p" />
        <column group="sum" table="a" column="cust" as="cust3pp" mp="-3" if="kvtch3pp">
          <if>
            <call function="and">
              <call function="in">
                <column table="a" column="kodinterval" />
                <array>22,28</array>
              </call>
              <call function="!=">
                <column table="a" column="pr_2rate" />
                <const>0</const>
              </call>
            </call>
          </if>
        </column>
        <column group="sum" table="a" column="nachisl" as="nachisl3pp" mp="-3" if="kvtch3pp" />
        <column group="sum" table="a" column="nach" as="nach3pp" mp="-3" if="kvtch3pp" />
      </select>
      <from>
        <query name="sqlb_rep_61880_9_tbl" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="f46_podrazdel" />
            <const type="string">'В'</const>
          </call>
          <call function="or">
            <call function="and">
              <call function="=">
                <useparam name="is_nas" />
                <const type="number">1</const>
              </call>
              <call function="=">
                <column name="kod_fs" table="a" column="kod_fs" />
                <const type="number">-1</const>
              </call>
            </call>
            <call function="and">
              <call function="=">
                <useparam name="is_nas" />
                <const type="number">0</const>
              </call>
              <call function="!=">
                <column name="kod_fs" table="a" column="kod_fs" />
                <const type="number">-1</const>
              </call>
            </call>
          </call>
        </call>
      </where>
      <grouping>
        <grset as="itog">
          <grset as="iku">
            <group>
              <column table="this" column="is_iku" />
            </group>
            <grset as="social">
              <group>
                <column table="this" column="kod_social" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
  </queries>
  <views>
    <view name="61880_9_v3_ats" timestamp="18.10.2024 14:00:00">
      WITH
       param As (Select  :ym1 As p_ym_beg,
                         :ym2 As p_ym_end
                  From dual
                ),
      pre as (SELECT  kod_srf,
                      kod_gtp
                FROM ( SELECT nk_adress.kf_get_sf(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as kod_srf,
                              hg_common.get_gtp (n.kod_numobj, pa.p_ym_end) as kod_gtp
                        FROM kr_dogovor d
                          LEFT JOIN kr_numobj n ON d.kod_dog = n.kod_dog
                          LEFT JOIN kr_object ob ON n.kod_obj = ob.kod_obj
                          Cross Join param pa
                        WHERE 1=1 { AND d.dep IN :p_dep}
                    ) a
              WHERE 1=1 {AND a.kod_srf IN :kod_adr_m}
              GROUP BY kod_srf, kod_gtp
            )
      SELECT  --kod_srf,  
            -- pre.kod_gtp as kod_gtp,
            -- Раздел III
              SUM(ats.sell_rsv_value) as sell_rsv_value, -- kod_ats_data = 2
              SUM(ats.sell_rsv_money) as sell_rsv_money,
              SUM(ats.sell_br_value) as sell_br_value,  -- kod_ats_data = 19
              SUM(ats.sell_br_money) as sell_br_money,
            -- Раздел IV. Код строки 102
              SUM(rd_value_e) as rd_value_e,  -- kod_ats_data = 20
              SUM(rd_money_e) as rd_money_e,
              SUM(rd_value_p) as rd_value_p,  -- kod_ats_data = 20 with" value_type = 'P'
              SUM(rd_money_p) as rd_money_p,
            -- 105
              SUM(buy_pwr_dpm_value) as buy_pwr_dpm_value,  -- kod_ats_data = 16
              SUM(buy_pwr_dpm_money) as buy_pwr_dpm_money,
            -- 106
              SUM(buy_pwr_dpmga_value) as buy_pwr_dpmga_value,  -- kod_ats_data = 17
              SUM(buy_pwr_dpmga_money) as buy_pwr_dpmga_money,
            -- 107
              SUM(buy_rsv_value) as buy_rsv_value,  -- kod_ats_data = 1
              SUM(buy_rsv_money) as buy_rsv_money,
            -- 108
              SUM(buy_br_value) as buy_br_value,  -- kod_ats_data = 18
              SUM(buy_br_money) as buy_br_money,
            -- 109
              SUM(buy_pwr_frsvr_value) as buy_pwr_frsvr_value,  -- kod_ats_data = 5
              SUM(buy_pwr_frsvr_money) as buy_pwr_frsvr_money,
            -- 111
             SUM(buy_pwr_kom_value) as buy_pwr_kom_value,  -- kod_ats_data = 7+9 как для п.4.2.5 for the value for the report 58
             SUM(buy_pwr_kom_money) as buy_pwr_kom_money,
            -- 112
             SUM(buy_pwr_kommod_value) as buy_pwr_kommod_value,  -- kod_ats_data = 13
             SUM(buy_pwr_kommod_money) as buy_pwr_kommod_money,
            -- 113
             SUM(buy_pwr_con_value) as buy_pwr_con_value,  -- kod_ats_data = 14
             SUM(buy_pwr_con_money) as buy_pwr_con_money,
            -- 121 неценовые зоны
             SUM(upz_sell_energy_value) as upz_sell_energy_value,   -- value for kod_atsd_data = 10 with value_type = 'E'  (фактическое значение)
             SUM(upz_sell_energy_money) as upz_sell_energy_money,   -- money for kod_atsd_data = 10 with value_type = 'E'  (фактическое значение)
             SUM(upz_sell_power_value) as upz_sell_power_value,    -- value for kod_atsd_data = 11 with value_type = 'P'
             SUM(upz_sell_power_money) as upz_sell_power_money
      FROM pre
       INNER JOIN  table(ng_rep_other.get_tbl_ats_data(:ym1, :ym2, 1)) ats ON pre.kod_gtp = ats.kod_gtp
          
    </view>
    <view name="61880_9_v3_4R" timestamp="07.07.2023 14:00:00">
WITH
    param As (
              Select  :ym1 As p_date_beg,
                      :ym2 As p_date_end		      
                From dual
              ),
    obj_per_adm
         as (Select kod_numobj, kod_adm, kod_dog, ndog
               from (select numobj.kod_numobj, numobj.kod_dog , ndog,
                            nk_adress.kf_get_sf(CASE WHEN ob.kodd IS NULL OR ob.kodd = -1 THEN d.kod_d_dog ELSE ob.kodd END) as kod_adm
                       from kr_numobj numobj
                           left join kr_dogovor d on d.kod_dog=numobj.kod_dog
                           left join kr_object ob on ob.kod_obj=numobj.kod_obj
                      where 1=1 { AND d.dep IN :p_dep}
                      ) pre                
              where 1=1 {AND pre.kod_adm IN :kod_adr_m}
            )
   
Select  /* по услугам по передачи ЭЭ*/
       Sum(Case When n.edizm = 4 And volt.voltage = -1 Then a.cust Else 0 End) As tr_cust_fsk_kvth,  -- объем ЭЭ только ФСК
       Sum(Case When n.edizm = 4 And volt.voltage != -1 Then a.cust ELSE 0 End) As tr_cust_tso_kvth, -- объем ЭЭ всех ТСО за исключением ФСК
       
       Sum(Case When n.edizm = 3 And volt.voltage = -1 Then a.cust Else 0 End) As tr_cust_fsk_kvt,  -- объем мощности только ФСК
       Sum(Case When n.edizm = 3 And volt.voltage != -1 Then a.cust Else 0 End) As tr_cust_tso_kvt, -- объем мощности всех ТСО за исключением ФСК

       Sum(Case When n.edizm = 4 And volt.voltage = -1 Then a.money Else 0 End) As tr_money_fsk_kvth,  /*стоимость без НДС*/
       Sum(Case When n.edizm = 4 And volt.voltage != -1 Then a.money Else 0 End) As tr_money_tso_kvth,  /*стоимость без НДС*/
       Sum(Case When n.edizm = 3 And volt.voltage = -1 Then a.money Else 0 End) As tr_money_fsk_kvt,
       Sum(Case When n.edizm = 3 And volt.voltage != -1 Then a.money Else 0 End) As tr_money_tso_kvt
             
  From kr_dogovor d 
     Inner Join nv_account_sost_obj a On a.kod_dog = d.kod_dog
     Inner Join sk_nachisl n On a.vid_t = n.vid_t              
     Inner join hk_voltage volt On a.voltage = volt.voltage    
     Inner Join hr_reglament_pp p On p.kod_reglament = a.kod_reglament
     Inner Join hr_calc_variant v On v.kod_variant = p.kod_variant
     Inner Join obj_per_adm ob On a.kod_numobj = ob.kod_numobj
     Cross Join param pa
 Where a.ym Between pa.p_date_beg And pa.p_date_end
       {AND d.dep IN :p_dep}
       And v.kod_typevariant = 1    -- покупка
       And v.pr_notransit = 1
       And a.price Is Not Null
       And (a.tip_tarif_sost = 2 Or a.vid_t = -222)
    </view>
  </views>
  <forms>
    <form name="61880_9_v3" timestamp="06.12.2024 16:17:15">
      <usefield field="asuse_dep" name="p_dep" mandatory="1" title="Отделение" />
      <usefield field="asuse_ym_tek_dep" name="ym1" mandatory="1" title="Период с" />
      <usefield field="asuse_ym_tek_dep" name="ym2" mandatory="1" title="Период по" />
      <usefield field="asuse_adr_m_obj_dep" name="kod_adr_m" title="Субъект Федерации" />
    </form>
    <form name="61880_9_v3_batch" timestamp="09.12.2024 12:44:39">
      <usefield field="asuse_dep" name="p_dep" mandatory="1" title="Отделение" type="number" />
      <usefield field="asuse_ym_tek_dep" name="ym1" mandatory="1" title="Период с" type="number" />
      <usefield field="asuse_ym_tek_dep" name="ym2" mandatory="1" title="Период по" type="number" />
      <usefield field="asuse_adr_m_obj_dep" name="kod_adr_m" title="Субъект Федерации" type="number" />
      <fieldgroup as="batch" title="Пакетная выгрузка">
        <field controlType="UICheck" type="number" title="Суммировать по периодам" name="p_flag_sum" />
        <uicommand name="button_batch_unload_rep" title="Пакетная выгрузка отчета" action-type="custom" type="Ellipsis">
          <useaction name="batch_unload_rep">
            <useparam name="p_dep" type="number" />
            <useparam name="ym1" type="number" />
            <useparam name="ym2" type="number" />
            <useparam name="kod_adr_m" type="number" />
            <useparam name="p_flag_sum" />
          </useaction>
        </uicommand>
      </fieldgroup>
    </form>
  </forms>
  <reports>
    <report name="61880_9_v3" title="4.6.2.3.2.2. Форма N 46-ЭЭ (полезный отпуск; версия 3.1)" folder="f46" nogrid="1" form="61880_9_v3" timestamp="09.12.2024 11:44:56">
      <customers>
        <customer id="29" />
      </customers>
      <!--form="61880_9_v3"-->
      <params>
        <param name="p_dep" type="array" />
        <param name="ym1" type="number" />
        <param name="ym2" type="number" />
        <param name="kod_adr_m" type="array" />
      </params>
      <procedure><![CDATA[
        begin
          delete vr_number_array;
          for rec in (select * from kr_org where kodp in :p_dep)
          loop
            insert into vr_number_array (array_id,val) values ('p_dep',rec.kodp);
          end loop;
 INSERT INTO vr_number_array (array_id,val) 
 SELECT 'kod_adr_m', kod_m	
 FROM adr_m 	
 WHERE 1=0 {OR kod_m in :kod_adr_m};


          sqlb_rep_61880_9_v3.fill_table(:ym1,:ym2);
        end;
    ]]></procedure>
      <print-templates>
        <excel>
          <template name="61880_9.xlsx" title="Форма 46-ЭЭ (полезный отпуск)" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="61880_9_v3_IA" as="r1a" />
        <query name="61880_9_v3_IB" as="r1b" />
        <query name="61880_9_v3_IV_nas" as="r1v_n" />
        <query name="61880_9_v3_IV_nas_pr" as="r1v_np" />
        <query name="61880_9_v3_IIA" as="r2a" />
        <query name="61880_9_v3_IIB" as="r2b" />
        <query name="61880_9_v3_ats" as="ats">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="kod_adr_m" />
          </withparams>
        </query>
        <query name="61880_9_v3_4R" as="r4">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="kod_adr_m" />
          </withparams>
        </query>
        <query name="61880_9_v3_info" as="info">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="kod_adr_m" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="61880_9_v3_ryaz" title="14. Форма N 46-ЭЭ (полезный отпуск; версия 3.1)" folder="f46" nogrid="1" form="61880_9_v3" timestamp="28.10.2024 15:20:15">
      <customers>
        <customer id="310" />
      </customers>
      <!--form="61880_9_v3"-->
      <params>
        <param name="p_dep" type="array" />
        <param name="ym1" type="number" />
        <param name="ym2" type="number" />
        <param name="kod_adr_m" type="array" />
      </params>
      <procedure><![CDATA[
        begin
   
       delete vr_number_array;
          for rec in (select * from kr_org where kodp in :p_dep)
          loop
            insert into vr_number_array (array_id,val) values ('p_dep',rec.kodp);
          end loop;
 INSERT INTO vr_number_array (array_id,val) 
 SELECT 'kod_adr_m', kod_m	
 FROM adr_m 	
 WHERE 1=0 {OR kod_m in :kod_adr_m};


          sqlb_rep_61880_9_v3.fill_table(:ym1,:ym2);
        end;
    ]]></procedure>
      <print-templates>
        <excel>
          <template name="61880_9.xlsx" title="Форма 46-ЭЭ (полезный отпуск)" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="61880_9_v3_IA" as="r1a" />
        <query name="61880_9_v3_IB" as="r1b" />
        <query name="61880_9_v3_IV_nas" as="r1v_n" />
        <query name="61880_9_v3_IV_nas_pr" as="r1v_np" />
        <query name="61880_9_v3_IIA" as="r2a" />
        <query name="61880_9_v3_IIB" as="r2b" />
        <query name="61880_9_v3_ats" as="ats">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="kod_adr_m" />
          </withparams>
        </query>
        <query name="61880_9_v3_4R" as="r4">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="kod_adr_m" />
          </withparams>
        </query>
        <query name="61880_9_v3_info" as="info">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="kod_adr_m" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="61880_9_v3_batch" title="4.6.2.3.2.2. Форма N 46-ЭЭ (полезный отпуск; версия 3.2)" folder="f46" nogrid="1" form="61880_9_v3_batch" timestamp="09.12.2024 14:38:58">
      <customers>
        <customer id="29" />
      </customers>
      <!--form="61880_9_v3"-->
      <params>
        <param name="p_dep" type="array" />
        <param name="ym1" type="number" />
        <param name="ym2" type="number" />
        <param name="kod_adr_m" type="array" />
      </params>
      <procedure><![CDATA[
        begin
          delete vr_number_array;
          for rec in (select * from kr_org where kodp in :p_dep)
          loop
            insert into vr_number_array (array_id,val) values ('p_dep',rec.kodp);
          end loop;
 INSERT INTO vr_number_array (array_id,val) 
 SELECT 'kod_adr_m', kod_m	
 FROM adr_m 	
 WHERE 1=0 {OR kod_m in :kod_adr_m};


          sqlb_rep_61880_9_v3.fill_table(:ym1,:ym2);
        end;
    ]]></procedure>
      <print-templates>
        <excel>
          <template name="61880_9.xlsx" title="Форма 46-ЭЭ (полезный отпуск)" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="61880_9_v3_IA" as="r1a" />
        <query name="61880_9_v3_IB" as="r1b" />
        <query name="61880_9_v3_IV_nas" as="r1v_n" />
        <query name="61880_9_v3_IV_nas_pr" as="r1v_np" />
        <query name="61880_9_v3_IIA" as="r2a" />
        <query name="61880_9_v3_IIB" as="r2b" />
        <query name="61880_9_v3_ats" as="ats">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="kod_adr_m" />
          </withparams>
        </query>
        <query name="61880_9_v3_4R" as="r4">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="kod_adr_m" />
          </withparams>
        </query>
        <query name="61880_9_v3_info" as="info">
          <withparams>
            <useparam name="p_dep" />
            <useparam name="ym1" />
            <useparam name="ym2" />
            <useparam name="kod_adr_m" />
          </withparams>
        </query>
      </queries>
    </report>
  </reports>
</root>