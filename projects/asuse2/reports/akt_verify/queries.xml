<?xml version="1.0" encoding="utf-8"?>
<root>
  <queries>
    <query name="poisk_akt_verify" title="Поиск ком. ПУ для формирования актов проверки" is-report="1" timestamp="24.04.2018 15:23:32" visible="0" can-use-simple-params="1">
      <customers>
        <customer id="102" />
      </customers>
      <content>
        <usefield title="Филиал ТСО точки учёта" field="asuse_kod_seti" name="fil_tu" editable="pr_tree" editable-invert="1" />
        <usefield field="asuse_kod_elter_org_tu_prava" name="res_tu" title="РЭС ТСО точки учёта" />
        <fieldgroup title="Потребитель">
          <usefield title="Наименование потребителя" name="kodp" field="asuse_kodp_kod_res" />
          <usefield field="asuse_prizn_activ_dog" title="Статус договора" name="kod_activ_dog" />
          <usefield field="asuse_kod_dog_kodp_res" title="№ Договора" name="kod_dog" />
          <usefield field="asuse_prizn_activ_dog" title="Статус объекта" name="kod_activ_obj" />
          <usefield title="Наименование объекта" field="asuse_kod_numobj_kod_res" name="kod_numobj" />
          <usefield field="asuse_kod_point_kod_res" name="kod_point" title="Наименование точки" />
        </fieldgroup>
        <fieldgroup title="Схема сети">
          <usefield field="asuse_kod_balter_org" column-visible="1" title="Бал. принад. ЦП" name="bal_id_eo" editable="pr_tree" editable-invert="1" />
          <usefield field="asuse_kod_eosrc(kodp_res)" name="eobj_id_eo" column-visible="1" title="Центр питания" editable="pr_tree" editable-invert="1" />
          <usefield field="asuse_kod_eobject_eq" name="eobj_id" column-visible="1" editable="pr_tree" title="Оборудование" clear-on-list-change="1" editable-invert="1" />
          <usefield field="asuse_kod_eosrc_tp(kodp_res)" column-visible="1" editable="1" title="ТП ( КТП)" name="eobj_id_eo_tp" />
          <usefield field="asuse_kod_eobject_eq" name="eobj_id_tp" column-visible="1" editable="eobj_id_eo_tp" title="Линия НН" clear-on-list-change="1">
            <listquery>
              <query name="hv_eobject_eq_tp">
                <withparams exclude="1">
                  <useparam name="kod_adr_m" />
                </withparams>
              </query>
            </listquery>
          </usefield>
          <usefield field="asuse_kod_org_group_elmarket" show-nulls="1" name="kod_org_elmarket" title="Признак подключения к сети" />
        </fieldgroup>
        <fieldgroup title="Адреc">
          <usefield field="asuse_adr_m" name="kod_adr_m" />
          <usefield field="asuse_k_house_chet" name="kod_chet_obj" exclude="1" />
          <usefield field="asuse_k_strits" name="kod_street_obj" editable="kod_adr_m" clear-on-list-change="1">
            <listquery exclude="1">
              <query name="k_strits-list">
                <withparams>
                  <useparam name="kod_adr_m" />
                </withparams>
              </query>
            </listquery>
          </usefield>
          <usefield field="asuse_k_house" name="kod_d_obj" exclude="1">
            <listquery>
              <query name="k_house-list">
                <withparams>
                  <useparam name="kod_adr_m_obj" />
                  <useparam name="kod_street_obj" />
                  <useparam name="kod_chet_obj" />
                </withparams>
              </query>
            </listquery>
          </usefield>
          <usefield field="asuse_k_house-flats" name="kodd_flat_obj" exclude="1">
            <listquery>
              <query name="k_house-flats-list">
                <withparams>
                  <useparam name="kod_adr_m_obj" />
                  <useparam name="kod_street_obj" />
                  <useparam name="kod_chet_obj" />
                  <useparam name="kod_d_obj" />
                </withparams>
              </query>
            </listquery>
          </usefield>
        </fieldgroup>
        <fieldgroup title="Средство измерения">
          <usefield title="Номер счётчика" field="cmn_string" name="serial_num" />
          <usefield title="Номер пломбы, марки" field="cmn_string" name="plomba_num" />
          <fieldgroup title="Проверки">
            <usefield field="asuse_kod_condi_choise" name="condi_choise" title="Условие выбора" />
            <fieldgroup title="Дата проверки" expanded="0" exists="1" visible="1">
              <usefield field="cmn_date" name="date_s" title="C" color="tttttt37" width-perc="50" visible="pr_interval">
                <defaultquery>
                  <query name="null_values_for_param" />
                </defaultquery>
              </usefield>
              <usefield field="cmn_date" name="date_po" title="По" width-perc="50" visible="pr_interval">
                <defaultquery>
                  <query name="null_values_for_param" />
                </defaultquery>
              </usefield>
            </fieldgroup>
            <fieldgroup title="Дата следующей проверки" expanded="0">
              <usefield field="cmn_date" name="date_s_next" title="C" color="tttttt37" width-perc="50" visible="pr_interval">
                <defaultquery>
                  <query name="null_values_for_param" />
                </defaultquery>
              </usefield>
              <usefield field="cmn_date" name="date_po_next" title="По" width-perc="50" visible="pr_interval">
                <defaultquery>
                  <query name="null_values_for_param" />
                </defaultquery>
              </usefield>
            </fieldgroup>
          </fieldgroup>
        </fieldgroup>
        <usefield title="Учитывать выбор в навигаторе" field="cmn_check" name="pr_tree" column-default="1" checked="1" column-visible="0" editable="1" />
        <usefield title="Установлен энергообъект" field="cmn_check" name="pr_eobj_eo" column-visible="0" editable="1" new-val="eobj_id_eo" visible="1" />
        <usefield field="cmn_check" name="pr_tree_and_eobj_eo" column-default="1" checked="1" column-visible="0" editable="1" title="Не учитывать выбор в навигаторе и задан энергообъект" visible="1">
          <defaultquery exclude="1">
            <query name="both_param_not_null" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_check" column-default="1" checked="1" column-visible="0" editable="1" name="pr_interval" title="Выбран интервал">
          <defaultquery>
            <query name="poisk_condi_choise_check" />
          </defaultquery>
        </usefield>
      </content>
      <select call="poisk_akt_verify_output">
        <call function="||-" as="id" key="1">
          <call function="rownum" />
          <column table="kod_point_pu" column="kod_point_pu" />
        </call>
        <column table="kod_point_pu" column="kod_point_pu" as="p_kod_point_pu" />
        <column table="kod_numobj_mn" column="kod_numobj" as="p_kod_numobj" />
        <column table="eobj_id" column="eobj_id" as="p_eobj_id" />
      </select>
      <from>
        <qube>
          <link name="kod_point_pu" all-rows="1" />
          <link name="kod_point">
            <link name="kod_net" />
          </link>
          <link name="kod_point_har" />
          <link name="kod_pktippu" />
          <link name="kod_seti" />
          <link name="kod_elter" />
          <link name="eobj_id" />
          <link name="kod_parent_eo" />
          <link name="kod_srckind" />
          <link name="kod_eobject_senter_nut" />
          <link name="kod_numobj_mn">
            <link name="pr_active" as="obj_active" />
          </link>
          <link name="kodd">
            <link name="kod_s" />
          </link>
          <link name="kod_dog">
            <link name="pr_active" as="dog_active" />
          </link>
          <link name="kodp" />
          <link name="kod_prov" />
          <link name="kod_plombs" />
          <where>
            <call function="and" comment="Условия по прибору учёта: номер и активность">
              <call function="true" />
              <call function="is not null">
                <column table="kod_point_pu" column="kod_point_pu" />
              </call>
            </call>
            <call function="and" comment="Условия по прибору учёта: номер и активность">
              <call function="true" />
              <call function="like" optional="1">
                <column table="kod_point_pu" column="nom_pu" />
                <useparam name="serial_num" />
              </call>
              <call function="is null">
                <column table="kod_point_pu" column="dat_po" />
              </call>
              <call function="like" optional="1">
                <column table="kod_plombs" column="plomba" />
                <useparam name="plomba_num" />
              </call>
            </call>
            <call function="and" comment="Условия на филиал \ рэс ТУ">
              <call function="true" />
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_seti" column="kod" />
                <useparam name="fil_tu" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к рэс">
                <column table="kod_elter" column="kodp" />
                <useparam name="res_tu" />
              </call>
            </call>
            <call function="and" comment="Условия на схему">
              <call function="true" />
              <call function="is null">
                <column table="kod_point_har" column="dat_po" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_eobject_senter_nut" column="bal_id_senter_nut" />
                <useparam name="bal_id_eo" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="eobj_id" column="eobj_id" />
                <useparam name="eobj_id_tp" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_parent_eo" column="eobj_id" />
                <useparam name="eobj_id_eo_tp" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_eobject_senter_nut" column="id_senter_nut" />
                <useparam name="eobj_id_eo" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_eobject_senter_nut" column="id_fider_nut" />
                <useparam name="eobj_id" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_net" column="kod_org_group" />
                <useparam name="kod_org_elmarket" />
              </call>
            </call>
            <call function="and" comment="Условия по договорной части">
              <call function="true" />
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_dog" column="pr_active" />
                <useparam name="kod_activ_dog" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_numobj_mn" column="pr_active" />
                <useparam name="kod_activ_obj" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_dog" column="kod_dog" />
                <useparam name="kod_dog" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_numobj_mn" column="kod_numobj" />
                <useparam name="kod_numobj" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kodp" column="kodp" />
                <useparam name="kodp" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_point" column="kod_point" />
                <useparam name="kod_point" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_s" column="kod_m" />
                <useparam name="kod_adr_m" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kodd" column="kod_s" />
                <useparam name="kod_street_obj" />
              </call>
            </call>
            <call function="and" comment="Условия по прибору учёта: номер и активность">
              <call function="true" />
              <call function="or" optional="1">
                <call function="=">
                  <useparam name="condi_choise" />
                  <const>2</const>
                </call>
                <call function="is null">
                  <column table="kod_prov" column="last_prov" />
                </call>
              </call>
              <call function="ge" optional="1">
                <column table="kod_prov" column="last_prov" />
                <useparam name="date_s" />
              </call>
              <call function="ge" optional="1">
                <column table="kod_prov" column="next_prov" />
                <useparam name="date_s_next" />
              </call>
              <call function="le" optional="1">
                <column table="kod_prov" column="next_prov" />
                <useparam name="date_po_next" />
              </call>
              <call function="le" optional="1">
                <column table="kod_prov" column="last_prov" />
                <useparam name="date_po" />
              </call>
            </call>
          </where>
        </qube>
      </from>
    </query>
    <query name="kr_dogovor(kodp_res)" title="Список договоров на РЭС" timestamp="06.11.2017 01:15:25">
      <params>
        <param type="array" name="res_tu" />
        <param type="array" name="fil_tu" />
        <param name="kod_activ_dog" type="array" />
        <param name="kodp" type="array" />
      </params>
      <select>
        <column table="a" column="kod_dog" key="1" type="number" />
        <column table="a" column="ndog" title="Номер договора" type="string" />
        <column table="a" column="abbr" title="Статус договора" type="string" />
        <column table="a" column="dep_name" as="dep_name" title="Отделение" type="string" />
        <column table="a" column="nump" title="Код потребителя" type="string" />
        <column table="a" column="payer_name" as="payer_name" title="Наименование потребителя" type="string" />
      </select>
      <from>
        <table name="kv_dogovor_res" as="a" view="1" />
      </from>
    </query>
    <query name="kr_payer(kodp_res)" title="Список потребителей по РЭС" timestamp="06.11.2017 01:01:26">
      <params>
        <param type="array" name="res_tu" />
        <param type="array" name="fil_tu" />
      </params>
      <select>
        <column table="a" column="kodp" key="1" type="number" />
        <column table="a" column="payer_name" as="payer_name" title="Наименование потребителя" type="string" />
        <column table="a" column="nump" title="Код потребителя" type="string" />
        <column table="a" column="inn" title="ИНН" type="string" />
      </select>
      <from>
        <table name="kv_payer_res" as="a" view="1" />
      </from>
    </query>
    <query name="kr_numobj(kodp_res)" title="Список объектов договора по РЭС" timestamp="06.11.2017 01:13:07">
      <params>
        <param type="array" name="res_tu" />
        <param type="array" name="fil_tu" />
        <param name="kod_dog" type="array" />
        <param name="kod_activ_obj" type="array" />
      </params>
      <select>
        <column table="a" column="kod_numobj" key="1" type="number" />
        <column table="a" column="ndog" title="Номер договора" type="string" />
        <column table="a" column="name" title="Название объекта" type="string" />
        <column table="a" column="num_obj" title="Номер объекта" type="string" />
        <column table="a" column="abbr" title="Статус объекта" type="string" />
      </select>
      <from>
        <table name="kv_numobj_res" as="a" view="1" />
      </from>
    </query>
    <query name="hr_point(kodp_res)" title="Точки учёта по РЭС" timestamp="06.11.2017 01:23:32">
      <params>
        <param type="array" name="res_tu" />
        <param type="array" name="fil_tu" />
        <param name="kod_dog" type="array" />
        <param name="kod_numobj" type="array" />
      </params>
      <select>
        <column table="a" column="kod_point" key="1" type="number" />
        <column table="a" column="ndog" title="Номер договора" type="string" />
        <column table="a" column="num_obj" title="Номер объекта" type="string" as="num_obj" />
        <call function="||" as="name" title="Наименование точки" type="string">
          <const>'№ '</const>
          <column table="a" column="nomer" title="Номер" type="string" />
          <const>' '</const>
          <column table="a" column="name" title="Наименование" type="string" />
        </call>
        <column table="a" column="abbr" title="Статус точки" type="string" />
        <column table="a" column="mesto" title="Место установки" type="string" />
      </select>
      <from>
        <table name="hv_point_res" as="a" view="1" />
      </from>
    </query>
    <query name="hv_eosrc(kod_res)" title="Список энергообъектов с учётом РЭС" timestamp="06.11.2017 01:37:35">
      <params>
        <param type="array" name="res_tu" />
        <param type="array" name="fil_tu" />
        <param name="bal_id_eo" type="array" />
        <param name="pr_tree" type="number" />
      </params>
      <select>
        <column table="a" column="seobj_id" key="1" type="number" />
        <column table="a" column="seobj_name" title="Наименование" type="string" />
        <column table="a" column="kindname" title="Тип" type="string" />
        <column table="a" column="balter_name" title="Балансовая принадлежность" type="string" />
        <column table="a" column="elter_name" title="Эксплуатационная ответственность" type="string" />
        <column table="a" column="seti" title="Сети" type="string" />
      </select>
      <from>
        <table name="hv_eosrc_res" as="a" view="1" />
      </from>
    </query>
    <query name="hv_eosrc_tp(kod_res)" timestamp="06.11.2017 01:38:00" title="Список ТП по РЭС">
      <params>
        <param type="array" name="res_tu" />
        <param type="array" name="fil_tu" />
        <param type="array" name="bal_id_eo" />
        <param name="eobj_id" type="array" />
        <param name="eobj_id_eo" type="array" />
      </params>
      <select>
        <column table="a" column="seobj_id" key="1" type="number" />
        <column table="a" column="seobj_name" title="Наименование" type="string" />
        <column table="a" column="kindname" title="Тип" type="string" />
        <column table="a" column="balter_name" title="Балансовая принадлежность" type="string" />
        <column table="a" column="elter_name" title="Эксплуатационная ответственность" type="string" />
        <column table="a" column="seti" title="Сети" type="string" />
      </select>
      <from>
        <table name="hv_eosrc_tp_res" as="a" view="1" />
      </from>
    </query>
    <query name="both_param_not_null" title="Проверка: оба параметра не равны NULL" timestamp="27.10.2017 13:38:06">
      <params>
        <param type="number" name="pr_eobj_eo" />
        <param type="number" name="pr_tree" />
      </params>
      <select>
        <call function="*" as="res">
          <call function="decode" as="pr_tree">
            <useparam name="pr_tree" />
            <call function="null" />
            <const>1</const>
            <const>0</const>
            <const>1</const>
            <const>1</const>
            <const>0</const>
          </call>
          <call function="decode" as="pr_eobj">
            <useparam name="pr_eobj_eo" />
            <call function="null" />
            <const>0</const>
            <const>0</const>
            <const>0</const>
            <const>1</const>
            <const>1</const>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" />
      </from>
    </query>
    <query name="hv_condi_choise" title="Условия выбора проверок по ПУ" timestamp="25.10.2017 15:41:55">
      <select>
        <column table="a" column="kod" key="1" type="number" />
        <column table="a" column="name" title="Способ отбора" type="string" />
      </select>
      <from>
        <table name="hv_condi_choise" as="a" view="1" />
      </from>
    </query>
    <query name="null_values_for_param" title="Запрос возвращает NULL при смене параметра" timestamp="25.10.2017 16:00:24">
      <params>
        <param name="condi_choise" type="number" />
      </params>
      <select>
        <call function="decode" as="res">
          <useparam name="condi_choise" />
          <const function="null">1</const>
          <call function="null">0</call>
          <call function="null">1</call>
        </call>
      </select>
      <from>
        <query name="dual" />
      </from>
    </query>
    <query name="poisk_condi_choise_check" title="Выбор способа задания проверки ПУ" timestamp="26.10.2017 10:28:34">
      <params>
        <param name="condi_choise" type="array" />
      </params>
      <select>
        <call function="if" as="val" type="number">
          <call function="in">
            <const>2</const>
            <useparam name="condi_choise" />
          </call>
          <const>1</const>
        </call>
      </select>
      <from>
        <query name="dual" />
      </from>
    </query>
    <query name="hv_eobject_eq_tp" title="Список оборудования ТП" timestamp="26.03.2021 13:57:51">
      <params>
        <param name="eobj_id_eo_tp" type="array" />
        <param name="place_bal_id" type="array" />
      </params>
      <select>
        <column table="a" column="eobj_id" type="number" title="" key="1" />
        <column table="a" column="eobj_name" type="string" title="Оборудование" />
        <column table="a" column="seobj_name" type="string" title="Энергообъект" />
        <column table="a" column="baltername" type="string" title="Балансовая принадлежность" />
        <column table="a" column="ealtername" type="string" title="Эксплуатационная ответственность" />
        <column table="a" column="kindname" type="string" title="" />
        <column table="a" column="seobj_id" type="number" title="" />
      </select>
      <from>
        <table name="hv_eobject_eq" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in nnull" optional="1">
            <column table="a" column="seobj_id" />
            <useparam name="eobj_id_eo_tp" />
          </call>
          <call function="in nnull" optional="1">
            <column table="a" column="bal_id" />
            <useparam name="place_bal_id" />
          </call>
        </call>
      </where>
    </query>
    <query name="hv_point_plombs_all" title="Все пломбы ПУ" timestamp="30.10.2017 15:55:42" inherit="hv_point_plombs">
      <select>
        <column table="this" column="plomba" is-fact="1" is-final-dimension="1" is-private-dimension="1" agg="list" />
        <column table="kod_emp" column="fio" is-fact="1" is-final-dimension="1" is-private-dimension="1" agg="list" />
      </select>
      <from />
      <links>
        <link name="kod_pu" dimension="1" is-final-dimension="1" is-private-dimension="1">
          <dimlink name="kod_dog" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kod_plombs" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kod_numobj_mn" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kodp" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="eobj_id" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kod_parent_eo" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kodd" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kod_seti" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kod_elter" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kod_srckind" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kod_eobject_senter_nut" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kod_pktippu" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kod_point" dimension="1" is-final-dimension="1" is-private-dimension="1" />
          <dimlink name="kod_prov" dimension="1" is-final-dimension="1" is-private-dimension="1" />
        </link>
      </links>
    </query>
    <query name="poisk_akt_verify(output)" is-report="1" timestamp="30.10.2017 16:14:06">
      <params>
        <param name="p_kod_point_pu" type="array" />
        <param name="p_kod_numobj" type="array" exclude="1" />
        <param name="p_kod_dog" type="array" exclude="1" />
      </params>
      <select>
        <call function="||-" as="id" key="1">
          <call function="rownum" />
          <column table="kod_point_pu" column="kod_point_pu" />
        </call>
        <column table="kod_point_pu" column="kod_point_pu" />
        <column table="kod_point" column="kod_point" />
        <column table="kod_point_pu" column="nom_pu" />
        <column table="kod_point" column="nomer" as="number_point" title="Номер точки" />
        <column table="kod_pktippu" column="name_pk" as="name_typepu" />
        <column table="kod_point" column="name" as="name_point" title="Наименование точки" />
        <column table="kod_seti" column="aname" as="name_fil_tu" title="Филиал" />
        <column table="kod_elter" column="altername" title="РЭС" as="name_res_tu" />
        <call function="||-" as="tp" title="ТП">
          <column table="kod_srckind" column="sname" as="kind_eobject" title="kind_eobject" />
          <column table="kod_parent_eo" column="fname" as="name_eobject" title="name_eobject" />
        </call>
        <column table="eobj_id" column="name" as="line" title="Линия" />
        <column table="kod_eobject_senter_nut" column="name_senter_nut" as="name_senter_nut" title="Энергообъект" />
        <column table="kod_eobject_senter_nut" column="name_fider_nut" as="name_fider_nut" title="Фидер" />
        <column table="kod_net" column="name" title="Признак присоединения к сетям" as="name_org_group" />
        <call function="||" as="number_dog" title="Номер договора">
          <column table="kod_dog" column="ndog" as="number_dog" />
          <const>', '</const>
          <column table="dog_active" column="abbr" />
        </call>
        <column table="kodp" column="name" as="name_payer" />
        <call function="||" as="number_numobj" title="Номер объекта договора">
          <column table="kod_numobj_mn" column="num_obj" />
          <const>', '</const>
          <column table="obj_active" column="abbr" />
        </call>
        <column table="kod_numobj_mn" column="name" as="name_numobj" />
        <column table="kodd" column="kf_adress_o" title="Адрес объекта" as="addr_numobj" />
        <fact column="hv_point_plombs_all_plomba" as="plomba" title="Пломбы" />
        <fact column="hv_point_plombs_all_fio" as="author_plomba" title="Сотрудник" />
        <column table="kod_prov" column="last_prov" as="date_last_check" title="Дата последней проверки" />
        <column table="kod_prov" column="next_prov" as="date_next_check" title="Дата следующей проверки" />
      </select>
      <from>
        <qube star-scheme="1">
          <link name="kod_point_pu" all-rows="1" />
          <link name="kod_point">
            <link name="kod_net" />
          </link>
          <link name="kod_pktippu" />
          <link name="kod_seti" />
          <link name="kod_elter" />
          <link name="eobj_id" />
          <link name="kod_parent_eo" />
          <link name="kod_srckind" />
          <link name="kod_eobject_senter_nut" />
          <link name="kod_numobj_mn">
            <link name="pr_active" as="obj_active" />
          </link>
          <link name="kodd" />
          <link name="kod_dog">
            <link name="pr_active" as="dog_active" />
          </link>
          <link name="kodp" />
          <link name="kod_prov" />
          <where>
            <call function="and">
              <call function="true" />
              <call function="in">
                <column table="kod_point_pu" column="kod_point_pu" />
                <useparam name="p_kod_point_pu" />
              </call>
              <call function="in" exclude="1">
                <column table="kod_numobj_mn" column="kod_numobj" />
                <useparam name="p_kod_numobj" />
              </call>
              <call function="in" exclude="1">
                <column table="kod_dog" column="kod_dog" />
                <useparam name="p_kod_dog" />
              </call>
            </call>
          </where>
        </qube>
      </from>
    </query>
    <query name="hv_elter_org_short_tu_prava" timestamp="30.11.2017 13:52:27" title="РЭСы, в зоне которых находятся ТУ с учётом прав">
      <params>
        <param type="array" name="fil_tu" />
      </params>
      <select>
        <column table="hv_elter_org_area15" column="kodp" />
        <column table="hv_elter_org_area15" column="altername" title="Наименование" />
        <column table="hv_elter_org_area15" column="sname" title="Краткое наименование" halign="left" />
        <column table="hv_elter_org_area15" column="kod_parent" />
      </select>
      <from>
        <query name="hv_elter_org_area15" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in nnull" optional="1">
            <column table="hv_elter_org_area15" column="kod_parent" />
            <useparam name="fil_tu" />
          </call>
        </call>
      </where>
    </query>
    <query name="poisk_akt_verify_output" timestamp="29.05.2018 17:38:55" is-report="1" title="Поиск ком. ПУ для формирования актов проверки (вывод)" visible="0">
      <params>
        <param name="p_kod_point_pu" type="array" />
        <param name="p_eobj_id" type="array" />
        <param name="p_kod_numobj" type="array" />
      </params>
      <select>
        <call function="||-" as="id" key="1">
          <call function="rownum" />
          <column table="kod_point_pu" column="kod_point_pu" />
        </call>
        <const type="number" as="choise">0</const>
        <column table="kod_point_pu" column="kod_point_pu" as="kod_point_pu" />
        <column table="kod_point_pu" column="kod_pu_u" as="kod_uniq" />
        <column table="kod_point" column="kod_point" title="Код точки" />
        <column table="kod_point_pu" column="nom_pu" />
        <column table="kod_pktippu" column="name_pk" as="name_typepu" />
        <column table="kod_point" column="nomer" as="number_point" title="Номер точки" />
        <column table="kod_point" column="name" as="name_point" title="Наименование точки" />
        <column table="kod_seti" column="aname" as="name_fil_tu" title="Филиал" />
        <column table="kod_elter" column="altername" title="РЭС" as="name_res_tu" />
        <call function="||-" as="tp" title="ТП">
          <column table="kod_srckind" column="sname" as="kind_eobject" title="kind_eobject" />
          <column table="kod_parent_eo" column="dnum" as="name_eobject" title="name_eobject" />
        </call>
        <column table="eobj_id" column="name" as="line" title="Линия" />
        <column table="kod_eobject_senter_nut" column="baltername_senter_nut" as="name_bal" title="Бал. принад. ЦП" />
        <column table="kod_eobject_senter_nut" column="name_senter_nut" as="name_senter_nut" title="Энергообъект" />
        <column table="kod_eobject_senter_nut" column="name_fider_nut" as="name_fider_nut" title="Фидер" />
        <column table="kod_net" column="name" title="Признак присоединения к сетям" as="name_org_group" />
        <call function="||" as="number_dog" title="Номер договора">
          <column table="kod_dog" column="ndog" as="number_dog" />
          <const>', '</const>
          <column table="dog_active" column="abbr" />
        </call>
        <column table="kod_dog" column="kod_dog" as="kod_dog" title="Код договора" />
        <column table="kodp" column="name" as="name_payer" />
        <call function="||" as="number_numobj" title="Номер объекта договора">
          <column table="kod_numobj_mn" column="num_obj" />
          <const>', '</const>
          <column table="obj_active" column="abbr" />
        </call>
        <column table="kod_numobj_mn" column="name" as="name_numobj" />
        <column table="kod_numobj_mn" column="kod_numobj" as="kod_numobj" title="Код объекта" />
        <column table="kodd" column="kf_adress_o" title="Адрес объекта" as="addr_numobj" />
        <column column="plomba" as="plomba" title="Пломбы" table="kod_plombs_mv" />
        <column column="fio" as="author_plomba" title="Сотрудник" table="kod_plombs_mv" />
        <column table="kod_prov" column="last_prov" as="date_last_check" title="Дата последней проверки" />
        <column table="kod_prov" column="next_prov" as="date_next_check" title="Дата следующей проверки" />
      </select>
      <from>
        <qube>
          <link name="kod_point_pu" all-rows="1" />
          <link name="kod_point">
            <link name="kod_net" />
          </link>
          <link name="kod_point_har" />
          <link name="kod_pktippu" />
          <link name="kod_seti" />
          <link name="kod_elter" />
          <link name="eobj_id" />
          <link name="kod_parent_eo" />
          <link name="kod_srckind" />
          <link name="kod_eobject_senter_nut" />
          <link name="kod_numobj_mn">
            <link name="pr_active" as="obj_active" />
          </link>
          <link name="kodd">
            <link name="kod_s" />
          </link>
          <link name="kod_dog">
            <link name="pr_active" as="dog_active" />
          </link>
          <link name="kodp" />
          <link name="kod_prov" />
          <link name="kod_plombs_mv" />
          <where>
            <call function="and" comment="Условия по прибору учёта: номер и активность">
              <call function="true" />
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_point_pu" column="kod_point_pu" />
                <useparam name="p_kod_point_pu">1400005116</useparam>
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="eobj_id" column="eobj_id" />
                <useparam name="p_eobj_id">1400005116</useparam>
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_numobj_mn" column="kod_numobj" />
                <useparam name="p_kod_numobj">1400005116</useparam>
              </call>
            </call>
          </where>
        </qube>
      </from>
    </query>
    <query name="poisk_akt_verify_all" title="Поиск ком. ПУ для формирования актов проверки" is-report="1" timestamp="24.04.2018 01:45:06">
      <customers>
        <customer id="102" />
      </customers>
      <content>
        <usefield title="Филиал ТСО точки учёта" field="asuse_kod_seti" name="fil_tu" editable="pr_tree" editable-invert="1" />
        <usefield field="asuse_kod_elter_org_tu_prava" name="res_tu" title="РЭС ТСО точки учёта" />
        <fieldgroup title="Потребитель">
          <usefield title="Наименование потребителя" name="kodp" field="asuse_kodp_kod_res" />
          <usefield field="asuse_prizn_activ_dog" title="Статус договора" name="kod_activ_dog" />
          <usefield field="asuse_kod_dog_kodp_res" title="№ Договора" name="kod_dog" />
          <usefield field="asuse_prizn_activ_dog" title="Статус объекта" name="kod_activ_obj" />
          <usefield title="Наименование объекта" field="asuse_kod_numobj_kod_res" name="kod_numobj" />
          <usefield field="asuse_kod_point_kod_res" name="kod_point" title="Наименование точки" />
        </fieldgroup>
        <fieldgroup title="Схема сети">
          <usefield field="asuse_kod_balter_org" column-visible="1" title="Бал. принад. ЦП" name="bal_id_eo" editable="pr_tree" editable-invert="1" />
          <usefield field="asuse_kod_eosrc(kodp_res)" name="eobj_id_eo" column-visible="1" title="Центр питания" editable="pr_tree" editable-invert="1" />
          <usefield field="asuse_kod_eobject_eq" name="eobj_id" column-visible="1" editable="pr_tree" title="Оборудование" clear-on-list-change="1" editable-invert="1" />
          <usefield field="asuse_kod_eosrc_tp(kodp_res)" column-visible="1" editable="1" title="ТП ( КТП)" name="eobj_id_eo_tp" />
          <usefield field="asuse_kod_eobject_eq" name="eobj_id_tp" column-visible="1" editable="eobj_id_eo_tp" title="Линия НН" clear-on-list-change="1">
            <listquery>
              <query name="hv_eobject_eq_tp">
                <withparams exclude="1">
                  <useparam name="kod_adr_m" />
                </withparams>
              </query>
            </listquery>
          </usefield>
          <usefield field="asuse_kod_org_group_elmarket" show-nulls="1" name="kod_org_elmarket" title="Признак подключения к сети" />
        </fieldgroup>
        <fieldgroup title="Адреc">
          <usefield field="asuse_adr_m" name="kod_adr_m" />
          <usefield field="asuse_k_house_chet" name="kod_chet_obj" exclude="1" />
          <usefield field="asuse_k_strits" name="kod_street_obj" editable="kod_adr_m" clear-on-list-change="1">
            <listquery exclude="1">
              <query name="k_strits-list">
                <withparams>
                  <useparam name="kod_adr_m" />
                </withparams>
              </query>
            </listquery>
          </usefield>
          <usefield field="asuse_k_house" name="kod_d_obj" exclude="1">
            <listquery>
              <query name="k_house-list">
                <withparams>
                  <useparam name="kod_adr_m_obj" />
                  <useparam name="kod_street_obj" />
                  <useparam name="kod_chet_obj" />
                </withparams>
              </query>
            </listquery>
          </usefield>
          <usefield field="asuse_k_house-flats" name="kodd_flat_obj" exclude="1">
            <listquery>
              <query name="k_house-flats-list">
                <withparams>
                  <useparam name="kod_adr_m_obj" />
                  <useparam name="kod_street_obj" />
                  <useparam name="kod_chet_obj" />
                  <useparam name="kod_d_obj" />
                </withparams>
              </query>
            </listquery>
          </usefield>
        </fieldgroup>
        <fieldgroup title="Средство измерения">
          <usefield title="Номер счётчика" field="cmn_string" name="serial_num" />
          <usefield title="Номер пломбы, марки" field="cmn_string" name="plomba_num" />
          <fieldgroup title="Проверки">
            <usefield field="asuse_kod_condi_choise" name="condi_choise" title="Условие выбора" />
            <fieldgroup title="Дата проверки" expanded="0" exists="1" visible="1">
              <usefield field="cmn_date" name="date_s" title="C" color="tttttt37" width-perc="50" visible="pr_interval">
                <defaultquery>
                  <query name="null_values_for_param" />
                </defaultquery>
              </usefield>
              <usefield field="cmn_date" name="date_po" title="По" width-perc="50" visible="pr_interval">
                <defaultquery>
                  <query name="null_values_for_param" />
                </defaultquery>
              </usefield>
            </fieldgroup>
            <fieldgroup title="Дата следующей проверки" expanded="0">
              <usefield field="cmn_date" name="date_s_next" title="C" color="tttttt37" width-perc="50" visible="pr_interval">
                <defaultquery>
                  <query name="null_values_for_param" />
                </defaultquery>
              </usefield>
              <usefield field="cmn_date" name="date_po_next" title="По" width-perc="50" visible="pr_interval">
                <defaultquery>
                  <query name="null_values_for_param" />
                </defaultquery>
              </usefield>
            </fieldgroup>
          </fieldgroup>
        </fieldgroup>
        <usefield title="Учитывать выбор в навигаторе" field="cmn_check" name="pr_tree" column-default="1" checked="1" column-visible="0" editable="1" />
        <usefield title="Установлен энергообъект" field="cmn_check" name="pr_eobj_eo" column-visible="0" editable="1" new-val="eobj_id_eo" visible="1" />
        <usefield field="cmn_check" name="pr_tree_and_eobj_eo" column-default="1" checked="1" column-visible="0" editable="1" title="Не учитывать выбор в навигаторе и задан энергообъект" visible="1">
          <defaultquery exclude="1">
            <query name="both_param_not_null" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_check" column-default="1" checked="1" column-visible="0" editable="1" name="pr_interval" title="Выбран интервал">
          <defaultquery>
            <query name="poisk_condi_choise_check" />
          </defaultquery>
        </usefield>
      </content>
      <select>
        <call function="||-" as="id" key="1">
          <call function="rownum" />
          <column table="kod_point_pu" column="kod_point_pu" />
        </call>
        <const as="choise" type="number">0</const>
        <column table="kod_point_pu" column="kod_point_pu" as="kod_point_pu" />
        <column table="kod_point_pu" column="kod_pu_u" as="kod_uniq" />
        <column table="kod_point" column="kod_point" title="Код точки" />
        <column table="kod_point_pu" column="nom_pu" />
        <column table="kod_pktippu" column="name_pk" as="name_typepu" />
        <column table="kod_point" column="nomer" as="number_point" title="Номер точки" />
        <column table="kod_point" column="name" as="name_point" title="Наименование точки" />
        <column table="kod_seti" column="aname" as="name_fil_tu" title="Филиал" />
        <column table="kod_elter" column="altername" title="РЭС" as="name_res_tu" />
        <call function="||-" as="tp" title="ТП">
          <column table="kod_srckind" column="sname" as="kind_eobject" title="kind_eobject" />
          <column table="kod_parent_eo" column="fname" as="name_eobject" title="name_eobject" />
        </call>
        <column table="eobj_id" column="name" as="line" title="Линия" />
        <column table="kod_eobject_senter_nut" column="baltername_senter_nut" as="name_bal" title="Бал. принад. ЦП" />
        <column table="kod_eobject_senter_nut" column="name_senter_nut" as="name_senter_nut" title="Энергообъект" />
        <column table="kod_eobject_senter_nut" column="name_fider_nut" as="name_fider_nut" title="Фидер" />
        <column table="kod_net" column="name" title="Признак присоединения к сетям" as="name_org_group" />
        <call function="||" as="number_dog" title="Номер договора">
          <column table="kod_dog" column="ndog" as="number_dog" />
          <const>', '</const>
          <column table="dog_active" column="abbr" />
        </call>
        <column table="kod_dog" column="kod_dog" as="kod_dog" title="Код договора" />
        <column table="kodp" column="name" as="name_payer" />
        <call function="||" as="number_numobj" title="Номер объекта договора">
          <column table="kod_numobj_mn" column="num_obj" />
          <const>', '</const>
          <column table="obj_active" column="abbr" />
        </call>
        <column table="kod_numobj_mn" column="name" as="name_numobj" />
        <column table="kod_numobj_mn" column="kod_numobj" as="kod_numobj" title="Код объекта" />
        <column table="kodd" column="kf_adress_o" title="Адрес объекта" as="addr_numobj" />
        <column column="plomba" as="plomba" title="Пломбы" table="kod_plombs" exclude="1" />
        <column column="kod_sotr" as="author_plomba" title="Сотрудник" table="kod_plombs" exclude="1" />
        <fact column="hv_point_plombs_all_plomba" as="plomba" title="Пломбы" />
        <fact column="hv_point_plombs_all_fio" as="author_plomba" title="Сотрудник" />
        <column table="kod_prov" column="last_prov" as="date_last_check" title="Дата последней проверки" />
        <column table="kod_prov" column="next_prov" as="date_next_check" title="Дата следующей проверки" />
      </select>
      <from>
        <qube>
          <link name="kod_point_pu" all-rows="1" />
          <link name="kod_point">
            <link name="kod_net" />
          </link>
          <link name="kod_point_har" />
          <link name="kod_pktippu" />
          <link name="kod_seti" />
          <link name="kod_elter" />
          <link name="eobj_id" />
          <link name="kod_parent_eo" />
          <link name="kod_srckind" />
          <link name="kod_eobject_senter_nut" />
          <link name="kod_numobj_mn">
            <link name="pr_active" as="obj_active" />
          </link>
          <link name="kodd">
            <link name="kod_s" />
          </link>
          <link name="kod_dog">
            <link name="pr_active" as="dog_active" />
          </link>
          <link name="kodp" />
          <link name="kod_prov" />
          <link name="kod_plombs" />
          <where>
            <call function="and" comment="Условия по прибору учёта: номер и активность">
              <call function="true" />
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу" exclude="1">
                <column table="kod_point_pu" column="kod_point_pu" />
                <const name="kod_street_obj">1400005116</const>
              </call>
              <call function="is not null">
                <column table="kod_point_pu" column="kod_point_pu" />
              </call>
            </call>
            <call function="and" comment="Условия по прибору учёта: номер и активность">
              <call function="true" />
              <call function="like" optional="1">
                <column table="kod_point_pu" column="nom_pu" />
                <useparam name="serial_num" />
              </call>
              <call function="is null">
                <column table="kod_point_pu" column="dat_po" />
              </call>
              <call function="like" optional="1">
                <column table="kod_plombs" column="plomba" />
                <useparam name="plomba_num" />
              </call>
            </call>
            <call function="and" comment="Условия на филиал \ рэс ТУ">
              <call function="true" />
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_seti" column="kod" />
                <useparam name="fil_tu" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к рэс">
                <column table="kod_elter" column="kodp" />
                <useparam name="res_tu" />
              </call>
            </call>
            <call function="and" comment="Условия на схему">
              <call function="true" />
              <call function="is null">
                <column table="kod_point_har" column="dat_po" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_eobject_senter_nut" column="bal_id_senter_nut" />
                <useparam name="bal_id_eo" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="eobj_id" column="eobj_id" />
                <useparam name="eobj_id_tp" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_parent_eo" column="eobj_id" />
                <useparam name="eobj_id_eo_tp" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_eobject_senter_nut" column="id_senter_nut" />
                <useparam name="eobj_id_eo" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_eobject_senter_nut" column="id_fider_nut" />
                <useparam name="eobj_id" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_net" column="kod_org_group" />
                <useparam name="kod_org_elmarket" />
              </call>
            </call>
            <call function="and" comment="Условия по договорной части">
              <call function="true" />
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_dog" column="pr_active" />
                <useparam name="kod_activ_dog" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_numobj_mn" column="pr_active" />
                <useparam name="kod_activ_obj" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_dog" column="kod_dog" />
                <useparam name="kod_dog" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_numobj_mn" column="kod_numobj" />
                <useparam name="kod_numobj" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kodp" column="kodp" />
                <useparam name="kodp" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_point" column="kod_point" />
                <useparam name="kod_point" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kod_s" column="kod_m" />
                <useparam name="kod_adr_m" />
              </call>
              <call function="in nnull" optional="1" comment="Поиск по принадлежности к филиалу">
                <column table="kodd" column="kod_s" />
                <useparam name="kod_street_obj" />
              </call>
            </call>
            <call function="and" comment="Условия по прибору учёта: номер и активность">
              <call function="true" />
              <call function="or" optional="1">
                <call function="=">
                  <useparam name="condi_choise" />
                  <const>2</const>
                </call>
                <call function="is null">
                  <column table="kod_prov" column="last_prov" />
                </call>
              </call>
              <call function="ge" optional="1">
                <column table="kod_prov" column="last_prov" />
                <useparam name="date_s" />
              </call>
              <call function="ge" optional="1">
                <column table="kod_prov" column="next_prov" />
                <useparam name="date_s_next" />
              </call>
              <call function="le" optional="1">
                <column table="kod_prov" column="next_prov" />
                <useparam name="date_po_next" />
              </call>
              <call function="le" optional="1">
                <column table="kod_prov" column="last_prov" />
                <useparam name="date_po" />
              </call>
            </call>
          </where>
        </qube>
      </from>
    </query>
  </queries>
  <views>
    <view name="kv_dogovor_res">
      select distinct
      d.kod_dog as kod_dog,
      d.ndog as ndog,
      k.abbr as abbr,
      dep.name as dep_name,
      pa.nump as nump,
      pa.name as payer_name
      from   kr_dogovor d
      inner join
      kr_numobj n on d.kod_dog = n.kod_dog
      inner join
      hr_point p on p.kod_obj = n.kod_obj
      inner join
      kk_active k on k.pr_active = d.pr_active
      inner join
      kr_payer pa on pa.kodp = d.kodp
      inner join
      kr_org dep on dep.kodp = d.dep
      where (1=1) {and p.kodp_rsk in :res_tu } {and p.kodp_fsk in :fil_tu }
      {and pa.kodp in :kodp } 
      and n.kod_parent_sa is null {and d.pr_active in :kod_activ_dog }
    </view>
    <view name="kv_payer_res">
      select distinct
      pa.kodp as kodp,
      pa.nump as nump,
      pa.name as payer_name,
      pa.inn as inn
      from   kr_payer pa
      inner join
      kr_dogovor d on d.kodp = pa.kodp
      inner join
      kr_numobj n on d.kod_dog = n.kod_dog
      inner join
      hr_point p on p.kod_obj = n.kod_obj
      where (1=1) {and p.kodp_rsk in :res_tu } {and p.kodp_fsk in :fil_tu }
      and n.kod_parent_sa is null
    </view>
    <view name="kv_numobj_res">
      select  n.kod_numobj,
      max(n.num_obj) as num_obj,
      max(d.ndog) as ndog , 
      max(k.abbr) as abbr,
      max(n.name) as name
      from   kr_dogovor d
      inner join
      kr_numobj n on d.kod_dog = n.kod_dog
      inner join
      hr_point p on p.kod_obj = n.kod_obj
      inner join
      kk_active k on k.pr_active = n.pr_active
      where (1=1) {and p.kodp_rsk in :res_tu } {and p.kodp_fsk in :fil_tu }
      {and d.kod_dog in :kod_dog } {and n.pr_active in :kod_activ_obj }
      {and d.kod_dog in :kod_dog }
      and n.kod_parent_sa is null
      group by n.kod_numobj, d.kod_dog
    </view>
    <view name="hv_point_res">
      select  p.kod_point,
      max(p.nomer ) as nomer,
      max(p.mesto) as mesto,
      max(p.name) as name,
      max(p.abbr) as abbr,
      listagg(p.ndog, ' ;' ) within group (order by p.ndog) as ndog,
      listagg(p.num_obj, ' ;' ) within group (order by p.ndog) as num_obj
      from
      (
      select
      distinct
      p.kod_point,
      p.nomer,
      p.mesto,
      p.name,
      k.abbr,
      d.ndog,
      n.num_obj
      from hr_point p
      inner join
      kk_active k on k.pr_active = p.pr_active
      inner join
      kr_numobj n on n.kod_obj = p.kod_obj
      inner join
      kr_dogovor d on d.kod_dog = n.kod_dog
      where (1=1) {and p.kodp_rsk in :res_tu } {and p.kodp_fsk in :fil_tu }
      {and d.kod_dog in :kod_dog }
      {and n.kod_numobj in :kod_numobj }
      ) p
      group by p.kod_point
    </view>
    <view name="hv_eosrc_res">
      select s.eobj_id as seobj_id,
      max(s.dnum) as seobj_name,
      max(sk.sname) as kindname,
      max(s.kod_srckind) as kod_srckind,
      max(eo.bal_id) as bal_id,
      max(eo.expl_id) as expl_id,
      max(b.name) as balter_name,
      max(e.name) as elter_name,
      max(st.sname) as seti
      from hr_eosrc s
      inner join
      hr_eobject eo on eo.eobj_id= s.eobj_id
      inner join
      hk_srckind sk on sk.kod_srckind = s.kod_srckind
      inner join
      kr_org b on b.kodp = eo.bal_id
      inner join
      kr_org e on e.kodp = eo.expl_id
      left join
      hr_eosrc_elnet el on el.eobj_id = s.eobj_id
      left join
      hv_seti  st on st.kod = el.kodp
      left join
      hv_eobject_senter_nut sent on sent.id_senter_nut = s.eobj_id
      left join
      ( select eobj_id, kod_point from hr_point_har h where h.dat_po is null and h.pr_active !=1) h on h.eobj_id  = sent.eobj_id
      left join
      hr_point p on p.kod_point = h.kod_point
      where eo.deleted =0
      and (sk.kod_srckind = 3 or sk.kod_srckind = 6 {or 1= :pr_tree } )
      and ( (1=1) {and p.kodp_rsk in :res_tu } {or 1= :pr_tree } )
      {and st.kod in :fil_tu }
      {and eo.bal_id in :bal_id_eo }
      and ( (1=1) {and p.kodp_fsk in :fil_tu } {or 1= :pr_tree } )
      group by s.eobj_id
    </view>
    <view name="hv_eosrc_tp_res">

      select s.eobj_id as seobj_id,
      max(s.dnum) as seobj_name,
      max(sk.sname) as kindname,
      max(s.kod_srckind) as kod_srckind,
      max(eo.bal_id) as bal_id,
      max(eo.expl_id) as expl_id,
      max(b.name) as balter_name,
      max(e.name) as elter_name,
      max(st.sname) as seti
      from hr_eosrc s
      inner join
      hr_eobject eo on eo.eobj_id= s.eobj_id
      inner join
      hk_srckind sk on sk.kod_srckind = s.kod_srckind
      inner join
      kr_org b on b.kodp = eo.bal_id
      inner join
      kr_org e on e.kodp = eo.expl_id
      left join
      hr_eosrc_elnet el on el.eobj_id = s.eobj_id
      left join
      hv_seti  st on st.kod = el.kodp
      left join
      hr_eobject eq on eq.parent_id = eo.eobj_id
      left join
      hv_eobject_senter_nut sn on sn.eobj_id = eq.eobj_id
      left join
      ( select eobj_id, kod_point from hr_point_har h where h.dat_po is null and h.pr_active !=1) h on h.eobj_id  = eq.eobj_id
      left join
      hr_point p on p.kod_point = h.kod_point
      where eo.deleted =0 and sk.kod_srckind != 3 and  sk.kod_srckind != 6
      {and p.kodp_rsk in :res_tu } {and st.kod in :fil_tu } {and eo.bal_id in :bal_id_eo }
      {and p.kodp_fsk in :fil_tu } {and sn.id_senter_nut in :eobj_id_eo }
      {and sn.id_fider_nut in :eobj_id }
      group by s.eobj_id
    </view>
    <view name="hv_condi_choise">
       select 1 as kod, 'Пустые значения (не проверено)' as name
       from dual
       union all 
       select 2 as kod, 'Интервал проверки' as name
        from dual
      </view>
  </views>
</root>