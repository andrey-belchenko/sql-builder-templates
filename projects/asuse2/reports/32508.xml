<?xml version="1.0" encoding="utf-8"?>
<root>
  <parts>
    <part id="32508-params" timestamp="20.05.2016 16:25:17">
      <param name="ym">
        <const>2015.05</const>
      </param>
      <param name="dep" />
      <param name="year" />
      <param name="vid_real" />
      <param name="kod_group_cust_parent" />
      <param name="kod_group_cust" />
    </part>
    <part id="32508-withparams" timestamp="20.05.2016 16:25:13">
      <withparams>
        <useparam name="ym" />
        <useparam name="dep" />
        <useparam name="year" />
        <useparam name="vid_real" />
        <useparam name="kod_group_cust_parent" />
        <useparam name="kod_group_cust" />
      </withparams>
    </part>
    <part id="54148-params" timestamp="07.11.2019 13:40:09">
      <param name="ym">
        <const>2015.05</const>
      </param>
      <param name="dep" />
      <param name="year" />
      <param name="vid_real" exclude="1" />
      <param name="kod_group_cust_parent" exclude="1" />
      <param name="kod_group_cust" exclude="1" />
    </part>
    <part id="54148-withparams" timestamp="07.11.2019 13:40:58">
      <withparams>
        <useparam name="ym" />
        <useparam name="dep" />
        <useparam name="year" />
        <useparam name="vid_real" exclude="1" />
        <useparam name="kod_group_cust_parent" exclude="1" />
        <useparam name="kod_group_cust" exclude="1" />
      </withparams>
    </part>
  </parts>
  <forms>
    <form name="32508" timestamp="21.11.2016 14:27:10" with-behavior="0">
      <customers>
        <customer id="101" />
      </customers>
      <content>
        <usefield field="asuse_ym" />
        <usefield field="asuse_dep" />
        <usefield field="asuse_year" title="Детализация по годам начиная с">
          <defaultquery>
            <query name="32508-defaul-year" />
          </defaultquery>
        </usefield>
        <usefield field="asuse_vid_real" />
        <usefield field="asuse_kod_group_cust_parent" />
        <usefield field="asuse_kod_group_cust" />
      </content>
    </form>
    <form name="54148" timestamp="11.11.2019 16:23:24" with-behavior="0" title="Отчет по Авансовым платежам" is-report="1">
      <content>
        <usefield field="asuse_ym" />
        <usefield field="asuse_dep_single" show-checkbox="0" />
        <usefield field="asuse_year" title="Детализация по годам начиная с">
          <defaultquery>
            <query name="54148-defaul-year" />
          </defaultquery>
        </usefield>
        <usefield field="asuse_vid_real" exclude="1" />
        <usefield field="asuse_kod_group_cust_parent" exclude="1" />
        <usefield field="asuse_kod_group_cust" exclude="1" />
      </content>
    </form>
  </forms>
  <reports>
    <report name="32508" title="Отчет по Авансовым платежам" form="32508" allow-save="1" nogrid="1" folder="rep_avans">
      <params>
        <usepart part="32508-params" />
      </params>
      <customers>
        <customer id="101" />
      </customers>
      <print-templates>
        <excel>
          <template name="32508.xml" title="Отчет по Авансовым платежам" print-proc="2" headmarker="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="32508" as="a">
          <usepart part="32508-withparams" />
        </query>
      </queries>
    </report>
    <report name="54148" title="Отчет по Авансовым платежам" form="54148" folder="rep_avans" timestamp="11.11.2019 16:35:00" allow-save="1" params-customization="1" nogrid="1">
      <params>
        <usepart part="54148-params" />
      </params>
      <customers exclude="1">
        <customer id="10" />
      </customers>
      <print-templates>
        <excel>
          <template name="54148.xml" title="Отчет по Авансовым платежам" print-proc="2" headmarker="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="54148" as="a">
          <usepart part="54148-withparams" />
        </query>
      </queries>
    </report>
    <report name="32508-old" title="Отчет по Авансовым платежам" form="32508" allow-save="1" nogrid="1" folder="rep_avans" timestamp="14.05.2023 17:58:48">
      <params>
        <usepart part="32508-params" />
      </params>
      <customers>
        <customer id="101" />
      </customers>
      <print-templates>
        <excel>
          <template name="32508.xml" title="Отчет по Авансовым платежам" print-proc="2" headmarker="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="32508-old" as="a">
          <usepart part="32508-withparams" />
        </query>
      </queries>
    </report>
  </reports>
  <queries>
    <query name="32508-defaul-year">
      <select>
        <call function="-" as="year">
          <column table="a" column="year" />
          <const>3</const>
        </call>
      </select>
      <from>
        <query name="kr_calc_year_max" as="a" />
      </from>
    </query>
    <query name="32508" title="Отчет по Авансовым платежам" timestamp="20.04.2025 21:58:17">
      <params>
        <usepart part="32508-params" />
      </params>
      <select>
        <call function="mes-name" as="month" group="max">
          <call function="mes">
            <useparam name="ym" />
          </call>
        </call>
        <call function="year" as="year" group="max">
          <call function="ym begin time">
            <useparam name="ym" />
          </call>
        </call>
        <column table="a" column="kod_dog" group="1" />
        <column table="a" column="ndog" group="max" />
        <column table="a" column="name" group="max" />
        <column table="a" column="name_group_cust_parent" group="max" />
        <column table="a" column="name_group_cust" group="max" />
        <column table="a" column="kredit_beg" group="sum" />
        <column table="a" column="kredit_beg" as="kredit_beg_by_year" group="sum" dimname="year" nvl="0">
          <pivot title=" по годам">
            <call function="year" as="year" group="">
              <column table="a" column="dat_opl" />
            </call>
            <query order="year">
              <select>
                <column table="year_list" column="year" />
                <column table="year_list" column="name" />
              </select>
              <from>
                <query name="kr_calc_year_list" as="year_list" />
              </from>
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="between" optional="1">
                    <column table="year_list" column="year" />
                    <useparam name="year" />
                    <call function="year">
                      <call function="ym begin time">
                        <useparam name="ym" />
                      </call>
                    </call>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="opl_nach_avans_per" group="sum" title="Всего" class-title="Авансовые платежи, участвующие в погашении начисления за отчетный месяц" nvl="0" />
        <column table="a" column="opl_nach_avans_last" group="sum" dimname="year" nvl="0" />
        <column table="a" column="opl_nach_avans_tek" group="sum" nvl="0" />
        <column table="a" column="opl_spisanie_avans" group="sum" dimname="year_root" nvl="0">
          <pivot title=" по годам">
            <call function="year" as="year" group="">
              <column table="a" column="dat_opl_root" comment="SD 75918  Распределение списания выполняется по дате первоначальной оплаты в цепочке ФК " />
            </call>
            <query order="year">
              <select>
                <column table="year_list" column="year" />
                <column table="year_list" column="name" />
              </select>
              <from>
                <query name="kr_calc_year_list" as="year_list" />
              </from>
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="between" optional="1">
                    <column table="year_list" column="year" />
                    <useparam name="year" />
                    <call function="year">
                      <call function="ym begin time">
                        <useparam name="ym" />
                      </call>
                    </call>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="opl_vozvrat_avans" group="sum" dimname="year" nvl="0" />
        <column table="a" column="opl_perenos_avans" group="sum" dimname="year" nvl="0" />
        <column table="a" column="opl_avans_per" group="sum" as="opl_avans_all" exclude="1" />
        <call function="+nvl" as="opl_avans_all" title="Сумма авансовых платежей (оплата) за месяц - ВСЕГО">
          <column table="a" column="opl_per_av_no_fk" group="sum" />
          <column table="a" column="opl_avans_fk" group="sum" />
        </call>
        <column table="a" column="opl_per_av_no_fk" as="opl_avans" group="sum" nvl="0" />
        <column table="a" column="opl_avans_fk" group="sum" as="opl_avans_fk" />
        <column table="a" column="kredit_end" group="sum" nvl="0" />
        <column table="a" column="kredit_end" as="kredit_end_by_year" group="sum" dimname="year" nvl="0" />
      </select>
      <from>
        <query name="32508-data" as="a">
          <usepart part="32508-withparams" />
        </query>
      </from>
      <having>
        <call function="and">
          <call function="not 0">
            <column table="this" column="kredit_beg" />
            <column table="this" column="kredit_end" />
            <column table="this" column="opl_nach_avans_per" />
            <column table="a" column="opl_spisanie_avans" group="sum" />
            <column table="a" column="opl_vozvrat_avans" group="sum" />
            <column table="a" column="opl_perenos_avans" group="sum" />
          </call>
        </call>
      </having>
    </query>
    <query name="32508-data" title="Отчет по Авансовым платежам" timestamp="20.04.2025 21:58:38">
      <params>
        <usepart part="32508-params" />
      </params>
      <select>
        <column table="fingen_united" column="kod_dog" group="1" />
        <column table="fingen_united" column="ym" group="1" />
        <call function="nvl" as="dat_opl" group="1" exclude="1">
          <column table="kod_opl_master" column="dat_opl" />
          <column table="fingen_united" column="dat_vozn" />
        </call>
        <column table="fingen_united" column="dat_vozn2" group="1" as="dat_opl" />
        <column table="kod_opl_recalc_root" column="dat_opl" group="1" as="dat_opl_root" comment="SD 75918  Распределение списания выполняется по дате первоначальной оплаты в цепочке ФК " />
        <!--<column table="kod_opl_master" column="dat_opl" group="1" />-->
        <column table="kod_dog" column="ndog" group="max" />
        <column table="kodp" column="name" group="max" />
        <column table="kod_group_cust_parent" column="name" as="name_group_cust_parent" group="max" />
        <column table="kod_group_cust" column="name" as="name_group_cust" group="max" />
        <call function="-" as="kredit_beg" title="Кредиторская задолженность на начало месяца" group="sum">
          <const>0</const>
          <column table="fingen_united" column="ob_kred_it_kor" group="" if="do">
            <section>
              <call function="ym add month">
                <useparam name="ym" />
                <const>-1</const>
              </call>
            </section>
          </column>
        </call>
        <call function="+nvl" as="opl_nach_avans" group="sum">
          <column table="fingen_united" column="opl_pfact_per" group="" />
          <column table="fingen_united" column="opl_pfact_avans" group="" />
        </call>
        <column table="this" column="opl_nach_avans" as="opl_nach_avans_per" class-title="Авансовые платежи, участвующие в погашении начисления за отчетный месяц">
          <if>
            <call function="=">
              <column table="fingen_united" column="ym" />
              <useparam name="ym" />
            </call>
          </if>
        </column>
        <column table="this" column="opl_nach_avans" as="opl_nach_avans_last" title="Авансовые платежи прошлых периодов, участвующие в погашении начисления за отчетный месяц">
          <if>
            <call function="and">
              <call function="lt">
                <call function="date to ym">
                  <!--<column table="kod_opl_master" column="dat_opl" />-->
                  <column table="this" column="dat_opl" />
                </call>
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="opl_nach_avans" as="opl_nach_avans_tek" title="Авансовые платежи текущего периода, участвующие в погашении начисления за отчетный месяц">
          <if>
            <call function="and">
              <call function="=">
                <call function="date to ym">
                  <!--<column table="kod_opl_master" column="dat_opl" />-->
                  <column table="this" column="dat_opl" />
                </call>
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_spisanie_avans" group="sum" if="per" title="Списание кред. зад-сти на прибыль (сч. 91/9)">
          <if>
            <call function="=">
              <column table="fingen_united" column="ym" />
              <useparam name="ym" />
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_vozvrat_avans" group="sum" if="per" title="Возвраты на расчетный счет" />
        <column table="fingen_united" column="opl_perenos_avans" group="sum" if="per" title="Переброски авансов" />
        <column table="fingen_united" column="opl_avans_per" group="sum" if="ym_main" title="Сумма авансовых платежей (оплата) за месяц - ВСЕГО">
          <if>
            <call function="=">
              <column table="fingen_united" column="ym_opl_main" />
              <useparam name="ym" />
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_per_av_no_fk" group="sum" title="Сумма авансовых платежей без ФК" if="ym_main" />
        <column table="fingen_united" column="opl_per_av_fk" group="sum" if="ym_main" title="Переброски авансов" as="opl_avans_fk" />
        <call function="-" as="kredit_end" title="Кредиторская задолженность на конец месяца" group="sum">
          <const>0</const>
          <column table="fingen_united" column="ob_kred_it_kor" group="" if="end">
            <section>
              <call function="ym add month">
                <useparam name="ym" />
                <const>0</const>
              </call>
            </section>
          </column>
        </call>
      </select>
      <from>
        <query name="fingen_united">
          <link name="kod_opl">
            <link name="kod_sf" as="kod_sf_opl" />
            <link name="kod_opl_recalc_root" />
          </link>
          <link name="kod_sf" />
          <link name="kod_opl_master" />
          <link name="kod_dog">
            <link name="kodp" />
            <link name="kod_dog_dop">
              <link name="kod_group_cust">
                <link name="kod_group_cust_parent" />
              </link>
            </link>
          </link>
          <extendwhere>
            <call function="and">
              <call function="true" />
              <call function="le" optional="1">
                <column table="*" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="in" optional="1">
                <column table="*" column="vid_real" />
                <useparam name="vid_real" />
              </call>
            </call>
          </extendwhere>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in" optional="1">
            <column table="fingen_united" column="dep" />
            <useparam name="dep" />
          </call>
          <call function="in" optional="1">
            <column table="kod_group_cust_parent" column="kod_group_cust" />
            <useparam name="kod_group_cust_parent" />
          </call>
          <call function="in" optional="1">
            <column table="kod_group_cust" column="kod_group_cust" />
            <useparam name="kod_group_cust" />
          </call>
          <call function="=">
            <column table="kod_dog" column="pr_active" />
            <const>0</const>
          </call>
          <!--<call function="in">
            <column table="kod_dog" column="kod_dog" />
            <array>20010728,20009422,120014561,20011395</array>
          </call>-->
        </call>
      </where>
    </query>
    <query name="54148" title="Отчет по Авансовым платежам" timestamp="16.03.2025 14:23:08">
      <params>
        <usepart part="54148-params" />
      </params>
      <select>
        <call function="mes-name" as="month" group="max">
          <call function="mes">
            <useparam name="ym" />
          </call>
        </call>
        <call function="year" as="year" group="max">
          <call function="ym begin time">
            <useparam name="ym" />
          </call>
        </call>
        <column table="a" column="kod_dog" group="1" />
        <column table="a" column="ndog" group="max" />
        <column table="a" column="dep_name" group="max" />
        <column table="a" column="name" group="max" />
        <column table="a" column="name_group_cust_parent" group="max" />
        <column table="a" column="name_group_cust" group="max" />
        <column table="a" column="kredit_beg" group="sum" />
        <column table="a" column="kredit_beg" as="kredit_beg_by_year" group="sum" dimname="year" nvl="0">
          <pivot title=" по годам">
            <call function="year" as="year" group="">
              <column table="a" column="dat_opl" />
            </call>
            <query order="year">
              <select>
                <column table="year_list" column="year" />
                <column table="year_list" column="name" />
              </select>
              <from>
                <query name="kr_calc_year_list" as="year_list" />
              </from>
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="between" optional="1">
                    <column table="year_list" column="year" />
                    <useparam name="year" />
                    <call function="year">
                      <call function="ym begin time">
                        <useparam name="ym" />
                      </call>
                    </call>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="opl_nach_avans_per" group="sum" title="Всего" class-title="Авансовые платежи, участвующие в погашении начисления за отчетный месяц" nvl="0" />
        <column table="a" column="opl_nach_avans_last" group="sum" dimname="year" nvl="0" />
        <column table="a" column="opl_nach_avans_tek" group="sum" nvl="0" />
        <column table="a" column="opl_spisanie_avans" group="sum" dimname="year" nvl="0" />
        <column table="a" column="opl_vozvrat_avans" group="sum" dimname="year" nvl="0" />
        <column table="a" column="opl_perenos_avans" group="sum" dimname="year" nvl="0" />
        <column table="a" column="opl_perenos_99" group="sum" dimname="year" nvl="0" as="opl_perenos_99" />
        <column table="a" column="opl_perenos_100" group="sum" dimname="year" nvl="0" as="opl_perenos_100" />
        <column table="a" column="opl_perenos_101" group="sum" dimname="year" nvl="0" as="opl_perenos_101" />
        <column table="a" column="opl_perenos_102" group="sum" dimname="year" nvl="0" as="opl_perenos_102" />
        <column table="a" column="opl_perenos_89" group="sum" dimname="year" nvl="0" as="opl_perenos_89" />
        <column table="a" column="opl_perenos_103" group="sum" dimname="year" nvl="0" as="opl_perenos_103" />
        <column table="a" column="opl_perenos_104" group="sum" dimname="year" nvl="0" as="opl_perenos_104" />
        <column table="a" column="opl_perenos_105" group="sum" dimname="year" nvl="0" as="opl_perenos_105" />
        <column table="a" column="opl_perenos_106" group="sum" dimname="year" nvl="0" as="opl_perenos_106" />
        <column table="a" column="opl_perenos_107" group="sum" dimname="year" nvl="0" as="opl_perenos_107" />
        <column table="a" column="opl_avans_per" group="sum" as="opl_avans_all" exclude="1" />
        <call function="+nvl" as="opl_avans_all" title="Сумма авансовых платежей (оплата) за месяц - ВСЕГО">
          <column table="a" column="opl_per_av_no_fk" group="sum" />
          <column table="a" column="opl_avans_fk" group="sum" />
        </call>
        <column table="a" column="opl_per_av_no_fk" as="opl_avans" group="sum" nvl="0" />
        <column table="a" column="opl_avans_fk" group="sum" as="opl_avans_fk" />
        <column table="a" column="kredit_end" group="sum" nvl="0" />
        <column table="a" column="kredit_end" as="kredit_end_by_year" group="sum" dimname="year" nvl="0" />
      </select>
      <from>
        <query name="54148-data" as="a">
          <usepart part="54148-withparams" />
        </query>
      </from>
      <having>
        <call function="and">
          <call function="not 0">
            <column table="this" column="kredit_beg" />
            <column table="this" column="kredit_end" />
            <column table="this" column="opl_nach_avans_per" />
            <column table="a" column="opl_spisanie_avans" group="sum" />
            <column table="a" column="opl_vozvrat_avans" group="sum" />
            <column table="a" column="opl_perenos_avans" group="sum" />
          </call>
        </call>
      </having>
    </query>
    <query name="54148-data" title="Отчет по Авансовым платежам" timestamp="16.03.2025 14:47:15">
      <params>
        <usepart part="54148-params" />
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" group="1" />
        <column table="fingen_united" column="ym" group="1" />
        <column table="fingen_united" column="dep_name" group="1" />
        <call function="nvl" as="dat_opl" group="1" exclude="1">
          <column table="kod_opl_master" column="dat_opl" />
          <column table="fingen_united" column="dat_vozn" />
        </call>
        <column table="fingen_united" column="dat_vozn2" group="1" as="dat_opl" />
        <!--<column table="kod_opl_master" column="dat_opl" group="1" />-->
        <column table="kod_dog" column="ndog" group="max" />
        <column table="kodp" column="name" group="max" />
        <column table="kod_group_cust_parent" column="name" as="name_group_cust_parent" group="max" />
        <column table="kod_group_cust" column="name" as="name_group_cust" group="max" />
        <call function="-" as="kredit_beg" title="Кредиторская задолженность на начало месяца" group="sum" exclude="1">
          <const>0</const>
          <column table="fingen_united" column="ob_kred_it_kor" group="" if="do">
            <section>
              <call function="ym add month">
                <useparam name="ym" />
                <const>-1</const>
              </call>
            </section>
          </column>
        </call>
        <column table="fingen_united" column="ob_kred_it_kor" group="sum" if="do" as="kredit_beg" title="Кредиторская задолженность на начало месяца">
          <section>
            <call function="ym add month">
              <useparam name="ym" />
              <const>-1</const>
            </call>
          </section>
        </column>
        <call function="+nvl" as="opl_nach_avans" group="sum">
          <column table="fingen_united" column="opl_pfact_per" group="" />
          <column table="fingen_united" column="opl_pfact_avans" group="" />
        </call>
        <column table="this" column="opl_nach_avans" as="opl_nach_avans_per" class-title="Авансовые платежи, участвующие в погашении начисления за отчетный месяц">
          <if>
            <call function="=">
              <column table="fingen_united" column="ym" />
              <useparam name="ym" />
            </call>
          </if>
        </column>
        <column table="this" column="opl_nach_avans" as="opl_nach_avans_last" title="Авансовые платежи прошлых периодов, участвующие в погашении начисления за отчетный месяц">
          <if>
            <call function="and">
              <call function="lt">
                <call function="date to ym">
                  <!--<column table="kod_opl_master" column="dat_opl" />-->
                  <column table="this" column="dat_opl" />
                </call>
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="opl_nach_avans" as="opl_nach_avans_tek" title="Авансовые платежи текущего периода, участвующие в погашении начисления за отчетный месяц">
          <if>
            <call function="and">
              <call function="=">
                <call function="date to ym">
                  <!--<column table="kod_opl_master" column="dat_opl" />-->
                  <column table="this" column="dat_opl" />
                </call>
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_spisanie_avans" group="sum" if="per" title="Списание кред. зад-сти на прибыль (сч. 91/9)">
          <if>
            <call function="=">
              <column table="fingen_united" column="ym" />
              <useparam name="ym" />
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_vozvrat_avans" group="sum" if="per" title="Возвраты на расчетный счет" />
        <column table="fingen_united" column="opl_perenos_avans_fk" group="sum" if="per" title="Переброски авансов" as="opl_perenos_avans" />
        <column table="fingen_united" column="opl_perenos_avans_fk" group="sum" title="Переброски авансов" as="opl_perenos_99">
          <if>
            <call function="and">
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="kod_dest" column="kod_dest" />
                <const>99</const>
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_perenos_avans_fk" group="sum" title="Переброски авансов" as="opl_perenos_100">
          <if>
            <call function="and">
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="kod_dest" column="kod_dest" />
                <const>100</const>
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_perenos_avans_fk" group="sum" title="Переброски авансов" as="opl_perenos_101">
          <if>
            <call function="and">
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="kod_dest" column="kod_dest" />
                <const>101</const>
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_perenos_avans_fk" group="sum" title="Переброски авансов" as="opl_perenos_102">
          <if>
            <call function="and">
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="kod_dest" column="kod_dest" />
                <const>102</const>
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_perenos_avans_fk" group="sum" title="Переброски авансов" as="opl_perenos_89">
          <if>
            <call function="and">
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="kod_dest" column="kod_dest" />
                <const>89</const>
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_perenos_avans_fk" group="sum" title="Переброски авансов" as="opl_perenos_103">
          <if>
            <call function="and">
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="kod_dest" column="kod_dest" />
                <const>103</const>
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_perenos_avans_fk" group="sum" title="Переброски авансов" as="opl_perenos_104">
          <if>
            <call function="and">
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="kod_dest" column="kod_dest" />
                <const>104</const>
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_perenos_avans_fk" group="sum" title="Переброски авансов" as="opl_perenos_105">
          <if>
            <call function="and">
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="kod_dest" column="kod_dest" />
                <const>105</const>
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_perenos_avans_fk" group="sum" title="Переброски авансов" as="opl_perenos_106">
          <if>
            <call function="and">
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="kod_dest" column="kod_dest" />
                <const>106</const>
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_perenos_avans_fk" group="sum" title="Переброски авансов" as="opl_perenos_107">
          <if>
            <call function="and">
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="kod_dest" column="kod_dest" />
                <const>107</const>
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_avans_per" group="sum" if="ym_main" title="Сумма авансовых платежей (оплата) за месяц - ВСЕГО">
          <if>
            <call function="=">
              <column table="fingen_united" column="ym_opl_main" />
              <useparam name="ym" />
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_per_av_no_fk" group="sum" title="Сумма авансовых платежей без ФК" if="ym_main" />
        <column table="fingen_united" column="opl_per_av_fk" group="sum" if="ym_main" title="Переброски авансов" as="opl_avans_fk" />
        <call function="-" as="kredit_end" title="Кредиторская задолженность на конец месяца" group="sum" exclude="1">
          <const>0</const>
          <column table="fingen_united" column="ob_kred_it_kor" group="" if="end">
            <section>
              <call function="ym add month">
                <useparam name="ym" />
                <const>0</const>
              </call>
            </section>
          </column>
        </call>
        <column table="fingen_united" column="ob_kred_it_kor" group="sum" if="end" as="kredit_end" title="Кредиторская задолженность на конец месяца">
          <section>
            <call function="ym add month">
              <useparam name="ym" />
              <const>0</const>
            </call>
          </section>
        </column>
      </select>
      <from>
        <query name="fingen_united">
          <link name="kod_opl">
            <link name="kod_sf" as="kod_sf_opl" />
            <link name="kod_dest" as="kod_dest" />
          </link>
          <link name="kod_sf" />
          <link name="kod_opl_master" />
          <link name="kod_dog" as="kod_dog1">
            <link name="kod_dog_fin" as="kod_dog">
              <link name="kodp" />
              <link name="kod_dog_dop">
                <link name="kod_group_cust">
                  <link name="kod_group_cust_parent" />
                </link>
              </link>
            </link>
          </link>
          <extendwhere>
            <call function="and">
              <call function="true" />
              <call function="le" optional="1">
                <column table="*" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="in" optional="1" exclude="1">
                <column table="*" column="vid_real" />
                <useparam name="vid_real" />
              </call>
            </call>
          </extendwhere>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in" optional="1">
            <column table="fingen_united" column="dep" />
            <useparam name="dep" />
          </call>
          <call function="in" optional="1" exclude="1">
            <column table="kod_group_cust_parent" column="kod_group_cust" />
            <useparam name="kod_group_cust_parent" />
          </call>
          <call function="in" optional="1" exclude="1">
            <column table="kod_group_cust" column="kod_group_cust" />
            <useparam name="kod_group_cust" />
          </call>
          <call function="=">
            <column table="kod_dog" column="pr_active" />
            <const>0</const>
          </call>
          <!--<call function="in">
            <column table="kod_dog" column="kod_dog" />
            <array>20010728,20009422,120014561,20011395</array>
          </call>-->
        </call>
      </where>
    </query>
    <query name="54148-defaul-year" timestamp="07.11.2019 17:33:38">
      <select>
        <call function="-" as="year">
          <column table="a" column="year" />
          <const>3</const>
        </call>
      </select>
      <from>
        <query name="kr_calc_year_max" as="a" />
      </from>
    </query>
    <query name="32508-for-compare" title="Отчет по Авансовым платежам" timestamp="14.05.2023 17:27:08">
      <params>
        <param name="ym">
          <const>2023.06</const>
        </param>
        <param name="vid_real" />
      </params>
      <select>
        <column table="fingen_united" column="kod_dog" group="1" />
        <call as="god" type="" group="1" function="year">
          <column table="fingen_united" column="dat_vozn" as="" type="" />
        </call>
        <!--<column table="kod_opl_master" column="dat_opl" group="1" />-->
        <call function="-" as="kz" title="Кредиторская задолженность на начало месяца" group="sum">
          <const>0</const>
          <column table="fingen_united" column="ob_kred_it" group="" if="do">
            <section>
              <call function="ym add month">
                <useparam name="ym" />
                <const>-1</const>
              </call>
            </section>
          </column>
        </call>
        <call function="-" as="kz_kor" title="Кредиторская задолженность на начало месяца" group="sum">
          <const>0</const>
          <column table="fingen_united" column="ob_kred_kor" group="" if="do">
            <section>
              <call function="ym add month">
                <useparam name="ym" />
                <const>-1</const>
              </call>
            </section>
          </column>
        </call>
      </select>
      <from>
        <query name="fingen_united">
          <link name="kod_opl">
            <link name="kod_sf" as="kod_sf_opl" />
          </link>
          <link name="kod_sf" />
          <link name="kod_opl_master" />
          <link name="kod_dog">
            <link name="kodp" />
            <link name="kod_dog_dop">
              <link name="kod_group_cust">
                <link name="kod_group_cust_parent" />
              </link>
            </link>
          </link>
          <extendwhere>
            <call function="and">
              <call function="true" />
              <call function="le" optional="1">
                <column table="*" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="in" optional="1">
                <column table="*" column="vid_real" />
                <useparam name="vid_real" />
              </call>
            </call>
          </extendwhere>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="=">
            <column column="pr_active" table="kod_dog" />
            <const>0</const>
          </call>
          <!--<call function="in">
            <column table="kod_dog" column="kod_dog" />
            <array>20010728,20009422,120014561,20011395</array>
          </call>-->
        </call>
      </where>
    </query>
    <query name="32508-data-old" title="Отчет по Авансовым платежам" timestamp="14.05.2023 18:12:44">
      <params>
        <usepart part="32508-params" />
      </params>
      <select>
        <column table="fingen_united" column="kod_dog" group="1" />
        <column table="fingen_united" column="ym" group="1" />
        <call function="nvl" as="dat_opl" group="1" exclude="1">
          <column table="kod_opl_master" column="dat_opl" />
          <column table="fingen_united" column="dat_vozn" />
        </call>
        <column table="fingen_united" column="dat_vozn" group="1" as="dat_opl" comment="Отличие от новой версии только в этой колонке см. 66883 обсуждение от 2023-05-14 " />
        <!--<column table="kod_opl_master" column="dat_opl" group="1" />-->
        <column table="kod_dog" column="ndog" group="max" />
        <column table="kodp" column="name" group="max" />
        <column table="kod_group_cust_parent" column="name" as="name_group_cust_parent" group="max" />
        <column table="kod_group_cust" column="name" as="name_group_cust" group="max" />
        <call function="-" as="kredit_beg" title="Кредиторская задолженность на начало месяца" group="sum">
          <const>0</const>
          <column table="fingen_united" column="ob_kred_it_kor" group="" if="do">
            <section>
              <call function="ym add month">
                <useparam name="ym" />
                <const>-1</const>
              </call>
            </section>
          </column>
        </call>
        <call function="+nvl" as="opl_nach_avans" group="sum">
          <column table="fingen_united" column="opl_pfact_per" group="" />
          <column table="fingen_united" column="opl_pfact_avans" group="" />
        </call>
        <column table="this" column="opl_nach_avans" as="opl_nach_avans_per" class-title="Авансовые платежи, участвующие в погашении начисления за отчетный месяц">
          <if>
            <call function="=">
              <column table="fingen_united" column="ym" />
              <useparam name="ym" />
            </call>
          </if>
        </column>
        <column table="this" column="opl_nach_avans" as="opl_nach_avans_last" title="Авансовые платежи прошлых периодов, участвующие в погашении начисления за отчетный месяц">
          <if>
            <call function="and">
              <call function="lt">
                <call function="date to ym">
                  <!--<column table="kod_opl_master" column="dat_opl" />-->
                  <column table="this" column="dat_opl" />
                </call>
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="opl_nach_avans" as="opl_nach_avans_tek" title="Авансовые платежи текущего периода, участвующие в погашении начисления за отчетный месяц">
          <if>
            <call function="and">
              <call function="=">
                <call function="date to ym">
                  <!--<column table="kod_opl_master" column="dat_opl" />-->
                  <column table="this" column="dat_opl" />
                </call>
                <useparam name="ym" />
              </call>
              <call function="=">
                <column table="fingen_united" column="ym" />
                <useparam name="ym" />
              </call>
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_spisanie_avans" group="sum" if="per" title="Списание кред. зад-сти на прибыль (сч. 91/9)">
          <if>
            <call function="=">
              <column table="fingen_united" column="ym" />
              <useparam name="ym" />
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_vozvrat_avans" group="sum" if="per" title="Возвраты на расчетный счет" />
        <column table="fingen_united" column="opl_perenos_avans" group="sum" if="per" title="Переброски авансов" />
        <column table="fingen_united" column="opl_avans_per" group="sum" if="ym_main" title="Сумма авансовых платежей (оплата) за месяц - ВСЕГО">
          <if>
            <call function="=">
              <column table="fingen_united" column="ym_opl_main" />
              <useparam name="ym" />
            </call>
          </if>
        </column>
        <column table="fingen_united" column="opl_per_av_no_fk" group="sum" title="Сумма авансовых платежей без ФК" if="ym_main" />
        <column table="fingen_united" column="opl_per_av_fk" group="sum" if="ym_main" title="Переброски авансов" as="opl_avans_fk" />
        <call function="-" as="kredit_end" title="Кредиторская задолженность на конец месяца" group="sum">
          <const>0</const>
          <column table="fingen_united" column="ob_kred_it_kor" group="" if="end">
            <section>
              <call function="ym add month">
                <useparam name="ym" />
                <const>0</const>
              </call>
            </section>
          </column>
        </call>
      </select>
      <from>
        <query name="fingen_united">
          <link name="kod_opl">
            <link name="kod_sf" as="kod_sf_opl" />
          </link>
          <link name="kod_sf" />
          <link name="kod_opl_master" />
          <link name="kod_dog">
            <link name="kodp" />
            <link name="kod_dog_dop">
              <link name="kod_group_cust">
                <link name="kod_group_cust_parent" />
              </link>
            </link>
          </link>
          <extendwhere>
            <call function="and">
              <call function="true" />
              <call function="le" optional="1">
                <column table="*" column="ym" />
                <useparam name="ym" />
              </call>
              <call function="in" optional="1">
                <column table="*" column="vid_real" />
                <useparam name="vid_real" />
              </call>
            </call>
          </extendwhere>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in" optional="1">
            <column table="fingen_united" column="dep" />
            <useparam name="dep" />
          </call>
          <call function="in" optional="1">
            <column table="kod_group_cust_parent" column="kod_group_cust" />
            <useparam name="kod_group_cust_parent" />
          </call>
          <call function="in" optional="1">
            <column table="kod_group_cust" column="kod_group_cust" />
            <useparam name="kod_group_cust" />
          </call>
          <call function="=">
            <column table="kod_dog" column="pr_active" />
            <const>0</const>
          </call>
          <!--<call function="in">
            <column table="kod_dog" column="kod_dog" />
            <array>20010728,20009422,120014561,20011395</array>
          </call>-->
        </call>
      </where>
    </query>
    <query name="32508-old" title="Отчет по Авансовым платежам" timestamp="14.05.2023 17:57:39">
      <params>
        <usepart part="32508-params" />
      </params>
      <select>
        <call function="mes-name" as="month" group="max">
          <call function="mes">
            <useparam name="ym" />
          </call>
        </call>
        <call function="year" as="year" group="max">
          <call function="ym begin time">
            <useparam name="ym" />
          </call>
        </call>
        <column table="a" column="kod_dog" group="1" />
        <column table="a" column="ndog" group="max" />
        <column table="a" column="name" group="max" />
        <column table="a" column="name_group_cust_parent" group="max" />
        <column table="a" column="name_group_cust" group="max" />
        <column table="a" column="kredit_beg" group="sum" />
        <column table="a" column="kredit_beg" as="kredit_beg_by_year" group="sum" dimname="year" nvl="0">
          <pivot title=" по годам">
            <call function="year" as="year" group="">
              <column table="a" column="dat_opl" />
            </call>
            <query order="year">
              <select>
                <column table="year_list" column="year" />
                <column table="year_list" column="name" />
              </select>
              <from>
                <query name="kr_calc_year_list" as="year_list" />
              </from>
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="between" optional="1">
                    <column table="year_list" column="year" />
                    <useparam name="year" />
                    <call function="year">
                      <call function="ym begin time">
                        <useparam name="ym" />
                      </call>
                    </call>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="opl_nach_avans_per" group="sum" title="Всего" class-title="Авансовые платежи, участвующие в погашении начисления за отчетный месяц" nvl="0" />
        <column table="a" column="opl_nach_avans_last" group="sum" dimname="year" nvl="0" />
        <column table="a" column="opl_nach_avans_tek" group="sum" nvl="0" />
        <column table="a" column="opl_spisanie_avans" group="sum" dimname="year" nvl="0" />
        <column table="a" column="opl_vozvrat_avans" group="sum" dimname="year" nvl="0" />
        <column table="a" column="opl_perenos_avans" group="sum" dimname="year" nvl="0" />
        <column table="a" column="opl_avans_per" group="sum" as="opl_avans_all" exclude="1" />
        <call function="+nvl" as="opl_avans_all" title="Сумма авансовых платежей (оплата) за месяц - ВСЕГО">
          <column table="a" column="opl_per_av_no_fk" group="sum" />
          <column table="a" column="opl_avans_fk" group="sum" />
        </call>
        <column table="a" column="opl_per_av_no_fk" as="opl_avans" group="sum" nvl="0" />
        <column table="a" column="opl_avans_fk" group="sum" as="opl_avans_fk" />
        <column table="a" column="kredit_end" group="sum" nvl="0" />
        <column table="a" column="kredit_end" as="kredit_end_by_year" group="sum" dimname="year" nvl="0" />
      </select>
      <from>
        <query name="32508-data-old" as="a">
          <usepart part="32508-withparams" />
        </query>
      </from>
      <having>
        <call function="and">
          <call function="not 0">
            <column table="this" column="kredit_beg" />
            <column table="this" column="kredit_end" />
            <column table="this" column="opl_nach_avans_per" />
            <column table="a" column="opl_spisanie_avans" group="sum" />
            <column table="a" column="opl_vozvrat_avans" group="sum" />
            <column table="a" column="opl_perenos_avans" group="sum" />
          </call>
        </call>
      </having>
    </query>
  </queries>
</root>