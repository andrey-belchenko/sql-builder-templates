<?xml version="1.0" encoding="utf-8"?>
<root timestamp="2025-07-10T22:21:32.9622546+03:00">
  <customers child-name="customer" key-name="id" />
  <queries child-name="query" key-name="name">
    <query name="43125-deps-yms" timestamp="01.02.2018 13:11:10" file="sql.builder.templates\sql.builder\projects\43125\all\forms.xml" haskeys="1">
      <params>
        <param name="dep" type="array" />
        <param name="ym_s" type="number" />
        <param name="ym_po" type="number" />
      </params>
      <select>
        <column table="a" column="yms_closed_text" type="string" as="yms_closed_text" key="1" fixed="1" />
        <column table="a" column="yms_with_data_text" type="string" as="yms_with_data_text" key="0" />
        <column table="a" column="yms_without_data_text" type="string" as="yms_without_data_text" key="0" />
      </select>
      <from>
        <table name="43125-deps-yms-view" as="a" view="1" />
      </from>
    </query>
    <query name="43125-yms" timestamp="01.02.2018 13:11:10" file="sql.builder.templates\sql.builder\projects\43125\all\forms.xml" haskeys="1">
      <select>
        <column table="a" column="ym" type="number" as="ym" key="1" fixed="1" />
        <column table="a" column="name" type="string" as="name" key="0" />
      </select>
      <from>
        <table name="43125-yms" as="a" view="1" />
      </from>
    </query>
    <query name="42865" timestamp="25.06.2021 02:32:50" is-report="1" use-repository="1" title="Прогноз сбора денежных средств" allow-save="1" edit-columns="1" file="sql.builder.templates\sql.builder\projects\43125\all\rep42865.xml" haskeys="1">
      <params>
        <param name="ym" controlType="UICombo" title="Отчетный период" mandatory="1" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" />
        <param name="dep" controlType="UIList" title="Отделение" timestamp="13.05.2019 13:13:44" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" />
        <param name="kod_group_cust_parent" controlType="UIList" name-field-name="name" title="Группа потребителей" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" />
        <param name="kod_group_cust" controlType="UIList" name-field-name="name" title="Подгруппа потребления" timestamp="18.11.2016 16:28:06" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" title="Дата" name="sdat" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sym1" title="Отчетный период" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sym2" title="Следующий период" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sym0" title="Предыдущий период" column-visible="0" />
      </params>
      <columns>
        <column name="id" />
        <band title="Общие сведения">
          <column name="ndog" />
          <column name="name" />
          <column name="avans_info" />
          <column name="postplat_info" />
          <column name="user_group_parent" />
          <column name="user_group" />
          <column name="dep_name" />
        </band>
        <band title="Информация о задолженности на [:sdat]">
          <column name="dolg_kred" />
          <column name="dolg_deb" />
          <column name="sverh_dolg" />
        </band>
        <band title="ПСДС в текущем месяце необходимый к сбору">
          <column name="dolg_psds" />
          <column name="dolg" />
          <column name="nach_osn_tek" />
          <column name="nach_av_tek_for_tek" />
          <column name="nach_av_tek_for_nxt" />
          <column name="perc_av" />
        </band>
        <band title="Сведения о задолженности, уменьшающий необходимый ПСДС">
          <column name="dolg_psds_umen" />
          <column name="dolg_1_ur_st" />
          <column name="dolg_2_ur_st" />
          <column name="dolg_3_ur_st" />
          <column name="dolg_4_ur_st" />
          <column name="dolg_5_ur_st" />
          <column name="dolg_6_ur_st" />
          <column name="dolg_graf" />
          <column name="dolg_graf_nu" />
        </band>
        <column name="dolg_not_psds" />
        <band title="Прочие уменьшающие ПСДС факторы">
          <column name="dolg_psd_umen_proch" />
          <column name="prich_psd_umen_proch" />
        </band>
        <column name="dolg_not_psds_prch" />
      </columns>
      <content>
        <usefield field="asuse_ym" title="Отчетный период">
          <listquery>
            <query name="43125-yms" />
          </listquery>
          <defaultquery>
            <query name="spr_time_ym_cur" />
          </defaultquery>
        </usefield>
        <usefield field="asuse_dep" />
        <usefield field="asuse_kod_group_cust_parent" />
        <usefield field="asuse_kod_group_cust" />
        <usefield field="cmn_string" title="Дата" name="sdat" column-visible="0">
          <defaultquery>
            <query name="42865-sdat-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="sym1" title="Отчетный период" column-visible="0">
          <defaultquery>
            <query name="42865-sym1-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="sym2" title="Следующий период" column-visible="0">
          <defaultquery>
            <query name="42865-sym2-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="sym0" title="Предыдущий период" column-visible="0">
          <defaultquery>
            <query name="42865-sym0-def" />
          </defaultquery>
        </usefield>
      </content>
      <expressions>
        <call function="=" as="in_ym" dontpushpred="1">
          <call function="date to ym">
            <column table="dat" column="val" />
          </call>
          <useparam name="ym" />
        </call>
        <call function="=" as="in_prev_ym" dontpushpred="1">
          <call function="date to ym">
            <column table="dat" column="val" />
          </call>
          <call function="ym add month">
            <useparam name="ym" />
            <const>-1</const>
          </call>
        </call>
        <call function="=" dontpushpred="1" as="rym_tek">
          <column table="ym_vozn2" column="val" />
          <useparam name="ym" />
        </call>
        <call function="=" dontpushpred="1" as="rym_nxt">
          <column table="ym_vozn2" column="val" />
          <call function="ym add month">
            <useparam name="ym" />
            <const>1</const>
          </call>
        </call>
        <call function="0-" group="sum" as="dolg_kred" title="Кредиторская задолженность">
          <fact column="fin_ul_ob_kr_os_av" />
        </call>
        <call function="()" group="sum" as="dolg_deb" title="Дебиторская задолженность" type="number">
          <fact column="fin_ul_ob_osn" />
        </call>
        <call function="()" group="sum" as="nach_osn_tek" type="number">
          <fact column="fin_ul_nachisl_osn" condition="in_prev_ym" />
        </call>
        <call function="()" group="sum" as="nach_av_tek" type="number">
          <fact column="sr_avans_otch_avans" condition="in_ym" />
        </call>
        <call function="()" group="sum" as="nach_av_tek_for_tek" type="number">
          <fact column="nach_av_tek" condition="rym_tek" />
        </call>
        <call function="()" group="sum" as="nach_av_tek_for_nxt" type="number">
          <fact column="nach_av_tek" condition="rym_nxt" />
        </call>
        <call function="()" group="sum" as="perc_av" type="number">
          <fact column="sr_avans_otch_perc" condition="in_ym" />
        </call>
        <call function="=" dontpushpred="1" as="ur_1_st">
          <column table="kod_ur_state" column="kod_ur_state" />
          <const>1</const>
        </call>
        <call function="()" group="sum" as="dolg_1_ur_st" type="number">
          <fact column="qube_42865_dolg" condition="ur_1_st" />
        </call>
        <call function="=" dontpushpred="1" as="ur_2_st">
          <column table="kod_ur_state" column="kod_ur_state" />
          <const>2</const>
        </call>
        <call function="()" group="sum" as="dolg_2_ur_st" type="number">
          <fact column="qube_42865_dolg" condition="ur_2_st" />
        </call>
        <call function="=" dontpushpred="1" as="ur_3_st">
          <column table="kod_ur_state" column="kod_ur_state" />
          <const>3</const>
        </call>
        <call function="()" group="sum" as="dolg_3_ur_st" type="number">
          <fact column="qube_42865_dolg" condition="ur_3_st" />
        </call>
        <call function="=" dontpushpred="1" as="ur_4_st">
          <column table="kod_ur_state" column="kod_ur_state" />
          <const>4</const>
        </call>
        <call function="()" group="sum" as="dolg_4_ur_st" type="number">
          <fact column="qube_42865_dolg" condition="ur_4_st" />
        </call>
        <call function="=" dontpushpred="1" as="ur_5_st">
          <column table="kod_ur_state" column="kod_ur_state" />
          <const>5</const>
        </call>
        <call function="()" group="sum" as="dolg_5_ur_st" type="number">
          <fact column="qube_42865_dolg" condition="ur_5_st" />
        </call>
        <call function="=" dontpushpred="1" as="ur_6_st">
          <column table="kod_ur_state" column="kod_ur_state" />
          <const>6</const>
        </call>
        <call function="()" group="sum" as="dolg_6_ur_st" type="number">
          <fact column="qube_42865_dolg" condition="ur_6_st" />
        </call>
        <call function="is null" dontpushpred="1" as="ur_no_st">
          <column table="kod_ur_state" column="kod_ur_state" />
        </call>
        <call function="()" group="sum" as="dolg_no_ur_st" type="number">
          <fact column="qube_42865_dolg" condition="ur_no_st" />
        </call>
      </expressions>
      <select>
        <call function="rownum" as="id" key="1" />
        <column table="kod_dog" column="ndog" as="ndog" />
        <column table="kodp" column="name" as="name" />
        <column table="kod_dog" column="avans_info" as="avans_info" />
        <column table="kod_dog" column="postplat_info" as="postplat_info" />
        <column table="kod_group_cust_parent" column="name" as="user_group_parent" title="Группа потребителей" />
        <column table="kod_group_cust" column="name" as="user_group" title="Подгруппа потребителей" />
        <column table="dep" column="name" as="dep_name" title="Отделение" />
        <fact column="dolg_kred" nullif="0" table="beg1" as="dolg_kred" is-fact-use="1" />
        <fact column="dolg_deb" nullif="0" table="beg1" as="dolg_deb" is-fact-use="1" />
        <fact column="fin_ul_sverh_dolg_deb_ng" title="в т.ч. свехнормативная ДЗ" as="sverh_dolg" nullif="0" type="number" format="N2" table="beg1" is-fact-use="1">
          <withparams>
            <call function="ym begin time">
              <useparam name="ym" />
            </call>
          </withparams>
        </fact>
        <call function="greatest_num" as="dolg_psds" title="Необходимый ПСДС в текущем месяце" nvl="0">
          <call function="+nvl" auto-filter="1" title="-">
            <column table="this" column="dolg" />
            <column table="this" column="nach_av_tek_for_tek" />
            <column table="this" column="nach_av_tek_for_nxt" />
          </call>
          <const>0</const>
        </call>
        <call function="+nvl" title="Задолженность с учетом авансовых платежей" as="dolg" nullif="0">
          <column table="this" column="dolg_deb" />
          <column table="this" column="dolg_kred" />
        </call>
        <fact column="nach_osn_tek" title="Справочно: объем продаж в [:sym0]" nullif="0" table="end1" as="nach_osn_tek" is-fact-use="1" />
        <fact column="nach_av_tek_for_tek" title="Промежуточный платеж за [:sym1]" nullif="0" table="end1" as="nach_av_tek_for_tek" is-fact-use="1" />
        <fact column="nach_av_tek_for_nxt" title="Промежуточный платеж за [:sym2]" nullif="0" table="end1" as="nach_av_tek_for_nxt" is-fact-use="1" />
        <fact column="perc_av" title="% промежуточного платежа" nullif="0" table="end1" as="perc_av" is-fact-use="1" />
        <call function="+nvl" as="dolg_psds_umen" title="Задолженность, уменьшающая ПСДС необходимый к сбору" nullif="0">
          <column table="this" column="dolg_1_ur_st" />
          <column table="this" column="dolg_2_ur_st" />
          <column table="this" column="dolg_3_ur_st" />
          <column table="this" column="dolg_4_ur_st" />
          <column table="this" column="dolg_5_ur_st" />
          <column table="this" column="dolg_6_ur_st" />
          <column table="this" column="dolg_graf_nu" />
        </call>
        <fact column="dolg_1_ur_st" title="в т.ч. Исковая задолженность" nullif="0" table="beg1" as="dolg_1_ur_st" is-fact-use="1" />
        <fact column="dolg_2_ur_st" title="в т.ч. Взысканная задолженность" nullif="0" table="beg1" as="dolg_2_ur_st" is-fact-use="1" />
        <fact column="dolg_3_ur_st" title="в т.ч. На исполнительном производстве(ССП)" nullif="0" table="beg1" as="dolg_3_ur_st" is-fact-use="1" />
        <fact column="dolg_4_ur_st" title="в т.ч. На исполнительном производстве(инк.)" nullif="0" table="beg1" as="dolg_4_ur_st" is-fact-use="1" />
        <fact column="dolg_5_ur_st" title="в т.ч. На исполнительном производстве(казн.)" nullif="0" table="beg1" as="dolg_5_ur_st" is-fact-use="1" />
        <fact column="dolg_6_ur_st" title="в т.ч. Мораторная задолженность" nullif="0" table="beg1" as="dolg_6_ur_st" is-fact-use="1" />
        <fact column="fin_ul_ob" table="graf" as="dolg_graf" title="в т.ч. задолженность не включенная в графики погашения задолженности" nullif="0" is-fact-use="1" />
        <fact column="fin_ul_ob" table="graf1" as="dolg_graf_nu" title="" nullif="0" is-fact-use="1" />
        <call function="greatest_num" as="dolg_not_psds" title="Итого ПСДС к сбору без прочих уменьшающих факторов" nullif="0">
          <call function="-nvl">
            <column table="this" column="dolg_psds" />
            <column table="this" column="dolg_psds_umen" />
          </call>
          <const>0</const>
        </call>
        <call function="()" type="number" as="dolg_psd_umen_proch" title="Прочие уменьшающие факторы">
          <const>null</const>
        </call>
        <call function="()" type="string" as="prich_psd_umen_proch" title="Причины уменьшения ПСДС">
          <const>null</const>
        </call>
        <call function="-nvl" as="dolg_not_psds_prch" title="Итого ПСДС к сбору с учетом прочих уменьшающих факторов" excel-calc="1" nullif="0">
          <column table="this" column="dolg_not_psds" />
          <column table="this" column="dolg_psd_umen_proch" />
        </call>
      </select>
      <from>
        <qube>
          <link name="kod_dog">
            <link name="kod_vdog" />
          </link>
          <link name="kod_dep" as="dep" />
          <link name="kodp" />
          <link name="dat" />
          <link name="kod_group_cust" />
          <link name="kod_group_cust_parent" />
          <dimset as="beg1">
            <where>
              <call function="and" dont-push="1">
                <call function="lt" dontpushpred="1">
                  <column table="dat" column="val" />
                  <call function="ym begin time">
                    <useparam name="ym" />
                  </call>
                </call>
                <!--<call function="=">
                <column table="kod_sf" column="kod_sf" />
                <const>1845863</const>
              </call>-->
              </call>
            </where>
          </dimset>
          <dimset as="graf">
            <link name="qube_sf_graf" only-for-cond="1" />
            <where>
              <call function="between" dont-push="1">
                <call function="ym end time">
                  <useparam name="ym" />
                </call>
                <column table="qube_sf_graf" column="doc_date" />
                <call function="nvl">
                  <column table="qube_sf_graf" column="dat_finish" />
                  <call function="doomsday" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="graf1">
            <link name="qube_sf_graf" only-for-cond="1" />
            <link name="kod_ur_state" only-for-cond="1" />
            <where>
              <call function="between" dont-push="1">
                <call function="ym end time">
                  <useparam name="ym" />
                </call>
                <column table="qube_sf_graf" column="doc_date" />
                <call function="nvl">
                  <column table="qube_sf_graf" column="dat_finish" />
                  <call function="doomsday" />
                </call>
              </call>
              <call function="is null" dont-push="1">
                <column table="kod_ur_state" column="kod_ur_state" />
              </call>
            </where>
          </dimset>
          <dimset as="end1">
            <where>
              <call function="and" dont-push="1">
                <call function="le" dontpushpred="1">
                  <column table="dat" column="val" />
                  <call function="ym end time">
                    <useparam name="ym" />
                  </call>
                </call>
                <!--<call function="=">
                <column table="kod_sf" column="kod_sf" />
                <const>1845863</const>
              </call>-->
              </call>
            </where>
          </dimset>
          <where>
            <call function="and">
              <call function="true" />
              <call function="and" dont-push="1">
                <call function="!=">
                  <column table="kod_dog" column="pr_active" />
                  <const>1</const>
                </call>
                <call function="!=">
                  <column table="kod_vdog" column="kod_tipdog" />
                  <const>6</const>
                </call>
              </call>
              <call function="le" dontpushpred="1" dont-push="1">
                <column table="dat" column="val" />
                <call function="ym end time">
                  <useparam name="ym" />
                </call>
              </call>
              <call function="in" optional="1" dont-push="1">
                <column table="dep" column="kodp" />
                <useparam name="dep" />
              </call>
              <call function="in" optional="1" dont-push="1">
                <column table="kod_group_cust_parent" column="kod_group_cust" />
                <useparam name="kod_group_cust_parent" />
              </call>
              <call function="in" optional="1" dont-push="1">
                <column table="kod_group_cust" column="kod_group_cust" />
                <useparam name="kod_group_cust" />
              </call>
              <!--<call function="=">
                <column table="kod_sf" column="kod_sf" />
                <const>1845863</const>
              </call>-->
            </call>
          </where>
        </qube>
      </from>
    </query>
    <query name="qube_42865_ur_state" timestamp="15.09.2017 19:48:36" use-repository="1" file="sql.builder.templates\sql.builder\projects\43125\all\rep42865.xml">
      <select>
        <column table="kod_sf" column="kod_sf" dimension="kod_sf" as="kod_sf" />
        <fact column="sr_fv_ur_st_kod_ur_st_max" as="kod_ur_state" dimension="kod_ur_state" is-fact-use="1" />
        <fact column="fin_ul_ob_osn" fact="qube_42865_dolg" agg="sum" as="fin_ul_ob_osn" is-fact-use="1" />
      </select>
      <from>
        <qube>
          <link name="kod_dog">
            <link name="kodp" />
            <link name="kod_vdog" />
            <link name="dep" />
            <link name="kod_dog_dop">
              <link name="kod_group_cust">
                <link name="kod_group_cust_parent" />
              </link>
            </link>
          </link>
          <link name="dat" />
          <link name="kod_sf" />
        </qube>
      </from>
    </query>
    <query name="42865-sdat-def" timestamp="18.09.2017 18:50:46" file="sql.builder.templates\sql.builder\projects\43125\all\rep42865.xml">
      <params>
        <param name="ym" type="number" />
      </params>
      <select>
        <call function="date to char" as="val" key="0">
          <call function="ym begin time">
            <useparam name="ym" />
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="42865-sym2-def" timestamp="18.09.2017 15:23:06" file="sql.builder.templates\sql.builder\projects\43125\all\rep42865.xml">
      <params>
        <param name="ym" type="number" />
      </params>
      <select>
        <call function="ym to char" as="val" key="0">
          <call function="ym add month">
            <useparam name="ym" />
            <const>1</const>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="42865-sym1-def" timestamp="18.09.2017 15:23:54" file="sql.builder.templates\sql.builder\projects\43125\all\rep42865.xml">
      <params>
        <param name="ym" type="number" />
      </params>
      <select>
        <call function="ym to char" as="val" key="0">
          <useparam name="ym" />
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="42865-sym0-def" timestamp="18.12.2017 19:34:26" file="sql.builder.templates\sql.builder\projects\43125\all\rep42865.xml">
      <params>
        <param name="ym" type="number" />
      </params>
      <select>
        <call function="ym to char" as="val" key="0">
          <call function="ym add month">
            <useparam name="ym" />
            <const>-1</const>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-cols" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <select>
        <column table="u" column="*" as="*" key="0" />
      </select>
      <from>
        <query as="u">
          <union>
            <query haskeys="1">
              <select>
                <const as="id" type="string" key="1" fixed="1">'Отделение'</const>
                <const as="name" type="string" key="0">'Отделение'</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'Группа потребителей'</const>
                <const>'Группа потребителей'</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'Подгруппа потребителей'</const>
                <const>'Подгруппа потребителей'</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'Договор'</const>
                <const>'Договор'</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
          </union>
        </query>
      </from>
    </query>
    <query name="43125-cols-def" timestamp="26.09.2017 01:54:35" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="pr_dep" />
        <param type="number" name="pr_grp" />
        <param type="number" name="pr_grp_prnt" />
        <param type="number" name="pr_dog" />
      </params>
      <select>
        <column table="a" column="*" as="*" key="0" />
      </select>
      <from>
        <query name="43125-cols" as="a" />
      </from>
      <where>
        <call function="or">
          <call function="false" />
          <call function="and" optional="1">
            <call function="=1">
              <useparam name="pr_dep" />
            </call>
            <call function="in">
              <column table="a" column="id" />
              <call function="array">
                <const>'Отделение'</const>
              </call>
            </call>
          </call>
          <call function="and" optional="1">
            <call function="=1">
              <useparam name="pr_grp_prnt" />
            </call>
            <call function="in">
              <column table="a" column="id" />
              <call function="array">
                <const>'Группа потребителей'</const>
              </call>
            </call>
          </call>
          <call function="and" optional="1">
            <call function="=1">
              <useparam name="pr_grp" />
            </call>
            <call function="in">
              <column table="a" column="id" />
              <call function="array">
                <const>'Группа потребителей'</const>
                <const>'Подгруппа потребителей'</const>
              </call>
            </call>
          </call>
          <call function="and" optional="1">
            <call function="=1">
              <useparam name="pr_dog" />
            </call>
            <call function="in">
              <column table="a" column="id" />
              <call function="array">
                <const>'Отделение'</const>
                <const>'Группа потребителей'</const>
                <const>'Подгруппа потребителей'</const>
                <const>'Договор'</const>
              </call>
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="43125-tst1" timestamp="22.09.2017 16:19:49" is-report="1" use-repository="1" title="Расчет нормативной оплаты по фактическим показателям" allow-save="1" edit-columns="1" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="ym">
          <const>2017.07</const>
        </param>
        <param name="dep" type="array">
          <const>(102276621)</const>
        </param>
        <param name="kod_dog" type="array">
          <const>1000281108</const>
        </param>
        <param name="kod_group_cust_parent" type="array" />
        <param name="kod_group_cust" type="array" />
      </params>
      <expressions>
        <call function="le" as="end_pev_ym" dontpushpred="1">
          <column table="dat" column="val" />
          <call function="ym end time">
            <call function="ym add month">
              <useparam name="ym" />
              <const>-1</const>
            </call>
          </call>
        </call>
        <call function="le" as="end_pev_y" dontpushpred="1">
          <column table="dat" column="val" />
          <call function="year end time">
            <call function="-nvl">
              <call function="trunc">
                <useparam name="ym" />
              </call>
              <const>1</const>
            </call>
          </call>
        </call>
        <call function="=" as="in_ym" dontpushpred="1">
          <call function="date to ym">
            <column table="dat" column="val" />
          </call>
          <useparam name="ym" />
        </call>
        <call function="=" as="in_last_pry_ym" dontpushpred="1">
          <call function="date to ym">
            <column table="dat" column="val" />
          </call>
          <call function="date to ym">
            <call function="year begin time">
              <call function="-nvl">
                <call function="trunc">
                  <useparam name="ym" />
                </call>
                <const>-1</const>
              </call>
            </call>
          </call>
        </call>
        <call function="between" as="in_period" dontpushpred="1">
          <call function="date to ym">
            <column table="dat" column="val" />
          </call>
          <call function="date to ym">
            <call function="year begin time">
              <call function="trunc">
                <useparam name="ym" />
              </call>
            </call>
          </call>
          <call function="ym add month">
            <useparam name="ym" />
            <const>-1</const>
          </call>
        </call>
        <call function="=" dontpushpred="1" as="rym_tek">
          <column table="ym_vozn2" column="val" />
          <useparam name="ym" />
        </call>
        <call function="=" dontpushpred="1" as="rym_nxt">
          <column table="ym_vozn2" column="val" />
          <call function="ym add month">
            <useparam name="ym" />
            <const>1</const>
          </call>
        </call>
        <call function="=" dontpushpred="1" as="rym_beg_y">
          <column table="ym_vozn2" column="val" />
          <call function="date to ym">
            <call function="year begin time">
              <call function="trunc">
                <useparam name="ym" />
              </call>
            </call>
          </call>
        </call>
        <call function="0-" group="sum" as="dolg_kred_end_pev_ym" title="Кредиторская задолженность">
          <fact column="fin_ul_ob_kr_os_av" condition="end_pev_ym" />
        </call>
        <call function="()" group="sum" as="dolg_deb_end_pev_ym" title="Дебиторская задолженность" type="number">
          <fact column="fin_ul_ob_osn" condition="end_pev_ym" />
        </call>
        <call function="0-" group="sum" as="dolg_kred_end_pev_y" title="Кредиторская задолженность">
          <fact column="fin_ul_ob_kr_os_av" condition="end_pev_y" />
        </call>
        <call function="()" group="sum" as="dolg_deb_end_pev_y" title="Дебиторская задолженность" type="number">
          <fact column="fin_ul_ob_osn" condition="end_pev_y" />
        </call>
        <call function="()" group="sum" as="nach_osn_tek" type="number">
          <fact column="fin_ul_nachisl_osn" condition="in_ym" />
        </call>
        <call function="()" group="sum" as="nach_osn_period" type="number">
          <fact column="fin_ul_nachisl_osn" condition="in_period" />
        </call>
        <call function="()" group="sum" as="nach_av_tek" type="number">
          <fact column="fin_ul_nachisl_av" condition="in_ym" />
        </call>
        <call function="()" group="sum" as="nach_av_last_pry_ym" type="number">
          <fact column="fin_ul_nachisl_av" condition="in_last_pry_ym" />
        </call>
        <call function="()" group="sum" as="nach_av_for_tek" type="number">
          <fact column="fin_ul_nachisl_av" condition="rym_tek" />
        </call>
        <call function="()" group="sum" as="nach_av_tek_for_nxt" type="number">
          <fact column="nach_av_tek" condition="rym_nxt" />
        </call>
        <call function="()" group="sum" as="perc_av_for_tek" type="number">
          <fact column="sr_facvip_perc_sum" condition="rym_tek" />
        </call>
        <call function="()" group="sum" as="nach_av_last_pry_for_beg_y" type="number">
          <fact column="nach_av_last_pry_ym" condition="rym_beg_y" />
        </call>
      </expressions>
      <select>
        <column table="kod_dog" column="kod_dog" as="kod_dog" />
        <column table="dep" column="name" as="dep_name" title="Отделение" />
        <column table="kod_group_cust_parent" column="name" as="user_group_parent" title="Группа потребителей" />
        <column table="kod_group_cust" column="name" as="user_group" title="Подгруппа потребителей" />
        <column table="kod_dog" column="ndog" as="ndog" />
        <column table="kodp" column="name" as="name" />
        <fact column="dolg_deb_end_pev_y" as="dolg_deb_end_pev_y" is-fact-use="1" />
        <fact column="dolg_kred_end_pev_y" as="dolg_kred_end_pev_y" is-fact-use="1" />
        <call function="+nvl" as="dolg_end_pev_y">
          <column table="this" column="dolg_deb_end_pev_y" />
          <column table="this" column="dolg_kred_end_pev_y" />
        </call>
        <fact column="nach_osn_period" as="nach_osn_period" is-fact-use="1" />
        <call function="if" as="norm_opl_pred_beg_y" type="number">
          <call function="in">
            <column table="this" column="perc_av_for_tek" />
            <call function="array">
              <const>80</const>
              <const>90</const>
              <const>100</const>
            </call>
          </call>
          <fact column="nach_av_last_pry_for_beg_y" />
        </call>
        <fact column="dolg_deb_end_pev_ym" as="dolg_deb_end_pev_ym" is-fact-use="1" />
        <fact column="dolg_kred_end_pev_ym" as="dolg_kred_end_pev_ym" is-fact-use="1" />
        <call function="+nvl" as="dolg_end_pev_ym">
          <column table="this" column="dolg_deb_end_pev_ym" />
          <column table="this" column="dolg_kred_end_pev_ym" />
        </call>
        <fact column="nach_osn_tek" as="nach_osn_tek" is-fact-use="1" />
        <fact column="nach_av_for_tek" as="nach_av_for_tek" is-fact-use="1" />
        <fact column="perc_av_for_tek" as="perc_av_for_tek" is-fact-use="1" />
        <call function="smallest" as="av_tek_limited">
          <fact column="nach_av_for_tek" />
          <fact column="nach_osn_tek" />
        </call>
        <call function="if" as="norm_opl_pred" type="number">
          <call function="in">
            <column table="this" column="perc_av_for_tek" />
            <call function="array">
              <const>80</const>
              <const>90</const>
              <const>100</const>
            </call>
          </call>
          <column table="this" column="av_tek_limited" />
        </call>
        <call function="-nvl" as="norm_opl_in">
          <column table="this" column="av_tek_limited" />
          <column table="this" column="norm_opl_pred" />
        </call>
        <call function="-nvl" as="norm_opl_post">
          <column table="this" column="nach_osn_tek" />
          <column table="this" column="av_tek_limited" />
        </call>
        <call function="if" as="norm_opl_pred_nxt" type="number">
          <call function="in">
            <column table="this" column="perc_av_for_tek" />
            <call function="array">
              <const>80</const>
              <const>90</const>
              <const>100</const>
            </call>
          </call>
          <fact column="nach_av_tek_for_nxt" />
        </call>
        <call function="greatest_num" as="norm_opl_tek">
          <call function="+nvl">
            <column table="this" column="dolg_end_pev_ym" />
            <column table="this" column="norm_opl_in" />
            <column table="this" column="norm_opl_pred_nxt" />
          </call>
          <const>0</const>
        </call>
      </select>
      <from>
        <qube>
          <link name="kod_dog">
            <link name="kod_vdog" />
          </link>
          <link name="kod_dep" as="dep" />
          <link name="kodp" />
          <link name="dat" />
          <link name="kod_group_cust" />
          <link name="kod_group_cust_parent" />
          <where>
            <call function="and">
              <call function="true" />
              <call function="and" dont-push="1">
                <call function="!=">
                  <column table="kod_dog" column="pr_active" />
                  <const>1</const>
                </call>
              </call>
              <call function="and" dont-push="1">
                <call function="!=">
                  <column table="kod_dog" column="pr_active" />
                  <const>1</const>
                </call>
              </call>
              <call function="le" dontpushpred="1">
                <column table="dat" column="val" />
                <call function="ym end time">
                  <useparam name="ym" />
                </call>
              </call>
              <call function="in" optional="1">
                <column table="dep" column="kodp" />
                <useparam name="dep" />
              </call>
              <call function="in" optional="1">
                <column table="kod_group_cust_parent" column="kod_group_cust" />
                <useparam name="kod_group_cust_parent" />
              </call>
              <call function="in" optional="1">
                <column table="kod_group_cust" column="kod_group_cust" />
                <useparam name="kod_group_cust" />
              </call>
              <!--<call function="=">
                <column table="kod_sf" column="kod_sf" />
                <const>1845863</const>
              </call>-->
            </call>
          </where>
        </qube>
      </from>
    </query>
    <query name="43125" is-report="1" use-repository="1" title="Расчет нормативной оплаты по фактическим показателям" edit-columns="2" nogrid="1" with-behavior="0" timestamp="20.05.2025 03:35:51" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml" form="43125">
      <params>
        <param name="dep" controlType="UIList" title="Отделение" timestamp="13.05.2019 13:13:44" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" />
        <param name="m3" controlType="UICombo" title="Отчетный период" mandatory="1" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" />
        <param name="kod_group_cust_parent" controlType="UIList" name-field-name="name" title="Группа потребителей" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" />
        <param name="kod_group_cust" controlType="UIList" name-field-name="name" title="Подгруппа потребления" timestamp="18.11.2016 16:28:06" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" />
        <param controlType="UIList" title="Договор" name="kod_dog" rows-limit="100" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" />
        <param controlType="UICheck" checked="0" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="pr_itog" title="Итог" />
        <param controlType="UICheck" checked="0" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="pr_dep" title="По отделениям" />
        <param controlType="UICheck" checked="0" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="pr_grp_prnt" title="По группам потребления" />
        <param controlType="UICheck" checked="0" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="pr_grp" title="По подгруппам потребления" />
        <param controlType="UICheck" checked="0" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="pr_dog" title="По договорам" />
        <param name="m0" controlType="UICombo" title="Начало года" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" column-visible="0" />
        <param name="m1" controlType="UICombo" title="Начало квартала" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" column-visible="0" />
        <param name="m2" controlType="UICombo" title="Прошлый месяц" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="spry" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sm0" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="smp1" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sm2" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sm3" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="smp3" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sm4" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="smp4" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sm5" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="smp5" column-visible="0" />
        <param controlType="UIText" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sdep" column-visible="0" />
        <param controlType="UIList" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="dog_filter_m" visible="0" />
        <param controlType="UIList" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="dog_filter_g" visible="0" />
        <param controlType="UIList" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="dog_filter_k" visible="0" />
        <param name="colsets" controlType="UIList" special-type="colsets" title="Колонки" column-visible="0" />
      </params>
      <print-templates>
        <excel>
          <template name="43125.xlsx" title="Расчет нормативной оплаты по фактическим показателям" print-xlsx="1" print-proc="2" del-cols="1" />
        </excel>
      </print-templates>
      <content>
        <usefield field="asuse_dep" />
        <usefield field="asuse_ym" title="Отчетный период" name="m3">
          <listquery>
            <query name="43125-yms" />
          </listquery>
          <defaultquery>
            <query name="spr_time_ym_cur" />
          </defaultquery>
        </usefield>
        <usefield field="asuse_kod_group_cust_parent" />
        <usefield field="asuse_kod_group_cust" />
        <usefield field="asuse_kod_dog">
          <listquery>
            <query name="kr_dogovor_list_active" />
          </listquery>
        </usefield>
        <fieldgroup title="Выводить строки">
          <usefield field="cmn_check" name="pr_itog" title="Итог">
            <defaultquery>
              <query name="true" />
            </defaultquery>
          </usefield>
          <usefield field="cmn_check" name="pr_dep" title="По отделениям">
            <defaultquery>
              <query name="true" />
            </defaultquery>
          </usefield>
          <usefield field="cmn_check" name="pr_grp_prnt" title="По группам потребления">
            <defaultquery>
              <query name="true" />
            </defaultquery>
          </usefield>
          <usefield field="cmn_check" name="pr_grp" title="По подгруппам потребления">
            <defaultquery>
              <query name="true" />
            </defaultquery>
          </usefield>
          <usefield field="cmn_check" name="pr_dog" title="По договорам">
            <defaultquery>
              <query name="true" />
            </defaultquery>
          </usefield>
        </fieldgroup>
        <usefield field="asuse_ym_noma" title="Начало года" name="m0" column-visible="0">
          <defaultquery>
            <query name="43125-m0-val" />
          </defaultquery>
        </usefield>
        <usefield field="asuse_ym_noma" name="m1" title="Начало квартала" column-visible="0">
          <defaultquery>
            <query name="43125-m1-val" />
          </defaultquery>
        </usefield>
        <usefield field="asuse_ym_noma" title="Прошлый месяц" name="m2" column-visible="0">
          <defaultquery>
            <query name="43125-m2-val" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="spry" column-visible="0">
          <defaultquery>
            <query name="43125-spry-val" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="sm0" column-visible="0">
          <defaultquery>
            <query name="43125-sm0-val" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="smp1" column-visible="0">
          <defaultquery>
            <query name="43125-smp1-val" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="sm2" column-visible="0">
          <defaultquery>
            <query name="43125-sm2-val" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="sm3" column-visible="0">
          <defaultquery>
            <query name="43125-sm3-val" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="smp3" column-visible="0">
          <defaultquery>
            <query name="43125-smp3-val" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="sm4" column-visible="0">
          <defaultquery>
            <query name="43125-sm4-val" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="smp4" column-visible="0">
          <defaultquery>
            <query name="43125-smp4-val" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="sm5" column-visible="0">
          <defaultquery>
            <query name="43125-sm5-val" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="smp5" column-visible="0">
          <defaultquery>
            <query name="43125-smp5-val" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_string" name="sdep" column-visible="0">
          <defaultquery>
            <query name="43125-sdep-val" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_list" name="dog_filter_m" visible="0">
          <listquery>
            <query name="43125-dog_filter_m" />
          </listquery>
          <defaultquery>
            <query name="43125-dog_filter_m" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_list" name="dog_filter_g" visible="0">
          <listquery>
            <query name="43125-dog_filter_g" />
          </listquery>
          <defaultquery>
            <query name="43125-dog_filter_g" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_list" name="dog_filter_k" visible="0">
          <listquery>
            <query name="43125-dog_filter_k" />
          </listquery>
          <defaultquery>
            <query name="43125-dog_filter_k" />
          </defaultquery>
        </usefield>
        <field name="colsets" controlType="UIList" special-type="colsets" title="Колонки" type="string" column-visible="0">
          <defaultquery>
            <query name="43125-cols-def" />
          </defaultquery>
        </field>
        <label />
        <label title="Некоторые данные в отчете" />
        <label title="могут учитываться по" />
        <label title="состоянию на вчерашний день" />
        <label />
        <uicommand name="vg_mview.refresh_43125" title="Обновить хранилище" is-ret="0" message="Хранилище обновлено" />
      </content>
      <expressions>
        <call function="le" dontpushpred="1" as="dat_do_m3">
          <column table="dat" column="val" />
          <call function="ym end time">
            <call function="ym add month">
              <useparam name="m3" />
              <const>-1</const>
            </call>
          </call>
        </call>
        <call function="le" dontpushpred="1" as="dat_do_m0">
          <column table="dat" column="val" />
          <call function="ym end time">
            <call function="ym add month">
              <useparam name="m0" />
              <const>-1</const>
            </call>
          </call>
        </call>
        <call function="le" dontpushpred="1" as="dat_do_m1">
          <column table="dat" column="val" />
          <call function="ym end time">
            <call function="ym add month">
              <useparam name="m1" />
              <const>-1</const>
            </call>
          </call>
        </call>
        <call function="le" dontpushpred="1" as="dat_recalc_do_m3">
          <column table="dat_recalc" column="val" />
          <call function="ym end time">
            <call function="ym add month">
              <useparam name="m3" />
              <const>-1</const>
            </call>
          </call>
        </call>
        <call function="le" dontpushpred="1" as="dat_recalc_do_m0">
          <column table="dat_recalc" column="val" />
          <call function="ym end time">
            <call function="ym add month">
              <useparam name="m0" />
              <const>-1</const>
            </call>
          </call>
        </call>
        <call function="le" dontpushpred="1" as="dat_recalc_do_m1">
          <column table="dat_recalc" column="val" />
          <call function="ym end time">
            <call function="ym add month">
              <useparam name="m1" />
              <const>-1</const>
            </call>
          </call>
        </call>
        <call function="0-" group="sum" as="dolg_kred_m" title="Кредиторская задолженность">
          <fact column="fin_ul_ob_kr_os_av_rm" condition="dat_do_m3" />
        </call>
        <call function="()" group="sum" as="dolg_deb_m" title="Дебиторская задолженность" type="number">
          <fact column="fin_ul_ob_osn_rm" condition="dat_recalc_do_m3" />
        </call>
        <call function="0-" group="sum" as="dolg_kred_y" title="Кредиторская задолженность">
          <fact column="fin_ul_ob_kr_os_av_rm" condition="dat_do_m0" />
        </call>
        <call function="()" group="sum" as="dolg_deb_y" title="Дебиторская задолженность" type="number">
          <fact column="fin_ul_ob_osn_rm" condition="dat_recalc_do_m0" />
        </call>
        <call function="0-" group="sum" as="dolg_kred_k" title="Кредиторская задолженность">
          <fact column="fin_ul_ob_kr_os_av_rm" condition="dat_do_m1" />
        </call>
        <call function="()" group="sum" as="dolg_deb_k" title="Дебиторская задолженность" type="number">
          <fact column="fin_ul_ob_osn_rm" condition="dat_recalc_do_m1" />
        </call>
        <call as="norm_opl" function="+nvl" group="sum">
          <fact column="sr_aotch_norm_av_nach" />
          <fact column="sr_aotch_norm_av_no_nach" />
          <fact column="sr_aotch_norm_osn_nach" />
        </call>
        <call function="if" group="sum" as="nrm_do_god" type="number">
          <call function="and" dontpushpred="1">
            <call function="lt">
              <column table="ym_vist" column="val" />
              <useparam name="m0" />
            </call>
            <call function="=">
              <column table="ym_potr" column="val" />
              <useparam name="m0" />
            </call>
          </call>
          <fact column="norm_opl" />
        </call>
        <call function="if" group="sum" as="nrm_v_god" type="number">
          <call function="and" dontpushpred="1">
            <call function="between">
              <column table="ym_vist" column="val" />
              <useparam name="m0" />
              <useparam name="m2" />
            </call>
            <call function="between">
              <column table="ym_potr" column="val" />
              <useparam name="m0" />
              <useparam name="m2" />
            </call>
          </call>
          <fact column="norm_opl" />
        </call>
        <call function="if" group="sum" as="nrm_do_kv" type="number">
          <call function="and" dontpushpred="1">
            <call function="lt">
              <column table="ym_vist" column="val" />
              <useparam name="m1" />
            </call>
            <call function="=">
              <column table="ym_potr" column="val" />
              <useparam name="m1" />
            </call>
          </call>
          <fact column="norm_opl" />
        </call>
        <call function="if" group="sum" as="nrm_v_kv" type="number">
          <call function="and" dontpushpred="1">
            <call function="between">
              <column table="ym_vist" column="val" />
              <useparam name="m1" />
              <useparam name="m2" />
            </call>
            <call function="between">
              <column table="ym_potr" column="val" />
              <useparam name="m1" />
              <useparam name="m2" />
            </call>
          </call>
          <fact column="norm_opl" />
        </call>
        <call function="if" group="sum" as="nrm_p_godkv" type="number">
          <call function="and" dontpushpred="1">
            <call function="gt">
              <column table="ym_vist" column="val" />
              <useparam name="m2" />
            </call>
            <call function="=">
              <column table="ym_potr" column="val" />
              <useparam name="m2" />
            </call>
          </call>
          <fact column="norm_opl" />
        </call>
        <call function="if" group="sum" as="nrm_do_mes" type="number">
          <call function="and" dontpushpred="1">
            <call function="lt">
              <column table="ym_vist" column="val" />
              <useparam name="m3" />
            </call>
            <call function="=">
              <column table="ym_potr" column="val" />
              <useparam name="m3" />
            </call>
          </call>
          <fact column="norm_opl" />
        </call>
        <call function="if" group="sum" as="nrm_v_mes" type="number">
          <call function="and" dontpushpred="1">
            <call function="=">
              <column table="ym_vist" column="val" />
              <useparam name="m3" />
            </call>
            <call function="=">
              <column table="ym_potr" column="val" />
              <useparam name="m3" />
            </call>
          </call>
          <fact column="norm_opl" />
        </call>
        <call function="if" group="sum" as="nrm_p_mes" type="number">
          <call function="and" dontpushpred="1">
            <call function="gt">
              <column table="ym_vist" column="val" />
              <useparam name="m3" />
            </call>
            <call function="=">
              <column table="ym_potr" column="val" />
              <useparam name="m3" />
            </call>
          </call>
          <fact column="norm_opl" />
        </call>
        <call function="if" group="sum" as="nrm_do_nxt" type="number">
          <call function="and" dontpushpred="1">
            <call function="=">
              <column table="ym_vist" column="val" />
              <useparam name="m3" />
            </call>
            <call function="=">
              <column table="ym_potr" column="val" />
              <call function="ym add month">
                <useparam name="m3" />
                <const>1</const>
              </call>
            </call>
          </call>
          <fact column="norm_opl" />
        </call>
        <call function="if" group="sum" as="perc" type="number">
          <call function="and">
            <call function="=" dontpushpred="1">
              <call function="date to ym">
                <column table="dat" column="val" />
              </call>
              <useparam name="m3" />
            </call>
          </call>
          <fact column="sr_avans_otch_perc" />
        </call>
      </expressions>
      <select>
        <call function="to_char" as="sy" group="max">
          <call function="trunc">
            <useparam name="m3" />
          </call>
        </call>
        <call function="||" as="sm2sm4" group="max">
          <column table="this" column="sm2" group="" />
          <const>'-'</const>
          <column table="this" column="sm4" group="" />
        </call>
        <call function="()" type="string" group="max" as="spry">
          <useparam name="spry" />
        </call>
        <call function="()" type="string" group="max" as="sm0">
          <useparam name="sm0" />
        </call>
        <call function="()" type="string" group="max" as="smp1">
          <useparam name="smp1" />
        </call>
        <call function="()" type="string" group="max" as="sm2">
          <useparam name="sm2" />
        </call>
        <call function="()" type="string" group="max" as="sm3">
          <useparam name="sm3" />
        </call>
        <call function="()" type="string" group="max" as="smp3">
          <useparam name="smp3" />
        </call>
        <call function="()" type="string" group="max" as="sm4">
          <useparam name="sm4" />
        </call>
        <call function="()" type="string" group="max" as="smp4">
          <useparam name="smp4" />
        </call>
        <call function="()" type="string" group="max" as="sm5">
          <useparam name="sm5" />
        </call>
        <call function="()" type="string" group="max" as="smp5">
          <useparam name="smp5" />
        </call>
        <call function="()" type="string" group="max" as="sdep">
          <useparam name="sdep" />
        </call>
        <column table="kod_dog" column="kod_dog" as="kod_dog" />
        <column table="dep" column="kodp" as="dep" />
        <column table="kod_group_cust" column="kod_group_cust" as="kod_group_cust" />
        <column table="kod_group_cust_parent" column="kod_group_cust" as="kod_group_cust_parent" />
        <column table="dep" column="sname" as="dep_name" title="Отделение" colset="Отделение" group="max" />
        <call function="if" as="dep_name_g" type="string">
          <call function="or">
            <call function="false" />
            <call function="=1" optional="1">
              <useparam name="pr_dep" />
            </call>
          </call>
          <column table="dep" column="sname" title="Отделение" colset="Отделение" />
        </call>
        <column table="kod_group_cust_parent" column="name" as="user_group_parent" title="Группа потребителей" colset="Группа потребителей" />
        <column table="kod_group_cust" column="name" as="user_group" title="Подгруппа потребителей" colset="Подгруппа потребителей" />
        <column table="kodp" column="name" colset="Договор" as="name" />
        <column table="kod_dog" column="ndog" colset="Договор" as="ndog" />
        <fact column="dolg_deb_y" group="sum" nullif="0" as="dolg_deb_y" is-fact-use="1" />
        <fact column="dolg_kred_y" group="sum" nullif="0" as="dolg_kred_y" is-fact-use="1" />
        <call function="+nvl" as="dolg_y" group="sum" nullif="0">
          <column table="this" column="dolg_kred_y" />
          <column table="this" column="dolg_deb_y" />
        </call>
        <fact column="dolg_deb_k" group="sum" nullif="0" as="dolg_deb_k" is-fact-use="1" />
        <fact column="dolg_kred_k" group="sum" nullif="0" as="dolg_kred_k" is-fact-use="1" />
        <call function="+nvl" as="dolg_k" group="sum" nullif="0">
          <column table="this" column="dolg_kred_k" />
          <column table="this" column="dolg_deb_k" />
        </call>
        <fact column="dolg_deb_m" group="sum" nullif="0" as="dolg_deb_m" is-fact-use="1" />
        <fact column="dolg_kred_m" group="sum" nullif="0" as="dolg_kred_m" is-fact-use="1" />
        <call function="+nvl" as="dolg_m" group="sum" nullif="0">
          <column table="this" column="dolg_kred_m" />
          <column table="this" column="dolg_deb_m" />
        </call>
        <call function="+nvl" as="nrm_god" group="sum" nullif="0">
          <column table="this" column="nrm_do_god" />
          <column table="this" column="nrm_v_god" />
          <column table="this" column="nrm_p_godkv" />
        </call>
        <fact column="nrm_do_god" group="sum" nullif="0" as="nrm_do_god" is-fact-use="1" />
        <fact column="nrm_v_god" group="sum" nullif="0" as="nrm_v_god" is-fact-use="1" />
        <call function="+nvl" as="nrm_kv" group="sum" nullif="0">
          <column table="this" column="nrm_do_kv" />
          <column table="this" column="nrm_v_kv" />
          <column table="this" column="nrm_p_godkv" />
        </call>
        <fact column="nrm_do_kv" group="sum" nullif="0" as="nrm_do_kv" is-fact-use="1" />
        <fact column="nrm_v_kv" group="sum" nullif="0" as="nrm_v_kv" is-fact-use="1" />
        <fact column="nrm_p_godkv" group="sum" nullif="0" as="nrm_p_godkv" is-fact-use="1" />
        <call function="+nvl" as="nrm_mes" group="sum" nullif="0">
          <column table="this" column="nrm_do_mes" />
          <column table="this" column="nrm_v_mes" />
          <column table="this" column="nrm_p_mes" />
        </call>
        <fact column="nrm_do_mes" group="sum" nullif="0" as="nrm_do_mes" is-fact-use="1" />
        <fact column="nrm_v_mes" group="sum" nullif="0" as="nrm_v_mes" is-fact-use="1" />
        <fact column="nrm_p_mes" group="sum" nullif="0" as="nrm_p_mes" is-fact-use="1" />
        <fact column="nrm_do_nxt" group="sum" as="nrm_do_nxt" is-fact-use="1" />
        <call function="greatest_num" as="nrm_all_m" group="sum">
          <call function="+nvl">
            <column table="this" column="dolg_m" />
            <column table="this" column="nrm_v_mes" />
            <column table="this" column="nrm_do_nxt" />
          </call>
          <const>0</const>
        </call>
        <call function="greatest_num" as="nrm_all_k" group="sum">
          <call function="+nvl">
            <column table="this" column="dolg_k" />
            <column table="this" column="nrm_kv" />
            <column table="this" column="nrm_v_mes" />
            <column table="this" column="nrm_do_nxt" />
          </call>
          <const>0</const>
        </call>
        <call function="greatest_num" as="nrm_all_y" group="sum">
          <call function="+nvl">
            <column table="this" column="dolg_y" />
            <column table="this" column="nrm_god" />
            <column table="this" column="nrm_v_mes" />
            <column table="this" column="nrm_do_nxt" />
          </call>
          <const>0</const>
        </call>
      </select>
      <from>
        <qube>
          <link name="kod_dog">
            <link name="kod_vdog" />
            <link name="kodp" />
          </link>
          <link name="kod_dep" as="dep" />
          <link name="kod_group_cust" />
          <link name="kod_group_cust_parent" />
          <where>
            <call function="and">
              <call function="true" />
              <call function="or">
                <call function="!=">
                  <column table="kod_vdog" column="kod_tipdog" />
                  <const>6</const>
                </call>
                <call function="=">
                  <column table="kod_group_cust" column="kod_group_cust" />
                  <const>100076</const>
                </call>
              </call>
              <call function="in" optional="1">
                <column table="dep" column="kodp" />
                <useparam name="dep" />
              </call>
              <call function="in" optional="1">
                <column table="kod_dog" column="kod_dog" />
                <useparam name="kod_dog" />
              </call>
              <call function="in" optional="1">
                <column table="kod_group_cust_parent" column="kod_group_cust" />
                <useparam name="kod_group_cust_parent" />
              </call>
              <call function="in" optional="1">
                <column table="kod_group_cust" column="kod_group_cust" />
                <useparam name="kod_group_cust" />
              </call>
              <!--<call function="=">
                <column table="kod_sf" column="kod_sf" />
                <const>1845863</const>
              </call>-->
            </call>
          </where>
        </qube>
      </from>
      <grouping>
        <grset as="g">
          <where>
            <call function="and">
              <call function="gt">
                <call function="mes">
                  <useparam name="m3" />
                </call>
                <const>1</const>
              </call>
              <call function="not in" comment="SD43125(18)" optional="1">
                <column table="this" column="kod_dog" />
                <useparam name="dog_filter_g" />
              </call>
            </call>
          </where>
          <grset as="g_itog">
            <where>
              <call function="or">
                <call function="false" />
                <call function="=1" optional="1">
                  <useparam name="pr_itog" />
                </call>
              </call>
            </where>
          </grset>
          <grset as="g_dep">
            <group>
              <column table="this" column="dep_name_g" />
            </group>
            <grset as="g_dep1">
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="=1" optional="1">
                    <useparam name="pr_dep" />
                  </call>
                </call>
              </where>
            </grset>
            <grset as="g_pgrp">
              <where>
                <call function="is not null">
                  <column table="this" column="kod_group_cust_parent" />
                </call>
              </where>
              <group>
                <sourcelink table="kod_group_cust_parent" />
              </group>
              <grset as="g_pgrp1">
                <where>
                  <call function="or">
                    <call function="false" />
                    <call function="=1" optional="1">
                      <useparam name="pr_grp_prnt" />
                    </call>
                  </call>
                </where>
              </grset>
              <grset as="g_grp">
                <call function="is not null">
                  <column table="this" column="kod_group_cust" />
                </call>
                <group>
                  <sourcelink table="kod_group_cust" />
                </group>
                <grset as="g_grp1">
                  <where>
                    <call function="or">
                      <call function="false" />
                      <call function="=1" optional="1">
                        <useparam name="pr_grp" />
                      </call>
                    </call>
                  </where>
                </grset>
                <grset as="g_dog">
                  <where>
                    <call function="and">
                      <call function="is not null">
                        <column table="this" column="kod_dog" />
                      </call>
                      <call function="or">
                        <call function="false" />
                        <call function="=1" optional="1">
                          <useparam name="pr_dog" />
                        </call>
                      </call>
                    </call>
                  </where>
                  <group>
                    <sourcelink table="kod_dog" />
                  </group>
                </grset>
              </grset>
            </grset>
          </grset>
        </grset>
        <grset as="k">
          <where>
            <call function="and">
              <call function="gt">
                <call function="mes">
                  <useparam name="m3" />
                </call>
                <const>3</const>
              </call>
              <call function="=">
                <call function="mes">
                  <useparam name="m3" />
                </call>
                <call function="kv end mes">
                  <call function="mes to kv">
                    <call function="mes">
                      <useparam name="m3" />
                    </call>
                  </call>
                </call>
              </call>
              <call function="not in" comment="SD43125(18)" optional="1">
                <column table="this" column="kod_dog" />
                <useparam name="dog_filter_k" />
              </call>
            </call>
          </where>
          <grset as="k_itog">
            <where>
              <call function="or">
                <call function="false" />
                <call function="=1" optional="1">
                  <useparam name="pr_itog" />
                </call>
              </call>
            </where>
          </grset>
          <grset as="k_dep">
            <group>
              <column table="this" column="dep_name_g" />
            </group>
            <grset as="k_dep1">
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="=1" optional="1">
                    <useparam name="pr_dep" />
                  </call>
                </call>
              </where>
            </grset>
            <grset as="k_pgrp">
              <where>
                <call function="is not null">
                  <column table="this" column="kod_group_cust_parent" />
                </call>
              </where>
              <group>
                <sourcelink table="kod_group_cust_parent" />
              </group>
              <grset as="k_pgrp1">
                <where>
                  <call function="or">
                    <call function="false" />
                    <call function="=1" optional="1">
                      <useparam name="pr_grp_prnt" />
                    </call>
                  </call>
                </where>
              </grset>
              <grset as="k_grp">
                <call function="is not null">
                  <column table="this" column="kod_group_cust" />
                </call>
                <group>
                  <sourcelink table="kod_group_cust" />
                </group>
                <grset as="k_grp1">
                  <where>
                    <call function="or">
                      <call function="false" />
                      <call function="=1" optional="1">
                        <useparam name="pr_grp" />
                      </call>
                    </call>
                  </where>
                </grset>
                <grset as="k_dog">
                  <where>
                    <call function="and">
                      <call function="is not null">
                        <column table="this" column="kod_dog" />
                      </call>
                      <call function="or">
                        <call function="false" />
                        <call function="=1" optional="1">
                          <useparam name="pr_dog" />
                        </call>
                      </call>
                    </call>
                  </where>
                  <group>
                    <sourcelink table="kod_dog" />
                  </group>
                </grset>
              </grset>
            </grset>
          </grset>
        </grset>
        <grset as="m">
          <where>
            <call function="and">
              <call function="true" />
              <call function="not in" comment="SD43125(18)" optional="1">
                <column table="this" column="kod_dog" />
                <useparam name="dog_filter_m" />
              </call>
            </call>
          </where>
          <grset as="m_itog">
            <where>
              <call function="or">
                <call function="false" />
                <call function="=1" optional="1">
                  <useparam name="pr_itog" />
                </call>
              </call>
            </where>
          </grset>
          <grset as="m_dep">
            <group>
              <column table="this" column="dep_name_g" />
            </group>
            <grset as="m_dep1">
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="=1" optional="1">
                    <useparam name="pr_dep" />
                  </call>
                </call>
              </where>
            </grset>
            <grset as="m_pgrp">
              <where>
                <call function="is not null">
                  <column table="this" column="kod_group_cust_parent" />
                </call>
              </where>
              <group>
                <sourcelink table="kod_group_cust_parent" />
              </group>
              <grset as="m_pgrp1">
                <where>
                  <call function="or">
                    <call function="false" />
                    <call function="=1" optional="1">
                      <useparam name="pr_grp_prnt" />
                    </call>
                  </call>
                </where>
              </grset>
              <grset as="m_grp">
                <call function="is not null">
                  <column table="this" column="kod_group_cust" />
                </call>
                <group>
                  <sourcelink table="kod_group_cust" />
                </group>
                <grset as="m_grp1">
                  <where>
                    <call function="or">
                      <call function="false" />
                      <call function="=1" optional="1">
                        <useparam name="pr_grp" />
                      </call>
                    </call>
                  </where>
                </grset>
                <grset as="m_dog">
                  <where>
                    <call function="and">
                      <call function="is not null">
                        <column table="this" column="kod_dog" />
                      </call>
                      <call function="or">
                        <call function="false" />
                        <call function="=1" optional="1">
                          <useparam name="pr_dog" />
                        </call>
                      </call>
                    </call>
                  </where>
                  <group>
                    <sourcelink table="kod_dog" />
                  </group>
                </grset>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="43125-m0-val" timestamp="22.09.2017 16:26:10" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m3" />
      </params>
      <select>
        <call function="if" type="number" as="val" key="0">
          <call function="is not null">
            <useparam name="m3" />
          </call>
          <call function="date to ym">
            <call function="year begin time">
              <call function="trunc">
                <useparam name="m3" />
              </call>
            </call>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-m1-val" timestamp="22.09.2017 16:16:37" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m3" />
      </params>
      <select>
        <call function="num to ym" as="val" key="0">
          <call function="trunc">
            <useparam name="m3" />
          </call>
          <call function="kv beg mes">
            <call function="ym to kv">
              <useparam name="m3" />
            </call>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-m2-val" timestamp="22.09.2017 16:17:35" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m3" />
      </params>
      <select>
        <call function="ym add month" as="val" key="0">
          <useparam name="m3" />
          <const>-1</const>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-spry-val" timestamp="22.09.2017 16:40:12" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m3" />
      </params>
      <select>
        <call function="-" as="val" key="0">
          <call function="trunc">
            <useparam name="m3" />
          </call>
          <const>1</const>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-sm0-val" timestamp="22.09.2017 17:15:34" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m0" />
      </params>
      <select>
        <call function="lower" as="val" key="0">
          <call function="mes-name">
            <call function="mes">
              <useparam name="m0" />
            </call>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-smp1-val" timestamp="22.09.2017 17:17:37" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m1" />
      </params>
      <select>
        <call function="lower" as="val" key="0">
          <call function="mes-name-pp">
            <call function="mes">
              <call function="ym add month">
                <useparam name="m1" />
                <const>-1</const>
              </call>
            </call>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-sm2-val" timestamp="22.09.2017 17:17:10" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m1" />
      </params>
      <select>
        <call function="lower" as="val" key="0">
          <call function="mes-name">
            <call function="mes">
              <useparam name="m1" />
            </call>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-sm3-val" timestamp="22.09.2017 17:18:24" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m2" />
      </params>
      <select>
        <call function="lower" as="val" key="0">
          <call function="mes-name">
            <call function="mes">
              <useparam name="m2" />
            </call>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-smp3-val" timestamp="22.09.2017 17:18:45" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m2" />
      </params>
      <select>
        <call function="lower" as="val" key="0">
          <call function="mes-name-pp">
            <call function="mes">
              <useparam name="m2" />
            </call>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-sm4-val" timestamp="22.09.2017 17:19:16" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m3" />
      </params>
      <select>
        <call function="lower" as="val" key="0">
          <call function="mes-name">
            <call function="mes">
              <useparam name="m3" />
            </call>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-smp4-val" timestamp="22.09.2017 17:19:35" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m3" />
      </params>
      <select>
        <call function="lower" as="val" key="0">
          <call function="mes-name-pp">
            <call function="mes">
              <useparam name="m3" />
            </call>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-sm5-val" timestamp="22.09.2017 17:28:42" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m3" />
      </params>
      <select>
        <call function="lower" as="val" key="0">
          <call function="mes-name">
            <call function="mes">
              <call function="ym add month">
                <useparam name="m3" />
                <const>1</const>
              </call>
            </call>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-smp5-val" timestamp="22.09.2017 17:28:42" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="number" name="m3" />
      </params>
      <select>
        <call function="lower" as="val" key="0">
          <call function="mes-name-pp">
            <call function="mes">
              <call function="ym add month">
                <useparam name="m3" />
                <const>1</const>
              </call>
            </call>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="dual" />
      </from>
    </query>
    <query name="43125-sdep-val" timestamp="26.09.2017 10:50:40" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param type="array" name="dep" />
      </params>
      <select>
        <column table="a" column="sname" as="val" group="stragg" key="0" />
      </select>
      <from>
        <query name="kr_dep" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="true" />
          <call function="in" optional="1">
            <column table="a" column="kodp" />
            <useparam name="dep" />
          </call>
        </call>
      </where>
    </query>
    <query name="43125-dog_filter_m" timestamp="19.03.2020 23:41:21" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml" haskeys="1">
      <params>
        <param type="number" name="m3">
          <const>2020.01</const>
        </param>
      </params>
      <select>
        <column table="kr_dogovor" column="kod_dog" group="1" key="1" as="kod_dog" />
        <column table="kr_dogovor" column="ndog" group="1" as="ndog" />
      </select>
      <from>
        <query name="kr_dogovor" as="kr_dogovor" title="Договор" />
        <query name="sr_opl" join="left outer" as="sr_opl" dname="43125-dog_filter_m">
          <call function="and">
            <call function="=">
              <column table="sr_opl" column="ym" />
              <useparam name="m3" />
            </call>
            <call function="=">
              <column table="kr_dogovor" column="kod_dog" />
              <column table="sr_opl" column="kod_dog" />
            </call>
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <column table="kr_dogovor" column="pr_active" />
          </call>
          <call function="is null">
            <column table="sr_opl" column="kod_opl" />
          </call>
        </call>
      </where>
    </query>
    <query name="43125-dog_filter_k" timestamp="19.03.2020 23:46:12" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml" haskeys="1">
      <params>
        <param type="number" name="m3">
          <const>2020.01</const>
        </param>
      </params>
      <select>
        <column table="kr_dogovor" column="kod_dog" group="1" key="1" as="kod_dog" />
        <column table="kr_dogovor" column="ndog" group="1" as="ndog" />
      </select>
      <from>
        <query name="kr_dogovor" as="kr_dogovor" title="Договор" />
        <query name="sr_opl" join="left outer" as="sr_opl" dname="43125-dog_filter_k">
          <call function="and">
            <call function="le">
              <column table="sr_opl" column="ym" />
              <useparam name="m3" />
            </call>
            <call function="ge">
              <column table="sr_opl" column="ym" />
              <call function="num to ym">
                <call function="trunc">
                  <useparam name="m3" />
                </call>
                <call function="kv beg mes">
                  <call function="ym to kv">
                    <useparam name="m3" />
                  </call>
                </call>
              </call>
            </call>
            <call function="=">
              <column table="kr_dogovor" column="kod_dog" />
              <column table="sr_opl" column="kod_dog" />
            </call>
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <column table="kr_dogovor" column="pr_active" />
          </call>
          <call function="is null">
            <column table="sr_opl" column="kod_opl" />
          </call>
        </call>
      </where>
    </query>
    <query name="43125-dog_filter_g" timestamp="19.03.2020 23:49:59" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml" haskeys="1">
      <params>
        <param type="number" name="m3">
          <const>2020.01</const>
        </param>
      </params>
      <select>
        <column table="kr_dogovor" column="kod_dog" group="1" key="1" as="kod_dog" />
        <column table="kr_dogovor" column="ndog" group="1" as="ndog" />
      </select>
      <from>
        <query name="kr_dogovor" as="kr_dogovor" title="Договор" />
        <query name="sr_opl" join="left outer" as="sr_opl" dname="43125-dog_filter_g">
          <call function="and">
            <call function="le">
              <column table="sr_opl" column="ym" />
              <useparam name="m3" />
            </call>
            <call function="ge">
              <column table="sr_opl" column="ym" />
              <call function="trunc">
                <useparam name="m3" />
              </call>
            </call>
            <call function="=">
              <column table="kr_dogovor" column="kod_dog" />
              <column table="sr_opl" column="kod_dog" />
            </call>
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=1">
            <column table="kr_dogovor" column="pr_active" />
          </call>
          <call function="is null">
            <column table="sr_opl" column="kod_opl" />
          </call>
        </call>
      </where>
    </query>
    <query name="43125_1" timestamp="23.01.2018 20:51:32" use-repository="1" is-report="1" use-temp="1" file="sql.builder.templates\sql.builder\projects\43125\all\sch1.xml">
      <params>
        <param name="p_dep" type="number">
          <const>(102276621)</const>
        </param>
        <param type="number" name="p_ym">
          <const>2017.06</const>
        </param>
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" as="kod_dog" />
        <fact column="fin_ul_sverh_dolg_deb_ng" title="в т.ч. свехнормативная ДЗ" as="sverh_dolg_beg" type="number" format="N2" nvl="0" is-fact-use="1">
          <withparams>
            <call function="ym begin time">
              <useparam name="p_ym" />
            </call>
          </withparams>
        </fact>
        <fact column="fin_ul_sverh_dolg_deb_ng" title="в т.ч. свехнормативная ДЗ" as="sverh_dolg_end" type="number" format="N2" nvl="0" is-fact-use="1">
          <withparams>
            <call function="ym begin time">
              <call function="ym add month">
                <useparam name="p_ym" />
                <const>1</const>
              </call>
            </call>
          </withparams>
        </fact>
      </select>
      <from>
        <qube>
          <link name="dat" />
          <link name="kod_dog">
            <link name="kod_vdog" />
          </link>
          <link name="kod_dep" as="dep" />
          <link name="kodp" />
          <where>
            <call function="=">
              <column table="kod_dog" column="dep" />
              <useparam name="p_dep" />
            </call>
            <call function="le" dontpushpred="1">
              <column table="dat" column="val" />
              <call function="ym end time">
                <useparam name="p_ym" />
              </call>
            </call>
          </where>
        </qube>
      </from>
    </query>
    <query name="43125_rm" timestamp="05.05.2021 11:42:22" use-repository="1" is-report="1" use-temp="1" file="sql.builder.templates\sql.builder\projects\43125\all\sch1.xml">
      <params>
        <param name="p_dep" type="number">
          <const>(102276621)</const>
        </param>
        <param type="number" name="p_ym">
          <const>2021.02</const>
        </param>
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" as="kod_dog" />
        <fact column="fin_ul_sverh_dolg_deb_ng_rm" title="в т.ч. свехнормативная ДЗ" as="sverh_dolg_beg" type="number" format="N2" nvl="0" is-fact-use="1">
          <withparams>
            <call function="ym begin time">
              <useparam name="p_ym" />
            </call>
          </withparams>
        </fact>
        <fact column="fin_ul_sverh_dolg_deb_ng_rm" title="в т.ч. свехнормативная ДЗ" as="sverh_dolg_end" type="number" format="N2" nvl="0" is-fact-use="1">
          <withparams>
            <call function="ym begin time">
              <call function="ym add month">
                <useparam name="p_ym" />
                <const>1</const>
              </call>
            </call>
          </withparams>
        </fact>
      </select>
      <from>
        <qube>
          <link name="dat" />
          <link name="kod_dog">
            <link name="kod_vdog" />
          </link>
          <link name="kod_dep" as="dep" />
          <link name="kodp" />
          <where>
            <call function="=">
              <column table="kod_dog" column="dep" />
              <useparam name="p_dep" />
            </call>
            <call function="le" dontpushpred="1">
              <column table="dat" column="val" />
              <call function="ym end time">
                <useparam name="p_ym" />
              </call>
            </call>
          </where>
        </qube>
      </from>
    </query>
    <query name="43125_test" use-repository="1" timestamp="07.12.2023 20:35:43" file="sql.builder.templates\sql.builder\projects\43125\all\sch1.xml">
      <params>
        <param name="p_dep" type="number">
          <const>102276621</const>
        </param>
        <param type="number" name="p_ym">
          <const>2023.11</const>
        </param>
      </params>
      <select>
        <column table="kod_dog" column="kod_dog" as="kod_dog" />
        <column table="kod_sf" column="kod_sf" as="kod_sf" />
        <column table="kod_sf" column="ym" as="ym" />
        <column table="kod_sf" column="vid_real" as="vid_real" />
        <fact column="fin_ul_sverh_dolg_deb_pre" title="в т.ч. свехнормативная ДЗ" as="sverh_dolg_end1" type="number" format="N2" nvl="0" is-fact-use="1">
          <withparams>
            <call function="ym begin time">
              <call function="ym add month">
                <useparam name="p_ym" />
                <const>1</const>
              </call>
            </call>
          </withparams>
        </fact>
        <fact column="fin_ul_ob_os_av_norm" as="fin_ul_ob_os_av_norm" is-fact-use="1" />
        <fact column="sr_facvip_norm_av_av_nach" as="sr_facvip_norm_av_av_nach" is-fact-use="1" />
        <fact column="sr_facvip_norm_av_osn_nach" as="sr_facvip_norm_av_osn_nach" is-fact-use="1" />
        <fact column="sr_opl_norm_av_av_opl" as="sr_opl_norm_av_av_opl" is-fact-use="1" />
        <fact column="sr_opl_norm_av_osn_opl" as="sr_opl_norm_av_osn_opl" is-fact-use="1" />
      </select>
      <from>
        <qube>
          <link name="dat" />
          <link name="kod_dog">
            <link name="kod_vdog" />
          </link>
          <link name="kod_dep" as="dep" />
          <link name="kodp" />
          <link name="kod_sf" />
          <link name="dat_dolg_norm" />
          <where>
            <call function="=">
              <column table="kod_dog" column="dep" />
              <useparam name="p_dep" />
            </call>
            <call function="=">
              <column table="kod_dog" column="kod_dog" />
              <const>8135</const>
            </call>
          </where>
        </qube>
      </from>
      <where>
        <call type="" function="and">
          <call function="!=0" as="" type="">
            <column table="this" column="sverh_dolg_end1" />
          </call>
        </call>
      </where>
    </query>
    <query name="form:form_sr_avans_otch" haskeys="1">
      <select>
        <column table="u" column="title" title="Параметр" as="title" />
        <column table="u" column="name" key="1" as="name" />
        <column table="u" column="text" title="Значение" as="text" />
      </select>
      <from>
        <query as="u">
          <union>
            <query>
              <select>
                <const type="string" as="title">'Отделение'</const>
                <const type="string" as="name">'dep'</const>
                <const type="string" as="text">NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'С'</const>
                <const>'ym_s'</const>
                <const>NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'По'</const>
                <const>'ym_po'</const>
                <const>NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
          </union>
        </query>
      </from>
    </query>
    <query name="form:43125" haskeys="1">
      <select>
        <column table="u" column="title" title="Параметр" as="title" />
        <column table="u" column="name" key="1" as="name" />
        <column table="u" column="text" title="Значение" as="text" />
      </select>
      <from>
        <query as="u">
          <union>
            <query>
              <select>
                <const type="string" as="title">'Отделение'</const>
                <const type="string" as="name">'dep'</const>
                <const type="string" as="text">NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'Отчетный период'</const>
                <const>'m3'</const>
                <const>NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'Группа потребителей'</const>
                <const>'kod_group_cust_parent'</const>
                <const>NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'Подгруппа потребления'</const>
                <const>'kod_group_cust'</const>
                <const>NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'Договор'</const>
                <const>'kod_dog'</const>
                <const>NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'Итог'</const>
                <const>'pr_itog'</const>
                <const>NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'По отделениям'</const>
                <const>'pr_dep'</const>
                <const>NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'По группам потребления'</const>
                <const>'pr_grp_prnt'</const>
                <const>NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'По подгруппам потребления'</const>
                <const>'pr_grp'</const>
                <const>NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
            <query>
              <select>
                <const>'По договорам'</const>
                <const>'pr_dog'</const>
                <const>NULL</const>
              </select>
              <from>
                <table name="dual" />
              </from>
            </query>
          </union>
        </query>
      </from>
    </query>
  </queries>
  <functions child-name="function" key-name="name" />
  <parts child-name="part" key-name="id">
    <part id="42865-params" timestamp="15.09.2017 17:32:24" file="sql.builder.templates\sql.builder\projects\43125\all\rep42865.xml">
      <param type="number" name="ym">
        <const>2017.07</const>
      </param>
      <param name="dep" type="array">
        <const>(102276621)</const>
      </param>
      <param name="kod_dog" type="array">
        <const>1000281108</const>
      </param>
      <param name="kod_group_cust_parent" type="array" />
      <param name="kod_group_cust" type="array" />
    </part>
    <part id="43125-grsets" timestamp="26.09.2017 01:56:28" file="sql.builder.templates\sql.builder\projects\43125\all\sch.xml">
      <params>
        <param name="p" />
      </params>
      <grset as="[:p]itog">
        <where>
          <call function="or">
            <call function="false" />
            <call function="=1" optional="1">
              <useparam name="pr_itog" />
            </call>
          </call>
        </where>
      </grset>
      <grset as="[:p]dep">
        <group>
          <column table="this" column="dep_name_g" />
        </group>
        <grset as="[:p]dep1">
          <where>
            <call function="or">
              <call function="false" />
              <call function="=1" optional="1">
                <useparam name="pr_dep" />
              </call>
            </call>
          </where>
        </grset>
        <grset as="[:p]pgrp">
          <where>
            <call function="is not null">
              <column table="this" column="kod_group_cust_parent" />
            </call>
          </where>
          <group>
            <sourcelink table="kod_group_cust_parent" />
          </group>
          <grset as="[:p]pgrp1">
            <where>
              <call function="or">
                <call function="false" />
                <call function="=1" optional="1">
                  <useparam name="pr_grp_prnt" />
                </call>
              </call>
            </where>
          </grset>
          <grset as="[:p]grp">
            <call function="is not null">
              <column table="this" column="kod_group_cust" />
            </call>
            <group>
              <sourcelink table="kod_group_cust" />
            </group>
            <grset as="[:p]grp1">
              <where>
                <call function="or">
                  <call function="false" />
                  <call function="=1" optional="1">
                    <useparam name="pr_grp" />
                  </call>
                </call>
              </where>
            </grset>
            <grset as="[:p]dog">
              <where>
                <call function="and">
                  <call function="is not null">
                    <column table="this" column="kod_dog" />
                  </call>
                  <call function="or">
                    <call function="false" />
                    <call function="=1" optional="1">
                      <useparam name="pr_dog" />
                    </call>
                  </call>
                </call>
              </where>
              <group>
                <sourcelink table="kod_dog" />
              </group>
            </grset>
          </grset>
        </grset>
      </grset>
    </part>
  </parts>
  <views child-name="view" key-name="id">
    <view name="43125-deps-yms-view" file="sql.builder.templates\sql.builder\projects\43125\all\forms.xml">
      select listagg(case when yms_closed_count &gt; 0 then dep_name||': '||to_char(yms_closed_count) end,'; ') within group(order by dep_name) yms_closed_text,
      listagg(case when yms_with_data_count &gt; 0 then dep_name||': '||to_char(yms_with_data_count) end,'; ') within group(order by dep_name) yms_with_data_text,
      listagg(case when yms_without_data_count &gt; 0 then dep_name||': '||to_char(yms_without_data_count) end,'; ') within group(order by dep_name) yms_without_data_text 
      from
      (
      select dep,
      dep_name,
      count(case when is_closed = 1 then ym end) yms_closed_count,
      count(case when is_closed = 0 and has_data = 1 then ym end) yms_with_data_count,
      count(case when is_closed = 0 and has_data = 0 then ym end) yms_without_data_count
      from
      (
      select deps.dep,
      deps.dep_name,
      yms.ym,
      case when avans.dep is not null then 1 else 0 end has_data, 
      case when calcs.dep is not null then 1 else 0 end is_closed
      from 
      (
      select ym
      from
      (
      select to_number(to_char(dat_day,'YYYYMM'))/100 ym
      from vv_day
      )
      where ym between :ym_s and :ym_po 
      group by ym
      ) yms
      cross join 
      (   
      select kodp dep,
      sname dep_name  
      from kr_org 
      where kod_ecls = 4 and kod_separator = 2
      and kodp in :dep 
      ) deps
      left join 
      (
      select dep,
      ym
      from sr_avans_otch
      group by dep, ym
      ) avans 
      on avans.dep = deps.dep and avans.ym = yms.ym
      left join 
      (
      select podr dep,
      ym
      from kr_calc
      where pr_close = 1
      ) calcs 
      on calcs.dep = deps.dep and calcs.ym = yms.ym
      ) 
      group by dep, dep_name
      )
    </view>
    <view name="43125-yms" file="sql.builder.templates\sql.builder\projects\43125\all\forms.xml">
      select ym,
      rpad(to_char(ym),7,'0') name 
      from
      (
      select to_number(to_char(dat_day,'YYYYMM'))/100 ym
      from vv_day
      )
      where ym between 2017.01 and to_number(to_char(add_months(sysdate,3),'YYYYMM'))/100 
      group by ym
      order by ym desc
    </view>
  </views>
  <reports child-name="report" key-name="name" />
  <forms child-name="form" key-name="name">
    <form name="form_sr_avans_otch" title="Авансы для отчетов" timestamp="26.02.2018 19:54:53" with-behavior="0" file="sql.builder.templates\sql.builder\projects\43125\all\forms.xml">
      <content>
        <fieldgroup title="Условия">
          <field name="dep" controlType="UIList" title="Отделение" type="number" timestamp="13.05.2019 13:13:44" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" column-mandatory="1">
            <listquery>
              <query name="kr_dep" />
            </listquery>
            <defaultquery>
              <query name="kr_dep_current" />
            </defaultquery>
          </field>
          <fieldgroup title="Отчетный период" uncollapsible="1">
            <field controlType="UICombo" type="number" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" title="С" name="ym_s" column-mandatory="1">
              <defaultquery>
                <query name="spr_time_ym_cur" />
              </defaultquery>
              <listquery>
                <query name="43125-yms" />
              </listquery>
            </field>
            <field controlType="UICombo" type="number" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="ym_po" title="По" column-mandatory="1">
              <defaultquery>
                <query name="spr_time_ym_cur" />
              </defaultquery>
              <listquery>
                <query name="43125-yms" />
              </listquery>
            </field>
          </fieldgroup>
        </fieldgroup>
        <fieldgroup title="Данные" uncollapsible="1">
          <grid table="sr_avans_otch" show-toolbar="1">
            <toolbar>
              <uicommand button-type="grid-copy" column-visible="0" />
              <uicommand button-type="grid-add" column-visible="0" />
              <uicommand button-type="grid-delete" column-visible="0" />
              <uicommand button-type="grid-save" column-visible="0" />
              <uicommand title="Расчёт" action-type="custom" visible="kod_av" visible-invert="1" editable="dep">
                <useaction name="sg_avans.sp_rasch_avans_otch" editable="can_create_sf" width-perc="50" title="Создать счет">
                  <useparam name="dep" />
                  <useparam name="ym_s" />
                  <useparam name="ym_po" />
                </useaction>
                <useaction name="43125_mview_refresh" />
                <useaction action-type="refresh-table" object="sr_avans_otch" />
                <useaction action-type="refresh-table" object="a" />
              </uicommand>
              <uicommand title="Перерасчёт" action-type="custom" visible="kod_av" prompt="Вы уверены, что хотите пересчитать авансы по выбранным условиям?" editable="dep">
                <useaction name="sg_avans.sp_rasch_avans_otch" editable="can_create_sf" width-perc="50" title="Создать счет">
                  <useparam name="dep" />
                  <useparam name="ym_s" />
                  <useparam name="ym_po" />
                </useaction>
                <useaction name="43125_mview_refresh" />
                <useaction action-type="refresh-table" object="sr_avans_otch" />
                <useaction action-type="refresh-table" object="a" />
              </uicommand>
            </toolbar>
            <columns>
              <column table="sr_avans_otch" column="kod_av" column-visible="0" parname="kod_av" column-editable="0" />
              <column table="kr_org" column="sname" title="Отделение" column-editable="0" />
              <column table="sr_avans_otch" column="ym" title="Отчётный период" column-editable="0" format="F2" />
              <column table="kr_dogovor" column="ndog" column-editable="0" />
              <column table="kr_payer" column="nump" title="Код абонента" column-editable="0" />
              <column table="kr_payer" column="name" title="Наименование абонента" column-editable="0" />
              <column table="sr_avans_otch" column="avans" title="Сумма аванса" format="N2" column-editable="0" />
              <column table="sr_avans_otch" column="rym" title="Под период" column-editable="0" format="F2" />
              <column table="sr_avans_otch" column="period" title="Период" column-editable="0" />
              <column table="sk_vid_avans" column="name" title="Вид аванса" column-editable="0" as="av_name" />
              <column table="sr_avans_otch" column="perc" title="Процент аванса" column-editable="0" format="F0" />
              <column table="sr_avans_otch" column="dat_priem" title="Дата приёмки" column-editable="0" />
              <column table="sr_avans_otch" column="day" title="День выставления" column-editable="0" format="F0" />
            </columns>
          </grid>
        </fieldgroup>
        <fieldgroup title="Сводная информация">
          <column table="a" column="yms_closed_text" title="Кол-во закрытых периодов" column-editable="0" />
          <column table="a" column="yms_with_data_text" title="Кол-во расчитанных периодов" column-editable="0" />
          <column table="a" column="yms_without_data_text" title="Кол-во нерасчитанных периодов" column-editable="0" />
        </fieldgroup>
      </content>
      <from star-scheme="1">
        <query name="sr_avans_otch" order="sname, ym desc, ndog, rym" auto-refresh="1">
          <where>
            <call function="and">
              <call function="in">
                <column table="sr_avans_otch" column="dep" />
                <useparam name="dep" />
              </call>
              <call function="ge">
                <column table="sr_avans_otch" column="ym" />
                <useparam name="ym_s" />
              </call>
              <call function="le">
                <column table="sr_avans_otch" column="ym" />
                <useparam name="ym_po" />
              </call>
            </call>
          </where>
          <link name="kod_dog" as="kr_dogovor">
            <link name="kodp" as="kr_payer" />
          </link>
          <link name="vid_avans" as="sk_vid_avans" />
          <link name="dep" as="kr_org" />
        </query>
        <query name="43125-deps-yms" auto-refresh="1" as="a">
          <withparams>
            <useparam name="dep" />
            <useparam name="ym_s" />
            <useparam name="ym_po" />
          </withparams>
        </query>
      </from>
    </form>
    <form name="43125" with-behavior="0">
      <content>
        <field name="dep" controlType="UIList" title="Отделение" type="number" timestamp="13.05.2019 13:13:44" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" visible="1">
          <listquery>
            <query name="kr_dep" />
          </listquery>
          <defaultquery>
            <query name="kr_dep_current" />
          </defaultquery>
        </field>
        <field name="m3" controlType="UICombo" type="number" title="Отчетный период" mandatory="1" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" visible="1">
          <defaultquery>
            <query name="spr_time_ym_cur" />
          </defaultquery>
          <listquery>
            <query name="43125-yms" />
          </listquery>
        </field>
        <field type="number" name="kod_group_cust_parent" controlType="UIList" name-field-name="name" title="Группа потребителей" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" visible="1">
          <listquery>
            <query name="ks_group_cust_parent_list" />
          </listquery>
        </field>
        <field type="number" name="kod_group_cust" controlType="UIList" name-field-name="name" title="Подгруппа потребления" timestamp="18.11.2016 16:28:06" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" visible="1">
          <listquery>
            <query name="ks_group_cust_list" />
          </listquery>
        </field>
        <field controlType="UIList" title="Договор" name="kod_dog" type="number" rows-limit="100" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" visible="1">
          <listquery>
            <query name="kr_dogovor_list_active" />
          </listquery>
        </field>
        <fieldgroup title="Выводить строки">
          <field controlType="UICheck" checked="0" type="number" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="pr_itog" title="Итог" visible="1">
            <defaultquery>
              <query name="true" />
            </defaultquery>
          </field>
          <field controlType="UICheck" checked="0" type="number" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="pr_dep" title="По отделениям" visible="1">
            <defaultquery>
              <query name="true" />
            </defaultquery>
          </field>
          <field controlType="UICheck" checked="0" type="number" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="pr_grp_prnt" title="По группам потребления" visible="1">
            <defaultquery>
              <query name="true" />
            </defaultquery>
          </field>
          <field controlType="UICheck" checked="0" type="number" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="pr_grp" title="По подгруппам потребления" visible="1">
            <defaultquery>
              <query name="true" />
            </defaultquery>
          </field>
          <field controlType="UICheck" checked="0" type="number" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="pr_dog" title="По договорам" visible="1">
            <defaultquery>
              <query name="true" />
            </defaultquery>
          </field>
        </fieldgroup>
        <field name="m0" controlType="UICombo" type="number" title="Начало года" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" column-visible="0" visible="1">
          <listquery>
            <query name="kr_calc_list"></query>
          </listquery>
          <defaultquery>
            <query name="43125-m0-val" />
          </defaultquery>
        </field>
        <field name="m1" controlType="UICombo" type="number" title="Начало квартала" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" column-visible="0" visible="1">
          <listquery>
            <query name="kr_calc_list"></query>
          </listquery>
          <defaultquery>
            <query name="43125-m1-val" />
          </defaultquery>
        </field>
        <field name="m2" controlType="UICombo" type="number" title="Прошлый месяц" file="sql.builder.templates\sql.builder\projects\asuse2_ipr\param_fields_asuse.xml" column-visible="0" visible="1">
          <listquery>
            <query name="kr_calc_list"></query>
          </listquery>
          <defaultquery>
            <query name="43125-m2-val" />
          </defaultquery>
        </field>
        <field controlType="UIText" type="string" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="spry" column-visible="0" visible="1">
          <defaultquery>
            <query name="43125-spry-val" />
          </defaultquery>
        </field>
        <field controlType="UIText" type="string" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sm0" column-visible="0" visible="1">
          <defaultquery>
            <query name="43125-sm0-val" />
          </defaultquery>
        </field>
        <field controlType="UIText" type="string" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="smp1" column-visible="0" visible="1">
          <defaultquery>
            <query name="43125-smp1-val" />
          </defaultquery>
        </field>
        <field controlType="UIText" type="string" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sm2" column-visible="0" visible="1">
          <defaultquery>
            <query name="43125-sm2-val" />
          </defaultquery>
        </field>
        <field controlType="UIText" type="string" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sm3" column-visible="0" visible="1">
          <defaultquery>
            <query name="43125-sm3-val" />
          </defaultquery>
        </field>
        <field controlType="UIText" type="string" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="smp3" column-visible="0" visible="1">
          <defaultquery>
            <query name="43125-smp3-val" />
          </defaultquery>
        </field>
        <field controlType="UIText" type="string" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sm4" column-visible="0" visible="1">
          <defaultquery>
            <query name="43125-sm4-val" />
          </defaultquery>
        </field>
        <field controlType="UIText" type="string" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="smp4" column-visible="0" visible="1">
          <defaultquery>
            <query name="43125-smp4-val" />
          </defaultquery>
        </field>
        <field controlType="UIText" type="string" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sm5" column-visible="0" visible="1">
          <defaultquery>
            <query name="43125-sm5-val" />
          </defaultquery>
        </field>
        <field controlType="UIText" type="string" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="smp5" column-visible="0" visible="1">
          <defaultquery>
            <query name="43125-smp5-val" />
          </defaultquery>
        </field>
        <field controlType="UIText" type="string" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="sdep" column-visible="0" visible="1">
          <defaultquery>
            <query name="43125-sdep-val" />
          </defaultquery>
        </field>
        <field controlType="UIList" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="dog_filter_m" visible="0">
          <defaultquery>
            <query name="43125-dog_filter_m" />
          </defaultquery>
          <listquery>
            <query name="43125-dog_filter_m" />
          </listquery>
        </field>
        <field controlType="UIList" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="dog_filter_g" visible="0">
          <defaultquery>
            <query name="43125-dog_filter_g" />
          </defaultquery>
          <listquery>
            <query name="43125-dog_filter_g" />
          </listquery>
        </field>
        <field controlType="UIList" file="sql.builder.templates\sql.builder\projects\common\param_fields_common.xml" name="dog_filter_k" visible="0">
          <defaultquery>
            <query name="43125-dog_filter_k" />
          </defaultquery>
          <listquery>
            <query name="43125-dog_filter_k" />
          </listquery>
        </field>
        <field name="colsets" controlType="UIList" special-type="colsets" title="Колонки" type="string" column-visible="0" visible="1">
          <defaultquery>
            <query name="43125-cols-def" />
          </defaultquery>
        </field>
        <label />
        <label title="Некоторые данные в отчете" />
        <label title="могут учитываться по" />
        <label title="состоянию на вчерашний день" />
        <label />
        <uicommand name="vg_mview.refresh_43125" title="Обновить хранилище" is-ret="0" message="Хранилище обновлено" />
      </content>
    </form>
  </forms>
  <datatypes />
  <editors />
  <folders />
  <globalparams child-name="param" key-name="name" />
  <!--<globalconsts child-name="globalconst" key-name="name">
  </globalconsts>-->
  <expression-packages child-name="expression-package" key-name="name" />
  <dimension-packages child-name="dimension-package" key-name="name" />
  <security-packages child-name="security-package" key-name="name" />
  <color-packages child-name="color-package" key-name="name" />
  <format-packages child-name="format-package" key-name="name" />
  <button-types child-name="button-type" key-name="name" />
  <!--раздел qlikview организовать по аналогии с остальными вместо qlikview/customer/@id   дать имена   qwprojects/qwproject/@customer-->
  <qvprojects />
  <!--<images>
    <image char="" name="link" />
    <image char="" name="dlink" rotate-flip="RotateNoneFlipY"/>
    <image char="" name="call"/>
    <image char="" name="column"/>
  </images>
  <eltypes>
    <eltype  name="vcall" image="call"/>
    <eltype  name="vlink" image="link"/>
    <eltype  name="vdink" image="dlink"/>
    <eltype  name="vcolumn" image="column"/>
  </eltypes>-->
  <fields child-name="field" key-name="id" />
  <actions child-name="action" key-name="name">
    <action name="43125_mview_refresh" title="Обновление хранилища" action-type="call-plsql" timestamp="26.02.2018 16:53:08" file="sql.builder.templates\sql.builder\projects\43125\all\actions.xml">
      <text>
        begin
        vg_mview.refresh('vv_sr_aotch_norm_av');
        vg_mview.refresh('vv_sr_aotch_norm_av_no');
        end;
      </text>
    </action>
    <action name="vg_mview.refresh_43125" action-type="call-plsql" title="Обновить хранилище" is-ret="0" timestamp="20.05.2025 03:25:09" file="sql.builder.templates\sql.builder\projects\43125\all\actions.xml">
      <params>
        <param name="kod_dog" type="number" />
        <param name="sum_gp" type="number" />
        <param name="num_delo" type="string" />
        <param name="ym" type="number" />
        <param name="dat" type="date" />
        <param name="kod_izv" type="number" is-ret="1" />
      </params>
      <text><![CDATA[begin

vg_mview.refresh('VV_SR_AOTCH_NORM_AV');
vg_mview.refresh('VV_SR_AOTCH_NORM_AV_NO');

end;]]></text>
    </action>
    <action name="sg_avans.sp_rasch_avans_otch" title="Расчет авансов для накопительной" action-type="call-plsql" timestamp="31.01.2018 18:05:09" file="sql.builder.templates\sql.builder\projects\43125\all\forms.xml">
      <params>
        <param name="dep" type="array" />
        <param name="ym_s" type="number" />
        <param name="ym_po" type="number" />
      </params>
      <text>
        declare
        nerr number :=0;
        nclosed number;
        begin

        for deps in (select kodp from kr_org where kodp in :dep )
        loop
        for yms in
        (
        select ym
        from
        (
        select to_number(to_char(dat_day,'YYYYMM'))/100 ym
        from vv_day
        )
        where ym between :ym_s and :ym_po 
        group by ym
        order by ym
        )
        loop
        select count(1) into nclosed from kr_calc where podr = deps.kodp and ym = yms.ym and pr_close = 1;
        if(nclosed = 0) then
        sg_avans.sp_rasch_avans_otch(dpusk=&gt; sysdate, nym=&gt; yms.ym , n_podr=&gt; deps.kodp , nerr=&gt; nerr);
        if(nerr != 0) then 
        return; 
        end if;
        end if;
        end loop;
        end loop; 	     
  	    end;
      </text>
    </action>
  </actions>
  <navigators child-name="navigator" key-name="name" />
  <projects child-name="project" key-name="name" />
</root>