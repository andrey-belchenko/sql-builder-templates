<?xml version="1.0" encoding="utf-8"?>
<root>
  <parts>
    <part id="26630-params" timestamp="23.01.2018 15:07:46">
      <param name="kod_doc" type="number">
        <const>143403</const>
      </param>
      <param name="year" type="number">
        <const>2017</const>
      </param>
      <param name="period" type="array" />
      <param name="pr_child" type="number">
        <const>1</const>
      </param>
      <param name="pr_sbor" type="number" />
      <param name="pr_zatrat" type="number" />
      <param name="pr_dog" type="number" />
      <param name="kod_titul_ip" type="array" />
      <param name="kod2_titul_ip" type="array" />
      <param name="mon1" type="number">
        <const>1</const>
      </param>
      <param name="mon2" type="number">
        <const>12</const>
      </param>
      <param name="kod_dirisp" type="number">
        <const>1</const>
      </param>
      <param name="kod_subject" type="array" />
      <param name="kod_direct" type="array">
        <const>21</const>
      </param>
      <param name="mp" type="number">
        <const>-3</const>
      </param>
      <param name="pr_notaip" type="number" />
      <param name="pr_all_fact" type="number" />
      <param name="pr_all_fact_not" type="number" />
      <param name="kod_ofz" type="array" />
      <param name="pr_gorobl" type="number" />
      <param name="pr_tek_smet" type="number" />
      <param name="pr_no_zero" type="number" />
      <param name="pr_pf_gr" type="number" />
    </part>
    <part id="26630-withparams" timestamp="02.02.2017 19:50:03">
      <useparam name="kod_doc" />
      <useparam name="year" />
      <useparam name="period" />
      <useparam name="pr_child" />
      <useparam name="pr_sbor" />
      <useparam name="pr_zatrat" />
      <useparam name="pr_dog" />
      <useparam name="kod_titul_ip" />
      <useparam name="kod2_titul_ip" />
      <useparam name="mon1" />
      <useparam name="mon2" />
      <useparam name="kod_dirisp" />
      <useparam name="kod_subject" />
      <useparam name="kod_direct" />
      <useparam name="mp" />
      <useparam name="pr_notaip" />
      <useparam name="pr_all_fact" />
      <useparam name="pr_all_fact_not" />
      <useparam name="kod_ofz" />
      <useparam name="pr_gorobl" />
      <useparam name="pr_tek_smet" />
      <useparam name="pr_no_zero" />
      <useparam name="pr_pf_gr" />
    </part>
    <part id="26630-smet-cond">
      <call function="and">
        <call function="=">
          <call function="nvlu">
            <useparam name="pr_zatrat" />
            <const>0</const>
          </call>
          <const>1</const>
        </call>
        <call function="in">
          <column table="a" column="kod_smet" />
          <array>1,2,3,4</array>
        </call>
      </call>
    </part>
    <part id="26630-zt-cond">
      <call function="and">
        <call function="=">
          <call function="nvlu">
            <useparam name="pr_zatrat" />
            <const>0</const>
          </call>
          <const>1</const>
        </call>
        <call function="=">
          <column table="a" column="zatr_parent" />
          <const>52</const>
        </call>
      </call>
    </part>
    <part id="26630-dog-cond">
      <call function="and">
        <call function="=">
          <call function="nvlu">
            <useparam name="pr_dog" />
            <const>0</const>
          </call>
          <const>1</const>
        </call>
        <call function="is not null">
          <column table="a" column="kod_dog_i" />
        </call>
      </call>
    </part>
    <part id="26630-common-columns" timestamp="02.11.2016 18:04:14">
      <column table="a" column="kod_ipr" exclude="1" />
      <column table="kod_main_titul" column="kod_sbor_titul" group="6" />
      <column table="kod_sbor_titul" column="kod_titul_ip" as="kod_titul_ip_sb" group="kod_sbor_titul" />
      <column table="kod_sbor_titul" column="kod_sbor_titul" as="kod_sbor_titul_sb" group="kod_sbor_titul" />
      <column table="kod_titul_ip_sbor" column="tit_num_new" as="tit_num_new_sbor" group="kod_sbor_titul" title="Код сборного титула" />
      <column table="kod_titul_ip_sbor" column="full_name" as="full_name_sbor" group="kod_sbor_titul" title="Наименование сборного титула" />
      <column table="kod_razdel" column="path" group="kod_sbor_titul" />
      <column table="kod_main_titul" column="kod_titul_ip" group="1" as="kod_main_titul" />
      <column table="kod_status" column="name" as="st_name" group="max" title="Статус титула" />
      <column table="ipr_ipr_data" column="kod_doc_osn" group="max" exclude="1" />
      <column table="ipr_ipr_data" column="pr_last" group="max" exclude="1" />
      <column table="kod_main_titul" column="tit_num_new" as="tit_num_new_main" group="kod_main_titul" />
      <column table="kod_main_titul" column="full_name" as="full_name_main" group="kod_main_titul" title="Наименование головного/одиночного титула" />
      <column table="kod_main_titul" column="is_head_tit" group="kod_main_titul" />
      <column table="kod_ipr_ext" column="kod_child_titul" group="5" />
      <column table="kod_ipr_ext" column="kod_parent" group="kod_child_titul" />
      <column table="kod_titul_ip" column="tit_num_new" group="kod_child_titul" title="Код дочернего титула" />
      <column table="kod_titul_ip" column="full_name" as="full_name_child" group="kod_child_titul" title="Наименование дочернего титула" />
      <column table="kod_direct_main" column="name" as="direct_name_main" group="kod_main_titul" />
      <column table="kod_ispolnit_main" column="name" as="ispolnit_name_main" group="kod_main_titul" />
      <column table="kod_subject_main" column="name" as="subject_name_main" group="kod_main_titul" />
      <column table="kod_direct" column="name" as="direct_name" group="kod_child_titul" />
      <column table="kod_ispolnit" column="name" as="ispolnit_name" group="kod_child_titul" />
      <column table="a" column="ym" />
      <call function="if" as="go_grp" group="7" title="Группа">
        <call function="=">
          <call function="nvlu">
            <useparam name="pr_gorobl" />
            <const>0</const>
          </call>
          <const>0</const>
        </call>
        <const>'СПб и ЛО'</const>
        <column table="kod_subject_main" column="abbr" />
      </call>
      <call function="time ym2 id" as="ym_id" group="8">
        <column table="a" column="ym" />
      </call>
      <call function="time y k id" as="kv_id" group="11">
        <call function="ym2 god">
          <column table="a" column="ym" />
        </call>
        <call function="ym2 to kv">
          <column table="a" column="ym" />
        </call>
      </call>
      <call function="if" as="m6_id" group="12">
        <call function="le">
          <call function="ym2 mes">
            <column table="a" column="ym" />
          </call>
          <const>6</const>
        </call>
        <call function="time y k id">
          <call function="ym2 god">
            <column table="a" column="ym" />
          </call>
          <const>5</const>
        </call>
      </call>
      <call function="if" as="m9_id" group="13">
        <call function="le">
          <call function="ym2 mes">
            <column table="a" column="ym" />
          </call>
          <const>9</const>
        </call>
        <call function="time y k id">
          <call function="ym2 god">
            <column table="a" column="ym" />
          </call>
          <const>6</const>
        </call>
      </call>
      <call function="time ym2 id" as="ym_nxt_id" group="14">
        <column table="a" column="ym_nxt" />
      </call>
      <call function="if" as="op_id" group="15" type="number">
        <call function="between">
          <column table="a" column="ym" />
          <call function="num to ym2">
            <useparam name="year" />
            <useparam name="mon1" />
          </call>
          <call function="num to ym2">
            <useparam name="year" />
            <useparam name="mon2" />
          </call>
        </call>
        <const>0</const>
      </call>
      <call function="case" as="pr_check_plan_fact" title="Группа" type="number">
        <call function="when">
          <call function="is not null">
            <column table="check_pl_ft" column="pr_plan" />
          </call>
          <const>1</const>
        </call>
        <call function="when">
          <call function="and">
            <call function="is null">
              <column table="check_pl_ft" column="pr_plan" />
            </call>
            <call function="is not null">
              <column table="check_pl_ft" column="pr_fact" />
            </call>
          </call>
          <const>2</const>
        </call>
        <call function="when">
          <call function="and">
            <call function="is null">
              <column table="check_pl_ft" column="pr_plan" />
            </call>
            <call function="is null">
              <column table="check_pl_ft" column="pr_fact" />
            </call>
          </call>
          <const>3</const>
        </call>
      </call>
      <call function="if" as="gr_check_plan_fact" group="16" title="Группа" type="number">
        <call function="or">
          <call function="false" />
          <call function="=1" optional="1">
            <useparam name="pr_pf_gr" />
          </call>
        </call>
        <column table="this" column="pr_check_plan_fact" />
        <const>0</const>
      </call>
      <call function="decode" as="gr_check_plan_fact_name" group="gr_check_plan_fact" title="Группа" type="string">
        <column table="this" column="gr_check_plan_fact" />
        <const>0</const>
        <const>'Все'</const>
        <const>1</const>
        <const>'1. Титулы, имеющие плановые экономические или физические параметры'</const>
        <const>2</const>
        <const>'2. Титулы, не имеющие плановых экономических или физических параметров, но имеющие фактические плановые экономические или физические параметры'</const>
        <const>3</const>
        <const>'3. Не имеющие плановых экономических или физических параметров, а также не имеющие фактических плановых экономических или физических параметров'</const>
      </call>
    </part>
    <part id="26630-if-all">
      <if title=" за отчетный период">
        <call function="between">
          <column table="a" column="ym" />
          <call function="num to ym2">
            <useparam name="year" />
            <useparam name="mon1" />
          </call>
          <call function="num to ym2">
            <useparam name="year" />
            <useparam name="mon2" />
          </call>
        </call>
      </if>
    </part>
    <part id="26630-if-god">
      <if title=" за год">
        <call function="=">
          <column table="a" column="year" />
          <useparam name="year" />
        </call>
      </if>
    </part>
    <part id="26630-if-ng">
      <section title=" на начало отчетного периода" pfx="_ng">
        <call function="ym2 add month">
          <call function="num to ym2">
            <useparam name="year" />
            <useparam name="mon1" />
          </call>
          <const>-1</const>
        </call>
      </section>
    </part>
    <part id="26630-if-eg">
      <section title=" на конец отчетного периода" pfx="_eg">
        <call function="num to ym2">
          <useparam name="year" />
          <useparam name="mon2" />
        </call>
      </section>
    </part>
    <part id="26630-dim-period">
      <pivot title=" по периодам">
        <call function="between">
          <column table="a" column="ym" />
          <column table="dim" column="ym1" />
          <column table="dim" column="ym2" />
        </call>
        <query>
          <select>
            <column table="a" column="in_year_id" />
            <column table="a" column="name" />
            <call function="date to ym2" as="ym1">
              <column table="a" column="date_begin" />
            </call>
            <call function="date to ym2" as="ym2">
              <column table="a" column="date_end" />
            </call>
          </select>
          <from>
            <query name="26630_time_intervals" as="a">
              <withparams>
                <useparam name="year" />
                <useparam name="mon1" />
                <useparam name="mon2" />
              </withparams>
            </query>
          </from>
          <where>
            <call function="in">
              <column table="a" column="kod" />
              <useparam name="period" />
            </call>
          </where>
        </query>
      </pivot>
    </part>
  </parts>
  <forms>
    <form name="26630" timestamp="14.06.2018 17:45:22" with-behavior="0">
      <content>
        <field name="year" type="number" controlType="UICombo" title="Год" mandatory="1">
          <listquery>
            <query name="25499-year_list" />
          </listquery>
          <defaultquery>
            <query name="25499-year_def" />
          </defaultquery>
        </field>
        <field name="mon1" type="number" controlType="UICombo" title="С месяца" mandatory="1">
          <listquery>
            <query name="spr_time_mes" />
          </listquery>
        </field>
        <field name="mon2" type="number" controlType="UICombo" title="По месяц" mandatory="1">
          <listquery>
            <query name="spr_time_mes" />
          </listquery>
          <defaultquery>
            <query name="26630_mon_def" />
          </defaultquery>
        </field>
        <field name="period" type="number" controlType="UIList" title="Выделять периоды" parent-field-name="kod_parent" show-nulls="0">
          <listquery>
            <query name="26630_time_intervals" />
          </listquery>
          <defaultquery>
            <query name="26630_time_intervals_def" />
          </defaultquery>
        </field>
        <usepart part="25499-fields" />
        <field name="pr_notaip" type="number" controlType="UICheck" title="Исключить титулы АИП" />
        <field name="kod_titul_ip"  type="number" controlType="UIList" title="Титул" parent-field-name="kod_parent_node" val-field-name="kod_titul_ip" expand-all="1">
          <buttons>
            <uicommand action-type="show-popup" side="Left" type="Combo" title="Показать" />
            <menu title="save/load" side="Right">
              <uicommand action-type="save-field-to-clipboard" title="Копировать" notification="Параметры скопированы." />
              <uicommand action-type="fill-field-from-clipboard" title="Вставить" />
            </menu>
          </buttons>
          <listquery>
            <query name="26630_tituls" />
          </listquery>
        </field>
        <field name="kod2_titul_ip" type="number" controlType="UIList" title="Дочерний/Одиночный титул" visible="0">
          <listquery>
            <query name="26630_list_ipr_data_default" />
          </listquery>
          <defaultquery>
            <query name="26630_list_ipr_data_default" />
          </defaultquery>
        </field>
        <field name="pr_zatrat" type="number" controlType="UICheck" title="Детализация по видам затрат" />
        <field name="pr_dog" type="number" controlType="UICheck" title="Детализация по договорам" />
        <field name="mp" type="number" controlType="UICombo" title="Денежная единица" mandatory="1">
          <listquery>
            <query name="26630-mp" />
          </listquery>
        </field>
        <field name="colsets" type="string" controlType="UIList" title="План/Ожидаемый факт/Факт" special-type="colsets">
          <defaultquery>
            <query name="26630-cols" />
          </defaultquery>
        </field>
        <field name="pr_all_fact" type="number" controlType="UICheck" title="Вывод факта не зависимо от версии ИПР" />
        <field name="pr_all_fact_not"  type="number" controlType="UICheck" title="Вывод факта только для выбранной версии ИПР" visible="0">
          <defaultquery>
            <query name="26630-pr_all_fact_not-default_1" />
          </defaultquery>
        </field>
        <usefield field="ipr_kod_ofz" />
        <field name="pr_gorobl" type="number" controlType="UICheck" title="Город/область" />
        <field name="pr_tek_smet" type="number" controlType="UICheck" title="Тек. смет. стоимость вместо фикс." />
        <field name="pr_no_zero" type="number" controlType="UICheck" title="Не отображать титулы с нулевыми данными" />
        <field name="pr_pf_gr" type="number" controlType="UICheck" title="Группировать по плановым и внеплановым титулам" />
      </content>
    </form>
  </forms>
  <reports>
    <report name="26630-old2" title="Отчет по исполнителю" form="26630" folder="invpro" edit-columns="2" visible="0" timestamp="03.01.2017 19:54:31" use-repository="1" datareader="1" nogrid="1" save-compiled="1">
      <params>
        <usepart part="26630-params" />
      </params>
      <print-templates>
        <excel>
          <template name="26630.xml" title="Отчет по исполнителю" del-cols="1" print-xlsx="1" print-proc="2" output-format="xlsb" />
        </excel>
      </print-templates>
      <customers>
        <customer id="17" />
      </customers>
      <queries>
        <query name="26630-dat-grsets" as="a" title="Главный">
          <withparams>
            <usepart part="26630-withparams" />
          </withparams>
        </query>
        <query name="26630-dat-grsets-vvod" as="vv" title="Ввод">
          <withparams>
            <usepart part="26630-withparams" />
          </withparams>
        </query>
        <query name="form:26630" as="b" title="Параметры" />
      </queries>
    </report>
    <!--<report name="26630-old" title="Отчет по исполнителю(старый)" form="26630" >
      <params>
        <usepart part="26630-params"/>
      </params>
      <print-templates>
        <excel>
          <template name="26630.xml" title="Отчет по исполнителю"  del-cols="1" print-proc="2"/>
        </excel>
      </print-templates>
      <customers>
        <customer id="17"/>
      </customers>
      <queries>
        <query name="26630-itog" as="i" title="Итого">
          <withparams>
            <usepart part="26630-withparams"/>
          </withparams>
        </query>
        <query name="26630-itog-by-smet" as="ism" title="Итого по статьям сметы">
          <withparams>
            <usepart part="26630-withparams"/>
          </withparams>
        </query>
        <query name="26630-itog-by-pr-zatr" as="izt" title="Итого по прочим затратам">
          <withparams>
            <usepart part="26630-withparams"/>
          </withparams>
        </query>


        <query name="26630-by-sbor-titul" as="ist" title="По сборным, головным, одиночным титулам" main="1">
          <withparams>
            <usepart part="26630-withparams"/>
          </withparams>
          <query name="26630-sbor-by-titul" as="stst" title="По сборному титулу">
            <withparams>
              <usepart part="26630-withparams"/>
            </withparams>
            <call function="=">
              <column table="ist" column="kod_sbor_titul"/>
              <column table="stst" column="kod_sbor_titul"/>
            </call>
            <query name="26630-sbor-by-smet" as="stsm" title="По статьям сметы">
              <withparams>
                <usepart part="26630-withparams"/>
              </withparams>
              <call function="=">
                <column table="stst" column="kod_sbor_titul"/>
                <column table="stsm" column="kod_sbor_titul"/>
              </call>
            </query>
            <query name="26630-sbor-by-pr-zatr" as="stzt" title="По прочим затратам">
              <withparams>
                <usepart part="26630-withparams"/>
              </withparams>
              <call function="=">
                <column table="stst" column="kod_sbor_titul"/>
                <column table="stzt" column="kod_sbor_titul"/>
              </call>
            </query>
          </query>
          <query name="26630-by-titul" as="sttt" title="По одиночным и головным титулам" main="1">
            <withparams>
              <usepart part="26630-withparams"/>
            </withparams>
            <call function="=">
              <column table="ist" column="kod_sbor_titul"/>
              <column table="sttt" column="kod_sbor_titul"/>
            </call>
            <query name="26630-by-smet" as="ttsm" title="По статьям сметы">
              <withparams>
                <usepart part="26630-withparams"/>
              </withparams>
              <call function="=">
                <column table="sttt" column="kod_main_titul"/>
                <column table="ttsm" column="kod_main_titul"/>
              </call>
            </query>
            <query name="26630-by-pr-zatr" as="ttzt" title="По прочим затратам">
              <withparams>
                <usepart part="26630-withparams"/>
              </withparams>
              <call function="=">
                <column table="sttt" column="kod_main_titul"/>
                <column table="ttzt" column="kod_main_titul"/>
              </call>
            </query>
            <query name="26630-by-dog-sum" as="ttad" title="По договорам(сумма)">
              <withparams>
                <usepart part="26630-withparams"/>
              </withparams>
              <call function="=">
                <column table="sttt" column="kod_main_titul"/>
                <column table="ttad" column="kod_main_titul"/>
              </call>
            </query>
            <query name="26630-by-dog" as="ttdg" title="По договорам">
              <withparams>
                <usepart part="26630-withparams"/>
              </withparams>
              <call function="=">
                <column table="sttt" column="kod_main_titul"/>
                <column table="ttdg" column="kod_main_titul"/>
              </call>
            </query>
            <query name="26630-by-child-titul" as="ttct" title="По дочерним титулам">
              <withparams>
                <usepart part="26630-withparams"/>
              </withparams>
              <call function="=">
                <column table="sttt" column="kod_main_titul"/>
                <column table="ttct" column="kod_main_titul"/>
              </call>
              <query name="26630-child-by-smet" as="ctsm" title="По статьям сметы">
                <withparams>
                  <usepart part="26630-withparams"/>
                </withparams>
                <call function="=">
                  <column table="ttct" column="kod_child_titul"/>
                  <column table="ctsm" column="kod_child_titul"/>
                </call>
              </query>
              <query name="26630-child-by-pr-zatr" as="ctzt" title="По прочим затратам">
                <withparams>
                  <usepart part="26630-withparams"/>
                </withparams>
                <call function="=">
                  <column table="ttct" column="kod_child_titul"/>
                  <column table="ctzt" column="kod_child_titul"/>
                </call>
              </query>
              <query name="26630-child-by-dog-sum" as="ctad" title="По договорам(сумма)">
                <withparams>
                  <usepart part="26630-withparams"/>
                </withparams>
                <call function="=">
                  <column table="ttct" column="kod_child_titul"/>
                  <column table="ctad" column="kod_child_titul"/>
                </call>
              </query>
              <query name="26630-child-by-dog" as="ctdg" title="По договорам">
                <withparams>
                  <usepart part="26630-withparams"/>
                </withparams>
                <call function="=">
                  <column table="ttct" column="kod_child_titul"/>
                  <column table="ctdg" column="kod_child_titul"/>
                </call>
              </query>
            </query>
          </query>
        </query>


      </queries>
    </report>-->
  </reports>
  <queries>
    <query name="26630-mp">
      <const as="kod_mp" type="number">-6</const>
      <const as="name" type="string">'млн. руб.'</const>
      <const>-3</const>
      <const>'тыс. руб.'</const>
      <const>0</const>
      <const>'руб.'</const>
    </query>
    <query name="26630-cols">
      <const as="id" type="string">'План'</const>
      <const as="name" type="string">'План'</const>
      <const>'Факт'</const>
      <const>'Факт'</const>
    </query>
    <query name="26630_time_intervals_def">
      <params>
        <param name="year" type="number" />
        <param name="mon1" type="number" />
        <param name="mon2" type="number" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26630_time_intervals" as="a">
          <withparams>
            <useparam name="year" />
            <useparam name="mon1" />
            <useparam name="mon2" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="le">
            <call function="date to ym2">
              <column table="a" column="date_end" />
            </call>
            <call function="num to ym2">
              <useparam name="year" />
              <useparam name="mon2" />
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="26630_time_intervals" order="date_end,date_begin desc">
      <params>
        <param name="year" type="number" />
        <param name="mon1" type="number" />
        <param name="mon2" type="number" />
      </params>
      <select>
        <call function="if" as="kod" type="number" key="1">
          <call function="!=">
            <column table="a" column="time_type" />
            <const>'Год'</const>
          </call>
          <column table="a" column="kod" />
          <const>0</const>
        </call>
        <call function="if" as="name" type="string">
          <call function="!=">
            <column table="a" column="time_type" />
            <const>'Год'</const>
          </call>
          <column table="a" column="name" />
          <const>'Год'</const>
        </call>
        <column table="a" column="kod_parent" />
        <column table="a" column="time_type" title="" />
        <column table="a" column="in_year_id" />
        <!--<column table="a" column="period_id"/>-->
        <column table="a" column="date_begin" />
        <column table="a" column="date_end" />
      </select>
      <from>
        <query name="spr_time_intervals1" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="ge">
            <call function="date to ym2">
              <column table="a" column="date_begin" />
            </call>
            <call function="num to ym2">
              <useparam name="year" />
              <useparam name="mon1" />
            </call>
          </call>
          <call function="le">
            <call function="date to ym2">
              <column table="a" column="date_begin" />
            </call>
            <call function="num to ym2">
              <useparam name="year" />
              <useparam name="mon2" />
            </call>
          </call>
          <!--<call function="!=">
            <column table="a" column="time_type" />
            <const>'Год'</const>
          </call>-->
        </call>
      </where>
    </query>
    <query name="26630_mon_def">
      <select>
        <const as="mon" type="number">12</const>
      </select>
      <from>
        <table name="dual" as="a" />
      </from>
    </query>
    <query name="26630_tituls" timestamp="13.07.2017 14:09:18">
      <params>
        <param name="kod_doc" type="number">
          <const>143404</const>
        </param>
        <param name="kod_subject" type="array" />
        <param name="kod_direct" type="array" />
        <param name="pr_sbor" type="number" />
        <param name="pr_child" type="number" />
        <param name="kod_dirisp" type="number" />
        <param name="kod_ofz" type="number" />
      </params>
      <select>
        <column table="tree" column="kod_node" key="1" />
        <column table="tree" column="tit_num_new" />
        <column table="tree" column="kod_titul_ip" />
        <column table="tree" column="kod_ipr" />
        <column table="tree" column="kod_parent_node" />
        <column table="tree" column="full_name" />
        <column table="tree" column="itip" />
        <column table="tree" column="razdel_vid_full" title="Раздел" />
        <column table="kod_direct" column="name" as="direct_name" title="Подразделение заказчика" />
        <column table="kod_ispolnit" column="name" as="ispolnit_name" title="Подразделение исполнителя" />
        <column table="kod_subject" column="name" as="subject_name" exclude="1" />
        <call function="nvl" type="string" as="subject_name">
          <column table="kod_subject" column="name" as="subject_name" />
          <column table="kod_subject1" column="name" as="subject_name" />
        </call>
      </select>
      <from>
        <query name="25499-tree-pre-nofilter" as="tree">
          <withparams>
            <useparam name="kod_doc" />
            <useparam name="kod_subject" />
            <useparam name="kod_direct" />
            <useparam name="pr_sbor" />
            <useparam name="pr_child" />
            <useparam name="kod_dirisp" />
          </withparams>
        </query>
        <query name="ipr_titul_ip" as="kod_titul_ip" join="left outer">
          <using>
            <column column="kod_titul_ip" />
          </using>
          <link name="kod_direct" />
          <link name="kod_ispolnit" />
          <link name="kod_subject" as="kod_subject1" />
        </query>
        <query name="ipr_ipr_data" as="kod_ipr" join="left outer">
          <using>
            <column column="kod_ipr" />
          </using>
          <link name="kod_main_titul">
            <link name="kod_subject" />
          </link>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="is not null">
            <column table="tree" column="kod_titul_ip" />
          </call>
          <call function="in" optional="1">
            <column table="kod_titul_ip" column="pr_ofz" />
            <useparam name="kod_ofz" />
          </call>
        </call>
      </where>
    </query>
    <query name="26630-dat-grsets" timestamp="02.11.2016 18:05:34">
      <params>
        <usepart part="26630-params" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26630-dat-new2" as="a">
          <withparams>
            <usepart part="26630-withparams" />
          </withparams>
          <grsets materialize-type="temp-table">
            <grset level="7" title="Итого" as="i">
              <grset level="2" title="По статьям сметы" as="ism" order="kod_smet">
                <where>
                  <usepart part="26630-smet-cond" />
                </where>
              </grset>
              <grset level="4" title="По прочим затратам" as="izt">
                <where>
                  <usepart part="26630-zt-cond" />
                </where>
              </grset>
              <grset level="6" title="По титулам" as="igt">
                <grset level="" title="По сборному титулу" as="gtst">
                  <where>
                    <call function="and">
                      <call function="is not null">
                        <column table="a" column="tit_num_new_sbor" />
                      </call>
                      <call function="=">
                        <call function="nvlu">
                          <useparam name="pr_sbor" />
                          <const>0</const>
                        </call>
                        <const>1</const>
                      </call>
                    </call>
                  </where>
                  <grset level="2" title="По статьям сметы" as="stsm" order="kod_smet">
                    <where>
                      <usepart part="26630-smet-cond" />
                    </where>
                  </grset>
                  <grset level="4" title="По прочим затратам" as="stzt">
                    <where>
                      <usepart part="26630-zt-cond" />
                    </where>
                  </grset>
                </grset>
                <grset level="1" title="По одиночным и головным титулам" as="gttt">
                  <grset level="" title="По одиночному титулу" as="ttot">
                    <where>
                      <call function="=">
                        <call function="nvl">
                          <column table="a" column="is_head_tit" />
                          <const>0</const>
                        </call>
                        <const>0</const>
                      </call>
                    </where>
                    <grset level="2" title="По статьям сметы" as="otsm" order="kod_smet">
                      <where>
                        <usepart part="26630-smet-cond" />
                      </where>
                    </grset>
                    <grset level="4" title="По прочим затратам" as="otzt">
                      <where>
                        <usepart part="26630-zt-cond" />
                      </where>
                    </grset>
                    <grset level="" title="По договорам(итог)" as="otdi">
                      <where>
                        <usepart part="26630-dog-cond" />
                      </where>
                      <grset level="3" title="По договорам" as="otdg" />
                    </grset>
                  </grset>
                  <grset level="" title="По головному титулу" as="ttmt">
                    <where>
                      <call function="=">
                        <column table="a" column="is_head_tit" />
                        <const>1</const>
                      </call>
                    </where>
                    <grset level="2" title="По статьям сметы" as="mtsm" order="kod_smet">
                      <where>
                        <usepart part="26630-smet-cond" />
                      </where>
                    </grset>
                    <grset level="4" title="По прочим затратам" as="mtzt">
                      <where>
                        <usepart part="26630-zt-cond" />
                      </where>
                    </grset>
                    <grset level="" title="По договорам(итог)" as="mtdi">
                      <where>
                        <call function="and">
                          <usepart part="26630-dog-cond" />
                          <call function="=">
                            <call function="nvlu">
                              <useparam name="pr_child" />
                              <const>0</const>
                            </call>
                            <const>0</const>
                          </call>
                        </call>
                      </where>
                      <grset level="3" title="По договорам" as="mtdg" />
                    </grset>
                    <grset level="5" title="По дочерним титулам" as="mtdt">
                      <where>
                        <call function="and">
                          <call function="is not null">
                            <column table="a" column="kod_child_titul" />
                          </call>
                          <call function="=">
                            <call function="nvlu">
                              <useparam name="pr_child" />
                              <const>0</const>
                            </call>
                            <const>1</const>
                          </call>
                        </call>
                      </where>
                      <grset level="2" title="По статьям сметы" as="dtsm" order="kod_smet">
                        <where>
                          <usepart part="26630-smet-cond" />
                        </where>
                      </grset>
                      <grset level="4" title="По прочим затратам" as="dtzt">
                        <where>
                          <usepart part="26630-zt-cond" />
                        </where>
                      </grset>
                      <grset level="" title="По договорам(итог)" as="dtdi">
                        <where>
                          <usepart part="26630-dog-cond" />
                        </where>
                        <grset level="3" title="По договорам" as="dtdg" />
                      </grset>
                    </grset>
                  </grset>
                </grset>
              </grset>
            </grset>
          </grsets>
        </query>
      </from>
      <where>
        <call function="or">
          <call function="and">
            <call function="is not null">
              <column table="a" column="pr_plan" />
            </call>
            <call function="not 0">
              <column table="a" column="summ_usr" />
              <column table="a" column="summ_psd" />
              <column table="a" column="dog_plan_cost" />
              <column table="a" column="kap_sum_itog_eg" />
              <column table="a" column="fp_sum_nds_itog_eg" />
              <column table="a" column="vvod_sum_itog_eg" />
              <column table="a" column="kap_sum_fact_itog_eg" />
              <column table="a" column="fp_sum_nds_fact_itog_eg" />
              <column table="a" column="vvod_sum_fact_itog_eg" />
            </call>
          </call>
          <call function="and">
            <call function="is null">
              <column table="a" column="pr_plan" />
            </call>
            <call function="not 0">
              <column table="a" column="fp_sum_nds_fact_all" />
              <column table="a" column="kap_sum_fact_all" />
              <column table="a" column="vvod_sum_fact_all" />
              <column table="a" column="nzs_fact_itog_eg" />
              <column table="a" column="kredit_fact_itog_dog_eg" />
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="26630-dat-grsets-vvod" timestamp="16.08.2016 16:47:17">
      <params>
        <usepart part="26630-params" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26630-dat-vvod-new-2" as="a">
          <withparams>
            <usepart part="26630-withparams" />
          </withparams>
          <grsets materialize-type="temp-table">
            <grset level="7" title="Итого" as="i">
              <grset level="6" title="По титулам" as="igt">
                <grset level="" title="По сборному титулу" as="gtst">
                  <where>
                    <call function="and">
                      <call function="is not null">
                        <column table="a" column="tit_num_new_sbor" />
                      </call>
                      <call function="=">
                        <call function="nvlu">
                          <useparam name="pr_sbor" />
                          <const>0</const>
                        </call>
                        <const>1</const>
                      </call>
                    </call>
                  </where>
                </grset>
                <grset level="1" title="По одиночным и головным титулам" as="gttt">
                  <grset level="" title="По одиночному титулу" as="ttot">
                    <where>
                      <call function="=">
                        <call function="nvl">
                          <column table="a" column="is_head_tit" />
                          <const>0</const>
                        </call>
                        <const>0</const>
                      </call>
                    </where>
                  </grset>
                  <grset level="" title="По головному титулу" as="ttmt">
                    <where>
                      <call function="=">
                        <column table="a" column="is_head_tit" />
                        <const>1</const>
                      </call>
                    </where>
                    <grset level="5" title="По дочерним титулам" as="mtdt">
                      <where>
                        <call function="and">
                          <call function="is not null">
                            <column table="a" column="kod_child_titul" />
                          </call>
                          <call function="=">
                            <call function="nvlu">
                              <useparam name="pr_child" />
                              <const>0</const>
                            </call>
                            <const>1</const>
                          </call>
                        </call>
                      </where>
                    </grset>
                  </grset>
                </grset>
              </grset>
            </grset>
          </grsets>
        </query>
      </from>
      <!--<where>
        <call function="not 0">
          <column table="a" column="summ_usr" />
          <column table="a" column="summ_psd" />
          <column table="a" column="dog_plan_cost" />
          <column table="a" column="kap_sum_itog_eg" />
          <column table="a" column="fp_sum_nds_itog_eg" />
          <column table="a" column="vvod_sum_itog_eg" />
          <column table="a" column="kap_sum_fact_itog_eg" />
          <column table="a" column="fp_sum_nds_fact_itog_eg" />
          <column table="a" column="vvod_sum_fact_itog_eg" />
        </call>
      </where>-->
    </query>
    <query name="26630_list_ipr_data_default" timestamp="02.02.2017 18:42:05">
      <params>
        <param name="kod_doc" type="number">
          <const>143404</const>
        </param>
        <param name="kod_titul_ip" type="array" />
      </params>
      <select>
        <column table="a" column="kod_titul_ip" key="1" />
        <column table="kod_titul_ip" column="tit_num_new" />
      </select>
      <from>
        <query name="ipr_ipr_data" as="a" join="left outer">
          <link name="kod_titul_ip" />
          <link name="kod_main_titul">
            <link name="kod_sbor_titul" />
          </link>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="kod_doc_osn" />
            <useparam name="kod_doc" />
          </call>
          <call function="or">
            <call function="false" />
            <call function="in" optional="1">
              <column table="a" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in" optional="1">
              <column table="a" column="kod_main_titul" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in" optional="1">
              <column table="kod_sbor_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
          </call>
        </call>
      </where>
    </query>
  </queries>
</root>