<?xml version="1.0" encoding="utf-8"?>
<root>
  <parts>
    <part id="29265-params" timestamp="16.03.2018 13:09:34">
      <param name="kod_doc">
        <const>56042</const>
      </param>
      <param name="dat">
        <const>sysdate</const>
      </param>
      <param name="kod_dirisp">
        <const>2</const>
      </param>
      <param name="kod_direct" />
      <param name="kod_subject" />
      <param name="cmn_date_cur" />
      <param name="dat_dog_s" />
      <param name="dat_dog_po" />
      <param name="pr_notaip" />
      <param name="kod_titul_ip" />
      <param name="is_show_akt" />
      <param name="mp">
        <const>-3</const>
      </param>
      <param name="kod_ofz" />
      <param name="kod_status_tit" />
    </part>
    <part id="29265-withparams" timestamp="16.03.2018 13:11:03">
      <useparam name="kod_doc" />
      <useparam name="dat" />
      <useparam name="kod_dirisp" />
      <useparam name="kod_direct" />
      <useparam name="kod_subject" />
      <useparam name="cmn_date_cur" />
      <useparam name="dat_dog_s" />
      <useparam name="dat_dog_po" />
      <useparam name="pr_notaip" />
      <useparam name="kod_titul_ip" />
      <useparam name="is_show_akt" />
      <useparam name="mp" />
      <useparam name="kod_ofz" />
      <useparam name="kod_status_tit" />
    </part>
  </parts>
  <forms>
    <form name="29265" timestamp="04.09.2018 10:38:39" with-behavior="0">
      <customers>
        <customer id="17" />
      </customers>
      <content>
        <usefield field="ipr_kod_doc" mandatory="1" />
        <usefield field="ipr_kod_direct" />
        <usefield name="kod_dirisp" field="ipr_kod_dirisp_all" mandatory="1" />
        <usefield field="ipr_subject" />
        <usefield field="cmn_combo_str" name="tekfix" title="Cметная стоимость (фиксированная/текущая)" mandatory="1">
          <listquery>
            <query name="29265-cols-tekfix" />
          </listquery>
          <defaultquery>
            <query name="29265-cols-tekfix-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_date_cur" name="dat" title="По состоянию на дату" mandatory="1" />
        <usefield field="ipr_pr_notaip" />
        <usefield field="ipr_kod_titul_ip" />
        <usefield field="ipr_status_tit" />
        <usefield field="cmn_check" title="Подробно" name="is_details" />
        <usefield field="cmn_check" title="Вывод. инф. по актам и РНО" name="is_show_akt" />
        <usefield field="cmn_check" title="Отображать сумму договора без НДС" name="is_show_sum_dog" checked="1" />
        <field name="cols" type="string" controlType="UIList" title="Колонки" special-type="colsets" column-visible="0">
          <defaultquery>
            <query name="29265-cols-def" />
          </defaultquery>
        </field>
        <usefield field="ipr_mp">
          <defaultquery>
            <query name="29265-mp-default" />
          </defaultquery>
        </usefield>
        <usefield field="ipr_kod_ofz" />
        <fieldgroup title="Дата дата начала действия договора">
          <usefield field="cmn_date" title="С" name="dat_dog_s" />
          <usefield field="cmn_date" title="По" name="dat_dog_po" />
        </fieldgroup>
      </content>
    </form>
  </forms>
  <reports>
    <report name="29265" form="29265" title="Анализ договоров в титуле" edit-columns="2" nogrid="1" folder="invpro" timestamp="02.11.2016 13:35:13">
      <params>
        <usepart part="29265-params" />
      </params>
      <customers>
        <customer id="17" />
      </customers>
      <print-templates>
        <excel>
          <template name="29265.xml" title="Анализ договоров в титуле" conv-to-openxml="0" del-cols="1" print-proc="2" headmarker="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="29265-dat-grsets" as="a" title="Данные">
          <withparams>
            <usepart part="29265-withparams" />
          </withparams>
        </query>
        <query name="form:29265" as="b" title="Параметры" />
        <query name="29265-title" as="t" title="Заголовок">
          <withparams>
            <usepart part="29265-withparams" />
          </withparams>
        </query>
      </queries>
    </report>
    <report name="29265-vertica-test" form="29265" title="Анализ договоров в титуле" edit-columns="2" nogrid="1" folder="invpro" visible="0">
      <params>
        <usepart part="29265-params" />
      </params>
      <customers>
        <customer id="17" />
      </customers>
      <print-templates>
        <excel>
          <template name="29265.xml" title="Анализ договоров в титуле" del-cols="1" print-proc="2" />
        </excel>
      </print-templates>
      <queries>
        <query name="29265-dat-grsets-vert-test" as="a" title="Данные">
          <withparams>
            <usepart part="29265-withparams" />
          </withparams>
        </query>
        <!--<query name="29265-dat" grouplevel="0" as="a" title="Данные">
          <withparams>
            <usepart part="29265-withparams" />
          </withparams>
        </query>-->
      </queries>
    </report>
  </reports>
  <queries>
    <query name="29265-cols-tekfix-def">
      <select>
        <column table="a" column="id" />
        <column table="a" column="name" title="1" />
      </select>
      <from>
        <query name="29265-cols" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="id" />
          <const>'Текущая'</const>
        </call>
      </where>
    </query>
    <query name="29265-cols-def">
      <params>
        <param name="tekfix" type="string" />
        <param name="is_details" type="number" />
        <param name="is_show_akt" type="number" />
        <param name="is_show_sum_dog" type="number" />
      </params>
      <select>
        <column table="a" column="id" />
        <column table="a" column="name" title="1" />
      </select>
      <from>
        <query name="29265-cols" as="a" />
      </from>
      <where>
        <call function="or">
          <call function="=">
            <column table="a" column="id" />
            <useparam name="tekfix" />
          </call>
          <call function="and" optional="1">
            <call function="=1">
              <useparam name="is_details" />
            </call>
            <call function="=">
              <column table="a" column="id" />
              <const>'Подробно'</const>
            </call>
          </call>
          <call function="and" optional="1">
            <call function="=1">
              <useparam name="is_show_akt" />
            </call>
            <call function="=">
              <column table="a" column="id" />
              <const>'Акт/РНО'</const>
            </call>
          </call>
          <call function="and">
            <call function="=1">
              <call function="nvlu">
                <useparam name="is_show_sum_dog" />
                <const>0</const>
              </call>
            </call>
            <call function="=">
              <column table="a" column="id" />
              <const>'сумма договора без НДС'</const>
            </call>
          </call>
          <call function="and">
            <call function="=0">
              <call function="nvlu">
                <useparam name="is_show_sum_dog" />
                <const>0</const>
              </call>
            </call>
            <call function="=">
              <column table="a" column="id" />
              <const>'сумма договора с НДС'</const>
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="29265-cols">
      <const as="id" type="string">'Текущая'</const>
      <const as="name" type="string" title="1">'Текущая'</const>
      <const>'Фиксированная'</const>
      <const>'Фиксированная'</const>
      <const>'Подробно'</const>
      <const>'Подробно'</const>
      <const>'Акт/РНО'</const>
      <const>'Акт/РНО'</const>
      <const>'сумма договора без НДС'</const>
      <const>'сумма договора без НДС'</const>
      <const>'сумма договора с НДС'</const>
      <const>'сумма договора с НДС'</const>
    </query>
    <query name="29265-dat-grsets" order="kod_titul_ip" timestamp="29.05.2017 16:44:56">
      <params>
        <usepart part="29265-params" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="29265-dat" as="a">
          <withparams>
            <usepart part="29265-withparams" />
          </withparams>
          <grsets>
            <grset level="1" title="Сборный (узел)" as="sbor_node">
              <grset level="" title="Сборный (вывод)" as="sbor">
                <where>
                  <call function="is not null">
                    <column table="a" column="kod_titul_ip_sbor" />
                  </call>
                </where>
              </grset>
              <grset level="2" title="Головной(узел)" as="par_node">
                <grset level="" title="Головной(вывод)" as="par">
                  <where>
                    <call function="not">
                      <call function="is null or -1">
                        <column table="a" column="kod_parent" />
                      </call>
                    </call>
                  </where>
                </grset>
                <grset level="3" title="Одиночный/Дочерний" as="child">
                  <where>
                    <call function="!=nvl">
                      <column table="a" column="is_head_tit" />
                      <const>1</const>
                    </call>
                  </where>
                  <grset level="4" title="Договор" as="dog">
                    <where>
                      <call function="is not null">
                        <column table="a" column="kod_dog_i" />
                      </call>
                    </where>
                    <grset level="5" title="Акт" as="akt">
                      <where>
                        <call function="and">
                          <call function="is not null">
                            <column table="a" column="kod_vip_dog" />
                          </call>
                          <call function="=">
                            <call function="nvlu">
                              <useparam name="is_show_akt" />
                              <const>0</const>
                            </call>
                            <const>1</const>
                          </call>
                        </call>
                      </where>
                    </grset>
                    <grset level="6" title="РНО" as="rno">
                      <where>
                        <call function="and">
                          <call function="is not null">
                            <column table="a" column="kod_opl_period" />
                          </call>
                          <call function="=">
                            <call function="nvlu">
                              <useparam name="is_show_akt" />
                              <const>0</const>
                            </call>
                            <const>1</const>
                          </call>
                        </call>
                      </where>
                    </grset>
                  </grset>
                </grset>
              </grset>
            </grset>
          </grsets>
        </query>
      </from>
    </query>
    <query name="29265-title">
      <params>
        <usepart part="29265-params" />
      </params>
      <select>
        <call function="year" as="year">
          <useparam name="dat" />
        </call>
        <call function="+" as="year_nxt">
          <call function="year">
            <useparam name="dat" />
          </call>
          <const>1</const>
        </call>
        <column table="a" column="name" as="mp_name" />
      </select>
      <from>
        <query name="26630-mp" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="kod_mp" />
          <useparam name="mp" />
        </call>
      </where>
    </query>
    <query name="29265-dat" grouplevel="no" timestamp="16.03.2018 13:49:55">
      <params>
        <usepart part="29265-params" />
      </params>
      <select>
        <!--<column table="kod_titul_ip" column="kod_titul_ip" group="1" />
        <column table="a" column="kod_titul_ip_sb" group="kod_titul_ip" />
        <column table="kod_titul_ip" column="tit_num_new_n" group="kod_titul_ip" />-->
        <column table="kod_sbor_titul" column="kod_sbor_titul" group="1" />
        <column table="kod_titul_ip_sbor" column="kod_titul_ip" as="kod_titul_ip_sbor" group="kod_sbor_titul" />
        <column table="kod_titul_ip_sbor" column="tit_num_new_n" as="tit_num_new_sbor" group="kod_sbor_titul" title="{+} (сборный)" />
        <column table="kod_titul_ip_sbor" column="name" as="name_sbor" group="kod_sbor_titul" title="{+} (сборный)" />
        <column table="kod_subject_sbor" column="abbr" as="subj_abbr_sbor" group="kod_sbor_titul" />
        <call function="if" type="string" as="podr_abbr_sbor" group="kod_sbor_titul" title="Подразделение">
          <call function="=">
            <useparam name="kod_dirisp" />
            <const>2</const>
          </call>
          <column table="kod_direct_sbor" column="name_kr" />
          <column table="kod_ispolnit_sbor" column="name_kr" />
        </call>
        <column table="kod_ipr" column="kod_parent" group="2" />
        <column table="kod_parent" column="tit_num_new_n" as="tit_num_new_par" group="kod_parent" title="{+} (головной)" />
        <column table="kod_parent" column="name" as="name_par" group="kod_parent" title="{+} (головной)" />
        <column table="kod_subject_par" column="abbr" as="subj_abbr_par" group="kod_parent" />
        <call function="if" type="string" as="podr_abbr_par" group="kod_parent" title="Подразделение">
          <call function="=">
            <useparam name="kod_dirisp" />
            <const>2</const>
          </call>
          <column table="kod_direct_par" column="name_kr" />
          <column table="kod_ispolnit_par" column="name_kr" />
        </call>
        <column table="kod_ipr" column="kod_titul_ip" group="3" />
        <column table="kod_titul_ip" column="tit_num_new_n" as="tit_num_new" group="kod_titul_ip" title="{+} (одиночный/дочерний)" />
        <column table="kod_titul_ip" column="name" as="name_tit" group="kod_titul_ip" title="{+} (одиночный/дочерний)" />
        <column table="kod_subject" column="abbr" as="subj_abbr" group="kod_titul_ip" />
        <column table="pr_ofz" column="name" as="ofz_name" group="kod_titul_ip" />
        <column table="kod_titul_ip" column="is_head_tit" as="is_head_tit" group="kod_titul_ip" />
        <call function="substr" as="itip" group="kod_titul_ip">
          <column table="kod_ipr" column="itip" />
          <const>0</const>
          <const>1</const>
        </call>
        <call function="if" type="string" as="podr_abbr" group="kod_titul_ip" title="Подразделение">
          <call function="=">
            <useparam name="kod_dirisp" />
            <const>2</const>
          </call>
          <column table="kod_direct" column="name_kr" />
          <column table="kod_ispolnit" column="name_kr" />
        </call>
        <column table="a" column="ipr_fin_ipr" group="sum" c-master="kod_titul_ip" />
        <column table="a" column="summ_k_rasp" group="sum" colset="Фиксированная" c-master="kod_titul_ip" mp="[:mp]" />
        <column table="a" column="summ_k_rasp" as="summ_k_rasp_sm" group="sum" colset="Фиксированная" c-master="kod_titul_ip" dimname="sm" mp="[:mp]">
          <pivot title=" в разрезе сметы">
            <call function="=">
              <column table="a" column="kod_smet" />
              <column table="dim" column="kod_smet" />
            </call>
            <query order="kod_smet">
              <select>
                <column table="ips_smet" column="kod_smet" />
                <column table="ips_smet" column="name" />
              </select>
              <from>
                <query name="ips_smet_structure" as="ips_smet" />
              </from>
              <where>
                <call function="and">
                  <call function="lt">
                    <column table="ips_smet" column="kod_smet" />
                    <const>5</const>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="summ_k_rasp_tek" group="sum" colset="Текущая" c-master="kod_titul_ip" mp="[:mp]" />
        <column table="a" column="summ_k_rasp_tek" as="summ_k_rasp_tek_sm" group="sum" colset="Текущая" c-master="kod_titul_ip" dimname="sm" mp="[:mp]" />
        <column table="a" column="dog_proch_plan_cost" as="dog_plan_cost_oks" group="sum" colset="Текущая" title="Затраты на содержание службы заказчика (затраты ОКСа)" mp="[:mp]">
          <if>
            <call function="in">
              <column table="a" column="kodzatrat" />
              <array>
                <const type="number">53</const>
              </array>
            </call>
          </if>
        </column>
        <column table="a" column="dog_proch_plan_cost" as="dog_plan_cost_75" group="sum" colset="Текущая" title="Затраты на содержание службы заказчика (затраты ОКСа)" mp="[:mp]">
          <if>
            <call function="in">
              <column table="a" column="kodzatrat" />
              <array>
                <const type="number">99</const>
              </array>
            </call>
          </if>
        </column>
        <column table="kod_dog_i" column="kod_dog_i" group="4" title="kod_dog" />
        <column table="kod_dog_i" column="num_i" group="kod_dog_i" />
        <column table="kod_dog_i" column="predm_dog" group="kod_dog_i" />
        <column table="kod_dog_i" column="date_i" group="kod_dog_i" />
        <column table="kod_dog_i" column="date_end_i" group="kod_dog_i" />
        <column table="e_code" column="name_all" group="kod_dog_i" as="name_contr" />
        <column table="kod_dog_i" column="tip_i" group="kod_dog_i" />
        <column table="kod_dog_i" column="status_i" group="kod_dog_i" />
        <column table="kod_dog_i" column="name_i" group="kod_dog_i" />
        <call function="if" as="stadiya" type="string" title="Стадия реализации проекта С/П" agg="no" group="kod_titul_ip">
          <call function="between">
            <call function="year">
              <useparam name="dat" />
            </call>
            <column table="kod_titul_ip" column="beg_year" />
            <column table="kod_titul_ip" column="end_year" />
          </call>
          <call function="if">
            <call function="not 0">
              <column table="this" column="kap_sum_itog_23" />
            </call>
            <const>'С'</const>
            <const>'П'</const>
          </call>
          <const>null</const>
        </call>
        <column table="a" column="kap_sum_itog" as="kap_sum_itog_23" title="Плановые суммы освоения по виду затрат СМР,Оборудование на начало " group="sum" mp="-6" if="beg23" agg="sum">
          <section>
            <call function="num to ym2">
              <call function="-">
                <call function="year">
                  <useparam name="dat" />
                </call>
                <const>1</const>
              </call>
              <const>12</const>
            </call>
          </section>
          <if>
            <call function="in">
              <column table="a" column="kod_smet" />
              <array>2,3</array>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_tek_pred" group="sum" if="tek_pred">
          <if>
            <call function="le">
              <column table="a" column="year" />
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <call function="if" as="dog_plan_cost_a" mp="[:mp]" type="number">
          <call function="in">
            <column table="kod_dog" column="status" />
            <array>4,12,27,13</array>
          </call>
          <column table="this" column="kap_sum_fact_tek_pred" group="" />
          <column table="a" column="dog_plan_cost" />
        </call>
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost" group="sum" colset="сумма договора без НДС" />
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_sm" group="sum" dimname="sm" colset="сумма договора без НДС" />
        <!--<const as="dog_plan_cost_sm_key" type="number" group="sum" colset="сумма договора без НДС">null</const>-->
        <call function="" as="dog_plan_cost_sm_key" type="number" group="sum" colset="сумма договора без НДС" title="1">
          <const>null</const>
        </call>
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_pred" group="sum" colset="сумма договора без НДС" if="pred_y">
          <if>
            <call function="lt">
              <call function="year">
                <column table="kod_dog_i" column="date_end_i" />
              </call>
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_tek" group="sum" colset="сумма договора без НДС" if="tek_yd">
          <if>
            <call function="ge">
              <call function="year">
                <column table="kod_dog_i" column="date_end_i" />
              </call>
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_nds_fact" as="kap_sum_nds_fact_tek_pred" group="sum" if="tek_pred">
          <if>
            <call function="le">
              <column table="a" column="year" />
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <call function="if" as="dog_plan_cost_nds_a" mp="[:mp]" type="number">
          <call function="in">
            <column table="kod_dog" column="status" />
            <array>4,12,27,13</array>
          </call>
          <column table="this" column="kap_sum_nds_fact_tek_pred" group="" />
          <column table="a" column="dog_plan_cost_nds" />
        </call>
        <column table="this" column="dog_plan_cost_nds_a" as="dog_plan_cost_nds" group="sum" colset="сумма договора с НДС" />
        <column table="this" column="dog_plan_cost_nds_a" as="dog_plan_cost_nds_sm" group="sum" dimname="sm" colset="сумма договора с НДС" />
        <!--<const as="dog_plan_cost_nds_sm_key" type="number" group="sum" colset="сумма договора с НДС">null</const>-->
        <call function="" as="dog_plan_cost_nds_sm_key" type="number" group="sum" colset="сумма договора с НДС" title="1">
          <const>null</const>
        </call>
        <column table="this" column="dog_plan_cost_nds_a" as="dog_plan_cost_nds_pred" group="sum" colset="сумма договора с НДС" if="pred_y" />
        <column table="this" column="dog_plan_cost_nds_a" as="dog_plan_cost_nds_tek" group="sum" colset="сумма договора с НДС" if="tek_yd" />
        <column table="a" column="kap_sum_fact" group="sum" mp="[:mp]" />
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_pr_y" group="sum" if="pr_y" mp="[:mp]" colset="Подробно">
          <if title=" (пред годы)">
            <call function="lt">
              <column table="a" column="year" />
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_tek_y" group="sum" if="tek_y" mp="[:mp]" colset="Подробно">
          <if title=" (тек год)">
            <call function="=">
              <column table="a" column="year" />
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_sm" group="sum" dimname="sm" mp="[:mp]" colset="Подробно" />
        <call function="if" as="kap_sum_a" mp="[:mp]" type="number">
          <call function="in">
            <column table="kod_dog" column="status" />
            <array>4,12,27,13</array>
          </call>
          <column table="a" column="kap_sum_fact" />
          <column table="a" column="kap_sum" />
        </call>
        <column table="this" column="kap_sum_a" as="kap_sum_tek_pred" group="sum" if="tek_pred" colset="Подробно" />
        <column table="this" column="kap_sum_a" as="kap_sum_yrs" group="sum" dimname="years" colset="Подробно">
          <pivot title=" по годам">
            <call function="=">
              <column table="a" column="year" />
              <column table="dim" column="year" />
            </call>
            <query order="name">
              <select>
                <call function="-" as="id">
                  <column table="y" column="year" />
                  <call function="year">
                    <useparam name="dat" />
                  </call>
                </call>
                <column table="y" column="name" />
                <column table="y" column="year" />
              </select>
              <from>
                <query name="spr_time_year" as="y" />
              </from>
              <where>
                <call function="between">
                  <column table="y" column="year" />
                  <call function="+">
                    <call function="year">
                      <useparam name="dat" />
                    </call>
                    <const>1</const>
                  </call>
                  <call function="+">
                    <call function="year">
                      <useparam name="dat" />
                    </call>
                    <const>5</const>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <!--<column table="a" column="kap_sum" group="sum" />-->
        <column table="a" column="fp_sum_nds_fact" group="sum" mp="[:mp]" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_pr_y" group="sum" if="pr_y" mp="[:mp]" colset="Подробно" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_tek_y" group="sum" if="tek_y" mp="[:mp]" colset="Подробно" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_sm" group="sum" dimname="sm" mp="[:mp]" colset="Подробно" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_av" group="sum" if="av" mp="[:mp]" colset="Подробно">
          <if title=" (аванс)">
            <call function="=1">
              <column table="a" column="is_avans" />
            </call>
          </if>
        </column>
        <column table="a" column="kredit_fact_itog_dog" group="sum" if="idt" mp="[:mp]" colset="Подробно">
          <section>
            <call function="date to ym2">
              <call function="doomsday" />
            </call>
          </section>
        </column>
        <column table="a" column="debet_fact_itog_dog" group="sum" if="idt" mp="[:mp]" colset="Подробно" />
        <column table="a" column="kredit_fact_itog_smet" group="sum" if="idt" mp="[:mp]" colset="Подробно" />
        <column table="a" column="debet_fact_itog_smet" group="sum" isumm_k_rasp_tek_smf="idt" mp="[:mp]" colset="Подробно" />
        <column table="kod_vip_dog" column="kod_vip_dog" group="5" colset="Акт/РНО" />
        <column table="kod_vip_dog" column="num_doc" group="kod_vip_dog" colset="Акт/РНО" />
        <column table="kod_vip_dog" column="dat_doc" group="kod_vip_dog" colset="Акт/РНО" />
        <column table="kod_opl_period" column="kod_opl_period" group="6" colset="Акт/РНО" />
        <column table="kod_opl_period" column="num_rno" group="kod_opl_period" colset="Акт/РНО" />
        <column table="kod_opl_period" column="dat_opl" group="kod_opl_period" colset="Акт/РНО" />
        <column table="kod_opl_period" column="status" group="kod_opl_period" colset="Акт/РНО" title="Тип РНО" />
      </select>
      <from>
        <query name="ipr_fin_body_united" as="a">
          <link name="kod_dog_i">
            <link name="kod_dog">
              <link name="e_code" />
            </link>
          </link>
          <link name="kod_ipr">
            <link name="kod_titul_ip">
              <link name="kod_direct" />
              <link name="kod_ispolnit" />
              <link name="pr_ofz" />
            </link>
            <link name="kod_parent">
              <link name="kod_subject" as="kod_subject_par" />
              <link name="kod_direct" as="kod_direct_par" />
              <link name="kod_ispolnit" as="kod_ispolnit_par" />
            </link>
            <link name="kod_main_titul">
              <link name="kod_subject" />
              <link name="kod_sbor_titul">
                <link name="kod_titul_ip" as="kod_titul_ip_sbor">
                  <link name="kod_subject" as="kod_subject_sbor" />
                  <link name="kod_direct" as="kod_direct_sbor" />
                  <link name="kod_ispolnit" as="kod_ispolnit_sbor" />
                </link>
              </link>
            </link>
          </link>
          <link name="kod_vip_dog" />
          <link name="kod_opl_period" />
          <extendwhere>
            <call function="and">
              <call function="true" />
              <call function="=">
                <column table="kod_ipr" column="kod_doc_osn" />
                <useparam name="kod_doc" />
              </call>
              <call function="=" selective="1">
                <column table="*" column="pr_last_smet" />
                <const>1</const>
              </call>
              <!--<call function="=">
                <column table="kod_titul_ip1" column="kod_titul_ip" />
                <const>25788</const>
              </call>-->
              <call function="or" optional="1">
                <call function="in">
                  <column table="kod_sbor_titul1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_main_titul1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_titul_ip1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
              </call>
              <call function="in" optional="1">
                <column table="kod_main_titul1" column="kod_subject" />
                <useparam name="kod_subject" />
              </call>
              <call function="le" selective="1">
                <column table="*" column="dat" />
                <useparam name="dat" />
              </call>
              <call function="or" optional="1">
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip1" column="kod_ispolnit" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="in">
                    <useparam name="kod_dirisp" />
                    <array>1,3</array>
                  </call>
                </call>
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip1" column="kod_direct" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="in">
                    <useparam name="kod_dirisp" />
                    <array>1,2</array>
                  </call>
                </call>
              </call>
              <call function="in" optional="1">
                <column table="kod_titul_ip1" column="pr_ofz" />
                <useparam name="kod_ofz" />
              </call>
              <call function="in" optional="1">
                <column table="kod_ipr" column="kod_status" />
                <useparam name="kod_status_tit" />
              </call>
            </call>
          </extendwhere>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="or">
            <call function="is null">
              <column table="kod_dog_i" column="kod_dog_i" />
            </call>
            <call function="and">
              <call function="true" />
              <call function="le" selective="1" optional="1">
                <column table="kod_dog_i" column="date_i" />
                <useparam name="dat_dog_po" />
              </call>
              <call function="ge" selective="1" optional="1">
                <column table="kod_dog_i" column="date_i" />
                <useparam name="dat_dog_s" />
              </call>
            </call>
          </call>
          <call function="or">
            <call function="is null">
              <column table="kod_dog_i" column="pr_kido" />
            </call>
            <call function="=1">
              <column table="kod_dog_i" column="pr_kido" />
            </call>
          </call>
          <call function="or">
            <call function="is null">
              <column table="kod_dog" column="status" />
            </call>
            <call function="in">
              <column table="kod_dog" column="status" />
              <array>0,1,4,12,27,13</array>
            </call>
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="29265-mp-default">
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="26630-mp" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="kod_mp" />
          <const>-3</const>
        </call>
      </where>
    </query>
    <query name="29265-dat-grsets-vert-test">
      <params>
        <usepart part="29265-params" />
      </params>
      <select>
        <column table="a" column="*" />
      </select>
      <from>
        <query name="29265-dat-vert-test2" as="a">
          <withparams>
            <usepart part="29265-withparams" />
          </withparams>
          <grsets>
            <grset level="1" title="Сборный (узел)" as="sbor_node">
              <grset level="" title="Сборный (вывод)" as="sbor">
                <where exclude="1">
                  <call function="is not null">
                    <column table="a" column="kod_titul_ip_sbor" />
                  </call>
                </where>
              </grset>
              <grset level="2" title="Головной(узел)" as="par_node">
                <grset level="" title="Головной(вывод)" as="par">
                  <where exclude="1">
                    <call function="not">
                      <call function="is null or -1">
                        <column table="a" column="kod_parent" />
                      </call>
                    </call>
                  </where>
                </grset>
                <grset level="3" title="Одиночный/Дочерний" as="child">
                  <grset level="4" title="Договор" as="dog">
                    <where exclude="1">
                      <call function="is not null">
                        <column table="a" column="kod_dog_i" />
                      </call>
                    </where>
                    <grset level="5" title="Акт" as="akt">
                      <where>
                        <call function="and">
                          <call function="is not null">
                            <column table="a" column="kod_vip_dog" />
                          </call>
                          <call function="=">
                            <call function="nvlu">
                              <useparam name="is_show_akt" />
                              <const>0</const>
                            </call>
                            <const>1</const>
                          </call>
                        </call>
                      </where>
                    </grset>
                    <grset level="6" title="РНО" as="rno">
                      <where>
                        <call function="and">
                          <call function="is not null">
                            <column table="a" column="kod_opl_period" />
                          </call>
                          <call function="=">
                            <call function="nvlu">
                              <useparam name="is_show_akt" />
                              <const>0</const>
                            </call>
                            <const>1</const>
                          </call>
                        </call>
                      </where>
                    </grset>
                  </grset>
                </grset>
              </grset>
            </grset>
          </grsets>
        </query>
      </from>
    </query>
    <query name="29265-dat-vert-test" grouplevel="no">
      <params>
        <usepart part="29265-params" />
      </params>
      <select>
        <column table="a" column="kod_sbor_titul" group="1" />
        <column table="a" column="kod_titul_ip" as="kod_titul_ip_sbor" group="kod_sbor_titul" />
        <column table="a" column="tit_num_new_n" as="tit_num_new_sbor" group="kod_sbor_titul" title=" (сборный)" />
        <column table="a" column="name" as="name_sbor" group="kod_sbor_titul" title=" (сборный)" />
        <column table="a" column="abbr" as="subj_abbr_sbor" group="kod_sbor_titul" />
        <column table="a" column="kod_parent" group="2" />
        <column table="a" column="tit_num_new_n" as="tit_num_new_par" group="kod_parent" title=" (головной)" />
        <column table="a" column="name" as="name_par" group="kod_parent" title=" (головной)" />
        <column table="a" column="abbr" as="subj_abbr_par" group="kod_parent" />
        <column table="a" column="kod_titul_ip" group="3" />
        <column table="a" column="tit_num_new_n" as="tit_num_new_n" group="kod_titul_ip" title=" (одиночный/дочерний)" />
        <column table="a" column="name" as="name_tit" group="kod_titul_ip" title=" (одиночный/дочерний)" />
        <column table="a" column="abbr" as="subj_abbr" group="kod_titul_ip" />
        <column table="a" column="kod_dog_i" group="4" title="kod_dog" exclude="1" />
        <column table="a" column="num_i" group="kod_dog_i" exclude="1" />
        <column table="a" column="predm_dog" group="kod_dog_i" exclude="1" />
        <column table="a" column="date_i" group="kod_dog_i" exclude="1" />
        <column table="a" column="date_end_i" group="kod_dog_i" exclude="1" />
        <column table="a" column="tip_i" group="kod_dog_i" exclude="1" />
        <column table="a" column="status_i" group="kod_dog_i" exclude="1" />
        <column table="a" column="name_i" group="kod_dog_i" exclude="1" />
        <column table="a" column="kod_vip_dog" group="5" colset="Акт/РНО" exclude="1" />
        <column table="a" column="num_doc" group="kod_vip_dog" colset="Акт/РНО" exclude="1" />
        <column table="a" column="dat_doc" group="kod_vip_dog" colset="Акт/РНО" exclude="1" />
        <column table="a" column="kod_opl_period" group="6" colset="Акт/РНО" exclude="1" />
        <column table="a" column="num_rno" group="kod_opl_period" colset="Акт/РНО" exclude="1" />
        <column table="a" column="dat_opl" group="kod_opl_period" colset="Акт/РНО" exclude="1" />
        <column table="a" column="status" group="kod_opl_period" colset="Акт/РНО" title="Тип РНО" exclude="1" />
      </select>
      <from>
        <table name="temp" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="or">
            <call function="is null">
              <column table="kod_dog_i" column="pr_kido" />
            </call>
            <call function="=1">
              <column table="kod_dog_i" column="pr_kido" />
            </call>
          </call>
          <call function="or" exclude="1">
            <call function="is null">
              <column table="kod_dog" column="status" />
            </call>
            <call function="in">
              <column table="kod_dog" column="status" />
              <array>0,1,4,12,27,13</array>
            </call>
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
          <call function="true" />
        </call>
      </where>
    </query>
    <!--<query name="29265-dat-vert-test" grouplevel="no">
      <params>
        <usepart part="29265-params" />
      </params>
      <select>
        <column table="kod_sbor_titul" column="kod_sbor_titul" group="1" />
        <column table="kod_titul_ip_sbor" column="kod_titul_ip" as="kod_titul_ip_sbor" group="kod_sbor_titul" />
        <column table="kod_titul_ip_sbor" column="tit_num_new_n" as="tit_num_new_sbor" group="kod_sbor_titul" title="{+} (сборный)" />
        <column table="kod_titul_ip_sbor" column="name" as="name_sbor" group="kod_sbor_titul" title="{+} (сборный)" />
        <column table="kod_subject_sbor" column="abbr" as="subj_abbr_sbor" group="kod_sbor_titul" />
        <call function="if" type="string" as="podr_abbr_sbor" group="kod_sbor_titul" title="Подразделение">
          <call function="=">
            <useparam name="kod_dirisp" />
            <const>2</const>
          </call>
          <column table="kod_direct_sbor" column="name_kr" />
          <column table="kod_ispolnit_sbor" column="name_kr" />
        </call>
        <column table="kod_ipr" column="kod_parent" group="2" />
        <column table="kod_parent" column="tit_num_new_n" as="tit_num_new_par" group="kod_parent" title="{+} (головной)" />
        <column table="kod_parent" column="name" as="name_par" group="kod_parent" title="{+} (головной)" />
        <column table="kod_subject_par" column="abbr" as="subj_abbr_par" group="kod_parent" />
        <call function="if" type="string" as="podr_abbr_par" group="kod_parent" title="Подразделение">
          <call function="=">
            <useparam name="kod_dirisp" />
            <const>2</const>
          </call>
          <column table="kod_direct_par" column="name_kr" />
          <column table="kod_ispolnit_par" column="name_kr" />
        </call>
        <column table="kod_ipr" column="kod_titul_ip" group="3" />
        <column table="kod_titul_ip" column="tit_num_new_n" as="tit_num_new_n" group="kod_titul_ip" title="{+} (одиночный/дочерний)" />
        <column table="kod_titul_ip" column="name" as="name_tit" group="kod_titul_ip" title="{+} (одиночный/дочерний)" />
        <column table="kod_subject" column="abbr" as="subj_abbr" group="kod_titul_ip" />
        <call function="substr" as="itip" group="kod_titul_ip">
          <column table="kod_ipr" column="itip" />
          <const>0</const>
          <const>1</const>
        </call>
        <call function="if" type="string" as="podr_abbr" group="kod_titul_ip" title="Подразделение">
          <call function="=">
            <useparam name="kod_dirisp" />
            <const>2</const>
          </call>
          <column table="kod_direct" column="name_kr" />
          <column table="kod_ispolnit" column="name_kr" />
        </call>
        <column table="a" column="ipr_fin_ipr" group="sum" c-master="kod_titul_ip" />
        <column table="a" column="summ_k_rasp" group="sum" colset="Фиксированная" c-master="kod_titul_ip" mp="[:mp]" />
        <column table="a" column="summ_k_rasp" as="summ_k_rasp_sm" group="sum" colset="Фиксированная" c-master="kod_titul_ip" dimname="sm" mp="[:mp]" exclude="1">
          <pivot title=" в разрезе сметы">
            <call function="=">
              <column table="a" column="kod_smet" />
              <column table="dim" column="kod_smet" />
            </call>
            <query order="kod_smet">
              <select>
                <column table="ips_smet" column="kod_smet" />
                <column table="ips_smet" column="name" />
              </select>
              <from>
                <query name="ips_smet_structure" as="ips_smet" />
              </from>
              <where>
                <call function="and">
                  <call function="lt">
                    <column table="ips_smet" column="kod_smet" />
                    <const>5</const>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="summ_k_rasp_tek" group="sum" colset="Текущая" c-master="kod_titul_ip" mp="[:mp]" exclude="1" />
        <column table="a" column="summ_k_rasp_tek" as="summ_k_rasp_tek_sm" group="sum" colset="Текущая" c-master="kod_titul_ip" dimname="sm" mp="[:mp]" exclude="1" />
        <column table="kod_dog_i" column="kod_dog_i" group="4" title="kod_dog" exclude="1" />
        <column table="kod_dog_i" column="num_i" group="kod_dog_i" exclude="1" />
        <column table="kod_dog_i" column="predm_dog" group="kod_dog_i" exclude="1" />
        <column table="kod_dog_i" column="date_i" group="kod_dog_i" exclude="1" />
        <column table="kod_dog_i" column="date_end_i" group="kod_dog_i" exclude="1" />
        <column table="kod_dog_i" column="tip_i" group="kod_dog_i" exclude="1" />
        <column table="kod_dog_i" column="status_i" group="kod_dog_i" exclude="1" />
        <column table="kod_dog_i" column="name_i" group="kod_dog_i" exclude="1" />
        <call function="if" as="stadiya" type="string" title="Стадия реализации проекта С/П" agg="no" group="kod_titul_ip" exclude="1">
          <call function="between">
            <call function="year">
              <useparam name="dat" />
            </call>
            <column table="kod_titul_ip" column="beg_year" />
            <column table="kod_titul_ip" column="end_year" />
          </call>
          <call function="if">
            <call function="not 0">
              <column table="this" column="kap_sum_itog_23" />
            </call>
            <const>'С'</const>
            <const>'П'</const>
          </call>
          <const>null</const>
        </call>
        <column table="a" column="kap_sum_itog" as="kap_sum_itog_23" title="Плановые суммы освоения по виду затрат СМР,Оборудование на начало " group="sum" mp="-6" if="beg23" agg="sum" exclude="1">
          <section>
            <call function="num to ym2">
              <call function="-">
                <call function="year">
                  <useparam name="dat" />
                </call>
                <const>1</const>
              </call>
              <const>12</const>
            </call>
          </section>
          <if>
            <call function="in">
              <column table="a" column="kod_smet" />
              <array>2,3</array>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_tek_pred" group="sum" if="tek_pred" exclude="1">
          <if>
            <call function="le">
              <column table="a" column="year" />
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <call function="if" as="dog_plan_cost_a" mp="[:mp]" exclude="1">
          <call function="in">
            <column table="kod_dog" column="status" />
            <array>4,12,27,13</array>
          </call>
          <column table="this" column="kap_sum_fact_tek_pred" group="" />
          <column table="a" column="dog_plan_cost" />
        </call>
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost" group="sum" colset="сумма договора без НДС" exclude="1" />
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_sm" group="sum" dimname="sm" colset="сумма договора без НДС" exclude="1" />
        <const as="dog_plan_cost_sm_key" type="number" group="sum" colset="сумма договора без НДС" exclude="1">null</const>
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_pred" group="sum" colset="сумма договора без НДС" if="pred_y" exclude="1">
          <if>
            <call function="lt">
              <call function="year">
                <column table="kod_dog_i" column="date_end_i" />
              </call>
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_tek" group="sum" colset="сумма договора без НДС" if="tek_y" exclude="1">
          <if>
            <call function="ge">
              <call function="year">
                <column table="kod_dog_i" column="date_end_i" />
              </call>
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_nds_fact" as="kap_sum_nds_fact_tek_pred" group="sum" if="tek_pred" exclude="1">
          <if>
            <call function="le">
              <column table="a" column="year" />
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <call function="if" as="dog_plan_cost_nds_a" mp="[:mp]" exclude="1">
          <call function="in">
            <column table="kod_dog" column="status" />
            <array>4,12,27,13</array>
          </call>
          <column table="this" column="kap_sum_nds_fact_tek_pred" group="" />
          <column table="a" column="dog_plan_cost_nds" />
        </call>
        <column table="this" column="dog_plan_cost_nds_a" as="dog_plan_cost_nds" group="sum" colset="сумма договора с НДС" exclude="1" />
        <column table="this" column="dog_plan_cost_nds_a" as="dog_plan_cost_nds_sm" group="sum" dimname="sm" colset="сумма договора с НДС" exclude="1" />
        <const as="dog_plan_cost_nds_sm_key" type="number" group="sum" colset="сумма договора с НДС" exclude="1">null</const>
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_nds_pred" group="sum" colset="сумма договора с НДС" if="pred_y" exclude="1" />
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_nds_tek" group="sum" colset="сумма договора с НДС" if="tek_y" exclude="1" />
        <column table="a" column="kap_sum_fact" group="sum" mp="[:mp]" exclude="1" />
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_pr_y" group="sum" if="pr_y" mp="[:mp]" colset="Подробно" exclude="1">
          <if title=" (пред годы)">
            <call function="lt">
              <column table="a" column="year" />
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_tek_y" group="sum" if="tek_y" mp="[:mp]" colset="Подробно" exclude="1">
          <if title=" (тек год)">
            <call function="=">
              <column table="a" column="year" />
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_sm" group="sum" dimname="sm" mp="[:mp]" colset="Подробно" exclude="1" />
        <call function="if" as="kap_sum_a" mp="[:mp]" exclude="1">
          <call function="in">
            <column table="kod_dog" column="status" />
            <array>4,12,27,13</array>
          </call>
          <column table="a" column="kap_sum_fact" />
          <column table="a" column="kap_sum" />
        </call>
        <column table="this" column="kap_sum_a" as="kap_sum_tek_pred" group="sum" if="tek_pred" colset="Подробно" exclude="1" />
        <column table="this" column="kap_sum_a" as="kap_sum" group="sum" dimname="years" colset="Подробно" exclude="1">
          <pivot title=" по годам" pfx="_yrs">
            <call function="=">
              <column table="a" column="year" />
              <column table="dim" column="year" />
            </call>
            <query order="name">
              <select>
                <call function="-" as="id">
                  <column table="y" column="year" />
                  <call function="year">
                    <useparam name="dat" />
                  </call>
                </call>
                <column table="y" column="name" />
                <column table="y" column="year" />
              </select>
              <from>
                <query name="spr_time_year" as="y" />
              </from>
              <where>
                <call function="between">
                  <column table="y" column="year" />
                  <call function="+">
                    <call function="year">
                      <useparam name="dat" />
                    </call>
                    <const>1</const>
                  </call>
                  <call function="+">
                    <call function="year">
                      <useparam name="dat" />
                    </call>
                    <const>5</const>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="fp_sum_nds_fact" group="sum" mp="[:mp]" exclude="1" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_pr_y" group="sum" if="pr_y" mp="[:mp]" colset="Подробно" exclude="1" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_tek_y" group="sum" if="tek_y" mp="[:mp]" colset="Подробно" exclude="1" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_sm" group="sum" dimname="sm" mp="[:mp]" colset="Подробно" exclude="1" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_av" group="sum" if="av" mp="[:mp]" colset="Подробно" exclude="1">
          <if title=" (аванс)" exclude="1">
            <call function="=1">
              <column table="a" column="is_avans" />
            </call>
          </if>
        </column>
        <column table="a" column="kredit_fact_itog_dog" group="sum" if="idt" mp="[:mp]" colset="Подробно" exclude="1">
          <section exclude="1">
            <call function="date to ym2" exclude="1">
              <call function="doomsday" />
            </call>
          </section>
        </column>
        <column table="a" column="debet_fact_itog_dog" group="sum" if="idt" mp="[:mp]" colset="Подробно" exclude="1" />
        <column table="a" column="kredit_fact_itog_smet" group="sum" if="idt" mp="[:mp]" colset="Подробно" exclude="1" />
        <column table="a" column="debet_fact_itog_smet" group="sum" if="idt" mp="[:mp]" colset="Подробно" exclude="1" />
        <column table="kod_vip_dog" column="kod_vip_dog" group="5" colset="Акт/РНО" exclude="1" />
        <column table="kod_vip_dog" column="num_doc" group="kod_vip_dog" colset="Акт/РНО" exclude="1" />
        <column table="kod_vip_dog" column="dat_doc" group="kod_vip_dog" colset="Акт/РНО" exclude="1" />
        <column table="kod_opl_period" column="kod_opl_period" group="6" colset="Акт/РНО" exclude="1" />
        <column table="kod_opl_period" column="num_rno" group="kod_opl_period" colset="Акт/РНО" exclude="1" />
        <column table="kod_opl_period" column="dat_opl" group="kod_opl_period" colset="Акт/РНО" exclude="1" />
        <column table="kod_opl_period" column="status" group="kod_opl_period" colset="Акт/РНО" title="Тип РНО" exclude="1" />
      </select>
      <from>
        <query name="ipr_fin_body_united" as="a">
          <link name="kod_dog_i">
            <link name="kod_dog" />
          </link>
          <link name="kod_ipr">
            <link name="kod_titul_ip">
              <link name="kod_direct" />
              <link name="kod_ispolnit" />
            </link>
            <link name="kod_parent">
              <link name="kod_subject" as="kod_subject_par" />
              <link name="kod_direct" as="kod_direct_par" />
              <link name="kod_ispolnit" as="kod_ispolnit_par" />
            </link>
            <link name="kod_main_titul">
              <link name="kod_subject" />
              <link name="kod_sbor_titul">
                <link name="kod_titul_ip" as="kod_titul_ip_sbor">
                  <link name="kod_subject" as="kod_subject_sbor" />
                  <link name="kod_direct" as="kod_direct_sbor" />
                  <link name="kod_ispolnit" as="kod_ispolnit_sbor" />
                </link>
              </link>
            </link>
          </link>
          <link name="kod_vip_dog" />
          <link name="kod_opl_period" />
          <extendwhere>
            <call function="and">
              <call function="true" />
              <call function="=">
                <column table="kod_ipr" column="kod_doc_osn" />
                <useparam name="kod_doc" />
              </call>
              <call function="=" selective="1">
                <column table="*" column="pr_last_smet" />
                <const>1</const>
              </call>
              <call function="or" optional="1">
                <call function="in">
                  <column table="kod_sbor_titul1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_main_titul1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_titul_ip1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
              </call>
              <call function="in" optional="1">
                <column table="kod_main_titul1" column="kod_subject" />
                <useparam name="kod_subject" />
              </call>
              <call function="le" selective="1">
                <column table="*" column="dat" />
                <useparam name="dat" />
              </call>
              <call function="or" optional="1">
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip1" column="kod_ispolnit" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="=">
                    <const>3</const>
                    <useparam name="kod_dirisp" />
                  </call>
                </call>
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip1" column="kod_direct" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="=">
                    <const>2</const>
                    <useparam name="kod_dirisp" />
                  </call>
                </call>
              </call>
            </call>
          </extendwhere>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="or">
            <call function="is null">
              <column table="kod_dog_i" column="pr_kido" />
            </call>
            <call function="=1">
              <column table="kod_dog_i" column="pr_kido" />
            </call>
          </call>
          <call function="or" exclude="1">
            <call function="is null">
              <column table="kod_dog" column="status" />
            </call>
            <call function="in">
              <column table="kod_dog" column="status" />
              <array>0,1,4,12,27,13</array>
            </call>
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
          <call function="true" />
        </call>
      </where>
    </query>-->
    <query name="29265-dat-vert-test2" grouplevel="no">
      <params>
        <usepart part="29265-params" />
      </params>
      <select>
        <!--<column table="kod_titul_ip" column="kod_titul_ip" group="1" />
        <column table="a" column="kod_titul_ip_sb" group="kod_titul_ip" />
        <column table="kod_titul_ip" column="tit_num_new_n" group="kod_titul_ip" />-->
        <column table="kod_sbor_titul" column="kod_sbor_titul" group="1" />
        <column table="kod_titul_ip_sbor" column="kod_titul_ip" as="kod_titul_ip_sbor" group="kod_sbor_titul" />
        <column table="kod_titul_ip_sbor" column="tit_num_new_n" as="tit_num_new_sbor" group="kod_sbor_titul" title="{+} (сборный)" />
        <column table="kod_titul_ip_sbor" column="name" as="name_sbor" group="kod_sbor_titul" title="{+} (сборный)" />
        <column table="kod_subject_sbor" column="abbr" as="subj_abbr_sbor" group="kod_sbor_titul" />
        <call function="if" type="string" as="podr_abbr_sbor" group="kod_sbor_titul" title="Подразделение">
          <call function="=">
            <useparam name="kod_dirisp" />
            <const>2</const>
          </call>
          <column table="kod_direct_sbor" column="name_kr" />
          <column table="kod_ispolnit_sbor" column="name_kr" />
        </call>
        <column table="kod_ipr" column="kod_parent" group="2" />
        <column table="kod_parent" column="tit_num_new_n" as="tit_num_new_par" group="kod_parent" title="{+} (головной)" />
        <column table="kod_parent" column="name" as="name_par" group="kod_parent" title="{+} (головной)" />
        <column table="kod_subject_par" column="abbr" as="subj_abbr_par" group="kod_parent" />
        <call function="if" type="string" as="podr_abbr_par" group="kod_parent" title="Подразделение">
          <call function="=">
            <useparam name="kod_dirisp" />
            <const>2</const>
          </call>
          <column table="kod_direct_par" column="name_kr" />
          <column table="kod_ispolnit_par" column="name_kr" />
        </call>
        <column table="kod_ipr" column="kod_titul_ip" group="3" />
        <column table="kod_titul_ip" column="tit_num_new_n" as="tit_num_new_n" group="kod_titul_ip" title="{+} (одиночный/дочерний)" />
        <column table="kod_titul_ip" column="name" as="name_tit" group="kod_titul_ip" title="{+} (одиночный/дочерний)" />
        <column table="kod_subject" column="abbr" as="subj_abbr" group="kod_titul_ip" />
        <call function="substr" as="itip" group="kod_titul_ip">
          <column table="kod_ipr" column="itip" />
          <const>0</const>
          <const>1</const>
        </call>
        <call function="if" type="string" as="podr_abbr" group="kod_titul_ip" title="Подразделение">
          <call function="=">
            <useparam name="kod_dirisp" />
            <const>2</const>
          </call>
          <column table="kod_direct" column="name_kr" />
          <column table="kod_ispolnit" column="name_kr" />
        </call>
        <column table="a" column="ipr_fin_ipr" group="sum" c-master="kod_titul_ip" />
        <column table="a" column="summ_k_rasp" group="sum" colset="Фиксированная" c-master="kod_titul_ip" mp="[:mp]" />
        <column table="a" column="summ_k_rasp" as="summ_k_rasp_sm" group="sum" colset="Фиксированная" c-master="kod_titul_ip" dimname="sm" mp="[:mp]">
          <pivot title=" в разрезе сметы">
            <call function="=">
              <column table="a" column="kod_smet" />
              <column table="dim" column="kod_smet" />
            </call>
            <query order="kod_smet">
              <select>
                <column table="ips_smet" column="kod_smet" />
                <column table="ips_smet" column="name" />
              </select>
              <from>
                <query name="ips_smet_structure" as="ips_smet" />
              </from>
              <where>
                <call function="and">
                  <call function="lt">
                    <column table="ips_smet" column="kod_smet" />
                    <const>5</const>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="summ_k_rasp_tek" group="sum" colset="Текущая" c-master="kod_titul_ip" mp="[:mp]" />
        <column table="a" column="summ_k_rasp_tek" as="summ_k_rasp_tek_sm" group="sum" colset="Текущая" c-master="kod_titul_ip" dimname="sm" mp="[:mp]" />
        <column table="kod_dog_i" column="kod_dog_i" group="4" title="kod_dog" />
        <column table="kod_dog_i" column="num_i" group="kod_dog_i" />
        <column table="kod_dog_i" column="predm_dog" group="kod_dog_i" />
        <column table="kod_dog_i" column="date_i" group="kod_dog_i" />
        <column table="kod_dog_i" column="date_end_i" group="kod_dog_i" />
        <column table="kod_dog_i" column="tip_i" group="kod_dog_i" />
        <column table="kod_dog_i" column="status_i" group="kod_dog_i" />
        <column table="kod_dog_i" column="name_i" group="kod_dog_i" />
        <call function="if" as="stadiya" type="string" title="Стадия реализации проекта С/П" agg="no" group="kod_titul_ip">
          <call function="between">
            <call function="year">
              <useparam name="dat" />
            </call>
            <column table="kod_titul_ip" column="beg_year" />
            <column table="kod_titul_ip" column="end_year" />
          </call>
          <call function="if">
            <call function="not 0">
              <column table="this" column="kap_sum_itog_23" />
            </call>
            <const>'С'</const>
            <const>'П'</const>
          </call>
          <const>null</const>
        </call>
        <column table="a" column="kap_sum_itog" as="kap_sum_itog_23" title="Плановые суммы освоения по виду затрат СМР,Оборудование на начало " group="sum" mp="-6" if="beg23" agg="sum">
          <section>
            <call function="num to ym2">
              <call function="-">
                <call function="year">
                  <useparam name="dat" />
                </call>
                <const>1</const>
              </call>
              <const>12</const>
            </call>
          </section>
          <if>
            <call function="in">
              <column table="a" column="kod_smet" />
              <array>2,3</array>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_tek_pred" group="sum" if="tek_pred">
          <if>
            <call function="le">
              <column table="a" column="year" />
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <call function="if" as="dog_plan_cost_a" mp="[:mp]">
          <call function="in">
            <column table="kod_dog" column="status" />
            <array>4,12,27,13</array>
          </call>
          <column table="this" column="kap_sum_fact_tek_pred" group="" />
          <column table="a" column="dog_plan_cost" />
        </call>
        <column table="a" column="dog_plan_cost" as="dog_plan_cost_1" />
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost" group="sum" colset="сумма договора без НДС" />
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_sm" group="sum" dimname="sm" colset="сумма договора без НДС" />
        <const as="dog_plan_cost_sm_key" type="number" group="sum" colset="сумма договора без НДС">null</const>
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_pred" group="sum" colset="сумма договора без НДС" if="pred_y">
          <if>
            <call function="lt">
              <call function="year">
                <column table="kod_dog_i" column="date_end_i" />
              </call>
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_tek" group="sum" colset="сумма договора без НДС" if="tek_y">
          <if>
            <call function="ge">
              <call function="year">
                <column table="kod_dog_i" column="date_end_i" />
              </call>
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_nds_fact" as="kap_sum_nds_fact_tek_pred" group="sum" if="tek_pred">
          <if>
            <call function="le">
              <column table="a" column="year" />
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <call function="if" as="dog_plan_cost_nds_a" mp="[:mp]">
          <call function="in">
            <column table="kod_dog" column="status" />
            <array>4,12,27,13</array>
          </call>
          <column table="this" column="kap_sum_nds_fact_tek_pred" group="" />
          <column table="a" column="dog_plan_cost_nds" />
        </call>
        <column table="this" column="dog_plan_cost_nds_a" as="dog_plan_cost_nds" group="sum" colset="сумма договора с НДС" />
        <column table="this" column="dog_plan_cost_nds_a" as="dog_plan_cost_nds_sm" group="sum" dimname="sm" colset="сумма договора с НДС" />
        <const as="dog_plan_cost_nds_sm_key" type="number" group="sum" colset="сумма договора с НДС">null</const>
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_nds_pred" group="sum" colset="сумма договора с НДС" if="pred_y" />
        <column table="this" column="dog_plan_cost_a" as="dog_plan_cost_nds_tek" group="sum" colset="сумма договора с НДС" if="tek_y" />
        <column table="a" column="kap_sum_fact" group="sum" mp="[:mp]" />
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_pr_y" group="sum" if="pr_y" mp="[:mp]" colset="Подробно">
          <if title=" (пред годы)">
            <call function="lt">
              <column table="a" column="year" />
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_tek_y" group="sum" if="tek_y" mp="[:mp]" colset="Подробно">
          <if title=" (тек год)">
            <call function="=">
              <column table="a" column="year" />
              <call function="year">
                <useparam name="dat" />
              </call>
            </call>
          </if>
        </column>
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_sm" group="sum" dimname="sm" mp="[:mp]" colset="Подробно" />
        <call function="if" as="kap_sum_a" mp="[:mp]">
          <call function="in">
            <column table="kod_dog" column="status" />
            <array>4,12,27,13</array>
          </call>
          <column table="a" column="kap_sum_fact" />
          <column table="a" column="kap_sum" />
        </call>
        <column table="this" column="kap_sum_a" as="kap_sum_tek_pred" group="sum" if="tek_pred" colset="Подробно" />
        <column table="this" column="kap_sum_a" as="kap_sum_yrs" group="sum" dimname="years" colset="Подробно">
          <pivot title=" по годам">
            <call function="=">
              <column table="a" column="year" />
              <column table="dim" column="year" />
            </call>
            <query order="name">
              <select>
                <call function="-" as="id">
                  <column table="y" column="year" />
                  <call function="year">
                    <useparam name="dat" />
                  </call>
                </call>
                <column table="y" column="name" />
                <column table="y" column="year" />
              </select>
              <from>
                <query name="spr_time_year" as="y" />
              </from>
              <where>
                <call function="between">
                  <column table="y" column="year" />
                  <call function="+">
                    <call function="year">
                      <useparam name="dat" />
                    </call>
                    <const>1</const>
                  </call>
                  <call function="+">
                    <call function="year">
                      <useparam name="dat" />
                    </call>
                    <const>5</const>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <!--<column table="a" column="kap_sum" group="sum" />-->
        <column table="a" column="fp_sum_nds_fact" group="sum" mp="[:mp]" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_pr_y" group="sum" if="pr_y" mp="[:mp]" colset="Подробно" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_tek_y" group="sum" if="tek_y" mp="[:mp]" colset="Подробно" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_sm" group="sum" dimname="sm" mp="[:mp]" colset="Подробно" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_av" group="sum" if="av" mp="[:mp]" colset="Подробно">
          <if title=" (аванс)">
            <call function="=1">
              <column table="a" column="is_avans" />
            </call>
          </if>
        </column>
        <column table="a" column="kredit_fact_itog_dog" group="sum" if="idt" mp="[:mp]" colset="Подробно">
          <section>
            <call function="date to ym2">
              <call function="doomsday" />
            </call>
          </section>
        </column>
        <column table="a" column="debet_fact_itog_dog" group="sum" if="idt" mp="[:mp]" colset="Подробно" />
        <column table="a" column="kredit_fact_itog_smet" group="sum" if="idt" mp="[:mp]" colset="Подробно" />
        <column table="a" column="debet_fact_itog_smet" group="sum" if="idt" mp="[:mp]" colset="Подробно" />
        <column table="kod_vip_dog" column="kod_vip_dog" group="5" colset="Акт/РНО" />
        <column table="kod_vip_dog" column="num_doc" group="kod_vip_dog" colset="Акт/РНО" />
        <column table="kod_vip_dog" column="dat_doc" group="kod_vip_dog" colset="Акт/РНО" />
        <column table="kod_opl_period" column="kod_opl_period" group="6" colset="Акт/РНО" />
        <column table="kod_opl_period" column="num_rno" group="kod_opl_period" colset="Акт/РНО" />
        <column table="kod_opl_period" column="dat_opl" group="kod_opl_period" colset="Акт/РНО" />
        <column table="kod_opl_period" column="status" group="kod_opl_period" colset="Акт/РНО" title="Тип РНО" />
      </select>
      <from>
        <query name="ipr_fin_body_united" as="a">
          <link name="kod_dog_i">
            <link name="kod_dog" />
          </link>
          <link name="kod_ipr">
            <link name="kod_titul_ip">
              <link name="kod_direct" />
              <link name="kod_ispolnit" />
            </link>
            <link name="kod_parent">
              <link name="kod_subject" as="kod_subject_par" />
              <link name="kod_direct" as="kod_direct_par" />
              <link name="kod_ispolnit" as="kod_ispolnit_par" />
            </link>
            <link name="kod_main_titul">
              <link name="kod_subject" />
              <link name="kod_sbor_titul">
                <link name="kod_titul_ip" as="kod_titul_ip_sbor">
                  <link name="kod_subject" as="kod_subject_sbor" />
                  <link name="kod_direct" as="kod_direct_sbor" />
                  <link name="kod_ispolnit" as="kod_ispolnit_sbor" />
                </link>
              </link>
            </link>
          </link>
          <link name="kod_vip_dog" />
          <link name="kod_opl_period" />
          <extendwhere>
            <call function="and">
              <call function="true" />
              <call function="=">
                <column table="kod_ipr" column="kod_doc_osn" />
                <useparam name="kod_doc" />
              </call>
              <call function="=" selective="1">
                <column table="*" column="pr_last_smet" />
                <const>1</const>
              </call>
              <!--<call function="=">
                <column table="kod_titul_ip1" column="kod_titul_ip" />
                <const>25788</const>
              </call>-->
              <call function="or" optional="1">
                <call function="in">
                  <column table="kod_sbor_titul1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_main_titul1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_titul_ip1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
              </call>
              <call function="in" optional="1">
                <column table="kod_main_titul1" column="kod_subject" />
                <useparam name="kod_subject" />
              </call>
              <call function="le" selective="1">
                <column table="*" column="dat" />
                <useparam name="dat" />
              </call>
              <call function="or" optional="1">
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip1" column="kod_ispolnit" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="=">
                    <const>3</const>
                    <useparam name="kod_dirisp" />
                  </call>
                </call>
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip1" column="kod_direct" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="=">
                    <const>2</const>
                    <useparam name="kod_dirisp" />
                  </call>
                </call>
              </call>
            </call>
          </extendwhere>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="or">
            <call function="is null">
              <column table="kod_dog_i" column="pr_kido" />
            </call>
            <call function="=1">
              <column table="kod_dog_i" column="pr_kido" />
            </call>
          </call>
          <call function="or">
            <call function="is null">
              <column table="kod_dog" column="status" />
            </call>
            <call function="in">
              <column table="kod_dog" column="status" />
              <array>0,1,4,12,27,13</array>
            </call>
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="29265-cols-tekfix" timestamp="03.06.2021 13:47:31">
      <select>
        <column table="a" column="id" key="1" />
        <column table="a" column="name" title="1" />
      </select>
      <from>
        <query name="29265-cols" as="a" />
      </from>
      <where>
        <call function="in">
          <column table="a" column="id" />
          <array>'Текущая','Фиксированная'</array>
        </call>
      </where>
    </query>
  </queries>
</root>