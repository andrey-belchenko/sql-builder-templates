<?xml version="1.0" encoding="utf-8"?>
<root>
  <reports>
    <report name="26630-testcolgr" title="Тест группировки в колонках (сальдо)" use-repository="1" visible="0" datareader1="1" use-temp1="1" timestamp="16.01.2017 18:30:37">
      <customers>
        <customer id="17" />
      </customers>
      <!--<print-templates>
        <excel>
          <template name="test_colgroup_saldo.xlsx" title="Тест группировки в колонках" print-xlsx="1" print-proc="2" del-cols="1" />
        </excel>
      </print-templates>-->
      <queries>
        <query name="ipr_fin_body_united_test4_gr" as="a">
          <!--<dimquery table="ym1" dimension="ym" />
          <dimquery table="ym1" dimension="ymtit" />
          <dimquery table="ym1" dimension="ymfc" />
          <dimquery table="ym1" dimension="ym1" />-->
        </query>
        <!--<query name="test_colgroup_saldo_ym" as="ym1" />-->
      </queries>
    </report>
  </reports>
  <queries>
    <query name="26630-dat-new2" grouplevel="no" timestamp="11.01.2017 15:11:31" use-repository="1">
      <params>
        <usepart part="26630-params" />
      </params>
      <select>
        <usepart part="26630-common-columns" />
        <column table="a" column="kod_smet" group="2" />
        <column table="kod_smet" column="name" as="smet_name" group="kod_smet" />
        <column table="a" column="kod_dog_i" group="3" />
        <column table="kod_dog_i" column="name_i" as="dog_i_name" group="kod_dog_i" />
        <column table="kod_dog_i" column="date_i" as="dog_i_date" group="kod_dog_i" />
        <column table="a" column="kodzatrat" group="4" />
        <column table="kodzatrat" column="full_name" as="zatr_full_name" group="kodzatrat" />
        <column table="kodzatrat" column="kod_parent" as="zatr_parent" group="kodzatrat" />
        <column table="e_code" column="name" as="e_name" group="kod_dog_i" />
        <call function="nvl" as="status_name" group="kod_dog_i">
          <column table="status" column="name" />
          <!--<const>'-'</const>-->
          <call function="if">
            <call function="=">
              <column table="kod_ipr_dog" column="kod_dog_type" />
              <const>52</const>
            </call>
            <const>'-'</const>
            <const>'Плановый'</const>
          </call>
        </call>
        <column table="a" column="summ_k_rasp_usr" group="sum" mp="[:mp]" as="summ_usr" exclude="1" />
        <column table="a" column="summ_k_rasp_psd" group="sum" mp="[:mp]" as="summ_psd" exclude="1" />
        <call as="summ_psd" function="if" group="sum" mp="[:mp]">
          <call function="or">
            <call function="false" />
            <call function="=1" optional="1">
              <useparam name="pr_tek_smet" />
            </call>
          </call>
          <call function="if">
            <call function="=1">
              <column table="a" column="pr_last_smet" />
            </call>
            <column table="a" column="summ_k_rasp_psd_tek" />
          </call>
          <column table="a" column="summ_k_rasp_psd" />
        </call>
        <call as="summ_usr" function="if" group="sum" mp="[:mp]">
          <call function="or">
            <call function="false" />
            <call function="=1" optional="1">
              <useparam name="pr_tek_smet" />
            </call>
          </call>
          <call function="if">
            <call function="=1">
              <column table="a" column="pr_last_smet" />
            </call>
            <column table="a" column="summ_k_rasp_usr_tek" />
          </call>
          <column table="a" column="summ_k_rasp_usr" />
        </call>
        <column table="a" column="dog_plan_cost" group="sum" mp="[:mp]" master="kod_dog_i" />
        <call function="if" type="number" as="pr_plan" group="max">
          <call function="is not null">
            <column table="a" column="kod_ipr" />
          </call>
          <const>1</const>
        </call>
        <column table="a" column="dog_plan_cost_nds" group="sum" mp="[:mp]" master="kod_dog_i" />
        <!--Освоение-->
        <column table="a" column="kap_sum" as="kap_sum_god" title="Освоение капитальных вложений план без НДС" group="sum" mp="[:mp]" if="god" colset="План">
          <usepart part="26630-if-god" />
        </column>
        <column table="a" column="kap_nds" as="kap_nds_god" title="Освоение капитальных вложений план НДС" group="sum" mp="[:mp]" if="god" colset="План" />
        <column table="a" column="kap_sum" as="kap_sum_all" title="Освоение капитальных вложений план без НДС" group="sum" mp="[:mp]" if="all" colset="План">
          <usepart part="26630-if-all" />
        </column>
        <column table="a" column="kap_sum" as="kap_sum_fix_all" title="Освоение капитальных вложений план без НДС" group="sum" mp="[:mp]" if="all" />
        <column table="a" column="kap_nds" as="kap_nds_all" title="Освоение капитальных вложений план НДС" group="sum" mp="[:mp]" if="all" colset="План" />
        <column table="a" column="kap_sum_itog" title="Освоение капитальных вложений план без НДС" group="sum" mp="[:mp]" if="ng" colset="План">
          <usepart part="26630-if-ng" />
        </column>
        <column table="a" column="kap_nds_itog" title="Освоение капитальных вложений план НДС" group="sum" mp="[:mp]" if="ng" colset="План" />
        <column table="a" column="kap_sum_itog" title="Освоение капитальных вложений план без НДС" group="sum" mp="[:mp]" if="eg" colset="План">
          <usepart part="26630-if-eg" />
        </column>
        <column table="a" column="kap_nds_itog" title="Освоение капитальных вложений план НДС" group="sum" mp="[:mp]" if="eg" colset="План" />
        <column table="a" column="kap_sum" as="kap_sum_by_per" title="Освоение капитальных вложений план без НДС" group="sum" mp="[:mp]" dimname="period" colset="План">
          <usepart part="26630-dim-period" />
        </column>
        <column table="a" column="kap_nds" as="kap_nds_by_per" title="Освоение капитальных вложений план НДС" group="sum" mp="[:mp]" dimname="period" colset="План" />
        <column table="a" column="debet_itog_smet" group="sum" mp="[:mp]" title="Дебиторская задолженность план(на уровне сметы)" if="ng" colset="План" />
        <column table="a" column="kredit_itog_smet" group="sum" mp="[:mp]" title="Кредитроская задолженность план(на уровне сметы)" if="ng" colset="План" />
        <column table="a" column="debet_itog_dog" group="sum" mp="[:mp]" title="Дебиторская задолженность план(на уровне договора)" if="ng" colset="План" />
        <column table="a" column="kredit_itog_dog" group="sum" mp="[:mp]" title="Кредитроская задолженность план(на уровне договора)" if="ng" colset="План" />
        <column table="a" column="nzs_itog" group="sum" mp="[:mp]" title="НЗС" if="ng" colset="План" />
        <column table="a" column="debet_itog_smet" group="sum" mp="[:mp]" title="Дебиторская задолженность план(на уровне сметы)" if="eg" colset="План" />
        <column table="a" column="kredit_itog_smet" group="sum" mp="[:mp]" title="Кредитроская задолженность план(на уровне сметы)" if="eg" colset="План" />
        <column table="a" column="debet_itog_dog" group="sum" mp="[:mp]" title="Дебиторская задолженность план(на уровне договора)" if="eg" colset="План" />
        <column table="a" column="kredit_itog_dog" group="sum" mp="[:mp]" title="Кредитроская задолженность план(на уровне договора)" if="eg" colset="План" />
        <column table="a" column="nzs_itog" group="sum" mp="[:mp]" title="НЗС" if="eg" colset="План" />
        <column table="a" column="debet_itog_smet" as="debet_itog_smet_by_per" group="sum" mp="[:mp]" dimname="kv" title="Дебиторская задолженность план(на уровне сметы)" colset="План">
          <pivot title=" по кварталам">
            <section>
              <column table="dim" column="ym2" />
            </section>
            <!--<call function="=">
            <column table="a" column="ym" />
            <column table="dim" column="ym2" />
          </call>-->
            <query>
              <select>
                <column table="a" column="in_year_id" />
                <column table="a" column="name" />
                <call function="date to ym2" as="ym1">
                  <column table="a" column="date_begin" />
                </call>
                <call function="date to ym2" as="ym2">
                  <column table="a" column="date_end" />
                </call>
              </select>
              <from>
                <query name="26630_time_intervals" as="a">
                  <withparams>
                    <useparam name="year" />
                    <useparam name="mon1" />
                    <useparam name="mon2" />
                  </withparams>
                </query>
              </from>
              <where>
                <call function="and">
                  <call function="in">
                    <column table="a" column="kod" />
                    <useparam name="period" />
                  </call>
                  <call function="=">
                    <column table="a" column="time_type" />
                    <const>'Квартал'</const>
                  </call>
                </call>
              </where>
            </query>
          </pivot>
        </column>
        <column table="a" column="kredit_itog_smet" as="kredit_itog_smet_by_per" group="sum" mp="[:mp]" dimname="kv" title="Кредитроская задолженность план(на уровне сметы)" colset="План" />
        <column table="a" column="debet_itog_dog" as="debet_itog_dog_by_per" group="sum" mp="[:mp]" dimname="kv" title="Дебиторская задолженность план(на уровне договора)" colset="План" />
        <column table="a" column="kredit_itog_dog" as="kredit_itog_dog_by_per" group="sum" mp="[:mp]" dimname="kv" title="Кредитроская задолженность план(на уровне договора)" colset="План" />
        <!--Ожидаемый факт-->
        <column table="a" column="kap_sum_wait" as="kap_sum_wait_god" title="Освоение капитальных вложений ожидаемый факт без НДС" group="sum" mp="[:mp]" if="god" colset="Ожидаемый факт" />
        <column table="a" column="kap_nds_wait" as="kap_nds_wait_god" title="Освоение капитальных вложений ожидаемый факт НДС" group="sum" mp="[:mp]" if="god" colset="Ожидаемый факт" />
        <column table="a" column="kap_sum_wait" as="kap_sum_wait_all" title="Освоение капитальных вложений ожидаемый факт без НДС" group="sum" mp="[:mp]" if="all" colset="Ожидаемый факт" />
        <column table="a" column="kap_nds_wait" as="kap_nds_wait_all" title="Освоение капитальных вложений ожидаемый факт НДС" group="sum" mp="[:mp]" if="all" colset="Ожидаемый факт" />
        <column table="a" column="kap_sum_wait_itog" title="Освоение капитальных вложений ожидаемый факт без НДС" group="sum" mp="[:mp]" if="ng" colset="Ожидаемый факт" />
        <column table="a" column="kap_nds_wait_itog" title="Освоение капитальных вложений ожидаемый факт НДС" group="sum" mp="[:mp]" if="ng" colset="Ожидаемый факт" />
        <column table="a" column="kap_sum_wait_itog" title="Освоение капитальных вложений ожидаемый факт без НДС" group="sum" mp="[:mp]" if="eg" colset="Ожидаемый факт" />
        <column table="a" column="kap_nds_wait_itog" title="Освоение капитальных вложений ожидаемый факт НДС" group="sum" mp="[:mp]" if="eg" colset="Ожидаемый факт" />
        <column table="a" column="kap_sum_wait" as="kap_sum_wait_by_per" title="Освоение капитальных вложений ожидаемый факт без НДС" group="sum" mp="[:mp]" dimname="period" colset="Ожидаемый факт" />
        <column table="a" column="kap_nds_wait" as="kap_nds_wait_by_per" title="Освоение капитальных вложений ожидаемый факт НДС" group="sum" mp="[:mp]" dimname="period" colset="Ожидаемый факт" />
        <column table="a" column="debet_wait_itog_smet" group="sum" mp="[:mp]" title="Дебиторская задолженность ожидаемый факт(на уровне сметы)" if="ng" colset="Ожидаемый факт" />
        <column table="a" column="kredit_wait_itog_smet" group="sum" mp="[:mp]" title="Кредитроская задолженность ожидаемый факт(на уровне сметы)" if="ng" colset="Ожидаемый факт" />
        <column table="a" column="debet_wait_itog_dog" group="sum" mp="[:mp]" title="Дебиторская задолженность ожидаемый факт(на уровне договора)" if="ng" colset="Ожидаемый факт" />
        <column table="a" column="kredit_wait_itog_dog" group="sum" mp="[:mp]" title="Кредитроская задолженность ожидаемый факт(на уровне договора)" if="ng" colset="Ожидаемый факт" />
        <column table="a" column="nzs_wait_itog" group="sum" mp="[:mp]" title="НЗС" if="ng" colset="Ожидаемый факт" />
        <column table="a" column="debet_wait_itog_smet" group="sum" mp="[:mp]" title="Дебиторская задолженность ожидаемый факт(на уровне сметы)" if="eg" colset="Ожидаемый факт" />
        <column table="a" column="kredit_wait_itog_smet" group="sum" mp="[:mp]" title="Кредитроская задолженность ожидаемый факт(на уровне сметы)" if="eg" colset="Ожидаемый факт" />
        <column table="a" column="debet_wait_itog_dog" group="sum" mp="[:mp]" title="Дебиторская задолженность ожидаемый факт(на уровне договора)" if="eg" colset="Ожидаемый факт" />
        <column table="a" column="kredit_wait_itog_dog" group="sum" mp="[:mp]" title="Кредитроская задолженность ожидаемый факт(на уровне договора)" if="eg" colset="Ожидаемый факт" />
        <column table="a" column="nzs_wait_itog" group="sum" mp="[:mp]" title="НЗС" if="eg" colset="Ожидаемый факт" />
        <column table="a" column="debet_wait_itog_smet" as="debet_wt_itog_smet_by_per" group="sum" mp="[:mp]" dimname="kv" title="Дебиторская задолженность ожидаемый факт(на уровне сметы)" colset="Ожидаемый факт" />
        <column table="a" column="kredit_wait_itog_smet" as="kredit_wt_itog_smet_by_per" group="sum" mp="[:mp]" dimname="kv" title="Кредитроская задолженность ожидаемый факт(на уровне сметы)" colset="Ожидаемый факт" />
        <column table="a" column="debet_wait_itog_dog" as="debet_wt_itog_dog_by_per" group="sum" mp="[:mp]" dimname="kv" title="Дебиторская задолженность ожидаемый факт(на уровне договора)" colset="Ожидаемый факт" />
        <column table="a" column="kredit_wait_itog_dog" as="kredit_wt_itog_dog_by_per" group="sum" mp="[:mp]" dimname="kv" title="Кредитроская задолженность ожидаемый факт(на уровне договора)" colset="Ожидаемый факт" />
        <column table="a" column="pow_mba_wait" group="sum" if="all" colset="Ожидаемый факт" title="Ввод мва  ожидаемый" />
        <column table="a" column="pow_km_wait" group="sum" if="all" colset="Ожидаемый факт" title="Ввод км  ожидаемый" />
        <call function="+nvl" group="sum" as="pow_km_all_wait" colset="Ожидаемый факт" title="Ввод км ожидаемый">
          <column table="this" column="pow_km_wait" />
          <column table="this" column="pow_km_kl_wait" />
        </call>
        <column table="a" column="pow_cnt_wait" group="sum" if="all" colset="Ожидаемый факт" title="Ввод шт. ожидаемый" />
        <column table="a" column="pow_cnt_proch_wait" group="sum" if="all" colset="Ожидаемый факт" title="Ввод шт. прочие  ожидаемый" />
        <column table="a" column="pow_mba_wait_pr" group="sum" if="all" colset="Ожидаемый факт" title="Прирост мва  ожидаемый" />
        <column table="a" column="pow_km_wait_pr" group="sum" if="all" colset="Ожидаемый факт" title="Прирост км  ожидаемый" />
        <call function="+nvl" group="sum" as="pow_km_all_wait_pr" colset="Ожидаемый факт" title="Прирост км  ожидаемый">
          <column table="this" column="pow_km_wait_pr" />
          <column table="this" column="pow_km_kl_wait_pr" />
        </call>
        <column table="a" column="pow_cnt_wait_pr" group="sum" if="all" colset="Ожидаемый факт" title="Прирост штук ожидаемый" />
        <column table="a" column="pow_cnt_proch_wait_pr" group="sum" if="all" colset="Ожидаемый факт" title="Прирост шт. прочие  ожидаемый" />
        <column table="a" column="pow_km_kl_wait" group="sum" if="all" colset="Ожидаемый факт" title="Ввод кл  ожидаемый" />
        <column table="a" column="pow_km_kl_wait_pr" group="sum" if="all" colset="Ожидаемый факт" title="Прирост кл  ожидаемый" />
        <!--Финансирование-->
        <column table="a" column="fp_sum_nds" as="fp_sum_nds_god" title="Финансирование капитальных вложений план c НДС" group="sum" mp="[:mp]" if="god" colset="План" />
        <column table="a" column="fp_nds" as="fp_nds_god" title="Финансирование капитальных вложений план НДС" group="sum" mp="[:mp]" if="god" colset="План" />
        <column table="a" column="fp_sum_nds" as="fp_sum_nds_all" title="Финансирование капитальных вложений план c НДС" group="sum" mp="[:mp]" if="all" colset="План" />
        <column table="a" column="fp_sum_nds" as="fp_sum_nds_fix_all" title="Финансирование капитальных вложений план c НДС" group="sum" mp="[:mp]" if="all" />
        <column table="a" column="fp_nds" as="fp_nds_all" title="Финансирование капитальных вложений план НДС" group="sum" mp="[:mp]" if="all" colset="План" />
        <column table="a" column="fp_sum_nds_itog" title="Финансирование капитальных вложений план c НДС" group="sum" mp="[:mp]" if="ng" colset="План" />
        <column table="a" column="fp_nds_itog" title="Финансирование капитальных вложений план НДС" group="sum" mp="[:mp]" if="ng" colset="План" />
        <column table="a" column="fp_sum_nds_itog" title="Финансирование капитальных вложений план c НДС" group="sum" mp="[:mp]" if="eg" colset="План" />
        <column table="a" column="fp_nds_itog" title="Финансирование капитальных вложений план НДС" group="sum" mp="[:mp]" if="eg" colset="План" />
        <column table="a" column="fp_sum_nds" as="fp_sum_nds_by_per" title="Финансирование капитальных вложений план c НДС" group="sum" mp="[:mp]" dimname="period" colset="План" />
        <column table="a" column="fp_nds" as="fp_nds_by_per" title="Финансирование капитальных вложений план НДС" group="sum" mp="[:mp]" dimname="period" colset="План" />
        <!--Ожидаемый факт-->
        <column table="a" column="fp_sum_nds_wait" as="fp_sum_nds_wait_god" title="Финансирование капитальных вложений ожидаемый факт c НДС" group="sum" mp="[:mp]" if="god" colset="Ожидаемый факт" />
        <column table="a" column="fp_nds_wait" as="fp_nds_wait_god" title="Финансирование капитальных вложений ожидаемый факт НДС" group="sum" mp="[:mp]" if="god" colset="Ожидаемый факт" />
        <column table="a" column="fp_sum_nds_wait" as="fp_sum_nds_wait_all" title="Финансирование капитальных вложений ожидаемый факт c НДС" group="sum" mp="[:mp]" if="all" colset="Ожидаемый факт" />
        <column table="a" column="fp_nds_wait" as="fp_nds_wait_all" title="Финансирование капитальных вложений ожидаемый факт НДС" group="sum" mp="[:mp]" if="all" colset="Ожидаемый факт" />
        <column table="a" column="fp_sum_nds_wait_itog" title="Финансирование капитальных вложений ожидаемый факт c НДС" group="sum" mp="[:mp]" if="ng" colset="Ожидаемый факт" />
        <column table="a" column="fp_nds_wait_itog" title="Финансирование капитальных вложений ожидаемый факт НДС" group="sum" mp="[:mp]" if="ng" colset="Ожидаемый факт" />
        <column table="a" column="fp_sum_nds_wait_itog" title="Финансирование капитальных вложений ожидаемый факт c НДС" group="sum" mp="[:mp]" if="eg" colset="Ожидаемый факт" />
        <column table="a" column="fp_nds_wait_itog" title="Финансирование капитальных вложений ожидаемый факт НДС" group="sum" mp="[:mp]" if="eg" colset="Ожидаемый факт" />
        <column table="a" column="fp_sum_nds_wait" as="fp_sum_nds_wait_by_per" title="Финансирование капитальных вложений ожидаемый факт c НДС" group="sum" mp="[:mp]" dimname="period" colset="Ожидаемый факт" />
        <column table="a" column="fp_nds_wait" as="fp_nds_wait_by_per" title="Финансирование капитальных вложений ожидаемый факт НДС" group="sum" mp="[:mp]" dimname="period" colset="Ожидаемый факт" />
        <!--Ввод-->
        <column table="a" column="vvod_sum" as="vvod_sum_god" title="Ввод в основные фонды план без НДС" group="sum" mp="[:mp]" if="god" colset="План" />
        <column table="a" column="vvod_sum" as="vvod_sum_all" title="Ввод в основные фонды план без НДС" group="sum" mp="[:mp]" if="all" colset="План" />
        <column table="a" column="vvod_sum" as="vvod_sum_fix_all" title="Ввод в основные фонды план без НДС" group="sum" mp="[:mp]" if="all" />
        <column table="a" column="vvod_sum_itog" title="Ввод в основные фонды план без НДС" group="sum" mp="[:mp]" if="eg" colset="План" />
        <column table="a" column="vvod_sum" as="vvod_sum_by_per" title="Ввод в основные фонды план без НДС" group="sum" mp="[:mp]" dimname="period" colset="План" />
        <!--Ожидаемый факт-->
        <column table="a" column="vvod_sum_wait" as="vvod_sum_wait_god" title="Ввод в основные фонды ожидаемый факт без НДС" group="sum" mp="[:mp]" if="god" colset="Ожидаемый факт" />
        <column table="a" column="vvod_sum_wait" as="vvod_sum_wait_all" title="Ввод в основные фонды ожидаемый факт без НДС" group="sum" mp="[:mp]" if="all" colset="Ожидаемый факт" />
        <column table="a" column="vvod_sum_wait_itog" title="Ввод в основные фонды ожидаемый факт без НДС" group="sum" mp="[:mp]" if="eg" colset="Ожидаемый факт" />
        <column table="a" column="vvod_sum_wait" as="vvod_sum_wait_by_per" title="Ввод в основные фонды ожидаемый факт без НДС" group="sum" mp="[:mp]" dimname="period" colset="Ожидаемый факт" />
        <!--Факт-->
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_all" title="Освоение капитальных вложений факт без НДС" group="sum" mp="[:mp]" if="all" colset="Факт" />
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_fix_all" title="Освоение капитальных вложений факт без НДС" group="sum" mp="[:mp]" if="all" />
        <column table="a" column="kap_nds_fact" as="kap_nds_fact_all" title="Освоение капитальных вложений факт НДС" group="sum" mp="[:mp]" if="all" colset="Факт" />
        <column table="a" column="kap_sum_fact_itog" title="Освоение капитальных вложений факт без НДС" group="sum" mp="[:mp]" if="ng" colset="Факт" />
        <column table="a" column="kap_nds_fact_itog" title="Освоение капитальных вложений факт НДС" group="sum" mp="[:mp]" if="ng" colset="Факт" />
        <column table="a" column="kap_sum_fact_itog" title="Освоение капитальных вложений факт без НДС" group="sum" mp="[:mp]" if="eg" colset="Факт" />
        <column table="a" column="kap_nds_fact_itog" title="Освоение капитальных вложений факт НДС" group="sum" mp="[:mp]" if="eg" colset="Факт" />
        <column table="a" column="kap_sum_fact" as="kap_sum_fact_by_per" title="Освоение капитальных вложений факт без НДС" group="sum" mp="[:mp]" dimname="period" colset="Факт" />
        <column table="a" column="kap_nds_fact" as="kap_nds_fact_by_per" title="Освоение капитальных вложений факт НДС" group="sum" mp="[:mp]" dimname="period" colset="Факт" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_all" title="Финансирование капитальных вложений факт c НДС" group="sum" mp="[:mp]" if="all" colset="Факт" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_fix_all" title="Финансирование капитальных вложений факт c НДС" group="sum" mp="[:mp]" if="all" />
        <column table="a" column="fp_nds_fact" as="fp_nds_fact_all" title="Финансирование капитальных вложений факт НДС" group="sum" mp="[:mp]" if="all" colset="Факт" />
        <column table="a" column="fp_sum_nds_fact_itog" title="Финансирование капитальных вложений факт c НДС" group="sum" mp="[:mp]" if="ng" colset="Факт" />
        <column table="a" column="fp_nds_fact_itog" title="Финансирование капитальных вложений факт НДС" group="sum" mp="[:mp]" if="ng" colset="Факт" />
        <column table="a" column="fp_sum_nds_fact_itog" title="Финансирование капитальных вложений факт c НДС" group="sum" mp="[:mp]" if="eg" colset="Факт" />
        <column table="a" column="fp_nds_fact_itog" title="Финансирование капитальных вложений факт НДС" group="sum" mp="[:mp]" if="eg" colset="Факт" />
        <column table="a" column="fp_sum_nds_fact" as="fp_sum_nds_fact_by_per" title="Финансирование капитальных вложений факт c НДС" group="sum" mp="[:mp]" dimname="period" colset="Факт" />
        <column table="a" column="fp_nds_fact" as="fp_nds_fact_by_per" title="Финансирование капитальных вложений факт НДС" group="sum" mp="[:mp]" dimname="period" colset="Факт" />
        <column table="a" column="vvod_sum_fact" as="vvod_sum_fact_all" title="Ввод в основные фонды факт без НДС" group="sum" mp="[:mp]" if="all" colset="Факт" />
        <column table="a" column="vvod_sum_fact" as="vvod_sum_fact_fix_all" title="Ввод в основные фонды факт без НДС" group="sum" mp="[:mp]" if="all" />
        <column table="a" column="vvod_sum_fact_itog" title="Ввод факт без НДС" group="sum" mp="[:mp]" if="ng" colset="Факт" />
        <column table="a" column="vvod_sum_fact_itog" title="Ввод в основные фонды факт без НДС" group="sum" mp="[:mp]" if="eg" colset="Факт" />
        <column table="a" column="vvod_sum_fact" as="vvod_sum_fact_by_per" title="Ввод в основные фонды факт без НДС" group="sum" mp="[:mp]" dimname="period" colset="Факт" />
        <column table="a" column="debet_fact_itog_smet" group="sum" mp="[:mp]" title="Дебиторская задолженность факт(на уровне сметы)" if="ng" colset="Факт" />
        <column table="a" column="kredit_fact_itog_smet" group="sum" mp="[:mp]" title="Кредиторская задолженность факт(на уровне сметы)" if="ng" colset="Факт" />
        <column table="a" column="debet_fact_itog_dog" group="sum" mp="[:mp]" title="Дебиторская задолженность факт(на уровне договора)" if="ng" colset="Факт" />
        <column table="a" column="kredit_fact_itog_dog" group="sum" mp="[:mp]" title="Кредиторская задолженность факт(на уровне договора)" if="ng" colset="Факт" />
        <column table="a" column="nzs_fact_itog" group="sum" mp="[:mp]" title="НЗС" if="ng" colset="Факт" />
        <column table="a" column="debet_fact_itog_smet" group="sum" mp="[:mp]" title="Дебиторская задолженность факт(на уровне сметы)" if="eg" colset="Факт" />
        <column table="a" column="kredit_fact_itog_smet" group="sum" mp="[:mp]" title="Кредиторская задолженность факт(на уровне сметы)" if="eg" colset="Факт" />
        <column table="a" column="debet_fact_itog_dog" group="sum" mp="[:mp]" title="Дебиторская задолженность факт(на уровне договора)" if="eg" colset="Факт" />
        <column table="a" column="kredit_fact_itog_dog" group="sum" mp="[:mp]" title="Кредиторская задолженность факт(на уровне договора)" if="eg" colset="Факт" />
        <column table="a" column="nzs_fact_itog" group="sum" mp="[:mp]" title="НЗС" if="eg" colset="Факт" />
        <column table="a" column="debet_fact_itog_smet" as="debet_ft_itog_smet_by_per" group="sum" mp="[:mp]" dimname="kv" title="Дебиторская задолженность факт(на уровне сметы)" colset="Факт" />
        <column table="a" column="kredit_fact_itog_smet" as="kredit_ft_itog_smet_by_per" group="sum" mp="[:mp]" dimname="kv" title="Кредиторская задолженность факт(на уровне сметы)" colset="Факт" />
        <column table="a" column="debet_fact_itog_dog" as="debet_ft_itog_dog_by_per" group="sum" mp="[:mp]" dimname="kv" title="Дебиторская задолженность факт(на уровне договора)" colset="Факт" />
        <column table="a" column="kredit_fact_itog_dog" as="kredit_ft_itog_dog_by_per" group="sum" mp="[:mp]" dimname="kv" title="Кредиторская задолженность факт(на уровне договора)" colset="Факт" />
        <column table="a" column="pow_mba" group="sum" if="all" colset="План" title="Ввод мва  план" />
        <column table="a" column="pow_km" group="sum" if="all" colset="План" title="Ввод ВЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all" colset="План" title="Ввод км  план">
          <column table="this" column="pow_km" />
          <column table="this" column="pow_km_kl" />
        </call>
        <column table="a" column="pow_km_kl" group="sum" if="all" colset="План" title="Ввод КЛ  план" />
        <column table="a" column="pow_cnt" group="sum" if="all" colset="План" title="Ввод шт  план" />
        <column table="a" column="pow_cnt_proch" title="Ввод шт прочие план" group="sum" if="all" colset="План" />
        <column table="a" column="pow_mba_pr" group="sum" if="all" colset="План" title="Прирост МВА  план" />
        <column table="a" column="pow_km_pr" group="sum" if="all" colset="План" title="Прирост вл  план" />
        <column table="a" column="pow_km_kl_pr" group="sum" if="all" colset="План" title="Прирост КЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_pr" colset="План" title="Прирост КМ  план">
          <column table="this" column="pow_km_pr" />
          <column table="this" column="pow_km_kl_pr" />
        </call>
        <column table="a" column="pow_cnt_pr" group="sum" if="all" colset="План" title="Прирост шт  план" />
        <column table="a" column="pow_cnt_proch_pr" title="Прирост шт прочие план" group="sum" if="all" colset="План" />
        <column table="a" column="pow_mba_fact" group="sum" if="all" colset="Факт" title="Ввод мва факт" />
        <column table="a" column="pow_km_fact" group="sum" if="all" colset="Факт" title="Ввод вл факт" />
        <call function="+nvl" group="sum" as="pow_km_all_fact" colset="Факт" title="Ввод км факт">
          <column table="this" column="pow_km_fact" />
          <column table="this" column="pow_km_kl_fact" />
        </call>
        <column table="a" column="pow_cnt_fact" group="sum" if="all" colset="Факт" title="Ввод шт факт" />
        <column table="a" column="pow_cnt_proch_fact" group="sum" if="all" colset="Факт" title="Ввод шт. прочие факт" />
        <column table="a" column="pow_mba_fact_pr" group="sum" if="all" colset="Факт" title="Прирост мва факт" />
        <column table="a" column="pow_km_fact_pr" group="sum" if="all" colset="Факт" title="Прирост ВЛ факт" />
        <call function="+nvl" group="sum" as="pow_km_all_fact_pr" colset="Факт" title="Прирост КМ факт">
          <column table="this" column="pow_km_fact_pr" />
          <column table="this" column="pow_km_kl_fact_pr" />
        </call>
        <column table="a" column="pow_cnt_fact_pr" group="sum" if="all" colset="Факт" title="Прирост шт. факт" />
        <column table="a" column="pow_cnt_proch_fact_pr" group="sum" if="all" colset="Факт" title="Прирост шт. прочие факт" />
        <column table="a" column="pow_km_kl_fact" group="sum" if="all" colset="Факт" title="Ввод КЛ факт" />
        <column table="a" column="pow_km_kl_fact_pr" group="sum" if="all" colset="Факт" title="Прирост КЛ факт" />
        <!--<column table="a" column="pow_mba" as="pow_mba_by_per" group="sum" dimname="period" colset="План" title="Ввод мва  план" />
        <column table="a" column="pow_km" as="pow_km_by_per"  group="sum" dimname="period" colset="План" title="Ввод ВЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_by_per" colset="План" title="Ввод км  план" dimname="period">
          <column table="a" column="pow_km" />
          <column table="a" column="pow_km_kl" />
        </call>
        <column table="a" column="pow_km_kl" as="pow_km_kl_by_per" group="sum" dimname="period" colset="План" title="Ввод КЛ  план" />
        <column table="a" column="pow_cnt" as="pow_cnt_by_per" group="sum" dimname="period" colset="План" title="Ввод шт  план" />
        <column table="a" column="pow_cnt_proch" as="pow_cnt_proch_by_per" title="Ввод шт прочие план" group="sum" dimname="period" colset="План" />
        <column table="a" column="pow_mba_pr" as="pow_mba_pr_by_per" group="sum" dimname="period" colset="План" title="Прирост МВА  план" />
        <column table="a" column="pow_km_pr" as="pow_km_pr_by_per" group="sum" dimname="period" colset="План" title="Прирост вл  план" />
        <column table="a" column="pow_km_kl_pr" as="pow_km_kl_pr_by_per" group="sum" dimname="period" colset="План" title="Прирост КЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_pr_by_per" dimname="period" colset="План" title="Прирост КМ  план">
          <column table="a" column="pow_km_pr" />
          <column table="a" column="pow_km_kl_pr" />
        </call>
        <column table="a" column="pow_cnt_pr" as="pow_cnt_pr_by_per" group="sum" dimname="period" colset="План" title="Прирост шт  план" />
        <column table="a" column="pow_cnt_proch_pr" as="pow_cnt_proch_pr_by_per" title="Прирост шт прочие план" group="sum" dimname="period" colset="План" />-->
        <!--<column table="a" column="pow_mba_fact" as="pow_mba_fact_by_per" group="sum" dimname="period" colset="Факт" title="Ввод мва факт" />
        <column table="a" column="pow_km_fact" as="pow_km_fact_by_per" group="sum" dimname="period" colset="Факт" title="Ввод вл факт" />
        <call function="+nvl" group="sum" as="pow_km_all_fact_by_per" colset="Факт" title="Ввод км факт" dimname="period">
          <column table="a" column="pow_km_fact" />
          <column table="a" column="pow_km_kl_fact" />
        </call>
        <column table="a" column="pow_cnt_fact" as="pow_cnt_fact_by_per" group="sum" dimname="period" colset="Факт" title="Ввод шт факт" />
        <column table="a" column="pow_cnt_proch_fact" as="pow_cnt_proch_fact_by_per" group="sum" dimname="period" colset="Факт" title="Ввод шт. прочие факт" />
        <column table="a" column="pow_mba_fact_pr"  as="pow_mba_fact_pr_by_per" group="sum" dimname="period" colset="Факт" title="Прирост мва факт" />
        <column table="a" column="pow_km_fact_pr" as="pow_km_fact_pr_by_per" group="sum" dimname="period" colset="Факт" title="Прирост ВЛ факт" />
        <call function="+nvl" group="sum" as="pow_km_all_fact_pr_by_per" colset="Факт" title="Прирост КМ факт" dimname="period">
          <column table="a" column="pow_km_fact_pr" />
          <column table="a" column="pow_km_kl_fact_pr" />
        </call>
        <column table="a" column="pow_cnt_fact_pr"  as="pow_cnt_fact_pr_by_per" group="sum" dimname="period" colset="Факт" title="Прирост шт. факт" />
        <column table="a" column="pow_cnt_proch_fact_pr"  as="pow_cnt_proch_fact_pr_by_per" group="sum" dimname="period" colset="Факт" title="Прирост шт. прочие факт" />
        <column table="a" column="pow_km_kl_fact"   as="pow_km_kl_fact_by_per" group="sum" dimname="period" colset="Факт" title="Ввод КЛ факт" />
        <column table="a" column="pow_km_kl_fact_pr"  as="pow_km_kl_fact_pr_by_per" group="sum" dimname="period" colset="Факт" title="Прирост КЛ факт" />-->
        <column table="a" column="kap_sum_fact_sp" as="kap_sum_fact_sp_by_per" group="sum" mp="[:mp]" dimname="kv" colset="Факт" />
        <column table="a" column="kap_sum_fact_per" as="kap_sum_fact_per_by_per" group="sum" mp="[:mp]" dimname="kv" colset="Факт" />
        <column table="a" column="kap_sum_fact_pri" as="kap_sum_fact_pri_by_per" group="sum" mp="[:mp]" dimname="kv" colset="Факт" />
        <call function="-nvl" as="kap_sum_fact_pp_by_per" group="sum" dimname="kv" title="Передано/принято" colset="Факт">
          <column table="a" column="kap_sum_fact_pri" mp="[:mp]" />
          <column table="a" column="kap_sum_fact_per" mp="[:mp]" />
        </call>
        <call function="" as="kap_sum_fact_null" group="sum" dimname="kv" colset="Факт" type="number">
          <const>null</const>
        </call>
        <column table="a" column="kap_sum_fact_sp" as="kap_sum_fact_sp_all" group="sum" mp="[:mp]" if="all" colset="Факт" />
        <column table="a" column="kap_sum_fact_per" as="kap_sum_fact_per_all" group="sum" mp="[:mp]" if="all" colset="Факт" />
        <column table="a" column="kap_sum_fact_pri" as="kap_sum_fact_pri_all" group="sum" mp="[:mp]" colset="Факт" />
        <call function="-nvl" as="kap_sum_fact_pp_all" group="sum" mp="[:mp]" if="all" title="Передано/принято" colset="Факт">
          <column table="a" column="kap_sum_fact_pri" />
          <column table="a" column="kap_sum_fact_per" />
        </call>
        <column table="ipr_planfactanaliz" column="kvl_prim" dgroup="stragg_dist" group="max" />
        <column table="ipr_planfactanaliz" column="fin_prim" dgroup="stragg_dist" group="max" />
        <column table="ipr_planfactanaliz" column="vv_prim" dgroup="stragg_dist" group="max" />
      </select>
      <from>
        <query name="ipr_fin_body_united" as="a">
          <extendwhere exclude="1">
            <call function="and">
              <call function="=">
                <column table="kod_doc_osn" column="kod_doc" />
                <useparam name="kod_doc" />
              </call>
              <call function="in" optional="1">
                <column table="kod_main_titul" column="kod_subject" />
                <useparam name="kod_subject" />
              </call>
              <call function="or" optional="1">
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip" column="kod_direct" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="in">
                    <useparam name="kod_dirisp" />
                    <array>1,2</array>
                  </call>
                </call>
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip" column="kod_ispolnit" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="in">
                    <useparam name="kod_dirisp" />
                    <array>1,3</array>
                  </call>
                </call>
              </call>
              <call function="or" optional="1">
                <call function="in">
                  <column table="kod_titul_ip" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_main_titul" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_sbor_titul1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
              </call>
              <call function="not" optional="1">
                <call function="=">
                  <column table="kod_titul_ip" column="kod_aip" />
                  <useparam name="pr_notaip" />
                </call>
              </call>
              <call function="and" optional="1">
                <call function="=1">
                  <useparam name="pr_all_fact_not" />
                </call>
                <call function="is not null">
                  <column table="kod_ipr" column="kod_ipr" />
                </call>
              </call>
            </call>
          </extendwhere>
          <withparams exclude="1">
            <useparam name="kod_titul_ip" />
            <useparam name="year" />
          </withparams>
          <link name="kod_ipr" as="ipr_ipr_data">
            <dlink name="ipr_planfactanaliz">
              <where>
                <call function="and">
                  <call function="=">
                    <column table="ipr_planfactanaliz" column="kod_doc" />
                    <useparam name="kod_doc" />
                  </call>
                  <call function="=">
                    <column table="ipr_planfactanaliz" column="year" />
                    <useparam name="year" />
                  </call>
                  <call function="between">
                    <column table="ipr_planfactanaliz" column="kvart" />
                    <call function="mes to kv">
                      <useparam name="mon1" />
                    </call>
                    <call function="mes to kv">
                      <useparam name="mon2" />
                    </call>
                  </call>
                </call>
              </where>
            </dlink>
            <link name="kod_kriteria" exclude="1" />
            <link name="kod_priority_insert_ip" exclude="1" />
            <link name="kod_klass" exclude="1" />
            <link name="kod_status" />
          </link>
          <link name="kod_ipr_ext">
            <link name="kod_razdel" />
          </link>
          <link name="kod_titul_ip">
            <link name="kod_direct" />
            <link name="kod_ispolnit" />
          </link>
          <link name="kod_main_titul">
            <link name="kod_subject" as="kod_subject_main" />
            <link name="kod_direct" as="kod_direct_main" />
            <link name="kod_ispolnit" as="kod_ispolnit_main" />
            <link name="kod_sbor_titul">
              <link name="kod_titul_ip" as="kod_titul_ip_sbor" />
            </link>
          </link>
          <!--<link name="kod_dog"/>-->
          <link name="kod_smet" />
          <link name="kodzatrat" />
          <link name="kod_dog">
            <link name="e_code" />
            <link name="status" />
          </link>
          <link name="kod_dog_i" />
          <link name="kod_ipr_dog" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="kod_doc_osn" />
            <useparam name="kod_doc" />
          </call>
          <call function="in" optional="1">
            <column table="kod_main_titul" column="kod_subject" />
            <useparam name="kod_subject" />
          </call>
          <call function="or" optional="1">
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_direct" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,2</array>
              </call>
            </call>
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_ispolnit" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,3</array>
              </call>
            </call>
          </call>
          <call function="or" optional="1">
            <call function="in">
              <column table="a" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="a" column="kod_main_titul" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_sbor_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
          <call function="and" optional="1">
            <call function="=1">
              <useparam name="pr_all_fact_not" />
            </call>
            <call function="=nvl">
              <column table="a" column="kod_ipr" />
              <column table="a" column="kod_ipr_ext" />
            </call>
          </call>
          <!--заменить на section-->
          <call function="or">
            <call function="is null">
              <column table="a" column="ym" />
            </call>
            <call function="and">
              <call function="le">
                <column table="a" column="ym" />
                <call function="num to ym2">
                  <useparam name="year" />
                  <const>12</const>
                </call>
              </call>
              <call function="or">
                <call function="ge">
                  <column table="a" column="ym" />
                  <call function="ym2 add month">
                    <call function="num to ym2">
                      <useparam name="year" />
                      <const>1</const>
                    </call>
                    <const>-1</const>
                  </call>
                </call>
                <call function="ge">
                  <column table="a" column="ym_nxt" />
                  <call function="ym2 add month">
                    <call function="num to ym2">
                      <useparam name="year" />
                      <const>1</const>
                    </call>
                    <const>-1</const>
                  </call>
                </call>
                <call function="is null">
                  <column table="a" column="ym_nxt" />
                </call>
              </call>
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_titul_ip" column="pr_ofz" />
            <useparam name="kod_ofz" />
          </call>
          <call function="is not null" comment="химия. когда вырезается условие по подразделениям , дает ошибку из-за лишнего параметра">
            <useparam name="kod_dirisp" />
          </call>
          <!--<call function="between">
            <call function="nvl">
              <column table="a" column="ym" />
              <call function="num to ym2">
                <useparam  name="year"/>
                <useparam  name="mon1"/>
              </call>
            </call>
            <call function="ym2 add month">
              <call function="num to ym2">
                <useparam  name="year"/>
                <const>1</const>
              </call>
              <const>-1</const>
            </call>
            <call function="num to ym2">
              <useparam  name="year"/>
              <const>12</const>
            </call>
          </call>-->
        </call>
      </where>
    </query>
    <query name="26630-dat-vvod-new-2" grouplevel="no" timestamp="14.01.2017 15:49:35">
      <params>
        <usepart part="26630-params" />
      </params>
      <select>
        <usepart part="26630-common-columns" />
        <column table="a" column="vvod_sum" as="vvod_sum_god" title="Ввод в основные фонды план без НДС" group="sum" mp="[:mp]" if="god" colset="План">
          <usepart part="26630-if-god" />
        </column>
        <column table="a" column="vvod_sum" as="vvod_sum_all" title="Ввод в основные фонды план без НДС" group="sum" mp="[:mp]" if="all" colset="План">
          <usepart part="26630-if-all" />
        </column>
        <column table="a" column="vvod_sum_itog" title="Ввод в основные фонды план без НДС" group="sum" mp="[:mp]" if="ng" colset="План">
          <usepart part="26630-if-ng" />
        </column>
        <column table="a" column="vvod_sum_itog" title="Ввод в основные фонды план без НДС" group="sum" mp="[:mp]" if="eg" colset="План">
          <usepart part="26630-if-eg" />
        </column>
        <column table="a" column="vvod_sum" as="vvod_sum_by_per" title="Ввод в основные фонды план без НДС" group="sum" mp="[:mp]" dimname="period" colset="План">
          <usepart part="26630-dim-period" />
        </column>
        <column table="a" column="vvod_sum_fact" as="vvod_sum_fact_all" title="Ввод в основные фонды факт без НДС" group="sum" mp="[:mp]" if="all" colset="Факт" />
        <column table="a" column="vvod_sum_fact_itog" title="Ввод факт без НДС" group="sum" mp="[:mp]" if="ng" colset="Факт" />
        <column table="a" column="vvod_sum_fact_itog" title="Ввод в основные фонды факт без НДС" group="sum" mp="[:mp]" if="eg" colset="Факт" />
        <column table="a" column="vvod_sum_fact" as="vvod_sum_fact_by_per" title="Ввод в основные фонды факт без НДС" group="sum" mp="[:mp]" dimname="period" colset="Факт" />
        <!--<column table="a" column="pow_mba_itog" group="sum" if="ng" colset="План" title="Ввод мва  план" />-->
        <column table="a" column="pow_any" as="pow_any_god" group="sum" if="god" colset="План" />
        <column table="a" column="pow_any" as="pow_any_all" group="sum" if="all" colset="План" />
        <column table="a" column="pow_any_itog" group="sum" if="ng" colset="План" />
        <column table="a" column="pow_any_itog" group="sum" if="eg" colset="План" />
        <column table="a" column="pow_any" as="pow_any_by_per" group="sum" dimname="period" colset="План" />
        <column table="a" column="pow_any_fact" as="pow_any_fact_all" group="sum" if="all" colset="Факт" />
        <column table="a" column="pow_any_fact_itog" group="sum" if="ng" colset="Факт" />
        <column table="a" column="pow_any_fact_itog" group="sum" if="eg" colset="Факт" />
        <column table="a" column="pow_any_fact" as="pow_any_fact_by_per" group="sum" dimname="period" colset="Факт" />
        <!--год-->
        <column table="a" column="pow_mba" as="pow_mba_god" group="sum" if="god" colset="План" title="Ввод мва  план" />
        <column table="a" column="pow_km" as="pow_km_god" group="sum" if="god" colset="План" title="Ввод ВЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_god" colset="План" title="Ввод км  план">
          <column table="this" column="pow_km_god" />
          <column table="this" column="pow_km_kl_god" />
        </call>
        <column table="a" column="pow_km_kl" as="pow_km_kl_god" group="sum" if="god" colset="План" title="Ввод КЛ  план" />
        <column table="a" column="pow_cnt" as="pow_cnt_god" group="sum" if="god" colset="План" title="Ввод шт  план" />
        <column table="a" column="pow_cnt_proch" as="pow_cnt_proch_god" title="Ввод шт прочие план" group="sum" if="god" colset="План" />
        <column table="a" column="pow_mba_pr" as="pow_mba_pr_god" group="sum" if="god" colset="План" title="Прирост МВА  план" />
        <column table="a" column="pow_km_pr" as="pow_km_pr_god" group="sum" if="god" colset="План" title="Прирост вл  план" />
        <column table="a" column="pow_km_kl_pr" as="pow_km_kl_pr_god" group="sum" if="god" colset="План" title="Прирост КЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_pr_god" colset="План" title="Прирост КМ  план">
          <column table="this" column="pow_km_pr_god" />
          <column table="this" column="pow_km_kl_pr_god" />
        </call>
        <column table="a" column="pow_cnt_pr" as="pow_cnt_pr_god" group="sum" if="god" colset="План" title="Прирост шт  план" />
        <column table="a" column="pow_cnt_proch_pr" as="pow_cnt_proch_pr_god" title="Прирост шт прочие план" group="sum" if="god" colset="План" />
        <!--начало периода-->
        <column table="a" column="pow_mba_itog" group="sum" if="ng" colset="План" title="Ввод мва  план" />
        <column table="a" column="pow_km_itog" group="sum" if="ng" colset="План" title="Ввод ВЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_itog_ng" colset="План" title="Ввод км  план">
          <column table="this" column="pow_km_itog_ng" />
          <column table="this" column="pow_km_kl_itog_ng" />
        </call>
        <column table="a" column="pow_km_kl_itog" group="sum" if="ng" colset="План" title="Ввод КЛ  план" />
        <column table="a" column="pow_cnt_itog" group="sum" if="ng" colset="План" title="Ввод шт  план" />
        <column table="a" column="pow_cnt_proch_itog" title="Ввод шт прочие план" group="sum" if="ng" colset="План" />
        <column table="a" column="pow_mba_pr_itog" group="sum" if="ng" colset="План" title="Прирост МВА  план" />
        <column table="a" column="pow_km_pr_itog" group="sum" if="ng" colset="План" title="Прирост вл  план" />
        <column table="a" column="pow_km_kl_pr_itog" group="sum" if="ng" colset="План" title="Прирост КЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_pr_itog_ng" colset="План" title="Прирост КМ  план">
          <column table="this" column="pow_km_pr_itog_ng" />
          <column table="this" column="pow_km_kl_pr_itog_ng" />
        </call>
        <column table="a" column="pow_cnt_pr_itog" group="sum" if="ng" colset="План" title="Прирост шт  план" />
        <column table="a" column="pow_cnt_proch_pr_itog" title="Прирост шт прочие план" group="sum" if="ng" colset="План" />
        <column table="a" column="pow_mba_fact_itog" group="sum" if="ng" colset="Факт" title="Ввод мва факт" />
        <column table="a" column="pow_km_fact_itog" group="sum" if="ng" colset="Факт" title="Ввод вл факт" />
        <call function="+nvl" group="sum" as="pow_km_all_fact_itog_ng" colset="Факт" title="Ввод км факт">
          <column table="this" column="pow_km_fact_itog_ng" />
          <column table="this" column="pow_km_kl_fact_itog_ng" />
        </call>
        <column table="a" column="pow_cnt_fact_itog" group="sum" if="ng" colset="Факт" title="Ввод шт факт" />
        <column table="a" column="pow_cnt_proch_fact_itog" group="sum" if="ng" colset="Факт" title="Ввод шт. прочие факт" />
        <column table="a" column="pow_mba_fact_pr_itog" group="sum" if="ng" colset="Факт" title="Прирост мва факт" />
        <column table="a" column="pow_km_fact_pr_itog" group="sum" if="ng" colset="Факт" title="Прирост ВЛ факт" />
        <call function="+nvl" group="sum" as="pow_km_all_fact_pr_itog_ng" colset="Факт" title="Прирост КМ факт">
          <column table="this" column="pow_km_fact_pr_itog_ng" />
          <column table="this" column="pow_km_kl_fact_pr_itog_ng" />
        </call>
        <column table="a" column="pow_cnt_fact_pr_itog" group="sum" if="ng" colset="Факт" title="Прирост шт. факт" />
        <column table="a" column="pow_cnt_proch_fact_pr_itog" group="sum" if="ng" colset="Факт" title="Прирост шт. прочие факт" />
        <column table="a" column="pow_km_kl_fact_itog" group="sum" if="ng" colset="Факт" title="Ввод КЛ факт" />
        <column table="a" column="pow_km_kl_fact_pr_itog" group="sum" if="ng" colset="Факт" title="Прирост КЛ факт" />
        <!--конец периода-->
        <column table="a" column="pow_mba_itog" group="sum" if="eg" colset="План" title="Ввод мва  план" />
        <column table="a" column="pow_km_itog" group="sum" if="eg" colset="План" title="Ввод ВЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_itog_eg" colset="План" title="Ввод км  план">
          <column table="this" column="pow_km_itog_eg" />
          <column table="this" column="pow_km_kl_itog_eg" />
        </call>
        <column table="a" column="pow_km_kl_itog" group="sum" if="eg" colset="План" title="Ввод КЛ  план" />
        <column table="a" column="pow_cnt_itog" group="sum" if="eg" colset="План" title="Ввод шт  план" />
        <column table="a" column="pow_cnt_proch_itog" title="Ввод шт прочие план" group="sum" if="eg" colset="План" />
        <column table="a" column="pow_mba_pr_itog" group="sum" if="eg" colset="План" title="Прирост МВА  план" />
        <column table="a" column="pow_km_pr_itog" group="sum" if="eg" colset="План" title="Прирост вл  план" />
        <column table="a" column="pow_km_kl_pr_itog" group="sum" if="eg" colset="План" title="Прирост КЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_pr_itog_eg" colset="План" title="Прирост КМ  план">
          <column table="this" column="pow_km_pr_itog_eg" />
          <column table="this" column="pow_km_kl_pr_itog_eg" />
        </call>
        <column table="a" column="pow_cnt_pr_itog" group="sum" if="eg" colset="План" title="Прирост шт  план" />
        <column table="a" column="pow_cnt_proch_pr_itog" title="Прирост шт прочие план" group="sum" if="eg" colset="План" />
        <column table="a" column="pow_mba_fact_itog" group="sum" if="eg" colset="Факт" title="Ввод мва факт" />
        <column table="a" column="pow_km_fact_itog" group="sum" if="eg" colset="Факт" title="Ввод вл факт" />
        <call function="+nvl" group="sum" as="pow_km_all_fact_itog_eg" colset="Факт" title="Ввод км факт">
          <column table="this" column="pow_km_fact_itog_eg" />
          <column table="this" column="pow_km_kl_fact_itog_eg" />
        </call>
        <column table="a" column="pow_cnt_fact_itog" group="sum" if="eg" colset="Факт" title="Ввод шт факт" />
        <column table="a" column="pow_cnt_proch_fact_itog" group="sum" if="eg" colset="Факт" title="Ввод шт. прочие факт" />
        <column table="a" column="pow_mba_fact_pr_itog" group="sum" if="eg" colset="Факт" title="Прирост мва факт" />
        <column table="a" column="pow_km_fact_pr_itog" group="sum" if="eg" colset="Факт" title="Прирост ВЛ факт" />
        <call function="+nvl" group="sum" as="pow_km_all_fact_pr_itog_eg" colset="Факт" title="Прирост КМ факт">
          <column table="this" column="pow_km_fact_pr_itog_eg" />
          <column table="this" column="pow_km_kl_fact_pr_itog_eg" />
        </call>
        <column table="a" column="pow_cnt_fact_pr_itog" group="sum" if="eg" colset="Факт" title="Прирост шт. факт" />
        <column table="a" column="pow_cnt_proch_fact_pr_itog" group="sum" if="eg" colset="Факт" title="Прирост шт. прочие факт" />
        <column table="a" column="pow_km_kl_fact_itog" group="sum" if="eg" colset="Факт" title="Ввод КЛ факт" />
        <column table="a" column="pow_km_kl_fact_pr_itog" group="sum" if="eg" colset="Факт" title="Прирост КЛ факт" />
        <!--весь период-->
        <column table="a" column="pow_mba" as="pow_mba_all" group="sum" if="all" colset="План" title="Ввод мва  план" />
        <column table="a" column="pow_km" as="pow_km_all" group="sum" if="all" colset="План" title="Ввод ВЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_all" colset="План" title="Ввод км  план">
          <column table="this" column="pow_km_all" />
          <column table="this" column="pow_km_kl_all" />
        </call>
        <column table="a" column="pow_km_kl" as="pow_km_kl_all" group="sum" if="all" colset="План" title="Ввод КЛ  план" />
        <column table="a" column="pow_cnt" as="pow_cnt_all" group="sum" if="all" colset="План" title="Ввод шт  план" />
        <column table="a" column="pow_cnt_proch" as="pow_cnt_proch_all" title="Ввод шт прочие план" group="sum" if="all" colset="План" />
        <column table="a" column="pow_mba_pr" as="pow_mba_pr_all" group="sum" if="all" colset="План" title="Прирост МВА  план" />
        <column table="a" column="pow_km_pr" as="pow_km_pr_all" group="sum" if="all" colset="План" title="Прирост вл  план" />
        <column table="a" column="pow_km_kl_pr" as="pow_km_kl_pr_all" group="sum" if="all" colset="План" title="Прирост КЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_pr_all" colset="План" title="Прирост КМ  план">
          <column table="this" column="pow_km_pr_all" />
          <column table="this" column="pow_km_kl_pr_all" />
        </call>
        <column table="a" column="pow_cnt_pr" as="pow_cnt_pr_all" group="sum" if="all" colset="План" title="Прирост шт  план" />
        <column table="a" column="pow_cnt_proch_pr" as="pow_cnt_proch_pr_all" title="Прирост шт прочие план" group="sum" if="all" colset="План" />
        <column table="a" column="pow_mba_fact" as="pow_mba_fact_all" group="sum" if="all" colset="Факт" title="Ввод мва факт" />
        <column table="a" column="pow_km_fact" as="pow_km_fact_all" group="sum" if="all" colset="Факт" title="Ввод вл факт" />
        <call function="+nvl" group="sum" as="pow_km_all_fact_all" colset="Факт" title="Ввод км факт">
          <column table="this" column="pow_km_fact_all" />
          <column table="this" column="pow_km_kl_fact_all" />
        </call>
        <column table="a" column="pow_cnt_fact" as="pow_cnt_fact_all" group="sum" if="all" colset="Факт" title="Ввод шт факт" />
        <column table="a" column="pow_cnt_proch_fact" as="pow_cnt_proch_fact_all" group="sum" if="all" colset="Факт" title="Ввод шт. прочие факт" />
        <column table="a" column="pow_mba_fact_pr" as="pow_mba_fact_pr_all" group="sum" if="all" colset="Факт" title="Прирост мва факт" />
        <column table="a" column="pow_km_fact_pr" as="pow_km_fact_pr_all" group="sum" if="all" colset="Факт" title="Прирост ВЛ факт" />
        <call function="+nvl" group="sum" as="pow_km_all_fact_pr_all" colset="Факт" title="Прирост КМ факт">
          <column table="this" column="pow_km_fact_pr_all" />
          <column table="this" column="pow_km_kl_fact_pr_all" />
        </call>
        <column table="a" column="pow_cnt_fact_pr" as="pow_cnt_fact_pr_all" group="sum" if="all" colset="Факт" title="Прирост шт. факт" />
        <column table="a" column="pow_cnt_proch_fact_pr" as="pow_cnt_proch_fact_pr_all" group="sum" if="all" colset="Факт" title="Прирост шт. прочие факт" />
        <column table="a" column="pow_km_kl_fact" as="pow_km_kl_fact_all" group="sum" if="all" colset="Факт" title="Ввод КЛ факт" />
        <column table="a" column="pow_km_kl_fact_pr" as="pow_km_kl_fact_pr_all" group="sum" if="all" colset="Факт" title="Прирост КЛ факт" />
        <!--по периодам-->
        <column table="a" column="pow_mba" as="pow_mba_by_per" group="sum" dimname="period" colset="План" title="Ввод мва  план" />
        <column table="a" column="pow_km" as="pow_km_by_per" group="sum" dimname="period" colset="План" title="Ввод ВЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_by_per" colset="План" title="Ввод км  план" dimname="period">
          <column table="a" column="pow_km" />
          <column table="a" column="pow_km_kl" />
        </call>
        <column table="a" column="pow_km_kl" as="pow_km_kl_by_per" group="sum" dimname="period" colset="План" title="Ввод КЛ  план" />
        <column table="a" column="pow_cnt" as="pow_cnt_by_per" group="sum" dimname="period" colset="План" title="Ввод шт  план" />
        <column table="a" column="pow_cnt_proch" as="pow_cnt_proch_by_per" title="Ввод шт прочие план" group="sum" dimname="period" colset="План" />
        <column table="a" column="pow_mba_pr" as="pow_mba_pr_by_per" group="sum" dimname="period" colset="План" title="Прирост МВА  план" />
        <column table="a" column="pow_km_pr" as="pow_km_pr_by_per" group="sum" dimname="period" colset="План" title="Прирост вл  план" />
        <column table="a" column="pow_km_kl_pr" as="pow_km_kl_pr_by_per" group="sum" dimname="period" colset="План" title="Прирост КЛ  план" />
        <call function="+nvl" group="sum" as="pow_km_all_pr_by_per" dimname="period" colset="План" title="Прирост КМ  план">
          <column table="a" column="pow_km_pr" />
          <column table="a" column="pow_km_kl_pr" />
        </call>
        <column table="a" column="pow_cnt_pr" as="pow_cnt_pr_by_per" group="sum" dimname="period" colset="План" title="Прирост шт  план" />
        <column table="a" column="pow_cnt_proch_pr" as="pow_cnt_proch_pr_by_per" title="Прирост шт прочие план" group="sum" dimname="period" colset="План" />
        <column table="a" column="pow_mba_fact" as="pow_mba_fact_by_per" group="sum" dimname="period" colset="Факт" title="Ввод мва факт" />
        <column table="a" column="pow_km_fact" as="pow_km_fact_by_per" group="sum" dimname="period" colset="Факт" title="Ввод вл факт" />
        <call function="+nvl" group="sum" as="pow_km_all_fact_by_per" colset="Факт" title="Ввод км факт" dimname="period">
          <column table="a" column="pow_km_fact" />
          <column table="a" column="pow_km_kl_fact" />
        </call>
        <column table="a" column="pow_cnt_fact" as="pow_cnt_fact_by_per" group="sum" dimname="period" colset="Факт" title="Ввод шт факт" />
        <column table="a" column="pow_cnt_proch_fact" as="pow_cnt_proch_fact_by_per" group="sum" dimname="period" colset="Факт" title="Ввод шт. прочие факт" />
        <column table="a" column="pow_mba_fact_pr" as="pow_mba_fact_pr_by_per" group="sum" dimname="period" colset="Факт" title="Прирост мва факт" />
        <column table="a" column="pow_km_fact_pr" as="pow_km_fact_pr_by_per" group="sum" dimname="period" colset="Факт" title="Прирост ВЛ факт" />
        <call function="+nvl" group="sum" as="pow_km_all_fact_pr_by_per" colset="Факт" title="Прирост КМ факт" dimname="period">
          <column table="a" column="pow_km_fact_pr" />
          <column table="a" column="pow_km_kl_fact_pr" />
        </call>
        <column table="a" column="pow_cnt_fact_pr" as="pow_cnt_fact_pr_by_per" group="sum" dimname="period" colset="Факт" title="Прирост шт. факт" />
        <column table="a" column="pow_cnt_proch_fact_pr" as="pow_cnt_proch_fact_pr_by_per" group="sum" dimname="period" colset="Факт" title="Прирост шт. прочие факт" />
        <column table="a" column="pow_km_kl_fact" as="pow_km_kl_fact_by_per" group="sum" dimname="period" colset="Факт" title="Ввод КЛ факт" />
        <column table="a" column="pow_km_kl_fact_pr" as="pow_km_kl_fact_pr_by_per" group="sum" dimname="period" colset="Факт" title="Прирост КЛ факт" />
      </select>
      <from>
        <query name="ipr_fin_body_united" as="a">
          <extendwhere exclude="1">
            <call function="and">
              <call function="=">
                <column table="kod_doc_osn" column="kod_doc" />
                <useparam name="kod_doc" />
              </call>
              <call function="=" exclude="1">
                <column table="kod_titul_ip" column="kod_titul_ip" />
                <const>7787</const>
              </call>
              <call function="in" optional="1">
                <column table="kod_main_titul" column="kod_subject" />
                <useparam name="kod_subject" />
              </call>
              <call function="or" optional="1">
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip" column="kod_direct" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="in">
                    <useparam name="kod_dirisp" />
                    <array>1,2</array>
                  </call>
                </call>
                <call function="and">
                  <call function="in">
                    <column table="kod_titul_ip" column="kod_ispolnit" />
                    <useparam name="kod_direct" />
                  </call>
                  <call function="in">
                    <useparam name="kod_dirisp" />
                    <array>1,3</array>
                  </call>
                </call>
              </call>
              <call function="or" optional="1">
                <call function="in">
                  <column table="kod_titul_ip" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_main_titul" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
                <call function="in">
                  <column table="kod_sbor_titul1" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
              </call>
              <call function="not" optional="1">
                <call function="=">
                  <column table="kod_titul_ip" column="kod_aip" />
                  <useparam name="pr_notaip" />
                </call>
              </call>
              <call function="and" optional="1">
                <call function="=1">
                  <useparam name="pr_all_fact_not" />
                </call>
                <call function="is not null">
                  <column table="kod_ipr" column="kod_ipr" />
                </call>
              </call>
            </call>
          </extendwhere>
          <withparams>
            <useparam name="kod_titul_ip" />
            <useparam name="year" />
          </withparams>
          <link name="kod_ipr" as="ipr_ipr_data">
            <dlink name="ipr_planfactanaliz">
              <where>
                <call function="and">
                  <call function="=">
                    <column table="ipr_planfactanaliz" column="kod_doc" />
                    <useparam name="kod_doc" />
                  </call>
                  <call function="=">
                    <column table="ipr_planfactanaliz" column="year" />
                    <useparam name="year" />
                  </call>
                  <call function="between">
                    <column table="ipr_planfactanaliz" column="kvart" />
                    <call function="mes to kv">
                      <useparam name="mon1" />
                    </call>
                    <call function="mes to kv">
                      <useparam name="mon2" />
                    </call>
                  </call>
                </call>
              </where>
            </dlink>
            <link name="kod_kriteria" exclude="1" />
            <link name="kod_priority_insert_ip" exclude="1" />
            <link name="kod_klass" exclude="1" />
            <link name="kod_status" />
          </link>
          <link name="kod_ipr_ext">
            <link name="kod_razdel" />
          </link>
          <link name="kod_titul_ip">
            <link name="kod_direct" />
            <link name="kod_ispolnit" />
          </link>
          <link name="kod_main_titul">
            <link name="kod_subject" as="kod_subject_main" />
            <link name="kod_direct" as="kod_direct_main" />
            <link name="kod_ispolnit" as="kod_ispolnit_main" />
            <link name="kod_sbor_titul">
              <link name="kod_titul_ip" as="kod_titul_ip_sbor" />
            </link>
          </link>
          <link name="kod_smet" />
          <link name="kodzatrat" />
          <link name="kod_dog">
            <link name="e_code" />
            <link name="status" />
          </link>
          <link name="kod_dog_i" />
          <link name="kod_ipr_dog" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="kod_doc_osn" />
            <useparam name="kod_doc" />
          </call>
          <call function="in" optional="1">
            <column table="kod_main_titul" column="kod_subject" />
            <useparam name="kod_subject" />
          </call>
          <call function="or" optional="1">
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_direct" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,2</array>
              </call>
            </call>
            <call function="and">
              <call function="in">
                <column table="kod_titul_ip" column="kod_ispolnit" />
                <useparam name="kod_direct" />
              </call>
              <call function="in">
                <useparam name="kod_dirisp" />
                <array>1,3</array>
              </call>
            </call>
          </call>
          <call function="or" optional="1">
            <call function="in">
              <column table="a" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="a" column="kod_main_titul" />
              <useparam name="kod_titul_ip" />
            </call>
            <call function="in">
              <column table="kod_sbor_titul" column="kod_titul_ip" />
              <useparam name="kod_titul_ip" />
            </call>
          </call>
          <call function="not" optional="1">
            <call function="=">
              <column table="kod_titul_ip" column="kod_aip" />
              <useparam name="pr_notaip" />
            </call>
          </call>
          <call function="and" optional="1">
            <call function="=1">
              <useparam name="pr_all_fact_not" />
            </call>
            <call function="=nvl">
              <column table="a" column="kod_ipr" />
              <column table="a" column="kod_ipr_ext" />
            </call>
          </call>
          <!--заменить на section-->
          <call function="or">
            <call function="is null">
              <column table="a" column="ym" />
            </call>
            <call function="and">
              <call function="le">
                <column table="a" column="ym" />
                <call function="num to ym2">
                  <useparam name="year" />
                  <const>12</const>
                </call>
              </call>
              <call function="or">
                <call function="ge">
                  <column table="a" column="ym" />
                  <call function="ym2 add month">
                    <call function="num to ym2">
                      <useparam name="year" />
                      <const>1</const>
                    </call>
                    <const>-1</const>
                  </call>
                </call>
                <call function="ge">
                  <column table="a" column="ym_nxt" />
                  <call function="ym2 add month">
                    <call function="num to ym2">
                      <useparam name="year" />
                      <const>1</const>
                    </call>
                    <const>-1</const>
                  </call>
                </call>
                <call function="is null">
                  <column table="a" column="ym_nxt" />
                </call>
              </call>
            </call>
          </call>
          <call function="in" optional="1">
            <column table="kod_titul_ip" column="pr_ofz" />
            <useparam name="kod_ofz" />
          </call>
          <call function="is not null" comment="химия. когда вырезается условие по подразделениям , дает ошибку из-за лишнего параметра">
            <useparam name="kod_dirisp" />
          </call>
          <!--<call function="between">
            <call function="nvl">
              <column table="a" column="ym" />
              <call function="num to ym2">
                <useparam  name="year"/>
                <useparam  name="mon1"/>
              </call>
            </call>
            <call function="ym2 add month">
              <call function="num to ym2">
                <useparam  name="year"/>
                <const>1</const>
              </call>
              <const>-1</const>
            </call>
            <call function="num to ym2">
              <useparam  name="year"/>
              <const>12</const>
            </call>
          </call>-->
        </call>
      </where>
    </query>
  </queries>
</root>