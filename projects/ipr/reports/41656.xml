<?xml version="1.0" encoding="utf-8"?>
<root>
  <queries>
    <query name="41656" timestamp="19.12.2018 16:20:44">
      <params>
        <usepart part="41656-params" />
      </params>
      <expressions>
        <usepart part="41656-cmn-expressions" />
        <call function="gt" as="titul_started">
          <call function="+nvl">
            <column table="ipr_vvod_fiz" column="km_vl_1c" />
            <column table="ipr_vvod_fiz" column="km_vl_2c" />
            <column table="ipr_vvod_fiz" column="km_kl" />
            <column table="ipr_vvod_fiz" column="mba" />
            <column table="ipr_vvod_fiz" column="cnt" />
            <column table="ipr_vvod_fiz" column="cnt_proch" />
            <column table="ipr_kod_hoz_sposob" column="val" />
          </call>
          <const>0</const>
        </call>
        <call function="or" as="titul_completed">
          <call function="=">
            <column table="kod_ipr" column="kod_status" />
            <const>4</const>
          </call>
          <call function="and">
            <call function="=">
              <column table="ipr_kod_contr_steps_val" column="kod_template_contr_steps_val" />
              <const>189</const>
            </call>
            <call function="is not null">
              <column column="ef_date_mat" table="ipr_kod_contr_steps_val" />
            </call>
          </call>
        </call>
        <call function="or" as="titul_pir">
          <call function="and">
            <call function="=">
              <column table="ipr_kod_contr_steps_val" column="kod_template_contr_steps_val" />
              <const>168</const>
            </call>
            <call function="is not null">
              <column column="ef_date_mat" table="ipr_kod_contr_steps_val" />
            </call>
          </call>
          <call function="and">
            <call function="=">
              <column table="ipr_kod_vip_dog" column="kodzatrat" />
              <const>80</const>
            </call>
            <call function="gt">
              <column column="vsego" table="ipr_kod_vip_dog" nvl="0" />
              <const>0</const>
            </call>
          </call>
          <call function="and">
            <call function="=">
              <column table="ipr_kod_doc" column="kod_doc_type" />
              <const>590</const>
            </call>
          </call>
        </call>
        <call function="or" as="titul_vvod">
          <call function="gt">
            <call function="+nvl">
              <column table="ipr_vvod_fiz" column="km_vl_1c" />
              <column table="ipr_vvod_fiz" column="km_vl_2c" />
              <column table="ipr_vvod_fiz" column="km_kl" />
              <column table="ipr_vvod_fiz" column="mba" />
              <column table="ipr_vvod_fiz" column="cnt" />
              <column table="ipr_vvod_fiz" column="cnt_proch" />
            </call>
            <const>0</const>
          </call>
          <call function="and">
            <call function="=">
              <column table="ipr_kod_contr_steps_val" column="kod_template_contr_steps_val" />
              <const>207</const>
            </call>
            <call function="is not null">
              <column column="ef_date_mat" table="ipr_kod_contr_steps_val" />
            </call>
          </call>
        </call>
        <call function="()" as="obj_count_plan_started" type="number" group="sum" comment="титулы у которых заполнен факт по вводу в ОФ либо имеются данные в форме характеристик по хоз способу">
          <fact column="ipr_titul_ip_count" title="План за год. Кол-во объектов" nvl="0" condition="titul_started" />
        </call>
        <call function="()" as="obj_count_plan_completed" type="number" group="sum" comment="статус титула “Выполнен” либо заполнена дата фактического окончания по контрольному этапу 3.7">
          <fact column="ipr_titul_ip_count" title="План за год. Кол-во объектов" nvl="0" condition="titul_completed" />
        </call>
        <call function="()" as="obj_count_plan_pir" group="sum" comment="заполнена дата фактического окончания по контрольному этапу 1.10 либо имеется вид затрат 9.1 либо к титулу приложен документ с типом “ Акт выполненных работ (ПИР) по хоз способу”">
          <fact column="ipr_titul_ip_count" condition="titul_pir" />
        </call>
        <call function="()" as="obj_count_plan_vvod" group="sum" comment="заполнена дата фактического окончания по контрольному этапу 1.10 либо имеется вид затрат 9.1 либо к титулу приложен документ с типом “ Акт выполненных работ (ПИР) по хоз способу”">
          <fact column="ipr_titul_ip_count" condition="titul_vvod" />
        </call>
      </expressions>
      <select>
        <usepart part="41656-cmn-columns" />
        <call function="case" as="km_vl_1c_pp" type="number" title="План за год. ВЛ 1-цепные км" group="sum">
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>1</const>
            </call>
            <fact column="ipr_vvod_fiz_km_vl_1c" nvl="0" table="vvod" />
          </call>
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>2</const>
            </call>
            <fact column="ipr_vvod_fiz_km_vl_1c_wfact" nvl="0" table="vvod" />
          </call>
        </call>
        <call function="case" as="km_vl_2c_pp" type="number" title="План за год. ВЛ 2-цепные км" group="sum">
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>1</const>
            </call>
            <fact column="ipr_vvod_fiz_km_vl_2c" nvl="0" table="vvod" />
          </call>
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>2</const>
            </call>
            <fact column="ipr_vvod_fiz_km_vl_2c_wfact" nvl="0" table="vvod" />
          </call>
        </call>
        <call function="case" as="km_kl_pp" type="number" title="План за год. КЛ км" group="sum">
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>1</const>
            </call>
            <fact column="ipr_vvod_fiz_km_kl" nvl="0" table="vvod" />
          </call>
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>2</const>
            </call>
            <fact column="ipr_vvod_fiz_km_kl_wfact" nvl="0" table="vvod" />
          </call>
        </call>
        <call function="case" as="km_mba_pp" type="number" title="План за год. МВА" group="sum">
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>1</const>
            </call>
            <fact column="ipr_vvod_fiz_mba" nvl="0" table="vvod" />
          </call>
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>2</const>
            </call>
            <fact column="ipr_vvod_fiz_mba_wfact" nvl="0" table="vvod" />
          </call>
        </call>
        <call function="case" as="km_cnt_pp" type="number" title="План за год. шт. (ПС, ТП)" group="sum">
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>1</const>
            </call>
            <fact column="ipr_vvod_fiz_cnt" nvl="0" table="vvod" />
          </call>
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>2</const>
            </call>
            <fact column="ipr_vvod_fiz_cnt_wfact" nvl="0" table="vvod" />
          </call>
        </call>
        <call function="case" as="km_cnt_pr_pp" type="number" title="План за год. шт. (прочие)" group="sum">
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>1</const>
            </call>
            <fact column="ipr_vvod_fiz_cnt_proch" nvl="0" table="vvod" />
          </call>
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>2</const>
            </call>
            <fact column="ipr_vvod_fiz_cnt_wfact_pr" nvl="0" table="vvod" />
          </call>
        </call>
        <fact column="ipr_titul_ip_count" group="sum" title="Факт за год. Кол-во объектов" as="obj_count_fact" table="hoz" nvl="0" />
        <fact column="isv_ad_evd_count" as="ad_count_fact" group="sum" title="Факт за год. Кол-во Заявителей" nvl="0" table="hoz" />
        <fact column="km_vl_1c_fact" group="sum" nvl="0" title="Факт за год, ВЛ 1-цепные км" table="hoz" />
        <fact column="km_vl_2c_fact" group="sum" nvl="0" title="Факт за год, ВЛ 2-цепные км" table="hoz" />
        <fact column="km_kl_fact" group="sum" nvl="0" title="Факт за год, КЛ км" table="hoz" />
        <fact column="km_mba_fact" group="sum" nvl="0" title="Факт за год, МВА" table="hoz" />
        <fact column="km_cnt_fact" group="sum" nvl="0" title="Факт за год, шт. (ПС, ТП)" table="hoz" />
        <fact column="km_cnt_pr_fact" group="sum" nvl="0" title="Факт за год, шт. (прочие)" table="hoz" />
        <fact column="ipr_titul_ip_count" group="sum" title="Факт за месяц на прошл неделю. Кол-во объектов" as="obj_count_fact_mes_prev" table="hoz_mes_prev" nvl="0" />
        <fact column="isv_ad_evd_count" as="ad_count_fact_mes_prev" group="sum" title="Факт за месяц на прошл неделю. Кол-во Заявителей" nvl="0" table="hoz_mes_prev" />
        <fact column="km_vl_1c_fact" group="sum" nvl="0" title="Факт за месяц на прошл неделю, ВЛ 1-цепные км" table="hoz_mes_prev" as="km_vl_1c_fact_mes_prev" />
        <fact column="km_vl_2c_fact" group="sum" nvl="0" title="Факт за месяц на прошл неделю, ВЛ 2-цепные км" table="hoz_mes_prev" as="km_vl_2c_fact_mes_prev" />
        <fact column="km_kl_fact" group="sum" nvl="0" title="Факт за месяц на прошл неделю, КЛ км" table="hoz_mes_prev" as="km_kl_fact_mes_prev" />
        <fact column="km_mba_fact" group="sum" nvl="0" title="Факт за месяц на прошл неделю, МВА" table="hoz_mes_prev" as="km_mba_fact_mes_prev" />
        <fact column="km_cnt_fact" group="sum" nvl="0" title="Факт за месяц на прошл неделю, шт. (ПС, ТП)" table="hoz_mes_prev" as="km_cnt_fact_mes_prev" />
        <fact column="km_cnt_pr_fact" group="sum" nvl="0" title="Факт за месяц на прошл неделю, шт. (прочие)" table="hoz_mes_prev" as="km_cnt_pr_fact_mes_prev" />
        <fact column="obj_count_plan_started" group="sum" nvl="0" title="Кол-во объектов. Начато" table="titul" />
        <fact column="obj_count_plan_completed" group="sum" nvl="0" title="Кол-во объектов. Завершено" table="titul" />
        <fact column="obj_count_plan_pir" group="sum" nvl="0" title="Кол-во объектов. ПИР" table="titul" />
        <fact column="obj_count_plan_vvod" group="sum" nvl="0" title="Кол-во объектов. Введено" table="titul" />
        <fact column="ipr_kap_fact_sum" group="sum" nvl="0" title="Освоение, руб" table="titul_sum" as="obj_kap_sum" />
        <fact column="ipr_vvd_fact_sum" group="sum" nvl="0" title="Ввод, руб" table="titul_sum" as="obj_vvod_sum" />
        <fact column="ipr_titul_ip_count" group="sum" title="Факт за следующий месяц. Кол-во объектов" as="obj_count_plan_mes_next" table="titul_mes_next" nvl="0" />
        <fact column="isv_ad_evd_count" as="ad_count_plan_mes_next" group="sum" title="Факт за следующий месяц. Кол-во Заявителей" nvl="0" table="titul_mes_next" />
        <call function="case" as="km_vl_1c_pp_mes_next" type="number" title="План за следующий месяц. ВЛ 1-цепные км" group="sum">
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>1</const>
            </call>
            <fact column="ipr_vvod_fiz_km_vl_1c" nvl="0" table="vvod_mes_next" />
          </call>
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>2</const>
            </call>
            <fact column="ipr_vvod_fiz_km_vl_1c_wfact" nvl="0" table="vvod_mes_next" />
          </call>
        </call>
        <call function="case" as="km_vl_2c_pp_mes_next" type="number" title="План за следующий месяц. ВЛ 2-цепные км" group="sum">
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>1</const>
            </call>
            <fact column="ipr_vvod_fiz_km_vl_2c" nvl="0" table="vvod_mes_next" />
          </call>
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>2</const>
            </call>
            <fact column="ipr_vvod_fiz_km_vl_2c_wfact" nvl="0" table="vvod_mes_next" />
          </call>
        </call>
        <call function="case" as="km_kl_pp_mes_next" type="number" title="План за следующий месяц. КЛ км" group="sum">
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>1</const>
            </call>
            <fact column="ipr_vvod_fiz_km_kl" nvl="0" table="vvod_mes_next" />
          </call>
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>2</const>
            </call>
            <fact column="ipr_vvod_fiz_km_kl_wfact" nvl="0" table="vvod_mes_next" />
          </call>
        </call>
        <call function="case" as="km_mba_pp_mes_next" type="number" title="План за следующий месяц. МВА" group="sum">
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>1</const>
            </call>
            <fact column="ipr_vvod_fiz_mba" nvl="0" table="vvod_mes_next" />
          </call>
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>2</const>
            </call>
            <fact column="ipr_vvod_fiz_mba_wfact" nvl="0" table="vvod_mes_next" />
          </call>
        </call>
        <call function="case" as="km_cnt_pp_mes_next" type="number" title="План за следующий месяц. шт. (ПС, ТП)" group="sum">
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>1</const>
            </call>
            <fact column="ipr_vvod_fiz_cnt" nvl="0" table="vvod_mes_next" />
          </call>
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>2</const>
            </call>
            <fact column="ipr_vvod_fiz_cnt_wfact" nvl="0" table="vvod_mes_next" />
          </call>
        </call>
        <call function="case" as="km_cnt_pr_pp_mes_next" type="number" title="План за следующий месяц. шт. (прочие)" group="sum">
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>1</const>
            </call>
            <fact column="ipr_vvod_fiz_cnt_proch" nvl="0" table="vvod_mes_next" />
          </call>
          <call function="when">
            <call function="=">
              <useparam name="plan_type" />
              <const>2</const>
            </call>
            <fact column="ipr_vvod_fiz_cnt_wfact_pr" nvl="0" table="vvod_mes_next" />
          </call>
        </call>
        <call function="-nvl" title="Остаток заявителей на отчетный год" group="sum" as="isv_ad_evd_count_ost">
          <fact column="isv_ad_evd_count" title="План за год. Кол-во Заявителей" nvl="0" table="main" />
          <fact column="isv_ad_evd_count" title="План за месяц. Кол-во Заявителей" table="titul_mes" nvl="0" />
          <fact column="isv_ad_evd_count" title="План за месяц. Кол-во Заявителей" table="hoz_mes_prev2" nvl="0" />
        </call>
      </select>
      <from>
        <qube single-way="1">
          <usepart part="41656-cmn-links" />
          <dimset as="vvod">
            <link name="ipr_ym" />
            <link name="ipr_kod_titul_ip" />
            <where>
              <call function="and">
                <call function="=">
                  <column table="ipr_kod_titul_ip" column="pr_41656" />
                  <const>1</const>
                </call>
                <call function="=">
                  <call function="ym2 god">
                    <column table="ipr_ym" column="val" />
                  </call>
                  <useparam name="year">2017</useparam>
                </call>
                <call function="=">
                  <column table="id_slice" column="id_slice" />
                  <useparam name="id_slice" />
                </call>
                <call function="in" optional="1">
                  <column table="ipr_kod_titul_ip" column="kod_titul_ip" />
                  <useparam name="kod_titul_ip" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="titul_sum">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <link name="ipr_ym" only-for-cond="1" />
            <where>
              <call function="and">
                <usepart part="41656-cmn-where-tituls" />
                <call function="=">
                  <column table="id_slice" column="id_slice" />
                  <useparam name="id_slice" />
                </call>
                <call function="=">
                  <call function="ym2 god">
                    <column table="ipr_ym" column="val" />
                  </call>
                  <useparam name="year" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="hoz">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <link name="ipr_kod_hoz_sposob" only-for-cond="1" />
            <where>
              <call function="and">
                <usepart part="41656-cmn-where-tituls" />
                <call function="=">
                  <column table="ipr_kod_hoz_sposob" column="year" />
                  <useparam name="year" />
                </call>
                <call function="le">
                  <column table="ipr_kod_hoz_sposob" column="week" />
                  <useparam name="week" />
                </call>
                <call function="=">
                  <column table="id_slice" column="id_slice" />
                  <useparam name="id_slice" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="hoz_mes_prev">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <link name="ipr_kod_hoz_sposob" only-for-cond="1" />
            <where>
              <call function="and">
                <usepart part="41656-cmn-where-tituls" />
                <call function="=">
                  <column table="ipr_kod_hoz_sposob" column="year" />
                  <useparam name="year" />
                </call>
                <call function="=">
                  <column table="ipr_kod_hoz_sposob" column="month" />
                  <useparam name="month" />
                </call>
                <call function="le">
                  <column table="ipr_kod_hoz_sposob" column="week" />
                  <useparam name="prev_week" />
                </call>
                <call function="=">
                  <column table="id_slice" column="id_slice" />
                  <useparam name="id_slice_prev_week" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="titul_mes_next">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <link name="ipr_vvod_fiz" only-for-cond="1" />
            <where>
              <call function="and">
                <usepart part="41656-cmn-where-tituls" />
                <call function="=">
                  <column table="ipr_vvod_fiz" column="ym" />
                  <call function="num to ym2">
                    <useparam name="year_month_next">2017</useparam>
                    <useparam name="month_next">2017</useparam>
                  </call>
                </call>
                <call function="=">
                  <column table="id_slice" column="id_slice" />
                  <useparam name="id_slice" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="vvod_mes_next">
            <link name="ipr_ym" only-for-cond="1" />
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <where>
              <call function="and">
                <usepart part="41656-cmn-where-tituls" />
                <call function="=">
                  <column table="ipr_ym" column="val" />
                  <call function="num to ym2">
                    <useparam name="year_month_next">2017</useparam>
                    <useparam name="month_next">2017</useparam>
                  </call>
                </call>
                <call function="=">
                  <column table="id_slice" column="id_slice" />
                  <useparam name="id_slice" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="hoz_mes_prev2">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <link name="ipr_kod_hoz_sposob" only-for-cond="1" />
            <where>
              <call function="and">
                <usepart part="41656-cmn-where-tituls" />
                <call function="=">
                  <column table="ipr_kod_hoz_sposob" column="year" />
                  <useparam name="year" />
                </call>
                <call function="le">
                  <column table="ipr_kod_hoz_sposob" column="month" />
                  <call function="-nvl">
                    <useparam name="month" />
                    <const>1</const>
                  </call>
                </call>
                <call function="=" comment="пока так, по идее надо брать слайс на конец месяца">
                  <column table="id_slice" column="id_slice" />
                  <useparam name="id_slice" />
                </call>
              </call>
            </where>
          </dimset>
          <where>
            <call function="and">
              <call function="in">
                <column table="id_slice" column="id_slice" />
                <useparam name="id_slice_all" />
              </call>
              <usepart part="41656-cmn-where" />
              <call function="in">
                <column table="evd_kod_filial_tit" column="kod_direct" />
                <usepart part="isv_ad_evd_filial_list" />
              </call>
            </call>
          </where>
        </qube>
      </from>
      <grouping materialize-type="temp-table">
        <usepart part="41656-cmn-grouping" />
      </grouping>
    </query>
    <query name="41656-2" timestamp="18.12.2018 14:47:33">
      <params>
        <usepart part="41656-params" />
      </params>
      <expressions>
        <usepart part="41656-cmn-expressions" />
      </expressions>
      <select>
        <usepart part="41656-cmn-columns" />
      </select>
      <from>
        <qube single-way="1">
          <usepart part="41656-cmn-links" />
          <where>
            <call function="and">
              <call function="=">
                <column table="id_slice" column="id_slice" />
                <useparam name="id_slice" />
              </call>
              <usepart part="41656-cmn-where" />
              <call function="in">
                <column table="evd_kod_filial_tit" column="kod_direct" />
                <usepart part="isv_ad_evd_filial_list" />
              </call>
            </call>
          </where>
        </qube>
      </from>
      <grouping materialize-type="temp-table">
        <usepart part="41656-cmn-grouping" />
      </grouping>
    </query>
    <query name="41656-title" timestamp="29.09.2017 13:10:52">
      <params>
        <usepart part="41656-params" />
      </params>
      <select>
        <call function="()" as="date_cur" type="date">
          <useparam name="dat" />
        </call>
        <call function="()" as="sdate_cur" title="Дата отчёта" type="string">
          <call function="date to char">
            <useparam name="dat" />
          </call>
        </call>
        <call function="()" as="sweek" title="Отчётная неделя" type="string">
          <call function="to_char">
            <useparam name="week" />
          </call>
        </call>
        <call function="()" as="smonth_name" title="Отчётный месяц (ИП)" type="string">
          <call function="lower">
            <call function="mes-name">
              <useparam name="month" />
            </call>
          </call>
        </call>
        <call function="()" as="smonth_name_rp" title="Отчётный месяц (РП)" type="string">
          <call function="lower">
            <call function="mes-name-rp">
              <useparam name="month" />
            </call>
          </call>
        </call>
        <call function="()" as="syear" title="Отчётный год" type="string">
          <call function="to_char">
            <useparam name="year" />
          </call>
        </call>
        <call function="()" as="smonth_n1_name" title="Следующий месяц (ИП)" type="string">
          <call function="lower">
            <call function="mes-name">
              <useparam name="month_next" />
            </call>
          </call>
        </call>
        <call function="()" as="syear_n1" title="Отчётный год след месяца" type="string">
          <call function="to_char">
            <useparam name="year_month_next" />
          </call>
        </call>
        <call function="date to char" title="Понедельник пред недели" as="sdate_prev">
          <call function="trunc">
            <call function="date add days">
              <useparam name="dat" />
              <const>-7</const>
            </call>
            <const>'IW'</const>
          </call>
        </call>
        <call function="to_char" as="sdatetime" title="Дата и время формирования">
          <call function="sysdate" />
          <const>'dd.mm.yyyy hh24:mi:ss'</const>
        </call>
      </select>
      <from>
        <query name="dual" />
      </from>
    </query>
    <query name="41656-plan-type" timestamp="08.08.2017 13:22:19">
      <select>
        <column table="a" column="kod" type="number" key="1" />
        <column table="a" column="name" type="string" />
      </select>
      <from>
        <table name="41656-plan-type-view" as="a" view="1" />
      </from>
    </query>
    <query name="41656-week" timestamp="14.08.2017 18:02:21">
      <params>
        <param name="dat" type="date" />
      </params>
      <select>
        <column table="a" column="week" as="val" />
      </select>
      <from>
        <query name="spr_time_iso_weeks" as="a" />
      </from>
      <where>
        <call function="=">
          <call function="trunc">
            <column table="a" column="dat" />
          </call>
          <call function="trunc">
            <useparam name="dat" />
          </call>
        </call>
      </where>
    </query>
    <query name="41656-slice" timestamp="09.08.2017 15:02:16" order="dat_copy_time desc" comment="слайс на конец отчетной недели">
      <params>
        <param name="dat" type="date" />
      </params>
      <select>
        <column table="a" column="id_slice" />
        <column table="a" column="dat_copy_time" />
        <column table="a" column="pr_srez" />
      </select>
      <from>
        <query name="is_ad_all_slice" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="le">
            <column table="a" column="dat_copy" />
            <call function="date add days">
              <call function="trunc">
                <useparam name="dat" />
                <const>'IW'</const>
              </call>
              <const>7</const>
            </call>
          </call>
          <!--<call function="=">
            <call function="rownum"/>
            <const>1</const>
          </call>-->
        </call>
      </where>
    </query>
    <query name="41656-slice-all" timestamp="28.09.2017 22:02:25" order="dat_copy_time desc" comment="слайс на конец отчетной недели">
      <params>
        <param name="id_slice" type="number" />
        <param name="id_slice_prev_week" type="number" />
      </params>
      <select>
        <column table="a" column="id_slice" />
        <column table="a" column="dat_copy_time" />
        <column table="a" column="pr_srez" />
      </select>
      <from>
        <query name="is_ad_all_slice" as="a" />
      </from>
      <where>
        <call function="or">
          <call function="=">
            <column table="a" column="id_slice" />
            <useparam name="id_slice" />
          </call>
          <call function="=">
            <column table="a" column="id_slice" />
            <useparam name="id_slice_prev_week" />
          </call>
          <!--<call function="=">
            <call function="rownum"/>
            <const>1</const>
          </call>-->
        </call>
      </where>
    </query>
    <query name="41656-month" timestamp="15.08.2017 11:12:34">
      <params>
        <param name="dat" type="date" />
      </params>
      <select>
        <column table="a" column="month" as="val" />
      </select>
      <from>
        <query name="spr_time_iso_weeks" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="dat" />
          <useparam name="dat" />
        </call>
      </where>
    </query>
    <query name="41656-year" timestamp="15.08.2017 11:12:46">
      <params>
        <param name="dat" type="date" />
      </params>
      <select>
        <column table="a" column="year" as="val" />
      </select>
      <from>
        <query name="spr_time_iso_weeks" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="dat" />
          <useparam name="dat" />
        </call>
      </where>
    </query>
    <query name="41656-har-cols" timestamp="08.08.2017 15:50:46" order="1">
      <select>
        <column table="a" column="description" as="title" />
        <call function="to_char" as="name">
          <column table="a" column="kod_character" />
        </call>
      </select>
      <from>
        <query name="ipr_character" as="a" />
      </from>
      <where>
        <call function="=">
          <column table="a" column="har_me" />
          <const>1</const>
        </call>
      </where>
    </query>
    <query name="41656-prev-week" timestamp="14.08.2017 18:03:30">
      <params>
        <param name="dat" type="date" />
        <param name="month" type="number" />
      </params>
      <select>
        <call function="if" as="val" type="number">
          <call function="=">
            <column table="a" column="month" />
            <useparam name="month" />
          </call>
          <column table="a" column="week" />
          <const>0</const>
        </call>
      </select>
      <from>
        <query name="spr_time_iso_weeks" as="a" />
      </from>
      <where>
        <call function="=">
          <call function="trunc">
            <column table="a" column="dat" />
          </call>
          <call function="trunc">
            <call function="date add days">
              <useparam name="dat" />
              <const>-7</const>
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="41656-slice-prev-week" timestamp="14.08.2017 17:42:56" order="dat_copy_time desc" comment="слайс на конец прошлой недели">
      <params>
        <param name="dat" type="date" />
        <param name="prev_week" type="number" />
      </params>
      <select>
        <call function="if" as="val" type="number">
          <call function="=">
            <useparam name="prev_week" />
            <const>0</const>
          </call>
          <const>0</const>
          <column table="a" column="id_slice" />
        </call>
        <column table="a" column="dat_copy_time" />
        <column table="a" column="pr_srez" />
      </select>
      <from>
        <query name="is_ad_all_slice" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="le">
            <column table="a" column="dat_copy" />
            <call function="trunc">
              <useparam name="dat" />
              <const>'IW'</const>
            </call>
          </call>
          <!--<call function="=">
            <call function="rownum"/>
            <const>1</const>
          </call>-->
        </call>
      </where>
    </query>
    <query name="41656-test" timestamp="10.11.2017 18:15:50" visible="0" use-repository="1">
      <params>
        <param name="id_slice_all">
          <call function="array">
            <const>408</const>
            <const>412</const>
          </call>
        </param>
        <param name="dat">
          <const>to_date('10.11.2017','DD.MM.YYYY')</const>
        </param>
        <param name="plan_type">
          <const>1</const>
        </param>
        <param name="week">
          <const>45</const>
        </param>
        <param name="month">
          <const>11</const>
        </param>
        <param name="year">
          <const>2017</const>
        </param>
        <param name="id_slice">
          <const>412</const>
        </param>
        <param name="prev_week">
          <const>44</const>
        </param>
        <param name="id_slice_prev_week">
          <const>408</const>
        </param>
        <param name="month_next">
          <const>12</const>
        </param>
        <param name="year_month_next">
          <const>2017</const>
        </param>
        <param name="kod_titul_ip">
          <const>42497</const>
        </param>
        <param name="kod_direct" />
      </params>
      <expressions>
        <call function="is null" as="cond_tituls_absent" dontpushpred="1">
          <column table="ipr_kod_titul_ip" column="kod_titul_ip" />
        </call>
        <call function="=" as="hoz_vl_1c" dontpushpred="1">
          <column table="ipr_kod_hoz_sposob" column="kod_character" />
          <const>621</const>
        </call>
        <call function="=" as="hoz_vl_2c" dontpushpred="1">
          <column table="ipr_kod_hoz_sposob" column="kod_character" />
          <const>901</const>
        </call>
        <call function="=" as="hoz_kl" dontpushpred="1">
          <column table="ipr_kod_hoz_sposob" column="kod_character" />
          <const>781</const>
        </call>
        <call function="=" as="hoz_mba" dontpushpred="1">
          <column table="ipr_kod_hoz_sposob" column="kod_character" />
          <const>622</const>
        </call>
        <call function="=" as="hoz_cnt" dontpushpred="1">
          <column table="ipr_kod_hoz_sposob" column="kod_character" />
          <const>624</const>
        </call>
        <call function="=" as="hoz_cnt_pr" dontpushpred="1">
          <column table="ipr_kod_hoz_sposob" column="kod_character" />
          <const>623</const>
        </call>
        <call function="gt" as="titul_started">
          <call function="+nvl">
            <column table="ipr_vvod_fiz" column="km_vl_1c" />
            <column table="ipr_vvod_fiz" column="km_vl_2c" />
            <column table="ipr_vvod_fiz" column="km_kl" />
            <column table="ipr_vvod_fiz" column="mba" />
            <column table="ipr_vvod_fiz" column="cnt" />
            <column table="ipr_vvod_fiz" column="cnt_proch" />
            <column table="ipr_kod_hoz_sposob" column="val" />
          </call>
          <const>0</const>
        </call>
        <call function="or" as="titul_completed">
          <call function="=">
            <column table="kod_ipr" column="kod_status" />
            <const>4</const>
          </call>
          <call function="and">
            <call function="=">
              <column table="ipr_kod_contr_steps_val" column="kod_template_contr_steps_val" />
              <const>189</const>
            </call>
            <call function="is not null">
              <column column="ef_date_mat" table="ipr_kod_contr_steps_val" />
            </call>
          </call>
        </call>
        <call function="or" as="titul_pir">
          <call function="and">
            <call function="=">
              <column table="ipr_kod_contr_steps_val" column="kod_template_contr_steps_val" />
              <const>168</const>
            </call>
            <call function="is not null">
              <column column="ef_date_mat" table="ipr_kod_contr_steps_val" />
            </call>
          </call>
          <call function="and">
            <call function="=">
              <column table="ipr_kod_vip_dog" column="kodzatrat" />
              <const>80</const>
            </call>
            <call function="gt">
              <column column="vsego" table="ipr_kod_vip_dog" nvl="0" />
              <const>0</const>
            </call>
          </call>
          <call function="and">
            <call function="=">
              <column table="ipr_kod_doc" column="kod_doc_type" />
              <const>590</const>
            </call>
          </call>
        </call>
        <call function="or" as="titul_vvod">
          <call function="gt">
            <call function="+nvl">
              <column table="ipr_vvod_fiz" column="km_vl_1c" />
              <column table="ipr_vvod_fiz" column="km_vl_2c" />
              <column table="ipr_vvod_fiz" column="km_kl" />
              <column table="ipr_vvod_fiz" column="mba" />
              <column table="ipr_vvod_fiz" column="cnt" />
              <column table="ipr_vvod_fiz" column="cnt_proch" />
            </call>
            <const>0</const>
          </call>
          <call function="and">
            <call function="=">
              <column table="ipr_kod_contr_steps_val" column="kod_template_contr_steps_val" />
              <const>207</const>
            </call>
            <call function="is not null">
              <column column="ef_date_mat" table="ipr_kod_contr_steps_val" />
            </call>
          </call>
        </call>
        <call function="()" as="isv_ad_evd_no_tits_count" group="sum">
          <fact column="isv_ad_evd_count" condition="cond_tituls_absent" />
        </call>
        <call function="()" as="km_vl_1c_fact" group="sum">
          <fact column="ipr_hoz_sposob_val" condition="hoz_vl_1c" />
        </call>
        <call function="()" as="km_vl_2c_fact" group="sum">
          <fact column="ipr_hoz_sposob_val" condition="hoz_vl_2c" />
        </call>
        <call function="()" as="km_kl_fact" group="sum">
          <fact column="ipr_hoz_sposob_val" condition="hoz_kl" />
        </call>
        <call function="()" as="km_mba_fact" group="sum">
          <fact column="ipr_hoz_sposob_val" condition="hoz_mba" />
        </call>
        <call function="()" as="km_cnt_fact" group="sum">
          <fact column="ipr_hoz_sposob_val" condition="hoz_cnt" />
        </call>
        <call function="()" as="km_cnt_pr_fact" group="sum">
          <fact column="ipr_hoz_sposob_val" condition="hoz_cnt_pr" />
        </call>
        <call function="()" as="km_vl_1c_fact_mes" group="sum">
          <fact column="ipr_hoz_sposob_val" condition="hoz_vl_1c" />
        </call>
        <call function="()" as="km_vl_2c_fact_mes" group="sum">
          <fact column="ipr_hoz_sposob_val" condition="hoz_vl_2c" />
        </call>
        <call function="()" as="km_kl_fact_mes" group="sum">
          <fact column="ipr_hoz_sposob_val" condition="hoz_kl" />
        </call>
        <call function="()" as="km_mba_fact_mes" group="sum">
          <fact column="ipr_hoz_sposob_val" condition="hoz_mba" />
        </call>
        <call function="()" as="km_cnt_fact_mes" group="sum">
          <fact column="ipr_hoz_sposob_val" condition="hoz_cnt" />
        </call>
        <call function="()" as="km_cnt_pr_fact_mes" group="sum">
          <fact column="ipr_hoz_sposob_val" condition="hoz_cnt_pr" />
        </call>
        <call function="()" as="obj_count_plan_started" type="number" group="sum" comment="титулы у которых заполнен факт по вводу в ОФ либо имеются данные в форме характеристик по хоз способу">
          <fact column="ipr_titul_ip_count" title="План за год. Кол-во объектов" nvl="0" condition="titul_started" />
        </call>
        <call function="()" as="obj_count_plan_completed" type="number" group="sum" comment="статус титула “Выполнен” либо заполнена дата фактического окончания по контрольному этапу 3.7">
          <fact column="ipr_titul_ip_count" title="План за год. Кол-во объектов" nvl="0" condition="titul_completed" />
        </call>
        <call function="()" as="obj_count_plan_pir" group="sum" comment="заполнена дата фактического окончания по контрольному этапу 1.10 либо имеется вид затрат 9.1 либо к титулу приложен документ с типом “ Акт выполненных работ (ПИР) по хоз способу”">
          <fact column="ipr_titul_ip_count" condition="titul_pir" />
        </call>
        <call function="()" as="obj_count_plan_vvod" group="sum" comment="заполнена дата фактического окончания по контрольному этапу 1.10 либо имеется вид затрат 9.1 либо к титулу приложен документ с типом “ Акт выполненных работ (ПИР) по хоз способу”">
          <fact column="ipr_titul_ip_count" condition="titul_vvod" />
        </call>
      </expressions>
      <select>
        <column table="ipr_kod_titul_ip" column="kod_titul_ip" exclude="1" />
        <column table="ipr_kod_hoz_sposob" column="kod_hoz_sposob" exclude="1" />
        <fact column="ipr_titul_ip_count" group="sum" title="Факт за год. Кол-во объектов" as="obj_count_fact" nvl="0" />
      </select>
      <from>
        <qube single-way="1">
          <link name="id_slice" />
          <link name="ipr_kod_hoz_sposob" />
          <link name="ipr_kod_titul_ip" />
          <dimset as="hoz_mes">
            <where>
              <call function="and">
                <call function="=">
                  <column table="ipr_kod_hoz_sposob" column="year" />
                  <useparam name="year" />
                </call>
              </call>
            </where>
          </dimset>
          <where>
            <call function="and">
              <call function="in">
                <column table="id_slice" column="id_slice" />
                <useparam name="id_slice_all" />
              </call>
              <call function="=">
                <column table="id_slice" column="id_slice" />
                <useparam name="id_slice" />
              </call>
              <call function="in" optional="1">
                <column table="ipr_kod_titul_ip" column="kod_titul_ip" />
                <useparam name="kod_titul_ip" />
              </call>
            </call>
          </where>
        </qube>
      </from>
      <grouping materialize-type="temp-table">
        <grset as="all" title="Всего" exclude="1">
          <where exclude="1">
            <call function="=">
              <column table="this" column="id_slice" />
              <useparam name="id_slice" />
            </call>
          </where>
          <grset title="По филиалам" as="dep" order="dep_name">
            <group>
              <sourcelink table="evd_kod_filial_tit" />
            </group>
            <grset title="По РЭС" as="res" order="res_name">
              <group>
                <sourcelink table="evd_kodres" />
              </group>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="41656-detail-tit" timestamp="05.12.2017 19:59:28" visible="0" title="План по выполнению работ хоз. способом (детализация)" is-report="1">
      <params>
        <usepart part="41656-params" />
      </params>
      <select>
        <column table="ipr_kod_titul_ip" column="kod_titul_ip" />
        <column table="evd_kod_filial_tit" column="kod_direct" />
        <column column="kod_direct" as="kod_res" table="evd_kodres" />
        <column table="evd_kod_filial_tit" column="name_kr" title="Филиал" as="dep_name" />
        <column table="evd_kodres" column="name_kr" title="РЭС" as="res_name" />
        <column table="ipr_kod_titul_ip" column="tit_num_new" />
        <call function="ym2 to char" as="sym">
          <column table="ipr_ym" column="val" title="Период" format="F0" />
        </call>
        <column table="ipr_filial_res_valid" as="filial_res_valid" column="val" />
        <call function="()" as="[column]" type="number" title="Значение" halign="center">
          <call function="()" as="[column]" />
        </call>
      </select>
      <from>
        <qube single-way="1">
          <link name="evd_kod_filial_tit" />
          <link name="evd_kodres" />
          <link name="evd_pr_hoz_sposob" only-for-cond="1" />
          <link name="id_slice" only-for-cond="1" />
          <link name="evd_pr_vip" only-for-cond="1" />
          <link name="evd_pr_ostatok" only-for-cond="1" />
          <link name="evd_year_srok" only-for-cond="1" />
          <link name="evd_otch_list_3" only-for-cond="1" />
          <link name="evd_fl_build" only-for-cond="1" />
          <link name="evd_dt_contract" only-for-cond="1" />
          <link name="kod_isv_ad_evd" only-for-cond="1" />
          <link name="ipr_filial_res_valid" />
          <dimset as="titul_mes">
            <link name="ipr_kod_titul_ip" />
            <link name="ipr_vvod_fiz" only-for-cond="1" />
          </dimset>
          <dimset as="vvod_mes">
            <link name="ipr_ym" />
            <link name="ipr_kod_titul_ip" />
          </dimset>
          <dimset as="hoz_mes">
            <link name="ipr_kod_titul_ip" />
            <link name="ipr_kod_hoz_sposob" only-for-cond="1" />
          </dimset>
          <dimset as="titul">
            <link name="ipr_kod_titul_ip" />
          </dimset>
          <dimset as="main" />
          <dimset as="vvod">
            <link name="ipr_ym" />
            <link name="ipr_kod_titul_ip" />
          </dimset>
          <dimset as="titul_sum">
            <link name="ipr_kod_titul_ip" />
            <link name="ipr_ym" />
          </dimset>
          <dimset as="hoz">
            <link name="ipr_kod_titul_ip" />
            <link name="ipr_kod_hoz_sposob" only-for-cond="1" />
          </dimset>
          <dimset as="hoz_mes_prev">
            <link name="ipr_kod_titul_ip" />
            <link name="ipr_kod_hoz_sposob" />
          </dimset>
          <dimset as="titul_mes_next">
            <link name="ipr_kod_titul_ip" />
            <link name="ipr_vvod_fiz" only-for-cond="1" />
          </dimset>
          <dimset as="vvod_mes_next">
            <link name="ipr_ym" />
            <link name="ipr_kod_titul_ip" />
          </dimset>
          <dimset as="hoz_mes_prev2">
            <link name="ipr_kod_titul_ip" />
            <link name="ipr_kod_hoz_sposob" only-for-cond="1" />
          </dimset>
        </qube>
      </from>
    </query>
    <query name="41656-detail-ad" timestamp="05.12.2017 20:06:44" visible="0" title="План по выполнению работ хоз. способом (детализация)" is-report="1">
      <params>
        <usepart part="41656-params" />
      </params>
      <select>
        <column table="evd_kod_filial_tit" column="kod_direct" />
        <column column="kod_direct" as="kod_res" table="evd_kodres" />
        <column table="kod_isv_ad_evd" column="kod_dop_contract" />
        <column table="evd_kod_filial_tit" column="name_kr" title="Филиал" as="dep_name" />
        <column table="evd_kodres" column="name_kr" title="РЭС" as="res_name" />
        <column table="kod_isv_ad_evd" column="num_req" />
        <column table="kod_isv_ad_evd" column="num_ouco" />
        <column table="ipr_filial_res_valid" as="filial_res_valid" column="val" />
        <call function="()" as="[column]" type="number" title="Значение" halign="center">
          <call function="()" as="[column]" />
        </call>
      </select>
      <from>
        <qube single-way="1">
          <link name="evd_kod_filial_tit" />
          <link name="evd_kodres" />
          <link name="evd_pr_hoz_sposob" only-for-cond="1" />
          <link name="id_slice" only-for-cond="1" />
          <link name="evd_pr_vip" only-for-cond="1" />
          <link name="evd_pr_ostatok" only-for-cond="1" />
          <link name="evd_year_srok" only-for-cond="1" />
          <link name="evd_otch_list_3" only-for-cond="1" />
          <link name="evd_fl_build" only-for-cond="1" />
          <link name="evd_dt_contract" only-for-cond="1" />
          <link name="kod_isv_ad_evd" />
          <link name="ipr_filial_res_valid" />
          <dimset as="titul_mes">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <link name="ipr_vvod_fiz" only-for-cond="1" />
          </dimset>
          <dimset as="vvod_mes">
            <link name="ipr_ym" only-for-cond="1" />
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
          </dimset>
          <dimset as="hoz_mes">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <link name="ipr_kod_hoz_sposob" only-for-cond="1" />
          </dimset>
          <dimset as="titul">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
          </dimset>
          <dimset as="main" />
          <dimset as="vvod">
            <link name="ipr_ym" />
            <link name="ipr_kod_titul_ip" />
          </dimset>
          <dimset as="titul_sum">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <link name="ipr_ym" only-for-cond="1" />
          </dimset>
          <dimset as="hoz">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <link name="ipr_kod_hoz_sposob" only-for-cond="1" />
          </dimset>
          <dimset as="hoz_mes_prev">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <link name="ipr_kod_hoz_sposob" only-for-cond="1" />
          </dimset>
          <dimset as="titul_mes_next">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <link name="ipr_vvod_fiz" only-for-cond="1" />
          </dimset>
          <dimset as="vvod_mes_next">
            <link name="ipr_ym" only-for-cond="1" />
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
          </dimset>
          <dimset as="hoz_mes_prev2">
            <link name="ipr_kod_titul_ip" only-for-cond="1" />
            <link name="ipr_kod_hoz_sposob" only-for-cond="1" />
          </dimset>
        </qube>
      </from>
    </query>
    <query name="41656-month-next" timestamp="29.09.2017 12:54:43">
      <params>
        <param name="month" type="number" />
      </params>
      <select>
        <call function="if" as="val" type="number">
          <call function="=">
            <useparam name="month" />
            <const>12</const>
          </call>
          <const>1</const>
          <call function="+">
            <useparam name="month" />
            <const>1</const>
          </call>
        </call>
      </select>
      <from>
        <query name="dual" as="a" />
      </from>
    </query>
    <query name="41656-year-month-next" timestamp="29.09.2017 12:56:04">
      <params>
        <param name="month" type="number" />
        <param name="year" type="number" />
      </params>
      <select>
        <call function="if" as="val" type="number">
          <call function="=">
            <useparam name="month" />
            <const>12</const>
          </call>
          <call function="+">
            <useparam name="year" />
            <const>1</const>
          </call>
          <useparam name="year" />
        </call>
      </select>
      <from>
        <query name="dual" as="a" />
      </from>
    </query>
    <query name="41656-is_spr_direct_list" order="name" class="1" timestamp="13.11.2017 18:15:09">
      <select>
        <column table="a" column="kod_direct" />
        <column table="a" column="name" as="name_direct" fixed="1" />
        <column table="a" column="name_kr" as="name_kr_direct" />
      </select>
      <from>
        <query name="is_spr_direct" as="a">
          <link name="puser_ext" as="ipr_rights" />
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="ipr_rights" column="puser" />
            <const>user</const>
          </call>
          <call function="is null">
            <column table="a" column="god" />
          </call>
          <call function="=">
            <column table="a" column="invest_pr" />
            <const>1</const>
          </call>
          <call function="in">
            <column table="a" column="kod_direct" />
            <call function="array">
              <const>19</const>
              <const>20</const>
              <const>21</const>
              <const>22</const>
              <const>24</const>
              <const>26</const>
              <const>27</const>
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="41656-2_1" timestamp="18.12.2018 14:48:22">
      <params>
        <usepart part="41656-params" />
      </params>
      <select>
        <column table="evd_kod_filial_tit" column="kod_direct" />
        <column column="kod_direct" as="kod_res" table="evd_kodres" />
        <column table="ipr_filial_res_valid" as="filial_res_valid" column="val" />
        <column table="evd_kod_filial_tit" column="name_kr" title="Отделение" as="dep_name" group="max" />
        <column table="evd_kodres" column="name_kr" title="РЭС" as="res_name" group="max" />
        <call function="/0" group="sum" as="perc" nvl="0">
          <column table="evd_kod_filial_tit" column="kod_direct" />
          <column table="evd_kodres" column="kod_direct" />
        </call>
        <call function="dense_rank" as="res_rank">
          <call function="order by 2">
            <call function="desc nulls last">
              <column table="this" column="res_perc" />
            </call>
          </call>
        </call>
        <call function="dense_rank" as="filial_rank">
          <call function="order by 2">
            <call function="desc nulls last">
              <column table="this" column="filial_perc" />
            </call>
          </call>
        </call>
        <call function="over" as="res_perc">
          <call function="sum">
            <column table="this" column="perc" />
          </call>
          <call function="partition by">
            <column table="evd_kodres" column="kod_direct" />
          </call>
        </call>
        <call function="over" as="filial_perc">
          <call function="sum">
            <column table="this" column="perc" />
          </call>
          <call function="partition by">
            <column table="evd_kod_filial_tit" column="kod_direct" />
          </call>
        </call>
      </select>
      <from>
        <qube single-way="1">
          <link name="evd_kod_filial_tit" />
          <link name="evd_kodres" />
          <link name="evd_pr_hoz_sposob" only-for-cond="1" />
          <link name="id_slice" only-for-cond="1" />
          <link name="evd_pr_vip" only-for-cond="1" />
          <link name="evd_pr_ostatok" only-for-cond="1" />
          <link name="evd_year_srok" only-for-cond="1" />
          <link name="evd_otch_list_3" only-for-cond="1" />
          <link name="evd_fl_build" only-for-cond="1" />
          <link name="evd_dt_contract" only-for-cond="1" />
          <link name="kod_isv_ad_evd" all-rows="1" />
          <link name="ipr_filial_res_valid" />
          <where>
            <call function="and">
              <call function="=">
                <column table="id_slice" column="id_slice" />
                <useparam name="id_slice" />
              </call>
              <usepart part="41656-cmn-where" />
              <call function="in">
                <column table="evd_kod_filial_tit" column="kod_direct" />
                <usepart part="isv_ad_evd_filial_list" />
              </call>
            </call>
          </where>
        </qube>
      </from>
      <grouping materialize-type="temp-table">
        <usepart part="41656-cmn-grouping" />
      </grouping>
    </query>
  </queries>
  <reports>
    <report name="41656" title="План по выполнению работ хозяйственным способом" timestamp="17.11.2017 11:32:39" form="41656" mode="excel" nogrid="1">
      <params>
        <usepart part="41656-params" />
      </params>
      <procedure>
        begin
        is_job.set_id_slice(:id_slice);
        
        end;
      </procedure>
      <print-templates>
        <excel>
          <template name="41656.xlsx" title="План по выполнению работ хозяйственным способом" print-proc="2" print-xlsx="1" use-flexcel="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="41656-title" as="t">
          <withparams>
            <usepart part="41656-useparams" />
          </withparams>
        </query>
        <query as="a" main="1" name="41656">
          <withparams>
            <usepart part="41656-useparams" />
          </withparams>
          <events>
            <useaction event-name="double-click" action-type="open-column-grouping-detail" call="41656-detail-tit">
              <usepart part="41656-useparams" />
            </useaction>
            <useaction event-name="double-click" action-type="open-column-grouping-detail" call="41656-detail-ad" column="no_tits_count_plan">
              <usepart part="41656-useparams" />
            </useaction>
            <useaction event-name="double-click" action-type="open-column-grouping-detail" call="41656-detail-ad" column="isv_ad_evd_count_ost">
              <usepart part="41656-useparams" />
            </useaction>
            <useaction event-name="double-click" action-type="open-column-grouping-detail" call="41656-detail-ad" column="ad_count_plan">
              <usepart part="41656-useparams" />
            </useaction>
            <useaction event-name="double-click" action-type="open-column-grouping-detail" call="41656-detail-ad" column="ad_count_fact">
              <usepart part="41656-useparams" />
            </useaction>
            <usepart part="41656-cmn-events" />
          </events>
        </query>
      </queries>
    </report>
    <report name="41656-2" title="План по выполнению работ хозяйственным способом (сокр)" timestamp="23.01.2018 14:16:19" form="41656" mode="excel">
      <params>
        <usepart part="41656-params" />
      </params>
      <procedure>
        begin
        is_job.set_id_slice(:id_slice);
        
        end;
      </procedure>
      <print-templates>
        <excel>
          <template name="41656-2.xlsx" title="План по выполнению работ хозяйственным способом (сокр)" print-proc="2" print-xlsx="1" use-flexcel="1" />
        </excel>
      </print-templates>
      <queries>
        <query name="41656-title" as="t">
          <withparams>
            <usepart part="41656-useparams" />
          </withparams>
        </query>
        <query as="a" main="1" name="41656-2">
          <withparams>
            <usepart part="41656-useparams" />
          </withparams>
          <events>
            <useaction event-name="double-click" action-type="open-column-grouping-detail" call="41656-detail-tit">
              <usepart part="41656-useparams" />
            </useaction>
            <usepart part="41656-cmn-events" />
          </events>
        </query>
      </queries>
    </report>
  </reports>
  <parts>
    <part id="41656-params" timestamp="09.11.2017 19:38:08">
      <param name="kod_direct" type="array" />
      <param name="kod_titul_ip" type="array">
        <const>10907</const>
      </param>
      <param name="dat" type="date">
        <const>to_date('09.11.2017','DD.MM.YYYY')</const>
      </param>
      <param name="plan_type" type="number">
        <const>1</const>
      </param>
      <param name="week" type="number">
        <const>36</const>
      </param>
      <param name="month" type="number">
        <const>9</const>
      </param>
      <param name="year" type="number">
        <const>2017</const>
      </param>
      <param name="id_slice" type="number">
        <const>411</const>
      </param>
      <param name="prev_week" type="number">
        <const>35</const>
      </param>
      <param name="id_slice_prev_week" type="number">
        <const>404</const>
      </param>
      <param name="id_slice_all" type="array">
        <const>(404,411)</const>
      </param>
      <param name="month_next" type="number">
        <const>10</const>
      </param>
      <param name="year_month_next" type="number">
        <const>2017</const>
      </param>
    </part>
    <part id="41656-useparams" timestamp="02.10.2017 19:17:14">
      <useparam name="kod_direct" />
      <useparam name="kod_titul_ip" />
      <useparam name="dat" />
      <useparam name="plan_type" />
      <useparam name="week" />
      <useparam name="month" />
      <useparam name="year" />
      <useparam name="id_slice" />
      <useparam name="prev_week" />
      <useparam name="id_slice_prev_week" />
      <useparam name="id_slice_all" />
      <useparam name="month_next" />
      <useparam name="year_month_next" />
    </part>
    <part id="41656-cmn-where-tituls" timestamp="02.10.2017 19:17:14">
      <call function="=">
        <column table="ipr_kod_titul_ip" column="pr_41656" />
        <const>1</const>
      </call>
      <call function="in" comment="данные только по титулам с филиалами-исполнителями КС, ВЭС, ГтЭС, КнЭС, НлЭС, ПрЭС, ТхЭС">
        <column table="ipr_kod_titul_ip" column="kod_ispolnit" />
        <call function="array">
          <const>19</const>
          <const>20</const>
          <const>21</const>
          <const>22</const>
          <const>24</const>
          <const>26</const>
          <const>27</const>
        </call>
      </call>
      <call function="in" optional="1">
        <column table="ipr_kod_titul_ip" column="kod_titul_ip" />
        <useparam name="kod_titul_ip" />
      </call>
    </part>
    <part id="41656-cmn-events" timestamp="02.10.2017 19:17:14">
      <useaction event-name="double-click" action-type="open-column-grouping-detail" call="41656-detail-ad" column="ad_count_plan_mes">
        <usepart part="41656-useparams" />
      </useaction>
      <useaction event-name="double-click" action-type="open-column-grouping-detail" call="41656-detail-ad" column="ad_count_fact_mes">
        <usepart part="41656-useparams" />
      </useaction>
      <useaction event-name="double-click" action-type="open-column-grouping-detail" call="41656-detail-ad" column="ad_count_fact_mes_prev">
        <usepart part="41656-useparams" />
      </useaction>
      <useaction event-name="double-click" column="dep_name" />
      <useaction event-name="double-click" column="res_name" />
    </part>
    <part id="41656-cmn-expressions" timestamp="02.10.2017 19:17:14">
      <call function="is null" as="cond_tituls_absent" dontpushpred="1">
        <column table="ipr_kod_titul_ip" column="kod_titul_ip" />
      </call>
      <call function="()" as="isv_ad_evd_no_tits_count" group="sum">
        <fact column="isv_ad_evd_count" condition="cond_tituls_absent" />
      </call>
      <call function="=" as="hoz_vl_1c" dontpushpred="1">
        <column table="ipr_kod_hoz_sposob" column="kod_character" />
        <const>621</const>
      </call>
      <call function="=" as="hoz_vl_2c" dontpushpred="1">
        <column table="ipr_kod_hoz_sposob" column="kod_character" />
        <const>901</const>
      </call>
      <call function="=" as="hoz_kl" dontpushpred="1">
        <column table="ipr_kod_hoz_sposob" column="kod_character" />
        <const>781</const>
      </call>
      <call function="=" as="hoz_mba" dontpushpred="1">
        <column table="ipr_kod_hoz_sposob" column="kod_character" />
        <const>622</const>
      </call>
      <call function="=" as="hoz_cnt" dontpushpred="1">
        <column table="ipr_kod_hoz_sposob" column="kod_character" />
        <const>624</const>
      </call>
      <call function="=" as="hoz_cnt_pr" dontpushpred="1">
        <column table="ipr_kod_hoz_sposob" column="kod_character" />
        <const>623</const>
      </call>
      <call function="()" as="km_vl_1c_fact" group="sum">
        <fact column="ipr_hoz_sposob_val" condition="hoz_vl_1c" />
      </call>
      <call function="()" as="km_vl_2c_fact" group="sum">
        <fact column="ipr_hoz_sposob_val" condition="hoz_vl_2c" />
      </call>
      <call function="()" as="km_kl_fact" group="sum">
        <fact column="ipr_hoz_sposob_val" condition="hoz_kl" />
      </call>
      <call function="()" as="km_mba_fact" group="sum">
        <fact column="ipr_hoz_sposob_val" condition="hoz_mba" />
      </call>
      <call function="()" as="km_cnt_fact" group="sum">
        <fact column="ipr_hoz_sposob_val" condition="hoz_cnt" />
      </call>
      <call function="()" as="km_cnt_pr_fact" group="sum">
        <fact column="ipr_hoz_sposob_val" condition="hoz_cnt_pr" />
      </call>
    </part>
    <part id="41656-cmn-columns" timestamp="23.01.2018 14:06:24">
      <column table="evd_kod_filial_tit" column="kod_direct" agg="no" />
      <column column="kod_direct" as="kod_res" table="evd_kodres" agg="no" />
      <column table="ipr_filial_res_valid" as="filial_res_valid" column="val" agg="no" />
      <call function="dense_rank" as="rank" group="max" agg="no">
        <call function="partition by">
          <column table="this" column="filial_res_valid" />
        </call>
        <call function="order by 2">
          <column table="evd_kod_filial_tit" column="name_kr" />
        </call>
      </call>
      <column table="evd_kod_filial_tit" column="name_kr" title="Отделение" as="dep_name" group="max" agg="no" />
      <column table="evd_kodres" column="name_kr" title="РЭС" as="res_name" group="max" agg="no" />
      <fact column="ipr_titul_ip_count" group="sum" title="План за год. Кол-во объектов" as="obj_count_plan" table="titul" nvl="0" agg="no" />
      <fact column="isv_ad_evd_count" as="ad_count_plan" title="План за год. Кол-во Заявителей" group="sum" nvl="0" table="main" agg="no" />
      <fact column="isv_ad_evd_no_tits_count" as="no_tits_count_plan" title="План за год. Не привяз. к объекту" group="sum" nvl="0" table="main" agg="no" />
      <fact column="ipr_titul_ip_count" group="sum" title="План за месяц. Кол-во объектов" as="obj_count_plan_mes" table="titul_mes" nvl="0" agg="no" />
      <fact column="isv_ad_evd_count" as="ad_count_plan_mes" title="План за месяц. Кол-во Заявителей" group="sum" table="titul_mes" nvl="0" agg="no" />
      <call function="case" as="km_vl_1c_pp_mes" type="number" title="План за месяц. ВЛ 1-цепные км" group="sum" agg="no">
        <call function="when">
          <call function="=">
            <useparam name="plan_type" />
            <const>1</const>
          </call>
          <fact column="ipr_vvod_fiz_km_vl_1c" nvl="0" table="vvod_mes" />
        </call>
        <call function="when">
          <call function="=">
            <useparam name="plan_type" />
            <const>2</const>
          </call>
          <fact column="ipr_vvod_fiz_km_vl_1c_wfact" nvl="0" table="vvod_mes" />
        </call>
      </call>
      <call function="case" as="km_vl_2c_pp_mes" type="number" title="План за месяц. ВЛ 2-цепные км" group="sum" agg="no">
        <call function="when">
          <call function="=">
            <useparam name="plan_type" />
            <const>1</const>
          </call>
          <fact column="ipr_vvod_fiz_km_vl_2c" nvl="0" table="vvod_mes" />
        </call>
        <call function="when">
          <call function="=">
            <useparam name="plan_type" />
            <const>2</const>
          </call>
          <fact column="ipr_vvod_fiz_km_vl_2c_wfact" nvl="0" table="vvod_mes" />
        </call>
      </call>
      <call function="case" as="km_kl_pp_mes" type="number" title="План за месяц. КЛ км" group="sum" agg="no">
        <call function="when">
          <call function="=">
            <useparam name="plan_type" />
            <const>1</const>
          </call>
          <fact column="ipr_vvod_fiz_km_kl" nvl="0" table="vvod_mes" />
        </call>
        <call function="when">
          <call function="=">
            <useparam name="plan_type" />
            <const>2</const>
          </call>
          <fact column="ipr_vvod_fiz_km_kl_wfact" nvl="0" table="vvod_mes" />
        </call>
      </call>
      <call function="case" as="km_mba_pp_mes" type="number" title="План за месяц. МВА" group="sum" agg="no">
        <call function="when">
          <call function="=">
            <useparam name="plan_type" />
            <const>1</const>
          </call>
          <fact column="ipr_vvod_fiz_mba" nvl="0" table="vvod_mes" />
        </call>
        <call function="when">
          <call function="=">
            <useparam name="plan_type" />
            <const>2</const>
          </call>
          <fact column="ipr_vvod_fiz_mba_wfact" nvl="0" table="vvod_mes" />
        </call>
      </call>
      <call function="case" as="km_cnt_pp_mes" type="number" title="План за месяц. шт. (ПС, ТП)" group="sum" agg="no">
        <call function="when">
          <call function="=">
            <useparam name="plan_type" />
            <const>1</const>
          </call>
          <fact column="ipr_vvod_fiz_cnt" nvl="0" table="vvod_mes" />
        </call>
        <call function="when">
          <call function="=">
            <useparam name="plan_type" />
            <const>2</const>
          </call>
          <fact column="ipr_vvod_fiz_cnt_wfact" nvl="0" table="vvod_mes" />
        </call>
      </call>
      <call function="case" as="km_cnt_pr_pp_mes" type="number" title="План за месяц. шт. (прочие)" group="sum" agg="no">
        <call function="when">
          <call function="=">
            <useparam name="plan_type" />
            <const>1</const>
          </call>
          <fact column="ipr_vvod_fiz_cnt_proch" nvl="0" table="vvod_mes" />
        </call>
        <call function="when">
          <call function="=">
            <useparam name="plan_type" />
            <const>2</const>
          </call>
          <fact column="ipr_vvod_fiz_cnt_wfact_pr" nvl="0" table="vvod_mes" />
        </call>
      </call>
      <fact column="ipr_titul_ip_count" group="sum" title="Факт за месяц на текущ неделю. Кол-во объектов" as="obj_count_fact_mes" table="hoz_mes" nvl="0" agg="no" />
      <fact column="isv_ad_evd_count" as="ad_count_fact_mes" group="sum" title="Факт за месяц на текущ неделю. Кол-во Заявителей" nvl="0" table="hoz_mes" agg="no" />
      <fact column="km_vl_1c_fact" as="km_vl_1c_fact_mes" group="sum" nvl="0" title="Факт за месяц на текущ неделю, ВЛ 1-цепные км" table="hoz_mes" agg="no" />
      <fact column="km_vl_2c_fact" as="km_vl_2c_fact_mes" group="sum" nvl="0" title="Факт за месяц на текущ неделю, ВЛ 2-цепные км" table="hoz_mes" agg="no" />
      <fact column="km_kl_fact" as="km_kl_fact_mes" group="sum" nvl="0" title="Факт за месяц на текущ неделю, КЛ км" table="hoz_mes" agg="no" />
      <fact column="km_mba_fact" as="km_mba_fact_mes" group="sum" nvl="0" title="Факт за месяц на текущ неделю, МВА" table="hoz_mes" agg="no" />
      <fact column="km_cnt_fact" as="km_cnt_fact_mes" group="sum" nvl="0" title="Факт за месяц на текущ неделю, шт. (ПС, ТП)" table="hoz_mes" agg="no" />
      <fact column="km_cnt_pr_fact" as="km_cnt_pr_fact_mes" group="sum" nvl="0" title="Факт за месяц на текущ неделю, шт. (прочие)" table="hoz_mes" agg="no" />
      <call function="+nvl" as="perc" nvl="0" agg="no" title="Коэфициент успеха">
        <call function="/" title="Процент за месяц, Кол-во объектов" nvl="0">
          <column table="this" column="obj_count_fact_mes" title=" " />
          <column table="this" column="obj_count_plan_mes" title=" " />
        </call>
        <call function="/" title="Процент за месяц, Кол-во Заявителей" nvl="0">
          <column table="this" column="ad_count_fact_mes" title=" " />
          <column table="this" column="ad_count_plan_mes" title=" " />
        </call>
        <call function="/" title="Процент за месяц, ВЛ 1-цепные км" nvl="0">
          <column table="this" column="km_vl_1c_fact_mes" title=" " />
          <column table="this" column="km_vl_1c_pp_mes" title=" " />
        </call>
        <call function="/" title="Процент за месяц, ВЛ 2-цепные км" nvl="0">
          <column table="this" column="km_vl_2c_fact_mes" title=" " />
          <column table="this" column="km_vl_2c_pp_mes" title=" " />
        </call>
        <call function="/" title="Процент за месяц, КЛ" nvl="0">
          <column table="this" column="km_kl_fact_mes" title=" " />
          <column table="this" column="km_kl_pp_mes" title=" " />
        </call>
        <call function="/" title="Процент за месяц, МВА" nvl="0">
          <column table="this" column="km_mba_fact_mes" title=" " />
          <column table="this" column="km_mba_pp_mes" title=" " />
        </call>
        <call function="/" title="Процент за месяц, (ПС, ТП)" nvl="0">
          <column table="this" column="km_cnt_fact_mes" title=" " />
          <column table="this" column="km_cnt_pp_mes" title=" " />
        </call>
        <call function="/" title="Процент за месяц, (прочие)" nvl="0">
          <column table="this" column="km_cnt_pr_fact_mes" title=" " />
          <column table="this" column="km_cnt_pr_pp_mes" title=" " />
        </call>
      </call>
      <call function="over" as="res_perc" agg="no" title="Суммарный процент по РЭС">
        <call function="max">
          <column table="this" column="perc" />
        </call>
        <call function="partition by">
          <column table="evd_kodres" column="kod_direct" />
        </call>
      </call>
      <call function="over" as="filial_perc" agg="no" title="Суммарный процент по филиалу">
        <call function="max">
          <column table="this" column="perc" />
        </call>
        <call function="partition by">
          <column table="evd_kod_filial_tit" column="kod_direct" />
        </call>
      </call>
      <call function="dense_rank" as="res_rank" agg="no" title="Рейтинг по РЭС">
        <call function="order by 2">
          <call function="desc nulls last">
            <column table="this" column="res_perc" />
          </call>
        </call>
      </call>
      <call function="dense_rank" as="filial_rank" agg="no" title="Рейтинг по филиалу">
        <call function="order by 2">
          <call function="desc nulls last">
            <column table="this" column="filial_perc" />
          </call>
        </call>
      </call>
    </part>
    <part id="41656-cmn-links" timestamp="23.01.2018 14:17:32">
      <link name="evd_kod_filial_tit" />
      <link name="evd_kodres" />
      <link name="evd_pr_hoz_sposob" only-for-cond="1" />
      <link name="id_slice" only-for-cond="1" />
      <link name="evd_pr_vip" only-for-cond="1" />
      <link name="evd_pr_ostatok" only-for-cond="1" />
      <link name="evd_year_srok" only-for-cond="1" />
      <link name="evd_otch_list_3" only-for-cond="1" />
      <link name="evd_fl_build" only-for-cond="1" />
      <link name="evd_dt_contract" only-for-cond="1" />
      <link name="kod_isv_ad_evd" only-for-cond="1" />
      <link name="ipr_filial_res_valid" />
      <dimset as="titul_mes">
        <link name="ipr_kod_titul_ip" only-for-cond="1" />
        <link name="ipr_vvod_fiz" only-for-cond="1" />
        <where>
          <call function="and">
            <usepart part="41656-cmn-where-tituls" />
            <call function="=">
              <column table="ipr_vvod_fiz" column="ym" />
              <call function="num to ym2">
                <useparam name="year" />
                <useparam name="month" />
              </call>
            </call>
            <call function="=">
              <column table="id_slice" column="id_slice" />
              <useparam name="id_slice" />
            </call>
          </call>
        </where>
      </dimset>
      <dimset as="vvod_mes">
        <link name="ipr_ym" only-for-cond="1" />
        <link name="ipr_kod_titul_ip" only-for-cond="1" />
        <where>
          <call function="and">
            <usepart part="41656-cmn-where-tituls" />
            <call function="=">
              <column table="ipr_ym" column="val" />
              <call function="num to ym2">
                <useparam name="year" />
                <useparam name="month" />
              </call>
            </call>
            <call function="=">
              <column table="id_slice" column="id_slice" />
              <useparam name="id_slice" />
            </call>
          </call>
        </where>
      </dimset>
      <dimset as="hoz_mes">
        <link name="ipr_kod_titul_ip" only-for-cond="1" />
        <link name="ipr_kod_hoz_sposob" only-for-cond="1" />
        <where>
          <call function="and">
            <usepart part="41656-cmn-where-tituls" />
            <call function="=">
              <column table="ipr_kod_hoz_sposob" column="year" />
              <useparam name="year" />
            </call>
            <call function="=">
              <column table="ipr_kod_hoz_sposob" column="month" />
              <useparam name="month" />
            </call>
            <call function="le">
              <column table="ipr_kod_hoz_sposob" column="week" />
              <useparam name="week" />
            </call>
            <call function="=">
              <column table="id_slice" column="id_slice" />
              <useparam name="id_slice" />
            </call>
          </call>
        </where>
      </dimset>
      <dimset as="titul">
        <link name="ipr_kod_titul_ip" only-for-cond="1" />
        <where>
          <call function="and">
            <usepart part="41656-cmn-where-tituls" />
            <call function="=">
              <column table="id_slice" column="id_slice" />
              <useparam name="id_slice" />
            </call>
          </call>
        </where>
      </dimset>
      <dimset as="main">
        <where>
          <call function="and">
            <call function="=">
              <column table="id_slice" column="id_slice" />
              <useparam name="id_slice" />
            </call>
          </call>
        </where>
      </dimset>
    </part>
    <part id="41656-cmn-where" timestamp="22.01.2018 20:01:31">
      <call function="=">
        <call function="nvl0">
          <column table="evd_pr_hoz_sposob" column="val" />
        </call>
        <const>1</const>
      </call>
      <call function="or">
        <call function="=">
          <column table="evd_pr_vip" column="val" />
          <const>1</const>
        </call>
        <call function="=">
          <column table="evd_pr_ostatok" column="val" />
          <const>1</const>
        </call>
      </call>
      <call function="le">
        <column table="evd_year_srok" column="val" />
        <useparam name="year" />
      </call>
      <call function="or">
        <call function="=">
          <column table="evd_otch_list_3" column="val" />
          <const>1</const>
        </call>
        <call function="and">
          <call function="=">
            <call function="year">
              <column table="evd_dt_contract" column="val" />
            </call>
            <useparam name="year" />
          </call>
          <call function="is null">
            <column table="kod_isv_ad_evd" column="kod_org_active" />
          </call>
        </call>
      </call>
      <call function="=">
        <column table="evd_fl_build" column="val" />
        <const>1</const>
      </call>
      <call function="in" optional="1">
        <column table="evd_kod_filial_tit" column="kod_direct" />
        <useparam name="kod_direct" />
      </call>
    </part>
    <part id="41656-cmn-grouping" timestamp="05.12.2017 18:17:46">
      <grset as="all" title="Всего">
        <grset title="По филиалам" as="dep" order="dep_name">
          <group>
            <sourcelink table="evd_kod_filial_tit" />
          </group>
          <where>
            <call function="=">
              <column table="this" column="filial_res_valid" />
              <const>1</const>
            </call>
          </where>
          <grset title="По РЭС" as="res" order="res_name">
            <group>
              <sourcelink table="evd_kodres" />
            </group>
          </grset>
        </grset>
        <grset as="all_nv" title="Всего - Левый РЭС">
          <where>
            <call function="=">
              <column table="this" column="filial_res_valid" />
              <const>0</const>
            </call>
          </where>
        </grset>
      </grset>
    </part>
  </parts>
  <forms>
    <form name="41656" timestamp="17.01.2018 11:42:33">
      <content>
        <usefield field="ipr_kod_direct" title="Филиалы" exclude="1" />
        <usefield field="cmn_list" title="Филиалы" type="number" name="kod_direct" exclude="1">
          <listquery>
            <query name="41656-is_spr_direct_list" />
          </listquery>
        </usefield>
        <usefield field="kido_kod_direct" />
        <usefield field="cmn_list" title="Титулы" type="number" name="kod_titul_ip" rows-limit="100">
          <listquery>
            <query name="ipr_titul_ip_hoz_simple_list" />
          </listquery>
        </usefield>
        <usefield field="cmn_date_cur" title="Дата отчёта" name="dat" show-checkbox="0" mandatory="1" />
        <usefield field="cmn_combo_num" title="Плановые показатели" name="plan_type" show-checkbox="0" mandatory="1">
          <listquery>
            <query name="41656-plan-type" />
          </listquery>
        </usefield>
        <usefield field="cmn_integer" name="week" title="Отчётная неделя" column-editable="0" show-checkbox="0" column-visible="0">
          <defaultquery>
            <query name="41656-week" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_integer" name="month" column-editable="0" title="Отчётный месяц" show-checkbox="0" column-visible="0">
          <defaultquery>
            <query name="41656-month" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_integer" name="year" column-editable="0" title="Отчётный год" show-checkbox="0" column-visible="0">
          <defaultquery>
            <query name="41656-year" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_integer" name="id_slice" column-editable="0" title="Слайс" show-checkbox="0" column-visible="0">
          <defaultquery>
            <query name="41656-slice" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_integer" name="prev_week" title="Предыдущая неделя месяца" column-editable="0" show-checkbox="0" column-visible="0">
          <defaultquery>
            <query name="41656-prev-week" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_integer" name="id_slice_prev_week" column-editable="0" title="Слайс пред. недели" show-checkbox="0" column-visible="0">
          <defaultquery>
            <query name="41656-slice-prev-week" />
          </defaultquery>
        </usefield>
        <usefield field="kido_id_slice_m" title="Выбранные диапазоны 1" name="id_slice_all" column-visible="0">
          <defaultquery>
            <query name="41656-slice-all" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_integer" name="month_next" column-editable="0" title="Следующий месяц" show-checkbox="0" column-visible="0">
          <defaultquery>
            <query name="41656-month-next" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_integer" name="year_month_next" column-editable="0" title="Год следующего месяца" show-checkbox="0" column-visible="0">
          <defaultquery>
            <query name="41656-year-month-next" />
          </defaultquery>
        </usefield>
      </content>
    </form>
  </forms>
  <views>
    <view name="41656-plan-type-view">
      select 1 as kod, 'План по вводу в ОФ' as name from dual
      union all
      select 2, 'Ожидаемый факт по вводу в ОФ' from dual
    </view>
  </views>
</root>