<?xml version="1.0" encoding="utf-8"?>
<root>
  <queries>
    <query name="45862" timestamp="26.02.2019 16:52:10" is-report="1" title="Отчет пофидерный анализ по ПС филиалов" mode="excel" can-use-simple-params="1" visible="0">
      <procedure>
        <text>
          BEGIN
	 jg_reports_ise.jr_rep_blns_pwrc_vols_init(:ym);
          END;
        </text>
      </procedure>
      <print-templates>
        <excel>
          <template name="45862.xlsx" title="Отчет пофидерный анализ по ПС филиалов" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <events>
        <useaction event-name="double-click" action-type="open-column-grouping-detail" call="45862-detail_otp" column="wp_in">
          <useparam name="kod_fl" />
          <useparam name="pwrc_id" />
          <useparam name="pwrc_fdrid" />
          <useparam name="src_id" />
        </useaction>
        <useaction event-name="double-click" action-type="open-column-grouping-detail" call="45862-detail_potreb" column="wp_out" details-use-zeros="1">
          <useparam name="kod_fl" />
          <useparam name="pwrc_id" />
          <useparam name="pwrc_fdrid" />
          <useparam name="src_id" />
        </useaction>
        <useaction event-name="double-click" action-type="open-column-grouping-detail" call="45862-detail_otp" column="pnt_fdr">
          <useparam name="kod_fl" />
          <useparam name="pwrc_id" />
          <useparam name="pwrc_fdrid" />
          <useparam name="src_id" />
        </useaction>
        <useaction event-name="double-click" action-type="open-column-grouping-detail" call="45862-detail_potreb" column="pnt_grid">
          <useparam name="kod_fl" />
          <useparam name="pwrc_id" />
          <useparam name="pwrc_fdrid" />
          <useparam name="src_id" />
        </useaction>
      </events>
      <content>
        <usefield field="cmn_combo_num" title="Отчетный период" name="ym" column-mandatory="1">
          <listquery>
            <query name="45862-yms" />
          </listquery>
          <defaultquery>
            <query name="45862-ym-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_combo_num" title="Филиал" name="kod_fl" column-mandatory="1">
          <listquery>
            <query name="jv_rep_cons_d_fl" />
          </listquery>
          <defaultquery>
            <query name="45862-kod_fl-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_list" title="Подстанции" name="pwrc_id" type="number" column-mandatory="1">
          <listquery>
            <query name="hv_eopwrc_list" />
          </listquery>
          <defaultquery>
            <query name="45862-pwrc_id-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_list" title="Фидеры" name="pwrc_fdrid" type="number">
          <listquery>
            <query name="hv_eopwrc_fdrs_list" />
          </listquery>
          <defaultquery>
            <query name="hv_eopwrc_fdrs_default" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_list" title="ТП, РП, КК" name="src_id" type="number">
          <listquery>
            <query name="hv_eopwrc_grid_dtl_src_list" />
          </listquery>
          <defaultquery>
            <query name="hv_eopwrc_grid_dtl_src_list" />
          </defaultquery>
        </usefield>
      </content>
      <select>
        <column table="pwrc_id" column="pwrc_id" />
        <column table="pwrc_fdrid" column="pwrc_fdrid" />
        <column table="pwrc_grid" column="hv_eopwrc_grid_id" />
        <column table="pwrc_grid_dtl" column="src_fdrid" />
        <column table="kod_fl" column="name" as="fskname" group="max" title="Филиал" />
        <column table="pwrc_id" column="pwrcname" group="max" title="ДИСП №ПС" />
        <column table="pwrc_fdrid" column="pwrc_fdrname" group="max" title="ДИСП №ФИД" />
        <column table="pwrc_fdrid" column="isprm_fdr" group="max" title="ПР. ПРЯМОФИД" />
        <column table="pwrc_fdrid" column="pwrc_fdr_explname" title="Наименование РЭС" group="max" />
        <column table="pwrc_grid" column="srcname" group="max" title="ТП, РП, КК" />
        <column table="pwrc_grid" column="srcbalname" title="Балансовая принадлежность" group="max" />
        <column table="pwrc_grid_dtl" group="max" title="ТП, РП, КК (для линий)" column="src_fdrname" as="place_namefider" />
        <fact column="jr_rep_blns_pwrc_fdrs_wp_in" group="sum" as="wp_in" />
        <fact column="jr_rep_blns_pwrc_fdrs_wp_out" group="sum" as="wp_out" />
        <fact column="jr_rep_blns_pwrc_fdrs_pnt_fdr" group="sum" as="pnt_fdr" nvl="0" />
        <fact column="jr_rep_blns_pwrc_fdrs_pnt_grid" group="sum" as="pnt_grid" nvl="0" />
        <column table="pwrc_grid_dtl" column="src_id" as=" src_id" exclude="1" />
        <column table="pwrc_grid_dtl" column="src_fdrord" as="src_fdrord" group="max" />
      </select>
      <from>
        <qube star-scheme="1">
          <link name="pwrc_id" all-rows="1" />
          <link name="kod_fl" />
          <link name="pwrc_fdrid" all-rows="1" />
          <link name="pwrc_grid" all-rows="1" />
          <link name="pwrc_grid_dtl" all-rows="1" />
          <link name="rep_blns_pwrc_fdrs" exclude="1" />
          <where>
            <call function="and">
              <call function="=">
                <column table="kod_fl" column="kod_fl" />
                <useparam name="kod_fl" />
              </call>
              <call function="in" optional="1">
                <column table="pwrc_id" column="pwrc_id" />
                <useparam name="pwrc_id" />
              </call>
              <call function="in" optional="1">
                <column table="pwrc_fdrid" column="pwrc_fdrid" />
                <useparam name="pwrc_fdrid" />
              </call>
              <call function="or" optional="1">
                <call function="is null">
                  <column table="pwrc_grid_dtl" column="src_id" />
                </call>
                <call function="in">
                  <column table="pwrc_grid_dtl" column="src_id" />
                  <useparam name="src_id" />
                </call>
              </call>
            </call>
          </where>
        </qube>
      </from>
      <where exclude="1">
        <call function="=">
          <column table="kod_fl" column="kod_fl" />
          <useparam name="kod_fl" />
        </call>
      </where>
      <grouping>
        <grset as="all" title="Всего">
          <grset as="ps" title="По сетям" order="pwrcname">
            <group>
              <sourcelink table="pwrc_id" />
            </group>
            <grset as="fdr" title="По фидерам" order="pwrc_fdrname nulls first">
              <group>
                <sourcelink table="pwrc_fdrid" />
              </group>
              <grset as="tp" title="По ТП" order="srcname">
                <group>
                  <sourcelink table="pwrc_grid" />
                </group>
                <where>
                  <call function="is not null">
                    <column table="this" column="hv_eopwrc_grid_id" />
                  </call>
                </where>
                <grset as="line" title="По линиям" order="src_fdrord">
                  <group>
                    <column column="src_fdrid" table="this" />
                  </group>
                  <where>
                    <call function="is not null">
                      <column table="this" column="src_fdrid" />
                    </call>
                  </where>
                </grset>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="45862-yms_beg" timestamp="27.12.2018 18:36:32">
      <params>
        <param name="ym" type="number" />
      </params>
      <select>
        <call function="+" as="yms_beg" key="1">
          <call function="trunc">
            <call function="nvl">
              <useparam name="ym" />
              <call function="year">
                <call function="sysdate" />
              </call>
            </call>
          </call>
          <const>0.01</const>
        </call>
        <call as="name" type="" function="to_char">
          <column table="this" column="yms_beg" as="" type="" />
        </call>
      </select>
      <from>
        <query name="dual" as="a" />
      </from>
    </query>
    <query name="45862-detail_otp" timestamp="19.12.2018 19:23:14" is-report="1" title="Детализация отчета пофидер. анализ по ПС фил. ОТПУСК" visible="0">
      <params>
        <param name="kod_fl" type="number" part-id="45862-detail_otp_param" />
        <param name="pwrc_id" type="array" part-id="45862-detail_otp_param" />
        <param name="pwrc_fdrid" type="array" part-id="45862-detail_otp_param" />
        <param type="array" part-id="45862-detail_otp_param" name="src_id" />
      </params>
      <select>
        <column table="pwrc_grid" column="hv_eopwrc_grid_id" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="kod_rpoint" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="kod_outeris" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="pwrc_id" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="pwrcname" title="ДИСП №ПС" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="pwrc_fdrid" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="pwrc_fdrname" title="ДИСП №ФИД" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="src_id" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="srcname" title="ДИСП №ТП,РП,КК" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="tpoint" title="ВИД ТУ" part-id="45862-detail_otp_select" />
        <call function="to_char" title="№ТУ" as="pnum" comment="чтобы не выводились итоги в футере" part-id="45862-detail_otp_select">
          <column table="rep_blns_pwrc_fdrs" column="pnum" />
        </call>
        <column table="rep_blns_pwrc_fdrs" column="pname" title="НАИМЕН. ТУ" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="place_namefider" title="ОБОРУД" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="cnt_num" title="№ ПУ" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="readvals" title="ПОКАЗАНИЯ" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="cnt_rkoef" title="РАСЧ.КОЭФ" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="out1" title="РАСХ. ПО СЧ., кВт*ч (А+)" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="cust1" title="КОЛИЧ. ЭЭ. кВт*ч (А+)" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="out2" title="РАСХ. ПО СЧ., кВт*ч (А-)" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="cust2" title="КОЛИЧ. ЭЭ. кВт*ч (А-)" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="wp_in" title="ОТПУСК ПО ФИДЕРУ, кВт*ч" format="N2" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="wp_out" title="ПОТРЕБЛ. ПО ФИДЕРУ, кВт*ч" format="N2" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="name_es" title="ЭСК" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="name_fsk" title="ЗОНА ФИЛИАЛА ЛЭ" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="name_rsk" title="РЭС" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="dog_num" title="№ ДОГОВОРА ЭНЕРГ" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="user_name" title="ПОТРЕБИТЕЛЬ" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="eobj_num" title="№ ОБЪЕКТА" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="eobj_name" title="НАИМЕН. ОБЪЕКТА" part-id="45862-detail_otp_select" />
        <column table="rep_blns_pwrc_fdrs" column="r_pwrlev" title="УН" part-id="45862-detail_otp_select" />
        <call function="to_char" title="НАПРЯЖ, кВ" as="pwr_lev" comment="чтобы не выводились итоги в футере" part-id="45862-detail_otp_select">
          <column table="rep_blns_pwrc_fdrs" column="pwr_lev" />
        </call>
        <column table="rep_blns_pwrc_fdrs" column="eobj_adress" title="АДРЕС ОБЪЕКТА ПОТРЕБИТЕЛЯ" part-id="45862-detail_otp_select" />
        <call function="to_char" title="№ ГРУППЫ ДАННЫХ" as="gr" comment="чтобы не выводились итоги в футере" part-id="45862-detail_otp_select">
          <column table="rep_blns_pwrc_fdrs" column="gr" />
        </call>
        <call function="to_char" title="ОТЧ.ПЕРИОД" comment="чтобы не выводились итоги в футере" as="ym" part-id="45862-detail_otp_select">
          <column table="rep_blns_pwrc_fdrs" column="ym" />
        </call>
        <column table="rep_blns_pwrc_fdrs" column="src_fdrid" part-id="45862-detail_otp_select" />
      </select>
      <from>
        <qube star-scheme="1" part-id="45862-detail_otp_qube">
          <link name="pwrc_id" part-id="45862-detail_otp_qube" />
          <link name="kod_fl" part-id="45862-detail_otp_qube" />
          <link name="pwrc_fdrid" part-id="45862-detail_otp_qube" />
          <link name="pwrc_grid" part-id="45862-detail_otp_qube" />
          <link name="pwrc_grid_dtl" part-id="45862-detail_otp_qube" />
          <link name="rep_blns_pwrc_fdrs" all-rows="1" part-id="45862-detail_otp_qube" />
        </qube>
      </from>
    </query>
    <query name="45862-test" timestamp="14.03.2018 15:50:30" is-report="1" title="Отчет пофидерный анализ по ПС филиалов" mode="excel" can-use-simple-params="1">
      <select>
        <column table="pwrc_id" column="pwrc_id" />
        <column table="pwrc_id" column="bal_id" />
        <column table="pwrc_fdrid" column="pwrc_fdrid" />
        <column table="pwrc_grid" column="hv_eopwrc_grid_id" />
        <column table="pwrc_grid_dtl" column="src_fdrid" />
        <column table="kod_fl" column="name" as="fskname" group="max" title="Филиал" />
        <column table="pwrc_id" column="pwrcname" group="max" title="ДИСП №ПС" />
        <column table="pwrc_fdrid" column="pwrc_fdrname" group="max" title="ДИСП №ФИД" />
        <column table="pwrc_fdrid" column="isprm_fdr" group="max" title="ПР. ПРЯМОФИД" />
        <column table="pwrc_grid" column="srcname" group="max" title="ТП, РП, КК" />
        <column table="pwrc_grid_dtl" group="max" title="ТП, РП, КК (для линий)" column="src_fdrname" as="place_namefider" />
        <fact column="jr_rep_blns_pwrc_fdrs_wp_in" group="sum" as="wp_in" exclude="1" />
        <fact column="jr_rep_blns_pwrc_fdrs_wp_out" group="sum" as="wp_out" exclude="1" />
        <fact column="jr_rep_blns_pwrc_fdrs_pnt_fdr" group="sum" as="pnt_fdr" nvl="0" exclude="1" />
        <fact column="jr_rep_blns_pwrc_fdrs_pnt_grid" group="sum" as="pnt_grid" nvl="0" />
      </select>
      <from>
        <qube>
          <link name="pwrc_id" all-rows="1">
            <link name="kod_fl" />
          </link>
          <link name="pwrc_fdrid" all-rows="1" />
          <link name="pwrc_grid" all-rows="1" />
          <link name="pwrc_grid_dtl" all-rows="1" />
          <link name="rep_blns_pwrc_fdrs" />
          <where>
            <call function="and">
              <call function="=" exclude="1">
                <column table="kod_fl" column="kod_fl" />
                <const>12968</const>
              </call>
              <call function="=">
                <column table="pwrc_id" column="bal_id" />
                <const>12968</const>
              </call>
              <call function="in" optional="1">
                <column table="pwrc_id" column="pwrc_id" />
                <const>208996</const>
              </call>
              <call function="=" exclude="1">
                <column table="pwrc_grid_dtl" column="src_fdrid" />
                <const>336105</const>
              </call>
            </call>
          </where>
        </qube>
      </from>
      <where exclude="1">
        <call function="=">
          <column table="pwrc_grid_dtl" column="src_fdrid" />
          <const>372910</const>
        </call>
      </where>
      <grouping>
        <grset as="all" title="Всего" exclude="1">
          <grset as="ps" title="По сетям" order="pwrcname">
            <group>
              <sourcelink table="pwrc_id" />
            </group>
            <grset as="fdr" title="По фидерам" order="pwrc_fdrname nulls first">
              <group>
                <sourcelink table="pwrc_fdrid" />
              </group>
              <grset as="tp" title="По ТП" order="srcname">
                <group>
                  <sourcelink table="pwrc_grid" />
                </group>
                <where>
                  <call function="is not null">
                    <column table="this" column="hv_eopwrc_grid_id" />
                  </call>
                </where>
                <grset as="line" title="По линиям" order="place_namefider">
                  <group>
                    <column column="src_fdrid" table="this" />
                  </group>
                  <where>
                    <call function="is not null">
                      <column table="this" column="src_fdrid" />
                    </call>
                  </where>
                </grset>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="45862-detail_potreb" timestamp="08.08.2018 18:25:34" is-report="1" title="Детализация отчета пофидер. анализ по ПС фил. ПОТРЕБЛЕНИЕ" visible="0">
      <params>
        <usepart part="45862-detail_otp_param" />
      </params>
      <select>
        <usepart part="45862-detail_otp_select" />
      </select>
      <from>
        <usepart part="45862-detail_otp_qube" />
      </from>
    </query>
    <query name="45862_test" timestamp="21.05.2021 16:22:41" is-report="1" title="2. Отчет по небалансам электроэнергии" mode="excel" can-use-simple-params="1" order="YM_START_ANALYZ, PWRCNAME, per_kg_s desc, REAL_FDR, srcname, src_fdrord">
      <procedure>
        <text>
    BEGIN
        --дублируется, костыль, но в качестве исправления по-другому никак
        --из-за изменения переменной пакета при запуске отчетов 3.1., 3.2.
        jg_reports_ise.jr_rep_blns_pwrc_sx_init(:kod_fl, 1);
        
        delete from rr_temp where skod = '45862_fdr_lst';
        insert into rr_temp (skod, n1)
        select distinct '45862_fdr_lst' as skod, a.pwrc_fdrid
        from hv_eopwrc_fdrs a
        where a.pwrc_fdrid in :pwrc_fdrid;
        
        jg_reports_ise.jr_rep_blns_pwrc_vols_init(:ym);
        sqlb_d45862_fdr_kg.fill_table(:ym, :ym, 0);
    END;
</text>
      </procedure>
      <print-templates>
        <excel>
          <template name="45862_test.xlsx" title="Отчет пофидерный анализ по ПС филиалов" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <events>
        <useaction event-name="double-click" action-type="open-column-grouping-detail" call="45862-detail_otp_test" column="wp_in">
          <useparam name="ym" />
          <useparam name="kod_fl" />
          <useparam name="pwrc_id" />
          <useparam name="pwrc_fdrid" />
          <useparam name="src_id" />
        </useaction>
        <useaction event-name="double-click" action-type="open-column-grouping-detail" call="45862-detail_potreb_test" column="wp_out" details-use-zeros="1">
          <useparam name="ym" />
          <useparam name="kod_fl" />
          <useparam name="pwrc_id" />
          <useparam name="pwrc_fdrid" />
          <useparam name="src_id" />
        </useaction>
        <useaction event-name="double-click" action-type="open-column-grouping-detail" call="45862-detail_otp_test" column="pnt_fdr">
          <useparam name="ym" />
          <useparam name="kod_fl" />
          <useparam name="pwrc_id" />
          <useparam name="pwrc_fdrid" />
          <useparam name="src_id" />
        </useaction>
        <useaction event-name="double-click" action-type="open-column-grouping-detail" call="45862-detail_potreb_test" column="pnt_grid">
          <useparam name="ym" />
          <useparam name="kod_fl" />
          <useparam name="pwrc_id" />
          <useparam name="pwrc_fdrid" />
          <useparam name="src_id" />
        </useaction>
      </events>
      <content>
        <usefield field="cmn_combo_num" title="Отчетный период" name="ym" column-mandatory="1">
          <listquery>
            <query name="45862-yms" />
          </listquery>
          <defaultquery>
            <query name="45862-ym-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_combo_num" name="ym_beg" column-mandatory="1" title="Начало года" column-visible="0">
          <listquery>
            <query name="45862-yms_beg" />
          </listquery>
          <defaultquery>
            <query name="45862-yms_beg" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_combo_num" title="Филиал" name="kod_fl" column-mandatory="1">
          <listquery>
            <query name="jv_rep_cons_d_fl" />
          </listquery>
          <defaultquery>
            <query name="45862-kod_fl-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_list" title="Подстанции" name="pwrc_id" type="number" column-mandatory="1">
          <listquery>
            <query name="hv_eopwrc_list_test" />
          </listquery>
          <defaultquery>
            <query name="45862-pwrc_id-def" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_list" title="Фидеры" name="k_kg_name" type="string" column-mandatory="1">
          <listquery>
            <query name="45862_kg_name_list" />
          </listquery>
          <defaultquery>
            <query name="45862_kg_name_default" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_list" title="Фидеры без КГ" name="pwrc_fdrid" type="number" column-visible="0">
          <listquery>
            <query name="45862_fdr_by_kn_name_list" />
          </listquery>
          <defaultquery>
            <query name="45862_fdr_by_kn_name_list" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_list" title="ТП, РП, КК" name="src_id" type="number" exclude="1">
          <listquery>
            <query name="45862_tp_list" />
          </listquery>
          <defaultquery>
            <query name="45862_tp_list" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_list" title="ТП, РП, КК" name="src_id" type="number">
          <listquery>
            <query name="45862_tp_list_v2" />
          </listquery>
          <defaultquery>
            <query name="45862_tp_list_v2" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_check" name="kg_missing_tp_flag" title="Есть новые тп не включены в кг" visible="0">
          <defaultquery>
            <query name="45862_fdr_kg_missing_tp_single_ym_flag" />
          </defaultquery>
        </usefield>
        <usefield field="cmn_text" name="kg_missing_tp_text" column-editable="0" title="ТП, которые необходимо включить в КГ">
          <defaultquery>
            <query name="45862_fdr_kg_missing_tp_single_ym_text" />
          </defaultquery>
        </usefield>
      </content>
      <select>
        <column table="pwrc_id" column="pwrc_id" />
        <column table="pwrc_id" column="YM_START_ANALYZ" />
        <column table="k_gr_f_tp" column="k_gr_f_tp" />
        <column table="k_gr_f_tp" column="k_kg_name" exclude="1" />
        <column table="kg_name" column="k_kg_name" />
        <column table="k_gr_f_tp" column="src_id" />
        <column table="grid_dtl_kg" column="src_fdrid" />
        <column table="kod_fl" column="name" as="fskname" group="max" title="Филиал" />
        <column table="pwrc_id" column="pwrcname" group="max" title="ДИСП №ПС" />
        <column table="kg_name" column="val" title="ДИСП №ФИД" as="kg_name" exclude="1" />
        <column table="kg_name" column="kg_name_w_real_fdr" title="ДИСП №ФИД" as="kg_name" />
        <column table="k_gr_f_tp" column="isprm_fdr" group="stragg_dist" />
        <column table="k_gr_f_tp" column="pwrc_fdr_explname" group="stragg_dist" />
        <column table="k_gr_f_tp" group="max" column="real_fdr" />
        <column table="k_gr_f_tp" column="srcname" group="max" title="ТП, РП, КК" as="srcname" />
        <column table="k_gr_f_tp" column="srcbalname" title="Балансовая принадоежность" group="max" />
        <column table="grid_dtl_kg" group="max" title="ТП, РП, КК (для линий)" column="src_fdrname" as="place_namefider" />
        <fact column="jr_rep_blns_pwrc_fdrs_test_wp_in" group="sum" as="wp_in" table="all" />
        <call as="wp_in_ym1" function="if" group="sum" exclude="1">
          <call function="=">
            <column table="d45862_ym" column="val" />
            <useparam name="ym" />
          </call>
          <fact table="all" column="jr_rep_blns_pwrc_fdrs_test_wp_in" />
        </call>
        <call as="wp_in_ym2" function="if" group="sum" exclude="1">
          <call function="=">
            <column table="d45862_ym" column="val" />
            <useparam name="ym_end" />
          </call>
          <fact table="all" column="jr_rep_blns_pwrc_fdrs_test_wp_in" />
        </call>
        <fact column="jr_rep_blns_pwrc_fdrs_test_wp_out" group="sum" as="wp_out" table="all" />
        <call as="wp_out_ym1" function="if" group="sum" exclude="1">
          <call function="=">
            <column table="d45862_ym" column="val" />
            <useparam name="ym" />
          </call>
          <fact table="all" column="jr_rep_blns_pwrc_fdrs_test_wp_out" />
        </call>
        <call as="wp_out_ym2" function="if" group="sum" exclude="1">
          <call function="=">
            <column table="d45862_ym" column="val" />
            <useparam name="ym_end" />
          </call>
          <fact table="all" column="jr_rep_blns_pwrc_fdrs_test_wp_out" />
        </call>
        <fact column="jr_rep_blns_pwrc_fdrs_test_pnt_fdr" group="sum" as="pnt_fdr" nvl="0" table="all" />
        <fact column="jr_rep_blns_pwrc_fdrs_test_pnt_grid" group="sum" as="pnt_grid" nvl="0" table="all" />
        <column table="grid_dtl_kg" column="src_fdrord" as="src_fdrord" group="max" />
        <fact column="f45862_fdr_kg_pwrc_id" table="f_tp" />
        <fact column="f45862_kg_per_s" table="f_tp" exclude="1" />
        <fact table="all" column="f45862_grid_dtl_kg_pwrc_id" />
        <call function="nvl0" as="per_kg_s" exclude="1">
          <column table="k_gr_f_tp" column="per_kg_s" />
        </call>
        <column table="k_gr_f_tp" column="per_kg_s" as="per_kg_s" exclude="1" />
        <column table="kg_name" column="per_kg_s" />
      </select>
      <from>
        <qube star-scheme="1" single-way="1">
          <dimset as="all">
            <link name="k_gr_f_tp" />
            <link name="kg_name" />
            <link name="grid_dtl_kg" />
            <where>
              <call function="and">
                <call function="in" optional="1">
                  <column table="k_gr_f_tp" column="k_kg_name" />
                  <useparam name="k_kg_name" />
                </call>
                <call function="or" optional="1">
                  <call function="is null">
                    <column table="grid_dtl_kg" column="src_id" />
                  </call>
                  <call function="in">
                    <column table="grid_dtl_kg" column="src_id" />
                    <useparam name="src_id" />
                  </call>
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="f_tp">
            <link name="kg_name" />
            <link name="k_gr_f_tp" />
            <where>
              <call function="and">
                <call function="in" optional="1">
                  <column table="k_gr_f_tp" column="k_kg_name" />
                  <useparam name="k_kg_name" />
                </call>
              </call>
            </where>
          </dimset>
          <dimset as="eqp">
            <link name="grid_dtl_kg" />
            <where>
              <call function="and">
                <call function="or" optional="1">
                  <call function="is null">
                    <column table="grid_dtl_kg" column="src_id" />
                  </call>
                  <call function="in">
                    <column table="grid_dtl_kg" column="src_id" />
                    <useparam name="src_id" />
                  </call>
                </call>
              </call>
            </where>
          </dimset>
          <link name="kod_fl" />
          <link name="pwrc_id" />
          <link name="d45862_ym" exclude="1" />
          <where>
            <call function="and">
              <call function="in" optional="1">
                <column table="pwrc_id" column="pwrc_id" />
                <useparam name="pwrc_id" />
              </call>
              <call function="=">
                <column table="kod_fl" column="kod_fl" />
                <useparam name="kod_fl" />
              </call>
              <call optional="1" function="between" exclude="1">
                <column table="d45862_ym" column="val" />
                <useparam name="ym" />
                <useparam name="ym_end" />
              </call>
              <call function="or" optional="1" exclude="1">
                <call function="is null">
                  <column table="pwrc_grid_dtl" column="src_id" />
                </call>
                <call function="in">
                  <column table="pwrc_grid_dtl" column="src_id" />
                  <useparam name="src_id" />
                </call>
              </call>
            </call>
          </where>
        </qube>
      </from>
      <grouping>
        <grset as="all" title="Всего">
          <grset as="ps" title="По сетям" order="pwrcname">
            <group>
              <sourcelink table="pwrc_id" />
            </group>
            <grset as="fdr" title="По фидерам" order="(case when (SUBSTR( k_kg_name, 1 , 1) != '-') then 1 end) nulls last, kg_name nulls first">
              <group>
                <sourcelink table="kg_name" />
              </group>
              <grset as="tp" title="По ТП" order="real_fdr, srcname">
                <group>
                  <sourcelink table="k_gr_f_tp" />
                </group>
                <where>
                  <call function="is not null">
                    <column table="this" column="src_id" />
                  </call>
                </where>
                <grset as="line" title="По линиям" order="src_fdrord">
                  <group>
                    <column column="src_fdrid" table="this" />
                  </group>
                  <where>
                    <call function="is not null">
                      <column table="this" column="src_fdrid" />
                    </call>
                  </where>
                </grset>
              </grset>
            </grset>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="45862_m2m_pwrc_fdr" class="1" timestamp="11.09.2019 18:06:58">
      <select>
        <call function="||-" as="id" key="1" group="1">
          <column table="this" column="pwrc_id" />
          <column table="a" column="id" />
        </call>
        <call as="k_pwrc_fdr" function="||-" group="1">
          <column table="this" column="pwrc_id" />
          <column table="a" column="k_gr_f_tp" />
        </call>
        <column table="a" column="k_gr_f_tp" group="1" />
        <call as="pwrc_id" function="nvl" group="1">
          <column table="kg_pwrc" column="pwrc_id" />
          <column table="a" column="pwrc_id" />
        </call>
        <column table="a" column="ym" group="1" />
      </select>
      <from>
        <query name="d45862_fdr_kg" as="a" />
        <query name="45862_kg_pwrc" as="kg_pwrc" join="left outer">
          <call function="and">
            <call function="=">
              <column table="a" column="kod_kol_gr" />
              <column table="kg_pwrc" column="kod_kol_gr" />
            </call>
            <call function="=">
              <column table="a" column="ym" />
              <column table="kg_pwrc" column="ym" />
            </call>
          </call>
        </query>
      </from>
    </query>
    <query name="45862_kg_pwrc" class="1" timestamp="11.09.2019 18:06:58">
      <select>
        <call group="1" function="||-" as="id" key="1">
          <column table="a" column="kod_kol_gr" />
          <column table="a" column="ym" />
        </call>
        <column table="a" column="kod_kol_gr" group="1" />
        <column table="a" column="pwrc_id" group="1" />
        <column table="a" column="ym" group="1" />
      </select>
      <from>
        <query name="d45862_fdr_kg" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="is not null">
            <column table="a" column="kod_kol_gr" />
          </call>
          <call function="=0">
            <column table="a" column="exclude_auto_fdr" />
          </call>
        </call>
      </where>
    </query>
    <query name="OLD_45862_tp_kg" class="1" timestamp="26.12.2018 18:36:21" materialize="1">
      <select>
        <call as="id" function="||-" key="1">
          <column table="this" column="k_gr_f_tp" />
          <column table="ym" column="ym" />
        </call>
        <call as="k_gr_f_tp" function="||-">
          <column table="kod_kol_gr" column="kod_kol_gr" />
          <column table="a" column="pwrc_fdrid" />
          <column table="tpn" column="src_id" />
        </call>
        <call as="k_f_tp" function="||-">
          <column table="a" column="pwrc_fdrid" />
          <column table="tpn" column="src_id" />
        </call>
        <call as="is_tp_gr" function="if" type="number">
          <call function="or">
            <call function="is not null" comment="выбранные ТП">
              <column table="tp" column="src_id" />
            </call>
            <call function="is null" comment="не выбраны ТП (весь фидер)">
              <column table="tpsel" column="kod_kol_gr_fdr" />
            </call>
            <call function="is null" comment="фидеры без ТП + строка с фидером и пустой ТП, если в схеме у фидера есть ТП">
              <column table="tpn" column="src_id" />
            </call>
          </call>
          <const>1</const>
          <const>0</const>
        </call>
        <column table="kod_kol_gr" column="name" />
        <column table="kod_kol_gr" column="kod_kol_gr" />
        <column table="ym" column="ym" />
      </select>
      <from>
        <query name="vb_kol_gr_fdr" as="a">
          <link name="kod_kol_gr_pwrc">
            <link name="kod_kol_gr_nastr">
              <link name="kod_kol_gr" />
              <link name="ym" />
            </link>
          </link>
          <link name="tpsel" />
        </query>
        <query name="hv_eopwrc_grid" as="tpn" join="left outer">
          <call function="=">
            <column table="a" column="pwrc_fdrid" />
            <column table="tpn" column="pwrc_fdrid" />
          </call>
        </query>
        <query name="vb_kol_gr_tp" as="tp" join="left outer">
          <call function="and">
            <call function="=">
              <column table="a" column="kod_kol_gr_fdr" />
              <column table="tp" column="kod_kol_gr_fdr" />
            </call>
            <call function="=">
              <column table="tpn" column="src_id" />
              <column table="tp" column="src_id" />
            </call>
          </call>
        </query>
        <query name="hv_eopwrc_grid" as="hv_eopwrc_grid_id" join="left outer" dname="45862_tp_kg_elink_tp">
          <call function="and">
            <call function="=">
              <column table="this" column="k_f_tp" />
              <column table="hv_eopwrc_grid_id" column="hv_eopwrc_grid_id" />
            </call>
            <call function="=" exclude="1">
              <column table="this" column="ym" />
              <column table="hv_eopwrc_grid_id" column="ym" />
            </call>
          </call>
        </query>
      </from>
      <where exclude="1">
        <call function="=" exclude="1">
          <column table="a" column="pwrc_fdrid" />
          <const>8885</const>
        </call>
        <call function="=">
          <column table="this" column="is_tp_gr" />
          <const>1</const>
        </call>
      </where>
    </query>
    <query name="45862_tp_is_selected" class="1" timestamp="05.12.2018 21:24:25">
      <select>
        <column table="a" column="kod_kol_gr_fdr" group="1" />
      </select>
      <from>
        <query name="vb_kol_gr_tp" as="a" />
      </from>
    </query>
    <query name="OLD_d45862_fdr_kg" class="1" timestamp="26.12.2018 19:00:17" materialize="1">
      <select>
        <call function="if" as="id" key="1" type="string">
          <call function="=">
            <column table="tp_kg" column="is_tp_gr" />
            <const>1</const>
          </call>
          <column table="tp_kg" column="id" />
          <call function="||-">
            <const>''</const>
            <column table="hv_eopwrc_grid" column="hv_eopwrc_grid_id" />
            <column table="this" column="ym" />
          </call>
        </call>
        <call function="if" as="k_gr_f_tp" type="string">
          <call function="=">
            <column table="tp_kg" column="is_tp_gr" />
            <const>1</const>
          </call>
          <column table="tp_kg" column="k_gr_f_tp" />
          <call function="||-">
            <const>''</const>
            <column table="hv_eopwrc_grid" column="hv_eopwrc_grid_id" />
          </call>
        </call>
        <column table="hv_eopwrc_grid" column="hv_eopwrc_grid_id" as="k_f_tp" />
        <call function="if" as="k_kg_name">
          <call function="=">
            <column table="tp_kg" column="is_tp_gr" />
            <const>1</const>
          </call>
          <call function="||">
            <column table="tp_kg" column="kod_kol_gr" />
            <const>'-'</const>
          </call>
          <call function="||">
            <const>'-'</const>
            <column table="a" column="pwrc_fdrid" />
            <const>'-'</const>
          </call>
        </call>
        <column table="a" column="pwrc_id" type="number" column-mandatory="1" title="" is-fact="1" agg="max" fact="f45862_fdr_kg_pwrc_id" exclude="1" />
        <call function="if" as="kg_name" is-private-dimension="kg_name" is-final-dimension="kg_name" dimension="kg_name">
          <call function="=">
            <column table="tp_kg" column="is_tp_gr" />
            <const>1</const>
          </call>
          <column table="tp_kg" column="name" />
          <column table="a" column="pwrc_fdrname" />
        </call>
        <call function="if" as="kod_kol_gr">
          <call function="=">
            <column table="tp_kg" column="is_tp_gr" />
            <const>1</const>
          </call>
          <column table="tp_kg" column="kod_kol_gr" />
        </call>
        <column table="a" column="pwrc_fdrid" />
        <call as="real_fdr" function="||">
          <call function="substr">
            <column table="a" column="pwrcname" />
            <call function="+">
              <call function="instr">
                <column table="a" column="pwrcname" />
                <const>'('</const>
              </call>
              <const>1</const>
            </call>
            <call function="-">
              <call function="instr">
                <column table="a" column="pwrcname" />
                <const>')'</const>
              </call>
              <call function="instr">
                <column table="a" column="pwrcname" />
                <const>'('</const>
              </call>
              <const>1</const>
            </call>
          </call>
          <const>' ('</const>
          <column table="a" column="pwrc_fdrname" />
          <const>')'</const>
        </call>
        <column table="a" column="isprm_fdr" />
        <column table="a" column="pwrc_fdr_explname" />
        <column table="hv_eopwrc_grid" column="src_id" />
        <column table="hv_eopwrc_grid" column="srcname" />
        <column table="hv_eopwrc_grid" column="srcbalname" />
        <column table="tp_kg" column="ym" exclude="1" />
        <call as="ym" function="nvl">
          <column table="tp_kg" column="ym" />
          <const>2018.06</const>
          <call function="date to ym" exclude="1">
            <call function="sysdate" />
          </call>
        </call>
        <column table="ym" column="ym" is-private-dimension="d45862_ym" is-final-dimension="d45862_ym" dimension="d45862_ym" exclude="1" />
      </select>
      <from>
        <query name="hv_eopwrc_fdrs" as="a">
          <elink name="hv_eopwrc_grid">
            <elink name="45862_tp_kg_elink_tp" as="tp_kg" />
          </elink>
        </query>
        <query name="hv_eopwrc_g" as="pwrc_id" join="left outer">
          <call function="=">
            <column table="this" column="pwrc_id" />
            <column table="pwrc_id" column="pwrc_id" />
          </call>
        </query>
        <query name="45862-yms_test" join="left outer" as="ym" exclude="1">
          <call function="=">
            <const>1</const>
            <const>1</const>
          </call>
        </query>
      </from>
      <where>
        <call function="=">
          <call function="nvl">
            <column table="tp_kg" column="is_tp_gr" />
            <const>1</const>
          </call>
          <const>1</const>
        </call>
      </where>
      <links>
        <link name="pwrc_id" is-private-dimension="1" is-final-dimension="1" dimension="1">
          <dimlink name="kod_fl" is-private-dimension="1" is-final-dimension="1" dimension="1" />
        </link>
      </links>
    </query>
    <query name="45862_fdr_kg_list" class="1" timestamp="10.04.2020 21:07:11">
      <params>
        <param name="pwrc_id" type="array">
          <const>78784</const>
        </param>
        <param type="number" name="ym">
          <const>2018.07</const>
        </param>
      </params>
      <select>
        <call function="||-" key="1" as="pk">
          <column table="kod_kol_gr" column="kod_kol_gr" />
          <column table="a" column="pwrc_fdrid" />
        </call>
        <call function="||" as="k_kg_name">
          <call function="nvl">
            <column column="kod_kol_gr" table="kod_kol_gr" />
            <call function="||">
              <const>'-'</const>
              <column table="a" column="pwrc_fdrid" />
            </call>
          </call>
          <const>'-'</const>
        </call>
        <call as="pwrc_fdrname" function="nvl" title="дисп.номер">
          <column table="kod_kol_gr" column="name" />
          <column table="a" column="pwrc_fdrname" />
        </call>
        <column table="a" column="pwrc_fdr_balname" type="string" title="Бал.принадл" />
        <column table="a" column="pwrc_fdr_bal_id" />
        <column table="a" column="pwrc_fdr_explname" type="string" title="Экспл.отв" />
        <column table="a" column="pwrc_id" type="number" column-mandatory="1" />
        <column table="a" column="pwrc_fdrid" type="number" column-mandatory="1" />
        <column table="a" column="pwrcname" type="string" title="Наименование ПС" />
        <column table="a" column="pr_cycle" type="number" />
        <call function="case" as="pr_cycle_name" title="пр. Закольцован" type="string">
          <call function="when">
            <call function="=">
              <column table="a" column="pr_cycle" />
              <const>1</const>
            </call>
            <const>'Да'</const>
          </call>
          <call function="when">
            <call function="=">
              <column table="a" column="pr_cycle" />
              <const>0</const>
            </call>
            <const>'Нет'</const>
          </call>
        </call>
        <column table="kod_kol_gr" column="kod_kol_gr" />
        <column table="kod_kol_gr" column="fdr_in_auto_kg" />
        <column table="kod_kol_gr" column="is_auto_kg_real" />
        <call as="cnt_fdr_in_kg" function="over">
          <call function="count">
            <call function="if">
              <call function="and">
                <call function="in">
                  <column table="a" column="pwrc_id" />
                  <useparam name="pwrc_id" />
                </call>
                <call function="true" />
                <call function="not" exclude="1">
                  <call function="and">
                    <call function="=">
                      <call function="nvl">
                        <column table="kod_kol_gr" column="fdr_in_auto_kg" />
                        <const>-1</const>
                      </call>
                      <const>1</const>
                    </call>
                    <call function="=">
                      <call function="nvl">
                        <column table="kod_kol_gr" column="is_auto_kg_real" />
                        <const>-1</const>
                      </call>
                      <const>0</const>
                    </call>
                  </call>
                </call>
              </call>
              <column table="a" column="pwrc_fdrid" />
            </call>
          </call>
          <call function="partition by">
            <column table="kod_kol_gr" column="kod_kol_gr" />
          </call>
        </call>
      </select>
      <from>
        <query name="hv_eopwrc_fdrs" as="a" />
        <query name="45862_nastr_by_ym" join="left outer" as="kod_kol_gr">
          <withparams>
            <useparam name="ym" />
          </withparams>
          <call function="=">
            <column table="a" column="pwrc_fdrid" />
            <column table="kod_kol_gr" column="pwrc_fdrid" />
          </call>
        </query>
        <query name="45862_gr_by_pwrc_list" as="b" join="left outer">
          <withparams>
            <useparam name="pwrc_id" />
          </withparams>
          <call function="=">
            <column table="this" column="kod_kol_gr" />
            <column table="b" column="kod_kol_gr" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="or">
            <call function="false" />
            <call function="in" optional="1">
              <column table="a" column="pwrc_id" />
              <useparam name="pwrc_id" />
            </call>
            <call function="is not null">
              <column table="b" column="kod_kol_gr" />
            </call>
          </call>
          <call function="not" exclude="1">
            <call function="and">
              <call function="=">
                <call function="nvl">
                  <column table="kod_kol_gr" column="fdr_in_auto_kg" />
                  <const>-1</const>
                </call>
                <const>1</const>
              </call>
              <call function="=">
                <call function="nvl">
                  <column table="kod_kol_gr" column="is_auto_kg_real" />
                  <const>-1</const>
                </call>
                <const>0</const>
              </call>
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="45862_gr_by_pwrc_list" class="1" timestamp="19.02.2019 10:48:44">
      <params>
        <param name="pwrc_id" type="array">
          <const>8871</const>
        </param>
      </params>
      <select>
        <column table="kod_kol_gr" column="kod_kol_gr" group="1" />
      </select>
      <from>
        <query name="vb_kol_gr_pwrc" as="a">
          <link name="kod_kol_gr_nastr">
            <link name="kod_kol_gr" />
          </link>
        </query>
      </from>
      <where>
        <call function="or">
          <call function="false" />
          <call function="in" optional="1">
            <column table="a" column="pwrc_id" />
            <useparam name="pwrc_id" />
          </call>
        </call>
      </where>
    </query>
    <query name="45862_kg_name_list" class="1" timestamp="12.04.2020 01:11:13">
      <params>
        <param name="pwrc_id" type="array">
          <const>8871</const>
        </param>
        <param type="number" name="ym">
          <const>2018.07</const>
        </param>
      </params>
      <select>
        <column table="a" column="k_kg_name" key="1" group="1" />
        <column table="a" column="pwrc_fdrname" group="stragg_dist" />
        <column table="a" column="pwrc_fdr_balname" type="string" title="Бал.принадл" group="stragg_dist" />
        <column table="a" column="pwrc_fdr_explname" type="string" title="Экспл.отв" group="stragg_dist" />
        <column table="pwrc_dub" column="pwrcname" type="string" title="Наименование ПС" group="stragg_dist" />
        <column table="a" column="pr_cycle_name" type="string" group="stragg_dist" />
      </select>
      <from>
        <query name="45862_fdr_kg_list" as="a">
          <withparams>
            <useparam name="pwrc_id" />
            <useparam name="ym" />
          </withparams>
        </query>
        <query name="45862_fdr_kg_list" as="pwrc_dub" join="left outer">
          <withparams>
            <useparam name="pwrc_id" />
            <useparam name="ym" />
          </withparams>
          <call function="and">
            <call function="=" as="" type="">
              <column table="a" column="k_kg_name" />
              <column table="pwrc_dub" column="k_kg_name" />
            </call>
            <call function="true" />
            <call function="not" exclude="1">
              <call function="and">
                <call function="=">
                  <call function="nvl">
                    <column table="pwrc_dub" column="fdr_in_auto_kg" />
                    <const>-1</const>
                  </call>
                  <const>1</const>
                </call>
                <call function="=">
                  <call function="nvl">
                    <column table="pwrc_dub" column="is_auto_kg_real" />
                    <const>-1</const>
                  </call>
                  <const>0</const>
                </call>
              </call>
            </call>
          </call>
        </query>
        <query name="45862_kol_gr_type" join="left outer" as="kol_gr_type">
          <call function="=">
            <call function="||">
              <column table="kol_gr_type" column="kod_kol_gr" />
              <const>'-'</const>
            </call>
            <column table="a" column="k_kg_name" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="!=0">
            <column table="a" column="cnt_fdr_in_kg" />
          </call>
          <call function="or">
            <call function="=1">
              <column table="kol_gr_type" column="all_fdr_have_tp" />
            </call>
            <call function="not">
              <call function="and">
                <call function="=">
                  <call function="nvl">
                    <column table="a" column="fdr_in_auto_kg" />
                    <const>-1</const>
                  </call>
                  <const>1</const>
                </call>
                <call function="=">
                  <call function="nvl">
                    <column table="a" column="is_auto_kg_real" />
                    <const>-1</const>
                  </call>
                  <const>0</const>
                </call>
              </call>
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="45862_fdr_by_kn_name_list" class="1" timestamp="26.12.2018 14:43:15">
      <params>
        <param name="pwrc_id" type="array" />
        <param name="k_kg_name" type="array" />
        <param name="ym" type="number" />
      </params>
      <select>
        <column table="a" column="pwrc_fdrid" group="1" />
      </select>
      <from>
        <query name="45862_fdr_kg_list" as="a">
          <withparams>
            <useparam name="pwrc_id" />
            <useparam name="ym" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="or">
          <call function="false" />
          <call function="in" optional="1">
            <column table="a" column="k_kg_name" />
            <useparam name="k_kg_name" />
          </call>
        </call>
      </where>
    </query>
    <query name="45862_kg_name_default" class="1" timestamp="11.09.2019 16:27:11">
      <params>
        <param name="kod_fl" type="number" />
        <param name="pwrc_id" type="array" />
        <param name="ym" type="number" />
      </params>
      <select>
        <call function="||" as="k_kg_name" group="1">
          <call function="nvl">
            <column column="kod_kol_gr" table="kod_kol_gr" />
            <call function="||">
              <const>'-'</const>
              <column table="a" column="pwrc_fdrid" />
            </call>
          </call>
          <const>'-'</const>
        </call>
        <call title="дисп.номер" as="kg_name" function="nvl" group="1">
          <column table="kod_kol_gr" column="name" />
          <column table="a" column="pwrc_fdrname" />
        </call>
      </select>
      <from>
        <query as="a" name="hv_eopwrc_fdrs" />
        <query name="45862_nastr_by_ym" join="left outer" as="kod_kol_gr">
          <withparams>
            <useparam name="ym" />
          </withparams>
          <call function="=">
            <column table="a" column="pwrc_fdrid" />
            <column table="kod_kol_gr" column="pwrc_fdrid" />
          </call>
        </query>
      </from>
      <where>
        <call function="or">
          <call function="false" />
          <call function="and" optional="1">
            <call function="in">
              <column table="a" column="pwrc_fdr_bal_id" />
              <useparam name="kod_fl" />
            </call>
            <call function="in">
              <column table="a" column="pwrc_id" />
              <useparam name="pwrc_id" />
            </call>
            <call function="not">
              <call function="and">
                <call function="=">
                  <call function="nvl">
                    <column table="kod_kol_gr" column="fdr_in_auto_kg" />
                    <const>-1</const>
                  </call>
                  <const>1</const>
                </call>
                <call function="=">
                  <call function="nvl">
                    <column table="kod_kol_gr" column="is_auto_kg_real" />
                    <const>-1</const>
                  </call>
                  <const>0</const>
                </call>
              </call>
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="d45862_grid_dtl_kg" class="1" timestamp="21.06.2019 16:46:23">
      <select>
        <call as="grid_dtl_kg" function="||-" key="1">
          <column table="a" column="src_fdrid" />
          <column table="this" column="ym" />
        </call>
        <column table="a" column="src_fdrid" type="number" column-mandatory="1" title="" />
        <column table="a" column="pwrc_fdrid" type="number" column-mandatory="1" title="" />
        <column table="a" column="pwrc_fdrname" type="string" column-mandatory="1" title="" />
        <column table="a" column="src_id" type="number" column-mandatory="1" title="" />
        <column table="a" column="srcname" type="string" title="" />
        <column table="a" column="src_fdrname" type="string" column-mandatory="1" title="" />
        <column table="a" column="pwrc_id" type="number" column-mandatory="1" title="" is-fact="1" agg="max" fact="f45862_grid_dtl_kg_pwrc_id" />
        <column table="a" column="pwrcname" type="string" title="" />
        <column table="a" column="srckodp_fsk" type="number" column-mandatory="1" title="" />
        <column table="a" column="hv_eopwrc_grid_id" type="string" title="" />
        <column table="a" column="src_fdrord" type="number" />
        <column table="k_f_tp" column="id" is-private-dimension="k_gr_f_tp" is-final-dimension="k_gr_f_tp" dimension="k_gr_f_tp" />
        <column table="k_f_tp" column="ym" is-private-dimension="ym" is-final-dimension="ym" dimension="ym" />
      </select>
      <from>
        <query name="hv_eopwrc_grid_dtl" as="a" />
        <query name="d45862_fdr_kg" as="k_f_tp" join="left outer">
          <call function="=">
            <column table="this" column="hv_eopwrc_grid_id" />
            <column table="k_f_tp" column="k_f_tp" />
          </call>
        </query>
      </from>
      <links>
        <link name="k_f_tp">
          <dimlink name="kg_name" is-private-dimension="1" is-final-dimension="1" dimension="1" />
          <dimlink name="pwrc_id" is-private-dimension="1" is-final-dimension="1" dimension="1" />
          <dimlink name="kod_fl" is-private-dimension="1" is-final-dimension="1" dimension="1" />
        </link>
      </links>
    </query>
    <query name="45862_tp_list" class="1" timestamp="07.12.2018 13:24:25" title="ТП, РП, КК" order="pwrcname, pwrc_fdrname, srcname">
      <params>
        <param name="pwrc_fdrid" type="array" />
      </params>
      <select>
        <column table="a" column="src_id" column-mandatory="1" title="" group="1" />
        <column table="a" column="srcname" group="max" />
        <column table="a" column="src_balnamex" group="max" />
        <call as="fdrname" title="Фидер" type="string" function="||" group="max">
          <column table="a" column="pwrc_fdrname" />
          <const>', '</const>
          <column table="a" column="pwrcname" />
        </call>
        <column table="a" column="pwrc_fdrname" type="string" group="max" />
        <column table="a" column="pwrcname" type="string" group="max" />
      </select>
      <from>
        <query name="hv_eopwrc_grid_dtl_src_fdr_list" as="a">
          <withparams>
            <useparam name="pwrc_fdrid" />
          </withparams>
        </query>
        <query name="vb_kol_gr_fdr" as="kod_kol_gr_fdr" join="left outer">
          <call function="=">
            <column table="a" column="pwrc_fdrid" />
            <column table="kod_kol_gr_fdr" column="pwrc_fdrid" />
          </call>
          <link name="tpsel" />
        </query>
        <query name="vb_kol_gr_tp" as="kod_kol_gr_tp" join="left outer">
          <call function="and">
            <call function="=">
              <column table="a" column="src_id" />
              <column table="kod_kol_gr_tp" column="src_id" />
            </call>
            <call function="=">
              <column table="kod_kol_gr_fdr" column="kod_kol_gr_fdr" />
              <column table="kod_kol_gr_tp" column="kod_kol_gr_fdr" />
            </call>
          </call>
        </query>
      </from>
      <where>
        <call function="or">
          <call function="is null">
            <column table="tpsel" column="kod_kol_gr_fdr" />
          </call>
          <call function="is not null">
            <column table="kod_kol_gr_tp" column="kod_kol_gr_tp" />
          </call>
          <call function="and" exclude="1">
            <call function="is not null">
              <column table="tpsel" column="kod_kol_gr_fdr" />
            </call>
            <call function="is not null">
              <column table="kod_kol_gr_tp" column="kod_kol_gr_tp" />
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="45862-detail_otp_test" timestamp="11.08.2020 12:27:28" is-report="1" title="Детализация отчета пофидер. анализ по ПС фил. ОТПУСК" visible="0">
      <params>
        <param name="ym" type="number" part-id="45862-detail_otp_test_param" />
        <param name="kod_fl" type="number" part-id="45862-detail_otp_test_param" />
        <param name="pwrc_id" type="array" part-id="45862-detail_otp_test_param" />
        <param name="k_kg_name" type="array" part-id="45862-detail_otp_test_param" />
        <param name="pwrc_fdrid" type="array" part-id="45862-detail_otp_test_param" />
        <param type="array" part-id="45862-detail_otp_test_param" name="src_id" />
      </params>
      <select>
        <call as="id" function="||-" part-id="45862-detail_otp_test_select" key="1">
          <column table="rep_blns_pwrc_fdrs" column="k_gr_f_tp" />
          <column table="rep_blns_pwrc_fdrs" column="kod_rpoint" />
          <column table="rep_blns_pwrc_fdrs" column="cnt_num" />
          <column table="rep_blns_pwrc_fdrs" column="src_fdrid" />
          <column table="rep_blns_pwrc_fdrs" column="dog_num" />
        </call>
        <column table="rep_blns_pwrc_fdrs" column="k_gr_f_tp" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="hv_eopwrc_grid_id" part-id="45862-detail_otp_test_select" type="string" />
        <column table="rep_blns_pwrc_fdrs" column="kod_rpoint" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="kod_outeris" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="pwrc_id" exclude="1" />
        <call function="nvl" part-id="45862-detail_otp_test_select" as="pwrc_id">
          <column table="kol_gr_pwrc" column="pwrc_id" />
          <column table="rep_blns_pwrc_fdrs" column="pwrc_id" />
        </call>
        <column table="rep_blns_pwrc_fdrs" column="pwrcname" title="ДИСП №ПС" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="pwrc_fdrid" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="pwrc_fdrname" title="ДИСП №ФИД" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="src_id" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="srcname" title="ДИСП №ТП,РП,КК" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="tpoint" title="ВИД ТУ" part-id="45862-detail_otp_test_select" />
        <call function="to_char" title="№ТУ" as="pnum" comment="чтобы не выводились итоги в футере" part-id="45862-detail_otp_test_select">
          <column table="rep_blns_pwrc_fdrs" column="pnum" />
        </call>
        <column table="rep_blns_pwrc_fdrs" column="pname" title="НАИМЕН. ТУ" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="place_namefider" title="ОБОРУД" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="cnt_num" title="№ ПУ" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="readvals" title="ПОКАЗАНИЯ" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="cnt_rkoef" title="РАСЧ.КОЭФ" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="out1" title="РАСХ. ПО СЧ., кВт*ч (А+)" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="cust1" title="КОЛИЧ. ЭЭ. кВт*ч (А+)" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="out2" title="РАСХ. ПО СЧ., кВт*ч (А-)" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="cust2" title="КОЛИЧ. ЭЭ. кВт*ч (А-)" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="wp_in" title="ОТПУСК ПО ФИДЕРУ, кВт*ч" format="N2" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="wp_out" title="ПОТРЕБЛ. ПО ФИДЕРУ, кВт*ч" format="N2" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="name_es" title="ЭСК" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="name_fsk" title="ЗОНА ФИЛИАЛА ЛЭ" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="name_rsk" title="РЭС" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="dog_num" title="№ ДОГОВОРА ЭНЕРГ" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="user_name" title="ПОТРЕБИТЕЛЬ" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="eobj_num" title="№ ОБЪЕКТА" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="eobj_name" title="НАИМЕН. ОБЪЕКТА" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="r_pwrlev" title="УН" part-id="45862-detail_otp_test_select" />
        <call function="to_char" title="НАПРЯЖ, кВ" as="pwr_lev" comment="чтобы не выводились итоги в футере" part-id="45862-detail_otp_test_select">
          <column table="rep_blns_pwrc_fdrs" column="pwr_lev" />
        </call>
        <column table="rep_blns_pwrc_fdrs" column="eobj_adress" title="АДРЕС ОБЪЕКТА ПОТРЕБИТЕЛЯ" part-id="45862-detail_otp_test_select" />
        <call function="to_char" title="№ ГРУППЫ ДАННЫХ" as="gr" comment="чтобы не выводились итоги в футере" part-id="45862-detail_otp_test_select">
          <column table="rep_blns_pwrc_fdrs" column="gr" />
        </call>
        <call function="to_char" title="ОТЧ.ПЕРИОД" comment="чтобы не выводились итоги в футере" as="ym" part-id="45862-detail_otp_test_select">
          <column table="rep_blns_pwrc_fdrs" column="ym" />
        </call>
        <column table="rep_blns_pwrc_fdrs" column="src_fdrid" part-id="45862-detail_otp_test_select" />
        <column table="rep_blns_pwrc_fdrs" column="kg_name" part-id="45862-detail_otp_test_select" title=" " />
        <column table="rep_blns_pwrc_fdrs" column="k_kg_name" part-id="45862-detail_otp_test_select" title=" " />
        <column table="rep_blns_pwrc_fdrs" column="pnt_fdr" part-id="45862-detail_otp_test_select" title=" " />
        <column table="rep_blns_pwrc_fdrs" column="pnt_grid" part-id="45862-detail_otp_test_select" title=" " />
      </select>
      <from>
        <qube star-scheme="1" part-id="45862-detail_otp_test_qube">
          <link name="rep_blns_pwrc_fdrs_test" part-id="45862-detail_otp_test_qube" as="rep_blns_pwrc_fdrs" all-rows="1" />
          <dimset as="all" part-id="45862-detail_otp_test_qube">
            <link name="k_gr_f_tp" part-id="45862-detail_otp_test_qube" />
            <link name="kg_name" part-id="45862-detail_otp_test_qube" />
            <link name="grid_dtl_kg" part-id="45862-detail_otp_test_qube" />
          </dimset>
          <link name="kod_fl" part-id="45862-detail_otp_test_qube" />
          <link name="pwrc_id" part-id="45862-detail_otp_test_qube" />
        </qube>
        <query join="left outer" name="45862_kol_gr_src_pwrc" as="kol_gr_pwrc" part-id="45862-detail_otp_test_qube">
          <call function="and" part-id="45862-detail_otp_test_qube">
            <call function="=" part-id="45862-detail_otp_test_qube">
              <column table="rep_blns_pwrc_fdrs" column="src_id" part-id="45862-detail_otp_test_qube" />
              <column table="kol_gr_pwrc" column="src_id" part-id="45862-detail_otp_test_qube" />
            </call>
            <call function="=" part-id="45862-detail_otp_test_qube">
              <column table="rep_blns_pwrc_fdrs" column="k_kg_name" part-id="45862-detail_otp_test_qube" />
              <call function="||" part-id="45862-detail_otp_test_qube">
                <column table="kol_gr_pwrc" column="kod_kol_gr" part-id="45862-detail_otp_test_qube" />
                <const part-id="45862-detail_otp_test_qube">'-'</const>
              </call>
            </call>
          </call>
        </query>
      </from>
    </query>
    <query name="45862-detail_potreb_test" timestamp="11.08.2020 12:28:18" is-report="1" title="Детализация отчета пофидер. анализ по ПС фил. ПОТРЕБЛЕНИЕ" visible="0">
      <params>
        <usepart part="45862-detail_otp_test_param" />
      </params>
      <select>
        <usepart part="45862-detail_otp_test_select" />
      </select>
      <from>
        <usepart part="45862-detail_otp_test_qube" />
      </from>
    </query>
    <query name="45862_test_det_mat" timestamp="23.12.2018 20:52:53" is-report="1" title="Отчет пофидерный анализ по ПС филиалов" mode="excel" can-use-simple-params="1" visible="0">
      <procedure>
        <text>
          BEGIN
jg_reports_ise.set_kodp_fsk(1105);
	 jg_reports_ise.jr_rep_blns_pwrc_vols_init(2018.07);
          END;
        </text>
      </procedure>
      <print-templates>
        <excel>
          <template name="45862_test_det_mat.xlsx" title="Отчет пофидерный анализ по ПС филиалов" print-proc="2" print-xlsx="1" />
        </excel>
      </print-templates>
      <events>
        <useaction event-name="double-click" action-type="open-column-grouping-detail" call="45862-detail_otp_test_det_mat" column="wp_in">
          <const>1105</const>
          <const exclude="1">8871</const>
          <const exclude="1">8873</const>
        </useaction>
      </events>
      <select>
        <column table="kod_fl" column="kod_fl" />
        <column table="pwrc_id_test_det_mat" column="pwrc_id" />
        <column table="pwrc_id_test_det_mat" column="pwrcname" group="max" />
        <fact column="jr_rep_test_det_mat_wp_in" group="sum" as="wp_in" type="number" />
      </select>
      <from>
        <qube star-scheme="1">
          <link name="kod_fl" />
          <link name="pwrc_id_test_det_mat" />
          <where exclude="1">
            <call function="and">
              <call function="=">
                <column table="kod_fl" column="kod_fl" />
                <const>1105</const>
              </call>
            </call>
          </where>
        </qube>
      </from>
      <grouping>
        <grset as="all" title="Всего">
          <group>
            <sourcelink table="kod_fl" />
          </group>
          <grset as="ps">
            <group>
              <sourcelink table="pwrc_id_test_det_mat" />
            </group>
          </grset>
        </grset>
      </grouping>
    </query>
    <query name="45862-detail_otp_test_det_mat" timestamp="23.12.2018 21:01:29" is-report="1" title="Детализация отчета пофидер. анализ по ПС фил. ОТПУСК" visible="0">
      <params exclude="1">
        <param name="kod_fl" type="number" />
      </params>
      <select>
        <call function="||-" key="1" as="idr">
          <column table="rep_blns_pwrc_fdrs" column="bal_id" />
          <column table="rep_blns_pwrc_fdrs" column="pwrc_id" />
          <column table="rep_blns_pwrc_fdrs" column="pwrc_fdrid" />
          <column table="rep_blns_pwrc_fdrs" column="src_id" />
          <column table="rep_blns_pwrc_fdrs" column="kod_rpoint" />
        </call>
        <column table="rep_blns_pwrc_fdrs" column="kod_rpoint" />
        <column table="rep_blns_pwrc_fdrs" column="kod_outeris" />
        <column table="rep_blns_pwrc_fdrs" column="pwrc_id" />
        <column table="rep_blns_pwrc_fdrs" column="pwrcname" title="ДИСП №ПС" />
        <column table="rep_blns_pwrc_fdrs" column="pwrc_fdrid" />
        <column table="rep_blns_pwrc_fdrs" column="pwrc_fdrname" title="ДИСП №ФИД" />
        <column table="rep_blns_pwrc_fdrs" column="src_id" />
        <column table="rep_blns_pwrc_fdrs" column="srcname" title="ДИСП №ТП,РП,КК" />
        <column table="rep_blns_pwrc_fdrs" column="tpoint" title="ВИД ТУ" />
        <call function="to_char" title="№ТУ" as="pnum" comment="чтобы не выводились итоги в футере">
          <column table="rep_blns_pwrc_fdrs" column="pnum" />
        </call>
        <column table="rep_blns_pwrc_fdrs" column="pname" title="НАИМЕН. ТУ" />
        <column table="rep_blns_pwrc_fdrs" column="place_namefider" title="ОБОРУД" />
        <column table="rep_blns_pwrc_fdrs" column="cnt_num" title="№ ПУ" />
        <column table="rep_blns_pwrc_fdrs" column="readvals" title="ПОКАЗАНИЯ" />
        <column table="rep_blns_pwrc_fdrs" column="cnt_rkoef" title="РАСЧ.КОЭФ" />
        <column table="rep_blns_pwrc_fdrs" column="out1" title="РАСХ. ПО СЧ., кВт*ч (А+)" />
        <column table="rep_blns_pwrc_fdrs" column="cust1" title="КОЛИЧ. ЭЭ. кВт*ч (А+)" />
        <column table="rep_blns_pwrc_fdrs" column="out2" title="РАСХ. ПО СЧ., кВт*ч (А-)" />
        <column table="rep_blns_pwrc_fdrs" column="cust2" title="КОЛИЧ. ЭЭ. кВт*ч (А-)" />
        <column table="rep_blns_pwrc_fdrs" column="wp_in" title="ОТПУСК ПО ФИДЕРУ, кВт*ч" format="N2" />
        <column table="rep_blns_pwrc_fdrs" column="wp_out" title="ПОТРЕБЛ. ПО ФИДЕРУ, кВт*ч" format="N2" />
        <column table="rep_blns_pwrc_fdrs" column="name_es" title="ЭСК" />
        <column table="rep_blns_pwrc_fdrs" column="name_fsk" title="ЗОНА ФИЛИАЛА ЛЭ" />
        <column table="rep_blns_pwrc_fdrs" column="name_rsk" title="РЭС" />
        <column table="rep_blns_pwrc_fdrs" column="dog_num" title="№ ДОГОВОРА ЭНЕРГ" />
        <column table="rep_blns_pwrc_fdrs" column="user_name" title="ПОТРЕБИТЕЛЬ" />
        <column table="rep_blns_pwrc_fdrs" column="eobj_num" title="№ ОБЪЕКТА" />
        <column table="rep_blns_pwrc_fdrs" column="eobj_name" title="НАИМЕН. ОБЪЕКТА" />
        <column table="rep_blns_pwrc_fdrs" column="r_pwrlev" title="УН" />
        <call function="to_char" title="НАПРЯЖ, кВ" as="pwr_lev" comment="чтобы не выводились итоги в футере">
          <column table="rep_blns_pwrc_fdrs" column="pwr_lev" />
        </call>
        <column table="rep_blns_pwrc_fdrs" column="eobj_adress" title="АДРЕС ОБЪЕКТА ПОТРЕБИТЕЛЯ" />
        <call function="to_char" title="№ ГРУППЫ ДАННЫХ" as="gr" comment="чтобы не выводились итоги в футере">
          <column table="rep_blns_pwrc_fdrs" column="gr" />
        </call>
        <call function="to_char" title="ОТЧ.ПЕРИОД" comment="чтобы не выводились итоги в футере" as="ym">
          <column table="rep_blns_pwrc_fdrs" column="ym" />
        </call>
        <column table="rep_blns_pwrc_fdrs" column="src_fdrid" />
        <column table="pwrc_id_test_det_mat" column="hv_eopwrc_id" />
        <column table="rep_blns_pwrc_fdrs" column="bal_id" as="kod_fl" />
      </select>
      <from>
        <qube star-scheme="1">
          <link name="kod_fl" />
          <link name="pwrc_id_test_det_mat" />
          <link all-rows="1" name="rep_blns_test_det_mat" as="rep_blns_pwrc_fdrs" />
        </qube>
      </from>
    </query>
    <query name="45862_nastr_by_ym" class="1" timestamp="11.09.2019 12:22:26">
      <params>
        <param name="ym" type="number">
          <const>2018.07</const>
        </param>
      </params>
      <select>
        <column table="a" column="kod_kol_gr_fdr" />
        <column table="a" column="pwrc_fdrid" />
        <column table="kod_kol_gr" column="kod_kol_gr" />
        <column table="kod_kol_gr" column="name" exclude="1" />
        <call as="name" function="||">
          <column table="kod_kol_gr" column="name" />
          <call function="if">
            <call function="is not null">
              <column table="kod_kol_gr" column="kol_gr_comment" />
            </call>
            <call function="||">
              <const>' ['</const>
              <column table="kod_kol_gr" column="kol_gr_comment" />
              <const>']'</const>
            </call>
          </call>
        </call>
        <column table="kod_kol_gr_nastr" column="is_auto_kg_real" />
        <call function="over" as="fdr_in_auto_kg">
          <call function="max">
            <column table="this" column="is_auto_kg_real" />
          </call>
          <call function="partition by">
            <column table="a" column="pwrc_fdrid" />
          </call>
        </call>
      </select>
      <from>
        <query name="vb_kol_gr_fdr" as="a">
          <link name="kod_kol_gr_pwrc">
            <link name="kod_kol_gr_nastr">
              <link name="kod_kol_gr" />
              <link name="ym" />
            </link>
          </link>
        </query>
      </from>
      <where>
        <call function="or">
          <call function="false" />
          <call function="=" optional="1">
            <column table="ym" column="ym" />
            <useparam name="ym" />
          </call>
        </call>
      </where>
    </query>
    <query name="d45862_fdr_kg" class="1" timestamp="14.01.2020 18:37:36">
      <select>
        <column table="a" column="id" />
        <column table="a" column="k_gr_f_tp" />
        <column table="a" column="k_f_tp" />
        <column table="a" column="k_kg_name" exclude="1" />
        <column table="a" column="k_kg_name" is-private-dimension="kg_name" is-final-dimension="kg_name" dimension="kg_name" />
        <column table="a" column="pwrc_id" is-fact="1" agg="max" fact="f45862_fdr_kg_pwrc_id" />
        <column table="a" column="kg_name" is-private-dimension="kg_name" is-final-dimension="kg_name" dimension="kg_name" exclude="1" />
        <column table="a" column="kg_name" />
        <column table="a" column="kod_kol_gr" />
        <column table="a" column="pwrc_fdrid" />
        <column table="a" column="real_fdr" />
        <column table="a" column="isprm_fdr" />
        <column table="a" column="pwrc_fdr_explname" />
        <column table="a" column="src_id" />
        <column table="a" column="srcname" />
        <column table="a" column="srcbalname" />
        <column table="a" column="ym" />
        <column table="a" column="exclude_auto_fdr" />
        <column table="k_pwrc_fdr" column="pwrc_id" as="m2m_pwrc_id" />
        <call function="nvl0" as="per_kg_s" exclude="1">
          <column table="kod_kol_gr" column="s" as="per_kg_s" />
        </call>
      </select>
      <from>
        <query name="sqlb_d45862_fdr_kg_tbl" as="a" />
        <query name="vb_kol_gr_nastr" join="left outer" as="kod_kol_gr" exclude="1">
          <call function="=">
            <column table="a" column="kod_kol_gr" />
            <column table="kod_kol_gr" column="kod_kol_gr" />
          </call>
        </query>
        <query name="45862_m2m_pwrc_fdr" as="k_pwrc_fdr" join="left outer">
          <call function="and">
            <call function="=">
              <column table="a" column="k_gr_f_tp" />
              <column table="k_pwrc_fdr" column="k_gr_f_tp" />
            </call>
            <call function="=">
              <column table="a" column="ym" />
              <column table="k_pwrc_fdr" column="ym" />
              <call function="replace" exclude="1">
                <column table="k_pwrc_fdr" column="ym" />
                <const>9999.99</const>
                <column table="this" column="ym" />
              </call>
            </call>
          </call>
        </query>
        <query name="hv_eopwrc_g" as="pwrc_id" join="left outer">
          <call function="=">
            <column table="this" column="m2m_pwrc_id" />
            <column table="pwrc_id" column="pwrc_id" />
          </call>
        </query>
        <query as="pwrc_id" join="left outer" name="hv_eopwrc_g" exclude="1">
          <call function="=">
            <column column="pwrc_id" table="this" />
            <column column="pwrc_id" table="pwrc_id" />
          </call>
        </query>
      </from>
      <links>
        <link name="pwrc_id" is-private-dimension="1" is-final-dimension="1" dimension="1">
          <dimlink name="kod_fl" is-private-dimension="1" is-final-dimension="1" dimension="1" />
        </link>
      </links>
    </query>
    <query name="45862-yms" timestamp="27.12.2018 18:32:19">
      <select>
        <column table="a" column="ym" type="number" key="1" />
        <column table="a" column="name" type="string" />
      </select>
      <from>
        <table name="45862-yms" as="a" view="1" />
      </from>
    </query>
    <query name="45862_kg_name_default_test2" class="1" timestamp="11.09.2019 16:48:15">
      <params>
        <param name="kod_fl" type="array">
          <const>1105</const>
        </param>
        <param name="pwrc_id" type="array">
          <const>8871</const>
        </param>
      </params>
      <select>
        <call function="||" as="k_kg_name" group="1">
          <call function="nvl">
            <column column="kod_kol_gr" table="kod_kol_gr" />
            <call function="||">
              <const>'-'</const>
              <column table="a" column="pwrc_fdrid" />
            </call>
          </call>
          <const>'-'</const>
        </call>
        <call title="дисп.номер" as="kg_name" function="nvl" group="1">
          <column table="kod_kol_gr" column="name" />
          <column table="a" column="pwrc_fdrname" />
        </call>
      </select>
      <from>
        <query as="a" name="hv_eopwrc_fdrs" />
        <query name="45862_nastr_by_ym_test2" join="left outer" as="kod_kol_gr">
          <call function="=">
            <column table="a" column="pwrc_fdrid" />
            <column table="kod_kol_gr" column="pwrc_fdrid" />
          </call>
        </query>
        <query name="vb_rb_default_fdr" as="def_fdr" join="left outer">
          <link name="kod_fl" />
          <call function="=">
            <column table="a" column="pwrc_fdrid" />
            <column table="def_fdr" column="pwrc_fdrid" />
          </call>
        </query>
      </from>
      <where>
        <call function="or">
          <call function="false" />
          <call function="and" optional="1">
            <call function="in">
              <column table="kod_fl" column="kod_fl" />
              <useparam name="kod_fl" />
            </call>
            <call function="in">
              <column table="a" column="pwrc_id" />
              <useparam name="pwrc_id" />
            </call>
            <call function="is not null">
              <column table="def_fdr" column="kod_id" />
            </call>
            <call function="not">
              <call function="and">
                <call function="=">
                  <call function="nvl">
                    <column table="kod_kol_gr" column="fdr_in_auto_kg" />
                    <const>-1</const>
                  </call>
                  <const>1</const>
                </call>
                <call function="=">
                  <call function="nvl">
                    <column table="kod_kol_gr" column="is_auto_kg_real" />
                    <const>-1</const>
                  </call>
                  <const>0</const>
                </call>
              </call>
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="45862_nastr_by_ym_test2" class="1" timestamp="04.10.2022 14:39:04">
      <select>
        <column table="a" column="kod_kol_gr_fdr" />
        <column table="a" column="pwrc_fdrid" />
        <column table="kod_kol_gr" column="kod_kol_gr" />
        <column table="kod_kol_gr" column="name" exclude="1" />
        <call as="name" function="||">
          <column table="kod_kol_gr" column="name" />
          <call function="if">
            <call function="is not null">
              <column table="kod_kol_gr" column="kol_gr_comment" />
            </call>
            <call function="||">
              <const>' ['</const>
              <column table="kod_kol_gr" column="kol_gr_comment" />
              <const>']'</const>
            </call>
          </call>
        </call>
        <column table="kod_kol_gr_nastr" column="is_auto_kg_real" />
        <call function="over" as="fdr_in_auto_kg" exclude="1">
          <call function="max">
            <column table="this" column="is_auto_kg_real" />
          </call>
          <call function="partition by">
            <column table="a" column="pwrc_fdrid" />
          </call>
        </call>
        <call function="()" as="fdr_in_auto_kg" type="number">
          <query>
            <select>
              <call function="max">
                <column table="sq_nastr" column="is_auto_kg_real" />
              </call>
            </select>
            <from>
              <query name="vb_kol_gr_fdr" as="sq_fdr">
                <link name="kod_kol_gr_nastr" as="sq_nastr" />
              </query>
            </from>
            <where>
              <call function="and">
                <call function="le">
                  <call function="nvl">
                    <column table="sq_nastr" column="s" />
                    <const type="number">0001.01</const>
                  </call>
                  <call function="nvl">
                    <column table="kod_kol_gr_nastr" column="po" />
                    <const type="number">9999.12</const>
                  </call>
                </call>
                <call function="ge">
                  <call function="nvl">
                    <column table="sq_nastr" column="po" />
                    <const type="number">9999.12</const>
                  </call>
                  <call function="nvl">
                    <column table="kod_kol_gr_nastr" column="s" />
                    <const type="number">0001.01</const>
                  </call>
                </call>
                <call function="=">
                  <column table="sq_fdr" column="pwrc_fdrid" />
                  <column table="a" column="pwrc_fdrid" />
                </call>
              </call>
            </where>
          </query>
        </call>
      </select>
      <from>
        <query name="vb_kol_gr_fdr" as="a">
          <link name="kod_kol_gr_pwrc">
            <link name="kod_kol_gr_nastr">
              <link name="kod_kol_gr" />
            </link>
            <link name="rb_pwrc">
              <link name="kod_fl_real" />
              <elink name="hv_eopwrc" exclude="1">
                <link name="kod_fl_real" />
              </elink>
            </link>
          </link>
        </query>
      </from>
      <where>
        <call function="between">
          <column table="kod_fl_real" column="ym" />
          <column table="kod_kol_gr_nastr" column="s" />
          <call function="nvl">
            <column table="kod_kol_gr_nastr" column="po" />
            <call function="date to ym">
              <call function="sysdate" />
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="45862_fdr_kg_list_test2" class="1" timestamp="01.04.2022 12:58:50">
      <params>
        <param name="pwrc_id" type="array">
          <const>13831</const>
        </param>
      </params>
      <select>
        <call function="||-" key="1" as="pk">
          <column table="kod_kol_gr" column="kod_kol_gr" />
          <column table="a" column="pwrc_fdrid" />
        </call>
        <call function="||" as="k_kg_name">
          <call function="nvl">
            <call function="to_char">
              <column column="kod_kol_gr" table="kod_kol_gr" />
            </call>
            <call function="||">
              <const>'-'</const>
              <column table="a" column="pwrc_fdrid" />
            </call>
          </call>
          <const>'-'</const>
        </call>
        <call as="pwrc_fdrname" function="nvl" title="дисп.номер">
          <column table="kod_kol_gr" column="name" />
          <column table="a" column="pwrc_fdrname" />
        </call>
        <column table="a" column="pwrc_fdr_balname" type="string" title="Бал.принадл" />
        <column table="a" column="pwrc_fdr_bal_id" />
        <column table="a" column="pwrc_fdr_explname" type="string" title="Экспл.отв" />
        <column table="a" column="pwrc_id" type="number" column-mandatory="1" />
        <column table="a" column="pwrc_fdrid" type="number" column-mandatory="1" />
        <column table="a" column="pwrcname" type="string" title="Наименование ПС" />
        <column table="a" column="pr_cycle" type="number" />
        <call function="case" as="pr_cycle_name" title="пр. Закольцован" type="string">
          <call function="when">
            <call function="=">
              <column table="a" column="pr_cycle" />
              <const>1</const>
            </call>
            <const>'Да'</const>
          </call>
          <call function="when">
            <call function="=">
              <column table="a" column="pr_cycle" />
              <const>0</const>
            </call>
            <const>'Нет'</const>
          </call>
        </call>
        <column table="kod_kol_gr" column="kod_kol_gr" />
        <column table="a" column="pwrc_fdrname" as="pwrc_fdrname_def" />
        <column table="kod_kol_gr" column="fdr_in_auto_kg" />
        <column table="kod_kol_gr" column="is_auto_kg_real" />
        <call as="cnt_fdr_in_kg" function="over">
          <call function="count">
            <call function="if">
              <call function="in">
                <column table="a" column="pwrc_id" />
                <useparam name="pwrc_id" />
              </call>
              <column table="a" column="pwrc_fdrid" />
            </call>
          </call>
          <call function="partition by">
            <column table="kod_kol_gr" column="kod_kol_gr" />
          </call>
        </call>
      </select>
      <from>
        <query name="vr_rb_fider" as="a" />
        <query name="45862_nastr_by_ym_test2" join="left outer" as="kod_kol_gr">
          <call function="=">
            <column table="a" column="pwrc_fdrid" />
            <column table="kod_kol_gr" column="pwrc_fdrid" />
          </call>
        </query>
        <query name="45862_gr_by_pwrc_list" as="b" join="left outer">
          <withparams>
            <useparam name="pwrc_id" />
          </withparams>
          <call function="=">
            <column table="this" column="kod_kol_gr" />
            <column table="b" column="kod_kol_gr" />
          </call>
        </query>
        <query name="vb_rb_default_fdr" as="def_fdr" join="left outer">
          <link name="kod_fl" />
          <call function="=">
            <column table="a" column="pwrc_fdrid" />
            <column table="def_fdr" column="pwrc_fdrid" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="or">
            <call function="false" />
            <call function="in" optional="1">
              <column table="a" column="pwrc_id" />
              <useparam name="pwrc_id" />
            </call>
            <call function="is not null">
              <column table="b" column="kod_kol_gr" />
            </call>
          </call>
          <call function="not">
            <call function="and">
              <call function="=">
                <call function="nvl">
                  <column table="kod_kol_gr" column="fdr_in_auto_kg" />
                  <const>-1</const>
                </call>
                <const>1</const>
              </call>
              <call function="=">
                <call function="nvl">
                  <column table="kod_kol_gr" column="is_auto_kg_real" />
                  <const>-1</const>
                </call>
                <const>0</const>
              </call>
            </call>
          </call>
          <call function="is not null">
            <column table="def_fdr" column="kod_id" />
          </call>
        </call>
      </where>
    </query>
    <query name="45862_kg_name_list_test2" class="1" timestamp="11.09.2019 16:47:31">
      <params>
        <param name="pwrc_id" type="array">
          <const>8871</const>
        </param>
      </params>
      <select>
        <column table="a" column="k_kg_name" key="1" group="1" />
        <column table="a" column="pwrc_fdrname" group="stragg_dist" />
        <column table="a" column="pwrc_fdr_balname" type="string" title="Бал.принадл" group="stragg_dist" />
        <column table="a" column="pwrc_fdr_explname" type="string" title="Экспл.отв" group="stragg_dist" />
        <column table="pwrc_dub" column="pwrcname" type="string" title="Наименование ПС" group="stragg_dist" />
        <column table="a" column="pr_cycle_name" type="string" group="stragg_dist" />
      </select>
      <from>
        <query name="45862_fdr_kg_list_test2" as="a">
          <withparams>
            <useparam name="pwrc_id" />
          </withparams>
        </query>
        <query name="45862_fdr_kg_list_test2" as="pwrc_dub" join="left outer">
          <withparams>
            <useparam name="pwrc_id" />
          </withparams>
          <call function="=" as="" type="">
            <column table="a" column="k_kg_name" />
            <column table="pwrc_dub" column="k_kg_name" />
          </call>
        </query>
      </from>
      <where>
        <call function="!=0">
          <column table="a" column="cnt_fdr_in_kg" />
        </call>
      </where>
    </query>
    <query name="45862_fdr_by_kn_name_list_test2" class="1" timestamp="28.04.2022 17:23:18">
      <params>
        <param name="pwrc_id" type="array" />
        <param name="k_kg_name" type="array" />
      </params>
      <select>
        <column table="a" column="pwrc_fdrid" group="1" key="1" />
        <column table="a" column="pwrc_fdrname_def" as="pwrc_fdrname" group="1" title="дисп.номер" />
        <column table="a" column="pwrc_fdr_balname" group="1" intern="1" />
        <column table="a" column="pwrc_fdr_explname" group="1" intern="1" />
        <column table="a" column="pwrcname" group="1" intern="1" />
        <column table="a" column="pr_cycle_name" group="1" intern="1" />
      </select>
      <from>
        <query name="45862_fdr_kg_list_test2" as="a">
          <withparams>
            <useparam name="pwrc_id" />
          </withparams>
        </query>
      </from>
      <where>
        <call function="or">
          <call function="false" />
          <call function="in" optional="1">
            <column table="a" column="k_kg_name" />
            <useparam name="k_kg_name" />
          </call>
        </call>
      </where>
    </query>
    <query name="d45862_kg_name" class="1" timestamp="14.01.2020 18:40:53">
      <select>
        <column table="a" column="k_kg_name" group="1" />
        <column table="a" column="kg_name" group="1" />
        <column table="a" column="kg_name_w_real_fdr" group="1" exclude="1" />
        <call function="||" as="kg_name_w_real_fdr" group="1">
          <column table="a" column="kg_name_w_real_fdr" />
          <call function="if">
            <call function="!=">
              <call function="substr">
                <column table="a" column="k_kg_name" />
                <const>1</const>
                <const>1</const>
              </call>
              <const>'-'</const>
            </call>
            <const>' КГ'</const>
          </call>
        </call>
        <call function="nvl0" as="per_kg_s" group="max">
          <column table="kod_kol_gr" column="s" as="per_kg_s" />
        </call>
      </select>
      <from>
        <query name="sqlb_d45862_fdr_kg_tbl" as="a" />
        <query name="vb_kol_gr_nastr" join="left outer" as="kod_kol_gr">
          <call function="=">
            <column table="a" column="kod_kol_gr" />
            <column table="kod_kol_gr" column="kod_kol_gr" />
          </call>
        </query>
      </from>
    </query>
    <query name="45862_tp_list_v2" class="1" timestamp="09.10.2019 13:59:00" title="ТП, РП, КК" order="pwrcname, pwrc_fdrname, srcname">
      <params>
        <param name="k_kg_name" type="array" />
        <param name="pwrc_fdrid" type="array" />
      </params>
      <select>
        <column table="a" column="src_id" column-mandatory="1" title="" group="1" />
        <column table="a" column="srcname" group="max" />
        <column table="a" column="src_balnamex" group="max" />
        <call as="fdrname" title="Фидер" type="string" function="||" group="max">
          <column table="a" column="pwrc_fdrname" />
          <const>', '</const>
          <column table="a" column="pwrcname" />
        </call>
        <column table="a" column="pwrc_fdrname" type="string" group="max" />
        <column table="a" column="pwrcname" type="string" group="max" />
      </select>
      <from>
        <query name="hv_eopwrc_grid_dtl_src_fdr_list" as="a">
          <withparams>
            <useparam name="pwrc_fdrid" />
          </withparams>
        </query>
        <query name="vb_kol_gr_tp" join="left outer">
          <call function="=">
            <column table="a" column="src_id" />
            <column table="vb_kol_gr_tp" column="src_id" />
          </call>
          <link name="kod_kol_gr_fdr">
            <link name="kod_kol_gr_pwrc">
              <link name="kod_kol_gr_nastr" />
            </link>
          </link>
        </query>
        <query name="45862_kol_gr_feaders_all_tp" join="left outer" as="kol_gr_feaders_all_tp">
          <call function="=">
            <column table="a" column="pwrc_fdrid" />
            <column table="kol_gr_feaders_all_tp" column="pwrc_fdrid" />
          </call>
        </query>
      </from>
      <where>
        <call function="or">
          <call function="in">
            <call function="||">
              <const>'-'</const>
              <column table="a" column="pwrc_fdrid" />
              <const>'-'</const>
            </call>
            <useparam name="k_kg_name" />
          </call>
          <call function="in">
            <call function="||">
              <column table="kod_kol_gr_nastr" column="kod_kol_gr" />
              <const>'-'</const>
            </call>
            <useparam name="k_kg_name" />
          </call>
          <call function="in">
            <call function="||">
              <column table="kol_gr_feaders_all_tp" column="kod_kol_gr" />
              <const>'-'</const>
            </call>
            <useparam name="k_kg_name" />
          </call>
        </call>
      </where>
    </query>
    <query name="45862_kol_gr_feaders_all_tp" class="1" timestamp="09.10.2019 14:17:42" title="Фидеры в кольцевых группах, в которых считаются все ТП">
      <select>
        <column table="vb_kol_gr_fdr" column="kod_kol_gr_fdr" />
        <column table="kod_kol_gr_pwrc" column="kod_kol_gr_pwrc" />
        <column table="kod_kol_gr_nastr" column="kod_kol_gr_nastr" />
        <column table="kod_kol_gr_nastr" column="kod_kol_gr" />
        <column table="vb_kol_gr_fdr" column="pwrc_fdrid" />
      </select>
      <from>
        <query name="vb_kol_gr_fdr">
          <link name="kod_kol_gr_pwrc">
            <link name="kod_kol_gr_nastr" />
          </link>
          <elink name="vb_kol_gr_tp" />
        </query>
      </from>
      <where>
        <call function="is null">
          <column table="vb_kol_gr_tp" column="kod_kol_gr_tp" />
        </call>
      </where>
    </query>
    <query name="45862_kol_gr_src_pwrc" class="1" timestamp="10.10.2019 15:33:06" title="Подстанции для ТП в рамках кольцевой группы (временные подстанции)">
      <select>
        <column table="vb_kol_gr_nastr" column="kod_kol_gr" group="1" />
        <column table="root_pwrc" column="pwrc_id" group="1" />
        <column table="child_pwrc_fdr_tp" column="src_id" group="1" />
      </select>
      <from>
        <query name="vb_kol_gr_nastr">
          <elink name="vb_kol_gr_pwrc" as="root_pwrc">
            <elink name="vb_kol_gr_fdr" as="root_pwrc_fdr">
              <elink name="vb_kol_gr_tp" as="root_pwrc_fdr_tp" />
            </elink>
          </elink>
          <elink name="vb_kol_gr_pwrc" as="child_pwrc">
            <elink name="vb_kol_gr_fdr" as="child_pwrc_fdr">
              <elink name="vb_kol_gr_tp" as="child_pwrc_fdr_tp" />
            </elink>
          </elink>
        </query>
        <query join="left outer" name="45862_kol_gr_type" as="kol_gr_type">
          <call function="=">
            <column table="vb_kol_gr_nastr" column="kod_kol_gr" />
            <column table="kol_gr_type" column="kod_kol_gr" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="or">
            <call function="=1">
              <call function="nvl0">
                <column table="vb_kol_gr_nastr" column="is_auto_kg" />
              </call>
            </call>
            <call function="and">
              <call function="is not null">
                <column table="root_pwrc_fdr" column="kod_kol_gr_fdr" />
              </call>
              <call function="is null">
                <column table="root_pwrc_fdr_tp" column="kod_kol_gr_tp" />
              </call>
            </call>
            <call function="=1">
              <column table="kol_gr_type" column="all_fdr_have_tp" />
            </call>
          </call>
          <call function="is not null">
            <column table="child_pwrc_fdr_tp" column="src_id" />
          </call>
        </call>
      </where>
    </query>
    <query name="45862_kol_gr_type" class="1" timestamp="10.10.2019 15:29:53" title="Тип кольцевой группы ">
      <select>
        <column table="vb_kol_gr_nastr" column="kod_kol_gr" group="1" />
        <call function="if" as="all_fdr_have_tp" title="Во всех фидерах добавлены ТП">
          <call function="lt">
            <call function="min">
              <call function="nvl">
                <column table="root_pwrc_fdr_tp" column="kod_kol_gr_tp" />
                <const>-1</const>
              </call>
            </call>
            <const>0</const>
          </call>
          <const>0</const>
          <const>1</const>
        </call>
        <call function="if" as="single_pwrc" title="Все в рамках одной подстанции">
          <call function="=1">
            <call function="count-distinct">
              <column table="root_pwrc" column="kod_kol_gr_pwrc" />
            </call>
          </call>
          <const>1</const>
          <const>0</const>
        </call>
        <call function="if" as="single_fdr_no_tp" title="1 фидер без ТП">
          <call function="=1">
            <call function="-">
              <call function="count">
                <column table="root_pwrc_fdr" column="kod_kol_gr_fdr" />
              </call>
              <call function="count">
                <column table="root_pwrc_fdr_tp" column="kod_kol_gr_tp" />
              </call>
            </call>
          </call>
          <const>1</const>
          <const>0</const>
        </call>
        <call function="if" as="multiple_fdr_no_tp" title="Много фидеров без ТП">
          <call function="gt">
            <call function="-">
              <call function="count">
                <column table="root_pwrc_fdr" column="kod_kol_gr_fdr" />
              </call>
              <call function="count">
                <column table="root_pwrc_fdr_tp" column="kod_kol_gr_tp" />
              </call>
            </call>
            <const>1</const>
          </call>
          <const>1</const>
          <const>0</const>
        </call>
      </select>
      <from>
        <query name="vb_kol_gr_nastr">
          <elink name="vb_kol_gr_pwrc" as="root_pwrc">
            <elink name="vb_kol_gr_fdr" as="root_pwrc_fdr">
              <elink name="vb_kol_gr_tp" as="root_pwrc_fdr_tp" />
            </elink>
          </elink>
        </query>
      </from>
    </query>
    <query name="45862_fdr_kg_missing_tp_single_ym_text" class="1" timestamp="22.11.2019 22:26:22" order="name, pwrcname, pwrc_fdrname, srcname">
      <params>
        <param name="pwrc_id" type="array" />
        <param name="k_kg_name" type="array" />
        <param name="ym" type="number" />
      </params>
      <select>
        <call function="||" group="stragg" as="desc_text">
          <column table="a" column="name" />
          <const>' / '</const>
          <column table="a" column="pwrcname" />
          <const>' / '</const>
          <column table="a" column="pwrc_fdrname" />
          <const>' / '</const>
          <column table="a" column="srcname" />
          <call function="chr">
            <const>13</const>
          </call>
          <call function="chr">
            <const>10</const>
          </call>
        </call>
      </select>
      <from>
        <query name="45862_fdr_kg_missing_tp_single_ym_text_pre" as="a">
          <withparams>
            <useparam name="pwrc_id" />
            <useparam name="k_kg_name" />
            <useparam name="ym" />
          </withparams>
        </query>
      </from>
    </query>
    <query name="45862_fdr_kg_missing_tp_single_ym_text_pre" class="1" timestamp="21.11.2019 21:22:59" order="name, pwrcname, pwrc_fdrname, srcname">
      <params>
        <param name="pwrc_id" type="array" />
        <param name="k_kg_name" type="array" />
        <param name="ym" type="number" />
      </params>
      <select>
        <column table="kod_fl" column="name" group="1" />
        <column table="tp" column="pwrcname" group="1" />
        <column table="tp" column="pwrc_fdrname" group="1" />
        <column table="tp" column="srcname" group="1" />
      </select>
      <from>
        <query name="kg_fdr_missing_tp" as="a" />
        <query name="vb_kol_gr_nastr" as="nastr" join="left outer">
          <call function="and">
            <call function="=">
              <column table="a" column="kod_kol_gr" />
              <column table="nastr" column="kod_kol_gr" />
            </call>
          </call>
          <link name="kod_fl" />
        </query>
        <query name="hv_eopwrc_grid_dtl" as="tp" join="left outer">
          <call function="=">
            <column table="a" column="src_id" />
            <column table="tp" column="src_id" />
          </call>
        </query>
      </from>
      <where>
        <call function="and">
          <call function="=">
            <column table="a" column="ym" />
            <useparam name="ym" />
          </call>
          <call function="or">
            <call function="in">
              <call function="||">
                <column table="a" column="kod_kol_gr" />
                <const>'-'</const>
              </call>
              <useparam name="k_kg_name" />
            </call>
            <call function="in">
              <call function="||">
                <const>'-'</const>
                <column table="a" column="pwrc_fdrid" />
                <const>'-'</const>
              </call>
              <useparam name="k_kg_name" />
            </call>
          </call>
        </call>
      </where>
    </query>
    <query name="45862_fdr_kg_missing_tp_single_ym_flag" class="1" timestamp="22.11.2019 22:28:19">
      <params>
        <param name="pwrc_id" type="array" />
        <param name="k_kg_name" type="array" />
        <param name="ym" type="number" />
      </params>
      <select>
        <column table="a" column="src_id" group="count" />
      </select>
      <from>
        <query name="kg_fdr_missing_tp" as="a" />
      </from>
      <where>
        <call function="and">
          <call function="=">
            <useparam name="ym" />
            <column table="a" column="ym" />
          </call>
          <call function="or">
            <call function="in">
              <call function="||">
                <column table="a" column="kod_kol_gr" />
                <const>'-'</const>
              </call>
              <useparam name="k_kg_name" />
            </call>
            <call function="in">
              <call function="||">
                <const>'-'</const>
                <column table="a" column="pwrc_fdrid" />
                <const>'-'</const>
              </call>
              <useparam name="k_kg_name" />
            </call>
          </call>
        </call>
      </where>
    </query>
  </queries>
  <dimension-packages>
    <dimension-package name="45862" timestamp="20.03.2019 15:21:16">
      <dimension class-type="jr_rep_blns_pwrc_fdrs" name="rep_blns_pwrc_fdrs" />
      <dimension class-type="hv_eopwrc_g" name="pwrc_id" />
      <dimension class-type="hv_eopwrc" name="pwrc_bal_id" />
      <dimension class-type="hv_eopwrc_fdrs" name="pwrc_fdrid" />
      <dimension class-type="hv_eopwrc_grid" name="pwrc_grid" />
      <dimension class-type="hv_eopwrc_grid_dtl" name="pwrc_grid_dtl" />
      <dimension class-type="jv_rep_cons_d_fl" name="jv_rep_cons_d_fl" />
      <dimension class-type="vb_kg_schema_fdr" name="schema_fdr" exclude="1" />
      <dimension class-type="vb_kg_schema_tp" name="schema_tp" exclude="1" />
      <dimension name="k_gr_f_tp" class-type="d45862_fdr_kg" />
      <dimension name="grid_dtl_kg" class-type="d45862_grid_dtl_kg" />
      <dimension class-type="jr_rep_blns_pwrc_fdrs_test" name="rep_blns_pwrc_fdrs_test" />
      <dimension name="kg_name" time-type="string" exclude="1" />
      <dimension name="kg_name" class-type="d45862_kg_name" />
      <dimension name="d45862_ym" time-type="number" exclude="1" />
      <dimension class-type="hv_eopwrc_test_det_mat" name="pwrc_id_test_det_mat" />
      <dimension class-type="jr_rep_blns_pwrc_fdrs_test_det_mat" name="rep_blns_test_det_mat" />
    </dimension-package>
  </dimension-packages>
  <views>
    <view name="45862-yms">
      WITH X
      AS (SELECT MAX (X.CURR_YM) YM
      FROM KS_ZBD Z
      INNER JOIN KR_ORG O ON (Z.KODP = O.KODP)
      INNER JOIN (SELECT MAX (C.YM) AS CURR_YM, C.PODR
      FROM KR_CALC C
      GROUP BY C.PODR) X
      ON (Z.KODP = X.PODR))
      SELECT KG.YM_ADD (ym, -RN) ym,
      rpad(KG.YM_ADD (ym, -RN),7,'0') name
      FROM X
      CROSS JOIN (SELECT ROWNUM - 1 AS RN
      FROM DUAL
      CONNECT BY ROWNUM &lt;= 24)
    </view>
    <view name="45862-yms_test">
      SELECT KG.YM_ADD (ym, -RN) ym,
      rpad(KG.YM_ADD (ym, -RN),7,'0') name
      FROM
      (
      SELECT MAX (X.CURR_YM) YM
      FROM KS_ZBD Z
      INNER JOIN KR_ORG O ON (Z.KODP = O.KODP)
      INNER JOIN (SELECT MAX (C.YM) AS CURR_YM, C.PODR
      FROM KR_CALC C
      GROUP BY C.PODR) X
      ON (Z.KODP = X.PODR)
      )
      CROSS JOIN (SELECT ROWNUM - 1 AS RN
      FROM DUAL
      CONNECT BY ROWNUM &lt;= 2)
    </view>
  </views>
</root>